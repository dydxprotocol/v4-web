"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[3177],{67358:(e,t,a)=>{a.r(t),a.d(t,{LinetoolTemplatesList:()=>m});var l=a(25177),o=a(38239),n=a(9565),r=a(17501),T=a(90266),s=a(53055);class m{constructor(e,t){this._toolName=e,this._applyTemplate=t,this._templatesDeferred=this._loadData()}getData(){return o.store.getState().templates[this._toolName]}templatesLoaded(){return this._templatesDeferred}loadTemplate(e,t){o.store.dispatch((0,n.loadTemplate)(this._toolName,e,e=>{this._applyTemplate(e),null==t||t()}))}removeTemplate(e){o.store.dispatch((0,n.startRemoveTemplate)(this._toolName,e))}saveTemplate(e,t){const a=(0,r.clean)(e);o.store.dispatch((0,n.saveTemplate)(this._toolName,a,t))}deleteAction(e){(0,T.runOrSignIn)(()=>{const t=(0,l.t)("Do you really want to delete Drawing Template '{name}' ?",{replace:{name:e}});(0,s.showConfirm)({text:t,onConfirm:t=>{this.removeTemplate(e),t.dialogClose()}})},{source:"Delete line tool template"})}showSaveDialog(e){(0,T.runOrSignIn)(()=>{(0,s.showRename)({title:(0,l.t)("Save Drawing Template As"),text:(0,l.t)("Template name")+":",maxLength:64,onRename:t=>{if(-1!==(this.getData()||[]).indexOf(t.newValue)){const a=(0,l.t)("Drawing Template '{name}' already exists. Do you really want to replace it?",{replace:{name:t.newValue}});(0,s.showConfirm)({text:a,onConfirm:a=>{e(t.newValue),a.dialogClose(),t.dialogClose()},onClose:t.focusInput},t.innerManager)}else e(t.newValue),t.dialogClose()}})},{source:"Save line tool template",sourceMeta:"Chart"})}async _loadData(){return new Promise(e=>{this.getData()?e():o.store.dispatch((0,n.getTemplates)(this._toolName,e))})}}},9565:(e,t,a)=>{a.d(t,{getTemplates:()=>o,setTemplates:()=>n,addTemplate:()=>r,startRemoveTemplate:()=>T,removeTemplate:()=>s,saveTemplate:()=>m,loadTemplate:()=>c,applyDefaults:()=>i});var l=a(48583);function o(e,t){return{type:l.GET_TEMPLATES,toolName:e,callback:t}}function n(e,t){return{type:l.SET_TEMPLATES,templates:t,toolName:e}}function r(e,t){return{type:l.ADD_TEMPLATE,templateName:t,toolName:e}}function T(e,t){return{type:l.START_REMOVE_TEMPLATE,templateName:t,toolName:e}}function s(e,t){return{type:l.REMOVE_TEMPLATE,templateName:t,toolName:e}}function m(e,t,a){return{type:l.SAVE_TEMPLATE,templateName:t,toolName:e,content:a}}function c(e,t,a){return{type:l.LOAD_TEMPLATE,toolName:e,templateName:t,callback:a}}function i(e,t){return{type:l.APPLY_DEFAULTS,model:e,source:t}}},48583:(e,t,a)=>{function l(e){return"LINE_TOOL_TEMPLATE__"+e}a.d(t,{GET_TEMPLATES:()=>o,SET_TEMPLATES:()=>n,START_REMOVE_TEMPLATE:()=>r,REMOVE_TEMPLATE:()=>T,SAVE_TEMPLATE:()=>s,ADD_TEMPLATE:()=>m,LOAD_TEMPLATE:()=>c,APPLY_DEFAULTS:()=>i});const o=l("GET_TEMPLATES"),n=l("SET_TEMPLATES"),r=l("START_REMOVE_TEMPLATE"),T=l("REMOVE_TEMPLATE"),s=l("SAVE_TEMPLATE"),m=l("ADD_TEMPLATE"),c=l("LOAD_TEMPLATE"),i=l("APPLY_DEFAULTS")},38239:(e,t,a)=>{a.d(t,{store:()=>g});var l=a(83243),o=a(54773),n=a(36349),r=a(88537),T=a(48583),s=a(51951),m=a(9565);function c(e,t){return t}var i=a(19013);const E=(0,
s.getLogger)("Chart.LineToolTemplatesList");function p(e,t){return t}function*u(){for(;;){const{toolName:e,templateName:t,content:a}=p(T.SAVE_TEMPLATE,yield(0,n.take)(T.SAVE_TEMPLATE));try{yield(0,n.call)(i.backend.saveDrawingTemplate,e,t,a),yield(0,n.put)((0,m.addTemplate)(e,t))}catch(e){E.logWarn(e)}}}function*d(){for(;;){const{toolName:e,templateName:t}=p(T.START_REMOVE_TEMPLATE,yield(0,n.take)(T.START_REMOVE_TEMPLATE));try{yield(0,n.call)(i.backend.removeDrawingTemplate,e,t),yield(0,n.put)((0,m.removeTemplate)(e,t))}catch(e){E.logWarn(e)}}}function*A(){const e=new Map;for(;;){const{toolName:a,callback:l}=p(T.GET_TEMPLATES,yield(0,n.take)(T.GET_TEMPLATES));e.has(a)?(0,r.ensureDefined)(e.get(a)).push(l):(e.set(a,[l]),yield(0,n.fork)(t,a))}function*t(t){try{const e=c(i.backend.getDrawingTemplates,yield(0,n.call)(i.backend.getDrawingTemplates,t));yield(0,n.put)((0,m.setTemplates)(t,e))}catch(e){E.logWarn(e)}(0,r.ensureDefined)(e.get(t)).forEach(e=>null==e?void 0:e()),e.delete(t)}}function*_(){for(;;){const{toolName:e,templateName:t,callback:a}=p(T.LOAD_TEMPLATE,yield(0,n.take)(T.LOAD_TEMPLATE));try{const l=c(i.backend.loadDrawingTemplate,yield(0,n.call)(i.backend.loadDrawingTemplate,e,t));a&&a(l)}catch(e){E.logWarn(e)}}}function*L(){for(;;){const{model:e,source:t}=p(T.APPLY_DEFAULTS,yield(0,n.take)(T.APPLY_DEFAULTS));try{yield(0,n.call)([e,e.restorePropertiesForSource],t)}catch(e){E.logWarn(e)}}}function*f(){yield(0,n.all)([(0,n.call)(A),(0,n.call)(u),(0,n.call)(d),(0,n.call)(_),(0,n.call)(L)])}const M={templates:{}};function P(e,t){return e.localeCompare(t,void 0,{numeric:!0})}function D(e=M,t){switch(t.type){case T.ADD_TEMPLATE:{const{toolName:a,templateName:l}=t;if(!e.templates[a].includes(l)){const t=[...e.templates[a],l].sort(P);return{...e,templates:{...e.templates,[a]:t}}}return e}case T.SET_TEMPLATES:{const{toolName:a,templates:l}=t;return{...e,templates:{...e.templates,[a]:[...l].sort(P)}}}case T.REMOVE_TEMPLATE:{const{toolName:a,templateName:l}=t;return{...e,templates:{...e.templates,[a]:e.templates[a].filter(e=>e!==l)}}}default:return e}}const g=function(){const e=(0,o.default)(),t=(0,l.createStore)(D,(0,l.applyMiddleware)(e));return e.run(f),t}()},90266:(e,t,a)=>{a.d(t,{runOrSignIn:()=>l});function l(e,t){e()}}}]);