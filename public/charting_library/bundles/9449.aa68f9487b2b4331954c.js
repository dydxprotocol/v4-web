"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[9449],{69449:(s,t,e)=>{e.d(t,{quoteSessionAdapters:()=>n});var a=e(16282),i=e(51379),o=e(80478);const r=new Map;class l{constructor(s,t,e="watchlist"){this._symbolDataHandlers=new Map,this._fastSymbols=new Set,this._subscribedSymbols=new Set,this._subscriptionSet=new Set,this._cancelSubscriptionSet=new Set,this._resolvedSymbolsSet=new Set,this._quoteSessionDataHandler=s=>{const t=(0,a.ensureDefined)(s.symbolname),{filtered:e,keepSubscription:i}=this._applyDataFilters(s);i||this._unsubscribeSymbols([t]),this._setSymbolDataCache(t,e);const o=this._symbolDataHandlers.get(t);o&&o(e)},this._clientId=s,this._quoteSession=(0,i.getQuoteSessionInstance)(e),this._lastSymbolData=t||new Map}destroy(){const s=Array.from(this._subscribedSymbols);this._unsubscribeSymbols(s)}addFastSymbol(s){this._fastSymbols.has(s)||!this._subscribedSymbols.has(s)||(0,o.isSeparatorItem)(s)||(this._fastSymbols.add(s),this._quoteSession.setFastSymbols(this._clientId,Array.from(this._fastSymbols)))}removeFastSymbol(s){this._fastSymbols.has(s)&&(this._fastSymbols.delete(s),this._quoteSession.setFastSymbols(this._clientId,Array.from(this._fastSymbols)))}addSymbolDataHandler(s,t){(0,o.isSeparatorItem)(s)||this._symbolDataHandlers.set(s,t)}removeSymbolDataHandler(s){this._symbolDataHandlers.delete(s)}addToSubscriptionSet(s){s.forEach(s=>{(0,o.isSeparatorItem)(s)||this._subscriptionSet.add(s)})}clearSubscriptionSet(){this._subscriptionSet.clear()}addToCancelSubscriptionSet(s){s.forEach(s=>{(0,o.isSeparatorItem)(s)||this._cancelSubscriptionSet.add(s)})}commitSubscriptionChanges(){Array.from(this._subscriptionSet).forEach(s=>{this._cancelSubscriptionSet.has(s)&&(this._subscriptionSet.delete(s),this._cancelSubscriptionSet.delete(s))}),this._subscribeSymbols(Array.from(this._subscriptionSet)),this._subscriptionSet.clear(),this._unsubscribeSymbols(Array.from(this._cancelSubscriptionSet)),this._cancelSubscriptionSet.clear(),this._quoteSession.setFastSymbols(this._clientId,Array.from(this._fastSymbols))}getLastSymbolData(s){return this._lastSymbolData.get(s)}getSymbolSnapshotForAll(s,t,e=guid()){const a=s.map(s=>this.getSymbolSnapshot(s,t,e));return Promise.all(a)}getSymbolSnapshot(s,t,e=guid()){if((0,o.isSeparatorItem)(s))return Promise.resolve(void 0);const a=this._lastSymbolData.get(s);if(a&&"ok"===a.status){const e=this._resolvedSymbolsSet.has(s)&&a.complete;if(S(a,t)||e)return this._resolvedSymbolsSet.add(s),Promise.resolve(a)}return new Promise(a=>{const i=this._clientId+"_snapshot_"+e,o=e=>{const{filtered:r,keepSubscription:l}=this._applyDataFilters(e);r&&"error"!==r.status&&this._setSymbolDataCache(s,r),(!l||S(r,t)||"error"===r.status||r.complete)&&(this._quoteSession.unsubscribe(i,s,o),a(r))};this._quoteSession.subscribe(i,s,o)})}getSymbolFullName(s){if((0,o.isSeparatorItem)(s))return Promise.resolve(s);if(r.has(s))return(0,a.ensureDefined)(r.get(s));const t=new Promise(t=>{const e=this._clientId+"_SymbolFullName",a=i=>{const o=i=>{this._quoteSession.unsubscribe(e,s,a),
t(i)};i&&"ok"===i.status?i.values&&o(i.values.pro_name||s):o(s)};this._quoteSession.subscribe(e,s,a)});return r.set(s,t),t}getSymbolsFullNames(s){return Promise.all(s.map(s=>this.getSymbolFullName(s)))}getUniqueSymbolsFullNames(s){return this.getSymbolsFullNames(s).then(s=>Array.from(new Set(s)))}_subscribeSymbols(s){this._quoteSession.subscribe(this._clientId,s,this._quoteSessionDataHandler),s.forEach(s=>this._subscribedSymbols.add(s))}_unsubscribeSymbols(s){this._quoteSession.unsubscribe(this._clientId,s,this._quoteSessionDataHandler),s.forEach(s=>{this._subscribedSymbols.delete(s)})}_setSymbolDataCache(s,t){var e;const a=(null===(e=this._lastSymbolData.get(s))||void 0===e?void 0:e.values)||{};this._resolvedSymbolsSet.add(s),this._lastSymbolData.set(s,{...t,values:{...a,...t.values}})}_applyDataFilters(s){return{filtered:s,keepSubscription:!0}}}const n=new class{constructor(){this._adaptersMap=new Map,this._lastSymbolData=new Map}destroy(){this._adaptersMap.forEach(s=>{s.forEach(s=>s.destroy())}),this._lastSymbolData.clear()}get(s,t="watchlist"){let e;const a=this._adaptersMap.get(s);if(a){const i=a.get(t);i?e=i:(e=new l(s,this._lastSymbolData,t),a.set(t,e))}else{e=new l(s,this._lastSymbolData,t);const a=new Map;a.set(t,e),this._adaptersMap.set(s,a)}return e}};function S(s,t){for(const e of Array.from(t))if(!s.values.hasOwnProperty(e))return!1;return!0}},80478:(s,t,e)=>{function a(s){return!1}e.d(t,{isSeparatorItem:()=>a})}}]);