"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[3177],{190266:(e,t,a)=>{a.d(t,{runOrSignIn:()=>l,runOrSignInWithPromo:()=>o});function l(e,t){e()}function o(e,t,a){a()}},816232:(e,t,a)=>{a.r(t),a.d(t,{LinetoolTemplatesList:()=>c});var l=a(609838),o=a(917568),n=a(279708),r=a(540642),s=a(190266),T=a(153055),m=a(78943);const i=a(440891).enabled("drawing_templates");class c{constructor(e,t){this._toolName=e,this._applyTemplate=t,this._templatesDeferred=i?this._loadData():Promise.resolve()}getData(){return o.store.getState().templates[this._toolName]}templatesLoaded(){return this._templatesDeferred}loadTemplate(e,t){o.store.dispatch((0,n.loadTemplate)(this._toolName,e,(async e=>{this._applyTemplate(e),t?.()})))}removeTemplate(e){o.store.dispatch((0,n.startRemoveTemplate)(this._toolName,e))}saveTemplate(e,t){const a=(0,r.clean)(e);o.store.dispatch((0,n.saveTemplate)(this._toolName,a,t))}deleteAction(e){(0,s.runOrSignIn)((()=>{const t=l.t(null,{replace:{name:e}},a(57285));(0,T.showConfirm)({text:t,onConfirm:t=>{this.removeTemplate(e),t.dialogClose()}})}),{source:"Delete line tool template"})}showSaveDialog(e){(0,s.runOrSignIn)((()=>{(0,T.showRename)({title:l.t(null,void 0,a(776047)),text:l.t(null,void 0,a(59233))+":",maxLength:64,source:this.getData()||[],autocompleteFilter:m.autocompleteFilter,onRename:t=>{if(-1!==(this.getData()||[]).indexOf(t.newValue)){const o=l.t(null,{replace:{name:t.newValue}},a(623276));(0,T.showConfirm)({text:o,onConfirm:a=>{e(t.newValue),a.dialogClose(),t.dialogClose()},onClose:t.focusInput},t.innerManager)}else e(t.newValue),t.dialogClose()}})}),{source:"Save line tool template",sourceMeta:"Chart"})}async _loadData(){return new Promise((e=>{this.getData()?e():o.store.dispatch((0,n.getTemplates)(this._toolName,e))}))}}},279708:(e,t,a)=>{a.d(t,{addTemplate:()=>r,getTemplates:()=>o,loadTemplate:()=>i,removeTemplate:()=>T,saveTemplate:()=>m,setTemplates:()=>n,startRemoveTemplate:()=>s});var l=a(667259);function o(e,t){return{type:l.GET_TEMPLATES,toolName:e,callback:t}}function n(e,t){return{type:l.SET_TEMPLATES,templates:t,toolName:e}}function r(e,t){return{type:l.ADD_TEMPLATE,templateName:t,toolName:e}}function s(e,t){return{type:l.START_REMOVE_TEMPLATE,templateName:t,toolName:e}}function T(e,t){return{type:l.REMOVE_TEMPLATE,templateName:t,toolName:e}}function m(e,t,a){return{type:l.SAVE_TEMPLATE,templateName:t,toolName:e,content:a}}function i(e,t,a){return{type:l.LOAD_TEMPLATE,toolName:e,templateName:t,callback:a}}},667259:(e,t,a)=>{function l(e){return"LINE_TOOL_TEMPLATE__"+e}a.d(t,{ADD_TEMPLATE:()=>m,GET_TEMPLATES:()=>o,LOAD_TEMPLATE:()=>i,REMOVE_TEMPLATE:()=>s,SAVE_TEMPLATE:()=>T,SET_TEMPLATES:()=>n,START_REMOVE_TEMPLATE:()=>r});const o=l("GET_TEMPLATES"),n=l("SET_TEMPLATES"),r=l("START_REMOVE_TEMPLATE"),s=l("REMOVE_TEMPLATE"),T=l("SAVE_TEMPLATE"),m=l("ADD_TEMPLATE"),i=l("LOAD_TEMPLATE")},917568:(e,t,a)=>{a.d(t,{store:()=>h});var l=a(406047),o=a(746212),n=a(129885),r=a(650151),s=a(667259),T=a(671945),m=a(279708);function i(e,t){return t}var c=a(301341)
;const E=(0,T.getLogger)("Chart.LineToolTemplatesList");function p(e,t){return t}function*u(){for(;;){const{toolName:e,templateName:t,content:a}=p(s.SAVE_TEMPLATE,yield(0,n.take)(s.SAVE_TEMPLATE));try{yield(0,n.call)(c.backend.saveDrawingTemplate,e,t,a),yield(0,n.put)((0,m.addTemplate)(e,t))}catch(e){E.logWarn(e)}}}function*d(){for(;;){const{toolName:e,templateName:t}=p(s.START_REMOVE_TEMPLATE,yield(0,n.take)(s.START_REMOVE_TEMPLATE));try{yield(0,n.call)(c.backend.removeDrawingTemplate,e,t),yield(0,n.put)((0,m.removeTemplate)(e,t))}catch(e){E.logWarn(e)}}}function*_(){const e=new Map;for(;;){const{toolName:a,callback:l}=p(s.GET_TEMPLATES,yield(0,n.take)(s.GET_TEMPLATES));e.has(a)?(0,r.ensureDefined)(e.get(a)).push(l):(e.set(a,[l]),yield(0,n.fork)(t,a))}function*t(t){try{const e=i(c.backend.getDrawingTemplates,yield(0,n.call)(c.backend.getDrawingTemplates,t));yield(0,n.put)((0,m.setTemplates)(t,e))}catch(e){E.logWarn(e)}(0,r.ensureDefined)(e.get(t)).forEach((e=>e?.())),e.delete(t)}}function*A(){for(;;){const{toolName:e,templateName:t,callback:a}=p(s.LOAD_TEMPLATE,yield(0,n.take)(s.LOAD_TEMPLATE));try{const l=i(c.backend.loadDrawingTemplate,yield(0,n.call)(c.backend.loadDrawingTemplate,e,t));a&&a(l)}catch(e){E.logWarn(e)}}}function*L(){yield(0,n.all)([(0,n.call)(_),(0,n.call)(u),(0,n.call)(d),(0,n.call)(A)])}const f={templates:{}};function M(e,t){return e.localeCompare(t,void 0,{numeric:!0})}function g(e=f,t){switch(t.type){case s.ADD_TEMPLATE:{const{toolName:a,templateName:l}=t;if(!e.templates[a].includes(l)){const t=[...e.templates[a],l].sort(M);return{...e,templates:{...e.templates,[a]:t}}}return e}case s.SET_TEMPLATES:{const{toolName:a,templates:l}=t;return{...e,templates:{...e.templates,[a]:[...l].sort(M)}}}case s.REMOVE_TEMPLATE:{const{toolName:a,templateName:l}=t;return{...e,templates:{...e.templates,[a]:e.templates[a].filter((e=>e!==l))}}}default:return e}}const h=function(){const e=(0,o.default)(),t=(0,l.createStore)(g,(0,l.applyMiddleware)(e));return e.run(L),t}()},78943:(e,t,a)=>{function l(e,t){return Boolean(""===e||e&&-1!==t.toLowerCase().indexOf(e.toLowerCase()))}a.d(t,{autocompleteFilter:()=>l})}}]);