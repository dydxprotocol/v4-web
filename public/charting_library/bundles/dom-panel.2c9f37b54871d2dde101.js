(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[4627],{825961:t=>{t.exports={}},288617:t=>{t.exports={container:"container-JRxEBS8y"}},118096:t=>{t.exports={wrapper:"wrapper-Joli8wYw",button:"button-Joli8wYw",position:"position-Joli8wYw",buy:"buy-Joli8wYw",sell:"sell-Joli8wYw",pl:"pl-Joli8wYw",profit:"profit-Joli8wYw",loss:"loss-Joli8wYw"}},219630:t=>{t.exports={headerWrapper:"headerWrapper-ziqn2FEW",header:"header-ziqn2FEW",customField:"customField-ziqn2FEW",duration:"duration-ziqn2FEW",arrow:"arrow-ziqn2FEW",upperCase:"upperCase-ziqn2FEW",textBlock:"textBlock-ziqn2FEW",summaryLine:"summaryLine-ziqn2FEW"}},336330:t=>{t.exports={widgetcolumnwidthbuysell:"62px",widgetcolumnwidthmiddle:"70px",widgetcolumnwidthorders:"56px",widgetborderwidth:"1px","tv-dom-panel":"tv-dom-panel-eAhUzBdr","tv-dom-panel__header":"tv-dom-panel__header-eAhUzBdr","tv-dom-panel__header-title":"tv-dom-panel__header-title-eAhUzBdr","tv-dom-panel__header-symbol":"tv-dom-panel__header-symbol-eAhUzBdr","tv-dom-panel__header-exchange":"tv-dom-panel__header-exchange-eAhUzBdr","tv-dom-panel__header-close":"tv-dom-panel__header-close-eAhUzBdr","tv-dom-panel__header-warning":"tv-dom-panel__header-warning-eAhUzBdr","tv-dom-panel__header-warning--active":"tv-dom-panel__header-warning--active-eAhUzBdr","tv-dom-panel__content":"tv-dom-panel__content-eAhUzBdr","tv-dom-panel__warning":"tv-dom-panel__warning-eAhUzBdr","tv-dom-panel__no-data-notice":"tv-dom-panel__no-data-notice-eAhUzBdr","tv-dom-panel__disabled":"tv-dom-panel__disabled-eAhUzBdr","tv-dom-panel__disabled-warning":"tv-dom-panel__disabled-warning-eAhUzBdr",mainblock:"mainblock-eAhUzBdr"}},49217:t=>{t.exports={wrapper:"wrapper-pzOYYb_G",title:"title-pzOYYb_G"}},947161:t=>{t.exports={upperBlock:"upperBlock-nVaTV1ML",bottomBlock:"bottomBlock-nVaTV1ML"}},205559:t=>{t.exports={widgetcolumnwidthbuysell:"62px",widgetcolumnwidthmiddle:"70px",widgetcolumnwidthorders:"56px",widgetordertypeheight:"10px",widgetborderwidth:"1px",widgetrowheight:"20px","tv-dom-widget-main":"tv-dom-widget-main-pcQoXV_v","tv-dom-widget-main__anchor":"tv-dom-widget-main__anchor-pcQoXV_v","tv-dom-widget-main__row":"tv-dom-widget-main__row-pcQoXV_v","tv-dom-widget-main__value":"tv-dom-widget-main__value-pcQoXV_v","tv-dom-widget-main__value--price":"tv-dom-widget-main__value--price-pcQoXV_v","tv-dom-widget-main__value--highlighted":"tv-dom-widget-main__value--highlighted-pcQoXV_v","tv-dom-widget-main__value--long-position":"tv-dom-widget-main__value--long-position-pcQoXV_v","tv-dom-widget-main__value--short-position":"tv-dom-widget-main__value--short-position-pcQoXV_v","tv-dom-widget-main__value--buy":"tv-dom-widget-main__value--buy-pcQoXV_v","tv-dom-widget-main__value--sell":"tv-dom-widget-main__value--sell-pcQoXV_v","tv-dom-widget-main__value--orders-buy":"tv-dom-widget-main__value--orders-buy-pcQoXV_v","tv-dom-widget-main__value--orders-sell":"tv-dom-widget-main__value--orders-sell-pcQoXV_v","tv-dom-widget-main__value--color-bid":"tv-dom-widget-main__value--color-bid-pcQoXV_v",
"tv-dom-widget-main__value--color-ask":"tv-dom-widget-main__value--color-ask-pcQoXV_v","tv-dom-widget-main__label":"tv-dom-widget-main__label-pcQoXV_v","tv-dom-widget-main__label--active":"tv-dom-widget-main__label--active-pcQoXV_v","tv-dom-widget-main__meter":"tv-dom-widget-main__meter-pcQoXV_v","tv-dom-widget-main__meter--buy":"tv-dom-widget-main__meter--buy-pcQoXV_v","tv-dom-widget-main__meter--buy-active":"tv-dom-widget-main__meter--buy-active-pcQoXV_v","tv-dom-widget-main__meter--sell":"tv-dom-widget-main__meter--sell-pcQoXV_v","tv-dom-widget-main__meter--sell-active":"tv-dom-widget-main__meter--sell-active-pcQoXV_v","tv-dom-widget-main__value-readout":"tv-dom-widget-main__value-readout-pcQoXV_v","tv-dom-widget-main__offscreen-arrow":"tv-dom-widget-main__offscreen-arrow-pcQoXV_v","tv-dom-widget-main__offscreen-arrow--higher":"tv-dom-widget-main__offscreen-arrow--higher-pcQoXV_v","tv-dom-widget-main__offscreen-arrow--lower":"tv-dom-widget-main__offscreen-arrow--lower-pcQoXV_v","tv-dom-widget-main__order":"tv-dom-widget-main__order-pcQoXV_v","tv-dom-widget-main__order--collapsed":"tv-dom-widget-main__order--collapsed-pcQoXV_v","tv-dom-widget-main__drag-shield":"tv-dom-widget-main__drag-shield-pcQoXV_v","tv-dom-widget-main__drag-shield--order":"tv-dom-widget-main__drag-shield--order-pcQoXV_v","tv-dom-widget-main__hidden":"tv-dom-widget-main__hidden-pcQoXV_v"}},896712:t=>{t.exports={widgetcolumnwidthbuysell:"62px",widgetcolumnwidthmiddle:"70px",widgetborderwidth:"1px",widgetyellow:"#ffc84a","tv-dom-widget-nav":"tv-dom-widget-nav-iyuM4zrx","tv-dom-widget-nav__button-block":"tv-dom-widget-nav__button-block-iyuM4zrx","tv-dom-widget-nav__button-block--price":"tv-dom-widget-nav__button-block--price-iyuM4zrx","tv-dom-widget-nav__button-block--orders":"tv-dom-widget-nav__button-block--orders-iyuM4zrx","tv-dom-widget-nav__button":"tv-dom-widget-nav__button-iyuM4zrx","tv-dom-widget-nav__button--clear-ask":"tv-dom-widget-nav__button--clear-ask-iyuM4zrx","tv-dom-widget-nav__button--clear-bid":"tv-dom-widget-nav__button--clear-bid-iyuM4zrx","tv-dom-widget-nav__button--disabled":"tv-dom-widget-nav__button--disabled-iyuM4zrx","tv-dom-widget-nav__button--center":"tv-dom-widget-nav__button--center-iyuM4zrx","tv-dom-widget-nav_center":"tv-dom-widget-nav_center-iyuM4zrx","tv-dom-widget-nav_overall-volume":"tv-dom-widget-nav_overall-volume-iyuM4zrx","tv-dom-widget-nav_overall-volume--ask":"tv-dom-widget-nav_overall-volume--ask-iyuM4zrx","tv-dom-widget-nav_overall-volume--bid":"tv-dom-widget-nav_overall-volume--bid-iyuM4zrx","tv-dom-widget-nav_count-volume":"tv-dom-widget-nav_count-volume-iyuM4zrx","tv-dom-widget-nav__timer":"tv-dom-widget-nav__timer-iyuM4zrx"}},818099:t=>{t.exports={widgetordertypeheight:"10px",widgetrowheight:"20px",widgetborderwidth:"1px",widgetyellow:"#ffc84a","tv-dom-widget-order":"tv-dom-widget-order-D4dk6HGx","tv-dom-widget-order--ghost":"tv-dom-widget-order--ghost-D4dk6HGx","tv-dom-widget-order--inactive":"tv-dom-widget-order--inactive-D4dk6HGx",
"tv-dom-widget-order--type-stop":"tv-dom-widget-order--type-stop-D4dk6HGx","tv-dom-widget-order__close":"tv-dom-widget-order__close-D4dk6HGx","tv-dom-widget-order--type-stoplimit":"tv-dom-widget-order--type-stoplimit-D4dk6HGx","tv-dom-widget-order--highlighted":"tv-dom-widget-order--highlighted-D4dk6HGx","tv-dom-widget-order--buy":"tv-dom-widget-order--buy-D4dk6HGx","tv-dom-widget-order--notcanceled":"tv-dom-widget-order--notcanceled-D4dk6HGx","tv-dom-widget-order__qty":"tv-dom-widget-order__qty-D4dk6HGx","tv-dom-widget-order--immovable":"tv-dom-widget-order--immovable-D4dk6HGx","tv-dom-widget-order--unmodified":"tv-dom-widget-order--unmodified-D4dk6HGx","tv-dom-widget-order__type":"tv-dom-widget-order__type-D4dk6HGx"}},288330:t=>{t.exports={wrapper:"wrapper-qDEFOfCq",marketBlock:"marketBlock-qDEFOfCq",tradingActionBlock:"tradingActionBlock-qDEFOfCq",container:"container-qDEFOfCq",row:"row-qDEFOfCq",button:"button-qDEFOfCq",buttonOrdinary:"buttonOrdinary-qDEFOfCq button-qDEFOfCq",buttonBuy:"buttonBuy-qDEFOfCq button-qDEFOfCq",buttonSell:"buttonSell-qDEFOfCq button-qDEFOfCq"}},693676:t=>{t.exports={wrapper:"wrapper-RoaZjf69",select:"select-RoaZjf69",selectMenu:"selectMenu-RoaZjf69",title:"title-RoaZjf69"}},972404:t=>{t.exports={dateTimeWrapper:"dateTimeWrapper-Dg2Jb5Mv",containerDatePicker:"containerDatePicker-Dg2Jb5Mv",dateInputContainer:"dateInputContainer-Dg2Jb5Mv",dateInput:"dateInput-Dg2Jb5Mv",dateInputIcon:"dateInputIcon-Dg2Jb5Mv"}},533140:(t,e,i)=>{"use strict";i.r(e),i.d(e,{DOMPanel:()=>zt});var s,o=i(509806),r=i(650802),n=i(50959),a=i(500962),l=i(650151),d=i(870122),c=i(960521),u=i.n(c),h=i(159255),_=i(947488),m=i(997345),p=i(481330),v=i(181436),g=i(44681),b=i(322625),w=i(815628),y=i(357407),f=i(330012),k=i(973602),x=i(462056),I=i(98454),P=i(807107);!function(t){t[t.Inside=0]="Inside",t[t.Lower=1]="Lower",t[t.Higher=2]="Higher"}(s||(s={}));var S=i(737538),T=i(424030),D=i(180185),O=i(818099),C=i(205559);const N={limitOrder:o.t(null,void 0,i(398157)),stopOrder:o.t(null,void 0,i(905023))};class V{constructor(t){this._pool=[],this._handlers=t||{},this._ordersPool=new M(this._handlers),this._useCssTransform="transform"in document.createElement("span").style}allocate(){return this._pool.pop()||new B(this._ordersPool,this._handlers,this._useCssTransform)}free(t){t.destroy(),this._pool.push(t)}}class B{constructor(t,e,i){this._price=0,this._useCssTransform=i,this._ordersPool=t,this._handlers=e,this._allocatedOrderViews=[];const s=document.createElement("div");s.setAttribute("class",C["tv-dom-widget-main__row"]);const o=document.createElement("span");o.setAttribute("class",`${C["tv-dom-widget-main__value"]} ${C["tv-dom-widget-main__value--price"]}`);const r=document.createElement("span");r.setAttribute("class",`${C["tv-dom-widget-main__value"]} ${C["tv-dom-widget-main__value--sell"]}`);const n=document.createElement("span");n.setAttribute("class",`${C["tv-dom-widget-main__value"]} ${C["tv-dom-widget-main__value--buy"]}`);const a=document.createElement("span")
;a.setAttribute("class",`${C["tv-dom-widget-main__meter"]} ${C["tv-dom-widget-main__meter--sell"]}`);const l=document.createElement("span");l.setAttribute("class",`${C["tv-dom-widget-main__meter"]} ${C["tv-dom-widget-main__meter--buy"]}`);const d=document.createElement("span");d.setAttribute("class",C["tv-dom-widget-main__value-readout"]);const c=document.createElement("span");c.setAttribute("class",C["tv-dom-widget-main__value-readout"]);const u=document.createTextNode(""),h=document.createTextNode(""),_=document.createTextNode("");this._useCssTransform&&(a.style.width=l.style.width="100%",a.style.transform=l.style.transform="scale(0, 1)");const m=document.createElement("span");m.setAttribute("class",`${C["tv-dom-widget-main__value"]} ${C["tv-dom-widget-main__value--orders-buy"]}`);const p=document.createElement("span");p.textContent=N.limitOrder,p.setAttribute("class",C["tv-dom-widget-main__label"]),m.appendChild(p);const v=document.createElement("span");v.setAttribute("class",`${C["tv-dom-widget-main__value"]} ${C["tv-dom-widget-main__value--orders-sell"]}`);const g=document.createElement("span");g.textContent=N.limitOrder,g.setAttribute("class",C["tv-dom-widget-main__label"]),v.appendChild(g),s.appendChild(r),s.appendChild(n),s.appendChild(o),s.appendChild(m),s.appendChild(v),o.appendChild(_),r.appendChild(a),n.appendChild(l),r.appendChild(d),n.appendChild(c),d.appendChild(u),c.appendChild(h),this._priceCell=o,this._priceText=_,this._askText=u,this._bidText=h,this._askMeter=a,this._bidMeter=l,this._ordersBuy=m,this._ordersSell=v,this._orderBuyLabel=p,this._orderSellLabel=g,this._isHigherThanBestBid=!1,this._isLowerThanBestAsk=!1,this._orderType=1,e&&e.bidAskClick&&(r.addEventListener("click",(t=>this._handlerCellClick(-1,t)),!1),n.addEventListener("click",(t=>this._handlerCellClick(1,t)),!1)),e&&e.bidAskContextMenu&&(r.addEventListener("contextmenu",(t=>{e.bidAskContextMenu.call(null,t,{price:this._price,side:-1})}),!1),n.addEventListener("contextmenu",(t=>{e.bidAskContextMenu.call(null,t,{price:this._price,side:1})}),!1)),r.addEventListener("mouseover",(t=>{g.textContent=(0,D.modifiersFromEvent)(t)===D.Modifiers.Mod?N.stopOrder:N.limitOrder,g.style.visibility="visible"}),!1),r.addEventListener("mouseout",(()=>{g.style.visibility="hidden"}),!1),n.addEventListener("mouseover",(t=>{p.textContent=(0,D.modifiersFromEvent)(t)===D.Modifiers.Mod?N.stopOrder:N.limitOrder,p.style.visibility="visible"}),!1),n.addEventListener("mouseout",(()=>{p.style.visibility="hidden"}),!1),this.element=s}updatePriceText(t){this._priceText.nodeValue=t}updateBidVolume(t){this._bidText.nodeValue!==t&&(this._bidText.nodeValue=t)}updateAskVolume(t){this._askText.nodeValue!==t&&(this._askText.nodeValue=t)}updateBidMeter(t){const e=Math.min(Math.max(t,0),1)||0;this._useCssTransform?this._bidMeter.style.transform=`scale(${e}, 1)`:this._bidMeter.style.width=100*e+"%"}updateAskMeter(t){const e=Math.min(Math.max(t,0),1)||0;this._useCssTransform?this._askMeter.style.transform=`scale(${e}, 1)`:this._askMeter.style.width=100*e+"%"}
updatePriceHighlight(t,e){const i=this._priceCell.classList;if(i)i.toggle(C["tv-dom-widget-main__value--highlighted"],t),i.toggle(C["tv-dom-widget-main__value--long-position"],e>0),i.toggle(C["tv-dom-widget-main__value--short-position"],e<0);else{let i=`${C["tv-dom-widget-main__value"]} ${C["tv-dom-widget-main__value--price"]}`;t&&(i+=` ${C["tv-dom-widget-main__value--highlighted"]}`),e>0?i+=` ${C["tv-dom-widget-main__value--long-position"]}`:e<0&&(i+=` ${C["tv-dom-widget-main__value--short-position"]}`),this._priceCell.setAttribute("class",i)}}setHigherThanBid(t){this._isHigherThanBestBid=t,this._updateLabelColor(this._orderBuyLabel,this._isActive(t))}updateAskLabels(t){this._isLowerThanBestAsk=t,this._updateLabelColor(this._orderSellLabel,this._isActive(t))}handlerKey(t){const e=(0,D.modifiersFromEvent)(t)===D.Modifiers.Mod;this._orderType=e?3:1,this._orderSellLabel.textContent=e?N.stopOrder:N.limitOrder,this._orderBuyLabel.textContent=e?N.stopOrder:N.limitOrder,this._updateLabelColor(this._orderBuyLabel,this._isActive(this._isHigherThanBestBid)),this._updateLabelColor(this._orderSellLabel,this._isActive(this._isLowerThanBestAsk))}updatePrice(t){this._price=t}updateOrders(t){for(var e;this._allocatedOrderViews.length>t.length;){const t=this._allocatedOrderViews.pop();t&&this._ordersPool.free(t)}for(;this._allocatedOrderViews.length<t.length;)this._allocatedOrderViews.push(this._ordersPool.allocate());const i={};for(let s=0;s<t.length;s++){const o=t[s],r=this._allocatedOrderViews[s],n=Boolean(o.buy),a=n?1:-1;null===(e=i[a])||void 0===e||e.collapse(),i[a]=o.noCollapse?void 0:r,o.order!==r.order()&&(r.updateOrderData(o.order,o.pricePropertyName),r.updateQty(o.qty),r.updateTypeText(o.typeText),n?this._ordersBuy.prepend(r.element):this._ordersSell.append(r.element)),r.updateClassName({isBuy:n,type:o.type,inactive:o.inactive,ghost:o.ghost,highlighted:o.highlighted,isModifiable:o.isModifiable,isMovable:o.isMovable,isCancellable:o.isCancellable})}}destroy(){const t=this._allocatedOrderViews.length;if(t>0){for(let e=0;e<t;e++)this._ordersPool.free(this._allocatedOrderViews[e]);this._allocatedOrderViews.length=0}}paintPrice(t){const e=this.element.classList;e.toggle(C["tv-dom-widget-main__value--color-ask"],"ask"===t),e.toggle(C["tv-dom-widget-main__value--color-bid"],"bid"===t)}_handlerCellClick(t,e){const i=(0,D.modifiersFromEvent)(e);if(![D.Modifiers.None,D.Modifiers.Mod].includes(i))return;const s=1===t?this._bidMeter:this._askMeter,o=1===t?"buy":"sell";clearTimeout(this._activeStateTimerId),s.classList.add(`${C[`tv-dom-widget-main__meter--${o}-active`]}`),this._activeStateTimerId=setTimeout((()=>{s.classList.remove(`${C[`tv-dom-widget-main__meter--${o}-active`]}`)}),500),this._handlers.bidAskClick.call(null,e,{price:this._price,side:t,type:i===D.Modifiers.Mod?3:1})}_updateLabelColor(t,e){const i=t.classList;if(i)i.toggle(C["tv-dom-widget-main__label--active"],e);else{let i=C["tv-dom-widget-main__label"];e&&(i+=` ${C["tv-dom-widget-main__label--active"]}`),t.setAttribute("class",i)}}_isActive(t){
const e=3===this._orderType;return e&&!t||!e&&t}}class M{constructor(t){this._pool=[],this._handlers=t}allocate(){return this._pool.pop()||new L(this._handlers)}free(t){t.destroy(),this._pool.push(t)}}class L{constructor(t){this._order=null,this._pricePropertyName=null;const e=document.createElement("div");e.setAttribute("class",`${C["tv-dom-widget-main__order"]} ${O["tv-dom-widget-order"]}`);const s=document.createElement("div");s.innerHTML=i(548927),s.setAttribute("class",O["tv-dom-widget-order__close"]);const o=document.createElement("span");o.setAttribute("class",O["tv-dom-widget-order__qty"]);const r=document.createTextNode(""),n=document.createElement("span");n.setAttribute("class",O["tv-dom-widget-order__type"]);const a=document.createTextNode("");e.appendChild(s),e.appendChild(o),o.appendChild(r),e.appendChild(n),n.appendChild(a),t&&t.closeButtonClick&&s.addEventListener("click",(e=>{t.closeButtonClick.call(null,e,this._order)}),!1),t&&t.qtyClick&&o.addEventListener("click",(e=>{t.qtyClick.call(null,e,this._order)}),!1),t&&t.orderMousedown&&o.addEventListener("mousedown",(e=>{null!==this._order&&null!==this._pricePropertyName&&t.orderMousedown.call(null,e,{order:this._order,pricePropertyName:this._pricePropertyName})}),!1),this.element=e,this._qtyText=r,this._typeText=a}order(){return this._order}updateQty(t){this._qtyText.nodeValue=t||""}updateTypeText(t){this._typeText.nodeValue=t||""}updateClassName(t){const{isBuy:e,type:i,inactive:s,ghost:o,highlighted:r,isModifiable:n,isMovable:a,isCancellable:l}=t,d=this.element;d.className=`${C["tv-dom-widget-main__order"]} ${O["tv-dom-widget-order"]}`,d.classList.toggle(O["tv-dom-widget-order--buy"],!!e),d.classList.toggle(O[`tv-dom-widget-order--type-${i}`],!!i),d.classList.toggle(O["tv-dom-widget-order--inactive"],!!s),d.classList.toggle(O["tv-dom-widget-order--ghost"],!!o),d.classList.toggle(O["tv-dom-widget-order--highlighted"],!!r),d.classList.toggle(O["tv-dom-widget-order--unmodified"],!1===n),d.classList.toggle(O["tv-dom-widget-order--immovable"],!1===a),d.classList.toggle(O["tv-dom-widget-order--notcanceled"],!1===l)}collapse(){this.element.classList.add(C["tv-dom-widget-main__order--collapsed"])}updateOrderData(t,e){this._order=t,this._pricePropertyName=e}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this._order=null}}function E(t,e){const i=[];if(0===t.length||0===e.length)return[...t,...e];let s=0,o=0;for(;s<=t.length&&o<=e.length;){const r=t[s],n=e[o];r>=n?(s++,i.push(r)):(o++,i.push(n))}return s===t.length&&i.push(...e.slice(o+1)),o===e.length&&i.push(...t.slice(s+1)),i}function F(t,e){let i=0;for(const s of t){const t=s.filter(isFinite);if(0===t.length)continue;const o=t[0]-(e-i);if(o<0)return e-i;if(o<t.length)return t[o];const r=t.length-1;i+=t[0]-t[r]-r}return e-i}function A(t,e){return e-t}function q(t,e,i,s){return e===s[i-1]||t.push(Number(e)),t}class ${constructor(t,e,i){this._container=null,this._listContainer=null,this._dragShield=null,this._viewsList=[],this._bids={},this._asks={},this._indexes=[],
this._repaintScheduled=!1,this._currentVolumeMax=0,this._orders={},this._positionIndex=NaN,this._positionQty=0,this._orderGhost=null,this._totalVolumeBid=0,this._totalVolumeAsk=0,this._buyOrdersValue=0,this._sellOrdersValue=0,this._buyOrdersValueInactive=0,this._sellOrdersValueInactive=0,this._buyOrdersQuantity=0,this._sellOrdersQuantity=0,this._offscreenIndexLocation$=new S.Subject,this._cellIndexesInAskZone=[],this._cellIndexesInBidZone=[],this._bestAskIndex=Number.POSITIVE_INFINITY,this._bestBidIndex=Number.NEGATIVE_INFINITY,this._worstBidIndex=Number.POSITIVE_INFINITY,this._worstAskIndex=Number.NEGATIVE_INFINITY,this._handlers=t||{},this._realtimeProvider=i,this._showPricesWith=e,this.autoCenterRequired=new r.WatchedValue(!1),this.height=0,this.topIndex=NaN,this._symbolData=null,this.indexToPrice=()=>NaN,this.priceToIndex=()=>NaN,this._lastPriceIndex=NaN,this._viewAllocated=new Map,this._viewPool=null,this._invalidatedAsk={},this._invalidatedBid={},this._invalidatedPriceHighlight={},this._invalidatedOrders={},this._dynamicModeState=!1,this._numericFormatter=new T.NumericFormatter,this._showPricesWith.zeroVolume.subscribe(this.centerOnLast.bind(this)),this._showPricesWith.spread.subscribe(this.centerOnLast.bind(this)),this.reset()}reset(){this.topIndex=NaN,this._symbolData=null,this.indexToPrice=()=>NaN,this.priceToIndex=()=>NaN,this._lastPriceIndex=NaN,this.resetData(),this.resetView(),this.resetOrders(),this.resetOrderGhost(),this.resetPosition(),this.autoCenterRequired.setValue(!1)}resetData(){if(this._bids={},this._asks={},this._totalVolumeBid=0,this._totalVolumeAsk=0,this._recalcMaxVolume(),this._recalcBestWorstBid(),this._recalcBestWorstAsk(),this._viewAllocated)for(const[t]of this._viewAllocated)this._invalidatedAsk[t]=!0,this._invalidatedBid[t]=!0;this._offscreenIndexLocation$.next(s.Inside),this.scheduleRepaint()}resetOrders(){if(this._orders)for(const t in this._orders)this._orders.hasOwnProperty(t)&&(this._invalidatedOrders[t]=!0);this._orders={},this._buyOrdersValue=0,this._sellOrdersValue=0,this._buyOrdersValueInactive=0,this._sellOrdersValueInactive=0,this._buyOrdersQuantity=0,this._sellOrdersQuantity=0,this.scheduleRepaint()}resetPosition(){this._invalidatedPriceHighlight[this._positionIndex]=!0,this._positionIndex=NaN,this._positionQty=0,this.scheduleRepaint()}resetView(){if(this._viewAllocated&&this._viewPool)for(const[t]of this._viewAllocated){const e=this._viewAllocated.get(t);e&&(e.element.remove(),this._viewPool.free(e),this._viewAllocated.delete(t))}this._listContainer&&(this._viewsList.length=0,this._listContainer.innerHTML=""),this.setDragShield(!1,!1),this.scheduleRepaint()}setSymbolInfo(t){this._symbolData={...t},this.indexToPrice=(0,P.makePriceIndexToPriceConverter)(t.minTick,t.variableMinTickData),this.priceToIndex=(0,P.makePriceToPriceIndexConverter)(t.minTick,t.variableMinTickData)}setContainer(t){if(this._container===t)return;this._container&&(this.resetView(),this._container.innerHTML=""),this._container=t,this._viewPool=new V(this._handlers),this._viewAllocated=new Map
;const e=this._listContainer=document.createElement("div");e.className=C["tv-dom-widget-main__anchor"],t.append(e);const i=this._dragShield=document.createElement("div");i.className=`${C["tv-dom-widget-main__drag-shield"]} js-hidden`,t.append(i),this._repaintScheduled=!1,this.scheduleRepaint()}setHeight(t){t!==this.height&&(this.height=t,this.checkAutoCenter(),this.scheduleRepaint())}shiftTopIndexRelativeToIndex(t,e){this._setTopIndex(t+e)}handlerKey(t){let e=this.topIndex;this._canIndexBeDisplayed(e)||(e=this.correctIndex(e,-1));const i=this.correctIndex(e,1-this.height);if(!isFinite(i))return;const s=this._viewAllocated;for(const[,e]of s)e&&e.handlerKey(t)}correctIndex(t,e=0){const i=t+e;if(!this._hasQuotes())return i;const s=this._showPricesWith.zeroVolume.value(),o=this._showPricesWith.spread.value();return s&&o?i:s&&!o?F([[this._bestAskIndex,this._bestBidIndex]],i):!s&&o?F([this._cellIndexesInAskZone,this._cellIndexesInBidZone],i):s||o?i:F([(new Array).concat(this._cellIndexesInAskZone,this._cellIndexesInBidZone)],i)}centerOnLast(){this.autoCenterRequired.setValue(!1);const t=this._autoCenterTargetTopIndex();isFinite(t)&&this._setTopIndex(t)}guessOrderType(t,e){const i=this.priceToIndex(t);if(!isFinite(t))return null;if(1!==e&&-1!==e)return null;let s=this._bestAskIndex,o=this._bestBidIndex;return isFinite(s)||(s=o+1),isFinite(o)||(o=s-1),isFinite(s)||isFinite(o)||(s=o=this._lastPriceIndex),1===e?i&&i<s?1:3:i&&i>o?1:3}updateData(t){this._indexes.forEach((t=>{isFinite(this._asks[t])||delete this._asks[t],isFinite(this._bids[t])||delete this._bids[t]}));let e=!1;if(t.snapshot){const t=0===Object.keys(this._asks).length&&0===Object.keys(this._bids).length;e=!this._showPricesWith.zeroVolume.value()&&!this._showPricesWith.spread.value()&&t,this.resetData()}let i=!1;if(t.bids)for(let e=0;e<t.bids.length;e++){const s=(0,l.ensureDefined)(t.bids[e]),o=this.priceToIndex(s.price),r=s.volume,n=this._bids[o]||null;n!==r&&(i=!0,r>0?(this._totalVolumeBid+=r-Number(n),this._bids[o]=r):(this._totalVolumeBid-=Number(n),delete this._bids[o]),this._invalidatedBid[o]=!0)}if(t.asks)for(let e=0;e<t.asks.length;e++){const s=(0,l.ensureDefined)(t.asks[e]),o=this.priceToIndex(s.price),r=s.volume,n=this._asks[o]||null;n!==r&&(i=!0,r>0?(this._totalVolumeAsk+=r-Number(n),this._asks[o]=r):(this._totalVolumeAsk-=Number(n),delete this._asks[o]),this._invalidatedAsk[o]=!0)}if(this._collectIndexes(),!this._hasDataInDOM()){if(i=!0,0!==t.bids.length){const e=this.priceToIndex(t.bids[0].price);this._bids[e]=Number.POSITIVE_INFINITY}if(0!==t.asks.length){const e=this.priceToIndex(t.asks[0].price);this._asks[e]=Number.POSITIVE_INFINITY}this._collectIndexes()}i&&this._recalcDepthInfo(),this._recalcMaxVolume(),e?this.centerOnLast():this.checkAutoCenter(),this._dynamicModeState&&this.centerOnLast(),this.scheduleRepaint()}totalVolumeBid(){return this._totalVolumeBid}totalVolumeAsk(){return this._totalVolumeAsk}buyOrdersValue(){return this._buyOrdersValue}sellOrdersValue(){return this._sellOrdersValue}buyInactiveOrdersValue(){
return this._buyOrdersValueInactive}sellInactiveOrdersValue(){return this._sellOrdersValueInactive}buyOrdersQuantity(){return this._numericFormatter.format(this._buyOrdersQuantity)}sellOrdersQuantity(){return this._numericFormatter.format(this._sellOrdersQuantity)}updateOrders(t){this.resetOrders();for(let e=0;e<t.length;e++){const i=t[e],s=6===i.status;if(1===i.side?(this._buyOrdersValue+=Number(s),this._buyOrdersValueInactive+=Number(!s),this._buyOrdersQuantity+=s?i.qty:0):(this._sellOrdersValue+=Number(s),this._sellOrdersValueInactive+=Number(!s),this._sellOrdersQuantity+=s?i.qty:0),i.stopPrice){const t=this.priceToIndex(i.stopPrice);this._orders[t]||(this._orders[t]=[]),this._orders[t].push({order:i,pricePropertyName:"stopPrice"}),this._invalidatedOrders[t]=!0}if(void 0!==i.limitPrice){const t=this.priceToIndex(i.limitPrice);this._orders[t]||(this._orders[t]=[]),this._orders[t].push({order:i,pricePropertyName:"limitPrice"}),this._invalidatedOrders[t]=!0}}this._recalcDepthInfo(),this.scheduleRepaint()}updateLast(t){const e=this.priceToIndex(t);e!==this._lastPriceIndex&&(this._invalidatedPriceHighlight[this._lastPriceIndex]=!0,this._invalidatedPriceHighlight[e]=!0,this._lastPriceIndex=e,this.checkAutoCenter(),this.scheduleRepaint())}updatePosition(t){if(void 0===t||0===t.qty)return void this.resetPosition();const e=this.priceToIndex(t.avgPrice),i=Math.abs(t.qty)*(1===t.side?1:-1);this._positionIndex===e&&this._positionQty===i||(this._invalidatedPriceHighlight[this._positionIndex]=!0,this._invalidatedPriceHighlight[e]=!0,this._positionIndex=e,this._positionQty=i,this.scheduleRepaint())}resetOrderGhost(){this._orderGhost&&(this._invalidatedOrders[this._orderGhost.index]=!0,this._invalidatedOrders[this._orderGhost.originIndex]=!0,this._orderGhost=null,this.scheduleRepaint())}setOrderGhost(t){const{order:e,pricePropertyName:i,price:s}=t;this.resetOrderGhost();const o=this.priceToIndex(s);isFinite(o)&&(this._orderGhost={ghost:!0,order:e,pricePropertyName:i,price:s,index:o,originIndex:this.priceToIndex(e[i])},this._invalidatedOrders[o]=!0,this.scheduleRepaint())}setDragShield(t,e){this._dragShield&&(this._dragShield.classList.toggle("js-hidden",!t),this._dragShield.classList.toggle(C["tv-dom-widget-main__drag-shield--order"],e))}scheduleRepaint(){this._repaintScheduled||this._symbolData&&(requestAnimationFrame((()=>this.repaint())),this._repaintScheduled=!0)}formatVolume(t){return null===this._symbolData?String(t):this._symbolData.volumeFormatter.format(t)}repaint(){if(this._repaintScheduled=!1,!this._listContainer)return;if(null===this._viewPool)return;const t=this.topIndex,e=this.correctIndex(t,1-this.height);if(isFinite(e)){for(;this._viewsList.length<this.height;){const t=this._viewPool.allocate();this._listContainer.append(t.element),this._viewsList.push(t)}for(;this._viewsList.length>this.height;){const t=(0,l.ensureDefined)(this._viewsList.pop());t.element.remove(),this._viewPool.free(t)}this._oldViewAllocated=this._viewAllocated,this._viewAllocated=new Map;for(let e=0;e<this._viewsList.length;e++){
const i=this.correctIndex(t,-e),s=this._viewsList[e];this._viewAllocated.set(i,s),this._updateRow(i)}this._updateOffscreenIndexLocation(this._lastPriceIndex,t,e);for(const t in this._invalidatedBid)this._invalidatedBid.hasOwnProperty(t)&&delete this._invalidatedBid[t];for(const t in this._invalidatedAsk)this._invalidatedAsk.hasOwnProperty(t)&&delete this._invalidatedAsk[t];for(const t in this._invalidatedPriceHighlight)this._invalidatedPriceHighlight.hasOwnProperty(t)&&delete this._invalidatedPriceHighlight[t];for(const t in this._invalidatedOrders)this._invalidatedOrders.hasOwnProperty(t)&&delete this._invalidatedOrders[t]}}typePrice(t){return t>=this._bestAskIndex?"ask":t<=this._bestBidIndex?"bid":void 0}toggleDynamicModeState(){return this._dynamicModeState=!this._dynamicModeState,this._dynamicModeState}getDynamicModeState(){return this._dynamicModeState}checkAutoCenter(){isFinite(this.topIndex)||this.centerOnLast();const t=this.topIndex,e=this.correctIndex(this.topIndex,1-this.height);let i;i=isFinite(this._bestBidIndex)?this._bestBidIndex:isFinite(this._bestAskIndex)?this._bestAskIndex:isFinite(this._lastPriceIndex)?this._lastPriceIndex:NaN;let s=NaN;isFinite(this._bestAskIndex)?s=this._bestAskIndex:isFinite(this._bestBidIndex)?s=this._bestBidIndex:isFinite(this._lastPriceIndex)&&(i=this._lastPriceIndex);let o=!1;(s+3>t||i-3<e)&&this.topIndex!==this._autoCenterTargetTopIndex()&&(o=!0),this.autoCenterRequired.setValue(o)}isSpread(t){return this._bestAskIndex>t&&t>this._bestBidIndex}getOffscreenIndexLocationObservable(){return this._offscreenIndexLocation$.asObservable()}_hasDataInDOM(){return 0!==this._indexes.length}_updateOffscreenIndexLocation(t,e,i){isFinite(this._lastPriceIndex)&&(t>e?this._offscreenIndexLocation$.next(s.Higher):t<i?this._offscreenIndexLocation$.next(s.Lower):this._offscreenIndexLocation$.next(s.Inside))}_hasQuotes(){return this._indexes.length>1}_collectIndexes(){this._indexes=Object.keys(Object.assign({},this._asks,this._bids))}_recalcDepthInfo(){const t=Object.keys(this._asks).reduce(q,[]).sort(A),e=Object.keys(this._bids).reduce(q,[]).sort(A),i=Object.keys(this._orders).reduce(q,[]).sort(A);this._worstAskIndex=t[0],this._bestAskIndex=t[t.length-1],this._bestBidIndex=e[0],this._worstBidIndex=e[e.length-1];const s=[],o=[];for(const t of i)t<=this._worstAskIndex&&t>=this._bestAskIndex&&void 0===this._asks[t]&&s.push(t),t<=this._bestBidIndex&&t>=this._worstBidIndex&&void 0===this._bids[t]&&o.push(t);this._cellIndexesInAskZone=E(t,s),this._cellIndexesInBidZone=E(e,o)}_updateRow(t){var e;if(!this._symbolData)return;const s=this._oldViewAllocated,r=this._viewAllocated;let n=r.get(t);this._viewPool&&!n&&(n=this._viewPool.allocate(),r.set(t,n));const a=this._orderGhost;if(s&&s.get(t)!==r.get(t)){const e=this.indexToPrice(t);n.updatePrice(e),n.updatePriceText(this._symbolData.priceFormatter.format(e))}n.paintPrice(this.typePrice(t)),this._asks[t]&&this._asks[t]!==Number.POSITIVE_INFINITY?n.updateAskVolume(this.formatVolume(this._asks[t])):n.updateAskVolume(""),
n.updateAskLabels(t<this._bestAskIndex),this._bids[t]&&this._bids[t]!==Number.POSITIVE_INFINITY?n.updateBidVolume(this.formatVolume(this._bids[t])):n.updateBidVolume(""),n.setHigherThanBid(t>this._bestBidIndex),n.updateAskMeter(this._asks[t]===Number.POSITIVE_INFINITY?100:this._asks[t]/this._currentVolumeMax||0),n.updateBidMeter(this._bids[t]===Number.POSITIVE_INFINITY?100:this._bids[t]/this._currentVolumeMax||0);const l=t===this._lastPriceIndex,d=t===this._positionIndex?this._positionQty:0;n.updatePriceHighlight(l,d);let c,u,h=this._orders[t]||[];null!==a&&(a.index===t&&(a.originIndex!==t?h=h.concat(a):u=a.order.id),a.index!==t&&a.originIndex!==t||(c=a.order.side));const _=null===(e=this._realtimeProvider.activeBroker())||void 0===e?void 0:e.metainfo().configFlags;for(let t=0;t<h.length;t++){const e=h[t],s=e.order,r=s.filledQty||0;switch(e.inactive=6!==s.status||4===s.type&&"limitPrice"===e.pricePropertyName,e.isModifiable=void 0!==_&&(0,p.isModifyOrderSupported)(s,_),e.isMovable=void 0!==_&&(0,p.isMoveOrderSupported)(s,_),e.isCancellable=!0,s.type){case 2:e.typeText=o.t(null,void 0,i(359758)),e.type="market";break;case 1:e.typeText=s.parentId?o.t(null,void 0,i(885242)):o.t(null,void 0,i(398157)),e.type="limit";break;case 3:e.typeText=s.parentId?o.t(null,void 0,i(154852)):o.t(null,{context:"order"},i(7122)),e.type="stop";break;case 4:e.typeText=o.t(null,void 0,i(900853)),e.type="stoplimit";break;default:e.typeText=""}e.qty=this._symbolData.quantityFormatter.format(s.qty-r),e.buy=1===s.side,e.noCollapse=s.side===c,e.highlighted=null!==a&&void 0!==u&&s.id===u&&a.pricePropertyName===e.pricePropertyName}n.updateOrders(h)}_setTopIndex(t){t!==this.topIndex&&(this.topIndex=t,this.checkAutoCenter()),this.scheduleRepaint()}_canIndexBeDisplayed(t){const e=this._showPricesWith.zeroVolume.value(),i=this._showPricesWith.spread.value();if(e&&!this.isSpread(t))return!0;if(i&&this.isSpread(t))return!0;const s=t===this._lastPriceIndex,o=t===this._positionIndex,r=this._bids.hasOwnProperty(t)||this._asks.hasOwnProperty(t),n=t<=this._worstBidIndex||this._worstAskIndex<=t,a=this._orders[t]||[],l=this._orderGhost&&this._orderGhost.index===t;return o||s||l||n||r||0!==a.length}_getGapMiddleIndex(){let t=this._bestAskIndex,e=this._bestBidIndex;return isFinite(t)||(t=e),isFinite(e)||(e=t),Math.floor((e+t)/2)}_autoCenterTargetTopIndex(){const t=Math.floor(this.height/2);return this._showPricesWith.zeroVolume.value()&&this._showPricesWith.spread.value()?this._getCenterIndex()+t:this._getCorrectCenterIndex()+t}_getCorrectCenterIndex(){var t,e;const i=this._getCenterIndex(),s=null!==(t=this._bestAskIndex)&&void 0!==t?t:i,o=null!==(e=this._worstAskIndex)&&void 0!==e?e:i;let r=i;if(!this._showPricesWith.zeroVolume.value()){r=i+o-s-1-(this._cellIndexesInAskZone.length-1>=0?this._cellIndexesInAskZone.length-1:0)+1}return this._showPricesWith.spread.value()||(r+=s-i),r}_getCenterIndex(){const t=this._getGapMiddleIndex()
;return isFinite(t)?t:isFinite(this._bestBidIndex)?this._bestBidIndex:isFinite(this._bestAskIndex)?this._bestAskIndex:isFinite(this._lastPriceIndex)?this._lastPriceIndex:NaN}_recalcMaxVolume(){let t=0;for(const e in this._asks)this._asks.hasOwnProperty(e)&&(t=Math.max(this._asks[e],t));for(const e in this._bids)this._bids.hasOwnProperty(e)&&(t=Math.max(this._bids[e],t));t!==this._currentVolumeMax&&(this._currentVolumeMax=t)}_recalcBestWorstBid(){let t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY;for(const i in this._bids)this._bids.hasOwnProperty(i)&&(+i>t&&(t=+i),+i<e&&(e=+i));this._bestBidIndex=t,this._worstBidIndex=e}_recalcBestWorstAsk(){let t=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;for(const i in this._asks)this._asks.hasOwnProperty(i)&&(+i<t&&(t=+i),+i>e&&(e=+i));this._bestAskIndex=t,this._worstAskIndex=e}}class H{constructor(t){this._symbolData=null,this._calculatePLUsingLast=!1,this._hasLotSize=new r.WatchedValue(!1),this._plState=new S.Subject,this._positionState=new S.Subject,this.changePLViewType=()=>{switch(this._displayProfitState){case 2:this._displayProfitState=1;break;case 0:this._displayProfitState=2;break;case 1:this._displayProfitState=0}d.setValue(b.settingsKeys.PROFIT_VIEW_TYPE,this._displayProfitState),this.updatePL()},this.compareQty=()=>{var t;const e=Math.abs(Number(null===(t=this._position)||void 0===t?void 0:t.qty));e>0&&isFinite(e)&&this.qty.setValue(e)},this.plState$=this._plState.asObservable(),this.positionState$=this._positionState.asObservable(),this._handlers=t||{},this._numericFormatter=new T.NumericFormatter,this._displayProfitState=d.getJSON(b.settingsKeys.PROFIT_VIEW_TYPE,2),this.reset(),this._integerFormatter=new T.NumericFormatter(0),this._oneDecimalFormatter=new T.NumericFormatter(1),this.qty=new r.WatchedValue(1),this.qty.subscribe((t=>this._handlers.qtyChange.call(null,t))),this._qtyProperties=new r.WatchedValue({min:1,step:1,max:1,format:null})}reset(){this._position=void 0,this._pl=void 0,this._lastPrice=void 0,this._bid=void 0,this._ask=void 0,this._symbolData=null,this._updatePositionState(null,null),this._updatePLState(null,null)}setBrokerConfigFlags(t){this._calculatePLUsingLast=t.calculatePLUsingLast}setSymbolInfo(t){const{qtyProperties:e}=t;this._symbolData=t,this._qtyProperties.setValue({min:e.min,step:e.step,uiStep:e.uiStep,max:e.max,format:this._numericFormatter})}getQtyProperties(){return this._qtyProperties}updatePosition(t){if(this._position=t,void 0===this._position||0===this._position.qty||null===this._symbolData)return void this._updatePositionState(null,null);const{qty:e,avgPrice:i,side:s}=this._position,o=this._symbolData.priceFormatter.format(i),r=Math.abs(e),n=this._symbolData.volumeFormatter.format(r);this._updatePositionState(`${n} @ ${o}`,s)}updatePL(t){if(void 0!==t&&(this._pl=t),void 0===this._position)return void this._updatePLState(null,null);const{side:e,avgPrice:i}=this._position,s=-1===e,o=this._calculatePLUsingLast?this._lastPrice:s?this._ask:this._bid;if(void 0===o){
if(void 0===this._pl||2!==this._displayProfitState)this._updatePLState(null,null);else{const t=this._pl>=0?1:2;this._updatePLState(this._makePlText(),t)}return}const r=(o-i)*(s?-1:1),n=r>0?1:2;switch(this._displayProfitState){case 0:const t=this._calculatePLPercentage(i,r);this._updatePLState(t,n);break;case 1:const e=this._makePipsText(r);this._updatePLState(e,n);break;case 2:this._updatePLState(this._makePlText(),n)}}updateLast(t,e,i){this._lastPrice=t,this._bid=e,this._ask=i,this.updatePL()}bid(){return this._bid}ask(){return this._ask}setHasLotSize(t){this._hasLotSize.setValue(t)}hasLotSize(){return this._hasLotSize.readonly()}_calculatePLPercentage(t,e){const i=e/t;return isFinite(i)?(100*i).toFixed(2)+"%":null}_makePipsText(t){if(null===this._symbolData)return null;const{pipSize:e,minTick:s}=this._symbolData,r=isFinite(e)&&e!==s?this._oneDecimalFormatter:this._integerFormatter,n=parseFloat(r.format(t/(e||s)));return isFinite(n)?o.t(null,{replace:{pips:String(n)}},i(207218)):null}_makePlText(){var t;if(void 0===this._pl)return null;const e=this._pl.toFixed(2);return void 0!==(null===(t=this._symbolData)||void 0===t?void 0:t.positionCurrency)?`${e} ${this._symbolData.positionCurrency}`:e}_updatePositionState(t,e){this._positionState.next({positionText:t,side:e})}_updatePLState(t,e){this._plState.next({plText:t,tradeDirection:e})}}class z{constructor(t,e,i){this._expiresAt=0,this._delay=t,this._doneCb=e,this._progressCb=i}run(){if(this._timeoutId)return;const t=Date.now?Date.now():+new Date;this._expiresAt=t+this._delay,this._timeoutId=window.setTimeout((()=>{this.abort(),this._doneCb()}),this._delay),this._trackProgressScheduled||this._trackProgress()}revert(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=void 0,this.run())}abort(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=void 0,this._expiresAt=0,this._progressCb&&this._progressCb(0))}setWindow(t){this._wnd=t}_trackProgress(){if(this._trackProgressScheduled=!1,!this._progressCb||!this._timeoutId)return;const t=Date.now?Date.now():+new Date;let e=1-(this._expiresAt-t)/this._delay;e=Math.max(Math.min(e,1),0),this._progressCb(e),this._wnd&&this._wnd.requestAnimationFrame?this._wnd.requestAnimationFrame((()=>{this._trackProgress()})):window.setTimeout((()=>{this._trackProgress()}),40),this._trackProgressScheduled=!0}}var U=i(466052);class W{constructor(){this._customFieldsCount=new r.WatchedValue(0),this._currentValuesSummaryLine=new r.WatchedValue(""),this._onCustomFieldsUpdate=new U.Delegate,this._selectedComboBoxValues=new Map,this._checkboxFieldsStates=new Map,this._comboBoxItems=new r.WatchedValue([]),this._checkboxFields=new r.WatchedValue([]),this._rewriteDisplayedSelectedItems=()=>{const t=[...this._getSelectedComboBoxItemsNames(),...this._getCheckedCheckboxFieldsTitles()],e=this._getCurrentDurationName();void 0!==e&&t.push(e);const i=t.join(", ");this._currentValuesSummaryLine.setValue(i)},this._getSelectedComboBoxItemsNames=()=>{const t=[];for(const e of this._comboBoxItems.value()){const i=(0,
l.ensureDefined)(this._selectedComboBoxValues.get(e.id)).value(),s=e.items.find((t=>t.value===i));t.push((0,l.ensureDefined)(s).text)}return t},this._recountCustomFields=()=>{var t;let e=void 0!==this._currentDuration?1:0;void 0!==(null===(t=this._currentDuration)||void 0===t?void 0:t.datetime)&&e++,this._customFieldsCount.setValue(this._comboBoxItems.value().length+this._checkboxFields.value().length+e)},this._recountCustomFields()}setCustomFields(t){const e=[],i=[],s=new Map,o=new Map;t.forEach((t=>{if("ComboBox"===t.inputType){const i=this._selectedComboBoxValues.get(t.id);if(void 0!==i)this._selectedComboBoxValues.delete(t.id),s.set(t.id,i),i.setValue(t.items[0].value);else{const e=new r.WatchedValue(t.items[0].value);s.set(t.id,e),e.subscribe(this._rewriteDisplayedSelectedItems)}e.push(t)}if("Checkbox"===t.inputType){const e=this._checkboxFieldsStates.get(t.id);if(void 0!==e)this._checkboxFieldsStates.delete(t.id),o.set(t.id,e),e.setValue(t.value);else{const e=new r.WatchedValue(t.value);o.set(t.id,e),e.subscribe(this._rewriteDisplayedSelectedItems)}i.push(t)}})),this._selectedComboBoxValues.forEach((t=>t.unsubscribe(this._rewriteDisplayedSelectedItems))),this._selectedComboBoxValues=s,this._checkboxFieldsStates.forEach((t=>t.unsubscribe(this._rewriteDisplayedSelectedItems))),this._checkboxFieldsStates=o,this._comboBoxItems.setValue(e),this._checkboxFields.setValue(i),this._rewriteDisplayedSelectedItems(),this._recountCustomFields(),this._onCustomFieldsUpdate.fire()}comboBoxItems(){return this._comboBoxItems.readonly()}getSelectedComboBoxValues(){return this._selectedComboBoxValues}checkboxFields(){return this._checkboxFields.readonly()}getCheckboxFieldsStates(){return this._checkboxFieldsStates}getCustomFieldsCount(){return this._customFieldsCount.value()}currentValuesSummaryLine(){return this._currentValuesSummaryLine.readonly()}setDurationsInfo(t,e){void 0!==e&&(this._durationsMetaInfo=e),this._currentDuration=t,this._rewriteDisplayedSelectedItems(),this._recountCustomFields()}_getCheckedCheckboxFieldsTitles(){const t=[];for(const e of this._checkboxFields.value()){(0,l.ensureDefined)(this._checkboxFieldsStates.get(e.id)).value()&&t.push(e.title)}return t}_getCurrentDurationName(){var t,e;const i=null===(t=this._currentDuration)||void 0===t?void 0:t.type,s=null===(e=this._durationsMetaInfo)||void 0===e?void 0:e.find((t=>t.value===i));return null==s?void 0:s.name}}var Q=i(661851),R=i(72571),j=i(497754),G=i(901317),Y=i(297265),X=i(587374),J=i(613977),Z=i(657947);function K(t){const{currentDuration:e,durationMetaInfoList:i,onDurationChanged:s}=t;return n.createElement(Z.DurationControl,{currentDuration:e,durationMetaInfoList:i,onDurationChanged:s})}var tt=i(219630),et=i(488263),it=i(611902);function st(t){const e=t.domDetails,[s,r]=(0,G.useWatchedValue)(t.openState),a=(0,Y.useWatchedValueReadonly)({watchedValue:t.currentDuration}),d=(0,Y.useWatchedValueReadonly)({watchedValue:t.durationMetaInfoList}),c=(0,Y.useWatchedValueReadonly)({watchedValue:e.currentValuesSummaryLine()}),u=(0,Y.useWatchedValueReadonly)({
watchedValue:e.comboBoxItems()}),h=(0,Y.useWatchedValueReadonly)({watchedValue:e.checkboxFields()}),_=t.onDurationChanged,m=e.getSelectedComboBoxValues(),p=e.getCheckboxFieldsStates();return n.createElement(n.Fragment,null,n.createElement("div",{className:tt.headerWrapper},n.createElement("div",{className:tt.header,onClick:()=>r(!s)},n.createElement("div",{className:j(tt.textBlock,tt.summaryLine)},n.createElement("span",{className:tt.upperCase},o.t(null,void 0,i(557027))+": "),c),n.createElement("div",{className:tt.arrow},n.createElement(R.Icon,{icon:s?et:it})))),s&&n.createElement(n.Fragment,null,n.createElement("div",null,u.length>0&&m.size>0&&n.createElement(n.Fragment,null,u.map((t=>{const e=(0,l.ensureDefined)(m.get(t.id));return n.createElement("div",{key:t.id,className:tt.customField},n.createElement(X.CustomComboboxContainer,{title:t.title,items:t.items,selectedItem:e,forceUserToSelectValue:!1,alwaysShowAttachedErrors:!1}))}))),h.length>0&&p.size>0&&n.createElement(n.Fragment,null,h.map((t=>n.createElement("div",{key:t.id,className:tt.customField},n.createElement(J.CheckboxCustomField,{title:t.title,help:t.help,checked:(0,l.ensureDefined)(p.get(t.id))}))))),n.createElement("div",{className:tt.duration},void 0!==a&&void 0!==d&&n.createElement(K,{currentDuration:a,durationMetaInfoList:d,onDurationChanged:_})))))}var ot=i(587125),rt=i(99708),nt=i(49217);function at(t){const{calcData:e}=t,[s,r]=(0,n.useState)(!1),[a,l]=(0,n.useState)(),[d,c]=(0,n.useState)(e.qty.value()),[u,h]=(0,G.useWatchedValue)(e.qty),_=(0,Y.useWatchedValueReadonly)({watchedValue:e.getQtyProperties()}),m=(0,Y.useWatchedValueReadonly)({watchedValue:e.hasLotSize()})?o.t(null,void 0,i(357653)):o.t(null,void 0,i(125933));return(0,n.useEffect)((()=>{if(u===d)return;const{res:t,msg:e}=(0,rt.checkQtyError)(_,u,!0);t||c(u),r(t),l(e)}),[u,_,d]),n.createElement("div",{className:nt.wrapper},n.createElement("span",{className:nt.title},m),n.createElement(ot.NumberInput,{alwaysUpdateValueFromProps:!0,mode:"float",value:u,onValueChange:t=>h(t),errorHandler:t=>r(t),errorMessage:a,error:s,onBlur:function(){if(d===u)return;h(d)},min:_.min,max:_.max,step:_.step,uiStep:_.uiStep}))}var lt=i(725784),dt=i(288330);const ct=(0,lt.hotKeySerialize)({keys:["Shift","B"],text:"{0} + {1}"}),ut=(0,lt.hotKeySerialize)({keys:["Shift","S"],text:"{0} + {1}"}),ht=o.t(null,void 0,i(102846)),_t=o.t(null,void 0,i(545322));function mt(t){const{uiPlaceOrder:e}=t;return n.createElement("div",{className:j(dt.row,dt.wrapper,dt.marketBlock)},n.createElement("button",{className:j(dt.buttonBuy,"apply-common-tooltip"),"data-tooltip-hotkey":ct,onClick:t=>{t.preventDefault(),e({type:2,side:1})}},ht),n.createElement("button",{className:j(dt.buttonSell,"apply-common-tooltip"),"data-tooltip-hotkey":ut,onClick:t=>{t.preventDefault(),e({type:2,side:-1})}},_t))}function pt(t,e){return e?{title:t}:{"data-tooltip":t}}var vt=i(118096);const gt={plText:null,tradeDirection:1},bt={positionText:null,side:1},wt=o.t(null,void 0,i(381617)),yt=o.t(null,void 0,i(110649));function ft(t){
const{plText:e,tradeDirection:i}=(0,Q.useObservable)(t.plState,gt),{positionText:s,side:o}=(0,Q.useObservable)(t.positionState,bt),r=null!==s,a=j(vt.button,vt.pl,r&&(1===i?vt.profit:vt.loss),"apply-common-tooltip"),l=j(vt.button,vt.position,r&&(1===o?vt.buy:vt.sell),"apply-common-tooltip");return n.createElement("div",{className:vt.wrapper},n.createElement("button",{className:l,disabled:!r,onClick:t.compareQty,...pt(wt,!r)},null!=s?s:"—"),n.createElement("button",{className:a,disabled:!r,onClick:t.changePLViewType,...pt(yt,!r)},null!=e?e:"—"))}const kt=o.t(null,void 0,i(323288)),xt=o.t(null,void 0,i(963867)),It=o.t(null,void 0,i(224186)),Pt=o.t(null,void 0,i(975336)),St=o.t(null,void 0,i(987411)),Tt=o.t(null,void 0,i(843065));function Dt(t){const e=t.isPositionBlocked||!t.isTradable||!t.hasPosition||!t.hasFlatten,i=!t.isTradable||!(t.hasBuyOrders||t.hasSellOrders),s=t.isPositionBlocked||!t.isTradable||!t.hasPosition||!t.hasReverse;return n.createElement("div",{className:j(dt.row,dt.wrapper,dt.tradingActionBlock)},n.createElement("button",{className:j(dt.buttonOrdinary,"apply-common-tooltip"),disabled:e,onClick:e=>{e.preventDefault(),t.uiClosePosition()},...pt(St,e)},xt),n.createElement("button",{className:j(dt.buttonOrdinary,"apply-common-tooltip"),title:Pt,disabled:i,onClick:e=>{e.preventDefault(),t.uiCancelAllOrders()},...pt(Pt,i)},kt),n.createElement("button",{className:j(dt.buttonOrdinary,"apply-common-tooltip"),title:Tt,disabled:s,onClick:e=>{e.preventDefault(),t.uiReversePosition()},...pt(Tt,s)},It))}var Ot=i(288617);function Ct(t){const{uiState$:e,warningMessage$:i,domDetailsDropdownProps:s,domNumberContainerProps:o,domMarketActionBlockProps:r,tradingActionBlockControllers:a,domCalcBlockProps:l}=t,d=(0,Q.useObservable)(e,{isTradable:!1,isPositionBlocked:!1,hasPosition:!1,hasBuyOrders:!1,hasSellOrders:!1,qty:1,gtcOrder:!1,hasFlatten:!1,hasReverse:!1}),c=s.domDetails.getCustomFieldsCount();return n.createElement("div",{className:Ot.container},n.createElement(ft,{...l}),n.createElement(Dt,{...a,...d}),n.createElement(at,{...o}),n.createElement(mt,{...r}),d.isTradable&&0!==c&&n.createElement(st,{...s}),!1)}var Nt=i(336330),Vt=i(896712),Bt=(i(825961),i(947161)),Mt=i(11728),Lt=i(781957),Et=i(943145);function Ft(t,e){return`${b.settingsKeys.DOM_DURATION}${t}.${e}`}const At={1:"LIMIT",2:"MARKET",3:"STOP",4:"STOPLIMIT"};function qt(t){var e,i;return t instanceof MouseEvent?t.pageY:null!==(i=null===(e=t.touches[0])||void 0===e?void 0:e.pageY)&&void 0!==i?i:0}class $t{constructor(t,e,s,n,a,l){var c;this.delayedData=new r.WatchedValue(!1),this.isBats=new r.WatchedValue(!1),this._container=null,this._warning=null,this._mainBlock=null,this._svgTimerPath=null,this._noDataNoticeBlock=null,this._totalVolumeBidTextNode=null,this._totalVolumeAskTextNode=null,this._countVolumeBuyTextNode=null,this._countVolumeSellTextNode=null,this._countVolumeBid=null,this._countVolumeAsk=null,this._subscription=null,this._noDataTimeout=null,this._actionMarketButtons=null,this._actionPositionButtons=null,this._navButtons=null,
this._currentDuration=new r.WatchedValue,this._durationMetaInfoList=new r.WatchedValue,this._viewTotalVolumeScheduled=!1,this._detailsOpenState=new r.WatchedValue(!1),this._csxAllTitle=o.t(null,void 0,i(975336)),this._flattenTitle=o.t(null,void 0,i(987411)),this._reverseTitle=o.t(null,void 0,i(843065)),this._onDurationChanged=t=>{this._currentDuration.setValue(t),this._domDetails.setDurationsInfo(t);const e=this._realtimeProvider.activeBroker();if(null===e)return;const i=Ft(e.metainfo().id,this._tradingLinking.value().symbol);d.setValue(i,t.type)},this._onSuggestedQtyChange=t=>{this._calcData.qty.setValue(t),this._mergeUiState({qty:t})},this._headerState=l,this._visible=e,this._symbolData=null,this._supportedOrderTypes=[2],this._domDetails=new W,this._trading=s,this._qtySuggester=n,this._tradingLinking=a,this._realtimeProvider=this._trading.realtimeProvider();const u=this._handlers(),p={zeroVolume:this._trading.showPricesWith().zeroVolume.readonly(),spread:this._trading.showPricesWith().spread.readonly()};this._content=new $(u,p,this._realtimeProvider),this._calcData=new H(u),this._uiState={isTradable:!1,isPositionBlocked:!1,hasPosition:!1,hasBuyOrders:!1,hasSellOrders:!1,qty:1,gtcOrder:!1,hasFlatten:!1,hasReverse:!1},this._upperBlockResizeObserver=new h.default((t=>{for(const e of t){const t=Math.ceil(e.target.clientHeight/20);this._content.setHeight(t)}})),this._uiState$=new _.BehaviorSubject(this._uiState),this._domSymbolInfo$=new _.BehaviorSubject({symbol:a.value().symbol,brokerName:null===(c=this._realtimeProvider.activeBroker())||void 0===c?void 0:c.metainfo().title}),this.domSymbolInfo$=this._domSymbolInfo$.asObservable(),this.isTradable$=this._uiState$.pipe((0,m.map)((({isTradable:t})=>t))),this._timerLockState={},this._timer=new z(2e3,(()=>{this._content.centerOnLast()}),(t=>{this._updateTimerUi(t)})),this._content.autoCenterRequired.subscribe((t=>{this._mergeTimerLockState({autoCenterRequired:t})})),t.subscribe((t=>this._recreateLayout(t)),{callWithLast:!0}),this._tradingLinking.valueObservable().subscribe((({warning:t})=>{var e;this._onStateChange(),this._updateDetails(),null===(e=this._warningMessage$)||void 0===e||e.next(t)})),this._realtimeProvider.onStatusChanged.subscribe(null,(()=>{this._onStateChange(),this._updateDetails()})),e.subscribe((()=>{var t;this._onStateChange(),null===(t=this._warningMessage$)||void 0===t||t.next(this._warningMessage$.getValue())})),this._onStateChange(),this._updateDetails()}uiScroll(t){this._content.getDynamicModeState()||(this._content.shiftTopIndexRelativeToIndex(this._content.topIndex,0|t),this._timer.revert())}uiCenter(){this._content.centerOnLast(),this._trackEvent("Center")}uiCancelOrder(t){this._uiState.isTradable&&null!==t&&((0,l.ensureNotNull)(this._trading.brokerCommandsUI()||null).cancelOrder(t),this._trackEvent("Cancel Order"))}uiModifyOrder(t,e=null){if(!t||!this._uiState.isTradable||void 0===this._configFlags||!(0,p.isModifyOrderSupported)(t,this._configFlags))return Promise.resolve();let i=!0;null===e&&(e={},i=!1);const s=(0,
l.ensureNotNull)(this._trading.brokerCommandsUI()||null).modifyOrder({...t,...e},i,void 0,!0);return this._lockTimerUntilSettled(s),this._trackEvent("Modify Order"),Promise.resolve()}uiPlaceOrder({side:t,type:e,price:i=NaN,altPrice:s=NaN}){var o;if(!this._realtimeProvider.activeBroker())return void this._trading.toggleTradingWidget().then((()=>{this._trading.onNeedSelectBroker.fire()}));if(!(null===(o=this._subscription)||void 0===o?void 0:o.broker))return void this._trading.toggleTradingWidget();if(2!==e&&!isFinite(i))return;null===e&&(e=this._content.guessOrderType(i,t));let r=!0;if(null===e&&(r=!1,e=1),!this._isOrderTypeSupported(e))return;const n={};for(const[t,e]of this._domDetails.getSelectedComboBoxValues())n[t]=e.value();for(const[t,e]of this._domDetails.getCheckboxFieldsStates())n[t]=e.value();const a=this._calcData.ask(),d=this._calcData.bid(),c=1===t?a:d,u={symbol:this._tradingLinking.value().symbol,qty:this._calcData.qty.value(),side:t,type:e,seenPrice:null!=c?c:null,duration:this._currentDuration.value(),customFields:n};void 0!==a&&void 0!==d&&(u.currentQuotes={ask:a,bid:d}),3===u.type&&(u.stopPrice=i),1===u.type&&(u.limitPrice=i),4===u.type&&(u.stopPrice=i,isFinite(s)?u.limitPrice=s:r=!1),this._lockTimerUntilSettled((0,l.ensureNotNull)(this._trading.brokerCommandsUI()||null).placeOrder(u,r,!0)),this._trackEvent("Place Order",At[e])}uiCancelAllOrders(t){const e=this._uiState;if(!e.isTradable||!e.hasBuyOrders&&!e.hasSellOrders||1===t&&!e.hasBuyOrders||-1===t&&!e.hasSellOrders)return Promise.resolve();const i=(0,l.ensureNotNull)(this._trading.brokerCommandsUI()||null).cancelOrders(this._tradingLinking.value().symbol,t);return this._lockTimerUntilSettled(i),t?this._trackEvent("Cancel All "+(1===t?"Buy":"Sell")+" Orders"):this._trackEvent("Cancel All Orders"),Promise.resolve()}async uiClosePosition(){if(this._uiState.isPositionBlocked||!this._uiState.isTradable||!this._uiState.hasPosition||!this._uiState.hasFlatten)return;const t=this._realtimeProvider.activeBroker();if(!t)return;this._mergeUiState({isPositionBlocked:!0});const e=t.positions(this._tradingLinking.value().symbol).then((t=>{for(const e of t)if(0!==e.qty)return(0,l.ensureNotNull)(this._trading.brokerCommandsUI()).closePosition(e.id);return Promise.resolve(!1)})).finally((()=>this._mergeUiState({isPositionBlocked:!1})));this._lockTimerUntilSettled(e),this._trackEvent("Close Position")}async uiReversePosition(){if(this._uiState.isPositionBlocked||!this._uiState.isTradable||!this._uiState.hasPosition||!this._uiState.hasReverse)return;const t=this._realtimeProvider.activeBroker();if(!t)return;this._mergeUiState({isPositionBlocked:!0});const e=t.positions(this._tradingLinking.value().symbol).then((t=>{for(const e of t)if(0!==e.qty)return(0,l.ensureNotNull)(this._trading.brokerCommandsUI()).reversePosition(e.id);return Promise.resolve(!1)})).finally((()=>this._mergeUiState({isPositionBlocked:!1})));this._lockTimerUntilSettled(e),this._trackEvent("Reverse")}uiOrderMousedown(t,e,i){
if(1!==t.buttons||null===e||null===this._mainBlock||null===this._subscription)return;this.uiStopOrderDrag();const s=e[i],o=this._subscription;let r=NaN;o.orderMouseRoot=document.documentElement,o.orderMousemoveHandler=t=>{if(t.preventDefault(),1!==(t.buttons||t.which)||void 0===this._configFlags||!(0,p.isMoveOrderSupported)(e,this._configFlags))return void this.uiStopOrderDrag();const s=(0,l.ensureNotNull)(this._mainBlock).getBoundingClientRect().y,o=qt(t)-s,n=-Math.floor(o/20),a=this._content.correctIndex(this._content.topIndex,n);r=this._content.indexToPrice(a),this._content.setDragShield(!0,!0),this._mergeTimerLockState({drag:!0}),this._content.setOrderGhost({order:e,pricePropertyName:i,price:r})},o.orderMouseupHandler=()=>{this.uiStopOrderDrag();this._realtimeProvider.activeBroker()&&isFinite(r)&&r!==s&&(this._content.setOrderGhost({order:e,pricePropertyName:i,price:r}),this._content.setDragShield(!0,!0),this._trackEvent("Move Order"),this.uiModifyOrder(e,{[i]:r}).then((()=>this.uiStopOrderDrag())).catch((()=>this.uiStopOrderDrag())))},o.orderMousedownHandler=()=>{this.uiStopOrderDrag()},o.orderMouseRoot.addEventListener("mousemove",o.orderMousemoveHandler),o.orderMouseRoot.addEventListener("mouseup",o.orderMouseupHandler),setTimeout((()=>{const{orderMouseRoot:t,orderMousedownHandler:e}=o;t&&e&&t.addEventListener("mousedown",e)}),0)}uiStopOrderDrag(){if(this._content.setDragShield(!1,!1),this._content.resetOrderGhost(),this._mergeTimerLockState({drag:!1}),!this._subscription)return;const{orderMousemoveHandler:t,orderMouseupHandler:e,orderMousedownHandler:i,orderMouseRoot:s}=this._subscription;delete this._subscription.orderMousemoveHandler,delete this._subscription.orderMouseupHandler,delete this._subscription.orderMousedownHandler,delete this._subscription.orderMouseRoot,s&&t&&s.removeEventListener("mousemove",t),s&&e&&s.removeEventListener("mouseup",e),s&&i&&s.removeEventListener("mousedown",i)}uiContextMenu(t,e,s){if(!this._uiState.isTradable)return;if(1!==e&&-1!==e)return;const r=this._uiState.qty||NaN,n=this._tradingLinking.value().symbol.split(":")[1],a=(0,f.abbreviatedNumber)(r),l=[],d=this._symbolData&&this._symbolData.priceFormatter||new w.PriceFormatter;if(this._trackEvent("Context Menu"),isFinite(s)){const t=d.format(s);if(this._isOrderTypeSupported(3)){const r={stopPrice:t,qty:a,symbol:n};let d="";d=1===e?o.t(null,{replace:r},i(812458)):o.t(null,{replace:r},i(793711));const c=new k.Action({actionId:"Trading.DOMPlaceStopOrder",label:d,onExecute:()=>{this.uiPlaceOrder({side:e,price:s,type:3})}});l.push(c)}if(this._isOrderTypeSupported(1)){const r={limitPrice:t,qty:a,symbol:n};let d="";d=1===e?o.t(null,{replace:r},i(222821)):o.t(null,{replace:r},i(596283));const c=new k.Action({actionId:"Trading.DOMPlaceLimitOrder",label:d,onExecute:()=>{this.uiPlaceOrder({side:e,price:s,type:1})}});l.push(c)}if(this._symbolData&&this._hasStopLimit){const r=(0,P.getMinTick)({minTick:this._symbolData.minTick,price:s,variableMinTickData:this._symbolData.variableMinTickData
}),c=new(u())(r).mul(1===e?1:-1).plus(s).toNumber(),h={stopPrice:t,limitPrice:d.format(c),qty:a,symbol:n};let _="";_=1===e?o.t(null,{replace:h},i(832023)):o.t(null,{replace:h},i(81078));const m=new k.Action({actionId:"Trading.DOMPlaceStopLimitOrder",label:_,onExecute:()=>{this.uiPlaceOrder({side:e,price:s,altPrice:c,type:4})}});l.push(m)}}if(this._isOrderTypeSupported(2)){const t={qty:a,symbol:n};let s="";s=1===e?o.t(null,{replace:t},i(503491)):o.t(null,{replace:t},i(331840));const r=new k.Action({actionId:"Trading.DOMPlaceMarketOrder",label:s,onExecute:()=>{this.uiPlaceOrder({side:e,type:2})}});l.push(r)}l.length&&x.ContextMenuManager.showMenu(l,t,void 0,{menuName:"DOMWidgetContextMenu"})}_recreateLayout(t){null!==this._container&&(this._container.innerHTML="");const e=document.createElement("div"),o=document.createElement("div");this._upperBlockResizeObserver.disconnect(),this._upperBlockResizeObserver.observe(e),e.classList.add(Bt.upperBlock),o.classList.add(Bt.bottomBlock),this._container=t;const r=function(t){const e=document.createElement("span"),o=document.createElement("span");return e.className=`${C["tv-dom-widget-main__offscreen-arrow"]} ${C["tv-dom-widget-main__offscreen-arrow--higher"]} js-hidden`,o.className=`${C["tv-dom-widget-main__offscreen-arrow"]} ${C["tv-dom-widget-main__offscreen-arrow--lower"]} js-hidden`,e.innerHTML=i(355482),o.innerHTML=i(482075),t.append(e),t.append(o),t=>{e.classList.toggle("js-hidden",t!==s.Higher),o.classList.toggle("js-hidden",t!==s.Lower)}}(e);this._content.getOffscreenIndexLocationObservable().subscribe(r),this._createMainBlock(e),this._createNavBlock(o),this._createDOMBottomWidget(o),this._container.append(e),this._container.append(o),this._calcData.reset()}_createMainBlock(t){const e=document.createElement("div");e.className=C["tv-dom-widget-main"],t.append(e);const s=this._warning=document.createElement("div");s.className=`${Nt["tv-dom-panel__warning"]} i-hidden`,s.textContent=o.t(null,void 0,i(180526)),e.append(s),this._content.setContainer(e);let r=0;e.addEventListener("wheel",(t=>{if(t.preventDefault(),!this._content.getDynamicModeState()&&(t.deltaMode!==t.DOM_DELTA_PAGE?r-=(0,v.getPixelsFromEvent)(t).y/100:r-=(0,g.clamp)(t.deltaY,-1,1),Math.abs(r)>=1)){const t=r%1;this.uiScroll(r-t),r=t}}));let n=!1;const a=t=>{if(n)return;const e="touches"in t;if(!e&&1!==(t.buttons||t.which))return;const i=this._content.topIndex;if(!isFinite(i))return;if(e&&1!==t.touches.length)return;if(!(t.target instanceof Element))return;if(!t.target.closest(`.${C["tv-dom-widget-main__value--price"]}`))return;n=!0;const s=qt(t),o=document.documentElement,r=()=>{["mouseup","mousedown","touchend","touchstart","touchcancel"].forEach((t=>o.removeEventListener(t,r))),o.removeEventListener("mousemove",a),o.removeEventListener("touchmove",a),n=!1,this._content.setDragShield(!1,!1),this._mergeTimerLockState({scroll:!1})},a=t=>{if(t.preventDefault(),!this._content.getDynamicModeState()){if(!e&&1!==(t.buttons||t.which))return void r();const o=qt(t)-s,n=Math.round(o/20)
;n&&(this._content.setDragShield(!0,!1),this._mergeTimerLockState({scroll:!0})),this._content.shiftTopIndexRelativeToIndex(i,n)}};o.addEventListener(e?"touchmove":"mousemove",a),o.addEventListener(e?"touchend":"mouseup",r),e&&o.addEventListener("touchcancel",r),setTimeout((()=>{n&&o.addEventListener(e?"touchstart":"mousedown",r)}),0)};e.addEventListener("mousedown",a),e.addEventListener("touchstart",a),e.addEventListener("dblclick",(t=>{if(!(t.target instanceof Element))return;t.target.closest(`.${C["tv-dom-widget-main__value--price"]}`)&&this.uiCenter()})),this._mainBlock=e,document.addEventListener("keydown",(t=>this._content.handlerKey(t)),!1),document.addEventListener("keyup",(t=>this._content.handlerKey(t)),!1)}_createDOMBottomWidget(t){var e;const i=document.createElement("div");t.append(i);const s={domDetails:this._domDetails,currentDuration:this._currentDuration,durationMetaInfoList:this._durationMetaInfoList,onDurationChanged:this._onDurationChanged,openState:this._detailsOpenState},o={calcData:this._calcData},r={uiPlaceOrder:t=>this.uiPlaceOrder(t)},l={uiClosePosition:()=>this.uiClosePosition(),uiCancelAllOrders:()=>this.uiCancelAllOrders(),uiReversePosition:()=>this.uiReversePosition()},d={plState:this._calcData.plState$,positionState:this._calcData.positionState$,changePLViewType:this._calcData.changePLViewType,compareQty:this._calcData.compareQty};!function(t,e){a.render(n.createElement(Ct,{...e}),t)}(i,{uiState$:this._uiState$.asObservable(),warningMessage$:null===(e=this._warningMessage$)||void 0===e?void 0:e.asObservable(),tradingActionBlockControllers:l,domDetailsDropdownProps:s,domNumberContainerProps:o,domMarketActionBlockProps:r,domCalcBlockProps:d})}_createNavBlock(t){const e={on:Lt,off:Et},s=(0,l.ensureNotNull)((0,
I.parseHtmlElement)(`\n\t\t\t<div class="tv-dom-widget-nav-wrapper">\n\t\t\t\t<div class="${Vt["tv-dom-widget-nav"]}">\n\t\t\t\t\t<div class="${Vt["tv-dom-widget-nav__button-block"]} ${Vt["tv-dom-widget-nav__button-block--orders"]}">\n\t\t\t\t\t\t<span class="apply-common-tooltip ${Vt["tv-dom-widget-nav__button"]} ${Vt["tv-dom-widget-nav__button--clear-ask"]} js-clear-ask">\n\t\t\t\t\t\t\t${Mt}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="${Vt["tv-dom-widget-nav_count-volume"]} js-count-volume-buy"></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="${Vt["tv-dom-widget-nav__button-block"]} ${Vt["tv-dom-widget-nav__button-block--price"]}">\n\t\t\t\t\t\t<div class="${Vt["tv-dom-widget-nav_overall-volume"]} ${Vt["tv-dom-widget-nav_overall-volume--bid"]}">\n\t\t\t\t\t\t\t<span class="apply-common-tooltip js-total-volume-bid"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="${Vt["tv-dom-widget-nav_center"]} apply-common-tooltip js-center">\n\t\t\t\t\t\t\t<svg class="${Vt["tv-dom-widget-nav__timer"]}" viewBox="-1 -1 2 2" width="2" height="2">\n\t\t\t\t\t\t\t\t<path d="M 0,0" class="js-timer-path"></path>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<span class="${Vt["tv-dom-widget-nav__button"]} ${Vt["tv-dom-widget-nav__button--center"]} js-center-target">\n\t\t\t\t\t\t\t\t${e.off}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="${Vt["tv-dom-widget-nav_overall-volume"]} ${Vt["tv-dom-widget-nav_overall-volume--ask"]}">\n\t\t\t\t\t\t\t<span class="apply-common-tooltip js-total-volume-ask"></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="${Vt["tv-dom-widget-nav__button-block"]} ${Vt["tv-dom-widget-nav__button-block--orders"]}">\n\t\t\t\t\t\t<span class="${Vt["tv-dom-widget-nav_count-volume"]} js-count-volume-sell"></span>\n\t\t\t\t\t\t<span class="apply-common-tooltip ${Vt["tv-dom-widget-nav__button"]} ${Vt["tv-dom-widget-nav__button--clear-bid"]} js-clear-bid">\n\t\t\t\t\t\t\t${Mt}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)),r=(0,l.ensureNotNull)(s.querySelector(".js-clear-ask")),n=(0,l.ensureNotNull)(s.querySelector(".js-clear-bid")),a=(0,l.ensureNotNull)(s.querySelector(".js-center")),d=(0,l.ensureNotNull)(s.querySelector(".js-center-target"));this._totalVolumeBidTextNode=document.createTextNode("-"),this._totalVolumeAskTextNode=document.createTextNode("-"),this._countVolumeBuyTextNode=document.createTextNode(""),this._countVolumeSellTextNode=document.createTextNode("");const c=(0,l.ensureNotNull)(s.querySelector(".js-total-volume-bid")),u=(0,l.ensureNotNull)(s.querySelector(".js-total-volume-ask")),h=(0,l.ensureNotNull)(this._countVolumeBid=s.querySelector(".js-count-volume-buy")),_=(0,l.ensureNotNull)(this._countVolumeAsk=s.querySelector(".js-count-volume-sell"));c.appendChild(this._totalVolumeBidTextNode),c.setAttribute("title",o.t(null,void 0,i(353723))),u.appendChild(this._totalVolumeAskTextNode),u.setAttribute("title",o.t(null,void 0,i(977088))),h.appendChild(this._countVolumeBuyTextNode),_.appendChild(this._countVolumeSellTextNode),
r.setAttribute("title",o.t(null,void 0,i(702333))),n.setAttribute("title",o.t(null,void 0,i(139710))),a.setAttribute("title",o.t(null,void 0,i(785663))),r.addEventListener("click",(t=>{t.preventDefault(),this.uiCancelAllOrders(1)})),n.addEventListener("click",(t=>{t.preventDefault(),this.uiCancelAllOrders(-1)})),a.addEventListener("click",(t=>{t.preventDefault(),this.uiCenter();const s=this._content.toggleDynamicModeState(),r=s?e.on:e.off,n=s?o.t(null,void 0,i(44316)):o.t(null,void 0,i(785663));a.setAttribute("title",n),d.removeChild(d.children[0]),d.appendChild((0,l.ensureNotNull)((0,I.parseHtmlElement)(r)))})),this._svgTimerPath=s.querySelector(".js-timer-path"),this._navButtons={clearBuy:r,clearSell:n},t.append(s)}_createNoticeBlock(){const t=(0,l.ensureNotNull)(this._container);this._noDataNoticeBlock=document.createElement("div"),this._noDataNoticeBlock.className=Nt["tv-dom-panel__no-data-notice"],t.append(this._noDataNoticeBlock)}_showNoDataNotice(){var t;const e=null===(t=this._realtimeProvider.activeBroker())||void 0===t?void 0:t.metainfo().title;null!==this._noDataNoticeBlock&&void 0!==e&&a.render(n.createElement(Informer,{header:o.t(null,void 0,i(697174)),content:o.t(null,void 0,i(706844)).replace("{brokerName}",e),informerIntent:"warning"}),this._noDataNoticeBlock)}_hideNoDataNotice(){null!==this._noDataNoticeBlock&&a.unmountComponentAtNode(this._noDataNoticeBlock)}_syncActionButtons(){const{isPositionBlocked:t,isTradable:e,hasPosition:i,hasBuyOrders:s,hasSellOrders:o,hasFlatten:r,hasReverse:n}=this._uiState;if(this._actionPositionButtons&&this._actionMarketButtons){const a={...this._actionPositionButtons,...this._actionMarketButtons},l="i-disabled";a.flatten.disabled=t||!e||!i||!r,a.reverse.disabled=t||!e||!i||!n,a.clear.disabled=!e||!(s||o),a.flatten.title=this._flattenTitle,a.reverse.title=this._reverseTitle,a.clear.title=this._csxAllTitle;const d=this._isOrderTypeSupported(2);a.buyMarket.classList.toggle(l,!d),a.sellMarket.classList.toggle(l,!d)}if(this._navButtons){const t=this._navButtons,i=Vt["tv-dom-widget-nav__button--disabled"];t.clearBuy.classList.toggle(i,!e||!s),t.clearSell.classList.toggle(i,!e||!o)}}_mergeUiState(t){const e=this._uiState;let i,s=!1;for(i in t)e[i]!==t[i]&&(e[i]=t[i],s=!0);s&&(this._uiState$.next({...e}),this._headerState.setIsTradable(e.isTradable),this._syncActionButtons())}_handlers(){return{closeButtonClick:(t,e)=>{t.preventDefault(),this.uiCancelOrder(e&&e.id)},qtyClick:(t,e)=>{t.preventDefault(),this.uiModifyOrder(e)},bidAskClick:(t,{side:e,price:i,type:s})=>{t.preventDefault(),this.uiPlaceOrder({side:e,price:i,type:s||null})},bidAskContextMenu:(t,{side:e,price:i})=>{t.preventDefault(),this.uiContextMenu(t,e,i)},qtyChange:t=>{!isFinite(t)||t<0||(this._qtySuggester.setQty(this._tradingLinking.value().symbol,t),this._mergeUiState({qty:t}))},qtyInput:t=>{!isFinite(t)||t<0||this._mergeUiState({qty:t})},orderMousedown:(t,{order:e,pricePropertyName:i})=>{this.uiOrderMousedown(t,e,i)}}}_mergeTimerLockState(t){const e=this._timerLockState;let i,s=!1
;for(i in t)e[i]!==t[i]&&(e[i]=t[i],s=!0);s&&(!e.autoCenterRequired||e.scroll||e.drag||e.dialog?this._timer.abort():this._timer.run())}_lockTimerUntilSettled(t){if(!t)return;this._mergeTimerLockState({dialog:t});const e=()=>{this._timerLockState.dialog===t&&this._mergeTimerLockState({dialog:null})};t.then(e,e)}_updateTimerUi(t){t=t||0,(0,l.ensureNotNull)(this._svgTimerPath).setAttribute("d",(t=>{let e="M 0 0";return t>0&&(t>=1?e="M 0 -1":e+="L 0 -1",t>.5&&(e+="A 1 1 0 0 1 0 1"),e+="A 1 1 0 0 1 "+Math.sin(2*t*Math.PI)+" "+-Math.cos(2*t*Math.PI)+"Z"),e})(t))}async _getSymbolData(t){const e=this._realtimeProvider.activeBroker(),[i,s,o,r]=await Promise.all([this._realtimeProvider.symbolInfo(t),this._realtimeProvider.quantityFormatter(t),null==e?void 0:e.getPositionCurrency(t),null==e?void 0:e.formatter(t,!0)]),n=null!=r?r:await this._realtimeProvider.formatter(t),a=Math.ceil(-Math.log10(i.qty.step)),l=new y.VolumeFormatter(a);return{brokerSymbol:i.brokerSymbol,minTick:i.minTick,pipSize:i.pipSize,allowedDurations:i.allowedDurations,priceFormatter:n,volumeFormatter:l,quantityFormatter:s,qtyProperties:i.qty,lotSize:i.lotSize,positionCurrency:o,variableMinTickData:i.variableMinTick?(0,P.makeVariableMinTickData)(i.minTick,i.variableMinTick):void 0}}_unsubscribeData(){var t;if(!this._subscription)return;const{broker:e,symbol:i,domHandler:s,realtimeHandler:o,orderHandler:r,positionHandler:n,plHandler:a,plPositionId:l,fullUpdateOrders:d,fullUpdatePosition:c}=this._subscription;this._subscription=null,i&&o&&this._realtimeProvider.unsubscribeRealtime(i,o),i&&s&&this._realtimeProvider.unsubscribeDOM(i,s),e&&r&&e.orderUpdate.unsubscribe(null,r),e&&n&&e.positionUpdate.unsubscribe(null,n),e&&a&&l&&e.unsubscribePL(l,a),e&&d&&e.currentAccountUpdate.unsubscribe(null,d),e&&c&&e.currentAccountUpdate.unsubscribe(null,c),null===(t=this._suggestedQtySubscription)||void 0===t||t.unsubscribe()}_trackEvent(t,e){this._trading.trackEvent("DOM",t,e)}_processOrders(t){const e=[];let i=!1,s=!1;for(let o=0;o<t.length;o++){const r=t[o];if(4===r.status||3===r.status||6===r.status)switch(e.push(r),r.side){case 1:i=!0;break;case-1:s=!0}}this._content.updateOrders(e),this._updateValueBuySellOrders(),this._mergeUiState({hasBuyOrders:i,hasSellOrders:s})}_processPositions(t,e,i){const s=i.find((t=>0!==t.qty));this._mergeUiState({hasPosition:!!s}),void 0!==s&&s.id===e.plPositionId||e.plPositionId&&e.plHandler&&t.unsubscribePL&&(t.unsubscribePL(e.plPositionId,e.plHandler),delete e.plPositionId,e.plHandler=null),void 0===s||e.plPositionId===s.id&&e.plHandler||(e.plHandler=(t,i)=>{this._subscription===e&&this._calcData.updatePL(i)},e.plPositionId=s.id,t.subscribePL(e.plPositionId,e.plHandler)),this._content.updatePosition(s),this._calcData.updatePosition(s),this._calcData.updatePL()}_updateDurationMetainfo(t,e,i){const s=null==t?void 0:t.metainfo().durations;if(this._durationMetaInfoList.setValue(void 0!==s?(0,p.filterDurationsBySymbolDurations)(s,i):void 0),null===t||void 0===this._durationMetaInfoList.value())return
;const o=Ft(t.metainfo().id,e),r=d.getValue(o),n=void 0!==r?this._makeOrderDuration(r):this._makeDefaultOrderDuration();this._currentDuration.setValue(n),void 0!==n&&this._domDetails.setDurationsInfo(n,this._durationMetaInfoList.value())}_makeDefaultOrderDuration(){const t=this._durationMetaInfoList.value();if(void 0===t||0===t.length)return;const e=t.find((t=>!0===t.default))||t[0];return(0,p.makeOrderDuration)(e)}_makeOrderDuration(t){var e;const i=null===(e=this._durationMetaInfoList.value())||void 0===e?void 0:e.find((e=>e.value===t));return void 0!==i?(0,p.makeOrderDuration)(i):void 0}async _onStateChange(){var t;const{symbol:e}=this._tradingLinking.value(),i=this._realtimeProvider.activeBroker(),s=null==i?void 0:i.metainfo().configFlags.calculatePLUsingLast;if(!this._visible.value())return void this._unsubscribeData();this._noDataTimeout&&clearTimeout(this._noDataTimeout),this._noDataTimeout=setTimeout((()=>{var t;null===(t=this._warning)||void 0===t||t.classList.remove("i-hidden")}),3e3),this._domSymbolInfo$.next({symbol:e,brokerName:null==i?void 0:i.metainfo().title}),this._headerState.setTitle(e),this._headerState.setDescription(null==i?void 0:i.metainfo().title),this._headerState.setSymbol(e),this._symbolData=null,this._unsubscribeData(),this._content.reset(),this._calcData.setBrokerConfigFlags({calculatePLUsingLast:!0===s}),this._calcData.reset();const o=null===i||(null==i?void 0:i.metainfo().configFlags.supportDOM);this._configFlags=null==i?void 0:i.metainfo().configFlags,this._hasStopLimit=null!==i&&i.metainfo().configFlags.supportStopLimitOrders,this._mergeUiState({isTradable:!1,hasPosition:!1,hasBuyOrders:!1,hasSellOrders:!1,qty:void 0,hasFlatten:null!==i&&!i.metainfo().configFlags.supportMultiposition,hasReverse:null!==i&&i.metainfo().configFlags.supportReversePosition}),this._mergeTimerLockState({scroll:!1,drag:!1,dialog:null}),this.uiStopOrderDrag();let r=[],n=[];if(!e||!o)return;const a={broker:i,symbol:e,domHandler:null,realtimeHandler:null,orderHandler:null,positionHandler:null,plHandler:null,plPositionId:void 0,fullUpdateOrders:null,fullUpdatePosition:null};this._subscription=a;const l=await this._qtySuggester.getQty(e);this._onSuggestedQtyChange(l),this._suggestedQtySubscription=this._qtySuggester.suggestedQtyChanged(e).subscribe(this._onSuggestedQtyChange);const d=await this._getSymbolData(e);if(this._updateDurationMetainfo(i,e,d.allowedDurations),this._calcData.setHasLotSize(void 0!==d.lotSize),!d)return;if(this._subscription!==a)return;this._symbolData=d,this._content.setSymbolInfo(d),this._calcData.setSymbolInfo(d),this._domSymbolInfo$.next({symbol:e,brokerName:null==i?void 0:i.metainfo().title,brokerSymbol:d.brokerSymbol}),this._headerState.setTitle(d.brokerSymbol||e),this._headerState.setDescription(null==i?void 0:i.metainfo().title),this.isBats.setValue(!1),a.realtimeHandler=(t,e)=>{var i;const s=e.trade||e.bid||e.ask;s&&this._noDataTimeout&&(null===(i=this._warning)||void 0===i||i.classList.add("i-hidden"),clearTimeout(this._noDataTimeout),this._noDataTimeout=null),
this._content.updateLast(s||NaN),this._calcData.updateLast(e.trade||NaN,e.bid||NaN,e.ask||NaN),this.delayedData.setValue(Boolean(e.isDelayed)),this._headerState.setHasDelayedQuotes(Boolean(e.isDelayed)),this._headerState.setHasBatsQuotes((0,p.isBatsQuotes)(e)),!this.isBats.value()&&(0,p.isBatsQuotes)(e)&&this.isBats.setValue(!0)},a.domHandler=(t,e)=>{this._content.updateData(e),this._scheduleUpdateViewTotalVolume()};const c=null===(t=await this._realtimeProvider.isTradable(e))||void 0===t?void 0:t.tradable;this._mergeUiState({isTradable:c}),this._realtimeProvider.subscribeRealtime(e,a.realtimeHandler),this._realtimeProvider.subscribeDOM(e,a.domHandler),this._supportedOrderTypes=this._getSupportedOrderTypes(i),i&&c&&(a.orderHandler=t=>{if(t.symbol!==a.symbol)return;const e=r.findIndex((e=>e.id===t.id));-1!==e?r[e]=t:r.push(t),this._processOrders(r)},a.positionHandler=t=>{if(t.symbol!==a.symbol)return;const e=n.findIndex((e=>e.id===t.id));-1!==e?n[e]=t:n.push(t),this._processPositions(i,a,n)},a.fullUpdateOrders=()=>{const t=i.orders(e);a.orderPromise=t,t.then((e=>{this._subscription===a&&a.orderPromise===t&&(r=e,this._processOrders(e))}))},a.fullUpdatePosition=()=>{const t=i.positions(e);a.positionPromise=t,t.then((e=>{this._subscription===a&&a.positionPromise===t&&(n=e,this._processPositions(i,a,e))}))},i.orderUpdate.subscribe(null,a.orderHandler),i.positionUpdate.subscribe(null,a.positionHandler),i.currentAccountUpdate.subscribe(null,a.fullUpdateOrders),i.currentAccountUpdate.subscribe(null,a.fullUpdatePosition),a.fullUpdateOrders(),a.fullUpdatePosition()),this._updateViewTotalVolume(),this._updateValueBuySellOrders()}async _updateDetails(){var t,e;const i=await(null===(t=this._realtimeProvider.activeBroker())||void 0===t?void 0:t.getOrderDialogOptions(this._tradingLinking.value().symbol)),s=null!==(e=null==i?void 0:i.customFields)&&void 0!==e?e:[];this._domDetails.setCustomFields(s)}_getSupportedOrderTypes(t){const e=[];return null===t||1!==t.connectionStatus()?[2]:(t.metainfo().configFlags.supportMarketOrders&&e.push(2),t.metainfo().configFlags.supportLimitOrders&&e.push(1),t.metainfo().configFlags.supportStopOrders&&e.push(3),t.metainfo().configFlags.supportStopLimitOrders&&e.push(4),e)}_isOrderTypeSupported(t){return-1!==this._supportedOrderTypes.indexOf(t)}_scheduleUpdateViewTotalVolume(){this._viewTotalVolumeScheduled||(this._viewTotalVolumeScheduled=!0,window.requestAnimationFrame((()=>this._updateViewTotalVolume())))}_updateViewTotalVolume(){if(this._viewTotalVolumeScheduled=!1,this._symbolData){const t=this._content.totalVolumeBid(),e=this._content.totalVolumeAsk(),i=(0,l.ensureNotNull)(this._totalVolumeBidTextNode),s=(0,l.ensureNotNull)(this._totalVolumeAskTextNode);i.nodeValue=isFinite(t)?this._content.formatVolume(t):"-",s.nodeValue=isFinite(e)?this._content.formatVolume(e):"-"}}_updateValueBuySellOrders(){
const t=this._content.buyOrdersValue(),e=this._content.sellOrdersValue(),i=this._content.buyInactiveOrdersValue(),s=this._content.sellInactiveOrdersValue(),o=this._content.buyOrdersQuantity(),r=this._content.sellOrdersQuantity(),n=(0,l.ensureNotNull)(this._countVolumeBid),a=(0,l.ensureNotNull)(this._countVolumeAsk),d=(0,l.ensureNotNull)(this._countVolumeBuyTextNode),c=(0,l.ensureNotNull)(this._countVolumeSellTextNode);0!==t||0!==i?(n.setAttribute("title",this._setFormattingTextForCountVolume(t,i,+o)),n.classList.add("apply-common-tooltip")):(n.setAttribute("title",""),n.classList.remove("apply-common-tooltip")),0!==e||0!==s?(a.setAttribute("title",this._setFormattingTextForCountVolume(e,s,+r)),a.classList.add("apply-common-tooltip")):(a.setAttribute("title",""),a.classList.remove("apply-common-tooltip")),d.nodeValue=String(i>0?t:t||""),c.nodeValue=String(s>0?e:e||"")}_setFormattingTextForCountVolume(t,e,s){const r=o.t(null,{plural:"{countOrders} active orders x {countQuantity}",count:t},i(726965)).format({countOrders:String(t),countQuantity:String(s)}),n=o.t(null,{plural:"{countInactiveOrders} inactive orders",count:e},i(373797)).format({countInactiveOrders:String(e)});return r+(e>0?`, ${n}`:"")}}var Ht=i(80423);class zt{constructor(t,e,s,n,a){var l;this._resizerBridge=e,this._widgetBody=new r.WatchedValue,this._visible=new r.WatchedValue(!1),this._trading=t,this._qtySuggester=s,this._tradingLinking=n,this._headerState=a,this._headerState.setSettings((l=t.showPricesWith(),[{settingType:0,label:o.t(null,void 0,i(573712)),value$:(0,Ht.makeObservableFromWatchedValue)(l.zeroVolume),onClick:()=>l.zeroVolume.setValue(!l.zeroVolume.value())},{settingType:0,label:o.t(null,void 0,i(747987)),value$:(0,Ht.makeObservableFromWatchedValue)(l.spread),onClick:()=>l.spread.setValue(!l.spread.value())}])),this._body=this._resizerBridge.container.value().querySelector(".trading-panel-content"),this._container=document.createElement("div");const d=()=>{const t=this._trading.activeBroker();let e;if(t&&1===t.connectionStatus()&&!t.metainfo().configFlags.supportDOM){const t=document.querySelector(Nt["tv-dom-panel__content"]);if(null!==document.querySelector(Nt["tv-dom-panel__disabled"])||null===t)return;const s=document.createElement("span");return e=document.createElement("div"),s.classList.add(Nt["tv-dom-panel__disabled-warning"]),s.innerText=o.t(null,void 0,i(848990)),e.classList.add(Nt["tv-dom-panel__disabled"]),e.appendChild(s),void t.insertBefore(e,t.firstChild)}e=document.querySelector(Nt[".tv-dom-panel__disabled"]),e&&e.parentNode&&e.parentNode.removeChild(e)},c=t=>{var e;t?this._body.append(this._container):null===(e=this._body.querySelector(Nt["tv-dom-panel"]))||void 0===e||e.remove()};this._trading.onConnectionStatusChange.subscribe(null,d),this._visible.subscribe(d),d(),this._visible.when((()=>{this._resizerBridge.container.subscribe((t=>{this._body=t.querySelector(".trading-panel-content"),this._createLayout(),d()}),{callWithLast:!0}),
new $t(this._widgetBody,this._visible,this._trading,this._qtySuggester,this._tradingLinking,this._headerState),this._visible.subscribe(c)}))}setCloseHandler(t){this._headerState.setCloseFunction(t)}setVisibility(t){this._visible.setValue(t)}_createLayout(){this._container.classList.add(Nt["tv-dom-panel"]);const t=document.createElement("div");return t.classList.add(Nt["tv-dom-panel__content"],Nt.mainblock),this._container.append(t),this._container.addEventListener("contextmenu",(t=>{t.target instanceof HTMLElement&&t.target.matches("input, textarea")||t.preventDefault()})),this._body.append(this._container),this._widgetBody.setValue(t),t}}},657947:(t,e,i)=>{"use strict";i.d(e,{DurationControl:()=>P});var s=i(509806),o=i(50959),r=i(481330),n=i(466052),a=i(529631),l=i(192063),d=i(518799),c=i(930052),u=i(996038),h=i(350324),_=i(493173),m=i(44807),p=i(508550),v=i(614793),g=i(972404);const b=new Date((new Date).setHours(0,0,0,0));const w=(0,_.mergeThemes)(h.DEFAULT_INPUT_DATE_THEME,{container:g.dateInputContainer,date:g.dateInput,icon:g.dateInputIcon});function y(t){return o.createElement(h.DateInput,{...t,theme:w})}function f(t){const{initDateTime:e,onDateSelect:i,onTimeSelect:s,onControlFocused:r,hasDatePicker:n,hasTimePicker:a}=t;if(!n&&!a)return o.createElement(o.Fragment,null);const l=()=>{null==r||r()};return o.createElement("div",{className:g.dateTimeWrapper},n&&o.createElement(v.DatePicker,{containerClassName:g.containerDatePicker,minDate:b,initial:e,onPick:t=>{null!==t&&i(t)},onFocus:l,InputComponent:y}),a&&o.createElement(m.TimeInput,{value:(d=e,(0,p.twoDigitsFormat)(d.getHours())+":"+(0,p.twoDigitsFormat)(d.getMinutes())),onChange:t=>{s(function(t){const[e,i]=t.split(":"),s=new Date;return s.setHours(Number(e),Number(i)),s}(t))},onFocus:l}));var d}var k=i(693676);const x=new n.Delegate;function I(t,e){return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),e.getUTCHours(),e.getUTCMinutes())}function P(t){const{currentDuration:e,durationMetaInfoList:n,onDurationChanged:l,onControlFocused:h}=t,_=(0,r.findDurationMetaInfo)(n,e.type);if(void 0===_)return null;const m=(0,o.useMemo)((()=>void 0!==e.datetime?new Date(e.datetime):["GTT","GTD"].includes(e.type)?(0,r.makeDatePlus24UTCHours)():new Date),[e.datetime,e.type]),p=(0,o.useMemo)((()=>n.map((t=>({content:t.name,value:t.value})))),[n]),v=p.length<2;function g(t){return o.createElement(a.Select,{onClick:h,className:k.select,menuClassName:t?k.selectMenu:void 0,value:null==_?void 0:_.value,items:p,"data-name":"duration-type-selector",disabled:v,hideArrowButton:v,onChange:b,stretch:!0,matchButtonAndListboxWidths:!0})}return o.createElement(c.MatchMedia,{rule:u.DialogBreakpoints.TabletSmall},(t=>o.createElement("div",{className:k.wrapper},o.createElement("span",{className:k.title},s.t(null,void 0,i(768877))),t?o.createElement(d.ToolWidgetMenu,{className:k.menuButton,content:g(t),arrow:!1,children:o.createElement(S,{menuItems:p,onTypeSelect:b}),isDrawer:!0,isDisabled:v,closeOnClickOutside:!0}):g(t),o.createElement(f,{initDateTime:m,hasDatePicker:_.hasDatePicker,
hasTimePicker:_.hasTimePicker,onControlFocused:h,onDateSelect:y,onTimeSelect:w}))));function b(i){const s={type:i},o=(0,r.findDurationMetaInfo)(n,i);void 0!==o&&(o.hasDatePicker||o.hasTimePicker)&&(s.datetime=e.datetime||(0,r.getTimestamp)((0,r.makeDatePlus24UTCHours)())),l(s),function(){void 0!==t.onClose&&t.onClose();x.fire()}()}function w(e){const i=I(m,e);t.onDurationChanged({type:t.currentDuration.type,datetime:i})}function y(e){const i=I(e,m);t.onDurationChanged({type:t.currentDuration.type,datetime:i})}}function S(t){const{menuItems:e,onTypeSelect:i}=t;return o.createElement(o.Fragment,null,Object.values(e).map((t=>{var e;return o.createElement(l.PopupMenuItem,{key:t.value,label:null!==(e=t.content)&&void 0!==e?e:t.value,onClick:i,onClickArg:t.value})})))}},493173:(t,e,i)=>{"use strict";function s(t,e,i={}){return Object.assign({},t,function(t,e,i={}){const s=Object.assign({},e);for(const o of Object.keys(e)){const r=i[o]||o;r in t&&(s[o]=[t[r],e[o]].join(" "))}return s}(t,e,i))}i.d(e,{mergeThemes:()=>s})},181436:(t,e,i)=>{"use strict";i.d(e,{getPixelsFromEvent:()=>o});const s=[()=>navigator.userAgent.includes("Win")&&navigator.userAgent.includes("Chrome")?1/window.devicePixelRatio:1,()=>16,(t=(()=>0))=>{var e;return.8*(null!==(e=t())&&void 0!==e?e:0)}];function o(t,e=(()=>({}))){return{x:t.deltaX*s[t.deltaMode]((()=>e().width)),y:t.deltaY*s[t.deltaMode]((()=>e().height))}}},80423:(t,e,i)=>{"use strict";i.d(e,{makeObservableFromWatchedValue:()=>o});var s=i(275734);function o(t){return(0,s.fromEventPattern)((e=>t.subscribe(e,{callWithLast:!0})),(e=>t.unsubscribe(e)))}},476007:(t,e,i)=>{"use strict";i.d(e,{SplitThousandsFormatter:()=>r});var s=i(793361),o=i(710263);class r{constructor(t=" "){this._divider=t}format(t){const e=(0,s.splitThousands)(t,this._divider);return(0,o.isRtl)()?(0,o.startWithLTR)(e):e}parse(t){const e=(0,o.stripLTRMarks)(t).split(this._divider).join(""),i=Number(e);return isNaN(i)||/e/i.test(e)?{res:!1}:{res:!0,value:i,suggest:this.format(i)}}}},611902:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path stroke="currentcolor" stroke-linecap="round" d="M4 7l5 4 5-4"/></svg>'},488263:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path stroke="currentcolor" stroke-linecap="round" d="M4 11l5-4 5 4"/></svg>'},11728:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 9 9" width="9" height="9"><path stroke="currentcolor" stroke-width="1.2" d="M1 1l7 7m0-7L1 8"/></svg>'},781957:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17" width="16" height="17" fill="none"><rect width="15" height="9" stroke="currentcolor" rx="2.5" x=".5" y="7.5"/><circle stroke="currentcolor" cx="8" cy="12" r=".5"/><path stroke="currentcolor" d="M3.5 7c0 .28.22.5.5.5h8a.5.5 0 0 0 .5-.5V5a4.5 4.5 0 1 0-9 0v2z"/></svg>'},943145:t=>{
t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17" width="16" height="17" fill="none"><path fill="currentcolor" fill-rule="evenodd" clip-rule="evenodd" d="M4 5v2h9a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V5a5 5 0 0 1 8.66-3.4l-.74.66A3.99 3.99 0 0 0 4 5z"/><rect width="15" height="9" stroke="currentcolor" rx="2.5" x=".5" y="7.5"/><circle stroke="currentcolor" cx="8" cy="12" r=".5"/></svg>'},482075:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 7" width="12" height="7"><path d="M1 0a1 1 0 0 0-1 1c0 .276.1.538.28.72l5 5c.182.18.444.28.72.28.276 0 .538-.1.72-.28l5-5c.18-.182.28-.444.28-.72a1 1 0 0 0-1-1c-.276 0-.538.1-.72.28L6 4.563 1.72.282C1.537.1 1.275 0 1 0z"/></svg>'},355482:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 7" width="12" height="7"><path d="M1 7a1 1 0 0 1-1-1c0-.276.1-.538.28-.72l5-5C5.463.1 5.725 0 6 0c.276 0 .538.1.72.28l5 5c.18.182.28.444.28.72a1 1 0 0 1-1 1c-.276 0-.538-.1-.72-.28L6 2.437l-4.28 4.28C1.537 6.9 1.275 7 1 7z"/></svg>'},548927:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 9 9" width="9px" height="9px"><path d="M2 1L1 2l2.5 2.5L1 7l1 1 2.5-2.5L7 8l1-1-2.5-2.5L8 2 7 1 4.5 3.5z"/></svg>'}}]);