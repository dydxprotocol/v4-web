(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[8354],{92395:()=>{},37593:t=>{t.exports={wrapper:"wrapper-5Xd5conM",input:"input-5Xd5conM",box:"box-5Xd5conM",icon:"icon-5Xd5conM",noOutline:"noOutline-5Xd5conM","intent-danger":"intent-danger-5Xd5conM",check:"check-5Xd5conM",dot:"dot-5Xd5conM"}},96670:t=>{t.exports={checkbox:"checkbox-GxG6nBa7",reverse:"reverse-GxG6nBa7",label:"label-GxG6nBa7",baseline:"baseline-GxG6nBa7"}},4339:t=>{t.exports={title:"title-uBToaXxI",currency:"currency-uBToaXxI",activeCurrency:"activeCurrency-uBToaXxI",label:"label-uBToaXxI",labelWrapper:"labelWrapper-uBToaXxI",summary:"summary-uBToaXxI",dropdown:"dropdown-uBToaXxI",singleItemDropdown:"singleItemDropdown-uBToaXxI",content:"content-uBToaXxI"}},10794:t=>{t.exports={wrapper:"wrapper-g6lUYjBY"}},16719:t=>{t.exports={headerWrapper:"headerWrapper-dbzrfmFA"}},51871:t=>{t.exports={itemWrapper:"itemWrapper-tp4JSoHa",value:"value-tp4JSoHa",title:"title-tp4JSoHa"}},55983:t=>{t.exports={wrapper:"wrapper-EiWh73lq"}},47276:t=>{t.exports={accountManager:"accountManager-N8TKUQxc",topPanel:"topPanel-N8TKUQxc",secondaryPanel:"secondaryPanel-N8TKUQxc",content:"content-N8TKUQxc",page:"page-N8TKUQxc"}},81334:t=>{t.exports={pageContainer:"pageContainer-fitxEu8O"}},85410:t=>{t.exports={counter:"counter-9Y0FRxjC",text:"text-9Y0FRxjC",count:"count-9Y0FRxjC",blue:"blue-9Y0FRxjC",grey:"grey-9Y0FRxjC",green:"green-9Y0FRxjC",orange:"orange-9Y0FRxjC",red:"red-9Y0FRxjC"}},4834:t=>{t.exports={counter:"counter-IcPlk7WW",text:"text-IcPlk7WW",count:"count-IcPlk7WW"}},12356:t=>{t.exports={tableContainer:"tableContainer-EVvOTmMW",fitContent:"fitContent-EVvOTmMW",withScroll:"withScroll-EVvOTmMW",noScroll:"noScroll-EVvOTmMW"}},67761:t=>{t.exports={title:"title-zC6v6B9f"}},91802:t=>{t.exports={container:"container-TTrPke40",sticky:"sticky-TTrPke40"}},22795:t=>{t.exports={menuButton:"menuButton-eLgvCb0y",icon:"icon-eLgvCb0y",label:"label-eLgvCb0y",checkBox:"checkBox-eLgvCb0y"}},2627:t=>{t.exports={wrapper:"wrapper-R6hgQk56",icon:"icon-R6hgQk56",message:"message-R6hgQk56",warning:"warning-R6hgQk56",information:"information-R6hgQk56",error:"error-R6hgQk56"}},85769:t=>{t.exports={wrapper:"wrapper-cki5BFA5",info:"info-cki5BFA5",title:"title-cki5BFA5",description:"description-cki5BFA5"}},59260:t=>{t.exports={text:"text-P2FUw9Vj",noWrap:"noWrap-P2FUw9Vj"}},42206:t=>{t.exports={gray:"gray-nKJZM9Ax",blue:"blue-nKJZM9Ax",red:"red-nKJZM9Ax",green:"green-nKJZM9Ax",orange:"orange-nKJZM9Ax"}},85758:t=>{t.exports={"desktop-cell-padding":"6px 16px 2px",wrapper:"wrapper-bZH95Ecg"}},50357:t=>{t.exports={"mobile-row-padding":"4px","mobile-row-border-size":"1px","mobile-row-margin":"38px","content-font-size":"14px","desktop-cell-padding":"6px 16px 2px",table:"table-GTBQ4JqO",tableBody:"tableBody-GTBQ4JqO",tableHead:"tableHead-GTBQ4JqO",headCell:"headCell-GTBQ4JqO",headCellContent:"headCellContent-GTBQ4JqO",cell:"cell-GTBQ4JqO",capitalize:"capitalize-GTBQ4JqO",rightAlignedHeadCell:"rightAlignedHeadCell-GTBQ4JqO",rightAlignedCell:"rightAlignedCell-GTBQ4JqO",
cellContent:"cellContent-GTBQ4JqO",hideLabelOnMobile:"hideLabelOnMobile-GTBQ4JqO",hideCellOnMobile:"hideCellOnMobile-GTBQ4JqO",row:"row-GTBQ4JqO",withMargin:"withMargin-GTBQ4JqO",withVirtualization:"withVirtualization-GTBQ4JqO",highlightedRow:"highlightedRow-GTBQ4JqO",inactiveRow:"inactiveRow-GTBQ4JqO",linkedRow:"linkedRow-GTBQ4JqO",successRow:"successRow-GTBQ4JqO",dangerRow:"dangerRow-GTBQ4JqO",tableWrapper:"tableWrapper-GTBQ4JqO",tableWrapperEmpty:"tableWrapperEmpty-GTBQ4JqO",fixedCell:"fixedCell-GTBQ4JqO"}},66164:t=>{t.exports={"mobile-row-padding":"4px","mobile-row-border-size":"1px","mobile-row-margin":"38px","content-font-size":"14px","cell-lateral-padding":"32px","desktop-cell-padding":"6px 16px 2px"}},49818:t=>{t.exports={wrapper:"wrapper-iPWNBRdb"}},82515:t=>{t.exports={mobile:"screen and (max-width: 567px)"}},88913:()=>{},91998:t=>{t.exports={checkbox:"checkbox-HU5RMv36"}},8323:(t,e,s)=>{"use strict";s.d(e,{CheckboxInput:()=>d});var i=s(59496),r=s(97754),o=s(72571),n=s(57369),a=s(37593),l=s.n(a);function d(t){const e=r(l().box,l()["intent-"+t.intent],{[l().check]:!Boolean(t.indeterminate),[l().dot]:Boolean(t.indeterminate),[l().noOutline]:-1===t.tabIndex}),s=r(l().wrapper,t.className);return i.createElement("span",{className:s,title:t.title},i.createElement("input",{id:t.id,tabIndex:t.tabIndex,className:l().input,type:"checkbox",name:t.name,checked:t.checked,disabled:t.disabled,value:t.value,autoFocus:t.autoFocus,role:t.role,onChange:function(){t.onChange&&t.onChange(t.value)},ref:t.reference}),i.createElement("span",{className:e},i.createElement(o.Icon,{icon:n,className:l().icon})))}},2946:(t,e,s)=>{"use strict";s.d(e,{Checkbox:()=>d});var i=s(59496),r=s(97754),o=s(32834),n=s(8323),a=s(96670),l=s.n(a);class d extends i.PureComponent{render(){const{inputClassName:t,labelClassName:e,...s}=this.props,o=r(this.props.className,l().checkbox,{[l().reverse]:Boolean(this.props.labelPositionReverse),[l().baseline]:Boolean(this.props.labelAlignBaseline)}),a=r(l().label,e,{[l().disabled]:this.props.disabled});let d=null;return this.props.label&&(d=i.createElement("span",{className:a,title:this.props.title},this.props.label)),i.createElement("label",{className:o},i.createElement(n.CheckboxInput,{...s,className:t}),d)}}d.defaultProps={value:"on"};(0,o.makeSwitchGroupItem)(d)},52130:(t,e,s)=>{"use strict";s.d(e,{useIsMounted:()=>r});var i=s(59496);const r=()=>{const t=(0,i.useRef)(!1);return(0,i.useEffect)(()=>(t.current=!0,()=>{t.current=!1}),[]),t}},32834:(t,e,s)=>{"use strict";s.d(e,{SwitchGroup:()=>o,makeSwitchGroupItem:()=>n});var i=s(59496),r=s(19036);class o extends i.PureComponent{constructor(){super(...arguments),this._subscriptions=new Set,this._getName=()=>this.props.name,this._getValues=()=>this.props.values,this._getOnChange=()=>this.props.onChange,this._subscribe=t=>{this._subscriptions.add(t)},this._unsubscribe=t=>{this._subscriptions.delete(t)}}getChildContext(){return{switchGroupContext:{getName:this._getName,getValues:this._getValues,getOnChange:this._getOnChange,subscribe:this._subscribe,
unsubscribe:this._unsubscribe}}}render(){return this.props.children}componentDidUpdate(t){this._notify(this._getUpdates(this.props.values,t.values))}_notify(t){this._subscriptions.forEach(e=>e(t))}_getUpdates(t,e){return[...e,...t].filter(s=>e.includes(s)?!t.includes(s):t.includes(s))}}function n(t){var e;return(e=class extends i.PureComponent{constructor(){super(...arguments),this._onChange=t=>{this.context.switchGroupContext.getOnChange()(t)},this._onUpdate=t=>{t.includes(this.props.value)&&this.forceUpdate()}}componentDidMount(){this.context.switchGroupContext.subscribe(this._onUpdate)}render(){return i.createElement(t,{...this.props,name:this._getName(),onChange:this._onChange,checked:this._isChecked()})}componentWillUnmount(){this.context.switchGroupContext.unsubscribe(this._onUpdate)}_getName(){return this.context.switchGroupContext.getName()}_isChecked(){return this.context.switchGroupContext.getValues().includes(this.props.value)}}).contextTypes={switchGroupContext:r.any.isRequired},e}o.childContextTypes={switchGroupContext:r.any.isRequired}},47465:(t,e,s)=>{"use strict";s.d(e,{makeCancelable:()=>r,isCancelled:()=>o});class i{}function r(t){let e=!1;return{promise:new Promise((s,r)=>{t.then(t=>e?r(new i):s(t)),t.catch(t=>r(e?new i:t))}),cancel(){e=!0}}}function o(t){return t instanceof i}},73560:(t,e,s)=>{"use strict";s.r(e),s.d(e,{AccountManagerHeaderDropdowns:()=>g});var i=s(59496),r=s(25177),o=s(97754),n=s.n(o),a=s(88537),l=s(1227),d=s(34816),c=s(92063),h=s(46369),u=s(4339);function p(t){const{currentAccount:e,accountsList:s,currentAccountUpdate:o}=t,[p,_]=(0,i.useState)(e);(0,i.useEffect)(()=>(o.subscribe(null,m),()=>{o.unsubscribe(null,m)}),[o,s]);const g=void 0!==p.currency?`${p.name} (${p.currency})`:p.name;return 1===s.length?i.createElement("div",{className:u.content},i.createElement("span",{className:u.singleItemDropdown},g)):i.createElement(d.ToolWidgetMenu,{isDrawer:l.CheckMobile.any(),content:i.createElement("span",{className:u.content},g),className:u.dropdown},i.createElement(h.ToolWidgetMenuSummary,{className:u.summary},(0,r.t)("Accounts")),s.map(t=>{const e=p.id===t.id;return i.createElement(c.PopupMenuItem,{labelClassName:u.labelWrapper,isActive:e,label:i.createElement("div",{className:u.label},i.createElement("div",{className:u.title},t.name),void 0!==t.currency&&i.createElement("div",{className:n()(u.currency,e&&u.activeCurrency)},"(",t.currency,")")),onClick:()=>t.callBack(),key:t.id})}));function m(t){_((0,a.ensureDefined)(s.find(e=>e.id===t)))}}var _=s(10794);function g(t){const{brokerDropdownProps:e,accountDropdownProps:s}=t;return i.createElement("div",{className:_.wrapper},void 0!==e&&i.createElement(BrokerDropdown,{...e}),i.createElement(p,{...s}))}},38186:(t,e,s)=>{"use strict";s.d(e,{makeAccountManagerHeaderDropdownsProps:()=>u});var i=s(88537),r=s(50681),o=s(80802),n=s(52275),a=s(51951),l=s(50317);const d=(0,a.getLogger)("Trading.DataExport");class c{constructor(t,e){this._prefix=e,this._getDataExporters=t}tabs(){return[...this._getDataExporters()].map(([t,e])=>({value:t,
content:e.title}))}async exportData(t){const{exporters:e,title:s}=(0,i.ensureDefined)(this._getDataExporters().get(t),"data exporter");try{const t=await Promise.all(e.map(({exportData:t})=>t()));t.forEach((i,r)=>{const a=e[r].name,l=void 0===a||""===a?`${(0,o.default)(s)}${t.length>1?"-"+(r+1):""}`:(0,o.default)(a);let d="";if(0!==i.length){const t=[h(Object.keys(i[0]))];for(const e of i)t.push(h(Object.values(e)));d=t.join("\n")}(0,n.saveTextFile)(`${(0,o.default)(this._prefix)}-${l}-${(new Date).toISOString()}.csv`,d,"text/csv")})}catch(t){d.logError((0,l.getLoggerMessage)(t))}}}function h(t){return t.map(n.escapeCSVValue).join(",")}async function u(t,e,s){const o=t.brokersList().filter(t=>!t.configFlags.isSuspended),n=Promise.resolve(void 0),a=(0,i.ensureNotNull)(t.activeBroker()),l=await n,d=await a.accountsMetainfo(),h=a.accountManagerInfo();if(0===d.length)return;const u=d.map(t=>{var e;return{id:t.id,name:t.name,callBack:async()=>{t.id!==a.currentAccount()&&a.setCurrentAccount(t.id)},currency:""===t.currency?void 0:null!==(e=t.currency)&&void 0!==e?e:void 0}}),p=u.find(t=>t.id===a.currentAccount()),_=a.metainfo(),g=void 0!==l?(0,r.brokersListFromPlans)(o,l):void 0;return{brokerDropdownProps:void 0===g?void 0:{title:h.accountTitle,brokerName:_.title,logo:_.logoMiniUrl,logoBlack:_.logoMiniBlackUrl,actions:a.buttonDropdownActions(),dataExportController:void 0!==s?new c(s,_.title):void 0,trading:t,brokers:g,initialSummaryFieldsVisibilityInfo:e.fieldsVisibilityInfo(),summaryFieldsVisibilityInfo$:e.fieldsVisibilityInfo$,summaryFieldToggler:e.toggleField},accountDropdownProps:{currentAccount:(0,i.ensureDefined)(p),accountsList:u,currentAccountUpdate:a.currentAccountUpdate}}}},56718:(t,e,s)=>{"use strict";s.r(e),s.d(e,{AccountManager:()=>Ds});var i,r=s(25177),o=s(59496),n=s(87995),a=s(59255),l=s(88537),d=s(88401),c=s(1227),h=s(82527),u=(s(92395),s(72535)),p=s(85787),_=s(87213),g=s(97496),m=s.n(g),b=s(94511),v=s(25914),f=s(70122),w=s(34581),C=s(42609);!function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"}(i||(i={}));const y={saveTab:"",noSlider:!1,onTabClick:!1,loadedClass:"i-loaded",tabsContainerClass:"tv-tabs",tabClass:"tv-tabs__tab",tabDisabledClass:"disabled",activeTabClass:"i-active",activePageClass:"active",sliderClass:"tv-tabs__slider",scrollBoxClass:"tv-tabs__scroll-box",scrollWrapClass:"tv-tabs__scroll-wrap",lArrowClass:"tv-tabs__left-arrow",rArrowClass:"tv-tabs__right-arrow"},S=b,T=v;class x{constructor(t,e,s={}){this._animating=!1,this._prevWidth=-1,this._bindings=[],this._options=(0,_.deepExtend)({},y,s),this.tabChanged=new(m()),this._elTabs=t,this._elPages=e,this._elScrollWrap=F(this._options.scrollWrapClass||"",this._elTabs,"wrapInner"),this._elScrollBox=F(this._options.scrollBoxClass||"",this._elScrollWrap,"wrapInner"),this._options.noSlider||(this._elSlider=F(this._options.sliderClass||"",this._elScrollBox,"append")),u.mobiletouch||(this._elArrowLeft=F(this._options.lArrowClass||"",this._elTabs,"append",`<div class="${this._options.lArrowClass||""} i-slided">${S}</div>`),
this._elArrowRight=F(this._options.rArrowClass||"",this._elTabs,"append",`<div class="${this._options.rArrowClass||""} i-slided">${T}</div>`),this._addClass(this._elArrowLeft,this._options.addLeftArrowsClass),this._addClass(this._elArrowRight,this._options.addRightArrowsClass)),this._addClass(this._elScrollBox,this._options.addScrollBoxClass),this._addClass(this._elSlider,this._options.addSliderClass),this._addClass(this._elTabs,this._options.tabsContainerClass),this._addClass(this.getTabsArray(),this._options.tabClass),this._addClass(this._elTabs,this._options.loadedClass),this.checkScrollArrows(!0),this._initActivePage(),this._bindEvents()}getTabsArray(){const t=this._elScrollBox.children;if(!this._options.sliderClass)return Array.prototype.slice.call(t);const e=[];for(let s=0;s<t.length;s++){const i=t[s];P(i,this._options.sliderClass)||e.push(i)}return e}getPagesArray(){return this._elPages?Array.prototype.slice.call(this._elPages.children):[]}getElTabs(){return this._elTabs}getElPages(){return this._elPages}checkScrollArrows(t=!1){const e=Math.ceil(this._elScrollWrap.scrollLeft),s=E(this._elScrollWrap),r=this._elScrollWrap.scrollWidth-s-2;function o(t){D(t,"i-slided"),t.style.transition=""}function n(e,s){M(e,"i-slided"),t&&(e.style.transition="none")}this._elArrowLeft&&(e>=1?o(this._elArrowLeft):(e<=1||this._elScrollWrap.scrollWidth<=s)&&n(this._elArrowLeft,i.Left)),this._elArrowRight&&(r-e>1?o(this._elArrowRight):(e>=r||this._elScrollWrap.scrollWidth<=s)&&n(this._elArrowRight,i.Right))}index(){const t=this.getElActiveTab();return t?this.getTabsArray().indexOf(t):-1}getElActiveTab(){return this._getActiveElement(this.getTabsArray(),this._options.activeTabClass||"",this._options.inactiveTabClass)}getElActivePage(){return this._getActiveElement(this.getPagesArray(),this._options.activePageClass||"",this._options.inactivePageClass)}setActivePage(t,e,s){if(-1===t||t===this.index()&&!s)return;const i=this.index();function r(e,s,i){e.forEach((e,r)=>{const o=t===r;s&&A(e,s,o),i&&A(e,i,!o)})}r(this.getTabsArray(),this._options.activeTabClass,this._options.inactiveTabClass),r(this.getPagesArray(),this._options.activePageClass,this._options.inactivePageClass),this._options.noSlider||this.updateSlider(i,t,e),this._options.saveTab&&f.setValue(this._options.saveTab,t),this.tabChanged.fire(t)}updateSlider(t,e,s){if(this._options.noSlider)return;const i=this.getTabsArray()[e];if(0===i.clientWidth||0===i.clientHeight||"none"===window.getComputedStyle(i).getPropertyValue("display"))return;const r=window.getComputedStyle(i);let o=i.offsetLeft+parseInt(r.getPropertyValue("padding-left")),n=E(i);const a=i.querySelector(".js-tabs__slider-pos");if(a){const t=window.getComputedStyle(a);o+=parseInt(t.getPropertyValue("padding-left"))+a.offsetLeft,n-=n-E(a)}if(s=s||-1===t||document.all&&!window.atob)this._elSlider.style.left=o+"px",this._elSlider.style.width=n+"px";else{this._animating=!0;const t=parseInt(getComputedStyle(this._elSlider).left),e=parseInt(getComputedStyle(this._elSlider).width);(0,C.doAnimate)({from:t,to:o,
duration:p.dur,onStep:(t,e)=>{this._elSlider.style.left=e+"px"}}),(0,C.doAnimate)({from:e,to:n,duration:p.dur,onStep:(t,e)=>{this._elSlider.style.width=e+"px"},onComplete:()=>{this._animating=!1}})}}onTabClick(t){const e=t.currentTarget||t.target,s=this.getTabsArray().indexOf(e);-1===s||this._isTabDisabled(e)||this.setActivePage(s),document.activeElement.blur(),t.preventDefault()}resizeSlider(){if(this._options.noSlider)return;const t=this._elTabs.offsetWidth;if(t===this._prevWidth)return;this._prevWidth=t;const e=this.index();this.updateSlider(e,e,!0)}count(){return this.getTabsArray().length}add(t,e){this._elScrollBox.appendChild(t),this._elPages&&e&&this._elPages.appendChild(e),this._bindTabEvents(t),this.checkScrollArrows(!0)}remove(t){function e(t){t.parentElement&&t.parentElement.removeChild(t)}const s=this.tabAt(t);s&&(this._unbindTabEvents(s),e(s));const i=this.pageAt(t);i&&e(i);const r=t-1>=0?t-1:0;this.setActivePage(r),this.checkScrollArrows(!0)}indexOfTab(t){return this.getTabsArray().indexOf(t)}indexOfPage(t){return this.getPagesArray().indexOf(t)}pageAt(t){return this.getPagesArray()[t]||null}tabAt(t){return this.getTabsArray()[t]||null}deselect(){const t=this.getElActiveTab();this._options.activeTabClass&&t&&D(t,this._options.activeTabClass);const e=this.getElActivePage();return this._options.activePageClass&&e&&D(e,this._options.activePageClass),this._elSlider&&(this._elSlider.style.left="",this._elSlider.style.width=""),this}stop(){this._unbindEvents({})}_addClass(t,e){"string"==typeof e&&(Array.isArray(t)||(t=[t]),t.forEach(t=>{M(t,e)}))}_initActivePage(){let t=0;this._options.saveTab&&(t=f.getInt(this._options.saveTab,0));const e=this.index();-1!==e&&(t=e),void 0!==this._options.activeTab&&(t=this._options.activeTab),this.setActivePage(t,!0,!0)}_bindEvents(){this.getTabsArray().forEach(this._bindTabEvents.bind(this)),this._bindOneEvent({eventName:"scroll",listener:this.checkScrollArrows.bind(this,!1),target:this._elScrollWrap}),this._elArrowLeft&&this._bindOneEvent({eventName:"click",listener:()=>{const t=this.getTabsArray();let e=0,s=!1;const i=this._elScrollWrap.scrollLeft;(0,w.isRtl)()&&t.reverse(),t.forEach(t=>{if(s)return;const r=t.offsetLeft+t.offsetWidth;r>i?s=!0:e=r}),(0,C.doAnimate)({from:this._elScrollWrap.scrollLeft,to:this._elScrollWrap.scrollLeft+Math.floor(e-i-E(this._elArrowLeft)),duration:p.dur/2,onStep:(t,e)=>{this._elScrollWrap.scrollLeft=e}})},target:this._elArrowLeft}),this._elArrowRight&&this._bindOneEvent({eventName:"click",listener:()=>{const t=this.getTabsArray();let e=0;const s=(0,w.isRtl)()?0:this._elScrollWrap.scrollLeft+E(this._elScrollWrap);(0,w.isRtl)()&&t.reverse(),t.forEach(t=>{if(0!==e)return;const i=t.offsetLeft+t.offsetWidth;i>s&&(e=i)}),(0,C.doAnimate)({from:this._elScrollWrap.scrollLeft,to:this._elScrollWrap.scrollLeft+Math.ceil(e-s+E((0,l.ensureDefined)(this._elArrowRight))),duration:p.dur/2,onStep:(t,e)=>{this._elScrollWrap.scrollLeft=e}})},target:this._elArrowRight})
;const t=Array.prototype.slice.call(this._elTabs.querySelectorAll(".js-tabs__slider-hover")||[]);t.length&&t.forEach(t=>this._bindOneEvent({eventName:"mouseenter",listener:t=>{if(this._animating)return;const e=t.currentTarget;e&&this._options.activeTabClass&&P(e,this._options.activeTabClass)&&this._hoverSlider(e)},target:t}));let e=null;const s=()=>{e=null,this.checkScrollArrows(!0),this._options.noSlider||this.resizeSlider()};this._bindOneEvent({eventName:"resize",listener:()=>{null===e&&(e=window.requestAnimationFrame(s))},target:window})}_bindTabEvents(t){this._bindOneEvent({eventName:"click",listener:t=>{"function"==typeof this._options.onTabClick?this._options.onTabClick(t):this.onTabClick(t)},target:t})}_unbindTabEvents(t){this._unbindEvents({target:t})}_bindOneEvent(t){t.target.addEventListener(t.eventName,t.listener),this._bindings.push(t)}_unbindEvents(t){const e=e=>!(void 0!==e.eventName&&e.eventName!==t.eventName||void 0!==e.target&&e.target!==t.target||void 0!==e.listener&&e.listener!==t.listener);this._bindings.filter(e).forEach(t=>t.target.removeEventListener(t.eventName,t.listener)),this._bindings=this._bindings.filter(t=>!e(t))}_getActiveElement(t,e,s){return t.filter(t=>e?P(t,e):!!s&&!P(t,s))[0]||null}_isTabDisabled(t){return P(t,"i-disabled")||this._options.tabDisabledClass&&P(t,this._options.tabDisabledClass)||t.hasAttribute("disabled")}_hoverSlider(t){const e=E(t),s=window.getComputedStyle(t),i=t.offsetLeft+parseInt(s.getPropertyValue("padding-left"))+parseInt(s.getPropertyValue("margin-left"));(0,C.doAnimate)({from:parseInt(getComputedStyle(this._elSlider).left),to:i,duration:p.dur/4,onStep:(t,e)=>{this._elSlider.style.left=e+"px"}}),(0,C.doAnimate)({from:parseInt(getComputedStyle(this._elSlider).width),to:e,duration:p.dur/4,onStep:(t,e)=>{this._elSlider.style.width=e+"px"}});const r=()=>{this.getElActiveTab()===t&&this._unhoverSlider(t),t.removeEventListener("mousleave",r)};t.addEventListener("mouseleave",r)}_unhoverSlider(t){const e=window.getComputedStyle(t),s=t.querySelector(".js-tabs__slider-pos"),i=window.getComputedStyle(s),r=t.offsetLeft+parseInt(e.getPropertyValue("padding-left"))+parseInt(e.getPropertyValue("margin-left"))+parseInt(i.getPropertyValue("padding-left"))+s.offsetLeft,o=E(t),n=o-(o-E(s));(0,C.doAnimate)({from:parseInt(getComputedStyle(this._elSlider).left),to:r,duration:p.dur/2,onStep:(t,e)=>{this._elSlider.style.left=e+"px"}}),(0,C.doAnimate)({from:parseInt(getComputedStyle(this._elSlider).width),to:n,duration:p.dur/2,onStep:(t,e)=>{this._elSlider.style.width=e+"px"}})}}function E(t){if(0===t.offsetWidth)return 0;{const e=window.getComputedStyle(t);return t.offsetWidth-parseFloat(e.getPropertyValue("padding-left"))-parseFloat(e.getPropertyValue("padding-right"))-parseFloat(e.getPropertyValue("border-left-width"))-parseFloat(e.getPropertyValue("border-right-width"))}}function F(t,e,s,i){let r=e.querySelector("."+t);if(!r){const o=document.createElement("div");if(o.innerHTML=i||`<div class="${t}"></div>`,r=o.firstElementChild,"append"===s)e.appendChild(r);else{
if("wrapInner"!==s)throw new Error("Unknown insertMethod");{const t=Array.prototype.slice.call(e.childNodes);for(let e=0;e<t.length;e++)r.appendChild(t[e]);e.appendChild(r)}}}return r}function M(t,e){t.classList.add(...k(e))}function D(t,e){t.classList.remove(...k(e))}function P(t,e){return k(e).every(e=>t.classList.contains(e))}function A(t,e,s){k(e).forEach(e=>t.classList.toggle(e,s))}function k(t){return t.split(/\s+/)}var R=s(50681),O=s(9696);class I{constructor(t){this._delegates=t}subscribe(t,e,s){this._delegates.forEach(i=>i.subscribe(t,e,s))}unsubscribe(t,e){this._delegates.forEach(s=>s.unsubscribe(t,e))}unsubscribeAll(t){this._delegates.forEach(e=>e.unsubscribeAll(t))}}var B=s(33080),U=s(93605),V=s(18833);function L(t){return 0!==t.qty||0!==t.longQty&&void 0!==t.longQty||0!==t.shortQty&&void 0!==t.shortQty}var N,W=s(12334);!function(t){t.Success="success",t.Danger="danger"}(N||(N={}));var H=s(47465);class j{constructor(t){this._active=!1,this._created=!1,this._started=!1,this._fullUpdateDelegate=null,this._partialUpdateDelegate=null,this._deleteUpdateDelegate=null,this._noMoreEntries=!1,this._isLoadingMore=!1,this._fullUpdateCancel=null,this._exportData=async()=>{const t=this._active;t||(this.start(),await this.setActive(!0));const e=this._view.exportData();return t||await this.setActive(!1),e},this._viewVisibilityHandler=t=>{this._model.setActive(t)},this._sortingChangeHandler=t=>{this._updateModelSortingState(t)},this._sizeChangeHandler=()=>{this._updateModelSortingState({column:this._view.sortingColumn(),mode:this._view.sortingMode()})};const{idProperty:e,name:s,model:i,view:r,source:o,subscriptions:n,supportPagination:a}=t;this._idProperty=e,this._model=i,this._view=r,this._name=s,this._source=o,this._subscriptions=n,this._supportPagination=Boolean(a)}start(){this._started||(this._updateModelSortingState({column:this._view.sortingColumn(),mode:this._view.sortingMode()}),this._subscribeUpdates(),this._subscribeView(),this._started=!0)}stop(){this._started&&(this._unsubscribeUpdates(),this._unsubscribeView(),this.reset(),this._started=!1)}isStarted(){return this._started}async setActive(t){(0,l.assert)(!t||this._started,"Should be started first"),this._active!==t&&(this._active=t,this._active&&!this._created&&await this._fullUpdate(),this._model.setActive(t))}isActive(){return this._active}reset(){this._active?this._fullUpdate():(this._deleteRows(),this._created=!1)}destroy(){this._unsubscribeUpdates(),this._unsubscribeView()}getDataExporter(){return{name:this._name,exportData:this._exportData}}setHeight(t){this._view.setHeight(t)}highlightRowById(t){this._view.highlightRowById(t)}setRowInactiveById(t,e){this._view.setRowInactiveById(t,e)}setRowInactiveByFilter(t){this._view.setRowInactiveByFilter(t)}addFormatter(t){this._view.addFormatter(t)}addFormatters(t){for(const e of t)this.addFormatter(e)}isRowInViewport(t){return this._view.isRowInViewport(t)}setColumnAvailable(t,e){this._view.setColumnAvailable(t,e)}setRowLinkedByFilter(t){this._view.setRowLinkedByFilter(t)}setRowLinkedById(t,e){
this._view.setRowLinkedById(t,e)}rowIdAtEvent(t){return this._view.rowIdAtEvent(t)}rowAtEvent(t){const e=this._view.rowIdAtEvent(t);if(void 0!==e)return this.rowById(e)}rowById(t){return this._model.data().get(t)}_update(t){return!!this._created&&(this._model.addRow(t),!0)}_deleteRow(t){this._created&&this._model.deleteRow(t)}_deleteRows(){this._model.deleteRows(),this._created=!1}_fullUpdate(){if(this._deleteRows(),this._noMoreEntries=!1,!this._active)return Promise.resolve();this._fullUpdateCancel&&this._fullUpdateCancel();const t=(0,H.makeCancelable)(this._source());return this._fullUpdateCancel=t.cancel,t.promise.then(t=>{this._fullUpdateCancel=null,this._model.addRows(t),this._created=!0,this._onCreated()}).catch(t=>{if(!(0,H.isCancelled)(t))throw t})}_onCreated(){}_loadMoreIfBottomVisible(t){if(this._isLoadingMore||!t||this._noMoreEntries)return;const e=this._model.rows().length-1;if(-1===e)return;const s=this._model.rows()[e][this._idProperty];this._isLoadingMore=!0,this._source(s).then(t=>{0!==t.length?(this._model.addRows(t),this._isLoadingMore=!1):this._noMoreEntries=!0}).catch(()=>{this._isLoadingMore=!1})}_subscribeView(){this._view.onSizeChange.subscribe(this,this._sizeChangeHandler),this._view.onTableVisibilityChange.subscribe(this,this._viewVisibilityHandler),this._view.onSortingChange.subscribe(this,this._sortingChangeHandler),this._supportPagination&&this._view.onBottomVisibilityChange.subscribe(this,this._loadMoreIfBottomVisible)}_unsubscribeView(){this._view.onSizeChange.unsubscribe(this,this._sizeChangeHandler),this._view.onTableVisibilityChange.unsubscribe(this,this._viewVisibilityHandler),this._view.onSortingChange.unsubscribe(this,this._sortingChangeHandler),this._view.onBottomVisibilityChange.unsubscribe(this,this._loadMoreIfBottomVisible)}_updateModelSortingState({column:t,mode:e}){this._model.setSortingState({column:t,mode:0!==this._view.size()||this._supportPagination?e:null})}_subscribeUpdates(){if(this._fullUpdateDelegate)throw new Error("should unsubscribe first");this._fullUpdateDelegate=this._subscriptions.fullUpdateDelegate,this._fullUpdateDelegate.subscribe(this,this._fullUpdate),this._partialUpdateDelegate=this._subscriptions.rowUpdateDelegate,this._partialUpdateDelegate.subscribe(this,this._update),this._subscriptions.rowDeleteDelegate&&(this._deleteUpdateDelegate=this._subscriptions.rowDeleteDelegate,this._deleteUpdateDelegate.subscribe(this,this._deleteRow))}_unsubscribeUpdates(){this._fullUpdateDelegate&&(this._fullUpdateDelegate.unsubscribe(this,this._fullUpdate),delete this._fullUpdateDelegate),this._partialUpdateDelegate&&(this._partialUpdateDelegate.unsubscribe(this,this._update),delete this._partialUpdateDelegate),this._deleteUpdateDelegate&&(this._deleteUpdateDelegate.unsubscribe(this,this._deleteRow),delete this._deleteUpdateDelegate)}}var G=s(4834);class q extends class{constructor(t,e){this._active=!1,this._content=t,this._id=e.id,this._name=e.name,this._header=function(t){if(!t.headerCounter){const e=document.createElement("span");return e.textContent=t.name,e}
const e=document.createElement("div");e.className=G.counter;const s=document.createElement("div");s.className=G.text,s.textContent=t.name;const i=document.createElement("div");return i.className=G.count+" js-header-count",i.textContent="0",e.appendChild(s),e.appendChild(i),e}(e),this._countElement=this._header.querySelector(".js-header-count")}setActive(t){this._active!==t&&(this._active=t,this._onActiveChanged(t))}isActive(){return this._active}reset(){}destroy(){}header(){return this._header}content(){return this._content}name(){return this._name}id(){return this._id||this._name}contextItems(t){return[]}topline(){return null}_setCount(t){null!==this._countElement&&(this._countElement.innerHTML=String(t))}_onActiveChanged(t){}}{constructor(t,e,s){super(t,e),this._tableControllers=s}reset(){this._tableControllers.forEach(t=>t.reset()),super.reset()}destroy(){this._tableControllers.forEach(t=>t.destroy()),super.destroy()}setHeight(t){this._tableControllers.forEach(e=>e.setHeight(t))}getExporters(){const t=this._tableControllers.map(t=>t.getDataExporter());return{title:this.name(),exporters:t}}contextRow(t){}_onActiveChanged(t){this._tableControllers.forEach(e=>e.setActive(t))}}var z=s(93751),$=s(72249),Q=s(83887),J=s(89963),K=s(52647);var X=s(2683),Y=s(42419);var Z=s(50317),tt=(s(99357),s(47152),s(97754)),et=s.n(tt);s(88913);s(72476);var st=s(30052);s(39391),s(21162);new Map;var it=s(85769);new Map;function rt(t){const{brokerSymbol:e}=t;return o.createElement("div",{className:it.title},e)}function ot(t){return o.createElement(st.MatchMedia,{rule:W.TradingLayoutBreakpoint.Mobile},e=>e?o.createElement("span",null,t.brokerSymbol):o.createElement(rt,{...t}))}var nt=s(42206);function at(t){return 1===t?nt.blue:nt.red}function lt(t){const{side:e}=t;return o.createElement("span",{className:at(e)},(0,Z.sideToText)(e))}function dt(t){const{side:e}=t;return o.createElement("span",{className:at(e)},(0,Z.positionSideToText)(e))}var ct=s(59260);function ht(t){const{value:e,noWrap:s}=t;return o.createElement("span",{className:et()(ct.text,s&&ct.noWrap)},e)}function ut(t){const{priceFormatter:e,price:s,prevPrice:i}=t,r=(0,$.splitThousands)(e.format(s)," ");if(void 0===i)return{same:r};const o=(0,$.splitThousands)(e.format(i)," "),n=r.split("").findIndex((t,e)=>t!==o[e]);if(-1===n)return{same:r};return{same:r.substring(0,n),differs:r.substring(n)}}function pt(t){const{price:e,prevPrice:s,lastCharSup:i}=t,{same:r,differs:n}=ut(t);return void 0===n||void 0===s?function(t,e){return o.createElement("span",null,e?_t(t):(0,w.forceLTRStr)(t))}(r,i):o.createElement("span",null,r,o.createElement("span",{className:e>s?nt.green:nt.red},i?_t(n):n))}function _t(t){const e=/^([^]*)(\S)(\s*)$/.exec(t);return"0"===t||null===e?o.createElement(o.Fragment,null,(0,w.forceLTRStr)(t)):o.createElement(o.Fragment,null,e[1],o.createElement("sup",null,e[2]),void 0!==e[3]&&""!==e[3]&&o.createElement("sup",null,e[3]))}const gt={3:nt.gray,6:nt.blue,5:nt.red,2:nt.green,1:nt.orange,4:void 0};function mt(t){const{status:e}=t;return o.createElement("span",{
className:gt[e],style:{textTransform:"capitalize"}},(0,R.orderStatusToText)(e))}function bt(t){const{profit:e,currency:s}=t;if(!(0,X.isNumber)(e))return"";const i=(0,z.fixComputationError)(e),r=i>0?"+":"",o=void 0!==s?" "+s:"";return(0,w.forceLTRStr)(r+(0,$.splitThousands)((i||0).toFixed(2)," ")+o)}function vt(t){const e=bt(t);return""===e?o.createElement("span",null):o.createElement("span",{className:et()(t.profit<0&&nt.red,t.profit>0&&nt.green)},e)}const ft=new Q.DateTimeFormatter,wt=new class{constructor(){this._dateFormatter=new K.DateFormatter,this._timeFormatter=new J.TimeFormatter}format(t){const e=new Date(t.dateOrDateTime);let s=this._dateFormatter.format(e);return t.hasTime&&(s+=" "+this._timeFormatter.format(e)),s}formatLocal(t){const e=new Date(t.dateOrDateTime);let s=this._dateFormatter.formatLocal(e);return t.hasTime&&(s+=" "+this._timeFormatter.formatLocal(e)),s}},Ct=new Y.PercentageFormatter;function yt({value:t}){return String(null!=t?t:"")}const St={name:"default",formatText:yt};function Tt(t){return(0,R.isDefined)(t.value)?function(t){const{same:e,differs:s}=ut(t);return(0,w.forceLTRStr)(`${e}${s||""}`)}({...t,price:t.value}):""}const xt=[{name:"symbol",formatElement:({value:t,row:e})=>o.createElement(ot,{brokerSymbol:t,symbol:e.symbol}),formatText:yt},{name:"side",formatElement:({value:t})=>o.createElement(lt,{side:t}),formatText:({value:t})=>(0,Z.sideToText)(t)},{name:"positionSide",formatElement:({value:t})=>o.createElement(dt,{side:t}),formatText:({value:t})=>(0,Z.positionSideToText)(t)},{name:"text",formatElement:({value:t})=>o.createElement(ht,{value:t}),formatText:yt},{name:"textNoWrap",formatElement:({value:t})=>o.createElement(ht,{value:t,noWrap:!0}),formatText:yt},{name:"type",formatText:({value:t})=>(0,Z.orderTypeToText)(t)},{name:"formatPrice",formatElement:({value:t,priceFormatter:e,prevValue:s})=>(0,R.isDefined)(t)?o.createElement(pt,{priceFormatter:e,price:t,prevPrice:s}):void 0,formatText:Tt},{name:"formatPriceForexSup",formatElement:({value:t,priceFormatter:e,prevValue:s})=>(0,R.isDefined)(t)?o.createElement(pt,{priceFormatter:e,price:t,prevPrice:s,lastCharSup:e.hasForexAdditionalPrecision()}):void 0,formatText:Tt},{name:"status",formatElement:({value:t})=>(0,R.isDefined)(t)?o.createElement(mt,{status:t}):void 0,formatText:({value:t})=>{return(0,R.isDefined)(t)?(e=(0,Z.orderStatusToText)(t)).charAt(0).toUpperCase()+e.substring(1):"";var e}},{name:"date",formatText:({value:t})=>(0,R.isDefined)(t)&&Et(t)?ft.format(new Date(t)):""},{name:"localDate",formatText:({value:t})=>(0,R.isDefined)(t)&&Et(t)?ft.formatLocal(new Date(t)):""},{name:"dateOrDateTime",formatText:({value:t})=>(0,R.isDefined)(t)&&Et(t.dateOrDateTime)?wt.format(t):""},{name:"localDateOrDateTime",formatText:({value:t})=>(0,R.isDefined)(t)&&Et(t.dateOrDateTime)?wt.formatLocal(t):""},{name:"fixed",formatText:({value:t})=>!(0,R.isDefined)(t)||isNaN(t)?"":(0,w.forceLTRStr)(Math.abs(t||0)<.001?"0.00":(0,$.splitThousands)((t||0).toFixed(2)," "))},{name:"variablePrecision",formatText:({value:t})=>!(0,
R.isDefined)(t)||isNaN(t)?"":(0,w.forceLTRStr)(String((0,z.fixComputationError)(t)))},{name:"pips",formatText:({value:t})=>(0,X.isNumber)(t)?(0,w.forceLTRStr)(Math.abs(t)<.01?"0.0":(0,$.splitThousands)(t.toFixed(1)," ")):""},{name:"integerSeparated",formatText:({value:t})=>(0,X.isNumber)(t)?(0,w.forceLTRStr)((0,$.splitThousands)(t.toFixed(0)," ")):""},{name:"formatQuantity",formatText:({value:t})=>(0,X.isNumber)(t)?(0,w.forceLTRStr)((0,$.splitThousands)(t," ")):""},{name:"profit",formatElement:({value:t})=>(0,R.isDefined)(t)?o.createElement(vt,{profit:t}):void 0,formatText:({value:t})=>(0,R.isDefined)(t)?bt({profit:t}):""},{name:"profitInInstrumentCurrency",formatElement:({value:t,row:{currency:e}})=>(0,R.isDefined)(t)?o.createElement(vt,{profit:t,currency:e}):void 0,formatText:({value:t,row:{currency:e}})=>(0,R.isDefined)(t)?bt({profit:t,currency:e}):""},{name:"percentage",formatText:({value:t})=>(0,X.isNumber)(t)?(0,w.forceLTRStr)(Ct.format(t)):""},{name:"marginPercent",formatText:({value:t})=>(0,R.isDefined)(t)?isFinite(t)?t<.01?t+"%":Ct.format(t):"> 200%":""}];function Et(t){return"number"==typeof t?t>0:""!==t}var Ft=s(12356);function Mt(t={}){const{withScroll:e=!1,fitContent:s=!1}=t,i=document.createElement("div");return i.classList.add(Ft.tableContainer),i.classList.toggle(Ft.withScroll,e),i.classList.toggle(Ft.noScroll,!e),i.classList.toggle(Ft.fitContent,s),i}var Dt=s(43370);function Pt(t,e){return void 0===t&&void 0!==e?1:void 0!==t&&void 0===e?-1:void 0===t||void 0===e?0:t<e?1:t>e?-1:0}class At{constructor(t){this.onRowsChanged=new(m()),this.onRowChanged=new(m()),this._rowsData=new Map,this._priceFormatters=new Map,this._rows=[],this._isActive=!1,this._sortingPostponed=!1,this._sortingMode=null;const{columns:e,options:s,priceFormatterGetter:i,reverse:r=!0}=t;this._idProperty=s.idProperty,this._reverse=r,this._group=s.group,this._priceFormatterGetter=i,this._sortAndGroupRowsThrottled=(0,Dt.default)(()=>{this._sortAndGroupRows(),this._update()},1e3),this._columns=new Map(e.map(t=>[t.property,t]))}setActive(t){this._isActive=t,this._onTableStateChanged(t)}addRow(t){const e=t[this._idProperty];this._rowsData.has(e)?this._updateRow(e,t):(this._addRowData(t),this._sortAndGroupRowsThrottled.cancel(),this._sortAndGroupRows(),this._update())}addRows(t){for(const e of t){const t=e[this._idProperty];this._rowsData.has(t)?this._updateRowData(t,e):this._addRowData(e)}this._sortAndGroupRows(),this._update()}rows(){return this._rows}data(){return this._rowsData}deleteRow(t){const e=this._rowsData.get(t);void 0!==e&&(this._rowsData.delete(t),this._rows.splice(this._rows.indexOf(e),1),this._update())}deleteRows(){this._deleteRows(),this._update()}destroy(){this._sortAndGroupRowsThrottled.cancel(),this._deleteRows()}setSortingState(t){this._sortingColumn=t.column,this._sortingMode=t.mode,this._onSortingChange()}_deleteRows(){this._rowsData.clear(),this._rows=[]}_sortAndGroupRows(){var t,e;if(!this._isActive)return void(this._sortingPostponed=!0)
;const s=void 0!==this._sortingColumn?this._columns.get(this._sortingColumn):void 0,i=null!==(e=null!==(t=null==s?void 0:s.sortProp)&&void 0!==t?t:null==s?void 0:s.property)&&void 0!==e?e:this._sortingColumn;this._rows.sort((t,e)=>function(t){const{aRow:e,bRow:s,sortingMode:i,sortingColumn:r,groupDefiner:o}=t;let n=0;return void 0!==o&&(n=Pt(o(e),o(s))),0===n&&(n=e.isTotalRow?1:s.isTotalRow?-1:0),null===i||0!==n||void 0===r?n:(n=Pt(e[r],s[r]),0===i?-n:n)}({aRow:t,bRow:e,sortingColumn:i,sortingMode:this._sortingMode,groupDefiner:this._group}))}_onSortingChange(){this._sortAndGroupRowsThrottled.cancel(),null===this._sortingMode&&this._resetRowsOrder(),this._sortAndGroupRows(),this._update()}_resetRowsOrder(){this._rows=[...this._rowsData.values()],this._reverse&&this._rows.reverse()}_onTableStateChanged(t){if(!t)return this._sortAndGroupRowsThrottled.cancel(),void(this._sortingPostponed=!0);this._update()}_update(){this._isActive&&(this._sortingPostponed&&(this._sortingPostponed=!1,this._sortAndGroupRows()),this.onRowsChanged.fire())}_updateRowData(t,e){var s,i;const r=(0,l.ensureDefined)(this._rowsData.get(t)),{prevValue:o,priceFormatter:n,...a}=r;for(const t of Object.keys(r))delete r[t];Object.assign(r,e,{priceFormatter:n,prevValue:a}),this.onRowChanged.fire(t);const d=(null===(s=this._group)||void 0===s?void 0:s.call(this,r))!==(null===(i=this._group)||void 0===i?void 0:i.call(this,a));(void 0!==this._sortingColumn&&e[this._sortingColumn]!==a[this._sortingColumn]||d)&&this._sortAndGroupRowsThrottled()}_updateRow(t,e){this._updateRowData(t,e),this._update()}_addRowData({...t}){this._rowsData.set(t[this._idProperty],t),this._reverse?this._rows.unshift(t):this._rows.push(t),this._resolvePriceFormatter(t[this._idProperty])}async _resolvePriceFormatter(t){if(void 0!==this._priceFormatterGetter)try{const e=this._rowsData.get(t);if(void 0===e||void 0!==e.priceFormatter)return;e.priceFormatter=null;const s=this._priceFormatters.get(t);if(void 0!==s)return e.priceFormatter=s,void this._update();const i=await this._priceFormatterGetter(e);this._priceFormatters.set(t,i),e.priceFormatter=i,this._update()}catch(t){}}}var kt=s(86416),Rt=s(11307),Ot=s(4889),It=s(15427),Bt=s(33054),Ut=s(89e3),Vt=s(11126),Lt=s(16345),Nt=s(1397),Wt=s(94489),Ht=s.n(Wt),jt=s(97265),Gt=s(75803),qt=s(34816),zt=s(85673),$t=s(79266),Qt=s(53327),Jt=s(22795),Kt=s(56620);const Xt=new(Ht())(null).readonly();function Yt(t){const{items:e,onCheck:s,overlapManagerWV:i}=t,n=(0,jt.useWatchedValueReadonly)({watchedValue:null!=i?i:Xt}),a=(0,o.useMemo)(()=>e.filter(t=>t.visible),[e]);return o.createElement(Qt.SlotContext.Provider,{value:n},o.createElement(qt.ToolWidgetMenu,{horizontalDropDirection:zt.HorizontalDropDirection.FromRightToLeft,horizontalAttachEdge:zt.HorizontalAttachEdge.Right,className:Jt.menuButton,arrow:!1,isDrawer:c.CheckMobile.any(),content:o.createElement(Gt.ToolWidgetButton,{className:Jt.icon,title:(0,r.t)("Column setup"),icon:Kt})},e.map(t=>o.createElement($t.PopupMenuItemToggle,{key:t.id,label:t.title,isChecked:t.visible,labelClassName:Jt.label,
className:Jt.checkBox,onClick:()=>{return e=t.id,void s(e);var e},isDisabled:1===a.length&&a[0].id===t.id}))))}var Zt=s(91802);function te(t){const{isSticky:e,...s}=t;return o.createElement("div",{className:et()(Zt.container,e&&Zt.sticky)},o.createElement(Yt,{...s}))}var ee=s(53408),se=s(34985),ie=s(39226),re=s(16550),oe=s.n(re),ne=s(85758);function ae(t){const{column:e,dispatch:s,onColumnsReordered:i,columnsReorderingEnabled:r}=t,[{isDragging:n},a,l]=(0,se.useDrag)(()=>({type:"HeadCell",item:{id:e.key},canDrag:()=>r,collect:t=>({isDragging:t.isDragging()})})),[,d]=(0,ie.useDrop)(()=>({accept:"HeadCell",hover:(t,i)=>{var r;if(t.id===e.key)return;const o=null===(r=c.current)||void 0===r?void 0:r.getBoundingClientRect(),n=i.getClientOffset(),a=i.getDifferenceFromInitialOffset();void 0!==o&&null!==n&&null!==a&&function(t,e,s,i){const r=e-s,o=.4*(i-s);return t>0?r>o:r<o}(a.x,n.x,o.left,o.right)&&s({type:Vt.ActionType.ReorderColumns,columnKey:t.id,targetColumnKey:e.key})},drop:()=>{i()}})),c=(0,o.useRef)(null);return(0,o.useEffect)(()=>{""!==e.title&&a(d(c)),l((0,ee.getEmptyImage)(),{captureDraggingState:!0})},[e]),o.createElement("div",{ref:c,className:ne.wrapper,style:{opacity:n?.4:1}},o.createElement(oe(),{...t}))}var le=s(60511),de=s.n(le);function ce(t){const{visibilityHandler:e,...s}=t;return(0,o.useLayoutEffect)(()=>(e(s.rowKeyValue,!0),()=>e(s.rowKeyValue,!1)),[]),o.createElement(de(),{...s})}var he=s(66164);const ue={mobileRowPadding:pe(he["mobile-row-padding"]),mobileRowBorderSize:pe(he["mobile-row-border-size"]),mobileRowMargin:pe(he["mobile-row-margin"]),contentFontSize:he["content-font-size"],maxCellWidth:200,minCellWidth:80,cellLateralPadding:pe(he["cell-lateral-padding"])};function pe(t){return Number(t.replace("px",""))}var _e=s(49818);function ge(t){const{children:e,onWidthChange:s,widthMeasurer:i,maxWidth:r}=t,[n,a]=(0,o.useState)(),[l,d]=(0,o.useState)(!1),c=(0,o.useRef)(null);return(0,o.useEffect)(()=>{if(null===c.current)return;const t=c.current.innerText;if(t===n)return;a(t);const e=i(t);s(e),d(e>r)},[e]),o.createElement("span",{ref:c,className:et()(_e.wrapper,l&&"apply-common-tooltip"),"data-tooltip":n},e)}var me=s(50357);const be={0:Vt.SortDirection.Ascend,1:Vt.SortDirection.Descend},ve={[N.Danger]:me.dangerRow,[N.Success]:me.successRow};class fe{constructor(t=0){this._mode=t}value(){return this._mode}next(){switch(this._mode){case 0:this._mode=1;break;case 1:this._mode=null;break;case null:this._mode=0}return this._mode}reset(){this._mode=0}}function we({value:t}){let e="";return void 0!==t&&(e=String(t).replace(/&nbsp;/g," ")),e}const Ce=new Nt.PriceFormatter,ye=(0,l.ensureNotNull)(document.createElement("canvas").getContext("2d"));ye.font=`${ue.contentFontSize} ${getComputedStyle(document.body).fontFamily}`;function Se(t){return Math.ceil(ye.measureText(t).width)+10}It.default.fieldDelimiter="";class Te{constructor(t){var e,s;this.onTableVisibilityChange=new(m()),this.onBottomVisibilityChange=new(m()),this.onSizeChange=new(m()),this.onSortingChange=new(m()),this._isVisible=!1,
this._tableWrapperKey=(0,Lt.randomHashN)(5),this._rowHeightCache=new Map,this._rowsElements=new Map,this._rowsDisplayOptions=new Map,this._columnsWidth=new Map,this._columnWidthChangeHandlers=new Map,this._highlightTimeoutIds=new Map,this._formatters=new Map,this._visibleColumnsWithFormatters=new Map,this._hiddenFilterColumns=new Set,this._visibleRows=new Set,this._invalidateRowCache=t=>{this._rowHeightCache.delete(t)},this._makeHeadCellAttributes=({column:{key:t,title:e}})=>{const s="settings"===t,i={className:et()(me.headCell,s&&!this._isMobile&&me.fixedCell)};return this._isMobile||(i.width=this._fixedColumns?"50%":this._columnsWidth.get(t),s&&(i.width=68)),i},this._setColumnWidth=(t,e)=>{const s=e+ue.cellLateralPadding,i=this._columnsWidth.get(t);void 0!==i&&s<=i||(this._columnsWidth.set(t,s),this._render())},this._updateTableProps=t=>{if(t.type===Vt.ActionType.UpdateSortDirection){const e=this._columnsMetainfo.get(t.columnKey);if(void 0===e||e.notSortable)return;this._handleSortingUpdate(t.columnKey)}this._tableProps=(0,Ut.kaReducer)(this._tableProps,t),this._render()},this._handleEmptyRows=()=>{0===this._model.rows().length&&this._resetTableVirtualScrollPosition()},this._calculateRowHeight=t=>{var e,s;const i=null===(s=null===(e=this._virtualization)||void 0===e?void 0:e.rowHeightParams)||void 0===s?void 0:s[this._isMobile?"mobile":"desktop"];if(void 0===i)return 48;if("number"==typeof i)return i;const r=t[this._idProperty],o=this._isMobile&&this._isFirstRow(r)?ue.mobileRowMargin:0,n=this._rowHeightCache.get(r);if(void 0!==n)return n+o;const a=i(t,this._visibleColumnsWithFormatters);return this._rowHeightCache.set(r,a),a+o},this._makeHeadCellContent=t=>{const{column:e}=t;if("settings"===e.key){const t=this._getAvailableColumnsFilterItems();if(0!==t.length)return o.createElement(te,{...this._columnsFilterProps,items:t})}const s=this._columnsMetainfo.get(e.key);return void 0!==(null==s?void 0:s.help)?o.createElement("span",{className:"apply-common-tooltip",title:s.help},e.title):e.title},this._makeTextContent=t=>{var e,s,i,r;const{value:o,rowData:n,field:a}=t,l=this._columnsMetainfo.get(a);if(void 0===l||!1===l.showZeroValues&&0===o)return"";const d=void 0!==l.formatter&&null!==(s=null===(e=this._formatters.get(l.formatter))||void 0===e?void 0:e.formatText)&&void 0!==s?s:we,c=null===(i=n.prevValue)||void 0===i?void 0:i[a];return d({value:o,prevValue:l.highlightDiff?c:void 0,priceFormatter:null!==(r=n.priceFormatter)&&void 0!==r?r:Ce,row:n})},this._makeCellContent=t=>{var e,s,i,r;const{value:n,rowData:a,field:l}=t,d=this._columnsMetainfo.get(l);if(void 0===d)return;if(!1===d.showZeroValues&&0===n)return o.createElement(o.Fragment,null);let c=we;if(void 0!==d.formatter){const t=this._formatters.get(d.formatter);c=null!==(s=null!==(e=null==t?void 0:t.formatElement)&&void 0!==e?e:null==t?void 0:t.formatText)&&void 0!==s?s:c}const h=null===(i=a.prevValue)||void 0===i?void 0:i[l],u=c({value:n,prevValue:d.highlightDiff?h:void 0,priceFormatter:null!==(r=a.priceFormatter)&&void 0!==r?r:Ce,row:a})
;if(this._isMobile||this._fixedColumns)return o.createElement(o.Fragment,null,u);let p=this._columnWidthChangeHandlers.get(l);return void 0===p&&(p=t=>this._setColumnWidth(l,t),this._columnWidthChangeHandlers.set(l,p)),o.createElement(ge,{onWidthChange:p,widthMeasurer:Se,maxWidth:ue.maxCellWidth},u)},this._makeRowContent=t=>o.createElement(ce,{...t,visibilityHandler:this._handleRowVisibilityChange}),this._handleRowVisibilityChange=(t,e)=>{e?this._visibleRows.add(t):this._visibleRows.delete(t)},this._makeRowAttributes=({rowKeyValue:t,rowData:e})=>{var s;const i=this._rowsDisplayOptions.get(t),r=null===(s=this._rowBadgeTypeInferrer)||void 0===s?void 0:s.call(this,e);return{className:et()(me.row,(null==i?void 0:i.isInactive)&&me.inactiveRow,(null==i?void 0:i.isLinked)&&me.linkedRow,void 0!==r&&ve[r],this._isFirstRow(t)&&me.withMargin,this._isLastRow(t)&&me.lastRow),"data-row-id":t,ref:e=>this._setRowElement(t,e),onClick:(t,e)=>{var s,i;null===(i=null===(s=this._rowEventsHandlers)||void 0===s?void 0:s.onClick)||void 0===i||i.call(s,e.childProps.rowData,this._isMobile)},onMouseEnter:(t,e)=>{var s,i;null===(i=null===(s=this._rowEventsHandlers)||void 0===s?void 0:s.onMouseEnter)||void 0===i||i.call(s,e.childProps.rowData,this._isMobile)},onMouseLeave:(t,e)=>{var s,i;null===(i=null===(s=this._rowEventsHandlers)||void 0===s?void 0:s.onMouseLeave)||void 0===i||i.call(s,e.childProps.rowData,this._isMobile)}}},this._setRowElement=(t,e)=>{this._rowsElements.set(t,e)},this._makeHeadCellContentAttributes=({column:t})=>{const{key:e}=t,s=this._columnsMetainfo.get(e);return{className:et()(me.headCellContent,("right"===(null==s?void 0:s.alignment)||"settings"===e)&&me.rightAlignedHeadCell)}},this._makeCellAttributes=({column:t,value:e})=>{const{title:s,key:i}=t,r=this._columnsMetainfo.get(i),o=!1===(null==r?void 0:r.showOnMobile)||!1===(null==r?void 0:r.showZeroValues)&&0===e||null==e;return{className:et()(me.cell,("right"===(null==r?void 0:r.alignment)||"settings"===i)&&me.rightAlignedCell,!1===(null==r?void 0:r.showLabelOnMobile)&&!1,o&&me.hideCellOnMobile,"settings"===i&&!this._isMobile&&me.fixedCell),"data-label":s}},this._makeCellContentAttributes=({column:t,rowData:e})=>{var s;const{key:i}=t,r=this._columnsMetainfo.get(i),o=void 0!==(null==r?void 0:r.tooltipProperty)?null===(s=e[r.tooltipProperty])||void 0===s?void 0:s[r.property]:void 0;return{className:et()(me.cellContent,void 0!==o&&"apply-common-tooltip common-tooltip-html",!1!==(null==r?void 0:r.isCapitalize)&&me.capitalize),title:o}},this._makeTableWrapperAttributes=()=>{var t;return{className:et()(me.tableWrapper,(null===(t=this._virtualization)||void 0===t?void 0:t.enabled)&&me.tableWrapperEmpty),onScroll:this._onTableScroll,key:this._tableWrapperKey}},this._onTableScroll=(t,{baseFunc:e})=>{this._update.cancel(),e(t),this._checkBottomIsVisible(t.currentTarget)},this._resizeHandler=({matches:t})=>{this._isMobile=t,this._visibleColumnsWithFormatters.clear(),this._columnsVisibilityInfo=this._makeColumnsVisibilityInfo(),this._columnsFilterProps=this._makeColumnsFilterProps(),
this._tableProps.columns=this._makeColumns(),this._rowHeightCache.clear(),this.onSizeChange.fire()},this._saveColumnsOrder=()=>{var t;const e=this._tableProps.columns.map(t=>t.key);null===(t=this._getSettingsStorage())||void 0===t||t.setTableColumnsOrder(this._id,e)};const{id:i,model:r,className:n,container:a,columns:l,virtualization:d,stickyMobileColumnsFilter:c,idProperty:h,overlapManager:u,initialSorting:p,rowBadgeTypeInferrer:_,fixedColumns:g,getSettingsStorage:b,rowEventsHandlers:v}=t;this._id=i,this._model=r,this._fixedColumns=g,this._sortingColumnKey=this._id+".sort.column",this._sortingModeKey=this._id+".sort.mode",this._container=a,this._idProperty=h,this._virtualization=d,this._overlapManager=u,this._isStickyMobileColumnsFilter=c,this._columnsMetainfo=new Map(l.map(t=>[t.property,t])),this._rowBadgeTypeInferrer=_,this._getSettingsStorage=b,this._rowEventsHandlers=v,this._checkBottomIsVisible=(0,Ot.default)(this._checkBottomIsVisible,100),this._update=(0,Dt.default)(this._render,1e3);const f=null!==(e=this._getSavedSortingParameters())&&void 0!==e?e:p;this._sortingColumn=null==f?void 0:f.columnId;const w=!1===(null==f?void 0:f.asc)?1:0;let C;this._sortingModeSwitcher=new fe(void 0===f?null:w),(null==d?void 0:d.enabled)&&(C={itemHeight:this._calculateRowHeight}),this._mobileMediaQuery=window.matchMedia(W.TradingLayoutBreakpoint.Mobile),this._isMobile=this._mobileMediaQuery.matches,(0,Bt.mediaQueryAddEventListener)(this._mobileMediaQuery,this._resizeHandler);const y="IntersectionObserver"in window;y||(this._isVisible=!0),this._containerVisibilityObserver=y?new IntersectionObserver(t=>{t.forEach(({intersectionRatio:t})=>{this._isVisible=0!==t,this._isVisible?this._render():this._resetTableVirtualScrollPosition(),this.onTableVisibilityChange.fire(this._isVisible)})}):null,null===(s=this._containerVisibilityObserver)||void 0===s||s.observe(this._container),this._columnsVisibilityInfo=this._makeColumnsVisibilityInfo(),this._columnsFilterProps=this._makeColumnsFilterProps(),this._tableProps={columns:this._makeColumns(),dispatch:this._updateTableProps,rowKeyField:this._idProperty,virtualScrolling:C,sortingMode:Vt.SortingMode.SingleTripleStateRemote,childComponents:{table:{elementAttributes:()=>({className:et()(me.table,n,void 0!==C&&me.withVirtualization),"data-selector":"table",style:{borderCollapse:"separate"}})},tableBody:{elementAttributes:()=>({className:me.tableBody})},tableHead:{elementAttributes:()=>({className:me.tableHead})},headRow:{elementAttributes:()=>({className:me.headRow})},headCell:{elementAttributes:this._makeHeadCellAttributes,content:t=>o.createElement(ae,{...t,dispatch:(0,Ot.default)(this._updateTableProps,15),onColumnsReordered:this._saveColumnsOrder,columnsReorderingEnabled:!this._isMobile})},cell:{elementAttributes:this._makeCellAttributes},tableWrapper:{elementAttributes:this._makeTableWrapperAttributes},dataRow:{content:this._makeRowContent,elementAttributes:this._makeRowAttributes},cellText:{content:this._makeCellContent,elementAttributes:this._makeCellContentAttributes},headCellContent:{
elementAttributes:this._makeHeadCellContentAttributes,content:this._makeHeadCellContent}}},this._render(),this._subscribeModel()}rowIdAtEvent(t){return function(t){if(void 0!==t.dataset.rowId)return t.dataset.rowId;let e=t.parentElement;for(;null!==e;){if(void 0!==e.dataset.rowId)return e.dataset.rowId;e=e.parentElement}}(t.target)}isRowInViewport(t){return this._visibleRows.has(t)}sortingColumn(){return this._sortingColumn}sortingMode(){return this._sortingModeSwitcher.value()}size(){return this._isMobile?0:1}highlightRowById(t){const e=this._rowElementById(t);void 0!==e&&(clearTimeout(this._highlightTimeoutIds.get(t)),e.classList.remove(me.highlightedRow),e.classList.add(me.highlightedRow),this._highlightTimeoutIds.set(t,setTimeout(()=>{e.classList.remove(me.highlightedRow)},700)))}addFormatter(t){this._formatters.set(t.name,t)}setColumnAvailable(t,e){if(this._setColumnAvailableInFilter(t,e),e){const e=this._isMobile?".invisibleMobileColumns":".invisibleColumns";if(f.getJSON(`${this._id}${e}`,[]).includes(t))return}this._setColumnVisibility(t,e)}setHeight(t){void 0!==this._tableProps.virtualScrolling&&(this._tableProps.virtualScrolling={...this._tableProps.virtualScrolling,tbodyHeight:t}),this._tableProps.childComponents={...this._tableProps.childComponents,tableWrapper:{elementAttributes:()=>({...this._makeTableWrapperAttributes(),style:{height:t}})}},this._render()}setRowInactiveById(t,e){var s;(null===(s=this._rowsDisplayOptions.get(t))||void 0===s?void 0:s.isInactive)!==e&&(this._setRowInactiveById(t,e),this._render())}setRowInactiveByFilter(t){this._model.data().forEach((e,s)=>this._setRowInactiveById(s,t(e))),this._render()}setRowLinkedById(t,e){var s;(null===(s=this._rowsDisplayOptions.get(t))||void 0===s?void 0:s.isLinked)!==e&&(this._setRowLinkedById(t,e),this._render())}setRowLinkedByFilter(t){this._model.data().forEach((e,s)=>this._setRowLinkedById(s,t(e))),this._render()}destroy(){var t;(0,Bt.mediaQueryRemoveEventListener)(this._mobileMediaQuery,this._resizeHandler),this._unsubscribeModel(),null===(t=this._containerVisibilityObserver)||void 0===t||t.disconnect(),n.unmountComponentAtNode(this._container)}exportData(){const t=[...this._columnsVisibilityInfo.values()];return this._model.rows().map(e=>{const s={};for(const{isVisible:i,label:r,property:o}of t){if(!i||"settings"===o)continue;const t=this._makeTextContent({field:o,value:e[o],rowData:e});s[r]=t||""}return s})}_setRowInactiveById(t,e){this._updateRowDisplayOptions(t,{isInactive:e})}_setRowLinkedById(t,e){this._updateRowDisplayOptions(t,{isLinked:e})}_rowElementById(t){var e;return null!==(e=this._rowsElements.get(t))&&void 0!==e?e:void 0}_makeColumns(){const t=new Map;for(const[e,s]of this._columnsMetainfo){const{isVisible:i,isVisibleOnMobile:r,forceInvisible:o}=(0,l.ensureDefined)(this._columnsVisibilityInfo.get(e));this._isMobile||this._fixedColumns||void 0!==this._columnsWidth.get(e)||this._columnsWidth.set(e,Se(s.label)+ue.cellLateralPadding);const n={key:e,title:s.label,visible:(this._isMobile?r:i)&&!o,style:{
minWidth:this._isMobile?void 0:ue.minCellWidth,maxWidth:this._isMobile?void 0:ue.maxCellWidth}},a=this._sortingModeSwitcher.value();e===this._sortingColumn&&null!==a&&(n.sortDirection=be[a]),t.set(n.key,n)}const e=this._getSavedColumnsOrder();return this._columnsMetainfo.has("settings")||t.set("settings",{key:"settings",title:"",visible:!0}),this._isMobile||void 0===e?[...t.values()]:this._reorderColumns(e,t)}_resetTableVirtualScrollPosition(){void 0!==this._tableProps.virtualScrolling&&(this._tableProps.virtualScrolling={...this._tableProps.virtualScrolling,scrollTop:0},this._tableWrapperKey=(0,Lt.randomHashN)(5),this._render(!0))}_render(t=!1){if(!t&&!this._isVisible)return;const e=this._model.rows();let s=[];this._isMobile&&0!==e.length&&(s=this._getAvailableColumnsFilterItems()),n.render(o.createElement(o.Fragment,null,0!==s.length&&o.createElement(te,{...this._columnsFilterProps,items:s}),o.createElement(kt.DndProvider,{backend:Rt.HTML5Backend},o.createElement(Ut.Table,{...this._tableProps,dispatch:this._updateTableProps,data:e}))),this._container)}_updateRowDisplayOptions(t,e){const s=this._rowsDisplayOptions.get(t);this._rowsDisplayOptions.set(t,{...s,...e})}_handleSortingUpdate(t){t===this._sortingColumn?this._sortingModeSwitcher.next():(this._sortingColumn=t,this._sortingModeSwitcher.reset()),this._updateSortingColumnSettings(),this.onSortingChange.fire({column:t,mode:this._sortingModeSwitcher.value()})}_updateSortingColumnSettings(){const t=this._sortingModeSwitcher.value();if(null===t)return f.remove(this._sortingColumnKey),void f.remove(this._sortingModeKey);f.setValue(this._sortingColumnKey,this._sortingColumn),f.setValue(this._sortingModeKey,t)}_getSavedSortingParameters(){const t=f.getValue(this._sortingColumnKey);if(void 0===t)return;return{columnId:t,asc:0===f.getInt(this._sortingModeKey)}}_setColumnAvailableInFilter(t,e){e?this._hiddenFilterColumns.delete(t):this._hiddenFilterColumns.add(t)}_makeColumnsVisibilityInfo(){const t=new Map,e=[...this._columnsMetainfo.values()].filter(t=>t.hideByDefault).map(t=>t.property),s=f.getJSON(this._id+".invisibleColumns",e),i=f.getJSON(this._id+".invisibleMobileColumns",e);return this._columnsMetainfo.forEach(e=>{var r;const o=s.includes(e.property),n=i.includes(e.property);(this._isMobile?n:o)?this._visibleColumnsWithFormatters.delete(e.property):this._visibleColumnsWithFormatters.set(e.property,null!==(r=e.formatter)&&void 0!==r?r:"text"),t.set(e.property,{isVisible:!o,isVisibleOnMobile:!n,isAlwaysVisible:!0===e.notHideable,property:e.property,label:e.label})}),t}_isFirstRow(t){var e;return t===(null===(e=this._model.rows()[0])||void 0===e?void 0:e[this._idProperty])}_isLastRow(t){var e;const s=this._model.rows();return t===(null===(e=s[s.length-1])||void 0===e?void 0:e[this._idProperty])}_checkBottomIsVisible(t){const e=t.querySelector('[data-selector="table"]');if(null===e)return;const{bottom:s}=e.getBoundingClientRect(),i=window.innerHeight-s>=-100;this.onBottomVisibilityChange.fire(i)}_makeColumnsFilterProps(){return{
items:[...this._columnsVisibilityInfo.values()].filter(t=>"settings"!==t.property&&!t.isAlwaysVisible).map(t=>({id:t.property,title:t.label,visible:(this._isMobile?t.isVisibleOnMobile:t.isVisible)&&!t.forceInvisible})),onCheck:t=>this._toggleColumnVisibility(t),overlapManagerWV:this._overlapManager,isSticky:this._isStickyMobileColumnsFilter}}_toggleColumnVisibility(t){const e=!this._visibleColumnsWithFormatters.has(t);this._setColumnVisibility(t,e);const s=`${this._id}${this._isMobile?".invisibleMobileColumns":".invisibleColumns"}`,i=new Set(f.getJSON(s,[]));e?i.delete(t):i.add(t),f.setJSON(s,[...i])}_setColumnVisibility(t,e){var s,i;e?this._visibleColumnsWithFormatters.set(t,null!==(i=null===(s=this._columnsMetainfo.get(t))||void 0===s?void 0:s.formatter)&&void 0!==i?i:"text"):this._visibleColumnsWithFormatters.delete(t);const r=this._columnsVisibilityInfo.get(t);void 0!==r&&(this._isMobile?this._columnsVisibilityInfo.set(t,{...r,isVisibleOnMobile:e&&!r.forceInvisible}):this._columnsVisibilityInfo.set(t,{...r,isVisible:e&&!r.forceInvisible}),this._columnsFilterProps=this._makeColumnsFilterProps()),void 0!==this._tableProps.virtualScrolling&&this._rowHeightCache.clear(),this._updateTableProps({type:e?Vt.ActionType.ShowColumn:Vt.ActionType.HideColumn,columnKey:t})}_getAvailableColumnsFilterItems(){return this._columnsFilterProps.items.filter(t=>!this._hiddenFilterColumns.has(t.id))}_subscribeModel(){this._model.onRowChanged.subscribe(this,this._invalidateRowCache),this._model.onRowsChanged.subscribe(this,this._handleEmptyRows),this._model.onRowsChanged.subscribe(this,this._update)}_unsubscribeModel(){this._model.onRowChanged.unsubscribe(this,this._invalidateRowCache),this._model.onRowsChanged.unsubscribe(this,this._handleEmptyRows),this._model.onRowsChanged.unsubscribe(this,this._update)}_reorderColumns(t,e){const s=new Map(e),i=s.get("settings");s.delete("settings");const r=[];for(const e of t){const t=s.get(e);void 0!==t&&(r.push(t),s.delete(e))}return r.push(...s.values()),void 0!==i&&r.push(i),r}_getSavedColumnsOrder(){var t;return null===(t=this._getSettingsStorage())||void 0===t?void 0:t.tableColumnsOrder(this._id)}}var xe=s(67761);class Ee extends q{constructor(t){const e=Mt({withScroll:!0}),s=[],i=[],r=[];t.tables.forEach(o=>{var n,a,l;const d=Mt({withScroll:!0,fitContent:1!==t.tables.length}),c=document.createElement("div"),h=new At({options:o.options,priceFormatterGetter:o.priceFormatterFn,reverse:null===(n=o.flags)||void 0===n?void 0:n.reverse,columns:o.columns}),u=new Te({id:o.id,model:h,container:c,columns:o.columns,idProperty:o.options.idProperty,className:o.options.className,stickyMobileColumnsFilter:!0,overlapManager:t.overlapManager,initialSorting:o.initialSorting,fixedColumns:null===(a=o.flags)||void 0===a?void 0:a.fixedColumns,getSettingsStorage:t.getTableSettingsStorage,rowEventsHandlers:o.rowEventsHandlers});if(o.title){const t=function(t){const e=document.createElement("h3");return e.className=xe.title,e.textContent=t,e}(o.title);d.appendChild(t)}d.appendChild(c),e.appendChild(d);const p=new j({
idProperty:o.options.idProperty,name:o.title||void 0,model:h,view:u,source:o.source,subscriptions:o.subscriptions,supportPagination:null===(l=o.flags)||void 0===l?void 0:l.supportPagination});i.push(h),r.push(u),s.push(p),p.addFormatters(o.formatters.concat(xt)),p.start()});const o={id:t.id,name:t.title,headerCounter:!1};super(e,o,s),this._tableViewModels=i,this._tableViews=r,this._contentPage=e}setHeight(t){var e,s;if(1===this._tableControllers.length){const i=null!==(s=null===(e=this._contentPage.getElementsByTagName("h3")[0])||void 0===e?void 0:e.offsetHeight)&&void 0!==s?s:0;this._tableControllers[0].setHeight(t-i)}}destroy(){this._tableViewModels.forEach(t=>t.destroy()),this._tableViews.forEach(t=>t.destroy()),super.destroy()}}const Fe=[{label:(0,r.t)("Time"),property:"time",formatter:"localDate"},{label:(0,r.t)("Title"),property:"title"},{label:(0,r.t)("Text"),property:"text"}];class Me extends q{constructor(t,e,s){super(t,e,s),s.forEach(t=>t.addFormatters(e.formatters.concat(xt)))}}function De(t){return""===t||null==t}const Pe=2*ue.mobileRowPadding+ue.mobileRowBorderSize;function Ae(t,e){let s=Pe;for(const[i,r]of e.entries()){De(t[i])||(s+=22)}return s}function ke(t,e){let s=Pe;for(const i of e.keys()){De(t[i])||(s+=22)}return s}class Re extends Me{constructor(t){const e=Mt(),s=new At({options:{idProperty:"id"},priceFormatterGetter:t.priceFormatterFn,columns:t.columns}),i=new Te({id:t.id,model:s,container:e,columns:t.columns,idProperty:"id",virtualization:{enabled:!0,rowHeightParams:{mobile:ke}},overlapManager:t.overlapManager,initialSorting:t.initialSorting,rowBadgeTypeInferrer:t.rowBadgeTypeInferrer,getSettingsStorage:t.getTableSettingsStorage}),r=new j({idProperty:"id",model:s,view:i,source:t.source,subscriptions:t.subscriptions});super(e,{id:t.id,name:t.title,headerCounter:!1,formatters:t.formatters},[r]),this._tableViewModel=s,this._tableView=i,r.start()}destroy(){this._tableViewModel.destroy(),this._tableView.destroy(),super.destroy()}}class Oe{constructor(t,e,s,i){this.filterFullUpdateDelegate=new(m()),this.filterObjectUpdateDelegate=new(m()),this.filterObjectDeleteDelegate=new(m()),this._filteredObjects=[],this._requestsCount=0,this._started=!1,this._objectsRequest=null,this._source=t,this._objectUpdateDelegate=e,this._objectDeleteDelegate=s,this._fullUpdateDelegate=i}start(){this._requestsCount++;const t=this._source,e=this._objectsRequest||Promise.resolve([]);this._objectsRequest=e.then(()=>t()).then(t=>{const e=t.filter(t=>this._satisfy(t));return this._requestsCount--,this._requestsCount||(this.stop(),this._filteredObjects=e,this._objectsRequest=null,this._objectUpdateDelegate.subscribe(this,this._onObjectUpdated),this._objectDeleteDelegate&&this._objectDeleteDelegate.subscribe(this,this._onObjectDeleted),this._fullUpdateDelegate.subscribe(this,this._onFullUpdate),this._started=!0),e.slice(0)})}stop(){this._objectUpdateDelegate.unsubscribe(this,this._onObjectUpdated),this._fullUpdateDelegate.unsubscribe(this,this._onFullUpdate),
this._objectDeleteDelegate&&this._objectDeleteDelegate.unsubscribe(this,this._onObjectDeleted),this._filteredObjects=[],this._started=!1}isStarted(){return this._started}filterSource(){return this._objectsRequest?this._objectsRequest:Promise.resolve(this._filteredObjects.slice(0))}_satisfy(t){throw new Error("should be implemented")}_onFullUpdate(){this.stop(),this.start(),this.filterFullUpdateDelegate.fire()}_onObjectDeleted(t){const e=this._filteredObjects.find(e=>e.id===t);e&&this.filterObjectDeleteDelegate.fire(e.id)}_onObjectUpdated(t){const e=this._filteredObjects.find(e=>e.id===t.id),s=e?this._filteredObjects.indexOf(e):-1;this._satisfy(t)?(e?this._filteredObjects[s]=t:this._filteredObjects.push(t),this.filterObjectUpdateDelegate.fire(t)):e&&(this.filterObjectDeleteDelegate.fire(e.id),this._filteredObjects.splice(s,1))}}class Ie extends j{constructor(t){super(t),this._onLinkingBound=this._onLinking.bind(this),d.linking.proSymbol.subscribe(this._onLinkingBound)}destroy(){d.linking.proSymbol.unsubscribe(this._onLinkingBound),super.destroy()}_update(t){if(!super._update(t))return!1;const e=d.linking.proSymbol.value();return this.setRowLinkedById(t.id,e===t.symbol),!0}_onCreated(){this.setRowLinkedByFilter(t=>t.symbol===d.linking.proSymbol.value())}_onLinking(t){this.setRowLinkedByFilter(e=>e.symbol===t)}}var Be=s(85410);function Ue(t,e){const s=document.createElement("div");s.className="tv-tabs tv-tabs--no-border tv-tabs--secondary-active tv-tabs--no-margin tv-tabs--semi-compact";for(const i of t){const t=document.createElement("div");t.className="tv-tabs__tab "+i.id;const r=document.createElement("div");r.className="tv-tabs__wrap";const o=document.createElement("div");o.className=Be.counter;const n=document.createElement("div");n.className=Be.text,n.textContent=i.name;const a=document.createElement("div");a.className=`${Be.count} js-counter-category-${i.id} js-counter-count`;const l=null==e?void 0:e[i.id];void 0!==l&&a.classList.add(l),a.textContent="0",o.appendChild(n),o.appendChild(a),r.appendChild(o),t.appendChild(r),s.appendChild(t)}return s}var Ve=s(52130),Le=s(72571),Ne=s(24818),We=s(2627),He=s(44114),je=s(72351),Ge=s(6467);function qe(t){const{closeFn:e,closeTitle:s,isDisabled:i}=t;return o.createElement(Gt.ToolWidgetButton,{className:We.icon,title:null!=s?s:(0,r.t)("Close",{context:"position"}),icon:je,onClick:t=>{t.stopPropagation(),e()},isDisabled:i})}function ze(t){const{editFn:e,editTitle:s,isDisabled:i}=t;return o.createElement(Gt.ToolWidgetButton,{className:We.icon,title:null!=s?s:(0,r.t)("Edit"),icon:He,onClick:()=>e(),isDisabled:i})}const $e={[Ne.OrderOrPositionMessageType.Information]:We.information,[Ne.OrderOrPositionMessageType.Warning]:We.warning,[Ne.OrderOrPositionMessageType.Error]:We.error};function Qe(t){const{type:e,text:s}=t;return o.createElement(Le.Icon,{className:et()("apply-common-tooltip",We.message,$e[e]),title:s,icon:Ge})}function Je(t){const[e,s]=(0,o.useState)(!1),i=(0,Ve.useIsMounted)(),{closeFn:r,closeTitle:n,editFn:a,editTitle:l,message:d}=t;return o.createElement("span",{
className:We.wrapper},void 0!==d&&o.createElement(Qe,{...d}),void 0!==a&&o.createElement(ze,{editFn:a,editTitle:l,isDisabled:e}),void 0!==r&&o.createElement(qe,{closeFn:async function(){try{s(!0),await(null==r?void 0:r())}finally{i.current&&s(!1)}},closeTitle:n,isDisabled:e}))}class Ke{constructor(t,e,s,i){this._source=t,this._totalCount=0,this._activeCount=0,this._orderUpdateDelegate=e,this._fullUpdateDelegate=s,this._possibleStatuses=i,this._statusCount=this._emptyStatuses(),this.countChanged=new(m()),this._recalcCountsDelayed=(0,Ot.default)(this._recalcCounts.bind(this),100)}start(){this._orderUpdateDelegate.subscribe(this,this._recalcCountsDelayed),this._fullUpdateDelegate.subscribe(this,this._recalcCountsDelayed),this._recalcCounts()}stop(){this._statusCount=this._emptyStatuses(),this._orderUpdateDelegate.unsubscribe(this,this._recalcCountsDelayed),this._fullUpdateDelegate.unsubscribe(this,this._recalcCountsDelayed)}_emptyStatuses(){const t={};return this._possibleStatuses.forEach(e=>{t[e]=0}),t}_recalcCounts(){const t=this._emptyStatuses();this._source().then(e=>{let s=0;e.forEach(e=>{const i=t[e.status];void 0!==i&&(t[e.status]=i+1,6!==e.status&&3!==e.status||s++)}),this._possibleStatuses.forEach(e=>{t[e]!==this._statusCount[e]&&(this._statusCount[e]=t[e],this.countChanged.fire(e,(0,l.ensureDefined)(this._statusCount[e])))}),this._totalCount!==e.length&&(this._totalCount=e.length,this.countChanged.fire(0,this._totalCount)),this._activeCount!==s&&(this._activeCount=s,this.countChanged.fire(-1,this._activeCount))})}}class Xe extends Oe{constructor(t,e,s,i){super(t,e,s,i),this._filterStatus=null}setFilterStatus(t){this._filterStatus=t,this.isStarted()&&(this.stop(),this.start())}filterStatus(){return this._filterStatus}_satisfy(t){return!this._filterStatus||t.status===this._filterStatus}}class Ye extends Oe{constructor(t,e,s,i,r){super(t,e,s,i),this._functor=r}_satisfy(t){return this._functor(t)}}class Ze{constructor(t,e,s){this._orders=[],this._source=t,this._rowUpdateDelegate=e,this._fullUpdateDelegate=s,this._orders=[],this.newStatusDelegate=new(m())}start(){this._source().then(t=>{this._orders=t.slice(0),this._rowUpdateDelegate.subscribe(this,this._onRowUpdated),this._fullUpdateDelegate.subscribe(this,this._onFullUpdate)})}stop(){this._fullUpdateDelegate.unsubscribe(this,this._onFullUpdate),this._rowUpdateDelegate.unsubscribe(this,this._onRowUpdated),this._orders=[]}_onFullUpdate(){this.stop(),this.start()}_onRowUpdated(t){const e=this._orders.find(e=>e.id===t.id);e&&e.status===t.status||(this.newStatusDelegate.fire(t),e?e.status=t.status:this._orders.push(Object.assign({},t)))}}class ts extends Ie{constructor(t){super(t),this._title=t.title,this._getFilterStatus=t.filterStatusGetter,this._isAlwaysActive=t.isAlwaysActive}fullUpdate(){return this._fullUpdate()}getDataExporter(){const t=super.getDataExporter(),e=this._getFilterStatus(),s=null!==e?(0,R.orderStatusToText)(e):(0,r.t)("All");return t.name=`${this._title} ${s}`,t}_update(t){
return!!super._update(t)&&(this.setRowInactiveById(t.id,!this._filterByStatus(t.status)),!0)}_onCreated(){super._onCreated(),this.setRowInactiveByFilter(t=>!this._filterByStatus(t.status))}_filterByStatus(t){return this._isAlwaysActive||null!==this._getFilterStatus()||(0,R.isOrderActive)(t)}}const es={"orderstatus-working":Be.blue,"orderstatus-inactive":Be.grey,"orderstatus-filled":Be.green,"orderstatus-cancelled":Be.orange,"orderstatus-rejected":Be.red},ss=["formatPrice","formatPriceForexSup"];class is extends q{constructor(t){const e=t.formatters||[],s=new Ye(t.source,t.subscriptions.rowUpdateDelegate,null,t.subscriptions.fullUpdateDelegate,t.filter),i=new Ke(s.filterSource.bind(s),s.filterObjectUpdateDelegate,s.filterFullUpdateDelegate,t.possibleOrderStatuses),n=new Xe(s.filterSource.bind(s),s.filterObjectUpdateDelegate,s.filterObjectDeleteDelegate,s.filterFullUpdateDelegate),a=t.subscriptions.fullUpdateDelegate;t.source=n.filterSource.bind(n),t.subscriptions.rowUpdateDelegate=n.filterObjectUpdateDelegate,t.subscriptions.rowDeleteDelegate=n.filterObjectDeleteDelegate,t.subscriptions.fullUpdateDelegate=n.filterFullUpdateDelegate;const d=Mt(),c={group:t=>+(0,R.isOrderActive)(t.status),idProperty:"id"},h=t.columns.map(t=>ss.includes(t.formatter)?{...t,showZeroValues:!1}:t),u=[...h,{label:"",property:"settings",formatter:"orderSettings",notSortable:!0,showOnMobile:!1}],p=new At({columns:u,priceFormatterGetter:t.priceFormatterFn,options:c}),_=new Te({id:t.tableId,model:p,className:"orders",container:d,columns:u,idProperty:"id",virtualization:{enabled:!0,rowHeightParams:{mobile:Ae}},overlapManager:t.overlapManager,initialSorting:t.initialSorting,getSettingsStorage:t.getTableSettingsStorage,rowEventsHandlers:t.tableRowEventsHandlers}),g={id:t.id,name:t.title,headerCounter:t.headerCounter},m=new ts({idProperty:"id",title:t.title,model:p,view:_,source:t.source,subscriptions:t.subscriptions,filterStatusGetter:()=>this._ordersFilter.filterStatus(),isAlwaysActive:t.isAlwaysActive});super(d,g,[m]),this._tableViewModel=p,this._tableView=_,this._tableController=m,this._globalFullUpdateDelegate=a,this._statusWatcher=new Ze(s.filterSource.bind(s),s.filterObjectUpdateDelegate,s.filterFullUpdateDelegate),this._orderPreFilter=s,this._ordersFilter=n,this._statusesCount=i,this._activeCount=0,this._highlightChanges=t.highlightChanges,this._possibleOrderStatuses=t.possibleOrderStatuses,this._columns=h,this._pendingNewOrdersByStatuses={},this._configFlags=t.configFlags,this._closeFn=e=>((0,l.ensureNotNull)((0,B.tradingService)()).trackEvent("Orders Page","Cancel Order"),t.cancelFn(e)),this._editFn=(e,s,i,r)=>((0,l.ensureNotNull)((0,B.tradingService)()).trackEvent("Orders Page","Edit Order"),t.modifyFn(e,s,i,r));const b={name:"orderSettings",formatElement:({row:t})=>{const e=t,s=""===e.symbol||!(0,R.isOrderActive)(e.status),i=s&&this._isPlacingOrderCancellingDisabled(e.status)?void 0:()=>this._closeFn(e.id),n=s||!(0,R.isModifyOrderSupported)(e,this._configFlags)?void 0:()=>this._editFn(e);return o.createElement(Je,{closeFn:i,closeTitle:(0,
r.t)("Cancel"),editFn:n,editTitle:(0,V.appendEllipsis)((0,r.t)("Modify Order")),message:e.message})},formatText:()=>""};m.addFormatters([...xt,b,...e]);const v=this._possibleOrderStatuses.map(this._translateStatus);this._filter=Ue([{id:"status-all",name:(0,r.t)("All")}].concat(v),es),this._filterTabs=new x(this._filter,void 0,{noSlider:!0}),this._subscribeUpdates()}destroy(){this._unsubscribeUpdates(),this._tableViewModel.destroy(),this._tableView.destroy(),super.destroy()}contextItems(t){const e=this._tableController.rowIdAtEvent(t);if(void 0===e)return[];const s=this._tableController.rowById(e);if(void 0===s||""===s.symbol)return[];const i=[];return(0,R.isModifyOrderSupported)(s,this._configFlags)&&i.push({text:(0,V.appendEllipsis)((0,r.t)("Modify Order")),enabled:(0,R.isOrderActive)(s.status),action:()=>this._editFn(s)}),i.push({text:(0,r.t)("Cancel Order"),enabled:(0,R.isOrderActive)(s.status)||!this._isPlacingOrderCancellingDisabled(s.status),action:()=>this._closeFn(e)}),i}contextRow(t){return this._tableController.rowAtEvent(t)}topline(){return this._filter}get filter(){return this._filter}_subscribeUpdates(){this._tableController.start(),this._orderPreFilter.start(),this._ordersFilter.start(),this._statusesCount.start(),this._statusWatcher.start(),this._statusWatcher.newStatusDelegate.subscribe(this,this._onNewStatus),this._filterTabs.tabChanged.subscribe(this,this._onFilterChanged),this._statusesCount.countChanged.subscribe(this,this._onCountChanged),this._globalFullUpdateDelegate.subscribe(this,this._onGlobalFullUpdate)}_unsubscribeUpdates(){this._statusWatcher.newStatusDelegate.unsubscribe(this,this._onNewStatus),this._statusWatcher.stop(),this._ordersFilter.stop(),this._statusesCount.stop(),this._tableController.stop(),this._filterTabs.tabChanged.unsubscribe(this,this._onFilterChanged),this._statusesCount.countChanged.unsubscribe(this,this._onCountChanged),this._globalFullUpdateDelegate.unsubscribe(this,this._onGlobalFullUpdate)}_onGlobalFullUpdate(){this._pendingNewOrdersByStatuses={},this._updateFiltersActiveState()}_count(){this._setCount(this._activeCount)}_translateStatus(t){const e=(0,R.orderStatusToText)(t),s=e[0].toUpperCase()+e.slice(1);return{id:rs(t),name:s}}_onFilterChanged(t){const e=0===t?null:this._possibleOrderStatuses[t-1];(0,l.ensureNotNull)((0,B.tradingService)()).trackEvent("Orders Page","Order status filter",null!==e?(0,R.orderStatusToText)(e):void 0),this._ordersFilter.setFilterStatus(e),this._columns.filter(t=>t.hasOwnProperty("supportedStatusFilters")).forEach(t=>{var s;void 0!==t.supportedStatusFilters&&this._tableController.setColumnAvailable(t.property,t.supportedStatusFilters.includes(null!==(s=e)&&void 0!==s?s:0))}),this._tableController.fullUpdate().then(()=>{if(e){const t=this._pendingNewOrdersByStatuses[e];void 0!==t&&t.forEach(t=>this._tableController.highlightRowById(t))}this._removeActiveState()})}_onCountChanged(t,e){const s=this._filter.querySelectorAll(".js-counter-count");if(0===t)return void(s[0].textContent=String(e))
;if(-1===t&&this._activeCount!==e)return this._activeCount=e,void this._count();const i=this._possibleOrderStatuses.indexOf(t);-1!==i&&(s[i+1].textContent=String(e))}_onNewStatus(t){var e;4!==t.status&&(this._possibleOrderStatuses.forEach(e=>{const s=this._pendingNewOrdersByStatuses[e];if(void 0!==s){const e=s.indexOf(t.id);-1!==e&&s.splice(e,1)}}),this._pendingNewOrdersByStatuses[t.status]||(this._pendingNewOrdersByStatuses[t.status]=[]),null===(e=this._pendingNewOrdersByStatuses[t.status])||void 0===e||e.push(t.id),setTimeout(()=>{var e;const s=this._ordersFilter.filterStatus();let i=!1;s&&s!==t.status||this._tableController.isRowInViewport(t.id)&&(this._tableController.highlightRowById(t.id),i=!0),i||this._pendingNewOrdersByStatuses[t.status]&&-1!==(null===(e=this._pendingNewOrdersByStatuses[t.status])||void 0===e?void 0:e.indexOf(t.id))&&this._updateFiltersActiveState(),this._scheduleRemoveActiveState()},0))}_scheduleRemoveActiveState(){this._activeStateRemovalScheduled||(this._activeStateRemovalScheduled=!0,setTimeout(()=>this._removeActiveState(),1e3))}_removeActiveState(){this._activeStateRemovalScheduled=!1;const t=this._ordersFilter.filterStatus();t?this._pendingNewOrdersByStatuses[t]=[]:this._pendingNewOrdersByStatuses={},this._updateFiltersActiveState()}_updateFiltersActiveState(){this._highlightChanges&&this._possibleOrderStatuses.forEach(t=>{var e,s;const i=this._pendingNewOrdersByStatuses[t]&&(null===(e=this._pendingNewOrdersByStatuses[t])||void 0===e?void 0:e.length);null===(s=this._filter.querySelector(".js-counter-category-"+rs(t)))||void 0===s||s.classList.toggle("i-active",!!i)})}_isPlacingOrderCancellingDisabled(t){return!this._configFlags.supportPlacingOrderCancelling||4!==t}}function rs(t){switch(t){case 2:return"orderstatus-filled";case 1:return"orderstatus-cancelled";case 6:return"orderstatus-working";case 3:return"orderstatus-inactive";case 4:return"orderstatus-placing";case 5:return"orderstatus-rejected";default:return"orderstatus-unknown"}}var os=s(81334);class ns{constructor(t,e,s){this._totalCount=0,this._recalcCountsDelayed=(0,Ot.default)(this._recalcCounts.bind(this),100),this._source=t,this._rowUpdateDelegate=e,this._fullUpdateDelegate=s,this.countChanged=new(m())}start(){this._rowUpdateDelegate.subscribe(this,this._recalcCountsDelayed),this._fullUpdateDelegate.subscribe(this,this._recalcCountsDelayed),this._recalcCounts()}stop(){this._rowUpdateDelegate.unsubscribe(this,this._recalcCountsDelayed),this._fullUpdateDelegate.unsubscribe(this,this._recalcCountsDelayed)}_recalcCounts(){this._source().then(t=>{const e=t.filter(t=>L(t));this._totalCount!==e.length&&(this._totalCount=e.length,this.countChanged.fire(this._totalCount))})}}function as(t){const{id:e,name:s,content:i,source:r,subscriptions:o,columns:n,priceFormatterFn:a,rowEventsHandlers:l,overlapManager:d,getTableSettingsStorage:c}=t,h=new At({priceFormatterGetter:a,columns:n,options:{idProperty:"id"}}),u=new Te({id:e,model:h,className:"positions",container:i,columns:n,idProperty:"id",virtualization:{enabled:!0,rowHeightParams:{
mobile:Ae}},getSettingsStorage:c,overlapManager:d,rowEventsHandlers:l});return{model:h,view:u,controller:new ls({idProperty:"id",name:s,model:h,view:u,source:r,subscriptions:o})}}class ls extends Ie{_update(t){return L(t)?super._update(t):(this._deleteRow(t.id),!0)}}const ds=["formatPrice","formatPriceForexSup"],cs=(0,r.t)("Positions"),hs=(0,r.t)("Net Positions"),us=(0,r.t)("Individual Positions");class ps extends q{constructor(t){const e=function(){const t=document.createElement("div");return t.classList.add(os.pageContainer),t}(),s={id:"positions",name:cs,headerCounter:!0},i=Mt(),n=t.positions.columns.map(t=>ds.includes(t.formatter)?{...t,showZeroValues:!1}:t);n.push({label:"",property:"settings",formatter:"posSettings",notSortable:!0,showOnMobile:!1});const a=as({id:t.brokerId+".positions",name:t.trades?hs:cs,content:i,source:t.positions.source,subscriptions:Object.assign({},t.positions.subscriptions,{fullUpdateDelegate:t.fullUpdateDelegate}),columns:n,priceFormatterFn:t.priceFormatterFn,overlapManager:t.overlapManager,getTableSettingsStorage:t.getTableSettingsStorage,rowEventsHandlers:t.tableRowEventsHandlers});e.appendChild(i);const d=[a.controller];let c,h=null;if(t.trades){const s=t.trades.columns.map(t=>ds.includes(t.formatter)?{...t,showZeroValues:!1}:t);s.push({label:"",property:"settings",formatter:"tradeSettings",notSortable:!0,showOnMobile:!1}),h=Mt(),c=as({id:t.brokerId+".trades",name:us,content:h,source:t.trades.source,subscriptions:Object.assign({},t.trades.subscriptions,{fullUpdateDelegate:t.fullUpdateDelegate}),columns:s,priceFormatterFn:t.priceFormatterFn,overlapManager:t.overlapManager,getTableSettingsStorage:t.getTableSettingsStorage,rowEventsHandlers:t.tableRowEventsHandlers}),e.appendChild(h),d.push(c.controller)}super(e,s,d),this._positionsTableContainer=i,this._tradesTableContainer=h,this._positionsTableController=a.controller,this._positionsTableViewModel=a.model,this._positionsTableView=a.view,this._tradesTableController=null==c?void 0:c.controller,this._tradesTableViewModel=null==c?void 0:c.model,this._tradesTableView=null==c?void 0:c.view;const u=t.formatters||[];this._fullUpdateDelegate=t.fullUpdateDelegate,this._posSubscriptions=t.positions.subscriptions,this._checkSupportTrades=t.checkSupportTrades,this._storeFunctions(t);const p={name:"posSettings",formatElement:({row:{id:t,message:e,symbol:s}})=>{const i=""===s,n=i||null===this._closePositionFn?void 0:this._closePositionFn.bind(null,t),a=i||null===this._editPositionFn?void 0:this._editPositionFn.bind(null,t);return o.createElement(Je,{closeFn:n,closeTitle:(0,r.t)("Close",{context:"position"}),editFn:a,editTitle:(0,V.appendEllipsis)((0,r.t)("Protect Position")),message:e})},formatText:()=>""};if(this._positionsTableController.addFormatters([p,...xt,...u]),t.trades){const e={name:"tradeSettings",formatElement:({row:{id:t,message:e,canBeClosed:s,symbol:i}})=>{const n=""===i,a=n||null===this._closeTradeFn||!s?void 0:this._closeTradeFn.bind(null,t),l=n||null===this._editTradeFn?void 0:this._editTradeFn.bind(null,t)
;return o.createElement(Je,{closeFn:a,closeTitle:(0,r.t)("Close",{context:"position"}),editFn:l,editTitle:(0,V.appendEllipsis)((0,r.t)("Protect Position")),message:e})},formatText:()=>""};(0,l.ensure)(this._tradesTableController).addFormatters([e,...xt,...u]),this._tradesCounter=new ns(t.trades.source,t.trades.subscriptions.countUpdateDelegate,this._fullUpdateDelegate)}else this._tradesCounter=null;this._positionsCounter=new ns(t.positions.source,this._posSubscriptions.countUpdateDelegate,this._fullUpdateDelegate),this._constructFilter(),this._subscribeUpdates();const _=f.getInt("Trading.PositionsTable.Filter",0),g=this._checkSupportTrades()?_:1;this._filterTabs.setActivePage(g),this._selectPage(g)}contextItems(t){const e=this._activeTableController(),s=e.rowIdAtEvent(t);if(void 0===s)return[];const i=(0,l.ensureDefined)(e.rowById(s));if(""===i.symbol)return[];const o=[];return 0===this._filterTabs.index()?(this._editTradeFn&&o.push({text:(0,V.appendEllipsis)((0,r.t)("Protect Position")),action:this._editTradeFn.bind(null,s)}),this._closeTradeFn&&i.canBeClosed&&o.push({text:(0,r.t)("Close Position"),action:this._closeTradeFn.bind(null,s)}),o):(this._editPositionFn&&o.push({text:(0,V.appendEllipsis)((0,r.t)("Protect Position")),action:this._editPositionFn.bind(null,s)}),this._closePositionFn&&o.push({text:(0,r.t)("Close Position"),action:this._closePositionFn.bind(null,s)}),this._reversePositionFn&&o.push({text:(0,r.t)("Reverse Position"),action:this._reversePositionFn.bind(null,s)}),o)}contextRow(t){return this._activeTableController().rowAtEvent(t)}topline(){return this._checkSupportTrades()?this._filter:null}destroy(){var t,e;this._unsubscribeUpdates(),this._positionsTableViewModel.destroy(),this._positionsTableView.destroy(),null===(t=this._tradesTableViewModel)||void 0===t||t.destroy(),null===(e=this._tradesTableView)||void 0===e||e.destroy(),super.destroy()}_onActiveChanged(t){t?this._activeTableController().setActive(!0):(this._positionsTableController.setActive(!1),this._tradesTableController&&this._tradesTableController.setActive(!1))}_onPositionsCountChanged(t){this._setCount(t),this._setTabCount(1,t)}_onTradesCountChanged(t){this._setTabCount(0,t)}_setTabCount(t,e){this._filter.querySelectorAll(".js-counter-count")[t].innerHTML=String(e)}_activeTableController(){return this._checkSupportTrades()&&0===this._filterTabs.index()?(0,l.ensure)(this._tradesTableController):this._positionsTableController}_subscribeUpdates(){this._positionsCounter.start(),this._positionsCounter.countChanged.subscribe(this,this._onPositionsCountChanged),this._tradesCounter&&(this._tradesCounter.start(),this._tradesCounter.countChanged.subscribe(this,this._onTradesCountChanged)),this._filterTabs.tabChanged.subscribe(this,this._selectPage),this._fullUpdateDelegate.subscribe(this,this._showFilterIfNeeded)}_unsubscribeUpdates(){this._positionsCounter.stop(),this._positionsCounter.countChanged.unsubscribe(this,this._onPositionsCountChanged),this._tradesCounter&&(this._tradesCounter.stop(),
this._tradesCounter.countChanged.unsubscribe(this,this._onTradesCountChanged)),this._filterTabs.tabChanged.unsubscribe(this,this._selectPage),this._fullUpdateDelegate.unsubscribe(this,this._showFilterIfNeeded)}_constructFilter(){this._filter=Ue([{id:"type-individual",name:us},{id:"type-net",name:hs}]),this._filterTabs=new x(this._filter,void 0,{noSlider:!0})}_showFilterIfNeeded(){this.isActive()&&this._checkSupportTrades()?this._filter.classList.remove("js-hidden"):(this._filter.classList.add("js-hidden"),this._tradesTableController&&this._tradesTableController.stop())}_selectPage(t){const e=1===t;e?this._positionsTableController.start():this._tradesTableController&&this._tradesTableController.start(),this._positionsTableContainer.classList.toggle("js-hidden",!e),this._tradesTableContainer&&this._tradesTableContainer.classList.toggle("js-hidden",e),this._positionsTableController.setActive(e),this._tradesTableController&&this._tradesTableController.setActive(!e),f.setValue("Trading.PositionsTable.Filter",t)}_storeFunctions(t){const e=(0,l.ensure)((0,B.tradingService)()),s="Positions Page",i=t.positions.closeFn;this._closePositionFn=i?t=>(e.trackEvent(s,"Close Position"),i(t)):null;const r=t.positions.editFn;this._editPositionFn=r?t=>(e.trackEvent(s,"Edit Position"),r(t)):null;const o=t.positions.reverseFn;this._reversePositionFn=o?t=>(e.trackEvent(s,"Reverse Position"),o(t)):null;const n=t.trades;if(n){const t=n.closeFn;this._closeTradeFn=t?i=>(e.trackEvent(s,"Close Trade"),t(i)):null;const i=n.editFn;this._editTradeFn=i?t=>(e.trackEvent(s,"Edit Trade"),i(t)):null}}}var _s=s(61851),gs=s(51871);function ms(t){const{wValue:e,formatter:s,text:i}=t,r=(0,jt.useWatchedValueReadonly)({watchedValue:e}),n=(0,o.useMemo)(()=>function(t,e=St){for(const e of xt)if(e.name===t)return e;return e}(null!=s?s:"fixed"),[s]),a=(0,o.useMemo)(()=>function(t,e){var s;const i=(null!==(s=t.formatElement)&&void 0!==s?s:t.formatText)({value:e,row:{}});return"string"!=typeof i?i:i.replace(/&nbsp;/g," ")}(n,r),[n,r]);return void 0===a?o.createElement(o.Fragment,null):o.createElement("div",{className:gs.itemWrapper},o.createElement("div",{className:gs.value},a),o.createElement("div",{className:gs.title},i))}var bs=s(55983);function vs(t){const{summaryFields:e,summaryFieldsVisibilityInfo:s}=t;return o.createElement("div",{className:bs.wrapper},e.map(t=>{var e;return(null===(e=s.get(t.text))||void 0===e?void 0:e.visible)?o.createElement(ms,{...t,key:t.text}):null}))}var fs=s(73560),ws=s(16719);function Cs(t){const{brokerDropdownProps:e,accountDropdownProps:s,summaryFieldsVisibilityManager:i,summaryFields:r}=t,n=(0,_s.useObservable)(i.fieldsVisibilityInfo$,i.fieldsVisibilityInfo()),a=void 0!==s,l=0!==r.length;return a||l?o.createElement("div",{className:ws.headerWrapper},a&&o.createElement(fs.AccountManagerHeaderDropdowns,{brokerDropdownProps:e,accountDropdownProps:s}),l&&o.createElement(vs,{summaryFields:r,summaryFieldsVisibilityInfo:n})):o.createElement(o.Fragment,null)}var ys=s(38186),Ss=s(51763),Ts=s(62106),xs=s(70976),Es=s(47276)
;const Fs=[6,3,2,1,5],Ms=[2,1,5];class Ds{constructor(t){this._showContextMenu=async t=>{t.preventDefault();let e=await this._contextItems(t);h.enabled("property_pages")||(e=e.slice(0,-1)),O.ContextMenuManager.showMenu((0,R.convertActionDescriptionsToActions)(e),function(t){const e=t instanceof MouseEvent?t:t.touches[0];return{clientX:e.clientX,clientY:e.clientY}}(t),void 0,{menuName:"AccountManagerContextMenu"})};const{broker:e,bridge:s,mode:i,summaryFieldsVisibilityManager:r,overlapManager:o}=t;this._adapter=(0,l.ensureNotNull)(e),this._bridge=s,this._container=s.container,this._mode=i,this._overlapManager=o,this._summaryFieldsVisibilityManager=r,this._pages=[],this._topLines={},this._trading=(0,l.ensureNotNull)((0,B.tradingService)()),this._info=this._adapter.accountManagerInfo(),this._dispatch=this.bindContextMenu(),this._contentResizeObserver=new a.default(t=>{this._contentHeight=t[0].contentRect.height,this._pages[this._tabs.index()].setHeight(this._contentHeight)}),this._renderTemplate(),this._tabs=this._initializeTabs()}async priceFormatter(t){return t.symbol?this._trading.formatter(t.symbol):null}remove(){for(this._unmountComponentBySelector(".js-account-manager-header"),this._unsubscribe(),this._pages.forEach(t=>t.destroy()),this.unbindContextMenu();this._container.firstChild;)this._container.removeChild(this._container.firstChild)}bindContextMenu(){return window.matchMedia(W.TradingLayoutBreakpoint.Mobile).matches&&c.CheckMobile.any()?this._bindTapMenu():c.CheckMobile.iOS()?this._bindLongPressMenu():this._bindContextMenu()}unbindContextMenu(){null!==this._dispatch&&(this._dispatch(),this._dispatch=null)}static async create(t){const e=new Ds(t);return await e._create(),e._hideSecondaryPanelIfEmpty(),e._subscribe(),e._fullUpdate(),e}_bindContextMenu(){return this._container.addEventListener("contextmenu",this._showContextMenu),()=>this._container.removeEventListener("contextmenu",this._showContextMenu)}_bindLongPressMenu(){let t;const e=e=>{clearTimeout(t),t=setTimeout(()=>this._showContextMenu(e),400)},s=()=>clearTimeout(t);return this._container.addEventListener("touchstart",e),this._container.addEventListener("touchend",s),this._container.addEventListener("touchmove",s),()=>{clearTimeout(t),this._container.removeEventListener("touchstart",e),this._container.removeEventListener("touchend",s),this._container.removeEventListener("touchmove",s)}}_bindTapMenu(){const t=t=>{void 0!==this._currentPage().contextRow(t)&&this._showContextMenu(t)},e=t=>{t.preventDefault()};return this._container.addEventListener("click",t),this._container.addEventListener("contextmenu",e),()=>{this._container.removeEventListener("click",t),this._container.removeEventListener("contextmenu",e)}}_unmountComponentBySelector(t){const e=this._container.querySelector(t);null!==e&&n.unmountComponentAtNode(e)}_initializeTabs(){const t=(0,l.ensureNotNull)(this._container.querySelector(".js-content")),e=new x((0,l.ensureNotNull)(this._container.querySelector(".js-top-panel-tabs")),t);return e.tabChanged.subscribe(this,this._onPageChanged),e}
_linkTableRowSymbol(t,e){e||void 0===t.symbol||""===t.symbol||d.linking.symbol.setValue(t.symbol)}_onTableRowClick(t,e,s,i){const r=t;e||""===r.symbol||(d.linking.symbol.value()!==r.symbol?d.linking.symbol.setValue(r.symbol):s.setSelectedItem({id:r.id,type:i}))}_onTableRowMouseEnter(t,e,s,i){const r=t;e||d.linking.symbol.value()!==r.symbol||s.setHoveredItem({id:r.id,type:i})}_onTableRowMouseLeave(t,e,s){const i=t;e||d.linking.symbol.value()!==i.symbol||s.dropHoveredItem()}_makeTableRowEventsHandlers(t,e){return{onClick:(s,i)=>this._onTableRowClick(s,i,t,e),onMouseEnter:(s,i)=>this._onTableRowMouseEnter(s,i,t,e),onMouseLeave:(e,s)=>this._onTableRowMouseLeave(e,s,t)}}async _getPages(){const t=this._adapter.metainfo().id,e=this._adapter.accountManagerInfo(),s=this._adapter.metainfo().configFlags,i=this._getPagesAvailabilityInfo(),o=(0,l.ensureNotNull)(this._trading.brokerCommandsUI()),n={},a=await this._trading.tradedItemsChartCollectionFacade();if(i.positions){const i=this._makeTableRowEventsHandlers(a,Ss.TradedItemType.Position);n.positionPage={ctor:ps,ctorArguments:{brokerId:t,formatters:e.customFormatters||[],tableRowEventsHandlers:i,priceFormatterFn:this.priceFormatter.bind(this),checkSupportTrades:()=>!0===s.supportTrades,positions:{source:()=>this._adapter.positions().then(t=>t.filter(t=>L(t))),closeFn:o.closePosition.bind(o),editFn:s.supportPositionBrackets?o.editPositionBrackets.bind(o):null,reverseFn:s.supportReversePosition?o.reversePosition.bind(o):null,columns:(0,l.ensureDefined)(e.positionColumns),subscriptions:{rowUpdateDelegate:new I([this._adapter.positionPartialUpdate,this._adapter.positionUpdate]),countUpdateDelegate:this._adapter.positionUpdate,plSubscription:this._adapter.subscribePL.bind(this._adapter)}},trades:s.supportTrades?{source:()=>this._adapter.trades().then(t=>t.filter(t=>0!==t.qty)),closeFn:s.supportCloseTrade?o.closeTrade.bind(o):null,editFn:s.supportTradeBrackets?(0,l.ensureDefined)(o.editTradeBrackets).bind(o):null,reverseFn:null,columns:(0,l.ensureDefined)(e.tradeColumns||e.positionColumns),subscriptions:{rowUpdateDelegate:new I([this._adapter.tradePartialUpdate,this._adapter.tradeUpdate]),countUpdateDelegate:this._adapter.tradeUpdate,plSubscription:this._adapter.subscribePL.bind(this._adapter)}}:null,fullUpdateDelegate:this._adapter.currentAccountUpdate,overlapManager:this._overlapManager,getTableSettingsStorage:this._trading.getBrokerTradingSettingsStorage}}}const d=this._adapter.orders.bind(this._adapter),c=this._makeTableRowEventsHandlers(a,Ss.TradedItemType.Order);n.orderPage={ctor:is,ctorArguments:{id:"Orders",title:(0,r.t)("Orders"),source:d,cancelFn:o.cancelOrder.bind(o),modifyFn:o.modifyOrder.bind(o),columns:e.orderColumns,headerCounter:!0,tableId:t+".orders",tableRowEventsHandlers:c,formatters:e.customFormatters||[],priceFormatterFn:this.priceFormatter.bind(this),subscriptions:{fullUpdateDelegate:this._adapter.currentAccountUpdate,rowUpdateDelegate:new I([this._adapter.orderPartialUpdate,this._adapter.orderUpdate]),orderUpdateDelegate:this._adapter.orderUpdate},
possibleOrderStatuses:Fs.filter(t=>!e.possibleOrderStatuses||-1!==e.possibleOrderStatuses.indexOf(t)),filter:()=>!0,highlightChanges:!0,initialSorting:e.orderColumnsSorting,configFlags:s,overlapManager:this._overlapManager,getTableSettingsStorage:this._trading.getBrokerTradingSettingsStorage}};const h=this._adapter.ordersHistory.bind(this._adapter);return i.history&&(n.historyPage={ctor:is,ctorArguments:{id:"History",title:(0,r.t)("History"),source:()=>Promise.all([d(),h()]).then(t=>[].concat(...t)),cancelFn:o.cancelOrder.bind(o),modifyFn:o.modifyOrder.bind(o),columns:(0,l.ensureDefined)(e.historyColumns),headerCounter:!1,tableId:t+".history",tableRowEventsHandlers:c,formatters:e.customFormatters||[],priceFormatterFn:this.priceFormatter.bind(this),subscriptions:{fullUpdateDelegate:this._adapter.currentAccountUpdate,rowUpdateDelegate:new I([this._adapter.orderPartialUpdate,this._adapter.orderUpdate]),orderUpdateDelegate:this._adapter.orderUpdate},possibleOrderStatuses:Ms.filter(t=>!e.possibleOrderStatuses||-1!==e.possibleOrderStatuses.indexOf(t)),filter:t=>![3,4,6].includes(t.status),highlightChanges:!1,initialSorting:e.historyColumnsSorting,isAlwaysActive:!0,configFlags:s,overlapManager:this._overlapManager,getTableSettingsStorage:this._trading.getBrokerTradingSettingsStorage}}),n.customPages=e.pages.map(s=>{const i=s.tables.map(i=>{var r;return{id:`${t}.${s.id}.${i.id}`,title:i.title||"",columns:i.columns,source:i.getData,options:{className:"balances",idProperty:"id"},initialSorting:i.initialSorting,formatters:e.customFormatters||[],priceFormatterFn:this.priceFormatter.bind(this),subscriptions:{fullUpdateDelegate:this._adapter.currentAccountUpdate,rowUpdateDelegate:i.changeDelegate},flags:i.flags,rowEventsHandlers:(null===(r=i.flags)||void 0===r?void 0:r.supportLinking)?{onClick:this._linkTableRowSymbol}:void 0}});return{ctor:Ee,ctorArguments:{id:s.id,title:s.title,tables:i,overlapManager:this._overlapManager,getTableSettingsStorage:this._trading.getBrokerTradingSettingsStorage}}}),i.notifications&&(n.notificationsPage={ctor:Re,ctorArguments:{id:"notifications_log",title:(0,r.t)("Notifications log"),source:()=>Promise.resolve(this._trading.getNotifications()),columns:Fe,formatters:[],priceFormatterFn:this.priceFormatter.bind(this),subscriptions:{fullUpdateDelegate:this._trading.onNotificationsChanged,rowUpdateDelegate:this._trading.onNewNotification},overlapManager:this._overlapManager,initialSorting:{columnId:"time",asc:!1},rowBadgeTypeInferrer:Ps,getTableSettingsStorage:this._trading.getBrokerTradingSettingsStorage}}),n}_getPagesAvailabilityInfo(){const t=this._adapter.metainfo().configFlags;return{positions:Boolean(t.supportPositions),orders:!0,history:Boolean(t.supportOrdersHistory),notifications:Boolean(h.enabled("show_trading_notifications_history")&&t.showNotificationsLog)}}_renderTemplate(){const t=this._getPagesAvailabilityInfo(),e=Object.values(t).filter(t=>t).length+this._adapter.accountManagerInfo().pages.length,s=(0,l.ensureNotNull)((0,
U.parseHtmlElement)(((t=0)=>`\n<div class="${Es.accountManager}">\n\t<div class="js-account-manager-header"></div>\n\t<div class="${Es.topPanel} js-top-panel">\n\t\t<div class="tv-tabs tv-tabs--semi-compact tv-tabs--no-margin tv-tabs--no-border js-top-panel-tabs">\n\t\t\t${'<div class="tv-tabs__tab js-tab"></div>'.repeat(t)}\n\t\t</div>\n\t</div>\n\t<div class="${Es.secondaryPanel} js-secondary-panel">\n\t\t<div class="js-secondary-tabs"></div>\n\t</div>\n\t<div class="${Es.content} js-content">\n\t\t${`<div class="${Es.page} js-page"></div>`.repeat(t)}\n\t</div>\n</div>`)(e)));this._container.appendChild(s)}async _create(){const t=await this._getPages();for(const e of Object.values(t))if(Array.isArray(e)){const t=e.map(t=>new t.ctor(t.ctorArguments));this._pages.push(...t)}else this._pages.push(new e.ctor(e.ctorArguments));const e=(0,l.ensureNotNull)(this._container.querySelector(".js-content"));this._contentResizeObserver.observe(e),this._render();const s=this._container.querySelectorAll(".js-page"),i=this._container.querySelectorAll(".js-tab");this._pages.forEach((t,e)=>{s[e].innerHTML="",s[e].appendChild(t.content()),i[e].innerHTML="",i[e].appendChild(t.header())})}async _render(){let t;1===this._mode&&(t=await(0,ys.makeAccountManagerHeaderDropdownsProps)(this._trading,this._summaryFieldsVisibilityManager,()=>this._getDataExporters())),n.render(o.createElement(Cs,{...t,summaryFields:this._info.summary,summaryFieldsVisibilityManager:this._summaryFieldsVisibilityManager}),this._container.querySelector(".js-account-manager-header"))}_getDataExporters(){const t=new Map;for(const e of this._pages){const s=e.getExporters();t.set(s.title,s)}return t}_subscribe(){const t=t=>{t?this._updatePagesActiveStatuses():this._pages.forEach(t=>t.setActive(!1))};this._bridge.visible.subscribe(t,{callWithLast:!0}),this._dispatchVisibilityHandler=()=>this._bridge.visible.unsubscribe(t),this._attachFilter()}_onPageChanged(t){this._attachFilter(),this._hideSecondaryPanelIfEmpty(),this._trading.trackEvent("Bottom Panel",`Select ${this._pages[t].id()} page`),this._updatePagesActiveStatuses()}_hideSecondaryPanelIfEmpty(){(0,l.ensureNotNull)(this._container.querySelector(".js-secondary-panel")).classList.toggle("js-hidden",null===this._currentPage().topline())}_updatePagesActiveStatuses(){const t=1===this._adapter.connectionStatus(),e=this._tabs.index();void 0!==this._contentHeight&&this._pages[e].setHeight(this._contentHeight);for(let s=0;s<this._pages.length;s++)this._pages[s].setActive(e===s&&t)}_detachFilter(){const t=(0,l.ensureNotNull)(this._container.querySelector(".js-secondary-tabs")).children;for(const e of Array.from(t))e.classList.add("js-hidden")}_attachFilter(){if(this._detachFilter(),this._topLines[this._currentPageIndex()])this._topLines[this._currentPageIndex()].classList.remove("js-hidden");else if(this._currentPage().topline()){const t=(0,l.ensureNotNull)(this._currentPage().topline());(0,l.ensureNotNull)(this._container.querySelector(".js-secondary-tabs")).appendChild(t),this._topLines[this._currentPageIndex()]=t}}
_fullUpdate(){this._pages.forEach(t=>t.reset())}_unsubscribe(){this._tabs&&(this._tabs.tabChanged.unsubscribe(this,this._onPageChanged),this._tabs.stop()),this._contentResizeObserver.disconnect(),this._dispatchVisibilityHandler&&(this._dispatchVisibilityHandler(),delete this._dispatchVisibilityHandler);const t=this._container.querySelector(".js-secondary-tabs");if(null!==t)for(;t.firstChild;)t.removeChild(t.firstChild);this._topLines={}}_currentPageIndex(){return this._tabs.index()}_currentPage(){return this._pages[this._currentPageIndex()]}async _contextItems(t){const e="Bottom Panel Context Menu",s=this._currentPage().contextItems(t);if(this._info&&this._info.contextMenuActions)return this._info.contextMenuActions(t,s);const i={separator:!0},o=1===this._mode,n=[];if(o){0!==s.length&&s.push(i);const t=d.linking.proSymbol.value(),r=await this._trading.makeNewOrderContextMenuAction(t,e);n.push(r)}else{const o=this._currentPage().contextRow(t);void 0!==o&&"symbol"in o&&(0!==s.length&&s.push(i),n.push({text:(0,r.t)("Open chart with {symbol}").replace("{symbol}",o.symbol),icon:Ts,action:()=>{this._trading.trackEvent(e,"Open chart"),d.linking.symbol.setValue(o.symbol),this._trading.tradingPanelPopup.hide()}}))}return h.enabled("buy_sell_buttons")&&o&&n.push(i,{text:(0,r.t)("Show Buy/Sell Buttons"),checkable:!0,checked:this._trading.showSellBuyButtons.value(),action:()=>{const t=!this._trading.showSellBuyButtons.value();this._trading.trackEvent(e,"Show Sell/Buy Buttons",t?"Check":"Uncheck"),this._trading.showSellBuyButtons.setValue(t)}}),h.enabled("property_pages")&&(s.length>0&&n.push(i),n.push({text:(0,V.appendEllipsis)((0,r.t)("Trading Settings")),icon:xs,action:()=>{this._trading.trackEvent(e,"Trading Properties"),this._trading.showTradingProperties()}})),s.concat(n)}}function Ps(t){return"danger"===t.type?N.Danger:"success"===t.type?N.Success:void 0}},56656:(t,e,s)=>{"use strict";s.r(e),s.d(e,{SummaryFieldsVisibilityManager:()=>r});var i=s(47488);class r{constructor(t,e){var s;this.toggleField=t=>{var e;const s=this._fieldsVisibilityInfo$.getValue(),i=new Map(s),r=i.get(t);void 0!==r&&(r.visible=!r.visible,this._fieldsVisibilityInfo$.next(i),null===(e=this._settingsGetter())||void 0===e||e.setSummaryFieldsVisibilityInfo(i))},this._settingsGetter=e;const r=null===(s=this._settingsGetter())||void 0===s?void 0:s.summaryFieldsVisibilityInfo();this._fieldsVisibilityInfo$=new i.BehaviorSubject(new Map(t.map(({text:t,isDefault:e})=>{var s,i,o;return[t,{id:t,visible:null===(o=null!==(i=null===(s=null==r?void 0:r.get(t))||void 0===s?void 0:s.visible)&&void 0!==i?i:e)||void 0===o||o}]}))),this.fieldsVisibilityInfo$=this._fieldsVisibilityInfo$.asObservable()}fieldsVisibilityInfo(){return this._fieldsVisibilityInfo$.getValue()}}},51763:(t,e,s)=>{"use strict";var i;s.d(e,{TradedItemType:()=>i}),function(t){t[t.Position=0]="Position",t[t.Order=1]="Order"}(i||(i={}))},12334:(t,e,s)=>{"use strict";s.d(e,{TradingLayoutBreakpoint:()=>r});var i=s(82515);const r={Mobile:i.mobile}},99357:(t,e,s)=>{"use strict";s.d(e,{LogoSize:()=>n,
getLogoUrlResolver:()=>d});var i=s(88537);(0,s(51951).getLogger)("Common.InitData");const r=window.initData||{};function o(){return r}var n;!function(t){t[t.Medium=0]="Medium",t[t.Large=1]="Large"}(n||(n={}));class a{constructor(t){(0,i.assert)(""!==t,"S3 base url must be a non-empty string"),this._baseUrl=t}getSymbolLogoUrl(t,e){switch((0,i.assert)(""!==t,"logo id must be a non-empty string"),e){case n.Medium:return this._baseUrl+(t+".svg");case n.Large:return this._baseUrl+(t+"--big.svg")}}getCountryFlagUrl(t,e){return this.getSymbolLogoUrl("country/"+t,e)}getCryptoLogoUrl(t,e){return this.getSymbolLogoUrl("crypto/"+t,e)}getProviderLogoUrl(t,e){return this.getSymbolLogoUrl("provider/"+t,e)}}let l;function d(){if(!l){const t=o(),e=t.settings?t.settings.S3_LOGO_SERVICE_BASE_URL:"";l=new a(e)}return l}},52275:(t,e,s)=>{"use strict";s.d(e,{saveTextFile:()=>r,escapeCSVValue:()=>l});var i=s(1227);function r(t,e,s="text/plain"){const r=new Blob([e],{type:s});if(i.CheckMobile.iOS()){const e=new FileReader;return e.onload=()=>{e.result&&o(t,e.result.toString())},void e.readAsDataURL(r)}const n=window.URL.createObjectURL(r);navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(r,t):window.navigator.msSaveBlob?window.navigator.msSaveBlob(r,t):(o(t,n),window.URL.revokeObjectURL(n))}function o(t,e){const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),s.href=e,s.download=t,s.click(),document.body.removeChild(s)}const n=/[",\r\n]/,a=/"/g;function l(t){return n.test(t)?`"${t.replace(a,'""')}"`:t}},61851:(t,e,s)=>{"use strict";s.d(e,{useObservable:()=>r});var i=s(59496);function r(t,e){const[s,r]=(0,i.useState)(e);return(0,i.useEffect)(()=>{const e=t.subscribe(r);return()=>e.unsubscribe()},[t]),s}},97265:(t,e,s)=>{"use strict";s.d(e,{useWatchedValueReadonly:()=>r});var i=s(59496);const r=(t,e=!1)=>{const s="watchedValue"in t?t.watchedValue:void 0,r="defaultValue"in t?t.defaultValue:t.watchedValue.value(),[o,n]=(0,i.useState)(s?s.value():r);return(e?i.useLayoutEffect:i.useEffect)(()=>{if(s){n(s.value());const t=t=>n(t);return s.subscribe(t),()=>s.unsubscribe(t)}return()=>{}},[s]),o}},79266:(t,e,s)=>{"use strict";s.d(e,{PopupMenuItemToggle:()=>l});var i=s(59496),r=s(97754),o=s(92063),n=s(2946),a=s(91998);function l(t){const{isDisabled:e,hint:s,label:l,isChecked:d,checkboxClassName:c,labelClassName:h,indeterminate:u,...p}=t;return i.createElement(o.PopupMenuItem,{...p,isDisabled:e,shortcut:s,dontClosePopup:!0,labelRowClassName:h,label:i.createElement(n.Checkbox,{disabled:e,label:l,checked:d,indeterminate:u,className:r(a.checkbox,c)})})}},44114:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path stroke="currentColor" d="M13.5 7l1.65-1.65a.5.5 0 0 0 0-.7l-1.8-1.8a.5.5 0 0 0-.7 0L11 4.5M13.5 7L11 4.5M13.5 7l-8.35 8.35a.5.5 0 0 1-.36.15H2.5v-2.3a.5.5 0 0 1 .15-.35L11 4.5"/></svg>'},62106:t=>{
t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" fill-rule="evenodd" d="M8 5.5h12A2.5 2.5 0 0 1 22.5 8v12a2.5 2.5 0 0 1-2.5 2.5H8A2.5 2.5 0 0 1 5.5 20V8A2.5 2.5 0 0 1 8 5.5zM4 8a4 4 0 0 1 4-4h12a4 4 0 0 1 4 4v12a4 4 0 0 1-4 4H8a4 4 0 0 1-4-4V8zm15.49 5.07a.75.75 0 1 0-.98-1.14l-2.97 2.55-2.51-2.51a.75.75 0 0 0-1.02-.04l-3.5 3a.75.75 0 1 0 .98 1.14l2.97-2.55 2.51 2.51c.28.28.72.3 1.02.04l3.5-3z"/></svg>'},57369:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 11 9" width="11" height="9" fill="none"><path stroke-width="2" d="M0.999878 4L3.99988 7L9.99988 1"/></svg>'},72351:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"><path fill="currentColor" d="M9.707 9l4.647-4.646-.707-.708L9 8.293 4.354 3.646l-.708.708L8.293 9l-4.647 4.646.708.708L9 9.707l4.646 4.647.708-.707L9.707 9z"/></svg>'},6467:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 9 9" width="9" height="9"><path fill="currentColor" d="M9 4.5A4.5 4.5 0 0 1 4.5 9 4.5 4.5 0 0 1 0 4.5 4.5 4.5 0 0 1 4.5 0 4.5 4.5 0 0 1 9 4.5z"/><path fill="#fff" d="M4.768 1.527c.131 0 .243.047.334.141a.444.444 0 0 1 .141.33.461.461 0 0 1-.14.339.455.455 0 0 1-.335.137.468.468 0 0 1-.471-.475c0-.132.045-.244.137-.335a.455.455 0 0 1 .334-.137zm-.42 5.946v-3.67h-.591V3.16h1.357v4.314z"/></svg>'},94511:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" width="14" height="14"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M8.5 1.5L3.5 7l5 5.5"/></svg>'},25914:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" width="14" height="14"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5.5 1.5l5 5.5-5 5.5"/></svg>'},56620:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 6 26" width="3" height="13" fill="currentColor"><circle cx="3" cy="3" r="3"/><circle cx="3" cy="13" r="3"/><circle cx="3" cy="23" r="3"/></svg>'}}]);