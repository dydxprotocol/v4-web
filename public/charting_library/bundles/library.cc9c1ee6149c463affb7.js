(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[1297],{251226:e=>{e.exports={"css-value-chart-controls-bar-height-with-border":"calc(38px + 1px)","css-value-chart-controls-bar-border":"1px"}},123062:e=>{e.exports={}},286625:e=>{e.exports={"tv-spinner__container-rotate":"tv-spinner__container-rotate-OAzoNsnS"}},860309:e=>{e.exports={container:"container-ArDpmAvc",inner:"inner-ArDpmAvc","border-left":"border-left-ArDpmAvc","border-right":"border-right-ArDpmAvc","border-top":"border-top-ArDpmAvc","border-bottom":"border-bottom-ArDpmAvc","top-right-radius":"top-right-radius-ArDpmAvc","top-left-radius":"top-left-radius-ArDpmAvc","bottom-right-radius":"bottom-right-radius-ArDpmAvc","bottom-left-radius":"bottom-left-radius-ArDpmAvc"}},493249:e=>{e.exports={}},781165:e=>{e.exports={css_value_currency_label_radius:"4",css_wrapper_margin:"1",css_row_left_right_margin:"3",css_row_left_right_padding:"6",css_first_row_top_padding:"4",css_fade_height:"10","price-axis-currency-label-wrapper":"price-axis-currency-label-wrapper-SfCx6ur0","price-axis-currency-label":"price-axis-currency-label-SfCx6ur0",hidden:"hidden-SfCx6ur0",row:"row-SfCx6ur0","price-axis-currency-label-fade":"price-axis-currency-label-fade-SfCx6ur0","price-axis-currency-label-text":"price-axis-currency-label-text-SfCx6ur0","price-axis-currency-label-arrow-down":"price-axis-currency-label-arrow-down-SfCx6ur0"}},89494:e=>{e.exports={labelwidth:"19px",labelheight:"19px",bordersize:"2px",bottommargin:"5px",gearheight:"15px",gearwidth:"15px","price-axis-stub":"price-axis-stub-eYu3weXF",wrapper:"wrapper-eYu3weXF",label:"label-eYu3weXF",symbol:"symbol-eYu3weXF",gear:"gear-eYu3weXF","fixed-gear":"fixed-gear-eYu3weXF","fixed-symbol":"fixed-symbol-eYu3weXF"}},591663:e=>{e.exports={}},488656:e=>{e.exports={}},547490:e=>{e.exports={"news-item":"news-item-GNj7IA5S","news-item--no-hover":"news-item--no-hover-GNj7IA5S","news-item--highlight":"news-item--highlight-GNj7IA5S","news-item__header":"news-item__header-GNj7IA5S","news-item__breadcrumbs":"news-item__breadcrumbs-GNj7IA5S","news-item__logos":"news-item__logos-GNj7IA5S","news-item--card":"news-item--card-GNj7IA5S","news-item__title":"news-item__title-GNj7IA5S","news-item__title--external-link":"news-item__title--external-link-GNj7IA5S","news-item__description":"news-item__description-GNj7IA5S","news-item__exclusive":"news-item__exclusive-GNj7IA5S","news-item--important":"news-item--important-GNj7IA5S","news-item__wrapper":"news-item__wrapper-GNj7IA5S"}},541483:e=>{e.exports={}},1338:e=>{e.exports={"common-tooltip":"common-tooltip-C8z_hVli","common-tooltip--hidden":"common-tooltip--hidden-C8z_hVli","common-tooltip--horizontal":"common-tooltip--horizontal-C8z_hVli","common-tooltip--farther":"common-tooltip--farther-C8z_hVli","common-tooltip--vertical":"common-tooltip--vertical-C8z_hVli","common-tooltip-farther":"common-tooltip-farther-C8z_hVli","common-tooltip--direction_normal":"common-tooltip--direction_normal-C8z_hVli","common-tooltip__body":"common-tooltip__body-C8z_hVli",
"common-tooltip__button-container":"common-tooltip__button-container-C8z_hVli","common-tooltip__body--no-buttons":"common-tooltip__body--no-buttons-C8z_hVli","common-tooltip__button":"common-tooltip__button-C8z_hVli","common-tooltip--direction_reversed":"common-tooltip--direction_reversed-C8z_hVli","common-tooltip__ear-holder":"common-tooltip__ear-holder-C8z_hVli","common-tooltip__ear-holder--below":"common-tooltip__ear-holder--below-C8z_hVli","common-tooltip__ear-holder--above":"common-tooltip__ear-holder--above-C8z_hVli","common-tooltip__ear-holder--before":"common-tooltip__ear-holder--before-C8z_hVli","common-tooltip__ear-holder--after":"common-tooltip__ear-holder--after-C8z_hVli","common-tooltip__body--with-hotkey":"common-tooltip__body--with-hotkey-C8z_hVli","common-tooltip__body--width_wide":"common-tooltip__body--width_wide-C8z_hVli","common-tooltip__body--width_narrow":"common-tooltip__body--width_narrow-C8z_hVli","common-tooltip__body--no-padding":"common-tooltip__body--no-padding-C8z_hVli","common-tooltip__hotkey-block":"common-tooltip__hotkey-block-C8z_hVli","common-tooltip__hotkey-block--divider":"common-tooltip__hotkey-block--divider-C8z_hVli","common-tooltip__hotkey-text":"common-tooltip__hotkey-text-C8z_hVli","common-tooltip__hotkey-button":"common-tooltip__hotkey-button-C8z_hVli","common-tooltip__plus-sign":"common-tooltip__plus-sign-C8z_hVli"}},930202:(e,t,i)=>{"use strict";i.d(t,{isMacKeyboard:()=>r,Modifiers:()=>n,modifiersFromEvent:()=>o,hashFromEvent:()=>a,hashShiftPlusEnter:()=>l,humanReadableModifiers:()=>c,humanReadableHash:()=>d});var s=i(804395);const r=s.isMac||s.isIOS;var n;function o(e){let t=0;return e.shiftKey&&(t+=1024),e.altKey&&(t+=512),e.ctrlKey&&(t+=256),e.metaKey&&(t+=2048),t}function a(e){return o(e)|e.keyCode}!function(e){e[e.None=0]="None",e[e.Alt=512]="Alt",e[e.Shift=1024]="Shift",e[e.Mod=r?2048:256]="Mod",e[e.Control=256]="Control",e[e.Meta=2048]="Meta"}(n||(n={}));const l=1037;function c(e,t=!r){let i="";return 256&e&&(i+=r?"^":"Ctrl",t&&(i+=" + ")),512&e&&(i+=r?"⌥":"Alt",t&&(i+=" + ")),1024&e&&(i+=r?"⇧":"Shift",t&&(i+=" + ")),2048&e&&(i+=r?"⌘":"Win",t&&(i+=" + ")),i}const h={9:"⇥",13:"↵",27:"Esc",8:r?"⌫":"Backspace",32:"Space",35:"End",36:"Home",37:"←",38:"↑",39:"→",40:"↓",45:"Ins",46:"Del",188:",",191:"/"};for(let e=1;e<=16;e++)h[e+111]=`F${e}`;function d(e){let t=c(e);const i=255&e;return t+=i in h?h[i]:String.fromCharCode(i),t}},954343:(e,t,i)=>{"use strict";i.d(t,{isTextEditingField:()=>r,isNativeUIInteraction:()=>n});var s=i(930202);function r(e){if("INPUT"===e.tagName){const t=e.type;return"text"===t||"email"===t||"number"===t||"password"===t||"search"===t||"tel"===t||"url"===t}return"TEXTAREA"===e.tagName||e.isContentEditable}function n(e,t){if(!t)return!1;const i=255&e;if(27===i||i>>>4==7)return!1;switch(e^i){case s.Modifiers.Alt:return(38===i||40===i)&&"SELECT"===t.tagName||r(t);case s.Modifiers.Alt+s.Modifiers.Shift:return r(t);case s.Modifiers.Mod:if(67===i||!s.isMacKeyboard&&45===i){const e=t.ownerDocument&&t.ownerDocument.getSelection()
;if(e&&!e.isCollapsed)return!0}return r(t);case s.Modifiers.Mod+s.Modifiers.Shift:return i>=33&&i<=40&&r(t);case s.Modifiers.Shift:case 0:return!!(9!==i||t.ownerDocument&&t!==t.ownerDocument.body&&t!==t.ownerDocument.documentElement)&&((13===i||32===i||!function(e){if("BUTTON"===e.tagName)return!0;if("INPUT"===e.tagName){const t=e.type;if("submit"===t||"button"===t||"reset"===t||"checkbox"===t||"radio"===t)return!0}return!1}(t))&&("form"in t||t.isContentEditable))}return!1}},804395:(e,t,i)=>{"use strict";i.d(t,{mobiletouch:()=>n,touch:()=>o,isChrome:()=>a,isFF:()=>l,isEdge:()=>c,isSafari:()=>h,isMac:()=>d,isWindows:()=>u,isLinux:()=>p,isAndroid:()=>_,isBlackBerry:()=>m,isIOS:()=>g,isOperaMini:()=>f,isIPad:()=>v,isAnyMobile:()=>S});const s="undefined"!=typeof window&&"undefined"!=typeof navigator,r=s&&"ontouchstart"in window,n=s&&r&&"onorientationchange"in window,o=s&&(r||!!navigator.maxTouchPoints),a=s&&window.chrome&&window.chrome.runtime,l=s&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,c=s&&/\sEdge\/\d\d\b/.test(navigator.userAgent),h=s&&Boolean(navigator.vendor)&&navigator.vendor.indexOf("Apple")>-1&&-1===navigator.userAgent.indexOf("CriOS")&&-1===navigator.userAgent.indexOf("FxiOS"),d=s&&/mac/i.test(navigator.platform),u=s&&/Win32|Win64/i.test(navigator.platform),p=s&&/Linux/i.test(navigator.platform),_=s&&/Android/i.test(navigator.userAgent),m=s&&/BlackBerry/i.test(navigator.userAgent),g=s&&/iPhone|iPad|iPod/.test(navigator.platform),f=s&&/Opera Mini/i.test(navigator.userAgent),v=s&&("MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||/iPad/.test(navigator.platform)),S=_||m||g||f},676507:(e,t,i)=>{"use strict";i.r(t),i.d(t,{colorsPalette:()=>d,getHexColorByName:()=>u})
;const s=JSON.parse('{"color-white":"#ffffff","color-black":"#000000","color-cold-gray-50":"#F8F9FD","color-cold-gray-100":"#F0F3FA","color-cold-gray-150":"#E0E3EB","color-cold-gray-200":"#D1D4DC","color-cold-gray-250":"#C1C4CD","color-cold-gray-300":"#B2B5BE","color-cold-gray-350":"#A3A6AF","color-cold-gray-400":"#9598A1","color-cold-gray-450":"#868993","color-cold-gray-500":"#787B86","color-cold-gray-550":"#6A6D78","color-cold-gray-600":"#5D606B","color-cold-gray-650":"#50535E","color-cold-gray-700":"#434651","color-cold-gray-750":"#363A45","color-cold-gray-800":"#2A2E39","color-cold-gray-850":"#1E222D","color-cold-gray-900":"#131722","color-cold-gray-950":"#0C0E15","color-ripe-red-50":"#FFEBEC","color-ripe-red-100":"#FCCBCD","color-ripe-red-200":"#FAA1A4","color-ripe-red-300":"#F77C80","color-ripe-red-400":"#F7525F","color-ripe-red-500":"#F23645","color-ripe-red-600":"#CC2F3C","color-ripe-red-700":"#B22833","color-ripe-red-800":"#991F29","color-ripe-red-900":"#801922","color-ripe-red-a100":"#FF8080","color-ripe-red-a200":"#FF5252","color-ripe-red-a400":"#FF3333","color-ripe-red-a600":"#CC2929","color-ripe-red-a700":"#802028","color-ripe-red-a800":"#4D191D","color-ripe-red-a900":"#331F20","color-tan-orange-50":"#FFF3E0","color-tan-orange-100":"#FFE0B2","color-tan-orange-200":"#FFCC80","color-tan-orange-300":"#ffb74d","color-tan-orange-400":"#FFA726","color-tan-orange-500":"#FF9800","color-tan-orange-600":"#FB8C00","color-tan-orange-700":"#F57C00","color-tan-orange-800":"#EF6C00","color-tan-orange-900":"#e65100","color-tan-orange-a200":"#ffab40","color-tan-orange-a400":"#FF9100","color-tan-orange-a600":"#CC7014","color-tan-orange-a700":"#8C541C","color-tan-orange-a800":"#593A1B","color-tan-orange-a900":"#33261A","color-iguana-green-100":"#C8E6C9","color-iguana-green-200":"#A5D6A7","color-iguana-green-300":"#81c784","color-iguana-green-400":"#66BB6A","color-iguana-green-500":"#4caf50","color-iguana-green-600":"#43a047","color-iguana-green-700":"#388e3c","color-iguana-green-800":"#2E7D32","color-iguana-green-900":"#1B5E20","color-iguana-green-a700":"#00c853","color-banana-yellow-100":"#FFF9C4","color-banana-yellow-200":"#FFF59D","color-banana-yellow-300":"#FFF176","color-banana-yellow-400":"#ffee58","color-banana-yellow-500":"#ffeb3b","color-banana-yellow-600":"#fdd835","color-banana-yellow-700":"#fbc02d","color-banana-yellow-800":"#f9a825","color-banana-yellow-900":"#F57F17","color-banana-yellow-a400":"#ffea00","color-banana-yellow-a700":"#ffd600","color-tv-blue-50":"#E3EFFD","color-tv-blue-100":"#BBD9FB","color-tv-blue-200":"#90BFF9","color-tv-blue-300":"#5B9CF6","color-tv-blue-400":"#3179F5","color-tv-blue-500":"#2962FF","color-tv-blue-600":"#1E53E5","color-tv-blue-700":"#1848CC","color-tv-blue-800":"#143EB3","color-tv-blue-900":"#0C3299","color-tv-blue-a100":"#82b1ff","color-tv-blue-a200":"#448aff","color-tv-blue-a400":"#2979ff","color-tv-blue-a600":"#2962FF","color-tv-blue-a700":"#143A87","color-tv-blue-a800":"#142E61","color-tv-blue-a900":"#132042","color-deep-blue-100":"#D1C4E9","color-deep-blue-200":"#B39DDB","color-deep-blue-300":"#9575cd","color-deep-blue-400":"#7e57c2","color-deep-blue-500":"#673ab7","color-deep-blue-700":"#512da8","color-deep-blue-800":"#4527A0","color-deep-blue-900":"#311B92","color-deep-blue-a100":"#b388ff","color-deep-blue-a200":"#7C4DFF","color-deep-blue-a400":"#651FFF","color-deep-blue-a700":"#6200EA","color-minty-green-50":"#DAF2EE","color-minty-green-100":"#ACE5DC","color-minty-green-200":"#70CCBD","color-minty-green-300":"#42BDA8","color-minty-green-400":"#22AB94","color-minty-green-500":"#089981","color-minty-green-600":"#06806B","color-minty-green-700":"#056656","color-minty-green-800":"#004D40","color-minty-green-900":"#00332A","color-minty-green-a400":"#2BD9BC","color-minty-green-a700":"#24B29B","color-minty-green-a900":"#082621","color-grapes-purple-50":"#F3E5F5","color-grapes-purple-100":"#E1BEE7","color-grapes-purple-200":"#CE93D8","color-grapes-purple-300":"#ba68c8","color-grapes-purple-400":"#ab47bc","color-grapes-purple-500":"#9c27b0","color-grapes-purple-600":"#8e24aa","color-grapes-purple-700":"#7b1fa2","color-grapes-purple-800":"#6A1B9A","color-grapes-purple-900":"#4A148C","color-grapes-purple-a200":"#E040FB","color-grapes-purple-a400":"#D500F9","color-grapes-purple-a700":"#aa00ff","color-berry-pink-100":"#F8BBD0","color-berry-pink-200":"#f48fb1","color-berry-pink-300":"#f06292","color-berry-pink-400":"#ec407a","color-berry-pink-500":"#e91e63","color-berry-pink-600":"#D81B60","color-berry-pink-700":"#C2185B","color-berry-pink-800":"#AD1457","color-berry-pink-900":"#880E4F","color-berry-pink-a100":"#ff80ab","color-berry-pink-a200":"#ff4081","color-berry-pink-a400":"#f50057","color-sky-blue-100":"#B2EBF2","color-sky-blue-200":"#80DEEA","color-sky-blue-300":"#4dd0e1","color-sky-blue-400":"#26c6da","color-sky-blue-500":"#00bcd4","color-sky-blue-600":"#00acc1","color-sky-blue-700":"#0097A7","color-sky-blue-800":"#00838F","color-sky-blue-900":"#006064","color-sky-blue-a400":"#00e5ff","color-sky-blue-a700":"#00B8D4","color-deep-blue-600":"#5E35B1","color-forest-green-50":"#DAF2E6","color-forest-green-100":"#ACE5C9","color-forest-green-200":"#70CC9E","color-forest-green-300":"#42BD7F","color-forest-green-400":"#22AB67","color-forest-green-500":"#089950","color-forest-green-600":"#068043","color-forest-green-700":"#056636","color-forest-green-800":"#004D27","color-forest-green-900":"#1A3326","color-facebook":"#1877F2","color-deep-facebook":"#1564CA","color-twitter":"#1DA1F2","color-deep-twitter":"#188CD3","color-youtube":"#FF0000","color-linkedin":"#007BB5","color-aqua-spring":"#ebf9f5","color-army-green":"#3d2c12","color-army-green-2":"#31230d","color-athens-gray-1":"#f2f3f5","color-athens-gray-2":"#f7f8fa","color-athens-gray-3":"#eceff2","color-black-180":"#b4b4b4","color-blue-dianne":"#21384d","color-bluish":"#2185cc","color-bright-gray":"#363c4e","color-brownish-grey":"#8d6e63","color-carnation":"#f04561","color-catskill-white":"#e1ecf2","color-charade":"#2f3241","color-charcoal-grey":"#323337","color-curious-blue":"#299dcd","color-dark-blue-grey":"#123440","color-darkness-blue-grey":"#12213b","color-dark-grey":"#292a2d","color-dark-grey-blue":"#28415a","color-dark-sky-blue":"#37a6ef","color-deep-sea-blue":"#016087","color-ebony-clay":"#262b3e","color-foam":"#d7f0fb","color-gull-gray":"#9db2bd","color-humming-bird":"#d3eef9","color-keppel-1":"#37bc9b","color-keppel-2":"#34b293","color-lavender-blush":"#ffedf0","color-lightish-purple":"#a75ee8","color-loblolly":"#c5cbce","color-manatee":"#878ca8","color-mandy":"#eb4d5c","color-medium-blue":"#2e7bb2","color-milk-chocolate":"#6f2626","color-mirage-1":"#131722","color-mirage-2":"#171b29","color-mirage-3":"#1c2030","color-mischka":"#d6d8e0","color-morning-glory":"#9addcc","color-oslo-gray":"#8b8e95","color-pale":"#fff2cf","color-pale-grey-1":"#f9fafb","color-pale-grey-2":"#e7ebee","color-pale-sky":"#6b7988","color-picton-blue-1":"#3bb3e4","color-puerto-rico":"#3bc2a1","color-purple-brown":"#4e2934","color-purple-brown-2":"#3d2028","color-radical-red":"#ff4a68","color-regent-gray":"#8797a5","color-scooter":"#38acdb","color-silver-tree":"#53b987","color-slate-gray":"#758696","color-sundown":"#ffa4b3","color-sunglow":"#ffca3b","color-tan-hide":"#ff9850","color-trout-1":"#4c525e","color-trout-2":"#4f5966","color-violet-1":"#332738","color-violet-2":"#271d2b","color-white-ice":"#ebf7fc","color-wild-watermelon":"#ff5773","color-readonly-input":"#b4b4b4","color-brand-dark":"#2a2c39","color-seeking-alpha-brand":"#ff7200"}'),r=JSON.parse('{"color-header-bg":"color-white","color-body-bg":"color-white","color-body-secondary-bg":"color-cold-gray-100","color-bg-primary":"color-white","color-bg-primary-hover":"color-cold-gray-100","color-bg-secondary":"color-white","color-bg-highlight":"color-cold-gray-50","color-bg-scroll-buttons":"color-cold-gray-100","color-legacy-bg-scroll-buttons":"color-cold-gray-850","color-legacy-bg-widget":"color-white","color-text-primary":"color-cold-gray-900","color-text-secondary":"color-cold-gray-550","color-text-tertiary":"color-cold-gray-400","color-text-disabled":"color-cold-gray-300","color-accent-content":"color-cold-gray-900","color-box-shadow":"color-cold-gray-300","color-divider":"color-cold-gray-150","color-divider-hover":"color-cold-gray-100","color-divider-secondary":"color-cold-gray-100","color-active-hover-text":"color-cold-gray-900","color-alert-text":"color-cold-gray-900","color-border-table":"color-cold-gray-100","color-brand":"color-tv-blue-500","color-brand-active":"color-tv-blue-700","color-brand-hover":"color-tv-blue-600","color-chart-page-bg":"color-cold-gray-150","color-common-tooltip-bg":"color-cold-gray-800","color-danger":"color-ripe-red-400","color-danger-hover":"color-ripe-red-500","color-danger-active":"color-ripe-red-600","color-depthrenderer-stroke-style":"color-cold-gray-100","color-highlight-new":"color-tan-orange-50","color-input-bg":"color-white","color-input-publish-bg":"color-white","color-link":"color-tv-blue-500","color-link-hover":"color-tv-blue-600","color-link-active":"color-tv-blue-700","color-list-nth-child-bg":"color-cold-gray-50","color-pane-bg":"color-white","color-pane-secondary-bg":"color-cold-gray-100","color-popup-menu-item-hover-bg":"color-cold-gray-100","color-popup-menu-separator":"color-cold-gray-150","color-screener-description":"color-cold-gray-650","color-success":"color-minty-green-500","color-success-hover":"color-minty-green-600","color-success-active":"color-minty-green-700","color-toolbar-button-text":"color-cold-gray-900","color-toolbar-button-text-hover":"color-cold-gray-900","color-toolbar-button-text-active":"color-tv-blue-500","color-toolbar-button-text-active-hover":"color-tv-blue-600","color-toolbar-button-background-hover":"color-cold-gray-100","color-toolbar-button-background-secondary-hover":"color-cold-gray-150","color-toolbar-button-background-active":"color-tv-blue-50","color-toolbar-button-background-active-hover":"color-tv-blue-100","color-toolbar-toggle-button-background-active":"color-tv-blue-500","color-toolbar-toggle-button-background-active-hover":"color-tv-blue-600","color-toolbar-toggle-button-icon":"color-cold-gray-200","color-toolbar-interactive-element-text-normal":"color-cold-gray-900","color-toolbar-interactive-element-text-hover":"color-cold-gray-900","color-toolbar-opened-element-bg":"color-cold-gray-100","color-toolbar-divider-background":"color-cold-gray-150","color-tooltip-bg":"color-cold-gray-800","color-tv-dialog-caption":"color-cold-gray-650","color-tv-dropdown-item-hover-bg":"color-cold-gray-100","color-underlined-text":"color-cold-gray-500","color-widget-pages-bg":"color-white","color-warning":"color-tan-orange-500","color-growing":"color-minty-green-500","color-falling":"color-ripe-red-500","color-forex-icon":"color-cold-gray-750","color-list-item-active-bg":"color-tv-blue-400","color-list-item-hover-bg":"color-tv-blue-50","color-list-item-text":"color-cold-gray-800","color-price-axis-label-back":"color-cold-gray-150","color-price-axis-label-text":"color-cold-gray-650","color-price-axis-gear":"color-cold-gray-900","color-price-axis-gear-hover":"color-black","color-price-axis-highlight":"color-cold-gray-150","color-bid":"color-tv-blue-500","color-border":"color-cold-gray-150","color-border-chat-fields":"color-cold-gray-250","color-border-hover":"color-cold-gray-250","color-button-hover-bg":"color-cold-gray-150","color-depthrenderer-fill-style":"color-cold-gray-650","color-disabled-border-and-color":"color-cold-gray-150","color-disabled-input":"color-cold-gray-150","color-empty-container-message":"color-cold-gray-550","color-icons":"color-cold-gray-550","color-input-textarea-readonly":"color-cold-gray-650","color-input-placeholder-text":"color-cold-gray-350","color-item-active-blue":"color-tv-blue-50","color-item-hover-active-bg":"color-tv-blue-100","color-item-hover-bg":"color-tv-blue-100","color-item-hover-blue":"color-tv-blue-100","color-item-selected-blue":"color-tv-blue-50","color-item-active-text":"color-white","color-item-active-bg":"color-tv-blue-500","color-list-item":"color-cold-gray-550","color-news-highlight":"color-tv-blue-100","color-placeholder":"color-cold-gray-350","color-row-hover-active-bg":"color-cold-gray-100","color-sb-scrollbar-body-bg":"color-cold-gray-200","color-section-separator-border":"color-cold-gray-300","color-separator-table-chat":"color-cold-gray-150","color-tag-active-bg":"color-cold-gray-200","color-tag-hover-bg":"color-cold-gray-150","color-text-regular":"color-cold-gray-700","color-tv-button-checked":"color-cold-gray-550","color-scroll-bg":"color-cold-gray-400","color-scroll-border":"color-cold-gray-100","color-widget-border":"color-cold-gray-100","color-scroll-buttons-arrow":"color-white","color-control-intent-default":"color-cold-gray-200","color-control-intent-success":"color-minty-green-500","color-control-intent-primary":"color-tv-blue-500","color-control-intent-warning":"color-tan-orange-500","color-control-intent-danger":"color-ripe-red-500","color-goto-label-background":"color-cold-gray-800","color-pre-market":"color-tan-orange-600","color-pre-market-bg":"color-tan-orange-400","color-post-market":"color-tv-blue-500","color-post-market-bg":"color-tv-blue-400","color-market-open":"color-minty-green-500","color-market-open-bg":"color-minty-green-400","color-market-closed":"color-cold-gray-400","color-market-holiday":"color-cold-gray-400","color-market-expired":"color-ripe-red-500","color-invalid-symbol":"color-ripe-red-400","color-invalid-symbol-hover":"color-ripe-red-700","color-replay-mode":"color-tv-blue-500","color-replay-mode-point-select":"color-cold-gray-350","color-replay-mode-icon":"color-white","color-replay-mode-hover":"color-tv-blue-600","color-notaccurate-mode":"color-berry-pink-700","color-notaccurate-mode-bg":"color-berry-pink-400","color-delay-mode":"color-tan-orange-700","color-delay-mode-bg":"color-tan-orange-400","color-eod-mode":"color-grapes-purple-700","color-eod-mode-bg":"color-grapes-purple-400","color-data-problem":"color-ripe-red-600","color-data-problem-bg":"color-ripe-red-400","color-data-problem-hover":"color-ripe-red-700","color-list-item-bg-highlighted":"color-tv-blue-50","color-list-item-bg-selected":"color-tv-blue-100","color-list-item-bg-highlighted-hover":"color-tv-blue-100","color-list-item-bg-selected-hover":"color-tv-blue-200","color-screener-header-bg":"color-white","color-screener-header-bg-hover":"color-cold-gray-100","color-marker-flagged":"color-ripe-red-400","color-marker-flagged-hovered":"color-ripe-red-600","color-ask":"color-ripe-red-400","color-sell":"color-ripe-red-400","color-buy":"color-tv-blue-500","color-neutral":"color-cold-gray-500","color-pro":"color-minty-green-400","color-pro-hover":"color-minty-green-600","color-pro-plus":"color-tv-blue-500","color-pro-plus-hover":"color-tv-blue-600","color-pro-premium":"color-tan-orange-500","color-pro-premium-hover":"color-tan-orange-700","color-trial":"color-cold-gray-500","color-trial-hover":"color-cold-gray-600","color-mod":"color-ripe-red-400","color-mod-hover":"color-ripe-red-600","color-ad":"color-tan-orange-500","color-broker-featured":"color-minty-green-400","color-broker-featured-hover":"color-minty-green-600","color-alert-status-active":"color-minty-green-400","color-alert-status-stopped":"color-ripe-red-500","color-alert-status-triggered":"color-tan-orange-500","color-overlay":"color-cold-gray-400","color-search-button-hover":"color-cold-gray-150","color-boost-button-content-selected":"color-tv-blue-600","color-boost-button-content-hover":"color-cold-gray-900","color-boost-button-bg-hover":"color-cold-gray-150","color-boost-button-border-hover":"color-cold-gray-150","color-boost-button-border-default":"color-cold-gray-150","color-common-tooltip-text":"color-cold-gray-100","color-replay-data-mode":"color-radical-red","color-legacy-success":"color-keppel-1","color-collapse-tabs-border":"color-athens-gray-3","color-site-widget-hover":"color-athens-gray-1","color-attention":"color-sunglow","color-card-border":"color-cold-gray-150","color-card-border-hover":"color-cold-gray-300","color-background-special-primary":"color-white","color-stroke-special-primary":"color-cold-gray-150","color-selection-bg":"color-tv-blue-100"}')
;var n=i(650151);const o={...s,...r},a={},l=Object.keys(o).length,c=/^#[0-9A-F]{6}$/i;function h(e,t=[]){const i=o[e];if(!i)return null;if(c.test(i))return i;const s=i;return t.push(e),-1!==t.indexOf(s)?(console.warn("Colors definitions cycled"),i):t.length>l?(console.warn("Too many variables-link in HEX-color search: "+t[0]),null):h(s,t)}Object.keys(o).forEach((e=>{const t=h(e);a[e]=(0,n.ensureNotNull)(t)}));const d=a;function u(e){const t=d[e];if(!t)throw new Error("No such color "+e);return t}},549423:(e,t,i)=>{"use strict";i.d(t,{dur:()=>s,easingFunc:()=>r,CubicBezier:()=>n});const s=350,r={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:(4-2*e)*e-1,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e};class n{constructor(e,t,i,s){this._mX1=e,this._mY1=t,this._mX2=i,this._mY2=s}easingFunc(e){return this._mX1===this._mY1&&this._mX2===this._mY2?e:this._calcBezier(this._getTForX(e))}_a(e,t){return 1-3*t+3*e}_b(e,t){return 3*t-6*e}_c(e){return 3*e}_calcBezier(e){return((this._a(this._mY1,this._mY2)*e+this._b(this._mY1,this._mY2))*e+this._c(this._mY1))*e}_getSlope(e){return 3*this._a(this._mX1,this._mX2)*e*e+2*this._b(this._mX1,this._mX2)*e+this._c(this._mX1)}_getTForX(e){let t=e;for(let i=0;i<4;++i){const i=this._getSlope(t);if(0===i)return t;t-=(this._calcBezier(t)-e)/i}return t}}},863697:(e,t,i)=>{"use strict";var s;i.d(t,{ToastIntent:()=>s}),function(e){e.Default="default",e.Success="success",e.Warning="warning",e.Danger="danger"}(s||(s={}))},130843:(e,t,i)=>{"use strict";i.d(t,{setupChartEventHint:()=>d});var s=i(650151),r=i(509806),n=i(870122),o=i(358076),a=i(315264),l=i(601227),c=i(180185),h=i(484727);function d(e,t=!1){if(!h.enabled("popup_hints"))return;const d=e.getContainer();let u=null,p=null;function _(e,t){if(u)u.show(e,g.bind(null,t));else{const s=o.tool.value();Promise.all([i.e(9908),i.e(962),i.e(6166)]).then(i.bind(i,215593)).then((i=>{u=new i.ChartEventHintRenderer(d),s===o.tool.value()&&u.show(e,g.bind(null,t))}))}}function m(e){return!Boolean(n.getBool(e))}function g(e){n.setValue(e,!0,{forceFlush:!0}),(0,s.ensureNotNull)(u).destroy(),null!==p&&p(),u=null}o.tool.subscribe((function(){if(!m("hint.touchPainting"))return;const e=o.tool.value(),t=(0,a.isLineToolDrawWithoutPoints)(e),s=l.CheckMobile.any();!(0,a.isStudyLineToolName)(e)||"LineToolRegressionTrend"===e||t||s?(0,a.isLineToolName)(e)&&!(0,a.isLineDrawnWithPressedButton)(e)&&!t&&s?_(r.t(null,void 0,i(967861)),"hint.touchPainting"):u&&u.hide():_(r.t(null,void 0,i(632234)),"hint.touchPainting")})),o.createdLineTool.subscribe(null,(function(){const e=o.tool.value()
;"LineToolPath"===e&&m("hint.finishBuildPathByDblClick")?_(r.t(null,void 0,i(605828)),"hint.finishBuildPathByDblClick"):"LineToolPolyline"===e&&m("hint.finishBuildPolylineByDblClick")&&_(r.t(null,void 0,i(763898)),"hint.finishBuildPolylineByDblClick")})),o.finishedLineTool.subscribe(null,(function(){if(u){const e=o.tool.value();"LineToolPath"===e?g("hint.finishBuildPathByDblClick"):"LineToolPolyline"===e&&g("hint.finishBuildPolylineByDblClick")}})),e.layoutSizesChanged().subscribe((function(){if(!m("hint.startResizingChartInLayout"))return;_(r.t(null,void 0,i(135273)),"hint.startResizingChartInLayout")})),t||l.CheckMobile.any()||!m("hint.startFocusedZoom")||(p=function(e,t){let i=!1;const s=r=>{r?(i&&t(r),e.onZoom().unsubscribe(null,s)):i||(t(r),i=!0)};return e.onZoom().subscribe(null,s),()=>e.onZoom().unsubscribe(null,s)}(e,(function(e){if(!m("hint.startFocusedZoom"))return;if(e)u&&(p=null,g("hint.startFocusedZoom"));else{const e=c.isMacKeyboard?"⌘":"Ctrl";_(r.t(null,void 0,i(35963)).format({key:e}),"hint.startFocusedZoom")}})))}},188718:(e,t,i)=>{"use strict";i.d(t,{setupChartScreenshotHint:()=>o});var s=i(509806),r=i(559410),n=i(650151);function o(e,t){const o=s.t(null,void 0,i(678104)).format({emoji:"👍"}),a=s.t(null,void 0,i(812011)).format({emoji:"👍"});r.on("onServerScreenshotCopiedToClipboard",(()=>h(o)),null),r.on("onClientScreenshotCopiedToClipboard",(()=>h(a)),null);let l=null;const c=e.getContainer();function h(e){l?l.show(e):Promise.all([i.e(8707),i.e(849),i.e(5531),i.e(962),i.e(92)]).then(i.bind(i,861156)).then((i=>{l||(l=new i.ChartScreenshotHintRenderer((0,n.ensureNotNull)(c),{bottomPadding:t.seriesControlBarEnabled}),l.show(e))}))}}},72304:(e,t,i)=>{"use strict";i.d(t,{getTooltipData:()=>r,setTooltipData:()=>n});const s=new WeakMap;function r(e,t){const i=s.get(e);return i instanceof Function?i(t):i&&i[t]}function n(e,t,i){if(i instanceof Function)return void s.set(e,i);const r=s.get(e),n=void 0===r||r instanceof Function?{}:r;n[t]=i,s.set(e,n)}},725784:(e,t,i)=>{"use strict";i.d(t,{hotKeySerialize:()=>r,hotKeyDeserialize:()=>n});var s=i(592834);function r(e){return(0,s.clean)(JSON.stringify(e))}function n(e){return JSON.parse((0,s.clean)(e,!0))}},744471:(e,t,i)=>{"use strict";i.d(t,{hide:()=>$,show:()=>U,showOnElement:()=>H,tooltipClickHandler:()=>j});var s=i(972535);let r=0,n=0,o=0;function a(){clearTimeout(r),clearTimeout(n),clearTimeout(o)}function l(e,t){r=setTimeout(e,t)}const c="tooltip-root-element";let h;function d(){const e=document.getElementById(c);e?h=e:(h=document.createElement("div"),h.id=c,document.body.appendChild(h))}function u(){h&&(h.innerHTML="")}"interactive"===document.readyState?d():document.addEventListener("DOMContentLoaded",d);var p=i(650151);const _={default:"",white:"theme-white","round-shadow":"theme-round-shadow"},m=Object.keys(_);var g=i(72304),f=i(725784),v=i(488563),S=i(561626),y=(i(603605),i(260845)),b=i(218954),w=i(601227),P=i(1338);function C(e){const t=function(e){const t=e.hasAttribute("data-tooltip")?e.getAttribute("data-tooltip"):e.getAttribute("title")
;return t&&((0,g.setTooltipData)(e,"text",t),e.removeAttribute("title")),(0,g.getTooltipData)(e,"text")||""}(e),i=e.getBoundingClientRect(),s={h:i.height,w:i.width,x:i.left,y:i.top},r=e.getAttribute("data-color-theme")||"",n=e.classList.contains("common-tooltip-html"),o=parseInt(e.getAttribute("data-tooltip-delay")||""),a=parseInt(e.getAttribute("data-tooltip-debounce")||"");let l={type:"none"};return t&&(l={type:n?"html":"text",data:t}),{above:e.classList.contains("common-tooltip-above"),below:e.classList.contains("common-tooltip-below"),otl:e.classList.contains("common-tooltip-otl"),otr:e.classList.contains("common-tooltip-otr"),vertical:e.classList.contains("common-tooltip-vertical"),hotkey:e.getAttribute("data-tooltip-hotkey"),narrow:e.classList.contains("common-tooltip-narrow"),wide:e.classList.contains("common-tooltip-wide"),colorTheme:r,tooltipDelay:o,tooltipDebounce:a,rect:s,content:l,target:e}}function T(e){const t=E.cloneNode(!0),i=V(t),{content:s}=e;switch(s.type){case"element":i.innerHTML="",i.appendChild(s.data);break;case"html":i.innerHTML=s.data;break;case"text":if(e.hotkey){const e=B.cloneNode(!0);e.innerText=s.data,i.appendChild(e)}else i.innerText=s.data}if(e.hotkey){const t="none"!==s.type,r=D.cloneNode(!0),n=(0,f.hotKeyDeserialize)(e.hotkey),o=n.keys.map((e=>`<span class="${P["common-tooltip__hotkey-button"]}">${e}</span>`));r.innerHTML=function(e,t){const i=/{\d}|{hotkey_\d}/gi;return e.replace(i,(e=>{const i=Number(e.match(/\d/));return t[i]}))}(n.text,o).replace(/\s\+\s/g,`<span class="${P["common-tooltip__plus-sign"]}">+</span>`),i.classList.add(P["common-tooltip__body--with-hotkey"]),t&&r.classList.add(P["common-tooltip__hotkey-block--divider"]),i.appendChild(r)}return t.addEventListener("contextmenu",y.preventDefault),t}function x(e,t){const i=t.rect;if(!i)return;!function(e,t){const i=m.includes(t)?_[t]:"";e.classList.remove(...m.map((e=>_[e])).filter((e=>!!e))),i&&!e.classList.contains(i)&&e.classList.add(i)}(e,t.colorTheme||"default"),t.addClass&&e.classList.add(t.addClass);const s=V(e),r=e.querySelector(`.${P["common-tooltip__button-container"]}`);s.classList.toggle(P["common-tooltip__body--width_wide"],Boolean(t.wide)),s.classList.toggle(P["common-tooltip__body--no-padding"],Boolean(t.noPadding)),s.classList.toggle(P["common-tooltip__body--width_narrow"],Boolean(t.narrow)),s.classList.toggle(P["common-tooltip__body--no-buttons"],!0),s.style.left=M(0),s.style.width=M(s.clientWidth+(Boolean(t.noPadding)?0:2));const n=document.body.clientWidth,o=w.CheckMobile.iOS()||(0,w.supportTouch)()&&(0,w.isMac)()?window.innerHeight:document.body.clientHeight,a=t.vertical,l=t.extendMargin||a&&i.w<20||!a&&i.h<20;e.classList.toggle(P["common-tooltip--farther"],l),e.classList.toggle(P["common-tooltip--vertical"],a),e.classList.toggle(P["common-tooltip--horizontal"],!a);const c=function(e){return e.querySelector(`.${P["common-tooltip__ear-holder"]}`)}(e),h=e.offsetHeight;if(a){const a=10,l=o-10,d=12,u=a+d,p=l-d,_=(0,b.clamp)(i.y+i.h/2,u,p)-h/2,m=_+h;e.style.left=M(i.x+i.w),e.style.top=M(_),
_<a?s.style.top=r.style.top=M(a-_):m>l&&(s.style.top=r.style.top=M(l-m));const{right:g}=(e.querySelector(":last-child")||s).getBoundingClientRect(),f=g+10>n;e.classList.toggle(P["common-tooltip--direction_reversed"],f),e.classList.toggle(P["common-tooltip--direction_normal"],!f);let v=f?"after":"before";(0,S.isRtl)()?(v=t.otr?"after":v,v=t.otl?"before":v):(v=t.otr?"before":v,v=t.otl?"after":v),c.classList.toggle(P["common-tooltip__ear-holder--before"],"before"===v),c.classList.toggle(P["common-tooltip__ear-holder--after"],"after"===v),"after"===v&&(e.style.left="auto",e.style.right=M(n-i.x))}else{const a=i.x-(s.offsetWidth-i.w)/2,l=n-10-e.offsetWidth,d=Math.max(10,Math.min(a,l));e.style.left=M(d);const u=l<a;e.classList.toggle(P["common-tooltip--direction_reversed"],u),e.classList.toggle(P["common-tooltip--direction_normal"],!u);const p=function(e,t,i,s){if(e.above)return R(t,s)?"above":"below";if(e.below)return function(e,t,i){return i.y+i.h+t+10<e}(t,i,s)?"below":"above";return R(i,s)?"above":"below"}(t,o,h,i);"above"===p?e.style.bottom=M(o-i.y):e.style.top=M(i.y+i.h),c.classList.add("above"===p?P["common-tooltip__ear-holder--above"]:P["common-tooltip__ear-holder--below"]);const{left:_}=s.getBoundingClientRect();let m=Math.trunc(i.x+i.w/2-(_+s.clientWidth/2));e.style.left=M(d+m),e.style.width=M(s.clientWidth+r.clientWidth),m=u?Math.max(0,m):Math.min(0,m),r.style.left=M(-m),s.style.left=M(-m)}}function I(e){e.classList.toggle(P["common-tooltip--hidden"],!0)}function M(e){return`${Math.floor(e)}px`}const L=`\n\t<div id="common-tooltip-wrapper" class="${P["common-tooltip"]}">\n\t\t<div class="${P["common-tooltip__ear-holder"]}" >\n\t\t\t<div class="${P["common-tooltip__body"]} js-tooltip-body"></div>\n\t\t</div>\n\t\t<div class="${P["common-tooltip__button-container"]}"></div>\n\t</div>\n`,A=`\n\t<div class="${P["common-tooltip__hotkey-block"]}"></div>\n`,k=`\n\t<div class="${P["common-tooltip__hotkey-text"]}"></div>\n`,E=(0,v.parseHtmlElement)(L),D=(0,v.parseHtmlElement)(A),B=(0,v.parseHtmlElement)(k);function V(e){return e.querySelector(`.${P["common-tooltip__body"]}`)}function R(e,t){return 10+e<t.y}var N=i(411589);let O=!1,F=null,W=null;s.mobiletouch||document.addEventListener("mouseover",(function(e){var t;if(null===(t=e.sourceCapabilities)||void 0===t?void 0:t.firesTouchEvents)return;const i=e.target,s=e.currentTarget,r=function(e,t,i){const s=[];for(;e&&e!==t;)e.classList&&e.classList.contains(i)&&s.push(e),e=e.parentElement||K(e.parentNode);return s}(i,s,"apply-common-tooltip"),n=()=>{W&&(W.destroy(),W=null)};for(const t of r){if("buttons"in e){if(1&e.buttons)continue}else if(1===e.which)continue;const i=()=>H(t);if(i()){const e=e=>{e.target instanceof Element&&e.target.contains(t)&&s(null,!0)},s=(r,o=!1)=>{t.removeEventListener("common-tooltip-update",i),t.removeEventListener("mouseleave",s),t.removeEventListener("mousedown",s),document.removeEventListener("scroll",e,{capture:!0}),n(),$(o)};t.addEventListener("common-tooltip-update",i),t.addEventListener("mouseleave",s),t.addEventListener("mousedown",s),
document.addEventListener("scroll",e,{capture:!0}),null===W&&(W=(0,N.createGroup)({desc:"Tooltip"}),W.add({desc:"Hide",hotkey:27,handler:s}));break}}}),!0);const z=new MutationObserver((()=>{if(F&&F.options.target){let e;e="isConnected"in F.options.target?F.options.target.isConnected:document.body.contains(F.options.target),e||$()}})),H=(e,t={})=>{const{content:i,...s}=Z(t),r=C(e),n=Object.assign(r,s);return"none"!==i.type&&(n.content=i),!("none"===n.content.type&&!n.hotkey)&&(n.target=e,U(n),!0)},U=e=>{const t=Z(e),i=T(t);var s;if(F={options:t,element:i},s=i,u(),h&&h.appendChild(s),a(),!O)return I(i),void l((()=>Y(i)),function(e){return"number"!=typeof e.tooltipDelay||isNaN(e.tooltipDelay)?500:e.tooltipDelay}(t));const{tooltipDebounce:r}=e;"number"!=typeof r||isNaN(r)?Y(i):l((()=>Y(i)),r)};function j(e){s.mobiletouch&&(H(e.currentTarget,{tooltipDelay:0}),document.addEventListener("scroll",G),document.addEventListener("touchstart",G))}function G(){document.removeEventListener("scroll",G),document.removeEventListener("touchstart",G),$()}function q(){u(),O=!1,F=null}const $=e=>{if(a(),z.disconnect(),!F)return;if(!e&&!O)return;const{element:t,options:i}=F,s=()=>{t.removeEventListener("mouseleave",s),I(t),e?q():o=setTimeout((()=>{q()}),250)};var r,l;i.tooltipHideDelay?(r=()=>{t.querySelector(":hover")?t.addEventListener("mouseleave",s):s()},l=i.tooltipHideDelay,n=setTimeout(r,l)):s()};function Y(e){const{options:t}=(0,p.ensureNotNull)(F);if(x(e,t),function(e){e.classList.toggle(P["common-tooltip--hidden"],!1)}(e),z.observe(document,{childList:!0,subtree:!0}),O=!0,t.forceHideOnMove){const e=()=>{document.removeEventListener("mousemove",e),$()};document.addEventListener("mousemove",e)}}function K(e){return e&&(e.nodeType===Node.ELEMENT_NODE?e:null)}function Z(e){if(function(e){return"content"in e}(e))return e;const{inner:t,html:i,text:s,...r}=e;let n={type:"none"};return t&&(n={type:"element",data:t}),s&&(n={type:i?"html":"text",data:s}),{content:n,...r}}},207847:(e,t,i)=>{"use strict";i.d(t,{ChartPage:()=>d});var s=i(210596),r=i.n(s),n=i(852752);function o(e,t){let i=0;for(const{min:s,max:r}of t){if(e<s||r<s)continue;const t=Math.min(e,r);if(i=Math.max(i,t),e===i)break}return i}function a(e){const t=[];if(void 0===e)return[];Array.isArray(e)||(e=[e]);for(const i of e){let e,s;isFinite(i)?e=s=Number(i):(e=+i.min,s=+i.max),(e<0||isNaN(e))&&(e=0),isNaN(s)&&(s=1/0),e<=s&&s>0&&t.push({min:e,max:s})}return t.sort(((e,t)=>e.min-t.min||e.max-t.max)),t}function l(e,t){if(e.length!==t.length)return!1;for(let i=e.length;i--;){if(e[i].min!==t[i].min)return!1;if(e[i].max!==t[i].max)return!1}return!0}var c=i(484727);const h=c.enabled("no_min_chart_width");class d{constructor(e){this._processVisibility=e=>{const t=e.container.value();return this.affectsLayout(e.name)?(t&&t.classList.toggle("js-hidden",!1),!0):(t&&t.classList.toggle("js-hidden",!0),!1)},this._setWidth=(e,t,i)=>{let s=i;this._fullscreenArea!==e.name&&(e.availWidth.setValue(i),e.canNegotiate.width&&(s=o(i,e.negotiations.width))),t||(s=0);const r=e.container.value()
;return r&&t&&(r.style.width=s+"px"),e.width.setValue(s),s},this._setHeight=(e,t,i)=>{let s=i;this._fullscreenArea!==e.name&&(e.availHeight.setValue(i),e.canNegotiate.height&&(s=o(i,e.negotiations.height))),t||(s=0);const r=e.container.value();return r&&t&&(r.style.height=s+"px"),e.height.setValue(s),s};const t=e.container.value();if(!t)throw new Error("bridge.container.value() must be an element");this._container=t,this._availableAreas=["left","tradingpanel","right","top","bottom","center","topleft","extratop"],this._areas={},this._bridge=e,this._width=e.width,this._height=e.height,this._width.subscribe((()=>this.recalculate())),this._height.subscribe((()=>this.recalculate())),this._bridge.visible.subscribe((()=>this._updateVisibility())),this._bridge.fullscreen.subscribe((()=>this._onParentFullscreenChange())),this.recalculate()}allocate(e){const t=e&&e.areaName;if(-1===this._availableAreas.indexOf(t))throw new Error("unknown options.areaName");this.free(t);const i=this._createDOM(t),s={name:t,canNegotiate:{width:"left"===t||"right"===t||"tradingpanel"===t||"topleft"===t,height:"top"===t||"bottom"===t||"topleft"===t||"extratop"===t},negotiations:{width:[],height:[]},remove:()=>{for(const e in this._areas)this._areas[e]===s&&this.free(e)},negotiateWidth:e=>{if(!s.canNegotiate.width)return;const t=a(e);l(s.negotiations.width,t)||(s.negotiations.width=t,this.recalculate())},negotiateHeight:e=>{if(!s.canNegotiate.height)return;const t=a(e);l(s.negotiations.height,t)||(s.negotiations.height=t,this.recalculate())},requestFullscreen:()=>{this._fullscreenArea||("right"!==t&&"center"!==t||(this._fullscreenArea=t),"center"===t&&this._bridge.requestFullscreen(),this._updateFullscreen())},exitFullscreen:()=>{t===this._fullscreenArea&&(this._fullscreenArea=void 0,"center"===t&&this._bridge.exitFullscreen(),this._updateFullscreen())},width:new(r()),height:new(r()),availWidth:new(r()),availHeight:new(r()),alive:new(r())(!0),container:new(r())(i),visible:new(r())(!0),fullscreen:new(r())(!1),fullscreenable:new(r())("right"===t||"center"===t),rdState:new n.ResizerDetacherState};return s.rdState.pushOwner(s),this._areas[t]=s,s.rdState.owner.subscribe((e=>{const i=s.container.value();if(e!==s)i&&(i.innerHTML="",i.parentElement&&i.parentElement.removeChild(i));else{let e=null;for(let i=this._availableAreas.indexOf(t);i--;){const t=this._availableAreas[i];if(this.affectsLayout(t)){e=this._areas[t].container.value();break}}i&&(e&&i.parentElement?i.insertAdjacentElement("afterend",e):this._container.appendChild(i))}this.recalculate()}),{callWithLast:!0}),s.rdState.bridge()}free(e){const t=this._areas[e];if(!t)return;this._areas[e]=void 0;const i=t.container.value();i&&i.parentElement&&i.parentElement.removeChild(i),t.alive.setValue(!1)}recalculate(){const e={};this._recalcSingleRunToken=e;const t=this._areas.topleft,i=this._areas.left,s=this._areas.tradingpanel,r=this._areas.right,n=this._areas.top,o=this._areas.bottom,a=this._areas.center,l=this._areas.extratop,c=this._width.value(),d=this._height.value()
;let u=0,p=0,_=0,m=0,g=0,f=0,v=0,S=0;if(e===this._recalcSingleRunToken&&l){const e=this._processVisibility(l);S=this._setHeight(l,e,d),this._setWidth(l,e,c)}if(e===this._recalcSingleRunToken&&t){const e=this._processVisibility(t);v=this._setHeight(t,e,d),f=this._setWidth(t,e,c);const i=t.container.value();e&&i&&(i.style.top=S+"px")}let y=0;if(e===this._recalcSingleRunToken&&n){const e=this._processVisibility(n),t=n.container.value();e&&t&&(t.style.left=f+"px",t.style.top=S+"px");const i=c-f;this._setWidth(n,e,i),u=this._setHeight(n,e,d),u&&(y=1)}if(e===this._recalcSingleRunToken&&i){const e=this._processVisibility(i),t=Math.max(v,u);_=this._setWidth(i,e,c),_&&(_+=4),_&&1===y&&(y=4);const s=i.container.value();e&&s&&(s.style.top=t+S+y+"px"),this._setHeight(i,e,d-t-S)}if(e===this._recalcSingleRunToken&&s){const e=this._processVisibility(s);let t=c-_;h||(t-=300),g=this._setWidth(s,e,t),g&&1===y&&(y=4),this._setHeight(s,e,d-S-u-y)}if(e===this._recalcSingleRunToken&&r){const e=this._processVisibility(r);let t=c-_-g;h||(t-=300),m=this._setWidth(r,e,t),m&&1===y&&(y=4),this._setHeight(r,e,d-S-u-y);const i=r.container.value();e&&i&&(i.style.top=u+S+y+"px",i.classList.toggle("no-border-top-left-radius",Boolean(g)))}const b=g+m;let w=0;const P=c-_-g-m-(b?4:0);if(e===this._recalcSingleRunToken&&o){const e=this._processVisibility(o),t=o.container.value();e&&t&&(t.style.left=_+"px",t.classList.toggle("no-border-top-left-radius",!_),t.classList.toggle("no-border-top-right-radius",!b)),this._setWidth(o,e,P);const i=d-S;w=Math.min(300,i-0),p=this._setHeight(o,e,i)+4}const C=Boolean(u&&(_||b));if(this._container.classList.toggle("layout-with-border-radius",C),e===this._recalcSingleRunToken&&a){const e=this._processVisibility(a),t=a.container.value();e&&t&&(t.style.left=_+"px",t.style.top=u+S+y+"px",t.classList.toggle("no-border-bottom-left-radius",!p||!_),t.classList.toggle("no-border-bottom-right-radius",!b||!p),t.classList.toggle("no-border-top-left-radius",Boolean(!_&&b)),t.classList.toggle("no-border-top-right-radius",Boolean(_&&!b))),this._setWidth(a,e,P);const i=d-u-p-S-y;this._setHeight(a,e,Math.max(i,w))}if(e===this._recalcSingleRunToken&&s&&this.affectsLayout("tradingpanel")){const e=s.container.value();e&&(e.style.right=m+"px",e.style.top=S+u+y+"px",e.style.borderTopLeftRadius=C?"4px":"0px")}e===this._recalcSingleRunToken&&this._updateVisibility()}affectsLayout(e){const t=this._areas[e];if(!t)return!1;if(t.rdState.owner.value()!==t)return!1;if(this._fullscreenArea&&this._fullscreenArea!==e)return u(e);if(this._width.value()<=567||this._height.value()<=445){if(!["center","top","left","topleft","extratop"].includes(e))return!1}return!0}_updateVisibility(){const e=this._bridge.visible.value();for(let t=0;t<this._availableAreas.length;t++){const i=this._availableAreas[t],s=this._areas[i];s&&(e&&this.affectsLayout(i)?s.visible.setValue(!0):s.visible.setValue(!1))}}_onParentFullscreenChange(){this._bridge.fullscreen.value()||(this._fullscreenArea=void 0,this._updateFullscreen())}_updateFullscreen(){
const e=void 0!==this._fullscreenArea;for(let t=0;t<this._availableAreas.length;t++){const i=this._availableAreas[t],s=this._areas[i];if(!s)continue;if(i===this._fullscreenArea){s.fullscreen.setValue(!0);continue}s.fullscreen.setValue(!1);const r=s.container.value();r&&r.classList.toggle("js-hidden",e&&!u(i))}this._updateVisibility(),this.recalculate()}_createDOM(e){const t=document.createElement("div");return t.classList.add("layout__area--"+e),t.style.position="absolute","tradingpanel"===e&&(t.style.overflow="hidden",t.style.borderTopLeftRadius="4px"),"bottom"===e?t.style.bottom="0":t.style.top="0","right"===e||"tradingpanel"===e?t.style.right="0":t.style.left="0",t}}function u(e){const t=c.enabled("side_toolbar_in_fullscreen_mode"),i=c.enabled("header_in_fullscreen_mode");return"center"===e||"left"===e&&t||"top"===e&&i}},852752:(e,t,i)=>{"use strict";i.d(t,{ResizerDetacherState:()=>o});var s=i(650151),r=i(210596),n=i.n(r);class o{constructor(e){this._alive=new(n()),this._container=new(n()),this._width=new(n()),this._height=new(n()),this._fullscreen=new(n()),this._detachable=new(n()),this._fullscreenable=new(n()),this._visible=new(n()),this._availWidth=new(n()),this._availHeight=new(n()),this._owner=new(n()),this._ownersStack=[],this.owner=this._owner.readonly(),this._bridge={alive:this._alive.readonly(),container:this._container.readonly(),width:this._width.readonly(),height:this._height.readonly(),fullscreen:this._fullscreen.readonly(),detachable:this._detachable.readonly(),fullscreenable:this._fullscreenable.readonly(),visible:this._visible.readonly(),availWidth:this._availWidth.readonly(),availHeight:this._availHeight.readonly(),remove:()=>{const e=this._owner.value();e&&e.remove&&e.remove()},negotiateWidth:e=>{const t=this._owner.value();t&&t.negotiateWidth&&t.negotiateWidth(e)},negotiateHeight:e=>{const t=this._owner.value();t&&t.negotiateHeight&&t.negotiateHeight(e)},requestFullscreen:()=>{const e=this._owner.value();e&&e.requestFullscreen&&e.requestFullscreen()},exitFullscreen:()=>{const e=this._owner.value();e&&e.exitFullscreen&&e.exitFullscreen()},detach:e=>{const t=this._owner.value();t&&t.detach&&t.detach(e)},attach:()=>{const e=this._owner.value();e&&e.attach&&e.attach()}},e&&this.pushOwner(e)}bridge(){return this._bridge}pushOwner(e){if(!e.alive.value())return;for(const e of this._ownersStack)this._unsubscribeOwner(e);const t={owner:e};this._ownersStack.push(t),this._subscribeOwner(t)}_subscribeOwner(e){const t=e.owner;if(e.deathWatcher||(this._alive.setValue(!0),e.deathWatcher=t.alive.spawn(),e.deathWatcher.subscribe((t=>{t||this._deadHandler(e)}))),this._owner.setValue(t),!e.subscriptions){const i=e.subscriptions=[];this._visible.setValue(!1);const s=(e,t)=>{if(e){const s=e.spawn();i.push(s),s.subscribe((e=>{t.setValue(e)}),{callWithLast:!0})}else t.deleteValue()};s(t.container,this._container),s(t.width,this._width),s(t.height,this._height),s(t.fullscreen,this._fullscreen),s(t.detachable,this._detachable),s(t.fullscreenable,this._fullscreenable),s(t.availWidth,this._availWidth),
s(t.availHeight,this._availHeight),s(t.visible,this._visible)}}_unsubscribeOwner(e,t){if(e.subscriptions){for(const t of e.subscriptions)t.unsubscribe();e.subscriptions=null}t&&e.deathWatcher&&(e.deathWatcher.unsubscribe(),e.deathWatcher=null)}_deadHandler(e){const t=this._ownersStack.indexOf(e);(0,s.assert)(-1!==t,"sanitized owner should be in stack");for(let e=this._ownersStack.length-1;e>=t;e--)this._unsubscribeOwner(this._ownersStack[e],!0);this._ownersStack.length=t,t>0?this._subscribeOwner(this._ownersStack[t-1]):(this._alive.setValue(!1),this._owner.deleteValue())}}},912036:(e,t,i)=>{"use strict";i.d(t,{Root:()=>d});var s=i(210596),r=i.n(s),n=i(852752);class o{constructor(e){this._document=e,this.isFullscreen=new(r());const t=()=>{const e=["fullscreenElement","webkitFullscreenElement","mozFullscreenElement","mozFullScreenElement","msFullscreenElement"];for(let t=0;t<e.length;t++){const i=e[t];if(i in this._document){this.isFullscreen.setValue(!!this._document[i]);break}}};t();for(const i of["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"])e.addEventListener(i,t,!1)}enter(){const e=this._document.documentElement;for(const t of["requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen"])if("function"==typeof e[t]){e[t]();break}this.isFullscreen.setValue(!0)}exit(){const e=this._document;for(const t of["exitFullscreen","mozCancelFullScreen","mozExitFullscreen","webkitExitFullscreen","msExitFullscreen"])if("function"==typeof e[t]){e[t]();break}this.isFullscreen.setValue(!1)}}class a{constructor(e){let t;this.isVisible=new(r())(!0);let i=null;for(const s of["","moz","ms","webkit"]){const r=s?`${s}Hidden`:"hidden";if(r in e){t=`${s}visibilitychange`,i=()=>{this.isVisible.setValue(!e[r])},i(),e.addEventListener(t,i,!1);break}}this.destroy=()=>{i&&(e.removeEventListener(t,i,!1),i=null)}}}var l=i(69111),c=i(650151),h=i(601227);class d{constructor(e){this._updateDocumentHeight=e=>{"visual"===this._viewportType&&this._window.document.documentElement.style.setProperty("height",`${e}px`,"important")},this._window=e,this._fullscreenApi=new o(e.document),this._viewportType=h.CheckMobile.iOS()&&!(0,l.isOnMobileAppPage)("any")&&this._window.visualViewport?"visual":"quirks","visual"===this._viewportType?this._viewport=(0,c.ensure)(this._window.visualViewport):this._viewport=this._window;const t=this._layoutSizeSensor=this._window.document.createElement("div");t.id="layout-size-sensor",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.pointerEvents="none",t.style.visibility="hidden",this._initFullscreen()}allocate(){this.free();const e=this._window.document,t=e.createElement("div");t.classList.add("js-rootresizer__contents"),t.style.position="relative",t.style.width="100%",t.style.height="100%",e.body.insertAdjacentElement("afterbegin",t),e.body.insertAdjacentElement("afterbegin",this._layoutSizeSensor),this._visibilityApi=new a(this._window.document);const i={alive:new(r())(!0),fullscreenable:new(r())(!0),
container:new(r())(t),width:new(r()),height:new(r()),availWidth:new(r()),availHeight:new(r()),visible:this._visibilityApi.isVisible,fullscreen:this._fullscreenApi.isFullscreen,remove:()=>{i.alive.setValue(!1)},attach:()=>{i.alive.setValue(!1),this._window.close()},requestFullscreen:()=>{this._requestFullscreen()},exitFullscreen:()=>{this._exitFullscreen()}};return i.alive.subscribe((e=>{e||i!==this._area||this.free()})),this._area=i,this._resizeHandler=()=>{const e=this._width(i)||800,t=this._height(i)||600;i.availHeight.setValue(t),i.availWidth.setValue(e),i.height.setValue(t),i.width.setValue(e)},this._area.height.subscribe(this._updateDocumentHeight,{callWithLast:!0}),this._resizeHandler(),this._viewport.addEventListener("resize",this._resizeHandler),new n.ResizerDetacherState(i).bridge()}free(){if(this._resizeHandler&&(this._viewport.removeEventListener("resize",this._resizeHandler),this._resizeHandler=void 0),this._visibilityApi&&(this._visibilityApi.destroy(),this._visibilityApi=void 0),this._area){const e=this._area;this._area=void 0,e.height.unsubscribe(this._updateDocumentHeight),e.alive.setValue(!1);const t=e.container.value(),i=null==t?void 0:t.parentElement;i&&(i.removeChild(t),i.removeChild(this._layoutSizeSensor))}}_height(e){if("visual"===this._viewportType)return this._layoutSizeSensor.clientHeight;return e.container.value().clientHeight}_width(e){return e.container.value().clientWidth}_requestFullscreen(){this._fullscreenApi.enter()}_exitFullscreen(){this._fullscreenApi.exit()}_initFullscreen(){this._fullscreenApi.isFullscreen.subscribe((e=>{this._resizeHandler&&this._resizeHandler()}))}}},663654:(e,t,i)=>{"use strict";i.d(t,{DEFAULT_SIZE:()=>s,spinnerSizeMap:()=>r});const s="large",r={mini:"xsmall",xsmall:"xsmall",small:"small",medium:"medium",large:"large"}},374589:(e,t,i)=>{"use strict";i.d(t,{Spinner:()=>o});i(286625);var s=i(488563),r=i(663654);const n=(0,s.parseHtmlElement)(function(e=""){return`<div class="tv-spinner ${e}" role="progressbar"></div>`}());class o{constructor(e){this._shown=!1,this._el=n.cloneNode(!0),this.setSize(r.spinnerSizeMap[e||r.DEFAULT_SIZE])}spin(e){return this._el.classList.add("tv-spinner--shown"),void 0===this._container&&(this._container=e,void 0!==e&&e.appendChild(this._el)),this._shown=!0,this}stop(e){return e&&void 0!==this._container&&this._container.removeChild(this._el),this._el.classList.remove("tv-spinner--shown"),this._shown=!1,this}setStyle(e){return Object.keys(e).forEach((t=>{const i=e[t];void 0!==i&&this._el.style.setProperty(t,i)})),this}style(){return this._el.style}setSize(e){const t=void 0!==e?`tv-spinner--size_${e}`:"";return this._el.className=`tv-spinner ${t} ${this._shown?"tv-spinner--shown":""}`,this}getEl(){return this._el}destroy(){this.stop(),delete this._el,delete this._container}}},333183:(e,t,i)=>{"use strict";i.d(t,{TradingBootloader:()=>d});var s=i(33290),r=i(181370),n=i(9316),o=i(870122),a=i.n(o),l=i(484727),c=i(128943),h=i(991429);class d extends r.ChunkLoader{constructor(e){super(),this._options=e
;if(a().getBool(c.settingsKeys.TRADING_PANEL_OPENED,l.enabled("show_order_panel_on_start"))){const e=(0,n.getThemedColor)("color-pane-bg");this._options.resizerBridge.negotiateWidth(a().getInt(c.settingsKeys.PANEL_WIDTH)||h.panelWidth),this._options.resizerBridge.negotiateHeight(h.panelHeight),this._options.resizerBridge.container.value().style.setProperty("background-color",e)}}async _startLoading(){return this._loadTrading()}async _loadTrading(){const{resizerBridge:e,chartWidgetCollection:t}=this._options,[{TRADING_SERVICE:r},{Trading:n}]=await Promise.all([Promise.all([i.e(6907),i.e(8230),i.e(9602),i.e(1901),i.e(1428),i.e(1685),i.e(2301),i.e(5993),i.e(9421),i.e(962),i.e(9255),i.e(7664),i.e(945),i.e(766),i.e(3884),i.e(852),i.e(5142)]).then(i.bind(i,140641)),Promise.all([i.e(6907),i.e(8230),i.e(9602),i.e(1901),i.e(1428),i.e(1685),i.e(2301),i.e(5993),i.e(9421),i.e(962),i.e(9255),i.e(7664),i.e(945),i.e(766),i.e(3884),i.e(852),i.e(5142)]).then(i.bind(i,550861))]),o=new n(e,this._options.bottomWidgetBarSettled);return s.registerService(r,o),void 0!==t&&o.setChartWidgetCollection(t),o}}},939535:(e,t,i)=>{"use strict";i.d(t,{createStubElem:()=>r});var s=i(860309);function r(e=[],t=[]){const i=document.createElement("div"),r=document.createElement("div");return i.appendChild(r),i.classList.add(s.container),r.classList.add(s.inner),e.forEach((e=>{i.classList.add(s[e])})),t.forEach((e=>{i.classList.add(s[e])})),i}},425666:(e,t,i)=>{"use strict";i.d(t,{configuration:()=>d});var s=i(650151),r=i(484727),n=i(979359),o=i(48547),a=i(354364),l=i(530401),c=i(743717);function h(e){return(0,s.ensure)(e.chartApiInstance),class e extends o.WidgetbarWidgetRenderer{constructor(e){super(e),this._pendingOperationPromise=null,this._task=null,this._props=e,this.mount()}mount(){const t=this._loadModulePromise=e.preload().then((([e,i,s,o,c,h,d,u])=>{if(this._loadModulePromise===t){const{store:t,runner:p,actions:_}=e,{initWidget:m}=_,{readonly:g,unAuthEditable:f}=this._props;this._task=p.run(d.watchListSaga);const v=new l.WatchlistWidgetViewState;t.dispatch(m(n.WATCHLIST_WIDGET_ID,(0,a.getInitialTickerType)(),v.getColumns(),{shouldDisplayColumnsMenu:!0,shouldDisplayPositions:!0,isSortable:!0,enableContextMenu:r.enabled("watchlist_context_menu")&&!r.enabled("widget"),isDeletable:!g,isMovable:!g,shouldDisplaySymbolSearch:f||!g&&!r.enabled("widget"),enableAddSymbolsByAnon:Boolean(f)||!0,isLogoEnabled:v.getIsLogoEnabled()}));const S=u?i.createElement(u.NotesProvider,null,i.createElement(c.WatchList,{widgetId:n.WATCHLIST_WIDGET_ID,viewState:v})):i.createElement(c.WatchList,{widgetId:n.WATCHLIST_WIDGET_ID,viewState:v});s.render(i.createElement(o.Provider,{store:t},S),this._container),s.render(i.createElement(o.Provider,{store:t},i.createElement(h.Header,{widgetId:n.WATCHLIST_WIDGET_ID})),this._headerContainer)}}))}unmount(){super.unmount(),this._cancelTask()}addSymbols(e){e.length&&this._initSymbolList((t=>{const{store:i,actions:s}=t;i.dispatch(s.addSymbols(n.WATCHLIST_WIDGET_ID,e))}))}saveListAs(e,t){e&&this._initSymbolList((i=>{
const{store:s,actions:r}=i;s.dispatch(r.saveListAs(n.WATCHLIST_WIDGET_ID,e,void 0,t))}))}createNewList(){this._initSymbolList((e=>{const{store:t,actions:i}=e;t.dispatch(i.createNewWatchList(null))}))}destroy(){this._cancelTask(),super.destroy()}static preload(){return Promise.all([(0,c.initSymbolListService)(),i.e(959).then(i.t.bind(i,50959,19)),Promise.all([i.e(962),i.e(6437)]).then(i.t.bind(i,500962,19)),Promise.all([i.e(223),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(8825),i.e(5761),i.e(4884),i.e(105),i.e(1140),i.e(8009),i.e(3795),i.e(8819),i.e(8484),i.e(2196),i.e(8529),i.e(537),i.e(1755),i.e(3704),i.e(1464),i.e(962),i.e(9255),i.e(37),i.e(1323),i.e(1990),i.e(8210),i.e(5416),i.e(4482),i.e(7392),i.e(7898),i.e(1196)]).then(i.bind(i,386942)),Promise.all([i.e(223),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(8825),i.e(5761),i.e(4884),i.e(105),i.e(1140),i.e(8009),i.e(3795),i.e(8819),i.e(8484),i.e(2196),i.e(8529),i.e(537),i.e(1755),i.e(3704),i.e(1464),i.e(962),i.e(9255),i.e(37),i.e(1323),i.e(1990),i.e(8210),i.e(5416),i.e(4482),i.e(7392),i.e(7898),i.e(1196)]).then(i.bind(i,921696)),Promise.all([i.e(223),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(8825),i.e(5761),i.e(4884),i.e(105),i.e(1140),i.e(8009),i.e(3795),i.e(8819),i.e(8484),i.e(2196),i.e(8529),i.e(537),i.e(1755),i.e(3704),i.e(1464),i.e(962),i.e(9255),i.e(37),i.e(1323),i.e(1990),i.e(8210),i.e(5416),i.e(4482),i.e(7392),i.e(7898),i.e(1196)]).then(i.bind(i,666617)),Promise.all([i.e(223),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(8825),i.e(5761),i.e(4884),i.e(105),i.e(1140),i.e(8009),i.e(3795),i.e(8819),i.e(8484),i.e(2196),i.e(8529),i.e(537),i.e(1755),i.e(3704),i.e(1464),i.e(962),i.e(9255),i.e(37),i.e(1323),i.e(1990),i.e(8210),i.e(5416),i.e(4482),i.e(7392),i.e(7898),i.e(1196)]).then(i.bind(i,490826)),void 0])}_initSymbolList(e){const t=window.widgetbar;if(!t)return;(0,s.ensureDefined)(t.layout).setMinimizedState(!1),t.setPage("base");const r=this._pendingOperationPromise=Promise.all([(0,c.initSymbolListService)(),Promise.all([i.e(223),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(8825),i.e(5761),i.e(4884),i.e(105),i.e(1140),i.e(8009),i.e(3795),i.e(8819),i.e(8484),i.e(2196),i.e(8529),i.e(537),i.e(1755),i.e(3704),i.e(1464),i.e(962),i.e(9255),i.e(37),i.e(1323),i.e(1990),i.e(8210),i.e(5416),i.e(4482),i.e(7392),i.e(7898),i.e(1196)]).then(i.bind(i,490826))]).then((([t,i])=>{if(this._pendingOperationPromise===r){this._pendingOperationPromise=null;const{runner:s}=t;if(this._task&&this._task.isRunning())e(t);else{const r=s.run(i.watchListSaga);e(t),r.cancel()}}}))}_cancelTask(){this._task&&(this._task.cancel(),this._task=null)}}}async function d(e){const t={Watchlist:h(e)
},[s,{WidgetBarNews:n},{ObjectTreeRenderer:o},{DataWindowWidget:a}]=await Promise.all([Promise.all([i.e(8707),i.e(6880),i.e(2468),i.e(962),i.e(9255),i.e(4876)]).then(i.bind(i,479796)),Promise.all([i.e(8707),i.e(6880),i.e(2468),i.e(962),i.e(9255),i.e(4876)]).then(i.bind(i,745274)),Promise.all([i.e(8707),i.e(6880),i.e(2468),i.e(962),i.e(9255),i.e(4876)]).then(i.bind(i,704095)),Promise.all([i.e(8707),i.e(6880),i.e(2468),i.e(962),i.e(9255),i.e(4876)]).then(i.bind(i,185976))]);return r.enabled("show_object_tree")&&(t.ObjectTreeWidget=o),t.NewsWidget=n,t.Detail=s,t.DataWindowWidget=a,t}},235354:(e,t,i)=>{"use strict";function s(){return{version:2,width:300,pages:[]}}i.d(t,{getDefaultState:()=>s})},404556:(e,t,i)=>{"use strict";i.d(t,{WidgetbarBootloader:()=>h});var s=i(870122),r=i.n(s),n=i(181370),o=i(484727),a=i(235354),l=i(939535),c=i(159537);class h extends n.ChunkLoader{constructor(e){super(),this._options=e;const t=o.enabled("hide_right_toolbar")?0:this._calcWidgetBarWidth();this._options.resizerBridge.negotiateWidth(t),this._options.resizerBridge.container.value().appendChild((0,l.createStubElem)())}async _startLoading(e){const{tradingPromise:t,resizerBridge:i,affectsLayout:s,showWizardFn:r,showCloseButton:n,areShortcutsAvailable:o,chartWidgetCollection:a,settingsPrefix:l,customization:h,readonly:d,configuration:u}=this._options,[p,_]=await Promise.all([this._loadWidgetBar(),t]),m=null!==_?{tradingPanel:_.tradingPanel,setDomPanelVisibility:_.setDomPanelVisibility.bind(_),setOrderPanelVisibility:_.setOrderPanelVisibility.bind(_)}:void 0;if(null==e?void 0:e.aborted)throw(0,c.createAbortError)();return new p({resizerBridge:i,affectsLayout:s,showCloseButton:n,showWizardFn:r,areShortcutsAvailable:o,chartWidgetCollection:a,settingsPrefix:l,customization:h,readonly:d,tradingPanelAccessor:m,configuration:u})}async _loadWidgetBar(){return(await Promise.all([i.e(8707),i.e(6880),i.e(2468),i.e(962),i.e(9255),i.e(4876)]).then(i.bind(i,696491))).WidgetBar}_calcWidgetBarWidth(){const e=r().getJSON(`${this._options.settingsPrefix}.layout-settings`,{settings:(0,a.getDefaultState)()});void 0===e.settings.minimized&&(e.settings.minimized=!o.enabled("show_right_widgets_panel_by_default"));const t=o.enabled("widgetbar_tabs")?46:0;return e.settings.minimized?t:t+e.settings.width+1}}},620793:(e,t,i)=>{"use strict";i.r(t),i.d(t,{lineToolEntityInfo:()=>o,studyEntityInfo:()=>a,seriesEntityInfo:()=>l,entityForDataSource:()=>c});var s=i(663890),r=i(546561),n=i(232468);function o(e){return{id:e.id(),name:(t=e.toolname,Object.keys(r.supportedLineTools).find((e=>r.supportedLineTools[e].name===t))||null)};var t}function a(e){return{id:e.id(),name:e.metaInfo().description}}function l(e){return{id:e.id(),name:"Main Series"}}function c(e,t){return t===e.mainSeries()?l(e.mainSeries()):(0,s.isStudy)(t)?a(t):(0,n.isLineTool)(t)?o(t):null}},897627:(e,t,i)=>{"use strict";i.r(t),i.d(t,{isLineToolRiskReward:()=>a,LineDataSourceApi:()=>c});var s=i(650151),r=i(486028)
;const n=new Map([["LineToolRiskRewardLong",2],["LineToolRiskRewardShort",2],["LineToolBezierQuadro",3],["LineToolBezierCubic",4]]);function o(e){const t=n.get(e.toolname);if(void 0!==t)return t;const i=e.pointsCount();return-1===i?e.points().length:i}function a(e){return"LineToolRiskRewardLong"===e||"LineToolRiskRewardShort"===e}const l=["alwaysShowStats","entryPrice","inputs.first bar time","inputs.last bar time","interval","linesWidths","points","snapTo45Degrees","stopPrice","symbol","symbolStateVersion","currencyId","unitId","targetPrice","zOrderVersion"];class c{constructor(e,t,i){this._source=e,this._undoModel=t,this._model=t.model(),this._pointsConverter=i}isSelectionEnabled(){return this._source.isSelectionEnabled()}setSelectionEnabled(e){this._source.setSelectionEnabled(e)}isSavingEnabled(){return this._source.isSavedInChart()}setSavingEnabled(e){this._source.setSavingInChartEnabled(e)}isShowInObjectsTreeEnabled(){return this._source.showInObjectTree()}setShowInObjectsTreeEnabled(e){this._source.setShowInObjectsTreeEnabled(e)}isUserEditEnabled(){return this._source.userEditEnabled()}setUserEditEnabled(e){this._source.setUserEditEnabled(e)}bringToFront(){this._model.bringToFront([this._source])}sendToBack(){this._model.sendToBack([this._source])}getProperties(){return this._source.properties().state(l,!0)}setProperties(e){this._setProps(this._source.properties(),e,"")}getPoints(){let e=this._source.points();const t=o(this._source);return e.length>t&&((0,s.assert)(a(this._source.toolname)),e=e.slice(0,t)),this._pointsConverter.dataSourcePointsToPriced(e)}setPoints(e){if(this._source.isFixed())return;const t=o(this._source);if(t!==e.length)throw new Error(`Wrong points count. Required: ${t}, provided: ${e.length}`);const i=this._pointsConverter.apiPointsToDataSource(e);this._model.startChangingLinetool(this._source),this._model.changeLinePoints(this._source,i),this._model.endChangingLinetool(!0),this._source.createServerPoints()}getAnchoredPosition(){return this._source.positionPercents()}setAnchoredPosition(e){const t=this._source.fixedPoint(),i=this._source.linkKey().value(),s=void 0===t?null:this._source.screenPointToPoint(t);if(!this._source.isFixed()||void 0===t||null===i||null===s)return;const r={logical:s,screen:t},n=new Map;n.set(i,e),this._model.startMovingSources([this._source],r,null,new Map),this._model.moveSources(r,n),this._model.endMovingSources(!0)}ownerSourceId(){return(0,s.ensureNotNull)(this._source.ownerSource()).id()}changePoint(e,t){if(this._source.isFixed())return;const i=this._pointsConverter.apiPointsToDataSource([e])[0];this._model.startChangingLinetool(this._source,{...i},t),this._model.changeLinePoint({...i}),this._model.endChangingLinetool(!1),this._source.createServerPoints()}isHidden(){return this._source.isSourceHidden()}getRawPoints(){return this._source.points()}setRawPoint(e,t){this._model.startChangingLinetool(this._source,{...t},e),this._model.changeLinePoint({...t}),this._model.endChangingLinetool(!1)}move(e,t){this._model.startMovingSources([this._source],{logical:e
},null,new Map),this._model.moveSources({logical:t},new Map),this._model.endMovingSources(!1)}dataAndViewsReady(){return this._source.dataAndViewsReady()}zorder(){return this._source.zorder()}symbol(){return this._source.properties().symbol.value()}currency(){return this._source.properties().currencyId.value()}unit(){return this._source.properties().unitId.value()}share(e){this._undoModel.shareLineTools([this._source],e)}sharingMode(){return this._source.sharingMode().value()}_setProps(e,t,i){for(const s in t){if(!t.hasOwnProperty(s))continue;const n=0===i.length?s:`${i}.${s}`;if(e.hasOwnProperty(s)){const i=t[s];(0,r.isHashObject)(i)?this._setProps(e[s],i,n):e[s].setValue(i)}else console.warn(`Unknown property "${n}"`)}}}},971111:(e,t,i)=>{"use strict";i.d(t,{PaneApi:()=>u});var s=i(650151),r=i(953273),n=i(620793),o=i(486028),a=i(509806),l=i(440097),c=i(144070);const h=new l.TranslatedString("change pane height",a.t(null,void 0,i(187510)));class d extends c.UndoCommand{constructor(e,t,i){super(h),this._model=e,this._paneIndex=t,this._paneHeight=i,this._prevStretchFactors=this._model.panes().map((e=>e.stretchFactor()))}redo(){this._model.changePanesHeight(this._paneIndex,this._paneHeight)}undo(){const e=this._model.panes();for(let t=0;t<e.length;++t)e[t].setStretchFactor((0,s.ensureDefined)(this._prevStretchFactors[t]));this._model.fullUpdate()}}class u{constructor(e,t){this._priceScales=new WeakMap,this._pane=e,this._chartWidget=t}hasMainSeries(){return this._pane.containsMainSeries()}getLeftPriceScales(){return this._pane.leftPriceScales().map(this._getPriceScaleApi,this)}getRightPriceScales(){return this._pane.rightPriceScales().map(this._getPriceScaleApi,this)}getMainSourcePriceScale(){const e=this._pane.mainDataSource();if(null===e)return null;const t=e.priceScale();return null===t||this._pane.isOverlay(e)?null:this._getPriceScaleApi(t)}setMaximized(e){if(this._pane.maximized().value()!==e)for(const e of this._chartWidget.paneWidgets())if(e.state()===this._pane){this._chartWidget.toggleMaximizePane(e);break}}legendLoaded(){const e=this._chartWidget.paneByState(this._pane);return Boolean(e&&e.statusWidget())}getAllEntities(){const e=this._pane.model();return this._pane.sourcesByGroup().allIncludingHidden().map((t=>(0,n.entityForDataSource)(e,t))).filter(o.notNull).filter((e=>null!==e.name))}getHeight(){return this._pane.height()}setHeight(e){const t=this._chartWidget.model().model(),i=t.panes();(0,s.assert)(i.length>1,"Unable to change pane's height if there is only one pane");const r=i.indexOf(this._pane);(0,s.assert)(-1!==r,"Invalid pane index");const n=new d(t,r,e);this._chartWidget.model().undoHistory().pushUndoCommand(n)}moveTo(e){const t=this.paneIndex();t!==e&&((0,s.assert)(e>=0&&e<this._chartWidget.paneWidgets().length,"Invalid pane index"),this._chartWidget.model().movePane(t,e))}paneIndex(){return this._chartWidget.model().model().panes().indexOf(this._pane)}collapse(){if(1===this._chartWidget.paneWidgets().length)throw new Error("Cannot collapse a single pane!")
;const e=this._chartWidget.paneByState(this._pane);if(null===e||this._pane.collapsed().value())throw new Error("Cannot collapse current pane!");this._chartWidget.toggleCollapsedPane(e)}restore(){if(1===this._chartWidget.paneWidgets().length)throw new Error("Cannot restore a single pane!");const e=this._chartWidget.paneByState(this._pane);if(null===e||!this._pane.collapsed().value())throw new Error("Cannot restore current pane!");this._chartWidget.toggleCollapsedPane(e)}_getPriceScaleApi(e){let t=this._priceScales.get(e);return void 0===t&&(t=new r.PriceScaleApi(this._chartWidget.model(),e),this._priceScales.set(e,t)),t}}},953273:(e,t,i)=>{"use strict";i.d(t,{PriceScaleApi:()=>s});class s{constructor(e,t){this._chartUndoModel=e,this._chartModel=e.model(),this._priceScale=t}getMode(){const e=this._priceScale.properties().childs();return e.percentage.value()?2:e.indexedTo100.value()?3:e.log.value()?1:0}setMode(e){this._priceScale.setMode({percentage:2===e,log:1===e,indexedTo100:3===e})}isInverted(){return this._priceScale.isInverted()}setInverted(e){this._priceScale.properties().childs().isInverted.setValue(e)}isLocked(){return this._priceScale.isLockScale()}setLocked(e){this._priceScale.setMode({lockScale:e})}isAutoScale(){return this._priceScale.isAutoScale()}setAutoScale(e){this._priceScale.setMode({autoScale:e})}getVisiblePriceRange(){return this._priceScale.priceRangeInPrice()}setVisiblePriceRange(e){this._priceScale.setPriceRangeInPrice(e),this._chartModel.lightUpdate()}hasMainSeries(){return this._priceScale.hasMainSeries()}getStudies(){return this._priceScale.getStudies().map((e=>e.id()))}currency(){const e=this._priceScale.currency(this._chartModel.availableCurrencies());return null===e?null:{selectedCurrency:e.selectedCurrency,readOnly:e.readOnly}}setCurrency(e){this._chartUndoModel.setPriceScaleCurrency(this._priceScale,e)}unit(){const e=this._priceScale.unit(this._chartModel.availableUnits());return null===e?null:{selectedUnit:e.selectedUnit,readOnly:0===e.availableGroups.size,availableGroups:Array.from(e.availableGroups)}}setUnit(e){this._chartUndoModel.setPriceScaleUnit(this._priceScale,e)}measureUnitId(){const e=this._priceScale.measureUnitId(this._chartModel.availableUnits());return null===e?null:{selectedMeasureUnitId:e.selectedMeasureUnitId}}}},989348:(e,t,i)=>{"use strict";function s(e,t){const i=e.dataSourceForId(t);if(null===i)throw new Error(`Chart has no study or shape with id "${t}"`);return i}i.d(t,{SelectionApi:()=>r});class r{constructor(e){this._model=e}add(e){Array.isArray(e)?this._model.selectionMacro((t=>{e.map(s.bind(null,this._model)).forEach((e=>t.addSourceToSelection(e)))})):this.add([e])}canBeAddedToSelection(e){const t=s(this._model,e);return this._model.selection().canBeAddedToSelection(t)}set(e){Array.isArray(e)?this._model.selectionMacro((t=>{t.clearSelection(),e.map(s.bind(null,this._model)).forEach((e=>t.addSourceToSelection(e)))})):this.set([e])}remove(e){Array.isArray(e)?this._model.selectionMacro((t=>{
e.map(s.bind(null,this._model)).forEach((e=>t.removeSourceFromSelection(e)))})):this.remove([e])}contains(e){const t=s(this._model,e);return this._model.selection().isSelected(t)}allSources(){return this._model.selection().dataSources().map((e=>e.id()))}isEmpty(){return this._model.selection().isEmpty()}clear(){this._model.selectionMacro((e=>{e.clearSelection()}))}onChanged(){return this._model.onSelectedSourceChanged()}}},365622:(e,t,i)=>{"use strict";i.d(t,{SeriesApi:()=>l});var s=i(650151),r=i(214474),n=i(677698),o=i(705145),a=i(953273);class l{constructor(e,t){this._series=e,this._undoModel=t,this._model=t.model()}isUserEditEnabled(){return this._series.userEditEnabled()}setUserEditEnabled(e){this._series.setUserEditEnabled(e)}mergeUp(){this._model.isMergeUpAvailableForSource(this._series)&&new r.MergeUpUndoCommand(this._model,this._series,null).redo()}mergeDown(){this._model.isMergeDownAvailableForSource(this._series)&&new r.MergeDownUndoCommand(this._model,this._series,null).redo()}unmergeUp(){this._model.isUnmergeAvailableForSource(this._series)&&new n.UnmergeUpUndoCommand(this._model,this._series,null).redo()}unmergeDown(){this._model.isUnmergeAvailableForSource(this._series)&&new n.UnmergeDownUndoCommand(this._model,this._series,null).redo()}detachToRight(){new o.MoveToNewPriceScaleUndoCommand(this._model,this._series,this._pane(),"right",null).redo()}detachToLeft(){new o.MoveToNewPriceScaleUndoCommand(this._model,this._series,this._pane(),"left",null).redo()}detachNoScale(){new o.MoveToNewPriceScaleUndoCommand(this._model,this._series,this._pane(),"overlay",null).redo()}changePriceScale(e){const t=(0,s.ensureNotNull)(this._model.paneForSource(this._series));switch(e){case"new-left":new o.MoveToNewPriceScaleUndoCommand(this._model,this._series,t,"left",null).redo();break;case"new-right":new o.MoveToNewPriceScaleUndoCommand(this._model,this._series,t,"right",null).redo();break;case"no-scale":(0,s.assert)(t.actionNoScaleIsEnabled(this._series),"Unable to leave a pane without any non-overlay price scale"),new o.MoveToNewPriceScaleUndoCommand(this._model,this._series,t,"overlay",null).redo();break;default:const i=this._model.dataSourceForId(e);if(null===i)throw new Error(`There is no study with entityId='${e}'`);const r=this._model.paneForSource(i)===t;(0,s.assert)(r,"Study should be on the main pane");const n=(0,s.ensureNotNull)(i.priceScale());new o.MoveToExistingPriceScaleUndoCommand(this._model,this._series,t,n,null).redo()}}isVisible(){return this._series.properties().childs().visible.value()}setVisible(e){this._series.properties().childs().visible.setValue(e)}bringToFront(){this._model.bringToFront([this._series])}sendToBack(){this._model.sendToBack([this._series])}entityId(){return this._series.id()}chartStyleProperties(e){return this._series.properties().childs()[c(e)].state(["inputs","inputsInfo"])}setChartStyleProperties(e,t){this._series.properties().childs()[c(e)].mergeAndFire(t)}barsCount(){return this._series.bars().size()}symbolSource(){return{symbol:this._series.symbol(),
currencyId:this._series.currency(),unitId:this._series.unit()}}isLoading(){return this._series.isLoading()}data(){return this._series.data()}priceScale(){return new a.PriceScaleApi(this._undoModel,this._series.priceScale())}_pane(){return(0,s.ensureNotNull)(this._model.paneForSource(this._series))}}function c(e){switch(e){case 0:return"barStyle";case 1:return"candleStyle";case 2:return"lineStyle";case 3:return"areaStyle";case 4:return"renkoStyle";case 5:return"kagiStyle";case 6:return"pnfStyle";case 7:return"pbStyle";case 8:return"haStyle";case 9:return"hollowCandleStyle";case 10:return"baselineStyle";case 11:return"rangeStyle";case 12:return"hiloStyle";case 13:return"columnStyle";default:(0,s.ensureNever)(e)}throw new Error(`unsupported chart style: ${e}`)}},535725:(e,t,i)=>{"use strict";i.d(t,{StudyApi:()=>y});var s=i(650151),r=i(922157),n=i.n(r),o=i(486028),a=i(103526),l=i(431491),c=i(658358),h=i(677698),d=i(214474),u=i(705145),p=i(412905),_=i(478265),m=i(437334),g=i(953273),f=i(981820),v=i(849102),S=i(657376);class y{constructor(e,t){this._onStudyCompleted=new(n()),this._onStudyError=new(n()),this._study=e,this._chartWidget=t,this._undoModel=this._chartWidget.model(),this._model=this._undoModel.model(),this._study.onAboutToBeDestroyed().subscribe(this,(()=>{this._study.onStatusChanged().unsubscribeAll(this),this._study.onAboutToBeDestroyed().unsubscribeAll(this)})),this._study.onStatusChanged().subscribe(this,(e=>{switch(e.type){case f.StudyStatusType.Completed:this._onStudyCompleted.fire();break;case f.StudyStatusType.Error:this._onStudyError.fire()}}))}isUserEditEnabled(){return this._study.userEditEnabled()}setUserEditEnabled(e){this._study.setUserEditEnabled(e)}getInputsInfo(){return(0,v.getStudyInputsInfo)(this._study.metaInfo())}getInputValues(){const e=this._study.inputs({symbolsForChartApi:!1,asObject:!0});return Object.keys(e).map((t=>{const i=e[t];return{id:t,value:(0,o.isObject)(i)?i.v:i}}))}getStyleInfo(){return(0,S.getStudyStylesInfo)(this._study.metaInfo())}getStyleValues(){const{plots:e,styles:t,bands:i,filledAreas:s,palettes:r,graphics:n,ohlcPlots:o,filledAreasStyle:a}=this._study.properties().state();return{plots:e,styles:t,bands:i,filledAreas:s,palettes:r,graphics:n,ohlcPlots:o,filledAreasStyle:a}}setInputValues(e){const t=this.getInputValues();for(const i of e){void 0!==t.find((e=>e.id===i.id))?this._study.properties().childs().inputs.childs()[i.id].setValue(i.value):console.warn(`There is no such input: "${i.id}"`)}}mergeUp(){this._model.isMergeUpAvailableForSource(this._study)&&new d.MergeUpUndoCommand(this._model,this._study,null).redo()}mergeDown(){this._model.isMergeDownAvailableForSource(this._study)&&new d.MergeDownUndoCommand(this._model,this._study,null).redo()}unmergeUp(){this._model.isUnmergeAvailableForSource(this._study)&&new h.UnmergeUpUndoCommand(this._model,this._study,null).redo()}unmergeDown(){this._model.isUnmergeAvailableForSource(this._study)&&new h.UnmergeDownUndoCommand(this._model,this._study,null).redo()}onDataLoaded(){return this._onStudyCompleted}onStudyError(){
return this._onStudyError}mergeUpWithUndo(){this._model.isMergeUpAvailableForSource(this._study)&&this._undoModel.mergeSourceUp(this._study)}mergeDownWithUndo(){this._model.isMergeDownAvailableForSource(this._study)&&this._undoModel.mergeSourceDown(this._study)}unmergeUpWithUndo(){this._model.isUnmergeAvailableForSource(this._study)&&this._undoModel.unmergeSourceUp(this._study)}unmergeDownWithUndo(){this._model.isUnmergeAvailableForSource(this._study)&&this._undoModel.unmergeSourceDown(this._study)}priceScale(){return new g.PriceScaleApi(this._undoModel,(0,s.ensureNotNull)(this._study.priceScale()))}symbolSource(){const e=(0,s.ensureNotNull)(this._study.symbolSource());return{symbol:e.symbol(),currencyId:e.currency(),unitId:e.unit()}}currency(){return this._study.currency()}changePriceScale(e){const t=(0,s.ensureNotNull)(this._model.paneForSource(this._model.mainSeries())),i=(0,s.ensureNotNull)(this._model.paneForSource(this._study));switch(e){case"no-scale":(0,s.assert)(i.actionNoScaleIsEnabled(this._study),"Unable to leave a pane without any non-overlay price scale"),new u.MoveToNewPriceScaleUndoCommand(this._model,this._study,i,"overlay",null).redo();break;case"as-series":(0,s.assert)(i===t,"Study should be on the main pane"),new u.MoveToExistingPriceScaleUndoCommand(this._model,this._study,i,this._model.mainSeries().priceScale(),null).redo();break;case"new-left":new u.MoveToNewPriceScaleUndoCommand(this._model,this._study,i,"left",null).redo();break;case"new-right":new u.MoveToNewPriceScaleUndoCommand(this._model,this._study,i,"right",null).redo();break;default:const r=this._model.dataSourceForId(e);if(null===r)throw new Error(`There is no study with entityId='${e}'`);const n=i===this._model.paneForSource(r);(0,s.assert)(n,"Both studies should be on the same pane");const o=(0,s.ensureNotNull)(r.priceScale()),a=(0,c.sourceNewCurrencyOnPinningToPriceScale)(this._study,o,this._model),h=(0,_.sourceNewUnitOnPinningToPriceScale)(this._study,o,this._model);new u.MoveToExistingPriceScaleUndoCommand(this._model,this._study,i,o,null).redo(),null!==a&&new l.SetPriceScaleCurrencyUndoCommand(o,a,this._undoModel.chartWidget(),null).redo(),null!==h&&new m.SetPriceScaleUnitUndoCommand(o,h,this._undoModel.chartWidget(),null).redo()}}isVisible(){return this._study.properties().childs().visible.value()}setVisible(e){this._study.properties().childs().visible.setValue(e)}bringToFront(){this._model.bringToFront([this._study])}sendToBack(){this._model.sendToBack([this._study])}applyOverrides(e){(0,a.applyOverridesToStudy)(this._study,e)}dataLength(){return this._study.status().type!==f.StudyStatusType.Completed?0:this._study.metaInfo().plots.length>0?this._study.data().size():this._model.mainSeries().bars().size()}isLoading(){return this._study.isLoading()}properties(){return this._study.properties()}async applyToEntireLayout(){const e=new p.ActionsProvider(this._chartWidget),t=(await e.contextMenuActionsForSources([this._study])).find((e=>"applyStudyToEntireLayout"===e.id));t&&t.execute()}symbolsResolved(){
return this._study.symbolsResolved()}}},849102:(e,t,i)=>{"use strict";i.d(t,{getStudyInputsInfo:()=>r});var s=i(509806);function r(e){return void 0===e.inputs?[]:e.inputs.map((e=>({...e,id:e.id,localizedName:void 0!==e.name?s.t(e.name,{context:"input"},i(788601)):""})))}},657376:(e,t,i)=>{"use strict";i.d(t,{getStudyStylesInfo:()=>r});var s=i(822914);function r(e){const t={};if(e.defaults){const i=(0,s.default)(e.defaults);t.defaults=i}return void 0!==e.plots&&(t.plots=(0,s.default)(e.plots)),void 0!==e.styles&&(t.styles=(0,s.default)(e.styles)),void 0!==e.bands&&(t.bands=(0,s.default)(e.bands)),void 0!==e.filledAreas&&(t.filledAreas=(0,s.default)(e.filledAreas)),void 0!==e.palettes&&(t.palettes=(0,s.default)(e.palettes)),t}},181370:(e,t,i)=>{"use strict";i.d(t,{ChunkLoader:()=>r});var s=i(159537);class r{constructor(){this._retries=5,this._cache=null,this._tryLoad=(e,t)=>{this._retries=this._retries-1;this._startLoading(e).then(t,0!==this._retries?i=>{(0,s.isAbortError)(i)||setTimeout((()=>this._tryLoad(e,t)),3e3)}:void 0)}}load(e){return this._cache||(this._cache=new Promise(this._tryLoad.bind(this,null!=e?e:null))),this._cache}}},37246:(e,t,i)=>{"use strict";i.d(t,{writeImpl:()=>r,writePromiseUsingApi:()=>o});var s=i(976052);function r(e,t){const i=e.files&&e.files.length>0;if(!i&&t&&t.eventPhase>0)return n(t,e),Promise.resolve();if(!i){let t=!1;const i=i=>{i.stopImmediatePropagation(),n(i,e),t=!0};try{document.addEventListener("copy",i,!0),document.execCommand("copy")}finally{document.removeEventListener("copy",i,!0)}if(t)return Promise.resolve()}return async function(e){const t=(0,s.getClipboard)();if(!t||!t.write||!window.ClipboardItem)throw new DOMException("ClipboardApi is not supported","NotSupportedError");const i={};for(const t of e.files||[])i[t.type]=t;e.text&&(i["text/plain"]=e.text);e.html&&(i["text/html"]=e.html);return t.write([new window.ClipboardItem(i)])}(e)}function n(e,t){e.preventDefault();const i=e.clipboardData;t.text&&i.setData("text/plain",t.text),t.html&&i.setData("text/html",t.html)}async function o(e,t){const i=(0,s.getClipboard)();if("text/plain"===t&&!i.write){const t=await e;return i.writeText(await t.text())}if(!i||!i.write||!window.ClipboardItem)throw new DOMException("ClipboardApi is not supported","NotSupportedError");let r=null;try{r=new window.ClipboardItem({[t]:e})}catch(i){r=new window.ClipboardItem({[t]:await e})}if(r)return i.write([r]);throw new Error("ClipboardApi is not supported")}},84776:(e,t,i)=>{"use strict";function s(e){if(void 0===e)return null;const t=e.match(/(delayed_streaming)_([\d]{1,4})/);return null===t?null:{mode:t[1],interval:parseInt(t[2])}}function r(e){const t=s(e.update_mode);return null===t||(e.update_mode=t.mode,e.update_mode_seconds=t.interval),e}i.r(t),i.d(t,{parseUpdateMode:()=>s,normalizeUpdateMode:()=>r})},125191:(e,t,i)=>{"use strict";var s,r;i.r(t),i.d(t,{WeekDays:()=>s,Months:()=>r}),function(e){e[e.SUNDAY=1]="SUNDAY",e[e.MONDAY=2]="MONDAY",e[e.TUESDAY=3]="TUESDAY",e[e.WEDNESDAY=4]="WEDNESDAY",e[e.THURSDAY=5]="THURSDAY",
e[e.FRIDAY=6]="FRIDAY",e[e.SATURDAY=7]="SATURDAY"}(s||(s={})),function(e){e[e.JANUARY=0]="JANUARY",e[e.FEBRUARY=1]="FEBRUARY",e[e.MARCH=2]="MARCH",e[e.APRIL=3]="APRIL",e[e.MAY=4]="MAY",e[e.JUNE=5]="JUNE",e[e.JULY=6]="JULY",e[e.AUGUST=7]="AUGUST",e[e.SEPTEMBER=8]="SEPTEMBER",e[e.OCTOBER=9]="OCTOBER",e[e.NOVEMBER=10]="NOVEMBER",e[e.DECEMBER=11]="DECEMBER"}(r||(r={}))},147668:(e,t,i)=>{"use strict";function s(e=location.host){return-1!==["i18n.tradingview.com","partial.tradingview.com","www.tradingview.com","wwwcn.tradingview.com"].indexOf(e)||-1!==["d33t3vvu2t2yu5.cloudfront.net","dwq4do82y8xi7.cloudfront.net","s.tradingview.com","s3.tradingview.com"].indexOf(e)||e.match(/^[a-z]{2}\.tradingview\.com/)||e.match(/prod-[^.]+.tradingview.com/)?"battle":e.includes("tradingview.com")||e.includes("staging")?"staging":e.match(/webcharts/)?"staging_local":(e.match(/^localhost(:\d+)?$/),"local")}function r(){return"local"===s()}function n(){return"battle"===s()}function o(){return!n()}i.r(t),i.d(t,{environment:()=>s,isLocal:()=>r,isProd:()=>n,isDebug:()=>o})},796966:(e,t,i)=>{"use strict";i.d(t,{preventDefault:()=>r,wrapHandlerWithPreventEvent:()=>n,preventScrollByWheelClick:()=>o});var s=i(601227);function r(e){e.cancelable&&e.preventDefault()}function n(e){return t=>{r(t),e()}}function o(e){s.isChrome&&e.addEventListener("mousedown",(e=>{if(1===e.button)return e.preventDefault(),!1}))}},708123:(e,t,i)=>{"use strict";i.d(t,{FeatureToggleWatchedValue:()=>n});var s=i(210596),r=i.n(s);class n extends(r()){constructor(e,t){super(function(e,t){return t}(0,t))}destroy(){0}}},976052:(e,t,i)=>{"use strict";function s(){return navigator.clipboard}i.d(t,{getClipboard:()=>s})},34301:(e,t,i)=>{"use strict";function s(e){if(e instanceof Error)return e.stack||e.message;try{return e.outerHTML.slice(0,1024)}catch(e){}try{if(void 0!==e)return JSON.stringify(e).slice(0,1024)}catch(e){}return String(e)}function r(){window.__tv_js_errors||(window.__tv_js_errors=[]),window.addEventListener("error",(e=>{const t=(new Date).toISOString();window.__tv_js_errors.push(`${t} ${e.message||"JS error"}. ${e.filename||"<unknown url>"}, line ${e.lineno}, col ${e.colno}.\nError: ${s(e.error)}`)}),!1),window.addEventListener("unhandledrejection",(e=>{const t=(new Date).toISOString();window.__tv_js_errors.push(`${t} Unhandled rejection.\nReason: ${s(e.reason)}`)}),!1),document.addEventListener("securitypolicyviolation",(e=>{if(String(e.sourceFile).startsWith("https://securepubads.g.doubleclick.net")&&String(e.blockedURI).startsWith("https://adservice.google."))return;const t=(new Date).toISOString(),i="report"===e.disposition?"CSP report-only":"CSP violation";window.__tv_js_errors.push(`${t} ${i}: ${e.violatedDirective||e.effectiveDirective}. ${e.sourceFile||"<unknown url>"}, line ${e.lineNumber}, col ${e.columnNumber}.\nBlocked URI: ${e.blockedURI}\nSample: ${e.sample}\nTarget: ${s(e.target)}`)}),!1)}i.d(t,{install:()=>r})},559410:(e,t,i)=>{"use strict";i.r(t),i.d(t,{unsubscribe:()=>l,on:()=>c,subscribe:()=>h,subscribeToAll:()=>d,emit:()=>u,emitOnce:()=>p})
;var s=i(922157),r=i.n(s);const n={},o=[],a={};function l(e,t,i){n[e].unsubscribe(i,t)}function c(e,t,i){h(e,t,i)}function h(e,t,i,s){n.hasOwnProperty(e)||(n[e]=new(r())),a[e]?t.call(i):n[e].subscribe(i,t,s)}function d(e){o.push(e)}function u(e,...t){const i=[e].concat(t);o.forEach((e=>{e.apply(null,i)})),n.hasOwnProperty(e)&&n[e].fire.apply(n[e],t)}function p(e){a[e]&&console.warn(`Something went wrong: emitOnce called multiple times with same event (${e})`),a[e]=!0,u.apply(null,arguments)}},411589:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Modifiers:()=>s.Modifiers,createGroup:()=>h,pressedKeys:()=>c,registerWindow:()=>d,unregisterWindow:()=>u});var s=i(930202),r=i(954343),n=i(91679);class o{constructor(e,t){this._group=e,this.hotkey=t.hotkey,this.handler=t.handler,this.desc=t.desc,this.element=t.element||null,t.isDisabled?"function"==typeof t.isDisabled?this.isDisabled=t.isDisabled:this.isDisabled=()=>!0:this.isDisabled=()=>!1}destroy(){this._group&&(this._group.remove(this),this._group=null)}}class a{constructor(e,t){this._actions=[],this._manager=e,this.modal=!(!t||!t.modal),t&&(this.desc=t.desc),t&&t.isDisabled?"function"==typeof t.isDisabled?this.isDisabled=t.isDisabled:this.isDisabled=()=>!0:this.isDisabled=()=>!1,this._manager.registerGroup(this)}add(e){const t=new o(this,e);return this._actions.push(t),t}remove(e){for(let t=this._actions.length;t-- >0;)this._actions[t]===e&&this._actions.splice(t,1)}handleHotkey(e,t){for(let i=this._actions.length;i-- >0;){const s=this._actions[i];if(s.hotkey===e&&((!s.element||t.target&&s.element.contains(t.target))&&!s.isDisabled()))return s.handler(t),t.preventDefault(),this._callMatchedHotkeyHandler(e),!0}return!1}promote(){this._manager.promoteGroup(this)}destroy(){this._actions.length=0,this._manager.unregisterGroup(this)}static setMatchedHotkeyHandler(e){a._matchedHotkeyHandler=e}_callMatchedHotkeyHandler(e){a._matchedHotkeyHandler&&a._matchedHotkeyHandler(e)}}const l=new class{constructor(){this._groups=[],this._pressedKeys=new n.WatchedValue(0),this._keyDownListener=e=>{if(e.defaultPrevented)return;const t=(0,s.hashFromEvent)(e);if(this._pressedKeys.setValue(t),!(0,r.isNativeUIInteraction)(t,e.target))for(let i=this._groups.length;i-- >0;){const s=this._groups[i];if(!s.isDisabled()){if(s.handleHotkey(t,e))return;if(s.modal)return}}},this._keyUpListener=e=>{const t=(0,s.hashFromEvent)(e);this._pressedKeys.setValue(t)},this._blurEvent=()=>{this._pressedKeys.setValue(0)},this._mouseEvent=e=>{var t;const i=(0,s.modifiersFromEvent)(e),r=255&(null!==(t=this._pressedKeys.value())&&void 0!==t?t:0);this._pressedKeys.setValue(i|r)}}listen(e){e.addEventListener("keydown",this._keyDownListener),e.addEventListener("keyup",this._keyUpListener),e.addEventListener("blur",this._blurEvent),e.addEventListener("mousemove",this._mouseEvent)}unlisten(e){e.removeEventListener("keydown",this._keyDownListener),e.removeEventListener("keyup",this._keyUpListener),e.removeEventListener("blur",this._blurEvent),e.removeEventListener("mousemove",this._mouseEvent)}registerGroup(e){this._groups.push(e)}
unregisterGroup(e){for(let t=this._groups.length;t--;)this._groups[t]===e&&this._groups.splice(t,1)}promoteGroup(e){let t=this._groups.length-1;for(let i=this._groups.length;i--;){if(this._groups[i]===e)return void(i!==t&&(this._groups.splice(i,1),this._groups.splice(t,0,e)));this._groups[i].modal&&(t=i-1)}}pressedKeys(){return this._pressedKeys}},c=l.pressedKeys().readonly();function h(e){return new a(l,e)}function d(e){l.listen(e)}function u(e){l.unlisten(e)}var p=i(32133);d(window),a.setMatchedHotkeyHandler((e=>{(0,p.trackEvent)("Keyboard Shortcuts",(0,s.humanReadableHash)(e))}))},180185:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Modifiers:()=>s.Modifiers,hashFromEvent:()=>s.hashFromEvent,hashShiftPlusEnter:()=>s.hashShiftPlusEnter,humanReadableHash:()=>s.humanReadableHash,humanReadableModifiers:()=>s.humanReadableModifiers,isMacKeyboard:()=>s.isMacKeyboard,modifiersFromEvent:()=>s.modifiersFromEvent});var s=i(930202)},284214:(e,t,i)=>{"use strict";i.d(t,{migrateShortcut:()=>o});var s=i(930202);function r(e){if("number"==typeof e)return e;switch(e.toLowerCase()){case"ctrl":return s.Modifiers.Control;case"shift":return s.Modifiers.Shift;case"alt":return s.Modifiers.Alt;default:return e.toUpperCase().charCodeAt(0)}}function n(e){let t=0;for(let i=0;i<e.length;i++)t|=r(e[i]);return t}function o(e){return"number"==typeof e?e:"string"==typeof e?n(e.split("+")):Array.isArray(e)?n(e):0}},698043:(e,t,i)=>{"use strict";i.d(t,{isNativeUIInteraction:()=>s.isNativeUIInteraction,isTextEditingField:()=>s.isTextEditingField});var s=i(954343)},688401:(e,t,i)=>{"use strict";i.d(t,{linking:()=>u});var s=i(304889),r=i(210596),n=i.n(r),o=i(484727),a=i(632054),l=i(817808),c=i(782505);const h=(0,l.getLogger)("Linking");var d;!function(e){e[e.NotBound=0]="NotBound",e[e.BoundToWidget=1]="BoundToWidget",e[e.BoundToModel=2]="BoundToModel"}(d||(d={}));const u=new class{constructor(){this._watchedSymbol=new(n()),this._seriesShortSymbol=new(n()),this._proSymbol=new(n()),this._watchedInterval=new(n()),this._watchedIntraday=new(n()),this._watchedSeconds=new(n()),this._watchedTicks=new(n()),this._watchedDataFrequencyResolution=new(n()),this._watchedRange=new(n()),this._watchedSupportedResolutions=new(n()),this._watchedSupportedChartStyles=new(n())([]),this._symbolNamesList=new(n()),this._chartWidgetBindingState=d.NotBound,this._activeChartWidget=null,this._watchedSymbolListenerBound=this._watchedSymbolListener.bind(this),this._watchedIntervalListenerBound=this._watchedIntervalListener.bind(this),this._onSymbolLinkBound=this._onSymbolLink.bind(this),this._searchCharts=null,this._searchChartsLoadDebounced=null,this._selfEmit=!1,this._preventFeedBySymbol=!1,this._feedBySymbolDebounceCounter=0}get symbol(){return this._watchedSymbol}get proSymbol(){return this._proSymbol}get symbolNamesList(){return this._symbolNamesList}get seriesShortSymbol(){return this._seriesShortSymbol.readonly()}get interval(){return this._watchedInterval}get intraday(){return this._watchedIntraday.readonly()}get seconds(){return this._watchedSeconds.readonly()}get ticks(){
return this._watchedTicks.readonly()}get range(){return this._watchedRange.readonly()}get supportedResolutions(){return this._watchedSupportedResolutions.readonly()}get supportedChartStyles(){return this._watchedSupportedChartStyles.readonly()}get preventFeedBySymbol(){return this._preventFeedBySymbol}get dataFrequencyResolution(){return this._watchedDataFrequencyResolution.readonly()}bindToChartWidget(e){if(this.unbindFromChartWidget(),this._activeChartWidget=e,e.hasModel())return void this._onChartModelCreated(e.model());e.modelCreated().subscribe(this,this._onChartModelCreated),this._chartWidgetBindingState=d.BoundToWidget;const t=e.properties().childs().mainSeriesProperties.childs();this._watchedSymbol.setValue(t.symbol.value()),this._watchedInterval.setValue(t.interval.value())}unbindFromChartWidget(){switch(this._chartWidgetBindingState){case d.BoundToWidget:if(!this._activeChartWidget)throw new Error("ChartWidget is undefined");this._activeChartWidget.modelCreated().unsubscribe(this,this._onChartModelCreated);break;case d.BoundToModel:this._symbolProperty().unsubscribe(this,this._onSymbolPropertyChange),this._watchedSymbol.unsubscribe(this._watchedSymbolListenerBound),this._mainSeries().dataEvents().symbolResolved().unsubscribe(this,this._updateSeriesSymbolInfo),this._mainSeries().dataEvents().symbolError().unsubscribe(this,this._updateSeriesSymbolInfo),this._intervalProperty().unsubscribe(this,this._onIntervalPropertyChange),this._watchedInterval.unsubscribe(this._watchedIntervalListenerBound),delete this._watchedSymbol.hook,delete this._watchedSymbol.writeLock}this._activeChartWidget=null,this._chartWidgetBindingState=d.NotBound}getChartWidget(){return this._activeChartWidget}bindToChartWidgetCollection(e){this._chartWidgetCollection=e,this.unbindFromChartWidget(),e.activeChartWidget.subscribe((e=>{this.unbindFromChartWidget(),this.bindToChartWidget(e)}),{callWithLast:!0})}bindToSearchCharts(e){this.unbindFromSearchCharts(),this._searchCharts=e,e.onSearchBySymbol.subscribe(this,this._onSearchBySymbol),e.loadingSymbol.subscribe((e=>{!1===e&&(this._feedBySymbolDebounceCounter=0)})),this._watchedSymbol.subscribe(this._onSymbolLinkBound)}unbindFromSearchCharts(){this._searchCharts&&(this._searchCharts.onSearchBySymbol.unsubscribe(this,this._onSearchBySymbol),this._watchedSymbol.unsubscribe(this._onSymbolLinkBound),this._searchCharts=null)}setPreventFeedBySymbol(e){this._preventFeedBySymbol=e}_onSearchBySymbol(e){if(!e.resolved_symbol)throw new Error("no resolved_symbol");this._selfEmit=!0,this._watchedSymbol.setValue(e.resolved_symbol),this._selfEmit=!1}_onSymbolLink(e){if(!this._selfEmit){if(!this._searchCharts){const e="No search charts defined";throw h.logError(e),new Error(e)}this._preventFeedBySymbol||this._loadSearchCharts(e)}}_loadSearchCharts(e){if(!this._searchCharts){const e="No search charts defined";throw h.logError(e),new Error(e)}if(this._searchChartsLoadDebounced)return void(this._feedBySymbolDebounceCounter<100&&(this._feedBySymbolDebounceCounter++,this._searchChartsLoadDebounced(e)))
;const t=e=>this._searchCharts?(!0===this._searchCharts.loadingSymbol.value()?this._feedBySymbolDebounceCounter<100&&(this._feedBySymbolDebounceCounter++,this._searchChartsLoadDebounced=(0,s.default)(t,2e3),this._searchChartsLoadDebounced(e)):this._searchChartsLoadDebounced=null,this._searchCharts.feedBySymbol.call(this._searchCharts,e)):()=>{};!0===this._searchCharts.loadingSymbol.value()?this._feedBySymbolDebounceCounter<100&&(this._feedBySymbolDebounceCounter++,this._searchChartsLoadDebounced=(0,s.default)(t,2e3),this._searchChartsLoadDebounced(e)):this._searchCharts.feedBySymbol(e)}_mainSeries(){if(!this._activeChartWidget)throw new Error("ChartWidget is undefined");return this._activeChartWidget.model().mainSeries()}_properties(){return this._mainSeries().properties()}_symbolProperty(){return this._properties().symbol}_intervalProperty(){return this._properties().interval}_watchedSymbolListener(e){this._symbolProperty().value()!==e&&this._chartWidgetCollection.setSymbol(e)}_sendSnowplowAnalytics(){if(!window.user.do_not_track)throw new Error("unsupported")}_onSymbolPropertyChange(){const e=this._symbolProperty().value()!==this._watchedSymbol.value();this._watchedSymbol.setValue(this._symbolProperty().value()),e&&this._chartWidgetCollection.setSymbol(this._symbolProperty().value())}_onSymbolResolved(e){const t=this._mainSeries().symbolInfo();t&&this._applyValuesFromSymbolInfo(t)}_applyValuesFromSymbolInfo(e){const t=e.pro_name||o.enabled("trading_terminal")&&(e.full_name||e.name)||"";this._proSymbol.setValue(t),e.aliases&&this._symbolNamesList.setValue(e.aliases)}_updateSeriesSymbolInfo(){this._seriesShortSymbol.setValue(this._properties().shortName.value());const e=this._mainSeries().symbolInfo();if(e){this._applyValuesFromSymbolInfo(e);{const t=e.supported_resolutions;t?this._watchedSupportedResolutions.setValue(t):this._watchedSupportedResolutions.setValue(void 0)}let t=(0,c.allChartStyles)();(0,a.isCloseBasedSymbol)(e)&&(t=t.filter((e=>(0,a.isSingleValueBasedStyle)(e)))),this._watchedSupportedChartStyles.setValue(t),this._watchedIntraday.setValue(!!e.has_intraday),this._watchedSeconds.setValue(!!e.has_seconds),this._watchedTicks.setValue(!(0,a.isCloseBasedSymbol)(e)&&!!e.has_ticks),this._watchedRange.setValue(!(0,a.isCloseBasedSymbol)(e));const i=e.data_frequency?e.data_frequency:void 0;this._watchedDataFrequencyResolution.setValue(i)}else this._watchedIntraday.deleteValue(),this._watchedSeconds.deleteValue(),this._watchedTicks.deleteValue(),this._watchedRange.deleteValue(),this._proSymbol.deleteValue()}_watchedIntervalListener(e){this._intervalProperty().value()!==e&&this._chartWidgetCollection.setResolution(e)}_onIntervalPropertyChange(){const e=this._intervalProperty().value()!==this._watchedInterval.value();this._watchedInterval.setValue(this._intervalProperty().value()),e&&this._chartWidgetCollection.setResolution(this._intervalProperty().value())}_onChartModelCreated(e){if(!this._activeChartWidget)throw new Error("ChartWidget is undefined");this._chartWidgetBindingState=d.BoundToModel,
this._activeChartWidget.modelCreated().unsubscribe(this,this._onChartModelCreated);const t=this._symbolProperty();t.subscribe(this,this._onSymbolPropertyChange),this._watchedSymbol.setValue(t.value()),this._watchedSymbol.subscribe(this._watchedSymbolListenerBound);const i=this._mainSeries();i.dataEvents().symbolResolved().subscribe(this,this._onSymbolResolved),this._watchedSymbol.hook=e=>(i.symbolSameAsCurrent(e)&&(e=i.symbol()),e),i.dataEvents().symbolResolved().subscribe(this,this._updateSeriesSymbolInfo),i.dataEvents().symbolError().subscribe(this,this._updateSeriesSymbolInfo),i.dataEvents().symbolNotPermitted().subscribe(this,this._updateSeriesSymbolInfo),i.dataEvents().symbolGroupNotPermitted().subscribe(this,this._updateSeriesSymbolInfo),this._updateSeriesSymbolInfo();const s=this._intervalProperty();s.subscribe(this,this._onIntervalPropertyChange),this._watchedInterval.setValue(s.value()),this._watchedInterval.subscribe(this._watchedIntervalListenerBound),this._activeChartWidget.readOnly()&&(this._watchedSymbol.writeLock=!0)}};window.TradingViewApi||(window.TradingViewApi={linking:u})},131595:(e,t,i)=>{"use strict";const{getLogger:s}=i(817808),r=s("TVLocalStorage");var n=function(){try{this.isAvailable=!0,this.localStorage=window.localStorage,this.localStorage.setItem("tvlocalstorage.available","true")}catch(e){delete this.isAvailable,delete this.localStorage}this._updateLength();try{this._report()}catch(e){}};n.prototype._report=function(){if(this.isAvailable){const e=10,t=[];for(let e=0;e<this.localStorage.length;e++){const i=this.key(e);t.push({key:i,length:String(this.getItem(i)).length})}t.sort(((e,t)=>t.length-e.length));const i=t.slice(0,e);t.sort(((e,t)=>t.key.length-e.key.length));const s=t.slice(0,e);r.logNormal(`Total amount of keys in Local Storage: ${this.length}`),r.logNormal(`Top ${e} keys with longest values: ${JSON.stringify(i)}`),r.logNormal(`Top ${e} longest key names: ${JSON.stringify(s)}`);try{navigator.storage.estimate().then((e=>{r.logNormal(`Storage estimate: ${JSON.stringify(e)}`)}))}catch(e){}}},n.prototype.length=0,n.prototype.isAvailable=!1,n.prototype.localStorage={"tvlocalstorage.available":"false"},n.prototype._updateLength=function(){if(this.isAvailable)this.length=this.localStorage.length;else{var e,t=0;for(e in this.localStorage)this.localStorage.hasOwnProperty(e)&&t++;this.length=t}},n.prototype.key=function(e){return this.isAvailable?this.localStorage.key(e):Object.keys(this.localStorage)[e]},n.prototype.getItem=function(e){return this.isAvailable?this.localStorage.getItem(e):void 0===this.localStorage[e]?null:this.localStorage[e]},n.prototype.setItem=function(e,t){this.isAvailable?this.localStorage.setItem(e,t):this.localStorage[e]=t,this._updateLength()},n.prototype.removeItem=function(e){this.isAvailable?this.localStorage.removeItem(e):delete this.localStorage[e],this._updateLength()},n.prototype.clear=function(){this.isAvailable?this.localStorage.clear():this.localStorage={},this._updateLength()};var o=function(e){this.storage=e};o.prototype.getItem=function(e){
return Promise.resolve(this.storage.getItem(e))},o.prototype.setItem=function(e,t){return Promise.resolve(this.storage.setItem(e,t))},window.TVLocalStorage=new n,window.TVLocalStorageAsync=new o(window.TVLocalStorage),e.exports={TVLocalStorage:window.TVLocalStorage,TVLocalStorageAsync:window.TVLocalStorageAsync}},521097:(e,t,i)=>{"use strict";i.d(t,{breakpoints:()=>s,mobileFirstLegacyBreakpoints:()=>r});const s={desktop:1/0,desktopHd:1919,phone:767,"phone-vertical":479,tablet:1019},r={"media-mf-legacy-phone-vertical":330,"media-mf-legacy-phone":480,"media-mf-legacy-notebook":1020,"media-mf-legacy-desktop-medium":1480,"media-mf-legacy-desktop":1531}},735922:(e,t,i)=>{"use strict";i.d(t,{getScrollbarWidth:()=>s,matchMediaMinMax:()=>r,getContentWidth:()=>n,setStyle:()=>o,getCSSProperty:()=>a,getCSSPropertyNumericValue:()=>l});const s=(()=>{let e;return()=>{var t;if(void 0===e){const i=document.createElement("div"),s=i.style;s.visibility="hidden",s.width="100px",s.msOverflowStyle="scrollbar",document.body.appendChild(i);const r=i.offsetWidth;i.style.overflow="scroll";const n=document.createElement("div");n.style.width="100%",i.appendChild(n);const o=n.offsetWidth;null===(t=i.parentNode)||void 0===t||t.removeChild(i),e=r-o}return e}})();function r(e,t){return t===1/0?window.matchMedia(`(min-width: ${e}px)`):window.matchMedia(`(min-width: ${e}px) and (max-width: ${t}px)`)}function n(e){return l(e,"width")-l(e,"padding-left")-l(e,"padding-right")}function o(e,t,i){null!==e&&e.style.setProperty(t,i)}function a(e,t){return getComputedStyle(e,null).getPropertyValue(t)}function l(e,t){return parseInt(a(e,t))}},958198:(e,t,i)=>{"use strict";i.d(t,{mediaState:()=>c});var s=i(685459),r=i.n(s),n=i(646777),o=i(521097),a=i(735922);class l extends(r()){constructor(){super(),this.width=0,this.height=0,this.device=null,this.breakpoints=o.breakpoints,this._checkDevice(),window.addEventListener("resize",this._checkDevice),Object.entries(o.breakpoints).sort((([e,t],[i,s])=>t-s)).forEach((([e,t],i,s)=>{let r;if(0!==i){const[,e]=s[i-1];r=e+1}else r=0;const n=(0,a.matchMediaMinMax)(r,t);n.matches&&this._setNewDevice(e),n.addListener((t=>{t.matches&&(this._checkDevice(),this._setNewDevice(e))}))})),(0,n.whenDocumentReady)(this._checkDevice.bind(this)),this.isPhoneSizeDevice.bind(this)}isPhoneSizeDevice(){return"phone"===this.device||"phone-vertical"===this.device}_checkDevice(){this.width=window.innerWidth,this.height=window.innerHeight}_setNewDevice(e){const t=this.device;this.device=e,this.trigger("changeDevice",[e,t])}}const c=new l},69111:(e,t,i)=>{"use strict";function s(e,t=!1){return!1}function r(e,t=!1){return e}i.d(t,{isOnMobileAppPage:()=>s,urlWithMobileAppParams:()=>r})},743180:(e,t,i)=>{"use strict";function s(){}i.d(t,{addPerfMark:()=>o});const r=console.timeStamp?console.timeStamp.bind(console):s,n=window.performance&&performance.mark?performance.mark.bind(performance):s;window.performance&&performance.measure&&performance.measure.bind(performance),
window.performance&&performance.clearMarks&&performance.clearMarks.bind(performance);function o(e){r(e),n(e)}},29257:(e,t,i)=>{"use strict";function s(e){return e===r(e)}function r(e){const t=e.indexOf("$"),i=e.indexOf("@");return t<0&&i>=0?null:e.substring(Math.max(t+1,0),i>=0?i:e.length)}i.d(t,{isPineIdString:()=>s,extractPineId:()=>r})},501644:(e,t,i)=>{"use strict";i.d(t,{LibraryNewsProvider:()=>b,overrides:()=>y});var s=i(509806),r=i(951327),n=i(54266);function o(e){const t=new Date(e),i=new r.TimeFormatter(r.hourMinuteFormat),s=n.dateFormatFunctions["MMM dd"](t,!0);return[i.formatLocal(t),s]}var a=i(547490);function l(e){e.preventDefault()}const c=s.t(null,void 0,i(619914));var h=i(484727),d=i(486028),u=i(745132);const p=(0,i(817808).getLogger)("Library.News.RSS");function _(e){return h.enabled("remove_img_from_rss")?e.replace(/<img[^>]*>/g,""):e}function m(e){const t={};for(let i=0;i<e.childNodes.length;i++){const s=e.childNodes[i];0!==s.childNodes.length&&(t[s.nodeName]=s.childNodes[0].nodeValue)}return t}function g(e){return(0,d.isString)(e)?_(e):""}function f(e,t){return async function(e){const t=await(0,u.fetch)(e);if(!t.ok)return[];const i=await t.text(),s=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("channel");if(1!==s.length)return[];const r=s[0].getElementsByTagName("item");if(0===r.length)return[];const n=[];for(let e=0;e<r.length;e++)n.push(m(r[e]));return n.length?1===n.length&&-1!==n[0].title.indexOf("RSS feed not found")?[]:n.map((e=>{const t=e;return(0,d.isString)(t.title)?{shortDescription:g(t.description),link:g(t.link),published:(0,d.isString)(t.pubDate)?new Date(t.pubDate).getTime():Date.now(),title:_(t.title),source:""}:null})).filter((e=>null!==e)):[]}(e).then((e=>e.map((e=>(e.source=t,e)))))}const v={name:"Yahoo Finance",url:"https://feeds.finance.yahoo.com/rss/2.0/headline?s={SYMBOL}&region=US&lang=en-US"},S=s.t(null,void 0,i(157159));const y={getNews:null};class b extends class extends class{timeout(){return 3e5}getNews(e){return this._fetch(e)}renderItem(e){return function(e,t){const{title:i,shortDescription:s,link:r,source:n}=e,{isLinkBlock:c,withHover:h,showExternalLink:d,isExclusive:u,isImportantNewsItem:p}=t,_=document.createElement("div");_.setAttribute("init_unAuth_title_container","");const m=document.createElement("div");m.classList.add(a["news-item__title"]),m.textContent=i,m.classList.toggle(a["news-item__title--external-link"],!1);const g=document.createElement("div");g.classList.add(a["news-item__header"]);const f=document.createElement("div");f.classList.add(a["news-item__breadcrumbs"]),o(e.published).forEach((e=>{const t=document.createElement("span");t.textContent=e,f.appendChild(t)}));const v=document.createElement("span");v.textContent=n,f.appendChild(v),g.appendChild(f);const S=document.createElement(c?"a":"div");S.classList.add(a["news-item"]),S.classList.toggle(a["news-item--no-hover"],!h);const y=document.createElement("div");if(y.classList.add(a["news-item__wrapper"]),p&&S.classList.add(a["news-item--important"]),c&&r&&(S.href=r,
S.target="_blank",S.rel=d?"noopener nofollow":"noopener"),c||S.addEventListener("contextmenu",l),y.appendChild(g),y.appendChild(_),y.appendChild(m),s){const e=document.createElement("div");e.classList.add(a["news-item__description"]),e.textContent=s||"",y.appendChild(e)}return S.appendChild(y),S}(e,function(e){return{isLinkBlock:Boolean(e.link),withHover:Boolean(e.link),showExternalLink:Boolean(e.link),isExclusive:!1,isImportantNewsItem:!1}}(e))}unmountItems(){}_title(e){return c.format({title:this._providerTitle,symbol:e})}}{constructor(e=null){super(),this._providerTitle=S,this._settings=null,this._settings=e}addClickHandlers(e,t){e.fullDescription&&t.addEventListener("click",(t=>{var s;(t.preventDefault(),e.fullDescription)&&(s={title:e.title,description:e.fullDescription},Promise.all([i.e(9602),i.e(3031),i.e(962),i.e(4664)]).then(i.bind(i,375249)).then((e=>e.openLibraryNewsDescriptionDialogImpl(s))))}))}unmountItems(){}async _fetch(e){const{short_name:t,type:i,exchange:s}=e;let r=[];r=this._settings?this._settings[i]||this._settings.default:v,(0,d.isArray)(r)||(r=[r]);let n=[];return await Promise.all(r.map((e=>f(e.url.replace("{SYMBOL}",t).replace("{EXCHANGE}",s).replace("{TYPE}",i),e.name).then((e=>{n=n.concat(e)})).catch((()=>{p.logWarn("Something went wrong during load news")}))))),n.sort(((e,t)=>t.published.valueOf()-e.published.valueOf())),{title:this._title(e.short_name),newsItems:n}}}{constructor(){const e=window.urlParams.rss_news_feed;super(e?JSON.parse(e):null)}_fetch(e){if(y.getNews){const t=y.getNews;return new Promise((i=>{t(e.short_name,(t=>{var s;i({title:null!==(s=t.title)&&void 0!==s?s:this._title(e.short_name),newsItems:t.newsItems})}))}))}return super._fetch(e)}}},33290:(e,t,i)=>{"use strict";i.r(t),i.d(t,{registerService:()=>o,unregisterService:()=>a,hasService:()=>l,service:()=>c,waitServiceRegistered:()=>h});var s=i(114122);const r={},n=new Map;function o(e,t){if(l(e))throw new Error("Service already registered");r[e.id]=t;const i=n.get(e.id);void 0!==i&&(n.delete(e.id),i.resolve(t))}function a(e){if(!l(e))throw new Error("Service not found");r[e.id]=void 0}function l(e){return void 0!==r[e.id]}function c(e){const t=r[e.id];if(void 0===t)throw new Error("ServiceLocator: Service "+e.id+" not found");return t}function h(e){if(l(e))return Promise.resolve(c(e));let t=n.get(e.id);return void 0===t&&(t=(0,s.createDeferredPromise)(),n.set(e.id,t)),t.promise}},870122:(e,t,i)=>{"use strict";e=i.nmd(e),i(601227);i(745132).fetch;var s=i(475551).regExpEscape,r=i(717866).TVXWindowEvents,n=i(131595).TVLocalStorage,o=i(922157),a=i(484727),l=["s.tradingview.com","betacdn.tradingview.com"],c=a.enabled("use_localstorage_for_settings"),h=window.TVSettings=function(){var e=!1,t=null;function i(){return!t&&c}try{e=!TradingView.onWidget()&&parent&&parent!==window&&!!parent.IS_DEMO_PAGE}catch(e){}if(e){var d={"widgetbar.layout-settings":{widgets:{},settings:{minimized:!0}},notShowMainWizard:!0},u=function(e,t,i){var s=d[e];return null==s?t:s},p=function(){};return{loaded:!1,loadedModel:!1,getValue:u,getJSON:u,
getBool:u,getFloat:u,getInt:u,setValue:p,setJSON:p,remove:p,keys:function(){return Object.keys(d)},keysMask:function(){return[]},sync:p,onSync:{subscribe:function(){}}}}window.environment;var _,m=TradingView.onWidget()?"tradingview-widget":"tradingview",g=m+".",f={},v=[/^widgetbar\.widget\.watchlist.+/,/.+quicks$/,/^widgetbar\.layout-settings$/,/^ChartSideToolbarWidget\.visible$/,/^onwidget\.watchlist$/,/^domepanel.visible$/,/^orderpanel.visible$/,/^chart\.favoriteDrawings$/,/^chart\.favoriteDrawingsPosition$/,/^chart\.favoriteLibraryIndicators$/,/^loadChartDialog.favorites$/,/^ChartFavoriteDrawingToolbarWidget\.visible/,/^trading\.chart\.proterty$/,/^trading_floating_toolbar\.position$/,/^trading\.orderWidgetMode\./,/^symbolWatermark$/,/^pinereference\.size$/,/^pinereference\.position$/,/^hint\.+/,/^ChartDrawingToolbarWidget\.visible/];function S(e){return g+e}function y(e){return e.substring(g.length)}function b(e,t){var i=f[e];return null==i?t:i}function w(e,t,i){i=i||{};var s=""+t;return f[e]!==s&&(f[e]=s,C(e)),i.forceFlush&&!_&&(_=setTimeout((function(){_=void 0,T()}),10)),h}function P(e,t){return t=t||{},null!=f[e]&&(delete f[e],C(e)),t.forceFlush&&T(),h}function C(e){if(t)null==f[e]?t.removeValue(e):t.setValue(e,f[e]);else if(i())try{null==f[e]?n.removeItem(S(e)):n.setItem(S(e),f[e])}catch(e){}else 0;r.emit("settings",JSON.stringify({key:e,value:f[e]}))}function T(e){}function x(){return Object.keys(f)}function I(e){for(var t=0;t<v.length;++t)if(v[t].exec(e))return!0;return!1}function M(e){return e.substring(0,g.length)===g}function L(e){f={};const t=0===Object.keys(e).length;t||function(e){Object.keys(e).forEach((function(t){f[t]=e[t]+""}))}(e),function(e){for(var t=n.length;t--;){var i=n.key(t);i&&M(i)&&(e&&w(y(i),n.getItem(i)),n.removeItem(i))}}(t)}r.on("settings",(function(e){var t=JSON.parse(e);null==t.value?delete f[t.key]:f[t.key]=t.value}));var A=new o;return{loaded:!1,loadedModel:!1,getValue:b,getJSON:function(e,t){var i=b(e,void 0);if(null==i)return t;try{return JSON.parse(i)}catch(i){return P(e),t}},getBool:function(e,t){var i=b(e);return null==i?t:!(!i||"false"===i||0==+i)},getFloat:function(e,t,i){var s=b(e,void 0);if(null==s)return t;var r=parseFloat(s);if(!isFinite(r))throw new TypeError('"'+s+'" is not float (key: "'+e+'")');return r},getInt:function(e,t,i){var s=b(e,void 0);if(null==s)return t;var r=parseInt(s,10);if(!isFinite(r))throw new TypeError('"'+s+'" is not int (key: "'+e+'")');return r},setValue:w,setJSON:function(e,t,i){return w(e,JSON.stringify(t),i),h},remove:P,keys:x,keysMask:function(e,t){for(var i=x(),r=[],n=(e=new RegExp("^"+s(e).replace(/\\\*\\\*/gi,".+").replace(/\\\*/gi,"[^.]+")+"$","gi"),i.length-1);n>=0;n--)e.test(i[n])&&r.push(i[n]),e.lastIndex=0;return r},sync:function(e){null!==e?(t?L(t.initialSettings||{}):i()?(function(){if(TradingView.onWidget()&&l.includes(window.location.host))for(var e="tradingview.",t=n.length;t--;){var i=n.key(t);if(0===i.indexOf(e)){var s=i.replace(e,m+".");n.setItem(s,n.getItem(i)),n.removeItem(i)}}}(),function(){f={}
;for(var e=!a.enabled("save_chart_properties_to_local_storage"),t=n.length;t--;){var i=n.key(t);if(i&&M(i)){var s=i.substring(g.length);e&&!I(s)||(f[s]=n.getItem(i))}}}()):L(e||{}),A.fire()):!0},onSync:A,setSettingsAdapter:function(e){t=e}}}();e&&e.exports&&(e.exports=h)},752275:(e,t,i)=>{"use strict";i.d(t,{saveTextFile:()=>r,escapeCSVValue:()=>l});var s=i(601227);function r(e,t,i="text/plain"){const r=new Blob([t],{type:i});if(s.CheckMobile.iOS()){const t=new FileReader;return t.onload=()=>{t.result&&n(e,t.result.toString())},void t.readAsDataURL(r)}const o=window.URL.createObjectURL(r);navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(r,e):window.navigator.msSaveBlob?window.navigator.msSaveBlob(r,e):(n(e,o),window.URL.revokeObjectURL(o))}function n(e,t){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),i.href=t,i.download=e,i.click(),document.body.removeChild(i)}const o=/[",\r\n]/,a=/"/g;function l(e){return o.test(e)?`"${e.replace(a,'""')}"`:e}},651049:(e,t,i)=>{"use strict";i.d(t,{StdTheme:()=>a.StdTheme,getStdChartTheme:()=>h,getStdThemeNames:()=>c,isStdTheme:()=>u,translateThemeName:()=>d});var s=i(509806),r=i(724377)
;const n=JSON.parse('{"content":{"chartProperties":{"scalesProperties":{"textColor":"#131722","lineColor":"rgba(42, 46, 57, 0)","backgroundColor":"#ffffff"},"paneProperties":{"vertGridProperties":{"color":"rgba(42, 46, 57, 0.06)"},"horzGridProperties":{"color":"rgba(42, 46, 57, 0.06)"},"crossHairProperties":{"color":"#9598A1"},"background":"#ffffff","backgroundGradientStartColor":"#ffffff","backgroundGradientEndColor":"#ffffff","separatorColor":"#E0E3EB"}},"sessions":{"graphics":{"backgrounds":{"outOfSession":{"color":"#2962FF","transparency":92},"preMarket":{"color":"#FF9800","transparency":92},"postMarket":{"color":"#2962FF","transparency":92}},"vertlines":{"sessBreaks":{"color":"#4985e7","style":2,"width":1}}}},"mainSourceProperties":{"baseLineColor":"#B2B5BE","candleStyle":{"borderColor":"#378658","upColor":"#089981","wickColor":"#737375","wickUpColor":"#089981","wickDownColor":"#F23645","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645"},"haStyle":{"borderColor":"#378658","upColor":"#089981","wickColor":"#737375","wickUpColor":"#089981","wickDownColor":"#F23645","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645"},"barStyle":{"downColor":"#F23645","upColor":"#089981"},"pnfStyle":{"downColor":"#F23645","upColor":"#089981","upColorProjection":"#a9dcc3","downColorProjection":"#f5a6ae"},"baselineStyle":{"baselineColor":"#758696","topFillColor1":"rgba(8, 153, 129, 0.28)","topFillColor2":"rgba(8, 153, 129, 0.05)","bottomFillColor1":"rgba(242, 54, 69, 0.05)","bottomFillColor2":"rgba(242, 54, 69, 0.28)","topLineColor":"#089981","bottomLineColor":"#F23645"},"areaStyle":{"transparency":100,"color1":"rgba(41, 98, 255, 0.28)","color2":"#2962FF","linecolor":"#2962FF","linewidth":2,"linestyle":0},"hiloStyle":{"color":"#2962FF","borderColor":"#2962FF","labelColor":"#2962FF"},"columnStyle":{"upColor":"rgba(8, 153, 129, 0.5)","downColor":"rgba(242, 54, 69, 0.5)","priceSource":"close"},"renkoStyle":{"upColor":"#089981","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645","upColorProjection":"#a9dcc3","downColorProjection":"#f5a6ae","borderUpColorProjection":"#a9dcc3","borderDownColorProjection":"#f5a6ae","wickUpColor":"#089981","wickDownColor":"#F23645"},"lineStyle":{"color":"#2962FF","linewidth":2,"linestyle":0},"kagiStyle":{"downColor":"#F23645","upColor":"#089981","upColorProjection":"#a9dcc3","downColorProjection":"#f5a6ae"},"pbStyle":{"upColor":"#089981","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645","upColorProjection":"#a9dcc3","downColorProjection":"#f5a6ae","borderUpColorProjection":"#a9dcc3","borderDownColorProjection":"#f5a6ae"},"rangeStyle":{"upColor":"#089981","downColor":"#F23645","upColorProjection":"#a9dcc3","downColorProjection":"#f5a6ae"}}}}'),o=JSON.parse('{"content":{"chartProperties":{"scalesProperties":{"textColor":"#B2B5BE","lineColor":"rgba(240, 243, 250, 0)","backgroundColor":"#ffffff"},"paneProperties":{"vertGridProperties":{"color":"rgba(240, 243, 250, 0.06)"},"horzGridProperties":{"color":"rgba(240, 243, 250, 0.06)"},"crossHairProperties":{"color":"#9598A1"},"background":"#131722","backgroundGradientStartColor":"#181C27","backgroundGradientEndColor":"#131722","backgroundType":"gradient","separatorColor":"#2A2E39"}},"sessions":{"graphics":{"backgrounds":{"outOfSession":{"color":"#2962FF","transparency":92},"preMarket":{"color":"#FF9800","transparency":92},"postMarket":{"color":"#2962FF","transparency":92}},"vertlines":{"sessBreaks":{"color":"#4985e7","style":2,"width":1}}}},"mainSourceProperties":{"baseLineColor":"#5d606b","candleStyle":{"borderColor":"#378658","upColor":"#089981","wickColor":"#B5B5B8","wickUpColor":"#089981","wickDownColor":"#F23645","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645"},"haStyle":{"borderColor":"#378658","upColor":"#089981","wickColor":"#B5B5B8","wickUpColor":"#089981","wickDownColor":"#F23645","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645"},"barStyle":{"downColor":"#F23645","upColor":"#089981"},"pnfStyle":{"downColor":"#F23645","upColor":"#089981","upColorProjection":"#336854","downColorProjection":"#7f323f"},"baselineStyle":{"baselineColor":"#758696","topFillColor1":"rgba(8, 153, 129, 0.28)","topFillColor2":"rgba(8, 153, 129, 0.05)","bottomFillColor1":"rgba(242, 54, 69, 0.05)","bottomFillColor2":"rgba(242, 54, 69, 0.28)","topLineColor":"#089981","bottomLineColor":"#F23645"},"areaStyle":{"transparency":100,"color1":"rgba(41, 98, 255, 0.28)","color2":"#2962FF","linecolor":"#2962FF","linewidth":2,"linestyle":0},"hiloStyle":{"color":"#2962FF","borderColor":"#2962FF","labelColor":"#2962FF"},"columnStyle":{"upColor":"rgba(8, 153, 129, 0.5)","downColor":"rgba(242, 54, 69, 0.5)","priceSource":"close"},"renkoStyle":{"upColor":"#089981","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645","upColorProjection":"#336854","downColorProjection":"#7f323f","borderUpColorProjection":"#336854","borderDownColorProjection":"#7f323f","wickUpColor":"#089981","wickDownColor":"#F23645"},"lineStyle":{"color":"#2962FF","linewidth":2,"linestyle":0},"kagiStyle":{"downColor":"#F23645","upColor":"#089981","upColorProjection":"#336854","downColorProjection":"#7f323f"},"pbStyle":{"upColor":"#089981","downColor":"#F23645","borderUpColor":"#089981","borderDownColor":"#F23645","upColorProjection":"#336854","downColorProjection":"#7f323f","borderUpColorProjection":"#336854","borderDownColorProjection":"#7f323f"},"rangeStyle":{"upColor":"#089981","downColor":"#F23645","upColorProjection":"#336854","downColorProjection":"#7f323f"}}}}')
;var a=i(111982);function l(){return{[a.StdTheme.Light]:JSON.parse(JSON.stringify(n)),[a.StdTheme.Dark]:JSON.parse(JSON.stringify(o))}}function c(){return[a.StdTheme.Light,a.StdTheme.Dark]}function h(e){return l()[e]}function d(e){return{[a.StdTheme.Light]:s.t(null,{context:"colorThemeName"},i(669841)),[a.StdTheme.Dark]:s.t(null,{context:"colorThemeName"},i(14642))}[e]||e}function u(e){const t=l();return c().some((i=>p(t[i],e)))}function p(e,t){let i=e.content===t.content;return function(e={},t){try{_(e,[],t)}catch(e){return}}(e.content,((e,s)=>{const n=function(e,t={}){let i=t;for(let t=0;t<e.length;t++){if(!i||"object"!=typeof i)return;i=i[e[t]]}if("string"==typeof i||"number"==typeof i)return i;return}(e,t.content);return i=function(e,t){if(e===t)return!0;if("string"!=typeof e||"string"!=typeof t)return!1;try{return function(e,t){return Math.hypot(e[3]*e[0]-t[3]*t[0],e[3]*e[1]-t[3]*t[1],e[3]*e[2]-t[3]*t[2],255*e[3]-255*t[3])<48}((0,r.parseRgba)(e),(0,r.parseRgba)(t))}catch(e){}return!1}(s,n),!i})),i}function _(e,t,i){for(const s in e)if(e.hasOwnProperty(s)){const r=t.concat(s);if("object"==typeof e[s])_(e[s],r,i);else if(i(r,e[s]))throw new Error("exit")}}},111982:(e,t,i)=>{"use strict";var s;i.d(t,{StdTheme:()=>s}),function(e){e.Light="light",e.Dark="dark"}(s||(s={}))},9316:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DEFAULT_THEME:()=>p,extractThemeFromModel:()=>N,getCurrentTheme:()=>S,getStdTheme:()=>L,getStdThemeNames:()=>I,getStdThemedValue:()=>A,getTheme:()=>T,getThemeNames:()=>x,getThemedColor:()=>y,isPublicTheme:()=>v,isStdTheme:()=>R,isStdThemeName:()=>M,isStdThemedDefaultValue:()=>k,isThemeExist:()=>B,loadTheme:()=>b,removeTheme:()=>D,restoreTheme:()=>w,saveTheme:()=>E,savedThemeName:()=>P,syncTheme:()=>C,themes:()=>f,translateStdThemeName:()=>V});var s=i(724377),r=i(658363),n=i(870122);function o(){return(0,n.getValue)("current_theme.name")||null}var a=i(745132);const l=(0,i(817808).getLogger)("Themes.Provider");let c=null;function h(e){return(0,a.fetch)("/theme/?themeName="+encodeURIComponent(e),{credentials:"include",method:"GET"}).then((e=>e.json())).then((e=>{const t={};return e.content&&(t.content=JSON.parse(e.content)),t}))}var d=i(651049),u=i(702054);const p="light";var _=i(509806)
;const m=JSON.parse('{"color-header-bg":"color-black","color-body-bg":"color-black","color-body-secondary-bg":"color-cold-gray-900","color-bg-primary":"color-cold-gray-850","color-bg-primary-hover":"color-cold-gray-800","color-bg-secondary":"color-cold-gray-900","color-bg-highlight":"color-cold-gray-900","color-bg-scroll-buttons":"color-cold-gray-800","color-legacy-bg-scroll-buttons":"color-cold-gray-550","color-legacy-bg-widget":"color-cold-gray-900","color-text-primary":"color-cold-gray-200","color-text-secondary":"color-cold-gray-450","color-text-tertiary":"color-cold-gray-400","color-text-disabled":"color-cold-gray-650","color-accent-content":"color-white","color-divider":"color-cold-gray-700","color-divider-hover":"color-cold-gray-800","color-divider-secondary":"color-cold-gray-800","color-box-shadow":"color-cold-gray-900","color-active-hover-text":"color-cold-gray-200","color-alert-text":"color-cold-gray-200","color-border":"color-cold-gray-750","color-border-chat-fields":"color-cold-gray-750","color-border-hover":"color-cold-gray-650","color-border-table":"color-cold-gray-800","color-brand":"color-tv-blue-500","color-brand-hover":"color-tv-blue-600","color-brand-active":"color-tv-blue-700","color-button-hover-bg":"color-cold-gray-850","color-chart-page-bg":"color-cold-gray-800","color-common-tooltip-bg":"color-cold-gray-750","color-danger":"color-ripe-red-600","color-danger-hover":"color-ripe-red-500","color-danger-active":"color-ripe-red-400","color-depthrenderer-fill-style":"color-cold-gray-150","color-depthrenderer-stroke-style":"color-cold-gray-650","color-disabled-border-and-color":"color-cold-gray-800","color-disabled-input":"color-cold-gray-750","color-empty-container-message":"color-cold-gray-450","color-highlight-new":"color-tv-blue-a800","color-icons":"color-cold-gray-450","color-input-bg":"color-cold-gray-800","color-input-textarea-readonly":"color-cold-gray-650","color-input-placeholder-text":"color-cold-gray-700","color-input-publish-bg":"color-cold-gray-900","color-item-active-blue":"color-tv-blue-a900","color-item-hover-active-bg":"color-cold-gray-800","color-item-hover-bg":"color-cold-gray-800","color-item-hover-blue":"color-tv-blue-a800","color-item-selected-blue":"color-tv-blue-a800","color-item-active-text":"color-cold-gray-200","color-item-active-bg":"color-tv-blue-500","color-link":"color-tv-blue-500","color-link-hover":"color-tv-blue-600","color-link-active":"color-tv-blue-700","color-list-item":"color-cold-gray-450","color-list-nth-child-bg":"color-cold-gray-850","color-news-highlight":"color-cold-gray-800","color-pane-bg":"color-cold-gray-900","color-pane-secondary-bg":"color-cold-gray-850","color-placeholder":"color-cold-gray-650","color-popup-menu-item-hover-bg":"color-cold-gray-800","color-popup-menu-separator":"color-cold-gray-700","color-row-hover-active-bg":"color-cold-gray-800","color-sb-scrollbar-body-bg":"color-cold-gray-650","color-screener-description":"color-cold-gray-200","color-section-separator-border":"color-cold-gray-750","color-search-button-hover":"color-cold-gray-700","color-separator-table-chat":"color-cold-gray-750","color-success":"color-minty-green-700","color-success-hover":"color-minty-green-600","color-success-active":"color-minty-green-500","color-tag-active-bg":"color-cold-gray-750","color-tag-hover-bg":"color-cold-gray-800","color-text-regular":"color-cold-gray-200","color-toolbar-button-text":"color-cold-gray-200","color-toolbar-button-text-hover":"color-cold-gray-200","color-toolbar-button-text-active":"color-tv-blue-500","color-toolbar-button-text-active-hover":"color-tv-blue-600","color-toolbar-button-background-hover":"color-cold-gray-800","color-toolbar-button-background-secondary-hover":"color-cold-gray-750","color-toolbar-button-background-active":"color-tv-blue-a900","color-toolbar-button-background-active-hover":"color-tv-blue-a800","color-toolbar-toggle-button-background-active":"color-tv-blue-500","color-toolbar-toggle-button-background-active-hover":"color-tv-blue-600","color-toolbar-toggle-button-icon":"color-cold-gray-650","color-toolbar-interactive-element-text-normal":"color-cold-gray-200","color-toolbar-interactive-element-text-hover":"color-cold-gray-250","color-toolbar-opened-element-bg":"color-cold-gray-800","color-toolbar-divider-background":"color-cold-gray-700","color-tooltip-bg":"color-cold-gray-750","color-tv-button-checked":"color-cold-gray-500","color-tv-dialog-caption":"color-cold-gray-50","color-tv-dropdown-item-hover-bg":"color-cold-gray-800","color-underlined-text":"color-cold-gray-300","color-widget-pages-bg":"color-cold-gray-900","color-warning":"color-tan-orange-700","color-forex-icon":"color-white","color-list-item-active-bg":"color-tv-blue-500","color-list-item-hover-bg":"color-cold-gray-800","color-list-item-text":"color-cold-gray-200","color-price-axis-label-back":"color-cold-gray-800","color-price-axis-label-text":"color-cold-gray-500","color-price-axis-gear":"color-cold-gray-500","color-price-axis-gear-hover":"color-cold-gray-400","color-price-axis-highlight":"color-cold-gray-800","color-bid":"color-tv-blue-500","color-scroll-bg":"color-cold-gray-750","color-scroll-border":"color-cold-gray-850","color-widget-border":"color-cold-gray-800","color-scroll-buttons-arrow":"color-white","color-control-intent-default":"color-cold-gray-650","color-control-intent-success":"color-minty-green-500","color-control-intent-primary":"color-tv-blue-500","color-control-intent-warning":"color-tan-orange-500","color-control-intent-danger":"color-ripe-red-700","color-growing":"color-minty-green-500","color-falling":"color-ripe-red-500","color-goto-label-background":"color-cold-gray-650","color-pre-market":"color-tan-orange-600","color-pre-market-bg":"color-tan-orange-400","color-post-market":"color-tv-blue-500","color-post-market-bg":"color-tv-blue-400","color-market-open":"color-minty-green-500","color-market-open-bg":"color-minty-green-400","color-market-closed":"color-cold-gray-400","color-market-holiday":"color-cold-gray-400","color-market-expired":"color-ripe-red-500","color-invalid-symbol":"color-ripe-red-400","color-invalid-symbol-hover":"color-ripe-red-500","color-replay-mode":"color-tv-blue-500","color-replay-mode-point-select":"color-cold-gray-250","color-replay-mode-icon":"color-tv-blue-50","color-replay-mode-hover":"color-tv-blue-600","color-notaccurate-mode":"color-berry-pink-700","color-notaccurate-mode-bg":"color-berry-pink-400","color-delay-mode":"color-tan-orange-700","color-delay-mode-bg":"color-tan-orange-400","color-eod-mode":"color-grapes-purple-700","color-eod-mode-bg":"color-grapes-purple-400","color-data-problem":"color-ripe-red-600","color-data-problem-bg":"color-ripe-red-400","color-data-problem-hover":"color-ripe-red-500","color-list-item-bg-highlighted":"color-tv-blue-a900","color-list-item-bg-selected":"color-tv-blue-a800","color-list-item-bg-highlighted-hover":"color-tv-blue-a800","color-list-item-bg-selected-hover":"color-tv-blue-a700","color-screener-header-bg":"color-cold-gray-850","color-screener-header-bg-hover":"color-cold-gray-800","color-overlay":"color-cold-gray-950","color-boost-button-content-selected":"color-tv-blue-100","color-boost-button-content-hover":"color-white","color-boost-button-bg-hover":"color-cold-gray-750","color-boost-button-border-hover":"color-cold-gray-750","color-boost-button-border-default":"color-cold-gray-700","color-card-border":"color-cold-gray-700","color-card-border-hover":"color-cold-gray-600","color-background-special-primary":"color-black","color-stroke-special-primary":"color-cold-gray-800","color-selection-bg":"color-tv-blue-a700"}')
;var g=i(676507);const f={[d.StdTheme.Light]:{name:d.StdTheme.Light,label:()=>_.t(null,{context:"colorThemeName"},i(669841)),order:2,getThemedColor:e=>(0,g.getHexColorByName)(e)},[d.StdTheme.Dark]:{name:d.StdTheme.Dark,label:()=>_.t(null,{context:"colorThemeName"},i(14642)),order:1,getThemedColor:e=>{const t=m[e]||e;return(0,g.getHexColorByName)(t)}}};function v(e){return!e.isPrivate}function S(){return f[u.watchedTheme.value()]||f[p]}function y(e){return S().getThemedColor(e)}async function b(e,t){const{themeName:i,standardTheme:s,syncState:n=!0,noUndo:o=!1,applyOverrides:a=!1,onlyActiveChart:l=!1}=t,c=await(s?Promise.resolve(L(i)):T(i)),h=!s;if(void 0!==c.content){const t=!s||l;a&&(void 0!==(d=c.content).chartProperties&&(0,r.applyDefaultsOverrides)(d.chartProperties),void 0!==d.mainSourceProperties&&(0,r.applyDefaultsOverrides)(d.mainSourceProperties,void 0,!0,"mainSeriesProperties")),await e.applyTheme({theme:c.content,onlyActiveChart:t,restoreNonThemeDefaults:h,themeName:i,standardTheme:s,syncState:n,noUndo:o})}var d;return c}function w(){(0,u.setTheme)(o()||p)}function P(){return o()}function C(){var e;e=S().name,(0,n.setValue)("current_theme.name",e,{forceFlush:!0})}function T(e){return h(e)}function x(){return c||(0,a.fetch)("/themes/",{credentials:"include",method:"GET"}).then((e=>(c=e.json(),c)))}function I(){return d.getStdThemeNames()}function M(e){return I().includes(e)}function L(e){return d.getStdChartTheme(e)||{content:void 0}}function A(e,t){const i=t||S().name,s=d.getStdChartTheme(i),r=0!==e.length&&e.split(".");return s&&s.content&&r?r.reduce(((e,t)=>e[t]),s.content):null}function k(e,t,i){const r=A(e,i);return null!==r&&(0,s.areEqualRgba)((0,s.parseRgba)(r),(0,s.parseRgba)(String(t)))}function E(e,t){return function(e,t){const i=new FormData;return i.append("content",JSON.stringify(t)),i.append("name",e),c=null,(0,a.fetch)("/save-theme/",{credentials:"include",method:"POST",body:i}).then((e=>e.json()),(e=>l.logError(e)))}(e,t)}function D(e){return function(e){const t=new FormData;return t.append("name",e),c=null,(0,a.fetch)("/remove-theme/",{credentials:"include",method:"POST",body:t}).then((e=>e.json()),(e=>l.logError(e)))}(e)}function B(e){return function(e){return h(e).then((e=>Boolean(e.content)))}(e)}function V(e){return d.translateThemeName(e)}function R(e){return d.isStdTheme(e)}function N(e){return{content:{chartProperties:{paneProperties:e.model().properties().childs().paneProperties.state(),scalesProperties:e.model().properties().childs().scalesProperties.state()},sessions:e.model().sessions().properties().state(),mainSourceProperties:e.model().mainSeries().properties().state(),version:e.model().version()}}}},702054:(e,t,i)=>{"use strict";i.d(t,{setTheme:()=>n,watchedTheme:()=>r});var s=i(210596);const r=new(i.n(s)());function n(e){r.setValue(e)}r.subscribe((e=>{!function(e,t=window){const i="theme-"+e,s=t.document.documentElement.classList;for(const e of Array.from(s))e.startsWith("theme-")&&e!==i&&s.remove(e);s.add(i)}(e,window)}))},32133:(e,t,i)=>{"use strict";i.d(t,{trackEvent:()=>l,
disableTrackingEvents:()=>c});var s=i(559410),r=i(484727);const n=(0,i(817808).getLogger)("Common.TrackEvent"),o=[/Study_(Drawing)_(.*)/,/(Study)_(.*)@tv-basicstudies/,/(Study)_(.*)/,/(Chart Style) (.*)/];let a=!1;const l=(e,t,i)=>{if(a)return;if(r.enabled("charting_library_base"))return void((e,t,i)=>{t=t||e||i||"";let r="";for(let e=0;e<o.length;e++){const i=t.match(o[e]);if(i&&3===i.length){t=i[1],r=i[2];break}}(0,s.emit)(t.toLowerCase().replace(" ","_"),{category:e,label:i,value:r})})(e,t,i);let l=(e?e+":":"")+t;i&&(l+=" "+i),n.logNormal(l),r.enabled("widget")||!window._UNIT_TESTS&&window.gtag&&window.gtag("event",t,{event_category:e,event_label:i})};function c(){a=!0}"undefined"!=typeof window&&(window.TradingView=window.TradingView||{},window.TradingView.trackEvent=l)},717866:(e,t,i)=>{"use strict";i.d(t,{TVXWindowEvents:()=>o});i(603605);var s=i(817808),r=i(131595);const n=(0,s.getLogger)("XWindowEvents");var o;!function(e){const t="tvxwevents.",i={};let s;window.BroadcastChannel?(s=new BroadcastChannel("tvxwevents"),s.addEventListener("message",(function(e){const{data:{event:t,value:s}}=e;i[t]&&i[t].forEach((e=>{e(s)}))})),function(){const e=[],i=performance.now();for(let i=0;i<r.TVLocalStorage.length;i++){const s=r.TVLocalStorage.key(i);s.startsWith(t)&&e.push(s)}const s=r.TVLocalStorage.length;for(const t of e)r.TVLocalStorage.removeItem(t);const o=performance.now()-i;n.logNormal(`Total keys amount in local storage on operation start: ${s}`),n.logNormal(`Keys amount in local storage to be deleted: ${e.length}`),n.logNormal(`Keys to be deleted from local storage: ${JSON.stringify(e)}`),n.logNormal(`Removing keys from local storage took ${o} ms`)}()):window.addEventListener("storage",(function(e){const{newValue:s,key:n}=e;if(null===s||!n||!n.startsWith(t))return;const o=n.substring(t.length);i[o]&&i[o].forEach((t=>{t(e.newValue)}));r.TVLocalStorage.removeItem(n)})),e.on=function(e,t){i[e]||(i[e]=[]),i[e].push(t)},e.off=function(e,t){if(!i[e])return;const s=i[e].indexOf(t);-1!==s&&(1===i[e].length?delete i[e]:i[e].splice(s,1))},e.emit=function(e,i=Date.now()){try{s?s.postMessage({event:e,value:i}):r.TVLocalStorage.setItem(t+e,i.toString())}catch(e){n.logError(e.message)}}}(o||(o={}))},509806:(e,t,i)=>{"use strict";i.r(t),i.d(t,{t:()=>s});i(603605);function s(e,t={},n){if(null===e)return Array.isArray(n)?(n[r(t.count)]||n[0]).format(t.replace||t):"object"==typeof n?s(null,t,n[i.g.language]||n.en):s(n,t);if(n&&e){const i=`${e}${t.context?`_${t.context}`:""}`;if(n[i])return s(null,t,n[i])}if("number"==typeof e)return e.toString();if("string"!=typeof e)return"";if(i.g.customTranslateFunction){const s=i.g.customTranslateFunction(e,t);if(null!==s)return s}return(t.plural&&1!=+t.count?t.plural:e).format(t.replace||t)}const r={ca_ES:(e=1)=>+(1!=e),cs:(e=1)=>+(1==e?0:e>=2&&e<=4?1:2),el:(e=1)=>+(1!=e),da_DK:(e=1)=>+(1!=e),en:(e=1)=>+(1!=e),et_EE:(e=1)=>+(1!=e),fa:(e=1)=>0,hu_HU:(e=1)=>0,id_ID:(e=1)=>0,it:(e=1)=>+(1!=e),ms_MY:(e=1)=>0,no:(e=1)=>+(1!=e),nl_NL:(e=1)=>+(1!=e),
ro:(e=1)=>+(1==e?0:e%100>19||e%100==0&&0!=e?2:1),sk_SK:(e=1)=>+(1==e?0:e>=2&&e<=4?1:2),sv:(e=1)=>+(1!=e),zh:(e=1)=>0,zh_TW:(e=1)=>0,de:(e=1)=>+(1!=e),es:(e=1)=>+(1!=e),fr:(e=1)=>+(e>1),he_IL:(e=1)=>+(1==e?0:2==e?1:e>10&&e%10==0?2:3),ko:(e=1)=>0,ja:(e=1)=>0,pl:(e=1)=>+(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2),pt:(e=1)=>+(1!=e),tr:(e=1)=>+(1!=e),vi:(e=1)=>0,ar:(e=1)=>+(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11&&e%100<=99?4:5),ru:(e=1)=>+(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2),th:(e=1)=>0}[i.g.language]},928870:(e,t,i)=>{"use strict";i.r(t),i.d(t,{activateKeyPressHandler:()=>m,showDialog:()=>g});const s=[];let r=null;function n(e){for(let t=0;t<s.length;t++)if(s[t].name===e)return t;return-1}function o(e){if(!r)for(let t=s.length-1;t>=0&&!0!==s[t].func(e);t--);}window.addEventListener("keypress",o,!1);var a=i(282898),l=i(484727),c=i(538774),h=i(679311),d=i(230356),u=i(32133);let p=null;function _(e){if(!(0,a.globalKeypressMatches)(e))return!1;e.preventDefault();const t=String.fromCharCode(e.charCode);return l.enabled("show_interval_dialog_on_key_press")&&function(e){return/[1-9]/.test(e)}(t)?(0,c.showChangeIntervalDialogAsync)({initVal:t}):l.enabled("symbol_search_hot_key")&&(g({defaultValue:t,selectSearchOnInit:!1,source:"keyboard"}),(0,u.trackEvent)("GUI","SS","hotkey")),!0}function m(){(0,h.loadChangeIntervalDialog)(),function(e,t){const i={name:e,func:t},r=n(i.name);r>-1&&s.splice(r,1),s.unshift(i)}("symbolEdit",_)}function g(e){const t=p=(0,d.loadNewSymbolSearch)().then((i=>{t===p&&i.showDefaultSearchDialog(e)}));return t}},673026:(e,t,i)=>{"use strict";let s;function r(){return s}function n(e){s=e}i.d(t,{getSearchRequestDelay:()=>r,setSearchRequestDelay:()=>n})},48547:(e,t,i)=>{"use strict";i.d(t,{WidgetbarWidgetRenderer:()=>s});class s{constructor(e){this.hasLifecycle=!0,this._loadModulePromise=null;const{container:t,header:i,id:s}=e;this._container=t,this._headerContainer=i,this._widgetId=s}unmount(){const e=i.c[500962];if(e){const t=e.exports;t.unmountComponentAtNode(this._container),t.unmountComponentAtNode(this._headerContainer)}}destroy(){this._loadModulePromise=null,this.unmount()}}},206594:(e,t,i)=>{"use strict";i.d(t,{CLOSE_POPUPS_AND_DIALOGS_COMMAND:()=>s});const s="CLOSE_POPUPS_AND_DIALOGS_COMMAND"},561371:(e,t,i)=>{"use strict";i.d(t,{CompareDialogRenderer:()=>n});var s=i(231605);var r=i(559410);class n extends s.DialogRenderer{constructor(e){super(),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)},this._chartWidgetCollection=e}show(){this._load().then((e=>{var t,i;null===(t=this._dialog)||void 0===t||t.hide(),null===(i=this._dialog)||void 0===i||i.visible().unsubscribe(this._subscribe),this._dialog=e,e.visible().subscribe(this._subscribe),e.show(),r.emit("compare_add")}))}hide(){var e;null===(e=this._dialog)||void 0===e||e.hide()}_load(){
return Promise.all([i.e(7271).then(i.bind(i,926163)),Promise.all([i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(9602),i.e(1901),i.e(8825),i.e(5761),i.e(1428),i.e(1685),i.e(8707),i.e(8271),i.e(3261),i.e(537),i.e(1271),i.e(962),i.e(9255),i.e(37),i.e(766),i.e(1534),i.e(731)]).then(i.bind(i,881748))]).then((([e,t])=>{const i=new e.CompareModel(this._chartWidgetCollection);return t.getCompareDialogRenderer(i)}))}}},153055:(e,t,i)=>{"use strict";async function s(e,t){const s=await Promise.all([i.e(8230),i.e(4819),i.e(346),i.e(9602),i.e(1901),i.e(8619),i.e(1140),i.e(6812),i.e(2754),i.e(962),i.e(766),i.e(1309),i.e(994),i.e(8890)]).then(i.bind(i,480994));return s.showSimpleDialog(e,s.renameModule,t)}async function r(e,t){const s=await Promise.all([i.e(8230),i.e(4819),i.e(346),i.e(9602),i.e(1901),i.e(8619),i.e(1140),i.e(6812),i.e(2754),i.e(962),i.e(766),i.e(1309),i.e(994),i.e(8890)]).then(i.bind(i,480994));return s.showSimpleDialog(e,s.confirmModule,t)}async function n(e,t){const s=await Promise.all([i.e(8230),i.e(4819),i.e(346),i.e(9602),i.e(1901),i.e(8619),i.e(1140),i.e(6812),i.e(2754),i.e(962),i.e(766),i.e(1309),i.e(994),i.e(8890)]).then(i.bind(i,480994));return s.showSimpleDialog(e,s.warningModule,t)}i.d(t,{showRename:()=>s,showConfirm:()=>r,showWarning:()=>n})},126309:(e,t,i)=>{"use strict";i.d(t,{hideStateChange:()=>r});var s=i(922157);const r=new(i.n(s)())},812297:(e,t,i)=>{"use strict";i.d(t,{getHideOptions:()=>h,toggleHideMode:()=>d,getSavedHideMode:()=>u});var s=i(650151),r=i(509806),n=i(870122),o=i(140641),a=i(358076),l=i(126309);let c=null;function h(){if(null!==c)return c;const e=(0,o.tradingService)();return c=new Map([["drawings",{label:r.t(null,void 0,i(413277)),dataName:"hide-drawing-tools",tooltip:{active:r.t(null,void 0,i(998116)),inactive:r.t(null,void 0,i(895551))},getBoxedValue:()=>(0,a.hideAllDrawings)(),trackLabel:"hide drawings"}],["indicators",{label:r.t(null,void 0,i(44177)),dataName:"hide-indicators",tooltip:{active:r.t(null,void 0,i(249982)),inactive:r.t(null,void 0,i(986306))},getBoxedValue:()=>(0,a.hideAllIndicators)(),trackLabel:"hide indicators"}],["positions",{label:r.t(null,void 0,i(190540)),dataName:"hide-positions-and-orders",tooltip:{active:r.t(null,void 0,i(262632)),inactive:r.t(null,void 0,i(770803))},getBoxedValue:()=>(0,s.ensureNotNull)(e).showTradedSources,inverted:!0,trackLabel:"hide positions"}],["all",{label:r.t(null,void 0,i(133911)),dataName:"hide-all",tooltip:{active:e?r.t(null,void 0,i(538293)):r.t(null,void 0,i(839046)),inactive:e?r.t(null,void 0,i(67927)):r.t(null,void 0,i(44312))},trackLabel:"hide all"}]]),e||c.delete("positions"),c}function d(e){e?n.setValue("ChartToolsHideMode",e):e=u();const t=p();let i=!t;return"all"===e?(_(((e,t,s)=>{e.setValue(s?!i:i)})),l.hideStateChange.fire({hideMode:e,isActive:i}),i):(_(((s,r,n)=>{if(r===e){const e=t?!n:!s.value();s.setValue(e),i=n?!e:e}else s.setValue(Boolean(n))})),l.hideStateChange.fire({hideMode:e,isActive:i}),i)}function u(){const e=n.getValue("ChartToolsHideMode","drawings");return h().has(e)?e:"drawings"}function p(){let e=!0
;return _(((t,i,s)=>{const r=t.value();e=e&&(s?!r:r)})),e}function _(e){h().forEach(((t,i)=>{var s;const r=null===(s=t.getBoxedValue)||void 0===s?void 0:s.call(t);r&&e(r,i,t.inverted)}))}},421721:(e,t,i)=>{"use strict";i.d(t,{ObjectTreeDialogController:()=>n});var s=i(231605);let r;class n extends s.DialogRenderer{constructor(){super(),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)}}show(){this._load().then((e=>e.show()))}hide(){var e;null===(e=this._dialog)||void 0===e||e.hide()}static getInstance(){return r||(r=new n),r}_load(){return Promise.all([i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(9602),i.e(1901),i.e(8825),i.e(1428),i.e(1685),i.e(105),i.e(8009),i.e(4412),i.e(8819),i.e(8484),i.e(2196),i.e(8529),i.e(722),i.e(784),i.e(7654),i.e(962),i.e(9255),i.e(37),i.e(1323),i.e(1990),i.e(8210),i.e(5416),i.e(766),i.e(7392),i.e(5031),i.e(4862)]).then(i.bind(i,899329)).then((e=>{var t,i;return null===(t=this._dialog)||void 0===t||t.hide(),null===(i=this._dialog)||void 0===i||i.visible().unsubscribe(this._subscribe),this._dialog=new e.ObjectTreeDialogRenderer,this._dialog.visible().subscribe(this._subscribe),this._dialog}))}}},739477:(e,t,i)=>{"use strict";i.d(t,{GeneralChartPropertiesRenderer:()=>r});var s=i(231605);class r extends s.DialogRenderer{constructor(e){super(),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)},this._chartWidgetCollection=e}show(){const e=this._chartWidgetCollection,t=e.activeChartWidget.value();return t.generalPropertiesDefinitions().then((s=>Promise.all([i.e(842),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(9602),i.e(1901),i.e(8825),i.e(5761),i.e(1428),i.e(8619),i.e(1685),i.e(4884),i.e(3287),i.e(8707),i.e(8009),i.e(1282),i.e(8271),i.e(3795),i.e(3578),i.e(7177),i.e(2405),i.e(3261),i.e(3562),i.e(149),i.e(9686),i.e(8251),i.e(5020),i.e(6304),i.e(3200),i.e(962),i.e(37),i.e(7125),i.e(1534),i.e(3667),i.e(5150),i.e(9843),i.e(7078)]).then(i.bind(i,61358)).then((i=>{var r,n;const o=new i.GeneralChartPropertiesDialogRenderer({chartWidgetCollection:e,propertyPages:s,activePageId:this._activePageId,model:t.model()});return null===(r=this._dialog)||void 0===r||r.hide(),null===(n=this._dialog)||void 0===n||n.visible().unsubscribe(this._subscribe),this._dialog=o,o.visible().subscribe(this._subscribe),o.show(),this._activePageId=void 0,o}))))}hide(){var e;null===(e=this._dialog)||void 0===e||e.hide()}isVisible(){return this.visible().value()}focusOnText(){}setActivePage(e){this._activePageId=e}}},385833:(e,t,i)=>{"use strict";i.d(t,{registerSettingsSymbolListBackend:()=>d});var s=i(509806),r=i(220863),n=i(870122),o=i(131148),a=i(33290),l=i(740662),c=i(484727);class h{constructor(e=[],t=n){if(this._lists={},this._activeListSettingsKey="widgetbar.widget.watchlist",c.enabled("trading_terminal")&&(this._activeListSettingsKey+="terminal"),this._settings=t,this._settings.onSync.subscribe(this,this._updateLists),this._updateLists(),0===Object.keys(this._lists).length){const t=this._createList({title:this._pickTitle(),symbols:[...e]});this.setActive(t.id)}}
destroy(){this._settings.onSync.unsubscribeAll(this)}getCustomWatchLists(){this._updateLists();const e=[];return Object.keys(this._lists).forEach((t=>{const i=this._getList(t);i&&e.push(this._toSymbolList(i))})),Promise.resolve(e)}createWatchList(e){const t=this._createList({id:e.id,title:e.name||this._pickTitle(),symbols:e.symbols||[]});return l.onListAdded.fire(t.id,[...t.symbols]),Promise.resolve(this._toSymbolList(t))}putWatchList(e){this._updateLists();const t=this._getList(e.id),i=null==t?void 0:t.title,s=e.name;return this.saveList({id:e.id,symbols:e.symbols,title:e.name}),void 0!==i&&i!==s&&l.onListRenamed.fire(e.id,i,s),null!==t?l.onListChanged.fire(e.id):l.onListAdded.fire(e.id,e.symbols),Promise.resolve(e)}removeWatchList(e){const{id:t}=e;return this._settings.remove(`savedwatch.${t}`,{forceFlush:!0}),delete this._lists[t],l.onListRemoved.fire(t),Promise.resolve()}renameWatchList(e,t){this._updateLists();const{name:i}=e;return e.name=t,this.saveList({id:e.id,symbols:e.symbols,title:t}),l.onListRenamed.fire(e.id,i,t),Promise.resolve(t)}replaceSymbols(e,t){const i=this._getList(e.id);return null===i||(i.symbols=[...t],this.saveList(i),l.onListChanged.fire(e.id)),Promise.resolve()}addSymbols(e,t){const i=this._getList(e.id);return null===i?Promise.resolve([]):(i.symbols.push(...t),this.saveList(i),l.onListChanged.fire(e.id),Promise.resolve([...i.symbols]))}removeSymbols(e,t){const i=this._getList(e.id);return null===i?Promise.resolve([]):(i.symbols=i.symbols.filter((e=>!t.includes(e))),this.saveList(i),l.onListChanged.fire(e.id),Promise.resolve([...i.symbols]))}setActive(e){return this._settings.setValue(this._activeListSettingsKey,e),l.onActiveListChanged.fire(),Promise.resolve()}getActive(){const e=this._getActive();return Promise.resolve(this._toSymbolList(e))}changeDescription(e,t){throw new Error("not implemented")}saveList(e){const t={symbols:e.symbols,title:String(e.title)};this._settings.setJSON(`savedwatch.${e.id}`,t,{forceFlush:!0}),this._lists[e.id]=t}_createList(e){var t;const i={id:null!==(t=e.id)&&void 0!==t?t:(0,r.randomHash)(),symbols:e.symbols,title:e.title};return this.saveList(i),i}_getList(e){if(this._updateLists(),this._lists.hasOwnProperty(e)){const t=this._lists[e];return{id:e,symbols:t.symbols.slice(),title:t.title}}return null}_toSymbolList(e){return{type:"custom",id:e.id,name:e.title,description:null,symbols:e.symbols,shared:!1}}_updateLists(){this._lists={};this._settings.keys().forEach((e=>{const t=/^savedwatch\.(.*)$/.exec(e);if(!t)return;const i=t[1],s=this._settings.getJSON(e,null);s&&(s.symbols||(s.symbols=[]),this._lists[i]=s)}))}_getActive(){const e=this._settings.getValue(this._activeListSettingsKey),[t,i]=Object.entries(this._lists)[0],s={id:t,...i};return void 0!==e&&this._getList(e)||s}_pickTitle(){this._updateLists();const e=Object.keys(this._lists).map((e=>this._lists[e].title));for(let t=1;;t++){const r=s.t(null,void 0,i(213402))+(t>1?` (${t})`:"");if(-1===e.indexOf(r))return r}}}function d(e){const t=new h(e);return(0,
a.registerService)(o.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE,t),()=>{(0,a.unregisterService)(o.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE)}}},131148:(e,t,i)=>{"use strict";i.d(t,{SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE:()=>s});const s={id:"SymbolListRepositoryBackend"}},662654:(e,t,i)=>{"use strict";var s;i.d(t,{TickerType:()=>s}),function(e){e.Ticker="ticker",e.Description="description"}(s||(s={}))},743717:(e,t,i)=>{"use strict";i.r(t),i.d(t,{initSymbolListService:()=>n});var s=i(33290);const r={id:"SymbolListService"};function n(){return Promise.all([Promise.all([i.e(1323),i.e(4482),i.e(7898),i.e(1026)]).then(i.bind(i,2595)),Promise.all([i.e(1323),i.e(4482),i.e(7898),i.e(1026)]).then(i.bind(i,363940)),Promise.all([i.e(1323),i.e(4482),i.e(7898),i.e(1026)]).then(i.bind(i,219769)),Promise.all([i.e(1323),i.e(4482),i.e(7898),i.e(1026)]).then(i.bind(i,607898))]).then((([e,t,i,n])=>{if((0,s.hasService)(r))return(0,s.service)(r);const{store:o,runner:a}=e.configureStore(),l=a.run(t.symbolListRepositorySaga);return(0,s.registerService)(r,{store:o,runner:a,actions:{addSymbols:n.addSymbolsThunk,initWidget:i.initWidget,saveListAs:n.saveListAsThunk,createNewWatchList:n.userCreateWatchlistThunk},task:l}),(0,s.service)(r)}))}},740662:(e,t,i)=>{"use strict";i.d(t,{onListChanged:()=>n,onActiveListChanged:()=>o,onListAdded:()=>a,onListRemoved:()=>l,onListRenamed:()=>c});var s=i(922157),r=i.n(s);const n=new(r()),o=new(r()),a=new(r()),l=new(r()),c=new(r())},979359:(e,t,i)=>{"use strict";i.d(t,{WATCHLIST_WIDGET_ID:()=>s});const s="watchlist-widget"},354364:(e,t,i)=>{"use strict";i.d(t,{ROOT_ID:()=>l,createNodes:()=>h,expandWatchlist:()=>m,exportList:()=>_,getInitialTickerType:()=>u,setInitialTickerType:()=>p,sortComparator:()=>d});var s=i(650151),r=i(484727),n=i(131595),o=i(662654),a=i(752275);const l="ROOT_ID",c="WatchlistTickerType";function h(e){const t=[{id:l,children:e,level:0}];for(const i of e)t.push({id:i,level:1,children:[],parentId:l});return t}function d(e,t){return(0,s.ensureNotNull)(e.name).localeCompare((0,s.ensureNotNull)(t.name),void 0,{numeric:!0})}function u(){return r.enabled("widget"),o.TickerType.Ticker}function p(e){n.TVLocalStorage.setItem(c,e)}function _(e,t){(0,a.saveTextFile)(`${e}.txt`,t.join(","))}function m(){if(!window.widgetbar)return;window.widgetbar.setPage("base"),function(e,t){var i;const s=null===(i=window.widgetbar)||void 0===i?void 0:i.widget(e);s&&0===s.heightRatio&&(s.setMinHeight(t),s.minHeight=0)}("watchlist",64)}},530401:(e,t,i)=>{"use strict";i.d(t,{WatchlistWidgetViewState:()=>a});var s=i(131595),r=i(484727);const n=["short_name","last_price","change","change_percent"],o=["short_name","last_price","change_percent"];class a{getColumns(){if(r.enabled("widget"))return o;const e=s.TVLocalStorage.getItem("widget.watchlist.view-state");return this._parse(e)||n}setColumns(e){r.enabled("widget")||(null===e?s.TVLocalStorage.removeItem("widget.watchlist.view-state"):s.TVLocalStorage.setItem("widget.watchlist.view-state",JSON.stringify(this._normalize(e))))}canResizeColumns(){return!r.enabled("widget")}
getIsLogoEnabled(){const e=s.TVLocalStorage.getItem("widget.watchlist.logo-enabled");return!e||("true"===e||!1)}setIsLogoEnabled(e){s.TVLocalStorage.setItem("widget.watchlist.logo-enabled",String(e))}getColumnsPercentages(){if(!this.canResizeColumns())return null;const e=s.TVLocalStorage.getItem("widget.watchlist.columns-percentages");return null===e?null:new Map(JSON.parse(e))}saveColumnsPercentages(e){if(!this.canResizeColumns())return;const t=JSON.stringify(Array.from(e));s.TVLocalStorage.setItem("widget.watchlist.columns-percentages",t)}_parse(e){if(null===e)return null;try{const t=JSON.parse(e);return Array.isArray(t)?this._normalize(t):null}catch(e){return null}}_normalize(e){const t=e.filter((e=>"string"==typeof e)),i=new Set(t),s=new Set(["short_name","volume","last_price","change","change_percent","rchp"]);return Array.from(i).filter((e=>s.has(e)))}}},76821:(e,t,i)=>{"use strict";var s;i.d(t,{ToolboxType:()=>s}),function(e){e[e.Delete=0]="Delete"}(s||(s={}))},370981:(e,t,i)=>{"use strict";i.d(t,{globalCloseDelegate:()=>r,globalCloseMenu:()=>n});var s=i(922157);const r=new(i.n(s)());function n(){r.fire()}},568515:e=>{e.exports={"css-value-header-toolbar-height":"38px"}},512882:e=>{e.exports={chartsSplitter:"chartsSplitter-_LZ9aQoF",hovered:"hovered-_LZ9aQoF","i-active":"i-active-_LZ9aQoF"}},108342:e=>{e.exports={"css-value-pane-controls-padding-left":"1px","css-value-pane-controls-padding-right":"5px"}},951782:e=>{e.exports={paneSeparator:"paneSeparator-ZR_yhubO",handle:"handle-ZR_yhubO",hovered:"hovered-ZR_yhubO",active:"active-ZR_yhubO"}},786520:(e,t,i)=>{"use strict";var s=i(486028).declareClassAsPureInterface;function r(){}TradingView.WEB_SOCKET_WAS_CONNECTED=!1,r.prototype.defaultResolutions=function(){},r.prototype.availableCurrencies=function(){},r.prototype.availableUnits=function(){},r.prototype.supportedSymbolsTypes=function(){},r.prototype.symbolsGrouping=function(){},r.prototype.quoteCreateSession=function(e){},r.prototype.quoteDeleteSession=function(e){},r.prototype.quoteSetFields=function(e,t){},r.prototype.quoteAddSymbols=function(e,t){},r.prototype.quoteRemoveSymbols=function(e,t){},r.prototype.quoteFastSymbols=function(e,t){},r.prototype.depthCreateSession=function(e,t,i){},r.prototype.depthDeleteSession=function(e){},r.prototype.depthSetSymbol=function(e,t){},r.prototype.depthClearSymbol=function(e){},r.prototype.depthSetScale=function(e,t){},r.prototype.chartCreateSession=function(e,t){},r.prototype.chartDeleteSession=function(e){},r.prototype.createSession=function(e,t){},r.prototype.removeSession=function(e){},r.prototype.connected=function(){},r.prototype.connect=function(){},r.prototype.disconnect=function(){},r.prototype.switchTimezone=function(e,t){},r.prototype.resolveSymbol=function(e,t,i,s){},r.prototype.createSeries=function(e,t,i,s,r,n,o,a){},r.prototype.removeSeries=function(e,t,i){},r.prototype.modifySeries=function(e,t,i,s,r,n,o){},r.prototype.requestMoreData=function(e,t,i,s){},r.prototype.requestMetadata=function(e,t,i){},r.prototype.canCreateStudy=function(e,t){},
r.prototype.createStudy=function(e,t,i,s,r,n,o){},r.prototype.rebindStudy=function(e,t,i,s,r,n,o,a){},r.prototype.removeStudy=function(e,t,i){},r.prototype.modifyStudy=function(e,t,i,s,r){},r.prototype.createPointset=function(e,t,i,s,r,n,o){},r.prototype.modifyPointset=function(e,t,i,s,r){},r.prototype.removePointset=function(e,t,i){},r.prototype.requestMoreTickmarks=function(e,t,i,s){},r.prototype.requestFirstBarTime=function(e,t,i,s){},r.prototype._invokeHandler=function(e,t){},r.prototype._sendRequest=function(e,t){},r.prototype._onMessage=function(e){},r.prototype._dispatchNotification=function(e){},r.prototype._invokeNotificationHandler=function(e,t,i){},r.prototype._notifySessions=function(e){},r.prototype.unpack=function(e){},r.prototype.searchSymbols=function(e,t,i,s,r,n,o,a,l,c){},r.prototype.serverTimeOffset=function(){},r.prototype.getMarks=function(e,t,i,s,r){},r.prototype.getTimescaleMarks=function(e,t,i,s,r){},s(r,"ChartApiInterface"),e.exports.ChartApiInterface=r},520159:(e,t,i)=>{"use strict";i.r(t),i.d(t,{setCustomAdapter:()=>_,initialize:()=>m,updateUser:()=>g,getChartsCount:()=>f,getCharts:()=>v,removeChart:()=>S,saveChart:()=>y,getChartContent:()=>b,loadChart:()=>w,removeStudyTemplate:()=>P,getStudyTemplateContent:()=>C,saveStudyTemplate:()=>T,getStudyTemplatesList:()=>x,invalidateStudyTemplatesList:()=>I,getStudyTemplateContentById:()=>M,getStandardStudyTemplateContentById:()=>L,removeStudyTemplateById:()=>A,renameStudyTemplate:()=>k,replaceStudyTemplate:()=>E,getDrawingTemplates:()=>D,loadDrawingTemplate:()=>B,removeDrawingTemplate:()=>V,saveDrawingTemplate:()=>R});var s=i(559410),r=i(817808),n=i(448064);const o=(0,r.getLogger)("Chart.SaveloadAdapter.Library");let a,l,c,h,d=null,u=null;function p(e){return`${c}/${encodeURIComponent(h)}/${e}?client=${encodeURIComponent(a)}&user=${encodeURIComponent(l)}`}function _(e){d=e}function m(e,t,i,s){a=e,l=t,c=i,h=s}function g(e){l=e}function f(e,t){throw new Error("Not implemented")}async function v(){const e=e=>e.map((e=>({id:e.id,name:e.name,image_url:String(e.id),modified_iso:e.timestamp,short_symbol:e.symbol,interval:e.resolution})));if(d)return d.getAllCharts().then(e);try{const t=await fetch(`${p("charts")}`,{credentials:"same-origin"});if(!t.ok)throw new Error(`Getting chart content response was not OK. Status: ${t.status}.`);const i=await t.json();if("ok"!==i.status)throw new Error("Get chart content request failed: "+i.message);return e(i.data)}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}async function S(e){if(d)d.removeChart(e);else try{const t=await fetch(`${p("charts")}&chart=${encodeURIComponent(e)}`,{method:"DELETE",credentials:"same-origin"});if(!t.ok)throw new Error(`Remove chart response was not OK. Status: ${t.status}.`);const i=await t.json();if("ok"!==i.status)throw new Error("Remove drawing template request failed: "+i.message)}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}async function y(e,t,i,s,r){var a;const l=r.id.value(),c={name:e,content:JSON.stringify(s),symbol:t,resolution:i};if(d)return d.saveChart({...c,id:l})
;try{const e=new FormData;for(const t in c)e.append(t,c[t]);let t=p("charts");null!=l&&(t+=`&chart=${encodeURIComponent(l)}`);const i=await fetch(t,{credentials:"same-origin",method:"POST",body:e});if(!i.ok)throw new Error(`Saving chart content response was not OK. Status: ${i.status}.`);const s=await i.json();if("ok"!==s.status)throw new Error("Saving chart content request failed: "+s.message);return(null!==(a=s.id)&&void 0!==a?a:l).toString()}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}async function b(e){const t=t=>{const i=JSON.parse(t);return i.uid=e.id,i};if(d)return d.getChartContent(e.id).then((e=>t(e)));try{const i=await fetch(`${p("charts")}&chart=${encodeURIComponent(e.id)}`,{credentials:"same-origin"});if(!i.ok)throw new Error(`Getting chart content response was not OK. Status: ${i.status}.`);const s=await i.json();if("ok"!==s.status)throw new Error("Get chart content request failed: "+s.message);return t(s.data.content)}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}function w(e){b(e).then((e=>{s.emit("chart_load_requested",e)}),(()=>{o.logWarn("Error loading chart")}))}async function P(e){try{if(d)return d.removeStudyTemplate({name:e});const t=await fetch(`${p("study_templates")}&template=${encodeURIComponent(e)}`,{method:"DELETE",credentials:"same-origin"});if(!t.ok)throw new Error(`Remove study template response was not OK. Status: ${t.status}.`);const i=await t.json();if("ok"!==i.status)throw new Error("Remove study template request failed: "+i.message)}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}async function C(e){try{if(d){return{content:await d.getStudyTemplateContent({name:e})}}const t=await fetch(`${p("study_templates")}&template=${encodeURIComponent(e)}`,{credentials:"same-origin"});if(!t.ok)throw new Error(`Get study template response was not OK. Status: ${t.status}.`);const i=await t.json();if("ok"!==i.status)throw new Error("Get study template request failed: "+i.message);return i.data}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}async function T(e){try{if(d)return d.saveStudyTemplate(e).then((()=>({error:""}))).catch((e=>({error:null!=e?(0,n.errorToString)(e):"error"})));const t=new FormData;t.append("name",e.name),t.append("content",e.content);const i=await fetch(p("study_templates"),{method:"POST",body:t,credentials:"same-origin"});if(!i.ok)throw new Error(`Save study template response was not OK. Status: ${i.status}.`);const s=await i.json();return{error:"ok"===s.status?"":s.status}}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}async function x(){try{if(u)return u;u=[];const e=e=>(u=e.map((e=>({is_default:!1,name:e.name}))),u);if(d)return d.getAllStudyTemplates().then(e);const t=await fetch(p("study_templates"),{method:"GET",credentials:"same-origin"});if(!t.ok)throw new Error(`Study templates list response was not OK. Status: ${t.status}.`);const i=await t.json();if("ok"!==i.status)throw new Error("Study templates list request failed: "+i.message);return e(i.data)}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}function I(){u=null}function M(e,t){
throw new Error("Not implemented")}function L(e,t){throw new Error("Not implemented")}function A(e,t){throw new Error("Not implemented")}function k(e,t,i){throw new Error("Not implemented")}function E(e,t,i){throw new Error("Not implemented")}async function D(e){try{if(d)return d.getDrawingTemplates(e);const t=await fetch(`${p("drawing_templates")}&tool=${encodeURIComponent(e)}`,{credentials:"same-origin"});if(!t.ok)throw new Error(`Get drawing templates response was not OK. Status: ${t.status}.`);const i=await t.json();if("ok"!==i.status)throw new Error("Drawing templates request failed: "+i.message);return i.data}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}async function B(e,t){try{if(d)return d.loadDrawingTemplate(e,t).then((e=>JSON.parse(e)));const i=await fetch(`${p("drawing_templates")}&tool=${encodeURIComponent(e)}&name=${encodeURIComponent(t)}`,{credentials:"same-origin"});if(!i.ok)throw new Error(`Load drawing template response was not OK. Status: ${i.status}.`);const s=await i.json();if("ok"!==s.status)throw new Error("Drawing template request failed: "+s.message);return JSON.parse(s.data.content)}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}async function V(e,t){try{if(d)return d.removeDrawingTemplate(e,t);const i=await fetch(`${p("drawing_templates")}&tool=${encodeURIComponent(e)}&name=${encodeURIComponent(t)}`,{method:"DELETE",credentials:"same-origin"});if(!i.ok)throw new Error(`Remove drawing template response was not OK. Status: ${i.status}.`);const s=await i.json();if("ok"!==s.status)throw new Error("Remove drawing template request failed: "+s.message)}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}async function R(e,t,i){try{if(d)return d.saveDrawingTemplate(e,t,i);const s=new FormData;s.append("content",i);const r=await fetch(`${p("drawing_templates")}&tool=${encodeURIComponent(e)}&name=${encodeURIComponent(t)}`,{method:"POST",body:s,credentials:"same-origin"});if(!r.ok)throw new Error(`Save drawing template response was not OK. Status: ${r.status}.`);const n=await r.json();if("ok"!==n.status)throw new Error("Save drawing template request failed: "+n.message)}catch(e){throw o.logWarn((0,n.errorToString)(e)),e}}},343169:(e,t,i)=>{"use strict";var s=i(650151).ensureNotNull,r=i(290728),n=i(638273).Interval,o=i(198217),a=i(360741),l=i(786520).ChartApiInterface,c=i(577027).HandlerInfo,h=i(486028).requireFullInterfaceImplementation,d=i(817808).getLogger("Chart.ChartApiLocal"),u=i(820402).TIMEFRAMETYPE,p=i(85761).createDwmAligner;TradingView.STUDY_COUNT_LIMIT=210;JSServer.ChartApi=function(e){this._notificationHandlers={},this._sessions={},this.studyCounter=0,this._connected=!1,this._enabled=!1,this._studyEngine=new o(e),this._callbacks={},this._serverTimeOffset=0;var t=this;this._studyEngine.on("configuration_received",(function(){t._fireEvent("configuration_received")})),this._studyEngine.on("realtime_tick",(function(e){var i={time:e.value[0]/1e3,open:e.value[1],high:e.value[2],low:e.value[3],close:e.value[4],volume:e.value[5]};t._fireEvent("realtime_tick",i,!0)})),
this._setVisibleRangeTimeout={}},JSServer.ChartApi.prototype.destroy=function(){this._studyEngine.destroy(),this._studyEngine=null},JSServer.ChartApi.prototype.purgeCache=function(e){this._studyEngine.purgeCache(),this._studyEngine.purgeDataCache()},JSServer.ChartApi.prototype.defaultResolutions=function(){return this._studyEngine.supportedResolutions()||["1","3","5","15","30","45","60","120","180","240","1D","1W","1M"]},JSServer.ChartApi.prototype.availableCurrencies=function(){var e=this._studyEngine.supportedCurrencies().map((function(e){return"string"==typeof e?{id:e,code:e}:e}));return Promise.resolve(e)},JSServer.ChartApi.prototype.availableUnits=function(){return Promise.resolve(this._studyEngine.supportedUnits())},JSServer.ChartApi.prototype.availablePriceSources=function(){return Promise.resolve(this._studyEngine.supportedPriceSources())},JSServer.ChartApi.prototype.supportedSymbolsTypes=function(){return this._studyEngine.supportedSymbolsTypes()},JSServer.ChartApi.prototype.symbolsGrouping=function(){return this._studyEngine.symbolsGrouping()},JSServer.ChartApi.prototype.start=function(){this._enabled=!0,this._fireEvent("start_enabled")},JSServer.ChartApi.prototype.unsubscribe=function(e,t){var i=this._callbacks[e];i&&i.splice(i.indexOf(t),1)},JSServer.ChartApi.prototype.on=function(e,t){return this._callbacks.hasOwnProperty(e)||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},JSServer.ChartApi.prototype._fireEvent=function(e,t,i){if(this._callbacks.hasOwnProperty(e)){var s=this._callbacks[e].slice(0);i||(this._callbacks[e]=[]);for(var r=0;r<s.length;++r)s[r](t)}},JSServer.ChartApi.prototype.chartCreateSession=function(e,t){this._studyEngine.chartCreateSession(e)},JSServer.ChartApi.prototype.chartDeleteSession=function(e){this._studyEngine.chartDeleteSession(e)},JSServer.ChartApi.prototype.createSession=function(e,t){TradingView.ChartapiMessagerInstances[e]=new a(this,e),this._sessions[e]=t,this._notificationHandlers[e]={},this.connected()&&t.onMessage({method:"connected",params:[]})},JSServer.ChartApi.prototype.removeSession=function(e){delete this._sessions[e],delete this._notificationHandlers[e],this._studyEngine.stopSources(e)},JSServer.ChartApi.prototype.connected=function(){return this._connected},JSServer.ChartApi.prototype.connect=function(){if(this._enabled)this.connected()||(this._connected=!0,this.sessionid="dummy session id",this._notifySessions({method:"connected",params:[]}));else{var e=this;this.on("start_enabled",(function(){e.connect()}))}},JSServer.ChartApi.prototype.disconnect=function(){this._connected=!1,this._notifySessions({method:"disconnected",params:[]}),this.purgeCache(),this.studyCounter=0},JSServer.ChartApi.prototype.switchTimezone=function(e,t){this._studyEngine.switchTimezone(e,t)},JSServer.ChartApi.prototype.receiveLocalResponse=function(e){this._dispatchNotification(e),this._fireEvent("message_"+e.method,void 0,!0)},JSServer.ChartApi.prototype.getMarks=function(e,t,i,s,r){this._studyEngine.getMarks(e,t,i,s,r)},
JSServer.ChartApi.prototype.getTimescaleMarks=function(e,t,i,s,r){this._studyEngine.getTimescaleMarks(e,t,i,s,r)},JSServer.ChartApi.prototype.resolveSymbol=function(e,t,i,s){this._notificationHandlers[e][t]=new c(s,t),this._studyEngine.resolveSymbol(e,t,i)},JSServer.ChartApi.prototype._doWhenSeriesDataReceived=function(e,t){TradingView.ChartapiMessagerInstances[e].seriesCompleted.subscribe(null,t,!0)},JSServer.ChartApi.prototype.createSeries=function(e,t,i,s,r,n,o,a){var l=this;this._notificationHandlers[e][t]=new c((function(r){"series_completed"===r.method&&null!==o&&(l._applyTimeFrame(e,s,t,i,o),o=null),a(r)}),t);const h={countBack:n||300};null!==o&&o.type===u.TimeRange&&(h.to=1e3*o.to,h.from=1e3*o.from),this._studyEngine.createSeries(e,t,i,s,r,h)},JSServer.ChartApi.prototype.removeSeries=function(e,t){delete this._notificationHandlers[e][t],this._studyEngine.removeSeries(e,t)},JSServer.ChartApi.prototype.setVisibleTimeRange=function(e,t,i,r,n,o,a,l){var c=r,h=!0!==(a=a||{}).applyDefaultRightMargin&&void 0===a.percentRightMargin&&void 0!==n?n:null,d=p(this._studyEngine.getSeriesInterval(e,t),this._studyEngine.getSeriesSymbolInfo(e,t));null!==d&&(c=d.timeToSessionStart(1e3*c)/1e3,null!==h&&(h=d.timeToSessionStart(1e3*h)/1e3));var u=this;function _(){var r=u._studyEngine.sessionTimeScale(e);if(null!==r){var n,d=r.indexOfTime(1e3*c);if(null===h)n=r.lastSessionBarIndex();else{var p=r.indexOfTime(1e3*h);n=p&&p.index}if(null!==d&&null!==n){var _=d.index;if(d.timeMs<1e3*c&&(_+=1),!1===o){const e=s(r.firstSessionBarIndex());_<e&&(_=e)}_>n||(TradingView.ChartapiMessagerInstances[e].onSeriesTimeframeUpdate(t,i,_,n,a),l&&setTimeout(l,0))}}}if(this._studyEngine.isTimeScaleExtendedTo(e,1e3*r))_();else{var m=TradingView.ChartapiMessagerInstances[e].seriesCompleted,g=TradingView.ChartapiMessagerInstances[e].seriesError;void 0!==this._setVisibleRangeTimeout[e]&&clearTimeout(this._setVisibleRangeTimeout[e]),this._setVisibleRangeTimeout[e]=setTimeout(function(){delete this._setVisibleRangeTimeout[e],m.subscribe(null,f,!0),g.subscribe(null,v,!0),this._studyEngine.ensureExtendedTo(t,e,1e3*r)}.bind(this),0)}function f(e,s){e===t&&s===i&&(m.unsubscribe(null,f),g.unsubscribe(null,v),_())}function v(e,s){e===t&&s===i&&m.unsubscribe(null,f)}},JSServer.ChartApi.prototype._applyTimeFrame=function(e,t,i,s,o){var a,l,c={},h=!0;if(o.type===u.PeriodBack){var d=this._studyEngine.getSeriesLastBarTime(e,i);if(null===d)return;l=d/1e3;var _=n.parse(o.value),m=this._studyEngine.getSeriesSymbolInfo(e,i);a=r.alignPeriodsBackForVisibleRange(m.session,m.session_holidays,m.corrections,_.letter(),_.multiplier(),1,d)/1e3;var g=p(this._studyEngine.getSeriesInterval(e,i),m);null!==g&&(l=g.timeToExchangeTradingDay(1e3*l)/1e3,a=g.timeToExchangeTradingDay(1e3*a)/1e3),c={applyDefaultRightMargin:!0},h=!1}else a=o.from,l=o.to;this.setVisibleTimeRange(e,i,s,a,l,h,c)},JSServer.ChartApi.prototype.modifySeries=function(e,t,i,s,r,n,o){var a=this;this._notificationHandlers[e][t]=new c((function(r){"series_completed"===r.method&&null!==n&&(a._applyTimeFrame(e,s,t,i,n),
n=null),o(r)}),t),this._studyEngine.modifySeries(e,t,s,r,i)},JSServer.ChartApi.prototype.requestMoreData=function(e,t){this._studyEngine.extendSeriesRange(e,t)},JSServer.ChartApi.prototype.setStudiesAccessController=function(e){this.studiesAccessController=e},JSServer.ChartApi.prototype.allStudiesMetadata=function(){return this._studyEngine.studiesMetadata()},JSServer.ChartApi.prototype.requestMetadata=function(e,t,i){this._notificationHandlers[e][t]=new c(i,t);var s=this.studiesAccessController.getEnabledTools();TradingView.ChartapiMessagerInstances[e].onRequestMetadata(t,s)},JSServer.ChartApi.prototype.canCreateStudy=function(){return this.studyCounter<TradingView.STUDY_COUNT_LIMIT},JSServer.ChartApi.prototype.createStudy=function(e,t,i,s,r,n,o){if(!this.canCreateStudy())throw new Error("Exceeded the limit of studies");this._notificationHandlers[e][t]=new c(o,t),this._studyEngine.createStudy(e,t,s,i,r,n),this.studyCounter++},JSServer.ChartApi.prototype.rebindStudy=function(e,t,i,s,r,n,o,a){throw new Error("Not implemented")},JSServer.ChartApi.prototype.removeStudy=function(e,t,i){delete this._notificationHandlers[e][t],this._studyEngine.removeStudy(e,t),this.studyCounter--},JSServer.ChartApi.prototype.modifyStudy=function(e,t,i,s,r){this._notificationHandlers[e][t]=new c(r,t),this._studyEngine.modifyStudy(e,t,i,s)},JSServer.ChartApi.prototype.createPointset=function(e,t,i,s,r,n,o){this._notificationHandlers[e][t]=new c(o,t),this._studyEngine.createPointset(e,t,s,r,n)},JSServer.ChartApi.prototype.modifyPointset=function(e,t,i,s,r){throw Error("This call is not implemented")},JSServer.ChartApi.prototype.removePointset=function(e,t,i){this._notificationHandlers[e][t]=null,this._studyEngine.removePointset(e,t)},JSServer.ChartApi.prototype.requestMoreTickmarks=function(e,t){this._studyEngine.requestMoreTickmarks(e,t)},JSServer.ChartApi.prototype.requestFirstBarTime=function(e,t,i,s){this._notificationHandlers[e][t]=new c(s,t)},JSServer.ChartApi.prototype._invokeHandler=function(e,t){e&&e(t)},JSServer.ChartApi.prototype._sendRequest=function(e,t){throw Error("This method is not implemented")},JSServer.ChartApi.prototype._onMessage=function(e){throw Error("This method is not implemented")},JSServer.ChartApi.prototype._dispatchNotification=function(e){var t=e.params.shift();if(this._notificationHandlers[t])switch(e.method){case"timescale_update":var i=e.params[0],s=e.params[1];for(var r in s.clear=0===s.changes.length&&0===s.marks.length,this._sessions[t].onMessage({method:"timescale_update",params:s}),i){var n={method:"data_update",params:{customId:r,plots:i[r].series,nonseries:i[r].nonseries,turnaround:i[r].turnaround}};this._invokeNotificationHandler(t,r,n)}break;case"tickmark_update":this._sessions[t].onMessage({method:"timescale_update",params:e.params[0]});break;case"data_update":for(var r in e.params[0]){var o=e.params[0][r];n={method:"data_update",params:{customId:r,plots:o.series?o.series:o.plots,nonseries:o.nonseries,turnaround:o.turnaround}};this._invokeNotificationHandler(t,r,n)}break;case"index_update":
for(var r in e.params[0]){n={method:"index_update",params:e.params[0][r]};this._invokeNotificationHandler(t,r,n)}break;case"critical_error":d.logNormal(new Date+" critical_error session:"+this.sessionid+" reason:"+e.params[0]),this._sessions[t].onMessage({method:"critical_error",params:e.params});break;case"timescale_completed":case"quote_symbol_data":case"quote_list_fields":case"depth_symbol_error":case"depth_symbol_success":case"dd":case"dpu":case"depth_bar_last_value":this._sessions[t].onMessage({method:e.method,params:e.params});break;case"clear_data":for(var a in e.params[0])this._invokeNotificationHandler(t,a,{method:"clear_data",params:e.params[0][a]});break;default:var l=e.params[0];this._invokeNotificationHandler(t,l,e)}},JSServer.ChartApi.prototype._invokeNotificationHandler=function(e,t,i){if(void 0!==t){var s=this._notificationHandlers[e][t];void 0!==s&&s&&this._invokeHandler(s.handler,i)}},JSServer.ChartApi.prototype.searchSymbols=function(e,t,i,s,r,n,o,a,l,c){this._studyEngine.searchSymbols(e,t,i,c)},JSServer.ChartApi.prototype._notifySessions=function(e){for(var t in this._sessions){if(!this._sessions.hasOwnProperty(t))return;var i=this._sessions[t];"function"==typeof i.onMessage&&i.onMessage(e)}},JSServer.ChartApi.prototype.unpack=function(e){throw Error("This method is not implemented")},JSServer.ChartApi.prototype.quoteCreateSession=function(e){return this._studyEngine.quoteCreateSession(e)},JSServer.ChartApi.prototype.quoteDeleteSession=function(e){return this._studyEngine.quoteDeleteSession(e)},JSServer.ChartApi.prototype.quoteSetFields=function(e,t){return this._studyEngine.quoteSetFields(e,t)},JSServer.ChartApi.prototype.quoteAddSymbols=function(e,t){return-1!==t.indexOf(void 0)&&(console.warn("Got undefined in quoteAddSymbols"),t=t.filter((function(e){return!!e}))),this._studyEngine.quoteAddSymbols(e,t)},JSServer.ChartApi.prototype.quoteRemoveSymbols=function(e,t){return this._studyEngine.quoteRemoveSymbols(e,t)},JSServer.ChartApi.prototype.quoteFastSymbols=function(e,t){return this._studyEngine.quoteFastSymbols(e,t)},JSServer.ChartApi.prototype.quoteHibernateAll=function(e){return this._studyEngine.quoteHibernateAll(e)},JSServer.ChartApi.prototype.depthCreateSession=function(e){return this._studyEngine.depthCreateSession(e)},JSServer.ChartApi.prototype.depthDeleteSession=function(e){return this._studyEngine.depthDeleteSession(e)},JSServer.ChartApi.prototype.depthSetSymbol=function(e,t){return this._studyEngine.depthSetSymbol(e,t)},JSServer.ChartApi.prototype.depthClearSymbol=function(e){},JSServer.ChartApi.prototype.depthSetScale=function(e,t){},JSServer.ChartApi.prototype.createStudiesAccessController=function(e,t,i){return new this.StudiesAccessController(this._studyEngine,e&&JSON.parse(e)||{type:"black",tools:[]})},JSServer.ChartApi.prototype.StudiesAccessController=function(e,t){this._studyEngine=e,this._studiesAccess=t},JSServer.ChartApi.prototype.StudiesAccessController.prototype._findTool=function(e){for(var t=null,i=0;i<this._studiesAccess.tools.length;++i){
var s=this._studiesAccess.tools[i];if(s.name===e||s===e){t=s;break}}return t},JSServer.ChartApi.prototype.StudiesAccessController.prototype.getEnabledTools=function(){return this._studyEngine.studiesMetadata().filter((function(e){return this.isToolEnabled(e.description)||e.is_hidden_study}),this)},JSServer.ChartApi.prototype.StudiesAccessController.prototype.isToolEnabled=function(e){var t=this._findTool(e);return"black"===this._studiesAccess.type?!t||t.grayed:!!t},JSServer.ChartApi.prototype.StudiesAccessController.prototype.isToolGrayed=function(e){var t=this._findTool(e);return t&&t.grayed},JSServer.ChartApi.prototype.serverTimeOffset=function(){return this._studyEngine.serverTimeOffset()},JSServer.ChartApi.prototype.serverTime=function(){return this._studyEngine.serverTime()},JSServer.ChartApi.prototype.disconnectCount=function(){return 0},h(JSServer.ChartApi,"JSServer.ChartApi",l,"ChartApiInterface"),e.exports=JSServer.ChartApi},360741:(e,t,i)=>{"use strict";var s=i(922157),r=function(e,t){this._server=e,this._session=t,this.seriesCompleted=new s,this.seriesError=new s};r.prototype.onRequestMetadata=function(e,t){this._server.receiveLocalResponse({method:"studies_metadata",params:[this._session,e,{errors:[],hash:"",metainfo:t,migrations:[]}]})},r.prototype.onSymbolResolved=function(e,t){this._server.receiveLocalResponse({method:"symbol_resolved",params:[this._session,e,t]})},r.prototype.onSymbolError=function(e,t){this._server.receiveLocalResponse({method:"symbol_error",params:[this._session,e,t]})},r.prototype.onStudyError=function(e,t,i){this._server.receiveLocalResponse({method:"study_error",params:[this._session,e,t,i]})},r.prototype.onSeriesLoading=function(e,t){this._server.receiveLocalResponse({method:"series_loading",params:[this._session,e,t]})},r.prototype.onSeriesCompleted=function(e,t,i){this._server.receiveLocalResponse({method:"series_completed",params:[this._session,e,i,t]}),this.seriesCompleted.fire(e,t)},r.prototype.onSeriesError=function(e,t,i){this._server.receiveLocalResponse({method:"series_error",params:[this._session,e,t,i]}),this.seriesError.fire(e,t)},r.prototype.onStudyCompleted=function(e,t){this._server.receiveLocalResponse({method:"study_completed",params:[this._session,e,t]})},r.prototype.onStudyLoading=function(e,t){this._server.receiveLocalResponse({method:"study_loading",params:[this._session,e,t]})},r.prototype.onTickmarksUpdated=function(e,t){var i={method:"tickmark_update",params:[this._session,{index:e,zoffset:0,changes:[],marks:t,index_diff:[]}]};this._server.receiveLocalResponse(i)},r.prototype.onTimescaleUpdate=function(e,t){var i={method:"timescale_update",params:[this._session,this._prepareDataUpdateObjects(t),{index:e.pointsIndex,zoffset:0,changes:e.points,marks:e.marks,index_diff:e.indexChange,baseIndex:e.baseIndex}]};this._server.receiveLocalResponse(i)},r.prototype.onTimescaleCompleted=function(e){this._server.receiveLocalResponse({method:"timescale_completed",params:[this._session,e]})},r.prototype.onSeriesTimeframeUpdate=function(e,t,i,s,r){var n={
method:"series_timeframe",params:[this._session,e,t,i,s,null,!0,r]};this._server.receiveLocalResponse(n)},r.prototype.onPointsetDataUpdate=function(e,t,i){this.onDataUpdate(e,t,i,null)},r.prototype._prepareDataUpdateObjects=function(e){var t={};return e.forEach((function(e){t[e.objId]={series:e.data,turnaround:e.turnaround},e.nonSeriesData&&(e.nonSeriesData.data?t[e.objId].nonseries={d:JSON.stringify(e.nonSeriesData.data),indexes:e.nonSeriesData.indexes}:t[e.objId].nonseries={d:"",indexes:[]})})),t},r.prototype.onDataUpdate=function(e,t,i,s){var r={method:"data_update",params:[this._session,this._prepareDataUpdateObjects([{objId:e,turnaround:t,data:i,nonSeriesData:s}])]};this._server.receiveLocalResponse(r)},r.prototype.onQuotesData=function(e){this._server.receiveLocalResponse({method:"quote_symbol_data",params:e})},r.prototype.onDepthData=function(e){this._server.receiveLocalResponse({method:"dd",params:e})},r.prototype.onDepthUpdate=function(e){this._server.receiveLocalResponse({method:"dpu",params:e})},r.prototype.onClearData=function(e){this._server.receiveLocalResponse({method:"clear_data",params:[this._session,e]})},TradingView.ChartapiMessagerInstances=[],e.exports=r},935844:(e,t,i)=>{"use strict";i.d(t,{DatafeedRequestsCachedProcessor:()=>_});var s=i(650151),r=i(638273),n=i(624595),o=i(603610),a=i(484727),l=i(290728),c=i(85761),h=i(435818);i(603605);function d(e,t){return e.ticker+(e.currency_code?"_#_"+e.currency_code:"")+(e.unit_id?"_#_"+e.unit_id:"")+(e.subsession_id?"_#_"+e.subsession_id:"")+"_#_"+t}function u(e){return new Date(e).toISOString()}class p{constructor(e,t,i,s,n,o){this._cache={bars:[]},this._nextSubscriptionId=0,this._pendingSubscribers=[],this._subscribers=[],this._requesting=!1,this._leftDate=null,this._nextTime=null,this._realtimeOn=!1,this._endOfData=!1,this._resetCacheTimeout=null,this._errorMessage=null,this._destroyed=!1,this._emptyResponsesCount=0,this._datafeed=e,this._symbolInfo=t,this._interval=r.Interval.parse(i),this._resolution=this._interval.value(),this._dwmAligner=n,this._serverTimeOffsetGetter=s,this._resetCacheTimePeriod=void 0===o?1e4:o,this._sessionSpec=new h.SessionSpec(t.timezone,t.session,t.session_holidays,t.corrections),this._updateDatesFromExpirationDate()}destroy(){0!==this._subscribers.length&&console.warn("Destroying with not-empty state"),this._clearResetCacheTimeout(),this._unsubscribeRealtime(),this._purgeCache(),delete this._datafeed,this._destroyed=!0}addSubscription(e,t,i){const s=this._getNextSubscriptionId();this._pendingSubscribers.push({key:s,range:e,onHistoryCallback:t,onErrorCallback:i}),r.Interval.isDWM(this._resolution)&&void 0!==e.to&&null!==this._dwmAligner&&e.to%864e5&&console.warn(`${this._logMessagePrefix()}Internal error: invalid date for DWM resolution ${u(e.to)}, expected time without a time part`),this._clearResetCacheTimeout();return setTimeout((()=>{this._destroyed||this._processPendingSubscribers()}),0),s}removeSubscription(e){const t=this._pendingSubscribers.find((t=>t.key===e))
;if(t)return void this._pendingSubscribers.splice(this._pendingSubscribers.indexOf(t),1);const i=this._subscribers.find((t=>t.key===e));if(i)return this._subscribers.splice(this._subscribers.indexOf(i),1),void(this._subscribers.length||(this._resetCacheTimeout=setTimeout((()=>{this._resetCacheTimeout=null,this._purgeCache(),this._unsubscribeRealtime()}),this._resetCacheTimePeriod)));console.warn("Unknown subscription symbol={0}, resolution={1}, key={2}".format(this._symbolInfo.name,this._resolution,e))}_logMessage(e,t){(a.enabled("charting_library_debug_mode")||t)&&console.log(`${this._logMessagePrefix()}${e}`)}_logMessagePrefix(){const e=this._symbolInfo.currency_code,t=this._symbolInfo.unit_id;return`FEED [${this._symbolInfo.name}|${this._resolution}${e?"|"+e:""}${t?"|"+t:""}]: `}_clearResetCacheTimeout(){null!==this._resetCacheTimeout&&(clearTimeout(this._resetCacheTimeout),this._resetCacheTimeout=null)}_purgeCache(){this._logMessage("Reset cache"),this._cache={bars:[]},this._errorMessage=null,this._leftDate=null,this._endOfData=!1,this._updateDatesFromExpirationDate()}_updateDatesFromExpirationDate(){void 0!==this._symbolInfo.expiration_date&&(this._nextTime=1e3*this._symbolInfo.expiration_date,this._leftDate=1e3*(this._symbolInfo.expiration_date+1))}_dealignTime(e){return null===this._dwmAligner?e:this._dwmAligner.timeToExchangeTradingDay(e)}_normalizeRange(e){const t=void 0!==e.to?e.to:this._dealignTime(this._now());if(0===this._cache.bars.length||void 0!==e.to&&t<=(0,s.ensureNotNull)(this._leftDate))return{countBack:e.countBack,to:t};const i=null!==this._dwmAligner?this._dwmAligner.timeToSessionStart(t):t,r=(0,n.lowerbound)(this._cache.bars,i,((e,t)=>e.time<t));return e.countBack<r?{countBack:0,to:0!==e.countBack&&r<=this._cache.bars.length?this._dealignTime(this._cache.bars[r-e.countBack].time):t}:{countBack:e.countBack-r,to:this._dealignTime(this._cache.bars[0].time)}}_processPendingSubscribers(){const e=this._pendingSubscribers;if(!e.length)return;if(this._requesting)return void this._logMessage("Processing is skipped due active request");if(this._logMessage(`Processing pending subscribers, count=${e.length}`),this._errorMessage){const t=this._errorMessage;return this._logMessage(`Return error: ${t}`),this._pendingSubscribers=[],void e.forEach((e=>{e.onErrorCallback(t)}))}let t=this._normalizeRange(e[0].range);for(const i of e.map((e=>this._normalizeRange(e.range))))(i.to<t.to||i.to===t.to&&i.countBack>t.countBack)&&(t=i);this._logMessage(`Leftmost subscriber requires ${t.countBack} bars prior ${u(t.to)}`);!(null===this._leftDate||t.to<this._leftDate&&(null===this._nextTime||t.to<this._nextTime)||0!==t.countBack)||this._endOfData?(this._pendingSubscribers=[],e.forEach((e=>{const t=this._moveSubscriberToRealtime(e);this._returnHistoryDataToSubscriber(e,t)})),this._subscribeRealtimeIfNeeded()):this._ensureRequestedTo(t)}_moveSubscriberToRealtime(e){const t={key:e.key,onHistoryCallback:e.onHistoryCallback,barset:null};return this._subscribers.push(t),t}_isSymbolExpired(){
return this._symbolInfo.expired||void 0!==this._symbolInfo.expiration_date}_subscribeRealtimeIfNeeded(){!this._subscribers.length||this._realtimeOn||this._isSymbolExpired()||this._subscribeRealtime()}_subscribeRealtime(){if(this._symbolInfo.expired||this._realtimeOn)return;this._realtimeOn=!0,this._datafeed.subscribeBars(this._symbolInfo,this._resolution,(e=>{null!==this._dwmAligner&&(e.time=this._dwmAligner.timeToSessionStart(e.time)),this._putToCacheNewBar(e),this._subscribers.forEach((t=>{const i=t.barset;if(null===i)throw new Error("subscriber.barset is null");i.add(e),t.onHistoryCallback(i)}))}),d(this._symbolInfo,this._resolution),(()=>{this._unsubscribeRealtime();const e=this._leftDate;this._purgeCache(),null!==e&&this._ensureRequestedTo({to:e,countBack:0})})),this._logMessage("Subscribed to realtime")}_unsubscribeRealtime(){!this._isSymbolExpired()&&this._realtimeOn&&(this._datafeed.unsubscribeBars(d(this._symbolInfo,this._resolution)),this._logMessage("Unsubscribed from realtime"),this._realtimeOn=!1)}_returnHistoryDataToSubscriber(e,t){const i=this._normalizeRange(e.range),s=this._createBarsetForRange(i);s.count()>0?this._logMessage("Bars to return for request {0}: total {1} bars in [{2} ... {3}] ".format(e.key,s.count(),u(s.bars[0].time),u(s.bars[s.count()-1].time))):this._logMessage("Request {0}. Nothing to return.".format(e.key)),t.barset=s,this._endOfData&&null!==this._leftDate&&i.to<=this._leftDate&&(s.endOfData=!0),e.onHistoryCallback(s)}_createBarsetForRange(e){const t=null!==this._dwmAligner?this._dwmAligner.timeToSessionStart(e.to):e.to,i=(0,n.lowerbound)(this._cache.bars,t,((e,t)=>e.time<t)),r=new o.BarSet(this._symbolInfo,this._cache.bars.slice(Math.max(0,i-e.countBack)));return 0!==r.bars.length?r.firstLoadedTimeMs=this._dealignTime(r.bars[0].time):0!==this._cache.bars.length?r.firstLoadedTimeMs=this._dealignTime(this._cache.bars[this._cache.bars.length-1].time):r.firstLoadedTimeMs=this._dealignTime((0,s.ensureNotNull)(this._leftDate)),r}_ensureRequestedTo(e){var t;let i;if(this._requesting&&this._logMessage("Internal error: trying to call getBars while the previous request is active",!0),null!==this._leftDate)i=this._leftDate;else{const e=this._now();if(null===this._dwmAligner)i=e;else{let t=this._sessionSpec.alignToNearestSessionStart(new Date(e),1).getTime();if(t<e){const e=this._sessionSpec.alignToNearestSessionEnd(new Date(t),1).getTime();t=this._sessionSpec.alignToNearestSessionStart(new Date(e+1e3),1).getTime()}i=this._dealignTime(t)}}const s=(0,l.alignPeriodsBackForDataRequest)(this._symbolInfo.session,this._symbolInfo.session_holidays,this._symbolInfo.corrections,this._interval.letter(),this._interval.multiplier(),e.countBack,Math.min(e.to,i,null!==(t=this._nextTime)&&void 0!==t?t:1/0));let r=e.countBack;if(e.to<i&&(r+=(0,l.getPeriodsBetweenDates)(this._symbolInfo.session,this._symbolInfo.session_holidays,this._symbolInfo.corrections,this._interval.letter(),this._interval.multiplier(),e.to,i)),null!==this._leftDate&&this._leftDate<s)return void this._processPendingSubscribers()
;const n=this._isSymbolExpired()?0===this._cache.bars.length:null===this._leftDate;this._requesting=!0,this._nextTime=null,this._leftDate=s;const o=`[${u(s)} ... ${u(i)}, ${r} bars]`;this._logMessage(`Requesting data: ${o}`);let a=!1;const c=s/1e3,h=i/1e3;this._datafeed.getBars(this._symbolInfo,this._resolution,{from:this._interval.isTicks()?c:Math.floor(c),to:this._interval.isTicks()?h:Math.floor(h),countBack:r,firstDataRequest:n},((e,t)=>{if(!this._destroyed)if(a)this._logMessage("getBars callback is already called before",!0);else{if(a=!0,e.length>0){const t=` [${u(e[0].time)} ... ${u(e[e.length-1].time)}]`;this._logMessage(`Receiving bars: total ${e.length} bars in ${t}, requested range: ${o}`)}else this._logMessage(`Receiving bars: barset is empty, requested range: ${o}`);this._requesting=!1,this._processBars(e,t)}}),(e=>{this._destroyed||(a?this._logMessage("getBars callback is already called before",!0):(a=!0,this._requesting=!1,this._errorMessage=e||null,this._processPendingSubscribers()))}))}_processBars(e,t){this._checkBars(e),this._alignBarsTime(e),e.length>0?(this._emptyResponsesCount=0,this._processFullBarset(e,t)):(this._emptyResponsesCount+=1,this._processEmptyBarset(t)),this._processPendingSubscribers()}_processEmptyBarset(e){e&&e.nextTime?(this._logMessage("Next time received: `{0}`".format(u(1e3*e.nextTime))),this._nextTime=1e3*e.nextTime):e&&e.noData?(this._logMessage("EOD received"),this._setEndOfData()):this._logMessage("nextTime or noData should present in metainfo when empty barset is returned"),50===this._emptyResponsesCount&&(this._logMessage("EOD detected due 50 empty responses in a row"),this._setEndOfData())}_setEndOfData(){this._endOfData=!0,this._cache.bars.length&&(this._leftDate=this._dealignTime(this._cache.bars[0].time))}_processFullBarset(e,t){this._putToCache(e)?null!==this._leftDate&&0!==this._cache.bars.length&&(this._interval.isTicks()?this._leftDate=this._dealignTime(this._cache.bars[0].time):this._leftDate=Math.min(this._leftDate,this._dealignTime(this._cache.bars[0].time))):this._logMessage("Incremental update failed. Starting full update. Returned data should be in the requested range.",!0),t&&t.nextTime?console.warn(`${this._logMessagePrefix()}nextTime should be set when there is no data in the requested period only`):t&&t.noData&&console.warn(`${this._logMessagePrefix()}noData should be set when there is no data in the requested period and earlier only`)}_getNextSubscriptionId(){return this._nextSubscriptionId++}_checkBars(e,t=!1){if(a.enabled("charting_library_debug_mode"))for(let i=1;i<e.length;i++){if(e[i].time<=e[i-1].time){let s=`${this._logMessagePrefix()}Wrong bars time: time ${e[i].time} of bar ${i} should be more than time ${e[i-1].time} of bar ${i-1}`;t&&null!==this._dwmAligner&&(s+="\nCheck that you provide DWM bars without time part, i.e. 00:00 GMT"),console.error(s)}["high","low","open","close","time"].some((t=>"number"!=typeof e[i][t]||!isFinite(e[i][t])))&&console.error(`${this._logMessagePrefix()}Wrong bars values: all OHLC values should be numbers`)}}
_putToCache(e){if(0===e.length)return!0;if(this._cache.bars.length===e.length&&this._cache.bars[0].time===e[0].time&&this._cache.bars[this._cache.bars.length-1].time===e[e.length-1].time)return this._logMessage("Time range of received data is the same as cached one. Skip the update."),!0;if(0!==this._cache.bars.length&&e[e.length-1].time===this._cache.bars[0].time&&this._cache.bars.splice(0,1),0!==this._cache.bars.length&&e[e.length-1].time>=this._cache.bars[0].time){const t=this._cache.bars[this._cache.bars.length-1].time===e[e.length-1].time;if(this._cache.bars=[],!t)return this._leftDate=null,!1;this._logMessage("Received history up to now instead of incremental update. Return exactly what is requested.")}return this._cache.bars=[...e,...this._cache.bars],this._checkBars(this._cache.bars,!0),!0}_putToCacheNewBar(e){const t=this._cache.bars.length,i=e.time,s=0===t?NaN:this._cache.bars[t-1].time;0===t||s<i?this._cache.bars.push(e):s===i?(this._interval.isTicks()&&this._logMessage("Received update for the last tick bar"),this._cache.bars[t-1]=e):console.error(`${this._logMessagePrefix()}putToCacheNewBar: time violation, previous bar time: `+u(s)+" should be less or equal to new time: "+u(i))}_alignBarsTime(e){if(this._dwmAligner)for(const t of e)t.time=this._dwmAligner.timeToSessionStart(t.time)}_now(){return Date.now()+1e3*this._serverTimeOffsetGetter()+6e4}}class _{constructor(e,t,i){this._threads={},this._datafeed=e,this._serverTimeOffsetGetter=t,this._resetCacheTimePeriod=i}destroy(){this._forEachThread(((e,t)=>t.destroy())),this._threads={},delete this._datafeed}purgeCache(){this._forEachThread(((e,t)=>t.destroy())),this._threads={}}subscribe(e,t,i,s,r){const n=d(e,t);this._threads[n]||(this._threads[n]=this._createThread(e,t));return n+'"'+this._threads[n].addSubscription(i,s,r)}unsubscribe(e){const t=e.split('"');if(2!==t.length)return void console.warn("Wrong guid format");const i=t[0],s=parseInt(t[1]);this._threads.hasOwnProperty(i)?this._threads[i].removeSubscription(s):console.warn("Data thread doesnt exist: "+e)}_createThread(e,t){return new p(this._datafeed,e,t,this._serverTimeOffsetGetter,(0,c.createDwmAligner)(t,e),this._resetCacheTimePeriod)}_forEachThread(e){Object.keys(this._threads).forEach((t=>e(t,this._threads[t])))}}},802737:(e,t,i)=>{"use strict";i.d(t,{barTimeToEndOfPeriod:()=>r,endOfPeriodToBarTime:()=>n});var s=i(467978);function r(e,t,i){if(i.isDays())return t;if(e.moveTo(1e3*t),i.isIntraday()){const i=e.indexOfBar(1e3*t);if(i<0)throw new Error(`${t} is out of the instrument session `);return e.endOfBar(i)/1e3}return e.startOfBar(s.SessionStage.LASTBAR_SESSION)/1e3}function n(e,t,i){if(i.isDays())return t;const s=1e3*t-1;if(e.moveTo(s),i.isIntraday()){const i=e.indexOfBar(s);if(i<0)throw new Error(`${t} is out of the instrument session `);return e.startOfBar(i)/1e3}return t=e.startOfBar(0)/1e3}},975234:(e,t,i)=>{"use strict";i.d(t,{replaceGraphicsTimesWithTimePointIndexIndex:()=>n})
;const s=new Map([["horizlines",e=>[e.startIndex,e.endIndex]],["hhists",e=>[e.firstBarTime,e.firstBarTime]],["vertlines",e=>[e.index]],["polygons",e=>e.points.map((e=>e.index))],["horizlines",e=>[e.startIndex,e.endIndex]],["hhists",e=>[e.firstBarTime,e.firstBarTime]],["vertlines",e=>[e.index]],["polygons",e=>e.points.map((e=>e.index))],["backgrounds",e=>[e.start,e.stop]]]),r=new Map([["horizlines",(e,t)=>{const i=e;i.startIndex=t.get(i.startIndex),i.endIndex=t.get(i.endIndex)}],["hhists",(e,t)=>{const i=e;i.firstBarTime=t.get(i.firstBarTime),i.lastBarTime=t.get(i.lastBarTime)}],["vertlines",(e,t)=>{const i=e;i.index=t.get(i.index)}],["polygons",(e,t)=>{const i=e;for(const e of i.points)e.index=t.get(e.index)}],["backgrounds",(e,t)=>{const i=e;i.start=t.get(i.start),i.stop=t.get(i.stop)}]]);function n(e){const t=e.data&&e.data.graphicsCmds&&e.data.graphicsCmds.create;if(!t)return[];const i=new Map,n=new Set;s.forEach(((e,s)=>{const r=t[s];if(r)for(const t of r)for(const s of t.data){const t=e(s);for(const e of t)i.set(e,-1),n.add(e)}}));const o=Array.from(n).sort(((e,t)=>e-t));return o.forEach(((e,t)=>i.set(e,t))),r.forEach(((e,s)=>{const r=t[s];if(r)for(const t of r)for(const s of t.data)e(s,i)})),o}},904122:(e,t,i)=>{"use strict";var s=i(484727);window.onload=function(){location.hostname.indexOf(".")>=0&&!function(){try{return/^(192|172|10)\.[0-9][0-9][0-9]\.[0-9][0-9][0-9]\.[0-9][0-9][0-9]/.test(location.hostname)||/^.*((?:\.local)|localhost)$/.test(location.hostname)}catch(e){return!1}}()&&setTimeout((function(){try{var e=function(){var e=0;return JSON.parse(urlParams.logo).image&&(e="C",s.enabled("link_to_tradingview")||(e="D")),e}();window.ga&&(0!==e&&window.ga("send","event","s",e),urlParams.utm||window.ga("send","event","l"))}catch(e){}}),3e4)}},905417:(e,t,i)=>{"use strict";var s=i(290728),r={};e.exports=function(e,t,i){var n,o,a={},l=r[i]||"out_of_session",c=!1,h=i,d=t,u=null;function p(){var e={};e.symbolname=h,e.status="ok",e.values={},e.values.current_session=l,r[h]=l,TradingView.ChartapiMessagerInstances[d].onQuotesData([d].concat([e]))}function _(){if(n)if(o)l="out_of_session";else{var e=s.isTradingNow((new Date).getTime(),n)?"market":"out_of_session";e!==l&&(l=e,p())}}return e(i,null,(function(e){c||function(e){n=new s.SessionInfo(e.timezone,e.session,e.session_holidays,e.corrections),o=e.expired,u=setInterval(_,6e4),_(),p()}(e)}),(function(){})),a.stop=function(){c=!0,u&&clearInterval(u)},a.marketStatus=function(){return l},a}},772483:(e,t,i)=>{"use strict";i.d(t,{getChartStyleStudy:()=>m});var s=i(603610);class r{main(e){const t=e.new_var(s.Std.open(e)),i=e.new_var(s.Std.close(e)),r=t.get(1),n=i.get(1),o=s.Std.ohlc4(e),a=s.Std.na(t.get(1))?(s.Std.open(e)+s.Std.close(e))/2:(r+n)/2;t.set(a),i.set(o);const l=s.Std.max(s.Std.high(e),s.Std.max(a,o)),c=s.Std.min(s.Std.low(e),s.Std.min(a,o)),h=s.Std.volume(e),d=e.symbol;return[d.time,a,l,c,o,h,d.updatetime,d.isBarClosed]}}class n{constructor(){this.bar=null}set(e,t){this.commit(e),this.bar=t,this._lastTime=t[0]}commit(e){
return!!this.bar&&(e.bars.push(this.bar),this.bar=null,!0)}update(e){e.unshift(this._lastTime),this.bar=e}}const o={};function a(e,t,i,s){const r=t+i+e;return{get:()=>{if(!o[r]){const e=s.get();if(isNaN(e))return NaN;o[r]=e}return o[r]},set:()=>{throw new Error("Not implemented")},indexOf:e=>{throw new Error("Not implemented")}}}class l{constructor(e){this._source="close",this._isCurrentKagiBarIncreases=null,this._bar=new n,this._style=e.style,this._atrLength=e.atrLength,this._reversalAmount=e.reversalAmount,this._isATR="ATR"===this._style,this._atrCalculated=!1,this._inited=!1}init(){}main(e){this._atr=this._isATR?a("atr"+this._atrLength,e.symbol.tickerid,e.symbol.resolution,e.new_var(s.Std.atr(this._atrLength,e))):null;const t=s.Std[this._source](e),i=s.Std.volume(e),r=s.Std.time(e),n=e.symbol,o={bars:[]};if(this._isATR&&!this._atrCalculated&&this._atr){const e=this._atr.get();if(s.Std.na(e))return o;this._reversalAmount=e}if(!this._inited&&!s.Std.na(r)&&(this._kagiPriceExtremum=t,this._kagiOpenPrice=t,this._prevKagiTime=r,this._kagiVolume=i,this._inited=!0,!this._isATR))return{bars:[],nonseries:!0,price:t,reversalAmount:this._reversalAmount,type:"projection"};if(n.isBarClosed){if(this._kagiVolume+=i,null===this._isCurrentKagiBarIncreases){if(this._kagiPriceExtremum===t)return o;this._isCurrentKagiBarIncreases=s.Std.greater(t,this._kagiPriceExtremum),this._isKagiLineBold=this._isCurrentKagiBarIncreases,this._isPrevKagiLineBold=this._isKagiLineBold,this._kagiPrevOpenPrice=this._kagiOpenPrice,this._bar.set(o,[this._prevKagiTime,this._kagiOpenPrice,this._isCurrentKagiBarIncreases?this._kagiPriceExtremum:this._kagiOpenPrice,this._isCurrentKagiBarIncreases?this._kagiOpenPrice:this._kagiPriceExtremum,this._kagiPriceExtremum,this._kagiVolume,this._isCurrentKagiBarIncreases?this._kagiPriceExtremum:this._kagiOpenPrice])}const e=this._isCurrentKagiBarIncreases?1:-1;if(s.Std.greater((t-this._kagiPriceExtremum)*e,0)){this._kagiPriceExtremum=t;const e=this._isCurrentKagiBarIncreases?this._kagiPriceExtremum:this._kagiOpenPrice,i=this._isCurrentKagiBarIncreases?this._kagiOpenPrice:this._kagiPriceExtremum;let r=0;this._isPrevKagiLineBold!==this._isCurrentKagiBarIncreases&&s.Std.greater(this._kagiPrevOpenPrice,i)&&s.Std.less(this._kagiPrevOpenPrice,e)?(r=this._kagiPrevOpenPrice,this._isKagiLineBold=this._isCurrentKagiBarIncreases):r=this._isKagiLineBold?i:e,this._bar.update([this._kagiOpenPrice,e,i,this._kagiPriceExtremum,this._kagiVolume,r])}else if(s.Std.greaterOrEqual(e*(this._kagiPriceExtremum-t),this._reversalAmount)){this._kagiPrevOpenPrice=this._kagiOpenPrice,this._kagiOpenPrice=this._kagiPriceExtremum,this._kagiPriceExtremum=t,this._isCurrentKagiBarIncreases=!this._isCurrentKagiBarIncreases,this._prevKagiTime=r,this._kagiVolume=i,this._isPrevKagiLineBold=this._isKagiLineBold;const e=this._isCurrentKagiBarIncreases?this._kagiPriceExtremum:this._kagiOpenPrice,n=this._isCurrentKagiBarIncreases?this._kagiOpenPrice:this._kagiPriceExtremum;let a=0
;this._isPrevKagiLineBold!==this._isCurrentKagiBarIncreases&&s.Std.greater(this._kagiPrevOpenPrice,n)&&s.Std.less(this._kagiPrevOpenPrice,e)?(a=this._kagiPrevOpenPrice,this._isKagiLineBold=this._isCurrentKagiBarIncreases):a=this._isKagiLineBold?n:e,this._bar.set(o,[this._prevKagiTime,this._kagiOpenPrice,e,n,this._kagiPriceExtremum,this._kagiVolume,a])}}if(n.isLastBar){if(this._bar.commit(o))return o;const e={bars:[],nonseries:!0,price:t,reversalAmount:this._reversalAmount,type:"projection"};if(null===this._isCurrentKagiBarIncreases)return e;const i=this._isCurrentKagiBarIncreases?1:-1;if(s.Std.greaterOrEqual(i*(this._kagiPriceExtremum-t),this._reversalAmount)){const i=this._isCurrentKagiBarIncreases?this._kagiPriceExtremum:t,r=this._isCurrentKagiBarIncreases?t:this._kagiPriceExtremum;let n=0;n=this._isKagiLineBold===this._isCurrentKagiBarIncreases&&s.Std.greater(this._kagiOpenPrice,r)&&s.Std.less(this._kagiOpenPrice,i)?this._kagiOpenPrice:this._isKagiLineBold?r:i,e.bars.push([0,this._kagiPriceExtremum,i,r,t,0,n])}else if(s.Std.greater(i*(t-this._kagiPriceExtremum),0)){const i=this._isCurrentKagiBarIncreases?t:this._kagiPriceExtremum,r=this._isCurrentKagiBarIncreases?this._kagiPriceExtremum:t;let n=0;n=this._isKagiLineBold!==this._isCurrentKagiBarIncreases&&s.Std.greater(this._kagiPrevOpenPrice,r)&&s.Std.less(this._kagiPrevOpenPrice,i)?this._kagiPrevOpenPrice:this._isKagiLineBold?r:i,e.bars.push([-1,this._kagiPriceExtremum,i,r,t,0,n])}return e}return o}}class c{constructor(e,t,i){this._isInitialized=!1,this._boxSize=e,this._atr=t,this._minTick=i}size(){return this._boxSize}isInitialized(){return this._isInitialized}init(){if(null!==this._atr){if(this._boxSize=this._atr.get(),isNaN(this._boxSize))return!1;this._boxSize=Math.round(this._boxSize/this._minTick)*this._minTick}return this._boxSize=Math.max(this._boxSize,this._minTick),this._isInitialized=!0,!0}}class h{constructor(e){this._source="close",this._prevHighLastRenko=NaN,this._prevLowLastRenko=NaN,this._renkoVolume=0,this._inputs=e}init(){this._style=this._inputs.style,this._boxSize=this._inputs.boxSize,this._atrLength=this._inputs.atrLength,this._isATR="ATR"===this._style.toUpperCase()}main(e){this._atr=this._isATR?a("atr"+this._atrLength,e.symbol.tickerid,e.symbol.resolution,e.new_var(s.Std.atr(this._atrLength,e))):null,this._box||(this._box=new c(this._boxSize,this._atr,e.symbol.minTick));const t=s.Std[this._source](e),i=s.Std.volume(e),r=e.symbol;if(!this._box.isInitialized()){if(!isNaN(t)&&this._box.init()){this._boxSize=this._box.size();const e=Math.floor(t/this._boxSize)*this._boxSize;return this._prevHighLastRenko=e,this._prevLowLastRenko=e,this._renkoVolume=e,{bars:[],boxSize:this._boxSize,nonseries:!0,price:t,type:"projection"}}return null}return r.isBarClosed?this._calcConfirmed(t,i,r.time):this._calcProjection(t,r.time)}_calcConfirmed(e,t,i){if(this._renkoVolume+=t,s.Std.greaterOrEqual(e-this._prevHighLastRenko,this._boxSize)||s.Std.greaterOrEqual(this._prevLowLastRenko-e,this._boxSize)){let t=0
;const r=s.Std.greater(e,this._prevHighLastRenko)?1:-1,n=1===r?this._prevHighLastRenko:this._prevLowLastRenko,o={bars:[]},a=Math.round((e-n)*r/this._boxSize);if(0===a||a!==Math.round((e-n)*r/this._boxSize))throw new Error("Wrong count of renko bars");let l;for(l=n;s.Std.greaterOrEqual((e-l)*r,this._boxSize);l+=r*this._boxSize){const e=1===r?l+this._boxSize:l,s=1===r?l:l-this._boxSize;o.bars.push([i+t,l,e,s,l+r*this._boxSize,this._renkoVolume/a]),t++}return this._prevHighLastRenko=l+(1===r?0:this._boxSize),this._prevLowLastRenko=l-(1===r?this._boxSize:0),this._renkoVolume=0,o}return null}_calcProjection(e,t){const i={bars:[],boxSize:this._boxSize,nonseries:!0,price:e,type:"projection"};if(isNaN(this._prevLowLastRenko)||isNaN(this._prevHighLastRenko))return i;if(s.Std.greaterOrEqual(e,this._prevLowLastRenko)&&s.Std.lessOrEqual(e,this._prevHighLastRenko))return i;let r=0;const n=s.Std.greater(e,this._prevHighLastRenko)?1:-1;let o;for(o=1===n?this._prevHighLastRenko:this._prevLowLastRenko;s.Std.greaterOrEqual((e-o)*n,this._boxSize);o+=n*this._boxSize){const e=1===n?o+this._boxSize:o,t=1===n?o:o-this._boxSize;i.bars.push([r,o,e,t,o+n*this._boxSize,0]),r++}if(!s.Std.equal(o,e)){const t=1===n?e:o,s=1===n?o:e;i.bars.push([r,o,t,s,e,0])}return i}}var d=i(650151);class u{constructor(e){this._data=[],this._counter=-1,this._data.length=e,this._data.fill(0,0,e)}add(e){this._counter++,this._counter===2*this._data.length&&(this._counter=this._data.length),this._data[this._counter%this._data.length]=e}getLast(){return(0,d.assert)(!this.isEmpty(),"Should not be empty"),this._data[this._counter%this._data.length]}isEmpty(){return 0===this.size()}size(){return Math.min(this._data.length,this._counter+1)}min(){(0,d.assert)(!this.isEmpty(),"Should not be empty");let e=this._data[0];for(let t=1;t<this.size();t++)e=Math.min(e,this._data[t]);return e}max(){(0,d.assert)(!this.isEmpty(),"Should not be empty");let e=this._data[0];const t=this.size();for(let i=1;i<t;i++)e=Math.max(e,this._data[i]);return e}}class p{constructor(e){this._source="close",this._volume=0,this._inited=!1,this._inputs=e}init(){this._numberOfLines=this._inputs.lb||3,this._highLastBars=new u(this._numberOfLines),this._lowLastBars=new u(this._numberOfLines)}main(e){const t=s.Std[this._source](e);if(isNaN(t))return null;if(!this._inited&&!isNaN(t))return this._volume=s.Std.volume(e),this._highLastBars.add(t),this._lowLastBars.add(t),this._inited=!0,null;const i=e.symbol;if(i.isBarClosed){const i={bars:[]};if(this._volume+=s.Std.volume(e),s.Std.greater(t,this._highLastBars.max())||s.Std.less(t,this._lowLastBars.min())){const r=s.Std.greater(t,this._highLastBars.max()),n=r?this._highLastBars.getLast():this._lowLastBars.getLast(),o=r?t:n,a=r?n:t,l=this._volume;return this._highLastBars.add(o),this._lowLastBars.add(a),this._volume=0,i.bars.push([s.Std.time(e),n,o,a,t,l]),i}}if(i.isLastBar){const e={bars:[],nonseries:!0,price:t,type:"projection"},i=s.Std.greater(t,this._highLastBars.getLast()),r=s.Std.less(t,this._lowLastBars.getLast());if(i||r){
const s=i?this._highLastBars.getLast():this._lowLastBars.getLast();e.bars.push([0,s,i?t:s,i?s:t,t,0])}return e}return null}}class _{constructor(e){this._bar=new n,this._isCurrentBarIncreasing=null,this._priceExtremum=NaN,this._pnfOpenPrice=NaN,this._pnfHighPrice=NaN,this._pnfLowPrice=NaN,this._volumePnF=0,this._prevPnFTime=null;const t=e.sources,i=e.style;switch(this._boxSize=e.boxSize,this._atrLength=e.atrLength,this._reversalAmount=e.reversalAmount,t){case"HL":this._sourceHigh=s.Std.high,this._sourceLow=s.Std.low;break;case"Close":this._sourceHigh=s.Std.close,this._sourceLow=s.Std.close}this._isATR="ATR"===i}init(){}main(e){this._seriesATR=this._isATR?a("atr"+this._atrLength,e.symbol.tickerid,e.symbol.resolution,e.new_var(s.Std.atr(this._atrLength,e))):null,this._box||(this._box=new c(this._boxSize,this._seriesATR,e.symbol.minTick));const t=this._sourceHigh,i=this._sourceLow,r=t(e),n=i(e),o=s.Std.open(e),l=s.Std.volume(e),h=e.symbol,d={bars:[]};if(!this._box.isInitialized())return!isNaN(o)&&this._box.init()?(this._boxSize=this._box.size(),this._prevPnFTime=h.time,this._pnfHighPrice=this._granulate(o),this._pnfLowPrice=this._granulate(o),this._volumePnF=0,{bars:[],boxSize:this._boxSize,nonseries:!0,price:o,type:"projection"}):null;if(h.isBarClosed){if(this._volumePnF+=l,null===this._isCurrentBarIncreasing)return this._isCurrentBarIncreasing=this._directionFinding(r,n),null!==this._isCurrentBarIncreasing&&(this._priceExtremum=this._isCurrentBarIncreasing?this._pnfHighPrice:this._pnfLowPrice,this._pnfOpenPrice=this._isCurrentBarIncreasing?this._pnfLowPrice:this._pnfHighPrice,this._bar.set(d,[this._prevPnFTime||0,this._pnfOpenPrice,this._pnfHighPrice,this._pnfLowPrice,this._priceExtremum,this._volumePnF,this._isCurrentBarIncreasing?1:-1])),null;const e=this._isCurrentBarIncreasing?r:n,t=this._isCurrentBarIncreasing?n:r,i=this._isCurrentBarIncreasing?1:-1;let o=(e-this._priceExtremum)*i;if(s.Std.greaterOrEqual(o,this._boxSize)){this._priceExtremum+=i*this._granulate(o);const e=this._isCurrentBarIncreasing?this._priceExtremum:this._pnfOpenPrice,t=this._isCurrentBarIncreasing?this._pnfOpenPrice:this._priceExtremum;this._bar.update([this._pnfOpenPrice,e,t,this._priceExtremum,this._volumePnF,i])}else if(s.Std.greaterOrEqual((this._priceExtremum-t)*i,this._reversalAmount*this._boxSize)){o=(this._priceExtremum-t)*i,this._isCurrentBarIncreasing=!this._isCurrentBarIncreasing,this._pnfOpenPrice=this._priceExtremum-this._boxSize*i,this._priceExtremum-=i*this._granulate(o),this._prevPnFTime=h.time,this._volumePnF=l;const e=this._isCurrentBarIncreasing?this._priceExtremum:this._pnfOpenPrice,s=this._isCurrentBarIncreasing?this._pnfOpenPrice:this._priceExtremum;this._bar.set(d,[this._prevPnFTime,this._pnfOpenPrice,e,s,this._priceExtremum,this._volumePnF,-i])}}if(h.isLastBar){if(this._bar.commit(d))return d;if(null===this._isCurrentBarIncreasing)return null;const e={bars:[],boxSize:this._boxSize,nonseries:!0,price:this._isCurrentBarIncreasing?r:n,type:"projection"};if(h.isBarClosed)return e
;const t=this._isCurrentBarIncreasing?r:n,i=this._isCurrentBarIncreasing?n:r,o=this._isCurrentBarIncreasing?1:-1;let a=(t-this._priceExtremum)*o;return s.Std.greaterOrEqual(a,this._boxSize)?e.bars.push([-1,this._priceExtremum+this._boxSize*o,this._isCurrentBarIncreasing?this._priceExtremum+o*this._granulate(a):this._priceExtremum+this._boxSize*o,this._isCurrentBarIncreasing?this._priceExtremum+this._boxSize*o:this._priceExtremum+o*this._granulate(a),this._priceExtremum+o*this._granulate(a),0,o]):s.Std.greaterOrEqual((this._priceExtremum-i)*o,this._reversalAmount*this._boxSize)&&(a=(this._priceExtremum-i)*o,e.bars.push([0,this._priceExtremum-this._boxSize*o,this._isCurrentBarIncreasing?this._priceExtremum-this._boxSize*o:this._priceExtremum-o*this._granulate(a),this._isCurrentBarIncreasing?this._priceExtremum-o*this._granulate(a):this._priceExtremum-this._boxSize*o,this._priceExtremum-o*this._granulate(a),0,-1*o])),e}return d}_directionFinding(e,t){let i=e-this._pnfHighPrice;return!(!s.Std.greaterOrEqual(i,this._boxSize)||(this._pnfHighPrice+=this._granulate(i),!s.Std.greater(t,this._pnfLowPrice)))||(i=this._pnfLowPrice-t,(!s.Std.greaterOrEqual(i,this._boxSize)||(this._pnfLowPrice-=this._granulate(i),!s.Std.less(e,this._pnfHighPrice)))&&null)}_granulate(e){return Math.floor(e/this._boxSize+1e-5)*this._boxSize}}function m(e){if(0===e.type.indexOf("BarSetHeikenAshi@tv-basicstudies-"))return new r;if(0===e.type.indexOf("BarSetRenko@tv-prostudies-"))return new h(e.inputs);if(0===e.type.indexOf("BarSetPriceBreak@tv-prostudies-"))return new p(e.inputs);if(0===e.type.indexOf("BarSetKagi@tv-prostudies-"))return new l(e.inputs);if(0===e.type.indexOf("BarSetPnF@tv-prostudies-"))return new _(e.inputs);const t=`unknown builder type: ${e.type}`;throw console.error(t),new Error(t)}},832205:(e,t,i)=>{"use strict";var s=i(638273).Interval,r=i(85761).isAlignmentEnabled,n=i(772483).getChartStyleStudy,o=i(881881).decodeExtendedSymbol,a=i(914625).findSuitableResolutionToBuildFrom,l=i(238695).SubsessionId,c=function(){var e=i(603610),t=e.StudyEngine,c=e.BarBuilder,h=e.BarSet;function d(e){this.host=e,this.cache={}}function u(t){console.error(t),e.Std.error(t)}d.prototype.getCache=function(e){return this.cache[e]},d.prototype.putCache=function(e,t){this.cache[e]=t},d.prototype.subscribe=function(e,t,i,s,r,n,o,a,l,c,h){var d=l(o),u=function(e,t,i,s,r,n,o,a,l){var c=r.has_empty_bars?"_":"";return n+e+s+(t||"")+(i||"")+(l||"")+c+"_"+o.countBack+"_"+o.to+"_"+Boolean(a)}(e,t,i,s,o,a,d,c,h),p=this.getCache(u);return p||(p=this.createItem(e,t,i,s,o,d,a,c,h),this.putCache(u,p)),p.listeners.addListener(r,n),{key:u,listener:r}},d.prototype.unsubscribe=function(e){var t=this.getCache(e.key);t&&t.listeners.removeListener(e.listener)},d.prototype.removeUnused=function(){var e=[];for(var t in this.cache){if(this.cache[t])0===this.cache[t].listeners.listenersCount()&&e.push(t)}if(0!==e.length){for(var i=0;i<e.length;i++){var s=e[i],r=this.cache[s];this.cache[s]=null,r.stop()}this.removeUnused()}},d.prototype.rebuildFrom=function(e,t){var i=a(e,t)
;return i.error&&u(i.errorMessage),i.resolution};var p=s.parse("1M").inMilliseconds(0);d.prototype.createItem=function(e,t,i,a,h,d,f,v,S){var y=new g,b=o(e),w="string"!=typeof b.symbol?b.symbol:b;t=w["currency-id"]||t,i=w["unit-id"]||i;var P=w.symbol,C=w.session&&w.session!==l.Extended;if((S=w.session||S)===l.Regular&&(S=void 0),"type"in b){var T=Object.assign({},h);return h.has_empty_bars&&(T.has_empty_bars=!1),new m(y,P,t,i,a,n(b),T,d,f,S)}v&&!r()&&u("Internal error: rebuilding is requested but it is disabled."),!v&&h.has_empty_bars&&u('Misconfiguration error: attempt to request data for symbol with "has_empty_bars" flag, but "disable_resolution_rebuild" featureset is enabled');var x,I,M=this.rebuildFrom(a,h);if(!s.isTicks(a)&&(!s.isEqual(a,M)||v)){r()||u('Misconfiguration error: remove "disable_resolution_rebuild" featureset or provide '+a+" data by yourself");var L=h.has_empty_bars;T=Object.assign({},h);h.has_empty_bars&&(T.has_empty_bars=!1);var A=Math.ceil((x=s.parse(a),I=s.parse(M),x.kind()===I.kind()?x.multiplier()/I.multiplier():(x.isMonths()?x.multiplier()*p:x.inMilliseconds())/(I.isMonths()?I.multiplier()*p:I.inMilliseconds())));return d=Object.assign({},d,{countBack:d.countBack*A}),new m(y,e,t,i,M,new c(a,L),T,d,f,S)}return new _(y,P,{currency:t,unit:i,session:S},a,C,this.host,h,d)};var _=function(e,t,i,s,r,n,o,a){this.listeners=e,this.host=n;var l=this;this.host.resolve(t,i,(function(e){r&&e.regular_session&&(e.session=e.regular_session),l.subs=l.host.subscribe(e,s,a,(function(e){l.listeners.fire(e)}),(function(e){l.listeners.onError(e)}))}),(function(e){l.listeners.onError(e)}))};_.prototype.stop=function(){this.subs&&this.host.unsubscribe(this.subs)};var m=function(e,i,s,r,n,o,a,l,c,h){this.listeners=e,this.isRecalculated=!1,this.symbolInfo=a;var d=this;this.engine=new t({tickerid:i,currencyCode:s,unitId:r,subsessionId:h,period:n,body:o,sessionId:c,symbolInfo:a,dataRange:l,forceAlignBars:!1,recalc:function(e,t){d._recalc(t)},out:function(e,t){d._out(e,t)},nonseriesOut:function(e,t){d._nonseriesOut(e,t)},setNoMoreData:function(){d.barset&&(d.barset.endOfData=!0)},onErrorCallback:function(e){d.listeners.onError(e)}})};m.prototype.stop=function(){this.engine?this.engine.stop():console.error("Internal library error 0x1")},m.prototype._recalc=function(e){this.isRecalculated&&console.error("recalc called twice!"),this.barset||(this.barset=new h(this.symbolInfo)),e&&(this.barset.firstLoadedTimeMs=e.firstLoadedTimeMs,this.barset.endOfData=e.endOfData),this.listeners.fire(this.barset),this.isRecalculated=!0},m.prototype._nonseriesOut=function(e,t){var i=Object.assign({},t);i.nonseries=!0,i.data=t.bars,delete i.bars,i.barsetSize=this.barset?this.barset.count():0,i.lastBar=this.barset?this.barset.bar(this.barset.count()-1):null,this.listeners.fire(i,!0)},m.prototype._out=function(e,t){var i=t[0];if(!isNaN(i)){var s={time:i,open:t[1],high:t[2],low:t[3],close:t[4],volume:t[5],updatetime:t[6]},r=t[7];this.barset||(this.barset=new h(e.info));var n=t[8];if(n instanceof Array)for(var o=0;o<n.length;o++){
var a=t[9],l=n[o],c={time:l,open:a,high:a,low:a,close:a,volume:0,updatetime:l};this.barset.add(c,!0,!0),this.isRecalculated&&this.listeners.fire(this.barset)}this.barset.add(s,r),this.barset.isBarClosed=r,this.isRecalculated&&this.listeners.fire(this.barset)}};var g=function(){this.listeners=[]};return g.prototype.listenersCount=function(){return this.listeners.reduce((function(e,t){return e+(t?1:0)}),0)},g.prototype.addListener=function(e,t){this.listeners.push({dataListener:e,onErrorCallback:t}),this.barset&&e(this.barset),this.errorMsg&&t(this.errorMsg)},g.prototype.removeListener=function(e){var t=this.listeners.filter((function(t){return t.dataListener===e}));if(0!==t.length){var i=this.listeners.indexOf(t[0]);delete this.listeners[i]}},g.prototype.onError=function(e){this.errorMsg=e||"unspecified error";for(var t=this.listeners,i=t.length,s=0;s<i;s++){var r=t[s];r&&r.onErrorCallback&&r.onErrorCallback(e)}},g.prototype.fire=function(e,t){t||(this.barset=e);for(var i=this.listeners,s=i.length,r=0;r<s;r++){var n=i[r];n&&n.dataListener(e)}},{setupFeed:function(t){d.instance=new d(t),e.setupFeed(d.instance)},unsubscribeUnused:function(){d.instance.removeUnused()}}}();e.exports=c},914625:(e,t,i)=>{"use strict";i.d(t,{findSuitableResolutionToBuildFrom:()=>o});var s=i(638273);function r(e,t){const i=t.multiplier();for(let s=e.length-1;s>=0;s--){const r=Number(e[s]);if(i%r==0)return{error:!1,resolution:`${r}${t.letter()}`}}return{error:!0,errorMessage:n(t.value())}}function n(e){return`Misconfiguration error: it is trying to request ${e} but we cannot build it from lower resolution`}function o(e,t){const i=s.Interval.parse(e);if((i.isWeeks()||i.isMonths())&&t.has_weekly_and_monthly){let e=["1"];i.isWeeks()&&void 0!==t.weekly_multipliers&&(e=t.weekly_multipliers),i.isMonths()&&void 0!==t.monthly_multipliers&&(e=t.monthly_multipliers);const s=r(e,i);if(!s.error)return s}if(i.isDWM()&&(void 0===t.has_daily||t.has_daily))return i.isDays()&&void 0!==t.daily_multipliers?r(t.daily_multipliers,i):void 0===t.daily_multipliers||t.daily_multipliers.includes("1")?{error:!1,resolution:"1D"}:{error:!0,errorMessage:"Misconfiguration error: it is trying to request a resolution but symbol does not support it"};if(i.isDWM())return{error:!0,errorMessage:n(i.value())};if(i.isMinutes()&&!t.has_intraday)return{error:!0,errorMessage:"Misconfiguration error: it is trying to request intraday resolution but symbol does not support it"};if(i.isSeconds()&&!t.has_seconds)return{error:!0,errorMessage:"Misconfiguration error: it is trying to request seconds resolution but symbol does not support it"};if(i.isTicks())return!t.has_ticks||i.multiplier()>1?{error:!0,errorMessage:`Misconfiguration error: it is trying to request ${i.multiplier()} ticks resolution but symbol does not support it`}:{error:!1,resolution:"1T"};const o=i.isSeconds()?t.seconds_multipliers:t.intraday_multipliers;return void 0===o?{error:!1,resolution:i.value()}:r(o,i)}},603610:(e,t,i)=>{"use strict"
;var s,r=i(886115).StudyError,n=i(624595),o=i(467978).SessionStage,a=i(638273).Interval,l=i(85761).createDwmAligner,c=i(85761).createTimeToBarTimeAligner,h=i(881881).decodeExtendedSymbol,d=i(881881).encodeExtendedSymbolOrGetSimpleSymbolString,u=i(238695).SubsessionId,p=i(443054).PrePostMarketBarIdentifier,_=i(435818).SessionSpec,m=1e-10,g="undefined"!=typeof window?window:i.g,f=g.PineJsCalendar?g.PineJsCalendar:i(871555),v=i(290728),S=i(831551).extrapolateBarsFrontToTime,y={};function b(e,t,i,s,r){var n=r,o=0;if(isNaN(e.get(t-1)))return{index:NaN,value:NaN};for(var a=0;a<t;++a)s(e.get(a),n)&&(o=a,n=e.get(a));return{index:o,value:n}}y.max_series_default_size=10001,y.n=function(e){return e.symbol.index+1},y.nz=function(e,t){return t=t||0,isFinite(e)?e:t},y.na=function(e){return 0===arguments.length?NaN:isNaN(e)?1:0},y.isZero=function(e){return Math.abs(e)<=1e-10},y.toBool=function(e){return isFinite(e)&&!y.isZero(e)},y.eq=function(e,t){return y.isZero(e-t)},y.neq=function(e,t){return!y.eq(e,t)},y.ge=function(e,t){return y.isZero(e-t)||e>t},y.gt=function(e,t){return!y.isZero(e-t)&&e>t},y.lt=function(e,t){return!y.isZero(e-t)&&e<t},y.le=function(e,t){return y.isZero(e-t)||e<t},y.and=function(e,t){return isNaN(e)||isNaN(t)?NaN:y.isZero(e)||y.isZero(t)?0:1},y.or=function(e,t){return isNaN(e)||isNaN(t)?NaN:y.isZero(e)&&y.isZero(t)?0:1},y.not=function(e){return isNaN(e)?NaN:y.isZero(e)?1:0},y.eps=function(){return m},y.greaterOrEqual=function(e,t,i){return t-e<(i||m)},y.lessOrEqual=function(e,t,i){return e-t<(i||m)},y.equal=function(e,t,i){return Math.abs(e-t)<(i||m)},y.greater=function(e,t,i){return e-t>(i||m)},y.less=function(e,t,i){return t-e>(i||m)},y.compare=function(e,t,i){return y.equal(e,t,i)?0:y.greater(e,t,i)?1:-1},y.max=Math.max,y.min=Math.min,y.pow=Math.pow,y.abs=Math.abs,y.log=Math.log,y.log10=function(e){return Math.log(e)/Math.LN10},y.sqrt=Math.sqrt,y.sign=function(e){return isNaN(e)?NaN:y.isZero(e)?0:e>0?1:-1},y.exp=Math.exp,y.sin=Math.sin,y.cos=Math.cos,y.tan=Math.tan,y.asin=Math.asin,y.acos=Math.acos,y.atan=Math.atan,y.floor=Math.floor,y.ceil=Math.ceil,y.round=Math.round,y.avg=function(e,t,i,s,r,n){if(2===arguments.length)return(e+t)/2;for(var o=0,a=0;a<arguments.length;a++)o+=arguments[a];return o/arguments.length},y.open=function(e){return e.symbol.open},y.high=function(e){return e.symbol.high},y.low=function(e){return e.symbol.low},y.close=function(e){return e.symbol.close},y.hl2=function(e){return(e.symbol.high+e.symbol.low)/2},y.hlc3=function(e){return(e.symbol.high+e.symbol.low+e.symbol.close)/3},y.ohlc4=function(e){return(e.symbol.open+e.symbol.high+e.symbol.low+e.symbol.close)/4},y.volume=function(e){return e.symbol.volume},y.updatetime=function(e){return e.symbol.updatetime},y.time=function(e){return e.symbol.bartime()},y.period=function(e){return e.symbol.period},y.tickerid=function(e){return e.symbol.tickerid},y.currencyCode=function(e){return e.symbol.currencyCode},y.unitId=function(e){return e.symbol.unitId},y.ticker=function(e){return e.symbol.ticker},y.interval=function(e){
return e.symbol.interval},y.isdwm=function(e){return e.symbol.isdwm()},y.isintraday=function(e){return!e.symbol.isdwm()},y.isdaily=function(e){return"D"===e.symbol.resolution},y.isweekly=function(e){return"W"===e.symbol.resolution},y.ismonthly=function(e){return"M"===e.symbol.resolution},y.year=function(e){return y.timepart(e.symbol,f.YEAR,arguments[1])},y.month=function(e){return y.timepart(e.symbol,f.MONTH,arguments[1])},y.weekofyear=function(e){return y.timepart(e.symbol,f.WEEK_OF_YEAR,arguments[1])},y.dayofmonth=function(e){return y.timepart(e.symbol,f.DAY_OF_MONTH,arguments[1])},y.dayofweek=function(e){return y.timepart(e.symbol,f.DAY_OF_WEEK,arguments[1])},y.hour=function(e){return y.timepart(e.symbol,f.HOUR_OF_DAY,arguments[1])},y.minute=function(e){return y.timepart(e.symbol,f.MINUTE,arguments[1])},y.second=function(e){return y.timepart(e.symbol,f.SECOND,arguments[1])},y.add_days_considering_dst=function(e,t,i){return f.add_days_considering_dst(f.get_timezone(e),t,i)},y.selectSessionBreaks=function(e,t){if(y.isdwm(e)||void 0===e.symbol.session.timezone)return[];var i=v.newBarBuilder(e.symbol.period,e.symbol.session),s=[],r=t.length;if(i.moveTo(t[r-1]),1===r&&i.startOfBar(0)===t[0])s.push(t[0]);else{for(var n=r-2;n>=0;--n){var o=t[n];if(!(o>=i.startOfBar(0))){i.moveTo(o);var a=t[n+1];s.push(a)}}s.reverse()}return s},y.selectPreAndPostMarketTimes=function(e,t){if(y.isdwm(e)||void 0===e.symbol.session.timezone)return{preMarket:[],postMarket:[]};if(null===e.symbol.regularSubsession||null===e.symbol.preMarketSubsession||null===e.symbol.postMarketSubsession)return{preMarket:[],postMarket:[]};return new p(e.symbol.timezone,e.symbol.preMarketSubsession,e.symbol.postMarketSubsession).getPreAndPostMarketTimes(t)},y.iff=function(e,t,i){return y.not(e)?i:t},y.rising=function(e,t){for(var i=1;i<t+1;++i)if(e.get(i)>e.get(0))return 0;return 1},y.falling=function(e,t){for(var i=1;i<t+1;++i)if(e.get(i)<e.get(0))return 0;return 1},y.timepart=function(e,t,i){var s=f.utc_to_cal(e.timezone,i||e.bartime());return f.get_part(s,t)},y.rsi=function(e,t){return y.isZero(t)?100:y.isZero(e)?0:100-100/(1+e/t)},y.sum=function(e,t,i){var s=i.new_var(),r=y.nz(e.get())+y.nz(s.get(1))-y.nz(e.get(t));return s.set(r),r},y.sma=function(e,t,i){var s=y.sum(e,t,i);return y.na(e.get(t-1))?NaN:s/t},y.smma=function(e,t,i){var s=i.new_var(e),r=y.sma(s,t,i),n=i.new_var(),o=(n.get(1)*(t-1)+e)/t;return n.set(y.na(n.get(1))?r:o),n.get(0)},y.rma=function(e,t,i){var s=y.sum(e,t,i),r=t-1,n=e.get(r),o=i.new_var(),a=o.get(1),l=e.get(),c=y.na(n)?NaN:y.na(a)?s/t:(l+a*r)/t;return o.set(c),c},y.fixnan=function(e,t){var i=t.new_var();return isNaN(e)?i.get(1):(i.set(e),e)},y.tr=function(e,t){1===arguments.length&&(t=e,e=void 0);var i=void 0!==e&&!!e,s=t.new_var(y.close(t)),r=s.get(1);return i&&isNaN(r)&&(r=y.close(t)),y.max(y.max(y.high(t)-y.low(t),y.abs(y.high(t)-r)),y.abs(y.low(t)-r))},y.atr=function(e,t){var i=t.new_var(y.tr(t));return y.rma(i,e,t)},y.ema=function(e,t,i){
var s=y.sum(e,t,i),r=i.new_var(),n=e.get(0),o=e.get(t-1),a=r.get(1),l=y.na(o)?NaN:y.na(a)?s/t:2*(n-a)/(t+1)+a;return r.set(l),l},y.wma=function(e,t,i){for(var s=0,r=t=Math.round(t);r>=0;r--){s+=(t-r)*e.get(r)}return 2*s/(t*(t+1))},y.vwma=function(e,t,i){var s=i.new_var(y.volume(i)),r=i.new_var(e.get(0)*y.volume(i));return y.sma(r,t,i)/y.sma(s,t,i)},y.swma=function(e,t){return(e.get(0)+2*e.get(1)+2*e.get(2)+e.get(3))/6},y.supertrend=function(e,t,i){var s=y.atr(t,i),r=i.new_var(s).get(1),n=y.hl2(i),o=n+s*e,a=n-s*e,l=y.close(i),c=i.new_var(l).get(1),h=i.new_var(),d=y.nz(h.get(1)),u=i.new_var(),p=y.nz(u.get(1));a=y.gt(a,d)||y.lt(c,d)?a:d,h.set(a),o=y.lt(o,p)||y.gt(c,p)?o:p,u.set(o);var _=y.na(),m=i.new_var(),g=m.get(1),f=-1===(_=y.na(r)?1:g===p?l>o?-1:1:l<a?1:-1)?a:o;return m.set(f),[f,_]},y.lowestbars=function(e,t,i){return-b(e,t,0,(function(e,t){return y.lt(e,t)}),Number.MAX_VALUE).index},y.lowest=function(e,t,i){return b(e,t,0,(function(e,t){return y.lt(e,t)}),Number.MAX_VALUE).value},y.highestbars=function(e,t,i){return-b(e,t,0,(function(e,t){return y.gt(e,t)}),Number.NEGATIVE_INFINITY).index},y.highest=function(e,t,i){return b(e,t,0,(function(e,t){return y.gt(e,t)}),Number.NEGATIVE_INFINITY).value},y.cum=function(e,t){var i=t.new_var(),s=y.nz(i.get(1))+e;return i.set(s),s},y.accdist=function(e){var t=y.high(e),i=y.low(e),s=y.close(e),r=y.volume(e);return y.cum(s===t&&s===i||t===i?0:r*(2*s-i-t)/(t-i),e)},y.correlation=function(e,t,i,s){var r=y.sma(e,i,s),n=y.sma(t,i,s),o=s.new_var(e.get()*t.get());return(y.sma(o,i,s)-r*n)/Math.sqrt(y.variance2(e,r,i)*y.variance2(t,n,i))},y.stoch=function(e,t,i,s,r){var n=y.highest(t,s),o=y.lowest(i,s);return y.fixnan(100*(e.get()-o)/(n-o),r)},y.tsi=function(e,t,i,s){var r=s.new_var(y.change(e)),n=s.new_var(y.abs(y.change(e))),o=s.new_var(y.ema(r,i,s)),a=s.new_var(y.ema(n,i,s));return y.ema(o,t,s)/y.ema(a,t,s)},y.cross=function(e,t,i){if(isNaN(e)||isNaN(t))return!1;var s,r=i.new_var((s=e-t)<0?-1:0===s?0:1);return!isNaN(r.get(1))&&r.get(1)!==r.get()},y.linreg=function(e,t,i){for(var s=0,r=0,n=0,o=0,a=0;a<t;++a){var l=e.get(a),c=t-1-a+1;s+=c,r+=l,n+=c*c,o+=l*c}var h=(t*o-s*r)/(t*n-s*s);return r/t-h*s/t+h+h*(t-1-i)},y.sar=function(e,t,i,s){var r=s.new_var(),n=s.new_var(),o=s.new_var(),a=y.high(s),l=y.low(s),c=y.close(s),h=s.new_var(a),d=s.new_var(l),u=s.new_var(c),p=s.new_var(),_=p.get(1),m=n.get(1),g=o.get(1);n.set(m),o.set(g);var f=!1,v=d.get(1),S=d.get(2),b=h.get(1),w=h.get(2),P=u.get(),C=u.get(1);2===y.n(s)&&(y.greater(P,C)?(r.set(1),o.set(h.get()),_=v,g=h.get()):(r.set(-1),o.set(d.get()),_=b,g=d.get()),f=!0,n.set(e),m=e);var T=_+m*(g-_);return 1===r.get()?y.greater(T,d.get())&&(f=!0,r.set(-1),T=Math.max(h.get(),o.get()),o.set(d.get()),n.set(e)):y.less(T,h.get())&&(f=!0,r.set(1),T=Math.min(d.get(),o.get()),o.set(h.get()),n.set(e)),f||(1===r.get()?y.greater(h.get(),o.get())&&(o.set(h.get()),n.set(Math.min(n.get()+t,i))):y.less(d.get(),o.get())&&(o.set(d.get()),n.set(Math.min(n.get()+t,i)))),1===r.get()?(T=Math.min(T,v),y.n(s)>2&&(T=Math.min(T,S))):(T=Math.max(T,b),
y.n(s)>2&&(T=Math.max(T,w))),p.set(T),T},y.alma=function(e,t,i,s){for(var r=Math.floor(i*(t-1)),n=t/s*(t/s),o=[],a=0,l=0;l<t;++l){var c=Math.exp(-1*Math.pow(l-r,2)/(2*n));a+=c,o.push(c)}for(l=0;l<t;++l)o[l]/=a;var h=0;for(l=0;l<t;++l)h+=o[l]*e.get(t-l-1);return h},y.wvap=function(e,t){return e.get()-e.get(1)},y.change=function(e){return e.get()-e.get(1)},y.roc=function(e,t){var i=e.get(t);return 100*(e.get()-i)/i},y.dev=function(e,t,i){var s=y.sma(e,t,i);return y.dev2(e,t,s)},y.dev2=function(e,t,i){for(var s=0,r=0;r<t;r++){var n=e.get(r);s+=y.abs(n-i)}return s/t},y.stdev=function(e,t,i){var s=y.variance(e,t,i);return y.sqrt(s)},y.variance=function(e,t,i){var s=y.sma(e,t,i);return y.variance2(e,s,t)},y.variance2=function(e,t,i){for(var s=0,r=0;r<i;r++){var n=e.get(r),o=y.abs(n-t);s+=o*o}return s/i},y.percentrank=function(e,t){if(y.na(e.get(t-1)))return NaN;for(var i=0,s=e.get(),r=1;r<t;r++){var n=e.get(r);y.ge(s,n)&&i++}return 100*i/t},y.createNewSessionCheck=function(e){if(void 0===e.symbol.session.timezone)return function(){return!1};var t=v.newBarBuilder(e.symbol.period,e.symbol.session);return function(e){return t.indexOfBar(e)===o.POST_SESSION&&(t.moveTo(e),!0)}},y.error=function(e){throw new r(e)},y.dmi=function(e,t,i){var s=i.new_var(y.high(i)),r=i.new_var(y.low(i)),n=y.change(s),o=-y.change(r),a=i.new_var(y.na(n)||y.na(o)?y.na():y.and(y.gt(n,o),y.gt(n,0))?n:0),l=i.new_var(y.na(o)?y.na():y.and(y.gt(o,n),y.gt(o,0))?o:0),c=y.atr(e,i),h=y.fixnan(100*y.rma(a,e,i)/c,i),d=y.fixnan(100*y.rma(l,e,i)/c,i),u=h+d;y.isZero(u)&&(u+=1);var p=Math.abs(h-d)/u*100,_=i.new_var(p),m=y.rma(_,t,i),g=i.new_var(m);return[h,d,p,m,(g.get(0)+g.get(e-1))/2]};class w{constructor(e,t,i,s,r){this._areaRight=e,this._areaLeft=t,this._pivotType=i,this._series=s,this._currentIndex=r.new_var(0),this._currentValue=r.new_var(NaN),this._pivotIndex=r.new_var(-1),this._index=y.n(r),this._isNewBar=r.symbol.isNewBar;var n=this._currentIndex.get(1),o=this._currentValue.get(1),a=this._pivotIndex.get(1);this._index>1&&(this._currentIndex.set(n),this._currentValue.set(o),this._pivotIndex.set(a))}isPivotFound(){return-1!==this._pivotIndex.get()}pivotIndex(){return this._pivotIndex.get()}currentValue(){return this._currentValue.get()}pivotType(){return this._pivotType}reset(){this._currentValue.set(NaN),this._currentIndex.set(0),this._pivotIndex.set(-1)}isRightSideOk(e){return e-this._currentIndex.get()===this._areaRight}isViolate(e,t){if(e<1||isNaN(this._currentValue.get()))return!0;var i=this._series.get(this._index-e);return!!isNaN(i)||(i===this._currentValue.get()?t:this._pivotType===w.HIGH?i>this._currentValue.get():i<this._currentValue.get())}processPoint(e){this.isViolate(e,!1)&&(this._currentValue.set(this._series.get()),this._currentIndex.set(e))}isRestartNeeded(e){return e-this._currentIndex.get()>this._areaRight}update(){if(this._isNewBar&&this.isPivotFound()&&this.reset(),this.processPoint(this._index),this.isRightSideOk(this._index)){if(-1===this._pivotIndex.get()){
for(var e=!0,t=0;t<this._areaLeft;++t)if(this.isViolate(this._currentIndex.get()-1-t,!0)){e=!1;break}e&&this._pivotIndex.set(this._currentIndex.get())}}else-1!==this._pivotIndex.get()&&this._pivotIndex.set(-1);if(this.isRestartNeeded(this._index)){this.reset();for(t=0;t<=this._areaRight;++t)this.processPoint(this._index-this._areaRight+t)}}}w.LOW=0,w.HIGH=1;class P{constructor(e,t,i){this._deviation=e;var s=i.new_var(y.high(i)),r=i.new_var(y.low(i));s.get(2*t+1),r.get(2*t+1),this._pivotHigh=new w(t,t,w.HIGH,s,i),this._pivotLow=new w(t,t,w.LOW,r,i),this._lastVal=i.new_var(NaN),this._lastIndex=i.new_var(-1),this._lastType=i.new_var(),this._index=y.n(i),this._isNewBar=i.symbol.isNewBar,this._isBarClosed=i.symbol.isBarClosed;var n=this._lastIndex.get(1),o=this._lastVal.get(1),a=this._lastType.get(1);this._index>1&&this.addPivot(n,o,a),this.processPivot(this._pivotHigh),this.processPivot(this._pivotLow)}addPivot(e,t,i){this._lastIndex.set(e),this._lastVal.set(t),this._lastType.set(i)}updatePivot(e,t){this._lastIndex.set(e),this._lastVal.set(t)}lastPrice(){return this._lastVal.get()}lastIndex(){return this._lastIndex.get()}addPoint(e,t,i){if(isNaN(this._lastVal.get()))this.addPivot(e,t,i);else{var s=this._lastVal.get();if(this._lastType.get()!==i)Math.abs(s-t)/t>this._deviation&&this.addPivot(e,t,i);else(i===w.HIGH?t>s:t<s)&&this.updatePivot(e,t)}}processPivot(e){e.update(),this._isBarClosed&&e.isPivotFound()&&this.addPoint(e.pivotIndex(),e.currentValue(),e.pivotType())}}y.zigzag=function(e,t,i){return new P(e,t,i).lastPrice()},y.zigzagbars=function(e,t,i){var s=new P(e,t,i);return-1===s.lastIndex()?NaN:s.lastIndex()-y.n(i)};class C{constructor(e){this.symbol=e,this.vars=[],this.vars_index=0,this.ctx=[],this.ctx_index=0,this.minimumAdditionalDepth=null}new_sym(e,t,i,s,r){return this.symbol.script.add_sym(e,t,i,s,r)}select_sym(e){this.symbol=this.symbol.script.get_sym(e)}is_main_symbol(e){return void 0!==e&&e===this.symbol.script.get_sym(0)}new_var(e){var t=this.vars;t.length<=this.vars_index&&t.push(new T(this.symbol));var i=t[this.vars_index++];return arguments.length>0&&i.set(e),i}new_unlimited_var(e){var t=this.vars;t.length<=this.vars_index&&t.push(new x(this.symbol));var i=t[this.vars_index++];return arguments.length>0&&i.set(e),i}new_ctx(){return this.ctx.length<=this.ctx_index&&this.ctx.push(new C(this.symbol)),this.ctx[this.ctx_index++]}prepare(e){this.ctx_index=0,this.vars_index=0;for(var t=0;t<this.vars.length;t++)this.vars[t].prepare(e);for(var i=0;i<this.ctx.length;i++)this.ctx[i].prepare(e)}maxAdditionalDepth(){if(null!==this.minimumAdditionalDepth)return this.minimumAdditionalDepth;for(var e=0,t=0;t<this.vars.length;t++){var i=this.vars[t].mindepth;!isNaN(i)&&i>e&&(e=i)}return e}stop(){this.symbol=null,this.vars=null}setMinimumAdditionalDepth(e){this.minimumAdditionalDepth=e}}class T{constructor(e){this.mindepth=0,this.original=NaN,this.modified=!1,this.symbol=e}valueOf(){return this.get(0)}get(e){return isNaN(e)&&(e=0),e=e||0,this.hist?e>=this.hist.length?(console.error("not enough depth: "+this),
NaN):this._get(e):(this.mindepth=y.max(this.mindepth,e),NaN)}_get(e){var t=this.hist_pos-e;return t<0&&(t+=this.hist.length),this.hist[t]}set(e){this.hist&&(this.hist[this.hist_pos]=e,this.modified=!0)}prepare(e){e===this.symbol&&(e.isNewBar?(this.original=this.get(0),!this.modified&&this.hist||this.add_hist()):this.set(this.original),this.modified=!1)}add_hist(){if(!this.hist){var e=y.na(this.mindepth)?y.max_series_default_size:y.max(this.mindepth+1,1);e=Math.round(e);for(var t=new Array(e),i=0;i<e;i++)t[i]=NaN;this.hist=t,this.hist_pos=-1}this.hist_pos=Math.min(this.hist_pos+1,this.hist.length),this.hist_pos===this.hist.length&&(this.hist_pos=this.hist.length-1,this.hist.shift(),this.hist.push(NaN)),this.hist[this.hist_pos]=this.original}adopt(e,t,i){this.hist||(this.mindepth=NaN);var s=t.get(),r=e.indexOf(s);if(0!==i){var n=t.get(1);if(!y.na(n))r=r===e.indexOf(n)?-1:r}return r<0?NaN:this._get(r)}indexOf(e){if(!this.hist)return this.mindepth=NaN,-1;if(y.na(e))return-1;var t=this.hist.length,i=this.symbol.index+1,s=Math.min(t,i),r=n.upperbound_int(this.hist,e,0,s);return 0===r?-1:s-r}}class x extends T{add_hist(){if(this.hist||(this.hist=new Float64Array(2e3),this.hist_pos=-1),this.hist_pos=this.hist_pos+1,this.hist_pos===this.hist.length){var e=new Float64Array(2*this.hist.length);e.set(this.hist),this.hist=e}this.hist[this.hist_pos]=this.original}}class I{constructor(e,t,i,s,r,n,o){var l=h(e);const c="string"==typeof l.symbol?l:l.symbol;this.ticker=c.symbol,this.currencyCode=i||c["currency-id"],this.unitId=s||c["unit-id"],this.subsessionId=o||c.session;var u=c["currency-id"]!==this.currencyCode||c["unit-id"]!==this.unitId;c["currency-id"]=this.currencyCode,c["unit-id"]=this.unitId,u&&(e=d(l)),this.tickerid=e;var p=a.parse(t);this.resolution=p.letter(),this.interval=p.multiplier(),this.period=p.value(),this.index=-1,this.time=NaN,this.open=NaN,this.high=NaN,this.low=NaN,this.close=NaN,this.volume=NaN,this.updatetime=NaN,this.isNewBar=!1,this.isBarClosed=!1,this.session=new v.SessionInfo("Etc/UTC","24x7"),this.regularSubsession=null,this.preMarketSubsession=null,this.postMarketSubsession=null,this.script=r,this.isAdditionalDepthAllowed=void 0===l.type||l.type.includes("BarSetHeikenAshi"),n&&this.set_symbolinfo(n)}set_symbolinfo(e){if(e||console.error("WARN: symbolinfo isn't defined for "+this.tickerid),this.info=e,this.minTick=e.minmov/e.pricescale,this.currencyCode=e.currency_code,this.unitId=e.unit_id,this.subsessionId=e.subsession_id,this.timezone=f.get_timezone(e.timezone),this.session.init(e.timezone,e.session,e.session_holidays,e.corrections),void 0!==e.subsessions){const t=e.subsessions.find((e=>e.id===u.Regular)),i=e.subsessions.find((e=>e.id===u.PreMarket)),s=e.subsessions.find((e=>e.id===u.PostMarket));void 0!==t&&(this.regularSubsession=new _(e.timezone,t.session,e.session_holidays,t["session-correction"])),void 0!==i&&(this.preMarketSubsession=new _(e.timezone,i.session,e.session_holidays,i["session-correction"])),
void 0!==s&&(this.postMarketSubsession=new _(e.timezone,s.session,e.session_holidays,s["session-correction"]))}}isdwm(){return""!==this.resolution&&"S"!==this.resolution&&"T"!==this.resolution}enable_dwm_aligning(e,t){this.dwm_aligner=v.newBarBuilder(this.period,e,t)}bartime(){var e=this.time;if(!this.isdwm()||isNaN(e))return e;var t=f.utc_to_cal(this.timezone,e);return this.session.spec.correctTradingDay(t),f.cal_to_utc(this.timezone,t)}lastbar(e){if(!isNaN(e.time)){var t=e.time;this.dwm_aligner&&(this.dwm_aligner.moveTo(t),t=this.dwm_aligner.startOfBar(0));var i=this.time!==t;i&&this.index>=0&&!this.isBarClosed&&(this.isNewBar=!1,this.isBarClosed=!0,this.script.calc(this)),this.time=t,this.open=e.open,this.high=e.high,this.low=e.low,this.close=e.close,this.volume=e.volume,this.updatetime=e.updatetime,this.isNewBar=i,this.isBarClosed=e.isBarClosed,this.isLastBar=e.isLastBar,this.isNewBar&&(this.index++,this.isFirstBar=0===this.index),this.script.calc(this)}}}class M{constructor(e,t,i,s,r,n,o,a,l,c,h){this.body=n,this.symbols=[],this.runner=r,this.inputCallback=a,this.out=o,this.nonseriesOut=l,this.ctx=new C(this.add_sym(e,t,i,s,c,h)),this.init()}calc(e){var t=this.ctx,i=this.body;t.prepare(e);var s=i.main(t,this.inputCallback,e);if(s&&"composite"===s.type)for(let e=0;e<s.data.length;++e)this._processResult(s.data[e]);else this._processResult(s)}_processResult(e){var t=this.ctx,i=this;this.out&&e&&(!isNaN(t.symbol.time)||e.nonseries)&&(e.nonseries?("projection"===e.type&&(e.projectionTime=t.symbol.time),this.nonseriesOut(t.symbol,e)):e.bars?e.bars.forEach((function(e){i.out(t.symbol,e)})):this.out(t.symbol,e))}init(){var e=this.ctx,t=this.body;t.init&&t.init(e,this.inputCallback),t.main(e,this.inputCallback)}add_sym(e,t,i,s,r,n){var o=this.runner.add_sym(e,t,i,s,this,r,n);return this.symbols.push(o),o.isdwm()&&this.symbols.length>1&&o.enable_dwm_aligning(this.symbols[0].session,o.session),o}maxAdditionalDepth(){return this.symbols[0].isAdditionalDepthAllowed?this.ctx.maxAdditionalDepth():0}stop(){this.symbols=null,this.ctx.stop(),this.ctx=null}get_sym(e){return this.symbols[e]}}class L{constructor(e){this.symbols=[],this.barsets=[],this.subscription=[],this.host=e,this.isRecalculated=!1,this.isStarted=!1,this.start()}add_sym(e,t,i,s,r,n,o){var a=new I(e,t,i,s,r,n,o);return this.symbols.push(a),a}get_sym(e){return this.symbols[e]}out(e,t){if(this.nonseriesUpdate){var i=Object.assign({},this.nonseriesUpdate);t.splice(0,0,e.time),i.lastBar=t,this.host.nonseriesOut(e,i)}else this.host.out(e,t)}start(){this.isStarted=!0;var e=this.host;this._script=new M(e.tickerid,e.period,e.currencyCode,e.unitId,this,e.body,this.out.bind(this),e.input,e.nonseriesOut,e.symbolInfo,e.subsessionId);var t=this,i=[],s=this.symbols,r=Object.assign({},e.dataRange,{countBack:e.dataRange.countBack+t._script.maxAdditionalDepth()}),n=s[0];function o(t,s,r){i.push(L.feed.subscribe(t.tickerid,t.currencyCode,t.unitId,t.period,r,e.onErrorCallback,e.symbolInfo,e.sessionId,s,e.forceAlignBars,t.subsessionId))}function h(i,s){
"series"===(s.nonseries?"nonseries":"series")?t.update(i,s):s.lastBar?(t.nonseriesUpdate=s,s.lastBar.isLastBar=!0,t.symbols[0].lastbar(s.lastBar),t.nonseriesUpdate=null):e.nonseriesOut(p,s)}function d(){return r}o(n,d,(function(e){!e.nonseries&&Number.isFinite(e.firstLoadedTimeMs)&&function(e){function i(i,s){var r=c(i,s)(e),n=l(i,s);return null!==n&&(r=n.timeToExchangeTradingDay(r)),{to:r,countBack:t._script.maxAdditionalDepth()}}for(var r=1;r<s.length;r++){var d=s[r],u=d.period;a.isEqual(u,n.period)||o(d,i.bind(null,u),h.bind(null,r))}}(e.firstLoadedTimeMs),h(0,e)}));for(var u=1;u<s.length;u++){var p=s[u];a.isEqual(p.period,n.period)&&o(p,d,h.bind(null,u))}this.subscription=i}stop(){var e=this.subscription;if(e||this._script){for(var t=0;t<e.length;t++)L.feed.unsubscribe(e[t]);this.subscription=null,this._script.stop(),this._script=null,this.symbols=null,this.isStarted=!1}else console.warn("Recurring script engine stop happened.")}update(e,t){if(t){var i=this.symbols[e];if(this.isRecalculated){var s=t.bar(t.count()-1);s.isBarClosed=t.isLastBarClosed(),s.isLastBar=!0,i.lastbar(s)}else this.barsets[e]||(this.barsets[e]=t,i.set_symbolinfo(t.symbolinfo()),this.recalc())}else console.error("Unexpected barset = null")}recalc(){for(var e=this.symbols,t=0;t<e.length;t++)if(!this.barsets[t])return;try{for(var i=e.length-1;i>=0;i--)for(var s=e[i],r=this.barsets[i],n=r.count(),o=0;o<n;o++){var a=r.bar(o);a.isLastBar=o===n-1,a.isBarClosed=!a.isLastBar||r.isLastBarClosed(),s.lastbar(a)}this.isRecalculated=!0,this.barsets[0]&&this.barsets[0].endOfData&&this.host.setNoMoreData(),this.host.recalc(this,{endOfData:this.barsets[0].endOfData,firstLoadedTimeMs:this.barsets[0].firstLoadedTimeMs,emptyBarCount:this.barsets[0].emptyBarCount()})}catch(e){if(!e.studyError)throw e;this.host.onErrorCallback(e.message)}}}L.feed={subscribe:function(e,t,i,s,r){console.error("must be initialized with setupFeed")},unsubscribe:function(e){console.error("must be initialized with setupFeed")}};e.exports.Std=y,e.exports.Series=T,e.exports.Symbol=I,e.exports.SymbolInfo=class{constructor(e,t){this.timezone=e||"America/New_York",this.session=t||"0000-0000"}},e.exports.StudyEngine=class{constructor(e){this.runner=new L(e)}stop(){this.runner.stop()}isStarted(){return this.runner.isStarted}},e.exports.BarSet=class{constructor(e,t){this.info=e,this.bars=t||[],this.isBarClosed=!0,this.firstLoadedTimeMs=0!==this.bars.length?this.bars[0].time:1/0,this._emptyBarCount=0,this._lastBarIsEmpty=!1}symbolinfo(){return this.info}isLastBarClosed(){return this.isBarClosed}setLastBarClosed(e){this.isBarClosed=e}bar(e){return this.bars[e]}count(){return this.bars.length}emptyBarCount(){return this._emptyBarCount}add(e,t,i){void 0===i&&(i=!1);var s=e,r=this.bars,n=r.length,o=s.time,a=0===n?NaN:r[n-1].time;0===n||a<o?(r.push(s),i&&(this._emptyBarCount+=1,this._lastBarIsEmpty=!0)):a===o?(i!==this._lastBarIsEmpty&&(this._emptyBarCount+=i?1:-1,this._lastBarIsEmpty=i),
r[n-1]=s):console.error("time order violation, prev: "+new Date(a).toUTCString()+", cur: "+new Date(o).toUTCString()),this.isBarClosed=!!t}},e.exports.OHLCV=class{main(e){return[y.open(e),y.high(e),y.low(e),y.close(e),y.volume(e),y.updatetime(e)]}},e.exports.BarBuilder=class{constructor(e,t){this.period=e,this.generateEmptyBars=!!t}init(e){this.bb=v.newBarBuilder(this.period,e.symbol.session),this.bbEmptyBars=this.generateEmptyBars?v.newBarBuilder(this.period,e.symbol.session):void 0,e.setMinimumAdditionalDepth(0)}extrapolate(e,t){return isNaN(e)||isNaN(t)?void 0:S(this.bbEmptyBars,e,t,Number.MAX_SAFE_INTEGER,!0).times}main(e){var t=e.symbol.time,i=this.bb.alignTime(t),s=e.new_var(i),r=y.na(i),n=s.get(1),o=y.na(n)?1:y.neq(i,n),a=e.new_var(),l=e.new_var(),c=e.new_var(),h=e.new_var(),d=a.get(1),u=l.get(1),p=c.get(1),_=h.get(1),m=r?NaN:o?y.open(e):d,g=r?NaN:o?y.high(e):y.max(y.high(e),u),f=r?NaN:o?y.low(e):y.min(y.low(e),p),v=r?NaN:y.close(e),S=r?NaN:o?y.volume(e):y.volume(e)+_,b=r?NaN:t,w=e.symbol.isBarClosed&&this.bb.isLastBar(0,t),P=this.generateEmptyBars&&o?this.extrapolate(n,i):void 0,C=e.new_var(y.close(e)).get(1),T=P instanceof Array?C:NaN;return a.set(m),l.set(g),c.set(f),h.set(S),[i,m,g,f,v,S,b,w,P,T]}},e.exports.setupFeed=function(e){L.feed=e},e.exports.getVolumeProfileResolutionForPeriod=function(e,t,i,r){return void 0!==s?s(e,t,i,r):e},e.exports.overwriteVolumeProfileResolutionForPeriodGetter=function(e){s=e}},397431:(e,t,i)=>{"use strict";const s=i(676507).getHexColorByName;var r=i(603610);i(951008);var n=i(279709).pivotPointsStandardStudyItem,o=i(778819).volumeProfileVisibleRangeStudyItem,a=i(45170).volumeProfileFixedRangeVbPStudyItem,l=i(45170).volumeProfileFixedRangeBSStudyItem,c=i(806965).spreadStudyItem,h=i(338140).ratioStudyItem,d=i(216475).regressionTrendStudyItem;const u=s("color-ripe-red-400"),p=s("color-minty-green-400");JSServer.studyLibrary=JSServer.studyLibrary.concat([{name:"Compare",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!0,defaults:{styles:{compare:{linestyle:0,linewidth:2,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#9C27B0"}},inputs:{source:"close",symbol:""}},plots:[{id:"compare",type:"line"}],styles:{compare:{title:"Plot",histogramBase:0}},description:"Compare",shortDescription:"Compare",is_price_study:!0,inputs:[{defval:"close",id:"source",name:"Source",options:["open","high","low","close","hl2","hlc3","ohlc4"],type:"text"},{id:"symbol",name:"Symbol",type:"symbol",isHidden:!0}],id:"Compare@tv-basicstudies-1",format:{type:"inherit"}},constructor:function(){this.init=function(e,t){this._context=e,this._context.new_sym(t(1),r.Std.period(this._context))},this.main=function(e,t){this._context=e;var i=this._context.new_unlimited_var(this._context.symbol.time);this._context.select_sym(1);var s=this._context.new_unlimited_var(this._context.symbol.time),n=r.Std[t(0)](this._context),o=this._context.new_unlimited_var(n);return this._context.select_sym(0),[o.adopt(s,i,0)]}}},{name:"Overlay",metainfo:{_metainfoVersion:52,isTVScript:!1,
isTVScriptStub:!1,is_hidden_study:!0,defaults:{styles:{},inputs:{symbol:""}},plots:[{id:"open",type:"line"},{id:"high",type:"line"},{id:"low",type:"line"},{id:"close",type:"line"}],styles:{open:{title:"Open"},high:{title:"High"},low:{title:"Low"},close:{title:"Close"}},description:"Overlay",shortDescription:"Overlay",is_price_study:!1,inputs:[{id:"symbol",name:"symbol",defval:"",type:"symbol",isHidden:!0}],id:"Overlay@tv-basicstudies-1",format:{type:"price",precision:4}},constructor:function(){this.init=function(e,t){this._context=e,this._context.new_sym(t(0),r.Std.period(this._context))},this.main=function(e,t){this._context=e;var i=this._context.new_unlimited_var(this._context.symbol.time);this._context.select_sym(1);var s=this._context.new_unlimited_var(this._context.symbol.time),n=this._context.new_unlimited_var(r.Std.open(this._context)),o=this._context.new_unlimited_var(r.Std.high(this._context)),a=this._context.new_unlimited_var(r.Std.low(this._context)),l=this._context.new_unlimited_var(r.Std.close(this._context));return this._context.select_sym(0),[n.adopt(s,i,1),o.adopt(s,i,1),a.adopt(s,i,1),l.adopt(s,i,1)]}}},{name:"Volume",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{vol:{linestyle:0,linewidth:1,plottype:5,trackPrice:!1,transparency:50,visible:!0,color:"#000080"},vol_ma:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!1,color:"#2196F3"},smoothedMA:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!1,color:"#2196F3"}},palettes:{volumePalette:{colors:{0:{color:u,width:1,style:0},1:{color:p,width:1,style:0}}}},inputs:{showMA:!1,length:20,col_prev_close:!1,symbol:"",smoothingLine:"SMA",smoothingLength:9}},plots:[{id:"vol",type:"line"},{id:"volumePalette",palette:"volumePalette",target:"vol",type:"colorer"},{id:"vol_ma",type:"line"},{id:"smoothedMA",type:"line"}],styles:{vol:{title:"Volume",histogramBase:0},vol_ma:{title:"Volume MA",histogramBase:0},smoothedMA:{title:"Smoothed MA",histogramBase:0}},description:"Volume",shortDescription:"Volume",is_price_study:!1,palettes:{volumePalette:{colors:{0:{name:"Falling"},1:{name:"Growing"}}}},inputs:[{id:"symbol",name:"Other Symbol",defval:"",type:"symbol",optional:!0,isHidden:!1},{id:"showMA",name:"show MA",defval:!1,type:"bool",isHidden:!0},{id:"length",name:"MA Length",defval:20,type:"integer",min:1,max:2e3},{defval:!1,id:"col_prev_close",name:"Color based on previous close",type:"bool"},{id:"smoothingLine",name:"Smoothing Line",defval:"SMA",type:"text",options:["SMA","EMA","WMA"]},{id:"smoothingLength",name:"Smoothing Length",defval:9,type:"integer",min:1,max:1e4}],id:"Volume@tv-basicstudies-1",format:{type:"volume"}},constructor:function(){this.init=function(e,t){this._context=e,""!==t(0)&&this._context.new_sym(t(0),r.Std.period(this._context))},this.f_0=function(e,t){return r.Std.gt(e,t)?0:1},this.main=function(e,t){this._context=e,this._input=t
;var i=r.Std.volume(this._context),s=r.Std.open(this._context),n=r.Std.close(this._context),o=this._context.new_var(this._context.symbol.time),a=this._input(4),l=this._input(5);if(this._context.setMinimumAdditionalDepth(this._input(2)+l),""!==this._input(0)){this._context.select_sym(1);var c=this._context.new_var(this._context.symbol.time),h=this._context.new_var(r.Std.volume(this._context)),d=this._context.new_var(r.Std.open(this._context)),u=this._context.new_var(r.Std.close(this._context));i=h.adopt(c,o,1),s=d.adopt(c,o,1),n=u.adopt(c,o,1),this._context.select_sym(0)}var p,_,m=this._context.new_var(i),g=r.Std.sma(m,this._input(2),this._context),f=this._context.new_var(g),v=this._context.new_var(n);return p=v.get(1)&&this._input(3)?this.f_0(v.get(1),n):this.f_0(s,n),"EMA"===a?_=r.Std.ema(f,l,this._context):"WMA"===a?_=r.Std.wma(f,l,this._context):"SMA"===a&&(_=r.Std.sma(f,l,this._context)),[i,p,g,_]}}},{name:"ZigZag",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:2,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:5,in_1:10}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",target:"plot_0",type:"dataoffset"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Zig Zag",shortDescription:"ZigZag",is_price_study:!0,classId:"ScriptWithDataOffset",inputs:[{id:"in_0",name:"deviation",defval:5,type:"float",min:.001,max:100},{id:"in_1",name:"depth",defval:10,type:"integer",min:2,max:1e3}],id:"ZigZag@tv-basicstudies-1",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=i/100,o=Math.ceil(s/2);return[r.Std.zigzag(n,o,this._context),r.Std.zigzagbars(n,o,this._context)]}}},{name:"Sessions",metainfo:{_metainfoVersion:52,defaults:{graphics:{vertlines:{sessBreaks:{color:"#4985e7",style:2,visible:!1,width:1}},backgrounds:{preMarket:{color:"#FF9800",transparency:92,visible:!0},postMarket:{color:"#2196F3",transparency:92,visible:!0}}},linkedToSeries:!0},description:"Sessions",graphics:{vertlines:{sessBreaks:{name:"Session Break",halign:"left"}},backgrounds:{preMarket:{name:"Pre market"},postMarket:{name:"Post market"}}},id:"Sessions@tv-basicstudies-1",inputs:[],is_hidden_study:!0,is_price_study:!0,name:"Sessions@tv-basicstudies",palettes:{},plots:[],shortDescription:"Sessions",format:{type:"inherit"}},constructor:function(){function e(e,t){return{id:e,index:e,extendBottom:!0,extendTop:!0}}function t(e){return{id:e.start,start:e.start,stop:e.stop}}this.init=function(){this._times=[]},this._getVerticalLineData=function(t){return r.Std.selectSessionBreaks(t,this._times).map(e)},this._getPreAndPostMarketBackgroundsData=function(e){const i=r.Std.selectPreAndPostMarketTimes(e,this._times);return{preMarket:i.preMarket.map(t),postMarket:i.postMarket.map(t)}},this.main=function(e,t){if(r.Std.isdwm(e))return null;var i=r.Std.time(e);if(isNaN(i))return null;var s=this._times.length
;if(0!==s&&this._times[s-1]===i||this._times.push(i),!e.symbol.isLastBar||!e.symbol.isNewBar)return null;var n=this._getVerticalLineData(e),o=this._getPreAndPostMarketBackgroundsData(e);return 0===n.length&&0===o.preMarket.length&&0===o.postMarket?null:{nonseries:!0,type:"study_graphics",data:{graphicsCmds:{create:{vertlines:[{styleId:"sessBreaks",data:n}],backgrounds:[{styleId:"preMarket",data:o.preMarket},{styleId:"postMarket",data:o.postMarket}]},erase:[{action:"all"}]}}}}}},{name:"SuperTrend",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:3,plottype:0,trackPrice:!1,transparency:35,visible:!0,color:"#000080"},plot_2:{linestyle:0,linewidth:3,plottype:"shape_arrow_up",trackPrice:!1,location:"BelowBar",transparency:35,visible:!0,color:"#00FF00"},plot_3:{linestyle:0,linewidth:3,plottype:"shape_arrow_down",trackPrice:!1,location:"AboveBar",transparency:35,visible:!0,color:"#FF0000"}},palettes:{palette_0:{colors:{0:{color:"#008000",width:3,style:0},1:{color:"#800000",width:3,style:0}}}},inputs:{in_0:10,in_1:3}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",palette:"palette_0",target:"plot_0",type:"colorer"},{id:"plot_2",type:"shapes"},{id:"plot_3",type:"shapes"}],styles:{plot_0:{title:"SuperTrend",histogramBase:0,joinPoints:!1,isHidden:!1},plot_2:{title:"Up Arrow",histogramBase:0,joinPoints:!1,isHidden:!1},plot_3:{title:"Down Arrow",histogramBase:0,joinPoints:!1,isHidden:!1}},description:"SuperTrend",shortDescription:"SuperTrend",is_price_study:!0,palettes:{palette_0:{colors:{0:{name:"Color 0"},1:{name:"Color 1"}},valToIndex:{0:0,1:1}}},inputs:[{id:"in_0",name:"Length",defval:10,type:"integer",min:1,max:100},{id:"in_1",name:"Factor",defval:3,type:"float",min:1,max:100}],id:"SuperTrend@tv-basicstudies-1",scriptIdPart:"",name:"SuperTrend",isCustomIndicator:!0,format:{type:"inherit"}},constructor:function(){this.main=function(e,t){var i=t(0),s=t(1),[n,o]=r.Std.supertrend(s,i,e),a=e.new_var(o).get(1);return[n,-1===o?0:1,-1===o&&a!==o?1:NaN,1===o&&a!==o?1:NaN]}}},n,o,a,l,c,h,d])},279709:(e,t,i)=>{"use strict";i.d(t,{pivotPointsStandardStudyItem:()=>d});var s=i(603610),r=i(638273),n=i(914625);class o{constructor(){this.p=NaN,this.r1=NaN,this.s1=NaN,this.r2=NaN,this.s2=NaN,this.r3=NaN,this.s3=NaN,this.r4=NaN,this.s4=NaN,this.r5=NaN,this.s5=NaN,this.startIndex__t=NaN,this.endIndex__t=NaN}}class a{constructor(){this.pivots=[]}}function l(e,t){e.setUTCMonth(e.getUTCMonth()+t)}function c(e,t){if(s.Std.ismonthly(e)){let i=new Date(t);return i.getUTCDay()<function(e,t){return new Date(t,e,0).getDate()}(i.getUTCMonth(),i.getUTCFullYear())?(l(i,s.Std.interval(e)),i=s.Std.add_days_considering_dst("Etc/UTC",i,1-i.getUTCDay())):(i=s.Std.add_days_considering_dst("Etc/UTC",i,1),l(i,s.Std.interval(e))),i.valueOf()}return t+r.Interval.parse(e.symbol.resolution).inMilliseconds(t)}function h(e,t){switch(t){case"Auto":return function(e){const t=r.Interval.parse(e.symbol.interval+e.symbol.resolution);switch(t.kind()){case r.ResolutionKind.Weeks:
case r.ResolutionKind.Months:return"12M";case r.ResolutionKind.Days:return"1M";case r.ResolutionKind.Minutes:return t.multiplier()>=1&&t.multiplier()<=15?"1D":"1W";case r.ResolutionKind.Seconds:case r.ResolutionKind.Ticks:return"1D"}throw new Error("Unexpected resolution type: "+e.symbol.resolution)}(e);case"Daily":return"1D";case"Weekly":return"1W";case"Monthly":return"1M";case"Yearly":return"12M";default:throw new Error("No such pivTimeFrame: "+t)}}const d={name:"Pivot Points Standard",metainfo:{_metainfoVersion:44,defaults:{inputs:{kind:"Traditional",lookBack:15,pivTimeFrame:"Auto",showHistoricalPivots:!0},precision:"4"},description:"Pivot Points Standard",id:"PivotPointsStandard@tv-basicstudies-80",inputs:[{defval:"Traditional",id:"kind",name:"Type",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"],type:"text"},{defval:!0,id:"showHistoricalPivots",name:"Show historical pivots",type:"bool"},{defval:"Auto",id:"pivTimeFrame",name:"Pivots Timeframe",options:["Auto","Daily","Weekly","Monthly","Yearly"],type:"text"},{defval:15,id:"lookBack",max:5e3,min:1,name:"Number of Pivots Back",type:"integer"}],is_price_study:!0,linkedToSeries:!0,shortDescription:"Pivots",format:{type:"price",precision:4}},constructor:class{constructor(){this._secondaryRes="1D",this._firstMainSeriesBarTime=NaN}init(e,t){const i=t(0),r=t(1),o=t(2),l=t(3);this._data=new a,this._firstMainSeriesBarTime=NaN,this._kindPP=function(e){switch(e){case"Traditional":return 0;case"Fibonacci":return 1;case"Woodie":return 2;case"Classic":return 3;case"DeMark":return 4;case"Camarilla":return 5;default:throw new Error("Unknown kind "+e)}}(i),this._showHistoricalPivots=r,this._historicalPivotsToKeep=l,this._pivTimeFrame=o,this._isValidResolution=function(e,t){return!(s.Std.isdaily(e)&&"Daily"===t||s.Std.isweekly(e)&&("Daily"===t||"Weekly"===t)||s.Std.ismonthly(e)&&("Daily"===t||"Weekly"===t||"Monthly"===t))}(e,this._pivTimeFrame),this._isValidResolution||s.Std.error("You cannot see this pivot timeframe on this resolution"),this._isValidResolution&&(this._secondaryRes=h(e,this._pivTimeFrame),void 0!==e.symbol.info&&(0,n.findSuitableResolutionToBuildFrom)(this._secondaryRes,e.symbol.info).error&&(this._isValidResolution=!1,s.Std.error(`Resolution ${this._secondaryRes} is not supported for this symbol`))),e.new_sym(e.symbol.tickerid,this._secondaryRes)}main(e,t,i){if(!this._isValidResolution)return null;if(e.is_main_symbol(i))return isNaN(this._firstMainSeriesBarTime)&&(this._firstMainSeriesBarTime=e.symbol.time,this._removeUnusedPivots()),e.symbol.isLastBar&&e.symbol.isNewBar?this._createResponse():null;e.select_sym(1);const r=e.new_var(s.Std.open(e)),n=e.new_var(s.Std.high(e)),a=e.new_var(s.Std.low(e)),l=e.new_var(s.Std.close(e)),h=e.new_var(s.Std.time(e)),d=this._data,u=r.get(0),p=h.get(0),_=r.get(1),m=n.get(1),g=a.get(1),f=l.get(1),v=e.symbol.isLastBar;if(0!==d.pivots.length&&e.symbol.isNewBar){const e=d.pivots[d.pivots.length-1];e.endIndex__t!==p&&(e.endIndex__t=p)}if(0===e.symbol.index||!e.symbol.isNewBar)return e.select_sym(0),null
;const S=function(e,t,i,r,n,a,l,c){const h=new o;let d=NaN;const u=i-r;switch(c){case 0:d=(i+r+n)/3,h.p=d,h.r1=2*d-r,h.s1=2*d-i,h.r2=d+(i-r),h.s2=d-(i-r),h.r3=2*d+(i-2*r),h.s3=2*d-(2*i-r),h.r4=3*d+(i-3*r),h.s4=3*d-(3*i-r),h.r5=4*d+(i-4*r),h.s5=4*d-(4*i-r);break;case 1:d=(i+r+n)/3,h.p=d,h.r1=d+.382*u,h.s1=d-.382*u,h.r2=d+.618*u,h.s2=d-.618*u,h.r3=d+u,h.s3=d-u;break;case 2:d=(i+r+2*e)/4,h.p=d,h.r1=2*d-r,h.s1=2*d-i,h.r2=d+u,h.s2=d-u,h.r3=i+2*(d-r),h.s3=r-2*(i-d),h.r4=h.r3+u,h.s4=h.s3-u;break;case 3:d=(i+r+n)/3,h.p=d,h.r1=2*d-r,h.s1=2*d-i,h.r2=d+u,h.s2=d-u,h.r3=d+2*u,h.s3=d-2*u,h.r4=d+3*u,h.s4=d-3*u;break;case 4:let o=NaN;o=s.Std.equal(t,n)?i+r+2*n:s.Std.greater(n,t)?2*i+r+n:2*r+i+n,d=o/4,h.p=d,h.r1=o/2-r,h.s1=o/2-i;break;case 5:d=(i+r+n)/3,h.p=d,h.r1=n+1.1*u/12,h.s1=n-1.1*u/12,h.r2=n+1.1*u/6,h.s2=n-1.1*u/6,h.r3=n+1.1*u/4,h.s3=n-1.1*u/4,h.r4=n+1.1*u/2,h.s4=n-1.1*u/2;break;default:throw new Error("Unknown kind")}return h.startIndex__t=a,h.endIndex__t=l,h}(u,_,m,g,f,p,c(e,p),this._kindPP);return e.select_sym(0),this._showHistoricalPivots||(d.pivots=[]),d.pivots.push(S),d.pivots.length>this._historicalPivotsToKeep&&d.pivots.shift(),v?this._createResponse():null}_createResponse(){return 0===this._data.pivots.length?null:{nonseries:!0,type:"non_series_data",data:{data:this._data}}}_removeUnusedPivots(){const e=Math.max(this._data.pivots.findIndex((e=>e.startIndex__t>this._firstMainSeriesBarTime))-1,0);e>0&&this._data.pivots.splice(0,e)}}}},338140:(e,t,i)=>{"use strict";i.d(t,{ratioStudyItem:()=>n});var s=i(387605);class r extends s.SpreadRatioBase{_doCalculation(e,t,i,s){return e*t/(i*s)}}const n={name:"Ratio",metainfo:{_metainfoVersion:15,defaults:s.spreadRatioDefaults,plots:s.spreadRatioPlots,styles:s.spreadRatioStyles,description:"Ratio",shortDescription:"Ratio",is_price_study:!1,inputs:s.spreadRatioInputs,id:"Ratio@tv-basicstudies-1",format:{type:"price",precision:2}},constructor:r}},216475:(e,t,i)=>{"use strict";i.d(t,{regressionTrendStudyItem:()=>n});var s=i(603610);function r(e,t,i){const r={slope:NaN,average:NaN,intercept:NaN,stdDev:NaN,upDev:NaN,downDev:NaN,pearsons:NaN};return 0===e.length||(function(e,t){let i=0,s=0,r=0,n=0;for(let t=0;t<e.length;++t){const o=e[t],a=t+1;i+=a,s+=o,r+=a*a,n+=o*a}t.slope=(e.length*n-i*s)/(e.length*r-i*i),t.average=s/e.length,t.intercept=t.average-t.slope*i/e.length+t.slope}(e,r),function(e,t,i,r){let n=0,o=0,a=0,l=0,c=0,h=0,d=r.intercept;const u=e.length-1,p=r.intercept+r.slope*u/2;for(let s=0;s<=u;++s){let u=t[s]-d;u>n&&(n=u),u=d-i[s],u>o&&(o=u),u=e[s];const _=u-r.average,m=d-p;u-=d,a+=u*u,l+=_*_,c+=m*m,h+=_*m,d+=r.slope}r.stdDev=Math.sqrt(a/(0===u?1:u)),r.pearsons=s.Std.isZero(l)||s.Std.isZero(c)?0:h/Math.sqrt(l*c),r.upDev=n,r.downDev=o}(e,t,i,r)),r}const n={name:"Regression Trend",metainfo:{_metainfoVersion:51,description:"Regression Trend",format:{type:"inherit"},id:"RegressionTrend@tv-basicstudies-144",is_hidden_study:!0,is_price_study:!0,shortDescription:"Reg Trend",defaults:{inputs:{"first bar time":0,"last bar time":0,"lower diviation":-2,source:"close","upper diviation":2,
"use lower diviation":!0,"use upper diviation":!0},styles:{}},inputs:[{defval:2,id:"upper diviation",max:500,min:-500,name:"Upper Deviation",type:"float"},{defval:-2,id:"lower diviation",max:500,min:-500,name:"Lower Deviation",type:"float"},{defval:!0,id:"use upper diviation",name:"Use Upper Deviation",type:"bool"},{defval:!0,id:"use lower diviation",name:"Use Lower Deviation",type:"bool"},{defval:0,id:"first bar time",isHidden:!0,max:253370764800,min:-253370764800,name:"First bar time",type:"time"},{defval:0,id:"last bar time",isHidden:!0,max:253370764800,min:-253370764800,name:"Last bar time",type:"time"},{defval:"close",id:"source",name:"Source",options:["open","high","low","close","hl2","hlc3","ohlc4"],type:"source"}],plots:[]},constructor:class{constructor(){this._resultSent=!1}init(e,t){this._resultSent=!1,this._data={baseLine:{startPrice:NaN,endPrice:NaN},upLine:{startPrice:NaN,endPrice:NaN},downLine:{startPrice:NaN,endPrice:NaN},pearsons:NaN,startIndex__t:NaN,endIndex__t:NaN}}main(e,t){const i=t(6),n=e.new_unlimited_var(s.Std.time(e)),o=e.new_unlimited_var(s.Std.high(e)),a=e.new_unlimited_var(s.Std.low(e)),l=e.new_unlimited_var(s.Std[i](e));if(!e.symbol.isLastBar)return null;if(this._resultSent)return null;const c=t(0),h=t(1),d=t(2),u=t(3),p=t(4),_=t(5),m=n.indexOf(p),g=n.indexOf(_),f=[],v=[],S=[],y=[];for(let e=m;e>=g;--e)f.push(n.get(e)),v.push(o.get(e)),S.push(a.get(e)),y.push(l.get(e));return this._updateData(f,d,c,u,h,p,_,r(y,v,S)),this._resultSent=!0,{type:"non_series_data",nonseries:!0,data:{data:this._data}}}_updateData(e,t,i,s,r,n,o,a){const l=e.length-1;this._data.baseLine.startPrice=a.intercept,this._data.baseLine.endPrice=a.intercept+a.slope*l;const c=a.intercept+(t?a.stdDev*i:a.upDev);this._data.upLine.startPrice=c,this._data.upLine.endPrice=c+a.slope*l;const h=a.intercept+(s?a.stdDev*r:-a.downDev);this._data.downLine.startPrice=h,this._data.downLine.endPrice=h+a.slope*l,this._data.pearsons=a.pearsons,this._data.startIndex__t=n,this._data.endIndex__t=o}}}},387605:(e,t,i)=>{"use strict";i.d(t,{SpreadRatioBase:()=>r,spreadRatioDefaults:()=>n,spreadRatioInputs:()=>o,spreadRatioPlots:()=>a,spreadRatioStyles:()=>l});var s=i(603610);class r{init(e,t){e.new_sym(t(1),s.Std.period(e)),this._source=t(0),this._scaleFactor1=1,this._scaleFactor2=1}main(e,t){const i=e.symbol.time,r=s.Std[this._source](e);e.select_sym(1);const n=s.Std[this._source](e),o=e.new_unlimited_var(n),a=e.new_unlimited_var(e.symbol.time);if(e.select_sym(0),isNaN(i))return null;let l=a.indexOf(i);-1!==l&&a.get(l)!==i&&(l=-1);const c=l<0?NaN:o.get(l);return[this._doCalculation(this._scaleFactor1,r,this._scaleFactor2,c)]}}const n={styles:{plot1:{linestyle:0,linewidth:2,plottype:0,trackPrice:!1,transparency:35,color:"#800080",display:15}},precision:2,inputs:{source:"close",symbol2:""}},o=[{defval:"close",id:"source",name:"Source",options:["open","high","low","close","hl2","hlc3","ohlc4"],type:"text"},{id:"symbol2",name:"Symbol",type:"symbol",confirm:!0}],a=[{id:"plot1",type:"line"}],l={plot1:{title:"Plot",histogramBase:0}}},
806965:(e,t,i)=>{"use strict";i.d(t,{spreadStudyItem:()=>n});var s=i(387605);class r extends s.SpreadRatioBase{_doCalculation(e,t,i,s){return e*t-i*s}}const n={name:"Spread",metainfo:{_metainfoVersion:15,defaults:s.spreadRatioDefaults,plots:s.spreadRatioPlots,styles:s.spreadRatioStyles,description:"Spread",shortDescription:"Spread",is_price_study:!1,inputs:s.spreadRatioInputs,id:"Spread@tv-basicstudies-1",format:{type:"price",precision:2}},constructor:r}},364504:(e,t,i)=>{"use strict";i.d(t,{VbPCheckHaveVolumeExpr:()=>r});var s=i(603610);class r{constructor(e){this._haveAnyVolume=!1,this._isDisabled=!1,this._seriesGetter=e}update(e,t){if(this._haveAnyVolume||this._isDisabled)return;const i=this._seriesGetter.volume().get(e);0!==i&&Number.isFinite(i)&&(this._haveAnyVolume=!0),t&&(this._haveAnyVolume||s.Std.error("The data vendor doesn't provide volume data for this symbol."),this._isDisabled=!0)}}},256824:(e,t,i)=>{"use strict";i.d(t,{VolumeByPriceExpr:()=>_});var s=i(650151),r=i(218954),n=i(638273),o=i(603610),a=i(897583);class l extends a.GraphicsObj{constructor(e,t,i,r,n,o){super(e),(0,s.assert)(t<i),this._priceLow=this._mixinJSONObject.createDoubleField(t,"priceLow"),this._priceHigh=this._mixinJSONObject.createDoubleField(i,"priceHigh"),this._rate=this._mixinJSONObject.createDoubleArrayField(r,"rate"),this._firstBarTime=this._mixinJSONObject.createTimeField(n,"firstBarTime"),this._lastBarTime=this._mixinJSONObject.createTimeField(o,"lastBarTime")}isNaN(){return super.isNaN()||Number.isNaN(this._priceLow.get())||Number.isNaN(this._priceHigh.get())||0===this._rate.get().length}jsonName(){return"hhists"}primitiveData(){return{id:this.id(),priceHigh:this._priceHigh.get(),priceLow:this._priceLow.get(),rate:this._rate.get().slice(),firstBarTime:this._firstBarTime.get(),lastBarTime:this._lastBarTime.get()}}setPriceLow(e){this._priceLow.set(e)&&this._processObjUpdate()}priceLow(){return this._priceLow.get()}priceHigh(){return this._priceHigh.get()}setPriceHigh(e){this._priceHigh.set(e)&&this._processObjUpdate()}rate(){return this._rate.get().slice()}setRate(e){this._rate.set(e)&&this._processObjUpdate()}rateAt(e){return this._rate.get()[e]}ratesSum(){let e=0;for(const t of this._rate.get())!Number.isNaN(t)&&Number.isFinite(t)&&(e+=t);return e}firstBarTime(){return this._firstBarTime.get()}setFirstBarTime(e){this._firstBarTime.set(e)&&this._processObjUpdate()}lastBarTime(){return this._lastBarTime.get()}setLastBarTime(e){this._lastBarTime.set(e)&&this._processObjUpdate()}}var c=i(848818);class h{constructor(e,t,i){this.index=e,this.offset=i,this.level=t}isNaN(){return Number.isNaN(this.level)}equals(e){return e instanceof h&&(!this.isNaN()&&(!e.isNaN()&&(this.index===e.index&&this.offset===e.offset&&o.Std.equal(this.level,e.level))))}getLevel(){return this.level}getIndex(){return this.index}}class d extends a.GraphicsObj{constructor(e,t){super(e),this._points=[],t&&(this._points=t)}addPoint(e){this._processObjUpdate(),this._points.push(e)}addPoints(e){this._processObjUpdate(),this._points.push(...e)}setPoint(e,t){
const i=this._points[e];t.equals(i)||(this._processObjUpdate(),this._points[e]=t)}point(e){const t=this._points[e];return new h(t.index,t.level,t.offset)}points(){return this._points}pointsCount(){return this._points.length}setPoints(e){if(e.length===this._points.length){let t=!0;for(let i=0;i<e.length;++i)if(!e[i].equals(this._points[i])){t=!1;break}if(t)return}this._processObjUpdate(),this._points=[],this._points.push(...e)}clearPoints(){this._processObjUpdate(),this._points=[]}isNaN(){return super.isNaN()||this._points.length<3}jsonName(){return"polygons"}primitiveData(){return{id:this.id(),points:this._points.map((e=>({index:e.index,offset:e.offset,level:e.level})))}}}class u extends a.GraphicsObj{constructor(e,t,i,s,r=!1,n=!1){super(e),this._endIndex=this._mixinJSONObject.createTimeField(i,"endIndex"),this._extendLeft=this._mixinJSONObject.createField(r,"extendLeft"),this._extendRight=this._mixinJSONObject.createField(n,"extendRight"),this._level=this._mixinJSONObject.createDoubleField(s,"level"),this._startIndex=this._mixinJSONObject.createTimeField(t,"startIndex")}isNaN(){return super.isNaN()||Number.isNaN(this._level.get())||this._startIndex.get()<0||this._endIndex.get()<0||this._startIndex.get()===this._endIndex.get()&&!this._extendLeft.get()&&!this._extendRight.get()}jsonName(){return"horizlines"}primitiveData(){return{id:this.id(),startIndex:this._startIndex.get(),endIndex:this._endIndex.get(),extendLeft:this._extendLeft.get(),extendRight:this._extendRight.get(),level:this._level.get()}}startIndex(){return this._startIndex.get()}setStartIndex(e){this._startIndex.set(e)&&this._processObjUpdate()}endIndex(){return this._endIndex.get()}setEndIndex(e){this._endIndex.set(e)&&this._processObjUpdate()}level(){return this._level.get()}setLevel(e){this._level.set(e)&&this._processObjUpdate()}isExtendLeft(){return this._extendLeft.get()}setExtendLeft(e){this._extendLeft.set(e)&&this._processObjUpdate()}extendLeft(){return this.isExtendLeft()}isExtendRight(){return this._extendRight.get()}setExtendRight(e){this._extendRight.set(e)&&this._processObjUpdate()}extendRight(){return this.isExtendRight()}}class p{constructor(){this._map=new Map}get(e){const t=this._innerMap(e.start);return t&&t.get(e.end)}set(e,t){this._innerMap(e.start,!0).set(e.end,t)}clear(){this._map.clear()}size(){let e=0;return this._map.forEach((t=>e+=t.size)),e}_innerMap(e,t){let i=this._map.get(e);return void 0===i&&t&&(i=new Map,this._map.set(e,i)),i}}class _{constructor(e,t,i,r,n,o,a,l,h,d,u,_,m,g,f){this._freezedBoxes=new c.GraphicsList,this._freezedHists=new c.GraphicsList,this._freezedPocs=new c.GraphicsList,this._freezedVAHists=new c.GraphicsList,this._currentHistsGr=new c.GraphicsList,this._currentVAHistsGr=new c.GraphicsList,this._currentHists=[],this._currentHistsMap=new p,this._currentBox=null,this._currentPoc=null,this._historyBarSet=[],this._prevRtBar=null,this._minPrice=Number.POSITIVE_INFINITY,this._maxPrice=Number.NEGATIVE_INFINITY,this._leftBoxTime=null,this._rightBoxTime=null,this._actualRightBoxTime=null,this._needRecalc=!1,
this._largestHistItem=null,this._rowsLayout=null,this._currentVAStart=0,this._currentVAEnd=0,this._previousVAStart=0,this._previousVAEnd=0,this._idsGenerator=null,(0,s.assert)(1===e||2===e),this._numOfSubHists=e,this._outHists=r,this._outBoxLines=n,this._outPocLines=o,this._extendPocLeftRight=a,this._outVAHists=l,this._vaVolumePercent=h,this._rowsLayoutSupplier=d,this._outHists.addStable(this._freezedHists),this._outVAHists.addStable(this._freezedVAHists),this._maxHHistItems=u,this._layoutIsAutoselected=g,this._leftBoxTimeMutable=_,this._rightBoxTimeMutable=m,this._actualRightBoxTime=null!=f?f:m,this._ctx=t,this._seriesGetter=i}update(e){this._supplyRowsLayout(this._ctx),null===this._currentBox&&this._initCurrentBox(),null===this._currentPoc&&this._initCurrentPoc();const t=this._timeScale().get(e);this._leftBoxTime=this._leftBoxTimeMutable,this._rightBoxTime=this._rightBoxTimeMutable,this._ctx.symbol.isLastBar&&!Number.isNaN(this._rightBoxTime)&&(this._rightBoxTime=Math.min(t+n.Interval.parse(this._ctx.symbol.interval+this._ctx.symbol.resolution).inMilliseconds(t)-1,this._rightBoxTime));const i=o.Std.greaterOrEqual(this._seriesClose().get(e),this._seriesOpen().get(e)),s={high:this._seriesHigh().get(e),low:this._seriesLow().get(e),volume:this._seriesVol().get(e),isUp:i,time:t};this._updateCurrentHistogram(s),this._currentHists.length>0&&(this._largestHistItem=this._getLargestHistItem(),this._updateCurrentPoc(),this._seriesGetter.developingPoc().set(this._currentPoc.level()),this._updateValueArea(),this._vaVolumePercent>0&&(this._seriesGetter.developingVAHigh().set(this._currentHists[this._currentVAEnd].priceHigh()),this._seriesGetter.developingVALow().set(this._currentHists[this._currentVAStart].priceLow()))),this._updateCurrentBox(),this._rebuildOutData()}setIdsGeneratorProxy(e){this._idsGenerator=e}nextGraphicsObjId(){return(0,s.ensureNotNull)(this._idsGenerator).nextGraphicsObjId()}pushEraseObjCmd(e,t){(0,s.ensureNotNull)(this._idsGenerator).pushEraseObjCmd(e,t)}popEraseCmds(){return(0,s.ensureNotNull)(this._idsGenerator).popEraseCmds()}_timeScale(){return this._seriesGetter.time()}_seriesLow(){return this._seriesGetter.low()}_seriesHigh(){return this._seriesGetter.high()}_seriesVol(){return this._seriesGetter.volume()}_seriesOpen(){return this._seriesGetter.open()}_seriesClose(){return this._seriesGetter.close()}_freezeCurrentHistogramAndCleanup(){null!==this._currentBox&&this._freezedBoxes.add(this._currentBox),o.Std.greater(this._getVolume(this._currentHists),0)&&(this._freezedHists.addAll(this._currentHistsGr),this._freezedVAHists.addAll(this._currentVAHistsGr),null!==this._currentPoc&&this._freezedPocs.add(this._currentPoc)),this._currentHists=[],this._currentHistsGr.clear(),this._currentHistsMap.clear(),this._initCurrentBox(),this._initCurrentPoc(),this._currentVAHistsGr.clear(),this._historyBarSet=[],this._minPrice=Number.POSITIVE_INFINITY,this._maxPrice=Number.NEGATIVE_INFINITY,this._prevRtBar=null,this._leftBoxTime=null,this._rightBoxTime=null}_supplyRowsLayout(e){
null===this._rowsLayout&&e.symbol.isFirstBar&&e.symbol.isNewBar&&(this._rowsLayout=this._rowsLayoutSupplier())}_updateCurrentHistogram(e){if(this._needRecalc=!1,o.Std.greater(this._minPrice,e.low)&&(this._minPrice=e.low,this._needRecalc=!0),o.Std.less(this._maxPrice,e.high)&&(this._maxPrice=e.high,this._needRecalc=!0),this._ctx.symbol.isBarClosed&&this._historyBarSet.length>0){const t=this._historyBarSet[this._historyBarSet.length-1];t.time===e.time&&(this._prevRtBar=t,this._historyBarSet.pop())}this._needRecalc&&0===(0,s.ensureNotNull)(this._rowsLayout).type()?(this._recalculateCurrentResultsOnHistoryBarSet(),this._applyUpdateToCurrentResults(e,!1)):this._applyUpdateToCurrentResults(e,!0),this._ctx.symbol.isBarClosed?((0,s.assert)(null===this._prevRtBar||e.time===this._prevRtBar.time),this._historyBarSet.push(e),this._prevRtBar=null):this._prevRtBar=e}_getMidLevel(e){return(e.priceHigh()+e.priceLow())/2}_getMidLevelFromList(e){return e.length%2==0?e[e.length/2].priceLow():this._getMidLevel(e[Math.floor(e.length/2)])}_getLargestHistItem(){let e=[],t=this._currentHists[0];for(const i of this._currentHists)o.Std.greater(i.ratesSum(),t.ratesSum())?(t=i,e=[t]):o.Std.equal(i.ratesSum(),t.ratesSum())&&e.push(i);if(e.length>1){const i=this._getMidLevelFromList(this._currentHists);t=e[e.length-1];for(let s=e.length-2;s>=0;s--){const r=e[s];o.Std.lessOrEqual(Math.abs(this._getMidLevel(r)-i),Math.abs(this._getMidLevel(t)-i))&&(t=r)}}return t}_initCurrentPoc(){this._currentPoc=new u(this,0,0,0)}_updateCurrentPoc(){const e=(0,s.ensureNotNull)(this._currentPoc);e.setStartIndex((0,s.ensureNotNull)(this._leftBoxTime)),e.setEndIndex((0,s.ensureNotNull)(this._actualRightBoxTime)),e.setExtendLeft(this._extendPocLeftRight),e.setExtendRight(this._extendPocLeftRight);const t=this._getMidLevel((0,s.ensureNotNull)(this._largestHistItem));e.setLevel(t)}_getVolume(e){let t=0;for(const i of e)t+=i.ratesSum();return t}_getPocHistItemIndex(){for(let e=0;e<this._currentHists.length;e++)if(this._currentHists[e]===this._largestHistItem)return e;return-1}_calculateValueArea(){const e=this._getPocHistItemIndex();(0,s.assert)(e>=0,`ERROR - PocHistItemIndex == ${e}`),this._currentVAStart=e-1,this._currentVAEnd=e+1;const t=this._getVolume(this._currentHists)*this._vaVolumePercent*.01;let i=this._currentHists[e].ratesSum(),r=0,n=null;for(;o.Std.lessOrEqual(i+r,t)&&(i+=r,0===n?--this._currentVAStart:1===n&&++this._currentVAEnd,-1!==this._currentVAStart||this._currentVAEnd!==this._currentHists.length);){let t,i;if(this._currentVAStart>-1)if(t=this._currentHists[this._currentVAStart].ratesSum(),this._currentVAEnd<this._currentHists.length)if(i=this._currentHists[this._currentVAEnd].ratesSum(),o.Std.greater(t,i))r=t,n=0;else if(o.Std.greater(i,t))r=i,n=1;else{const s=Math.abs(e-this._currentVAStart),o=Math.abs(e-this._currentVAEnd);s<o?(r=t,n=0):o<=s&&(r=i,n=1)}else r=t,n=0;else r=this._currentHists[this._currentVAEnd].ratesSum(),n=1}this._currentVAStart++,this._currentVAEnd--}_isVA(e){
return e.priceHigh()>this._getMidLevel(this._currentHists[this._currentVAStart])&&e.priceLow()<this._getMidLevel(this._currentHists[this._currentVAEnd])}_updateValueArea(){if(this._calculateValueArea(),this._needRecalc||this._previousVAStart!==this._currentVAStart||this._previousVAEnd!==this._currentVAEnd){let e=0,t=0;for(;e<this._currentHistsGr.size()&&t<this._currentVAHistsGr.size();){for(;e<this._currentHistsGr.size()&&!this._isVA(this._currentHistsGr.get(e));)e++;for(;t<this._currentVAHistsGr.size()&&this._isVA(this._currentVAHistsGr.get(t));)t++;if(e<this._currentHistsGr.size()&&t<this._currentVAHistsGr.size()){const i=this._currentHistsGr.get(e);this._currentHistsGr.set(e,this._currentVAHistsGr.get(t)),this._currentVAHistsGr.set(t,i)}}for(;e<this._currentHistsGr.size();e++){const t=this._currentHistsGr.get(e);this._isVA(t)&&(this._currentHistsGr.remove(e),e--,this._currentVAHistsGr.add(t))}for(;t<this._currentVAHistsGr.size();t++){const e=this._currentVAHistsGr.get(t);this._isVA(e)||(this._currentVAHistsGr.remove(t),t--,this._currentHistsGr.add(e))}}this._previousVAStart=this._currentVAStart,this._previousVAEnd=this._currentVAEnd}_initCurrentBox(){this._currentBox=new d(this)}_updateCurrentBox(){let e=this._minPrice,t=this._maxPrice;this._currentHists.length>0&&(e=this._currentHists[0].priceLow(),t=this._currentHists[this._currentHists.length-1].priceHigh());const i=[],r=(0,s.ensureNotNull)(this._leftBoxTime),n=(0,s.ensureNotNull)(this._actualRightBoxTime);i.push(new h(r,e)),i.push(new h(r,t)),i.push(new h(n,t)),i.push(new h(n,e)),(0,s.ensureNotNull)(this._currentBox).setPoints(i)}_recalculateCurrentResultsOnHistoryBarSet(){for(let e=0;e<this._currentHists.length;++e)this._currentHists[e].erase();this._currentHists=[],this._currentHistsGr.clear(),this._currentVAHistsGr.clear(),this._currentHistsMap.clear();for(let e=0;e<this._historyBarSet.length;e++)this._addHistoryBarToHistogram(this._historyBarSet[e],e,this._currentHists,this._currentHistsMap,1);this._currentHists.length>0&&(this._largestHistItem=this._getLargestHistItem(),this._updateCurrentPoc()),this._updateCurrentBox()}_applyUpdateToCurrentResults(e,t){t&&null!==this._prevRtBar&&this._addHistoryBarToHistogram(this._prevRtBar,this._historyBarSet.length-1,this._currentHists,this._currentHistsMap,-1),this._addHistoryBarToHistogram(e,this._historyBarSet.length-1,this._currentHists,this._currentHistsMap,1),this._updateLastBarTimeInHistogram(this._currentHists)}_addHistoryBarToHistogram(e,t,i,r,n){(0,s.assert)(-1===n||1===n,"Please set sign argument either +1 or -1");const a=e.low,l=e.high,c=isNaN(e.volume)?0:e.volume,h=e.isUp,d=(0,s.ensureNotNull)(this._rowsLayout);d.init(this._ctx.symbol.minTick,this._minPrice,this._maxPrice,a,l);const u=d.rowWidth();if(!o.Std.greater(u,0))return;d.calculate();const p=d.getIndexLowVbP(),_=d.getIndexHighVbP(),m=d.getStartPrice();if(p===_){const e=p*u+m,t=(p+1)*u+m;this._updateResult({start:e,end:t},n*c,h,i,r)}else{let e=0;for(let t=p;t<=_;t++){const s=t*u+m,o=(t+1)*u+m,d=this._rowCoeff(s,o,a,l),p=d*c;e+=d,this._updateResult({
start:s,end:o},n*p,h,i,r)}(0,s.assert)(o.Std.equal(e,1,.05),`totalCoeff not equal 1! totalConf = ${e}`)}}_updateResult(e,t,i,r,n){const a=this._createRates(i,t);(0,s.assert)(null!==this._leftBoxTime,"leftBoxTime is not set (equals null)"),(0,s.assert)(null!==this._rightBoxTime,"rightBoxTime is not set (equals null)");const c=(0,s.ensureNotNull)(this._leftBoxTime),h=(0,s.ensureNotNull)(this._actualRightBoxTime);let d=n.get(e);if(void 0===d)d=new l(this,e.start,e.end,a,c,h),n.set(e,d),this._verifyHistogramSizeIsNotTooLarge(n.size()),this._currentHistsGr.add(d),_._addInOrder(d,r,0,r.length,((e,t)=>{let i=o.Std.compare(e.firstBarTime(),t.firstBarTime());return 0!==i?i:(i=o.Std.compare(e.priceLow(),t.priceLow()),0!==i?i:o.Std.compare(e.priceHigh(),t.priceHigh()))}));else{const e=[];for(let t=0;t<a.length;t++)e[t]=d.rateAt(t)+a[t];d.setRate(e)}}_rebuildOutData(){const e=this._currentHistsMap.size(),t=this._currentHists.length,i=this._currentHistsGr.size(),r=this._currentVAHistsGr.size();(0,s.assert)(e===t&&t===i+r,`Collections of HHistItems are out of sync ${e} ${t} ${i} ${r}`),this._outPocLines.clear(),this._outPocLines.addAll(this._freezedPocs),o.Std.greater(this._getVolume(this._currentHists),0)?(this._outHists.setVariable(this._currentHistsGr),this._outPocLines.add((0,s.ensureNotNull)(this._currentPoc)),this._outVAHists.setVariable(this._currentVAHistsGr)):(this._outHists.setVariable(null),this._outVAHists.setVariable(null)),this._outBoxLines.clear(),this._outBoxLines.addAll(this._freezedBoxes),this._outBoxLines.add((0,s.ensureNotNull)(this._currentBox))}_verifyHistogramSizeIsNotTooLarge(e){if(this._layoutIsAutoselected)return;if(e<=this._maxHHistItems)return;const t=(0,s.ensureNotNull)(this._rowsLayout);0===t.type()?o.Std.error('Histogram is too large, please reduce "Row Size" input.'):((0,s.assert)(1===t.type(),`Unexpected rowsLayout type ${t.type()}`),o.Std.error('Histogram is too large, please increase "Row Size" input.'))}_createRates(e,t){if(1===this._numOfSubHists)return[t];if(2===this._numOfSubHists){const i=[0,0];return i[e?0:1]=t,i}return(0,s.assert)(!1,`Incorrect value of numOfSubHists = ${this._numOfSubHists}`),[]}_updateLastBarTimeInHistogram(e){const t=(0,s.ensureNotNull)(this._actualRightBoxTime);for(const i of e)i.setLastBarTime(t)}_rowCoeff(e,t,i,s){const r=s-i;return(t-e-Math.max(t-s,0)-Math.max(0,i-e))/r}static _addInOrder(e,t,i,s,n){if(i===s)return void t.splice(i,0,e);const o=(0,r.toInt)((i+s)/2),a=t[o];n(e,a)<0?_._addInOrder(e,t,i,o,n):n(e,a)>0?_._addInOrder(e,t,o+1,s,n):t.splice(o,0,e)}}},747306:(e,t,i)=>{"use strict";i.d(t,{VolumeProfileBase:()=>d,maxHHistItems:()=>c,numOfSubHists:()=>h});var s=i(603610),r=i(638273);class n{constructor(e,t){this._minTick=NaN,this._minPrice=NaN,this._maxPrice=NaN,this._low=NaN,this._high=NaN,this._startPrice=NaN,this._indexLowVbP=NaN,this._indexHighVbP=NaN,this._rowSize=e,this._type=t}init(e,t,i,s,r){this._minTick=e,this._minPrice=t,this._maxPrice=i,this._low=s,this._high=r}getStartPrice(){return this._startPrice}setStartPrice(e){this._startPrice=e}
getIndexLowVbP(){return this._indexLowVbP}setIndexLowVbP(e){this._indexLowVbP=e}getIndexHighVbP(){return this._indexHighVbP}setIndexHighVbP(e){this._indexHighVbP=e}type(){return this._type}}class o extends n{constructor(e){super(e,0)}calculate(){this.setStartPrice(this._minPrice);const e=this.rowWidth();let t=Math.floor((this._low-this._minPrice)/e),i=Math.ceil((this._high-this._minPrice)/e)-1;t=Math.max(t,0),i=Math.max(i,0),i=Math.min(i,this._rowSize-1),t=Math.min(t,i),this.setIndexLowVbP(t),this.setIndexHighVbP(i)}rowWidth(){return Math.max((this._maxPrice-this._minPrice)/this._rowSize,this._minTick)}}class a extends n{constructor(e){super(e,1)}calculate(){this.setStartPrice(0);const e=this.rowWidth();let t=Math.floor(this._low/e);const i=Math.ceil(this._high/e)-1;t=Math.min(t,i),this.setIndexLowVbP(t),this.setIndexHighVbP(i)}rowWidth(){return this._minTick*this._rowSize}}var l=i(484727);function c(){return 6e3}function h(e){switch(e){case"Delta":case"Up/Down":return 2;case"Total":return 1;default:s.Std.error(`Invalid study argument value: ${e}`)}}class d{findBasicResolutionForFromTo(e,t,i,n){const o=(0,s.getVolumeProfileResolutionForPeriod)(e.value(),t,i,n),a=r.Interval.parse(o);return l.enabled("charting_library_debug_mode")&&console.log(`Selected resolution ${a.value()} for (${e.value()}, ${t}, ${i})`),a}verifyRowSizeInput(e,t){"Number Of Rows"===t&&e>6e3&&s.Std.error('Histogram is too large, please reduce "Row Size" input.')}_getRowsLayout(e,t){return"Number Of Rows"===e?new o(t):new a(t)}}},45170:(e,t,i)=>{"use strict";i.d(t,{volumeProfileFixedRangeBSStudyItem:()=>w,volumeProfileFixedRangeVbPStudyItem:()=>b});var s=i(650151),r=i(747306),n=i(603610),o=i(444649),a=i(507216),l=i(638273),c=i(188054),h=i(485922),d=i(635347),u=i(848818),p=i(387449),_=i(364504),m=i(795161),g=i(256824);class f extends g.VolumeByPriceExpr{constructor(e,t,i,s,r,n,o,a,l,c,h,d,u){super(e,t,i,n,o,a,!1,l,c,(()=>h),d,s,r,!1,u),this._firstBarTime=s,this._lastBarTime=r}update(e){this._supplyRowsLayout(this._ctx),this.timeInRequestedRange(e)&&super.update(e)}timeInRequestedRange(e){const t=this._timeScale().get(e);return this._firstBarTime<=t&&t<this._lastBarTime}}var v=i(909672);class S extends r.VolumeProfileBase{constructor(){super(...arguments),this._rowsLayout="Number Of Rows",this._rowSize=24,this._volume="Up/Down",this._firstBarTime=0,this._lastBarTime=0,this._vaVolumePercent=70,this._anInt=0,this._eraseCmds=[]}nextGraphicsObjId(){return++this._anInt}pushEraseObjCmd(e,t){this._eraseCmds.push(new d.EraseObj(e,t))}popEraseCmds(){const e=this._eraseCmds;return this._eraseCmds=[],e}init(e,t){this._studyDataUpdate=new p.JStudyDataUpdate(!0),this._hists=new c.GraphicsListColl,this._boxPolygons=new u.GraphicsList,this._pocLines=new u.GraphicsList,this._valueAreaHists=new c.GraphicsListColl;const i=new h.StudyGraphicsData;i.getObjsContainer("hhists").push(new h.Container("histBars2",this._hists)),i.getObjsContainer("hhists").push(new h.Container("histBarsVA",this._valueAreaHists)),
i.getObjsContainer("horizlines").push(new h.Container("pocLines",this._pocLines)),i.getObjsContainer("polygons").push(new h.Container("histBoxBg",this._boxPolygons)),this._studyDataUpdate.init(i),this._rowsLayout=t(0),this._rowSize=t(1),this._volume=t(2),this._firstBarTime=t(3),this._lastBarTime=t(4),this._vaVolumePercent=t(5),this.verifyRowSizeInput(this._rowSize,this._rowsLayout),this._originalResolution=l.Interval.parse(e.symbol.interval+e.symbol.resolution);const n=this._lastBarTime+this._originalResolution.inMilliseconds(this._lastBarTime);0===this._firstBarTime&&0===this._lastBarTime?this._basicResolution=this._originalResolution:this._basicResolution=this.findBasicResolutionForFromTo(this._originalResolution,this._firstBarTime,n,(0,s.ensureDefined)(e.symbol.info)),this._hasSecondarySymbol=!this._originalResolution.isEqualTo(this._basicResolution),this._hasSecondarySymbol&&e.new_sym(e.symbol.tickerid,this._basicResolution.value());const o=this._getRowsLayout(this._rowsLayout,this._rowSize);this._vbPCheckHaveVolumeExpr=new _.VbPCheckHaveVolumeExpr(this),this._volumeByPriceExpr=new f((0,r.numOfSubHists)(this._volume),e,this,this._firstBarTime,n,this._hists,this._boxPolygons,this._pocLines,this._valueAreaHists,this._vaVolumePercent,o,(0,r.maxHHistItems)(),this._lastBarTime),this._volumeByPriceExpr.setIdsGeneratorProxy(this),this._developingPocSeries=new v.VolumeProfileOutputSeries,this._developingVAHighSeries=new v.VolumeProfileOutputSeries,this._developingVALowSeries=new v.VolumeProfileOutputSeries}main(e,t,i){this._hasSecondarySymbol&&e.select_sym(1),this._timeSeries=e.new_unlimited_var(),this._openSeries=e.new_unlimited_var(),this._highSeries=e.new_unlimited_var(),this._lowSeries=e.new_unlimited_var(),this._closeSeries=e.new_unlimited_var(),this._volumeSeries=e.new_unlimited_var();const r={type:"composite",data:[]};if(i&&i.period===this._basicResolution.value()&&(this._timeSeries.set(n.Std.time(e)),this._openSeries.set(n.Std.open(e)),this._highSeries.set(n.Std.high(e)),this._lowSeries.set(n.Std.low(e)),this._closeSeries.set(n.Std.close(e)),this._volumeSeries.set(n.Std.volume(e)),this._developingPocSeries.addHist(n.Std.time(e)),this._developingVAHighSeries.addHist(n.Std.time(e)),this._developingVALowSeries.addHist(n.Std.time(e)),this._vbPCheckHaveVolumeExpr.update(0,e.symbol.isLastBar),this._volumeByPriceExpr.update(0),this._developingPocSeries.removeLastIfNaN(),this._developingVAHighSeries.removeLastIfNaN(),this._developingVALowSeries.removeLastIfNaN(),e.symbol.isLastBar)){this._studyDataUpdate.setEraseCmds(this.popEraseCmds()),this._studyDataUpdate.update();const e=this._studyDataUpdate.getUpdate();e.json&&r.data.push({nonseries:!0,type:"study_graphics",data:e.json}),e.jsonUpdate&&r.data.push({nonseries:!0,type:"study_graphics",data:e.jsonUpdate})}if(this._hasSecondarySymbol&&e.select_sym(0),i&&i.period===this._originalResolution.value()){(0,s.assert)(e.symbol.time===i.time);const t=i.time,n=t+this._originalResolution.inMilliseconds(t)-1;if(t&&t>=this._firstBarTime){
const e=this._developingPocSeries.getLeftOrEqual(n),t=this._developingVAHighSeries.getLeftOrEqual(n),i=this._developingVALowSeries.getLeftOrEqual(n);r.data.push([e,t,i])}else r.data.push([NaN,NaN,NaN])}return r}time(){return this._timeSeries}open(){return this._openSeries}high(){return this._highSeries}low(){return this._lowSeries}close(){return this._closeSeries}volume(){return this._volumeSeries}developingPoc(){return this._developingPocSeries}developingVAHigh(){return this._developingVAHighSeries}developingVALow(){return this._developingVALowSeries}}function y(e){return{constructor:S,name:e.description,metainfo:{_metainfoVersion:51,shortDescription:"VPFR",format:{type:"volume"},is_price_study:!0,defaults:{graphics:{hhists:{histBars2:{colors:["#1592e6","#fbc123"],direction:a.HHistDirection.LeftToRight,percentWidth:30,showValues:!1,transparencies:[76,76],valuesColor:"#424242",visible:!0},histBarsVA:{colors:["#1592e6","#fbc123"],direction:a.HHistDirection.LeftToRight,percentWidth:30,showValues:!1,transparencies:[30,30],valuesColor:"#424242",visible:!0}},horizlines:{pocLines:{color:"#ff0000",style:m.LineStyle.Solid,visible:!0,width:2}},polygons:{histBoxBg:{color:"#37a6ef",transparency:94}}},inputs:{first_bar_time:0,last_bar_time:0,rows:24,rowsLayout:"Number Of Rows",subscribeRealtime:!0,vaVolume:70,volume:"Up/Down"},styles:{developingPoc:{color:"#ff0000",linestyle:m.LineStyle.Solid,linewidth:1,plottype:o.LineStudyPlotStyle.StepLine,trackPrice:!1,transparency:0,display:0},developingVAHigh:{color:"#0000ff",linestyle:m.LineStyle.Solid,linewidth:1,plottype:o.LineStudyPlotStyle.StepLine,trackPrice:!1,transparency:0,display:0},developingVALow:{color:"#0000ff",linestyle:m.LineStyle.Solid,linewidth:1,plottype:o.LineStudyPlotStyle.StepLine,trackPrice:!1,transparency:0,display:0}}},graphics:{hhists:{histBars2:{location:a.HHistLocation.Absolute,title:"Volume Profile",titles:["Up Volume","Down Volume"]},histBarsVA:{location:a.HHistLocation.Absolute,title:"Value Area",titles:["Value Area Up","Value Area Down"]}},horizlines:{pocLines:{name:"POC",showPrice:!0}},polygons:{histBoxBg:{mouseTouchable:!1,name:"Histogram Box",showBorder:!1}}},inputs:[{defval:"Number Of Rows",id:"rowsLayout",name:"Rows Layout",options:["Number Of Rows","Ticks Per Row"],type:"text"},{defval:24,id:"rows",max:1e6,min:1,name:"Row Size",type:"integer"},{defval:"Up/Down",id:"volume",name:"Volume",options:["Up/Down","Total","Delta"],type:"text"},{defval:0,id:"first_bar_time",isHidden:!0,max:253370764800,min:-253370764800,name:"First Bar Time",type:"time"},{defval:0,id:"last_bar_time",isHidden:!0,max:253370764800,min:-253370764800,name:"Last Bar Time",type:"time"},{defval:70,id:"vaVolume",max:100,min:0,name:"Value Area Volume",type:"integer"},{defval:!0,id:"subscribeRealtime",isHidden:!0,name:"SubscribeRealtime",type:"bool"}],plots:[{id:"developingPoc",type:"line"},{id:"developingVAHigh",type:"line"},{id:"developingVALow",type:"line"}],styles:{developingPoc:{histogramBase:0,title:"Developing Poc"},developingVAHigh:{histogramBase:0,title:"Developing VA High"},
developingVALow:{histogramBase:0,title:"Developing VA Low"}},...e}}}const b=y({id:"VbPFixed@tv-volumebyprice-57",description:"Volume Profile Fixed Range"}),w=y({id:"VbPFixed@tv-basicstudies-152",description:"Fixed Range",is_hidden_study:!0})},909672:(e,t,i)=>{"use strict";i.d(t,{VolumeProfileOutputSeries:()=>n});var s=i(650151),r=i(624595);class n{constructor(){this._histPos=-1,this._hist=new Float64Array(2e3),this._times=new Float64Array(2e3)}addHist(e){if(this._histPos>=0){const t=this._times[this._histPos];(0,s.assert)(t<=e,"History order violation"),this._histPos+=t===e?0:1}else this._histPos+=1;if(this._histPos===this._hist.length){const e=new Float64Array(2*this._hist.length);e.set(this._hist),this._hist=e;const t=new Float64Array(this._hist.length);t.set(this._times),this._times=t}this._hist[this._histPos]=NaN,this._times[this._histPos]=e}removeLastIfNaN(){Number.isNaN(this.get(0))&&(this._histPos-=1)}get(e){(0,s.assert)(0===e);const t=this._histPos-e;return this._hist[t]}getLeftOrEqual(e){const t=(0,r.upperbound)(this._times,e,((e,t)=>e<t),0,this._histPos+1);return 0===t?NaN:this._hist[t-1]}set(e){this._hist[this._histPos]=e}indexOf(e){throw new Error("Not implemented")}}},778819:(e,t,i)=>{"use strict";i.d(t,{volumeProfileVisibleRangeStudyItem:()=>v});var s=i(650151),r=i(747306),n=i(603610),o=i(507216),a=i(638273),l=i(188054),c=i(256824),h=i(848818);class d extends c.VolumeByPriceExpr{constructor(e,t,i,s,r,n,o,a,l,c,d){super(e,t,i,n,new h.GraphicsList,o,!0,a,l,(()=>c),d,s,r,!1),this._firstBarTime=s,this._lastBarTime=r}update(e){this._supplyRowsLayout(this._ctx),this.timeInRequestedRange(e)&&super.update(e)}timeInRequestedRange(e){const t=this._timeScale().get(e);return this._firstBarTime<=t&&t<this._lastBarTime}}var u=i(485922),p=i(635347),_=i(387449),m=i(364504),g=i(909672);class f extends r.VolumeProfileBase{constructor(){super(...arguments),this._rowsLayout="Number Of Rows",this._rowSize=24,this._volume="Up/Down",this._firstBarTime=0,this._lastBarTime=0,this._vaVolumePercent=70,this._anInt=0,this._eraseCmds=[]}nextGraphicsObjId(){return++this._anInt}pushEraseObjCmd(e,t){this._eraseCmds.push(new p.EraseObj(e,t))}popEraseCmds(){const e=this._eraseCmds;return this._eraseCmds=[],e}init(e,t){this._studyDataUpdate=new _.JStudyDataUpdate(!0),this._hists=new l.GraphicsListColl,this._pocLines=new h.GraphicsList,this._valueAreaHists=new l.GraphicsListColl;const i=new u.StudyGraphicsData;i.getObjsContainer("hhists").push(new u.Container("histBars2",this._hists)),i.getObjsContainer("hhists").push(new u.Container("histBarsVA",this._valueAreaHists)),i.getObjsContainer("horizlines").push(new u.Container("pocLines",this._pocLines)),this._studyDataUpdate.init(i),this._rowsLayout=t(0),this._rowSize=t(1),this._volume=t(2),this._firstBarTime=t(3),this._lastBarTime=t(4),this._vaVolumePercent=t(5),this.verifyRowSizeInput(this._rowSize,this._rowsLayout),this._originalResolution=a.Interval.parse(e.symbol.interval+e.symbol.resolution);const n=this._lastBarTime+this._originalResolution.inMilliseconds(this._lastBarTime)
;0===this._firstBarTime&&0===this._lastBarTime?this._basicResolution=this._originalResolution:this._basicResolution=this.findBasicResolutionForFromTo(this._originalResolution,this._firstBarTime,n,(0,s.ensureDefined)(e.symbol.info)),this._hasSecondarySymbol=!this._originalResolution.isEqualTo(this._basicResolution),this._hasSecondarySymbol&&e.new_sym(e.symbol.tickerid,this._basicResolution.value());const o=this._getRowsLayout(this._rowsLayout,this._rowSize);this._vbPCheckHaveVolumeExpr=new m.VbPCheckHaveVolumeExpr(this),this._volumeByPriceExpr=new d((0,r.numOfSubHists)(this._volume),e,this,this._firstBarTime,n,this._hists,this._pocLines,this._valueAreaHists,this._vaVolumePercent,o,(0,r.maxHHistItems)()),this._volumeByPriceExpr.setIdsGeneratorProxy(this),this._developingPocSeries=new g.VolumeProfileOutputSeries,this._developingVAHighSeries=new g.VolumeProfileOutputSeries,this._developingVALowSeries=new g.VolumeProfileOutputSeries}main(e,t,i){this._hasSecondarySymbol&&e.select_sym(1),this._timeSeries=e.new_unlimited_var(),this._openSeries=e.new_unlimited_var(),this._highSeries=e.new_unlimited_var(),this._lowSeries=e.new_unlimited_var(),this._closeSeries=e.new_unlimited_var(),this._volumeSeries=e.new_unlimited_var();const r={type:"composite",data:[]};if(i&&i.period===this._basicResolution.value()&&(this._timeSeries.set(n.Std.time(e)),this._openSeries.set(n.Std.open(e)),this._highSeries.set(n.Std.high(e)),this._lowSeries.set(n.Std.low(e)),this._closeSeries.set(n.Std.close(e)),this._volumeSeries.set(n.Std.volume(e)),this._developingPocSeries.addHist(n.Std.time(e)),this._developingVAHighSeries.addHist(n.Std.time(e)),this._developingVALowSeries.addHist(n.Std.time(e)),this._vbPCheckHaveVolumeExpr.update(0,e.symbol.isLastBar),this._volumeByPriceExpr.update(0),this._developingPocSeries.removeLastIfNaN(),this._developingVAHighSeries.removeLastIfNaN(),this._developingVALowSeries.removeLastIfNaN(),e.symbol.isLastBar)){this._studyDataUpdate.setEraseCmds(this.popEraseCmds()),this._studyDataUpdate.update();const e=this._studyDataUpdate.getUpdate();e.json&&r.data.push({nonseries:!0,type:"study_graphics",data:e.json}),e.jsonUpdate&&r.data.push({nonseries:!0,type:"study_graphics",data:e.jsonUpdate})}if(this._hasSecondarySymbol&&e.select_sym(0),i&&i.period===this._originalResolution.value()){(0,s.assert)(e.symbol.time===i.time);const t=i.time,n=t+this._originalResolution.inMilliseconds(t)-1;if(t&&t>=this._firstBarTime){const e=this._developingPocSeries.getLeftOrEqual(n),t=this._developingVAHighSeries.getLeftOrEqual(n),i=this._developingVALowSeries.getLeftOrEqual(n);r.data.push([e,t,i])}else r.data.push([NaN,NaN,NaN])}return r}time(){return this._timeSeries}open(){return this._openSeries}high(){return this._highSeries}low(){return this._lowSeries}close(){return this._closeSeries}volume(){return this._volumeSeries}developingPoc(){return this._developingPocSeries}developingVAHigh(){return this._developingVAHighSeries}developingVALow(){return this._developingVALowSeries}}const v={constructor:f,name:"Volume Profile Visible Range",metainfo:{
_metainfoVersion:51,id:"VbPVisible@tv-basicstudies-49",description:"Volume Profile Visible Range",shortDescription:"VPVR",format:{type:"volume"},is_price_study:!0,linkedToSeries:!0,palettes:{},inputs:[{id:"rowsLayout",name:"Rows Layout",defval:"Number Of Rows",options:["Number Of Rows","Ticks Per Row"],type:"text"},{id:"rows",name:"Row Size",defval:24,max:1e6,min:1,type:"integer"},{id:"volume",name:"Volume",defval:"Up/Down",options:["Up/Down","Total","Delta"],type:"text"},{id:"first_visible_bar_time",name:"First Visible Bar Time",defval:0,isHidden:!0,max:253370764800,min:-253370764800,type:"time"},{id:"last_visible_bar_time",name:"Last Visible Bar Time",defval:0,isHidden:!0,max:253370764800,min:-253370764800,type:"time"},{id:"vaVolume",name:"Value Area Volume",defval:70,max:100,min:0,type:"integer"}],plots:[{id:"developingPoc",type:"line"},{id:"developingVAHigh",type:"line"},{id:"developingVALow",type:"line"}],graphics:{hhists:{histBars2:{location:o.HHistLocation.Relative,title:"Volume Profile",titles:["Up Volume","Down Volume"]},histBarsVA:{location:o.HHistLocation.Relative,title:"Value Area",titles:["Value Area Up","Value Area Down"]}},horizlines:{pocLines:{name:"POC",showPrice:!0}}},defaults:{graphics:{hhists:{histBars2:{colors:["#1592e6","#fbc123"],direction:o.HHistDirection.RightToLeft,percentWidth:30,showValues:!1,transparencies:[76,76],valuesColor:"#424242",visible:!0},histBarsVA:{colors:["#1592e6","#fbc123"],direction:o.HHistDirection.RightToLeft,percentWidth:30,showValues:!1,transparencies:[30,30],valuesColor:"#424242",visible:!0}},horizlines:{pocLines:{color:"#ff0000",style:0,visible:!0,width:2}}},inputs:{first_visible_bar_time:0,last_visible_bar_time:0,rows:24,rowsLayout:"Number Of Rows",vaVolume:70,volume:"Up/Down"},styles:{developingPoc:{color:"#ff0000",linestyle:0,linewidth:1,plottype:9,trackPrice:!1,transparency:0,display:0},developingVAHigh:{color:"#0000ff",linestyle:0,linewidth:1,plottype:9,trackPrice:!1,transparency:0,display:0},developingVALow:{color:"#0000ff",linestyle:0,linewidth:1,plottype:9,trackPrice:!1,transparency:0,display:0}}},styles:{developingPoc:{histogramBase:0,title:"Developing Poc"},developingVAHigh:{histogramBase:0,title:"Developing VA High"},developingVALow:{histogramBase:0,title:"Developing VA Low"}}}}},886115:(e,t,i)=>{"use strict";i.d(t,{StudyError:()=>s});class s extends Error{constructor(e){super(e),this.studyError=!0}}},635347:(e,t,i)=>{"use strict";i.d(t,{EraseObj:()=>s,EraseAll:()=>r,GraphicsCmds:()=>n});class s{constructor(e,t){this.id=e,this.type=t}primitiveData(){return{action:"one",id:this.id,type:this.type}}}class r{primitiveData(){return{action:"all"}}}class n{constructor(){this.erase=[],this.create=null,this._modified=!1}primitiveData(e){if(this.isNaN())return null;const t={},i=this.create&&this.create.primitiveData(e);return null!==i&&(t.create=i),null!==this.erase&&this.erase.length>0&&(t.erase=this.erase.map((e=>e.primitiveData()))),void 0===t.create&&void 0===t.erase?null:t}setCreate(e){this.create=e,this.create.forEachList((e=>e.setOwner(this)))}isNaN(){
return(null===this.erase||0===this.erase.length)&&null===this.create}isModified(){return this._modified}setModified(e){this._modified=e}dirty(){this._modified=!0}setOwner(e){throw new Error("Unsupported")}}},188054:(e,t,i)=>{"use strict";i.d(t,{GraphicsListColl:()=>s});class s{constructor(){this._stable=[],this._variable=null,this._owner=null}addStable(e){e.setOwner(this),this._stable.push(e)}setVariable(e){this._variable=e,null!==this._variable&&this._variable.setOwner(this)}primitivesData(e){const t=[];return this._forEach((i=>t.push(...i.primitivesData(e)))),t}deleteErasedItems(){this._forEach((e=>e.deleteErasedItems()))}markPostedItems(){this._forEach((e=>e.markPostedItems()))}isNaN(){return this._all((e=>e.isNaN()))}dirty(){null!==this._owner&&this._owner.dirty()}setOwner(e){this._owner=e}_forEach(e){for(const t of this._stable)e(t);null!==this._variable&&e(this._variable)}_all(e){for(const t of this._stable)if(!e(t))return!1;return null===this._variable||e(this._variable)}}},848818:(e,t,i)=>{"use strict";i.d(t,{GraphicsList:()=>n});var s=i(897583),r=i(317513);class n{constructor(){this._items=[],this._owner=null}primitivesData(e){const t=[];for(const i of this._items)e.isIgnoredObj(i)||t.push(i.primitiveData());return t}get(e){return this._items[e]}set(e,t){return this.dirty(),t.setOwner(this),this._items[e]=t,t}addAtIndex(e,t){this.dirty(),t.setOwner(this),this._items[e]=t}clear(){this._unsetOwner(this._items),this._items=[],this.dirty()}addAllFromNumber(e,t){this.setOwner(t),this._items.splice(e,0,...t._items);return this._setCachedDataValid(!1),true}addAll(e){this.setOwner(e),this._items.push(...e._items);return this._setCachedDataValid(!1),true}remove(e){const t=this._items[e];return this._items.splice(e,1),t.unsetOwner(this),this.dirty(),t}getItems(){return this._items}size(){return this._items.length}add(e){e.setOwner(this),this._items.push(e);return this._setCachedDataValid(!1),true}deleteErasedItems(){this._items=this._items.filter((e=>!e.isErased()))}markPostedItems(){for(const e of this._items)e.markAsPosted()}isNaN(){if(0===this._items.length)return!0;for(const e of this._items){if(!(0,r.isNaNable)(e))return!1;if(!e.isNaN())return!1}return!0}setOwner(e){this._owner=e}dirty(){null!==this._owner&&this._owner.dirty()}_unsetOwner(e){for(const t of e)t instanceof s.GraphicsObj&&t.unsetOwner(this)}_setCachedDataValid(e){e||this.dirty()}}},897583:(e,t,i)=>{"use strict";i.d(t,{GraphicsObj:()=>l});var s=i(603610);class r{constructor(e,t,i,s){this._value=e,this._name=t,this._owner=i,this._comparer=void 0!==s?s:(e,t)=>null==e?null!=t:e===t}getName(){return this._name}set(e){const t=this._comparer(this._value,e);return t&&this._owner.dirty(),this._value=e,t}get(){return this._value}}class n{constructor(e,t,i){this._owner=null,this._value=e,this._name=t,this._owner=i}getName(){return this._name}set(e){return this._value!==e&&(this._value=e,null!==this._owner&&this._owner.dirty(),!0)}get(){return this._value}}class o extends r{constructor(e,t,i,s){super(e,t,i,s)}}class a{constructor(e){this._owner=e}
createField(e,t){return new r(e,t,this)}createDoubleField(e,t){return new r(e,t,this,((e,t)=>!s.Std.equal(e,t)))}createDoubleArrayField(e,t){return new o(e,t,this,((e,t)=>{if(e===t)return!1;const i=e.length;if(t.length!==i)return!0;for(let r=0;r<i;r++){const i=e[r],n=t[r];if(!s.Std.equal(i,n))return!0}return!1}))}createTimeField(e,t){return new n(e,t,this)}dirty(){null!==this._owner&&this._owner.dirty()}setOwner(e){this._owner=e}}class l{constructor(e){this._mixinJSONObject=new a(this),this._state=0,this._owner=null,this._gen=e,this._id=e.nextGraphicsObjId(),this._id2=this._mixinJSONObject.createField(this.id(),"id")}dirty(){null!==this._owner&&this._owner.dirty()}setOwner(e){this._owner=e}id(){return this._id}unsetOwner(e){this._owner===e&&(this._owner=null)}state(){return this._state}erase(){1===this._state&&this._gen.pushEraseObjCmd(this._id,this.jsonName()),this._state=2,this.dirty()}markAsPosted(){1!==this._state&&(this._state=1,this.dirty())}isErased(){return 2===this._state}isPosted(){return 1===this._state}isNaN(){return!1}_processObjUpdate(){1===this._state&&(this._gen.pushEraseObjCmd(this._id,this.jsonName()),this._id=this._gen.nextGraphicsObjId(),this._id2.set(this._id),this._state=0),this.dirty()}}},317513:(e,t,i)=>{"use strict";function s(e){return Boolean(e.isNaN)}i.d(t,{isNaNable:()=>s})},387449:(e,t,i)=>{"use strict";i.d(t,{JStudyDataUpdate:()=>d});var s=i(635347);class r{constructor(){this.isUpdate=!1,this.graphicsCmds=new s.GraphicsCmds,this._offsetsChanged=!1,this._disableGraphicsAndData=!1}isNaN(){return this.graphicsCmds.isNaN()}primitiveData(e){const t={};if(!this._disableGraphicsAndData){const i=this.graphicsCmds.primitiveData(e);null!==i&&(t.graphicsCmds=i)}return this.isUpdate&&(t.isUpdate=!0),void 0===t.graphicsCmds?void 0:t}disable(){this._disableGraphicsAndData=!0}checkForChangeAndResetChangedState(e){const t=this._offsetsChanged,i=this.graphicsCmds.isModified();this.graphicsCmds.setModified(!1),this._offsetsChanged=!1;return i||t||0!==e.length}}var n=i(486028),o=i(317513);function a(e){return Boolean(e.isPosted)}class l{isIgnoredObj(e,t){return l.isIgnoredObjDefault(e,t)}static isIgnoredObjDefault(e,t){if(void 0===t)return l.isIgnoredObjNaNable(e);const i=e[t];return l.isIgnoredByGeneralRules(e,t)||l.isIgnoredObjNaNable(i)||l.isIgnoredObjListOfNaNables(i)}static isIgnoredObjNaNable(e){return(0,o.isNaNable)(e)&&e.isNaN()}static isIgnoredObjListOfNaNables(e){if(!(0,n.isArray)(e))return!1;let t=!0;for(const i of e)if(!(0,o.isNaNable)(i)||!i.isNaN()){t=!1;break}return t}static isIgnoredObjPosted(e){return a(e)&&e.isPosted()}static isIgnoredObjErased(e){return a(e)&&e.isErased()}static isIgnoredByGeneralRules(e,t){const i=e[t];return(0,n.isArray)(i)&&0===i.length}}class c{isIgnoredObj(e,t){if(void 0===t)return l.isIgnoredObjDefault(e)||l.isIgnoredObjErased(e);const i=e[t];return l.isIgnoredObjDefault(e,t)||l.isIgnoredObjErased(i)}}class h{isIgnoredObj(e,t){if(void 0===t)return l.isIgnoredObjDefault(e)||l.isIgnoredObjErased(e)||l.isIgnoredObjPosted(e);const i=e[t]
;return l.isIgnoredObjDefault(e,t)||l.isIgnoredObjErased(i)||l.isIgnoredObjPosted(i)}}class d extends class extends class{constructor(e){this._dataObj=new r,this._isDirty=!1,this._eraseCmds=[],this._enableCmdDataStudy=e}init(e){this._dataObj.graphicsCmds.setCreate(e),this.update(!0)}dataObj(){return this._dataObj}setEraseCmds(e){this._eraseCmds=e}resetDirtyState(){this._isDirty=!1}disable(){this._dataObj.disable()}}{constructor(e){super(e),this._snapshotPredicate=new c,this._dataSnapShot={}}getData(){return this._dataSnapShot}getUpdate(){return this._isDirty?this._dataSnapShot:{}}update(e){(this._dataObj.checkForChangeAndResetChangedState(this._eraseCmds)||e)&&(null!==this._dataObj.graphicsCmds.create&&(this._dataObj.graphicsCmds.create.deleteErasedObjs(),this._dataObj.graphicsCmds.erase=[new s.EraseAll]),this._makeSnapshot(),this._isDirty=!0)}_makeSnapshot(){this._json=this._dataObj.primitiveData(this._snapshotPredicate),this._dataSnapShot={json:this._json}}}{constructor(e){super(e),this._updatePredicate=new h,this._sendShapshotOnly=!0,this._isFirstNotForcedUpdate=!0}update(e){(this._dataObj.checkForChangeAndResetChangedState(this._eraseCmds)||e)&&(null!==this._dataObj.graphicsCmds.create&&(this._dataObj.graphicsCmds.erase=[new s.EraseAll]),this._dataObj.isUpdate=!0,this._makeSnapshot(),null!==this._dataObj.graphicsCmds.create&&(this._dataObj.graphicsCmds.erase=this._eraseCmds),this._dataObj.isUpdate=!0,this._jsonUpdate=this._dataObj.primitiveData(this._updatePredicate),null!==this._dataObj.graphicsCmds.create&&this._dataObj.graphicsCmds.create.deleteErasedAndMarkPostedObjs(),this._sendShapshotOnly=e||this._isFirstNotForcedUpdate,this._isFirstNotForcedUpdate=Boolean(e),this._isDirty=!0)}getUpdate(){return this._isDirty?this._enableCmdDataStudy?{json:this._sendShapshotOnly?this._json:void 0,jsonUpdate:this._sendShapshotOnly?void 0:this._jsonUpdate}:{json:this._json,jsonUpdate:this._sendShapshotOnly?void 0:this._jsonUpdate}:{}}}},485922:(e,t,i)=>{"use strict";i.d(t,{StudyGraphicsData:()=>r,Container:()=>n});var s=i(650151);class r{constructor(){this._horizlines=[],this._hhists=[],this._polygons=[],this._vertlines=[],this._containersCache=[],this._containerNamesCache=[],this._containersMapCache=new Map,this._addToCache("horizlines",this._horizlines),this._addToCache("hhists",this._hhists),this._addToCache("polygons",this._polygons),this._addToCache("vertlines",this._vertlines)}primitiveData(e){const t={};let i=!1;for(const s of this._containerNamesCache){const r=[],n=this.getObjsContainer(s);for(const t of n){if(t.isNaN())continue;const i=t.primitiveData(e);i.data.length>0&&r.push(i)}r.length>0&&(t[s]=r,i=!0)}return i?t:null}deleteErasedAndMarkPostedObjs(){this.forEachList((e=>{e.deleteErasedItems(),e.markPostedItems()}))}deleteErasedObjs(){this.forEachList((e=>e.deleteErasedItems()))}getObjsContainer(e){return(0,s.ensureDefined)(this._containersMapCache.get(e))}forEachList(e){for(const t of this._containersCache)for(const i of t)e(i.data)}_addToCache(e,t){this._containersCache.push(t),
this._containerNamesCache.push(e),this._containersMapCache.set(e,t)}}class n{constructor(e,t){this.styleId=e,this.data=t}isNaN(){return this.data.isNaN()}primitiveData(e){return{styleId:this.styleId,data:this.data.primitivesData(e)}}}},951008:(e,t,i)=>{"use strict";const s=i(676507).getHexColorByName;var r=i(603610);const n=s("color-ripe-red-100"),o=s("color-ripe-red-200"),a=s("color-ripe-red-500"),l=s("color-ripe-red-900"),c=s("color-ripe-red-a200"),h=s("color-minty-green-100"),d=s("color-minty-green-400"),u=s("color-minty-green-500");JSServer.studyLibrary=[{name:"Accumulation/Distribution",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Accumulation/Distribution",shortDescription:"Accum/Dist",is_price_study:!1,inputs:[],id:"Accumulation/Distribution@tv-basicstudies-1",scriptIdPart:"",name:"Accumulation/Distribution",format:{type:"volume"}},constructor:function(){this.f_0=function(e,t,i,s){return r.Std.or(r.Std.and(r.Std.eq(e,t),r.Std.eq(e,i)),r.Std.eq(t,i))?0:(2*e-i-t)/(t-i)*s},this.main=function(e,t){this._context=e,this._input=t;var i=this.f_0(r.Std.close(this._context),r.Std.high(this._context),r.Std.low(this._context),r.Std.volume(this._context));return[r.Std.cum(i,this._context)]}}},{name:"Accumulative Swing Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:10}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"ASI",histogramBase:0,joinPoints:!1}},description:"Accumulative Swing Index",shortDescription:"ASI",is_price_study:!1,inputs:[{id:"in_0",name:"Limit Move Value",defval:10,type:"float",min:.1,max:1e5}],id:"Accumulative Swing Index@tv-basicstudies-1",scriptIdPart:"",name:"Accumulative Swing Index",format:{type:"volume"}},constructor:function(){this.f_0=function(e,t){var i=t.new_var(r.Std.open(t)),s=t.new_var(r.Std.high(t)),n=t.new_var(r.Std.low(t)),o=t.new_var(r.Std.close(t)),a=r.Std.abs(s-o.get(1)),l=r.Std.abs(n-o.get(1)),c=r.Std.abs(s-n),h=r.Std.abs(o.get(1)-i.get(1)),d=r.Std.max(a,l),u=r.Std.iff(a>=r.Std.max(l,c),a-.5*l+.25*h,r.Std.iff(l>=r.Std.max(a,c),l-.5*a+.25*h,c+.25*h));return r.Std.iff(0===u,0,(o-o.get(1)+.5*(o-i)+.25*(o.get(1)-i.get(1)))/u*d/e*50)},this.f_1=function(e,t){var i=this.f_0(e,t);return r.Std.cum(i,t)},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0);return[this.f_1(i,this._context)]}}},{name:"Advance/Decline",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:10}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},
description:"Advance/Decline",shortDescription:"AD",is_price_study:!1,inputs:[{id:"in_0",name:"length",defval:10,type:"integer",min:1,max:2e3}],id:"Advance/Decline@tv-basicstudies-1",scriptIdPart:"",name:"Advance/Decline",format:{precision:2,type:"price"}},constructor:function(){this.f_0=function(e,t){return r.Std.gt(e,t)},this.f_1=function(e,t){return r.Std.lt(e,t)},this.f_2=function(e,t){return 0===t?e:e/t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this.f_0(r.Std.close(this._context),r.Std.open(this._context)),n=this._context.new_var(s),o=r.Std.sum(n,i,this._context),a=this.f_1(r.Std.close(this._context),r.Std.open(this._context)),l=this._context.new_var(a),c=r.Std.sum(l,i,this._context);return[this.f_2(o,c)]}}},{name:"Arnaud Legoux Moving Average",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:9,in_1:.85,in_2:6}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Arnaud Legoux Moving Average",shortDescription:"ALMA",is_price_study:!0,inputs:[{id:"in_0",name:"Window Size",defval:9,type:"integer",min:0,max:5e3},{id:"in_1",name:"Offset",defval:.85,type:"float",min:-1e12,max:1e12},{id:"in_2",name:"Sigma",defval:6,type:"float",min:-1e12,max:1e12}],id:"Arnaud Legoux Moving Average@tv-basicstudies-1",scriptIdPart:"",name:"Arnaud Legoux Moving Average",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._input(0),n=this._input(1),o=this._input(2),a=this._context.new_var(i);return[r.Std.alma(a,s,n,o)]}}},{name:"Aroon",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FB8C00"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:14}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"Upper",histogramBase:0,joinPoints:!1},plot_1:{title:"Lower",histogramBase:0,joinPoints:!1}},description:"Aroon",shortDescription:"Aroon",is_price_study:!1,inputs:[{id:"in_0",name:"length",defval:14,type:"integer",min:1,max:2e3}],id:"Aroon@tv-basicstudies-1",scriptIdPart:"",name:"Aroon",format:{precision:2,type:"percent"}},constructor:function(){this.f_0=function(e,t){return 100*(e+t)/t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=r.Std.high(this._context),n=i+1,o=this._context.new_var(s),a=r.Std.highestbars(o,n,this._context),l=this.f_0(a,i),c=r.Std.low(this._context),h=this._context.new_var(c),d=r.Std.lowestbars(h,n,this._context);return[l,this.f_0(d,i)]}}},{name:"Average Price",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,id:"AveragePrice@tv-basicstudies-1",scriptIdPart:"",name:"Average Price",
description:"Average Price",shortDescription:"Average Price",is_price_study:!0,plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#2196F3"}},inputs:{}},styles:{plot_0:{title:"Plot"}},inputs:[],format:{type:"inherit"}},constructor:function(){this.main=function(e,t){return this._context=e,this._input=t,[r.Std.ohlc4(this._context)]}}},{name:"Average Directional Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:c}},inputs:{in_0:14,in_1:14}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"ADX",histogramBase:0,joinPoints:!1,isHidden:!1}},description:"Average Directional Index",shortDescription:"ADX",is_price_study:!1,inputs:[{id:"in_0",name:"ADX Smoothing",defval:14,type:"integer",min:-1e12,max:1e12},{id:"in_1",name:"DI Length",defval:14,type:"integer",min:-1e12,max:1e12}],id:"average_directional_Index@tv-basicstudies-1",scriptIdPart:"",name:"Average Directional Index",format:{precision:2,type:"price"}},constructor:function(){this.f_0=function(e){var t=this._context.new_var(r.Std.high(this._context)),i=r.Std.change(t),s=this._context.new_var(r.Std.low(this._context)),n=-r.Std.change(s),o=this._context.new_var(r.Std.tr(void 0,this._context)),a=r.Std.rma(o,e,this._context),l=this._context.new_var(r.Std.and(r.Std.gt(i,n),r.Std.gt(i,0))?i:0),c=r.Std.fixnan(100*r.Std.rma(l,e,this._context)/a,this._context),h=this._context.new_var(r.Std.and(r.Std.gt(n,i),r.Std.gt(n,0))?n:0);return[c,r.Std.fixnan(100*r.Std.rma(h,e,this._context)/a,this._context)]},this.f_1=function(e,t){var i=this.f_0(e),s=i[0],n=i[1],o=s+n,a=this._context.new_var(r.Std.abs(s-n)/(r.Std.eq(o,0)?1:o));return[100*r.Std.rma(a,t,this._context)]},this.main=function(e,t){return this._context=e,this._input=t,this._context.setMinimumAdditionalDepth(this._input(0)+this._input(1)),this.f_1(this._input(1),this._input(0))}}},{name:"Average True Range",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:l}},inputs:{in_0:14}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Average True Range",shortDescription:"ATR",is_price_study:!1,inputs:[{id:"in_0",name:"length",defval:14,type:"integer",min:1,max:2e3}],id:"Average True Range@tv-basicstudies-1",scriptIdPart:"",name:"Average True Range",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){var i=t(0);return[r.Std.atr(i,e)]}}},{name:"Awesome Oscillator",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:1,trackPrice:!1,transparency:0,visible:!0,color:"#000080"}},palettes:{palette_0:{colors:{0:{color:a,width:1,style:0},1:{color:u,width:1,style:0}}}},inputs:{}},plots:[{id:"plot_0",type:"line"
},{id:"plot_1",palette:"palette_0",target:"plot_0",type:"colorer"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Awesome Oscillator",shortDescription:"AO",is_price_study:!1,palettes:{palette_0:{colors:{0:{name:"Color 0"},1:{name:"Color 1"}}}},inputs:[],id:"Awesome Oscillator@tv-basicstudies-1",scriptIdPart:"",name:"Awesome Oscillator",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return e-t},this.f_1=function(e){return r.Std.le(e,0)?0:1},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.hl2(this._context),s=this._context.new_var(i),n=r.Std.sma(s,5,this._context),o=this._context.new_var(i),a=r.Std.sma(o,34,this._context),l=this.f_0(n,a),c=l,h=this._context.new_var(l),d=r.Std.change(h);return[c,this.f_1(d)]}}},{name:"Balance of Power",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:c}},inputs:{}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Balance of Power",shortDescription:"Balance of Power",is_price_study:!1,inputs:[],id:"Balance of Power@tv-basicstudies-1",scriptIdPart:"",name:"Balance of Power",format:{precision:2,type:"price"}},constructor:function(){this.f_0=function(e,t,i,s){return(e-t)/(i-s)},this.main=function(e,t){return this._context=e,this._input=t,[this.f_0(r.Std.close(this._context),r.Std.open(this._context),r.Std.high(this._context),r.Std.low(this._context))]}}},{name:"Bollinger Bands",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_2:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},filledAreasStyle:{fill_0:{color:"#2196F3",transparency:95,visible:!0}},inputs:{in_0:20,in_1:2}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],styles:{plot_0:{title:"Median",histogramBase:0,joinPoints:!1},plot_1:{title:"Upper",histogramBase:0,joinPoints:!1},plot_2:{title:"Lower",histogramBase:0,joinPoints:!1}},description:"Bollinger Bands",shortDescription:"BB",is_price_study:!0,filledAreas:[{id:"fill_0",objAId:"plot_1",objBId:"plot_2",type:"plot_plot",title:"Plots Background"}],inputs:[{id:"in_0",name:"length",defval:20,type:"integer",min:1,max:1e4},{id:"in_1",name:"mult",defval:2,type:"float",min:.001,max:50}],id:"Bollinger Bands@tv-basicstudies-1",scriptIdPart:"",name:"Bollinger Bands",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return e*t},this.f_1=function(e,t){return e+t},this.f_2=function(e,t){return e-t},this.main=function(e,t){this._context=e,this._input=t
;var i=r.Std.close(this._context),s=this._input(0),n=this._input(1),o=this._context.new_var(i),a=r.Std.sma(o,s,this._context),l=this._context.new_var(i),c=r.Std.stdev(l,s,this._context),h=this.f_0(n,c);return[a,this.f_1(a,h),this.f_2(a,h)]}}},{name:"Bollinger Bands %B",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:d}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:1},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],filledAreasStyle:{fill_0:{color:"#26A69A",transparency:90,visible:!0}},inputs:{in_0:20,in_1:2}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:1}},description:"Bollinger Bands %B",shortDescription:"BB %B",is_price_study:!1,bands:[{id:"hline_0",name:"UpperLimit",zorder:-1.1},{id:"hline_1",name:"LowerLimit",zorder:-1.11}],filledAreas:[{id:"fill_0",objAId:"hline_0",objBId:"hline_1",type:"hline_hline",title:"Hlines Background",zorder:-2}],inputs:[{id:"in_0",name:"length",defval:20,type:"integer",min:1,max:1e4},{id:"in_1",name:"mult",defval:2,type:"float",min:.001,max:50}],id:"Bollinger Bands %B@tv-basicstudies-1",scriptIdPart:"",name:"Bollinger Bands %B",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e,t){return e*t},this.f_1=function(e,t){return e+t},this.f_2=function(e,t){return e-t},this.f_3=function(e,t,i){return(e-t)/(i-t)},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._input(0),n=this._input(1),o=this._context.new_var(i),a=r.Std.sma(o,s,this._context),l=this._context.new_var(i),c=r.Std.stdev(l,s,this._context),h=this.f_0(n,c),d=this.f_1(a,h),u=this.f_2(a,h);return[this.f_3(i,u,d)]}}},{name:"Bollinger Bands Width",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"}},inputs:{in_0:20,in_1:2}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Bollinger Bands Width",shortDescription:"BBW",is_price_study:!1,inputs:[{id:"in_0",name:"length",defval:20,type:"integer",min:1,max:1e4},{id:"in_1",name:"mult",defval:2,type:"float",min:.001,max:50}],id:"Bollinger Bands Width@tv-basicstudies-1",scriptIdPart:"",name:"Bollinger Bands Width",format:{precision:2,type:"price"}},constructor:function(){this.f_0=function(e,t){return e*t},this.f_1=function(e,t){return e+t},this.f_2=function(e,t){return e-t},this.f_3=function(e,t,i){return(e-t)/i},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._input(0),n=this._input(1),o=this._context.new_var(i),a=r.Std.sma(o,s,this._context),l=this._context.new_var(i),c=r.Std.stdev(l,s,this._context),h=this.f_0(n,c),d=this.f_1(a,h),u=this.f_2(a,h);return[this.f_3(d,u,a)]}}},{name:"Chaikin Money Flow",metainfo:{_metainfoVersion:52,
isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#43A047"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{in_0:20}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:1}},description:"Chaikin Money Flow",shortDescription:"CMF",is_price_study:!1,bands:[{id:"hline_0",name:"Zero",zorder:-1}],inputs:[{id:"in_0",name:"length",defval:20,type:"integer",min:1,max:2e3}],id:"Chaikin Money Flow@tv-basicstudies-1",scriptIdPart:"",name:"Chaikin Money Flow",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e,t,i,s){return r.Std.or(r.Std.and(r.Std.eq(e,t),r.Std.eq(e,i)),r.Std.eq(t,i))?0:(2*e-i-t)/(t-i)*s},this.f_1=function(e,t){return e/t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this.f_0(r.Std.close(this._context),r.Std.high(this._context),r.Std.low(this._context),r.Std.volume(this._context)),n=this._context.new_var(s),o=r.Std.sum(n,i,this._context),a=r.Std.volume(this._context),l=this._context.new_var(a),c=r.Std.sum(l,i,this._context);return[this.f_1(o,c)]}}},{name:"Chaikin Oscillator",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#EC407A"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{in_0:3,in_1:10}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:1}},description:"Chaikin Oscillator",shortDescription:"Chaikin Osc",is_price_study:!1,bands:[{id:"hline_0",name:"Zero",zorder:-1}],inputs:[{id:"in_0",name:"short",defval:3,type:"integer",min:1,max:2e3},{id:"in_1",name:"long",defval:10,type:"integer",min:1,max:2e3}],id:"Chaikin Oscillator@tv-basicstudies-1",scriptIdPart:"",name:"Chaikin Oscillator",format:{type:"volume"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e,t){return e-t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=r.Std.accdist(this._context),o=this._context.new_var(n),a=r.Std.ema(o,i,this._context),l=this._context.new_var(n),c=r.Std.ema(l,s,this._context);return[this.f_0(a,c)]}}},{name:"Chaikin Volatility",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!1,id:"Chaikin Volatility@tv-basicstudies-1",scriptIdPart:"",name:"Chaikin Volatility",description:"Chaikin Volatility",shortDescription:"Chaikin Volatility",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#AB47BC"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{periods:10,rocLookback:10}},styles:{plot_0:{title:"Plot",zorder:1}},bands:[{id:"hline_0",name:"Zero",zorder:-1}],inputs:[{id:"periods",type:"integer",name:"Periods"},{id:"rocLookback",
type:"integer",name:"Rate of Change Lookback"}],format:{type:"volume"},usePlotsZOrder:!0},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.period=this._input(0),this.rocLookback=this._input(1)},this.main=function(e,t){this._context=e,this._input=t,this._context.setMinimumAdditionalDepth(this.period+this.rocLookback);var i=this._context.new_var(r.Std.high(this._context)-r.Std.low(this._context)),s=this._context.new_var(r.Std.ema(i,this.period,this._context));return[r.Std.roc(s,this.rocLookback)]}}},{name:"Chande Kroll Stop",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"}},inputs:{in_0:10,in_1:1,in_2:9}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"Long",histogramBase:0,joinPoints:!1},plot_1:{title:"Short",histogramBase:0,joinPoints:!1}},description:"Chande Kroll Stop",shortDescription:"Chande Kroll Stop",is_price_study:!0,inputs:[{id:"in_0",name:"p",defval:10,type:"integer",min:1,max:4999},{id:"in_1",name:"x",defval:1,type:"integer",min:1,max:1e12},{id:"in_2",name:"q",defval:9,type:"integer",min:1,max:1e12}],id:"Chande Kroll Stop@tv-basicstudies-1",scriptIdPart:"",name:"Chande Kroll Stop",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t,i){return e-t*i},this.f_1=function(e,t,i){return e+t*i},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=this._input(2),o=r.Std.high(this._context),a=this._context.new_var(o),l=r.Std.highest(a,i,this._context),c=r.Std.atr(i,this._context),h=this.f_0(l,s,c),d=this._context.new_var(o),u=r.Std.lowest(d,i,this._context),p=this.f_1(u,s,c),_=this._context.new_var(h),m=r.Std.highest(_,n,this._context),g=this._context.new_var(p);return[r.Std.lowest(g,n,this._context),m]}}},{name:"Chande Momentum Oscillator",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:9}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Chande Momentum Oscillator",shortDescription:"ChandeMO",is_price_study:!1,inputs:[{id:"in_0",name:"length",defval:9,type:"integer",min:1,max:2e3}],id:"Chande Momentum Oscillator@tv-basicstudies-1",scriptIdPart:"",name:"Chande Momentum Oscillator",format:{type:"price",precision:2}},constructor:function(){this.f_0=function(e){return r.Std.ge(e,0)?e:0},this.f_1=function(e){return r.Std.ge(e,0)?0:-e},this.f_2=function(e,t){return 100*e/t},this.f_3=function(e,t){return this.f_2(e-t,e+t)},this.main=function(e,t){this._context=e,this._input=t
;var i=this._input(0),s=r.Std.close(this._context),n=this._context.new_var(s),o=r.Std.change(n),a=this.f_0(o),l=this.f_1(o),c=this._context.new_var(a),h=r.Std.sum(c,i,this._context),d=this._context.new_var(l),u=r.Std.sum(d,i,this._context);return[this.f_3(h,u)]}}},{name:"Chop Zone",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:5,trackPrice:!1,transparency:0,visible:!0,color:"#000080"}},palettes:{palette_0:{colors:{0:{color:"#26C6DA",width:1,style:0},1:{color:"#43A047",width:1,style:0},2:{color:"#A5D6A7",width:1,style:0},3:{color:u,width:1,style:0},4:{color:"#D50000",width:1,style:0},5:{color:"#E91E63",width:1,style:0},6:{color:"#FF6D00",width:1,style:0},7:{color:"#FFB74D",width:1,style:0},8:{color:"#FDD835",width:1,style:0}}}},inputs:{}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",palette:"palette_0",target:"plot_0",type:"colorer"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,isHidden:!1}},description:"Chop Zone",shortDescription:"Chop Zone",is_price_study:!1,palettes:{palette_0:{colors:{0:{name:"Color 0"},1:{name:"Color 1"},2:{name:"Color 2"},3:{name:"Color 3"},4:{name:"Color 4"},5:{name:"Color 5"},6:{name:"Color 6"},7:{name:"Color 7"},8:{name:"Color 8"}},valToIndex:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8}}},inputs:[],id:"chop_zone@tv-basicstudies-1",scriptIdPart:"",name:"Chop Zone",format:{precision:0,type:"price"}},constructor:function(){this.f_0=function(){var e=r.Std.close(this._context),t=r.Std.hlc3(this._context),i=this._context.new_var(r.Std.high(this._context)),s=r.Std.highest(i,30,this._context),n=r.Std.lowest(i,30,this._context),o=25/(s-n)*n,a=this._context.new_var(e),l=this._context.new_var(r.Std.ema(a,34,this._context)),c=(l.get(1)-l.get(0))/t*o,h=r.Std.sqrt(1+c*c),d=r.Std.round(180*r.Std.acos(1/h)/3.141592653589793),u=r.Std.iff(r.Std.gt(c,0),-d,d),p=r.Std.and(r.Std.gt(u,-2.14),r.Std.le(u,-.71))?7:8,_=r.Std.and(r.Std.gt(u,-3.57),r.Std.le(u,-2.14))?6:p,m=r.Std.and(r.Std.gt(u,-5),r.Std.le(u,-3.57))?5:_,g=r.Std.le(u,-5)?4:m,f=r.Std.and(r.Std.lt(u,2.14),r.Std.ge(u,.71))?3:g,v=r.Std.and(r.Std.lt(u,3.57),r.Std.ge(u,2.14))?2:f,S=r.Std.and(r.Std.lt(u,5),r.Std.ge(u,3.57))?1:v;return[1,r.Std.ge(u,5)?0:S]},this.main=function(e,t){return this._context=e,this._input=t,this.f_0()}}},{name:"Choppiness Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:61.8},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:38.2}],filledAreasStyle:{fill_0:{color:"#2196F3",transparency:90,visible:!0}},inputs:{in_0:14}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:1}},description:"Choppiness Index",shortDescription:"CHOP",is_price_study:!1,bands:[{id:"hline_0",name:"UpperLimit",zorder:-1.1},{id:"hline_1",name:"LowerLimit",zorder:-1.11}],filledAreas:[{
id:"fill_0",objAId:"hline_0",objBId:"hline_1",type:"hline_hline",title:"Hlines Background",zorder:-2}],inputs:[{id:"in_0",name:"length",defval:14,type:"integer",min:1,max:2e3}],id:"Choppiness Index@tv-basicstudies-1",scriptIdPart:"",name:"Choppiness Index",format:{type:"price",precision:2},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e,t,i,s){return 100*r.Std.log10(e/(t-i))/s},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=r.Std.atr(1,this._context),n=this._context.new_var(s),o=r.Std.sum(n,i,this._context),a=r.Std.high(this._context),l=this._context.new_var(a),c=r.Std.highest(l,i,this._context),h=r.Std.low(this._context),d=this._context.new_var(h),u=r.Std.lowest(d,i,this._context),p=r.Std.log10(i);return[this.f_0(o,c,u,p)]}}},{name:"Commodity Channel Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},smoothedMA:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!1}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:100},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:-100}],filledAreasStyle:{fill_0:{color:"#2196F3",transparency:90,visible:!0}},inputs:{in_0:20,smoothingLine:"SMA",smoothingLength:20}},plots:[{id:"plot_0",type:"line"},{id:"smoothedMA",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:2},smoothedMA:{title:"Smoothed MA",histogramBase:0,joinPoints:!1,zorder:1}},description:"Commodity Channel Index",shortDescription:"CCI",is_price_study:!1,bands:[{id:"hline_0",name:"UpperLimit",zorder:-1.1},{id:"hline_1",name:"LowerLimit",zorder:-1.11}],filledAreas:[{id:"fill_0",objAId:"hline_0",objBId:"hline_1",type:"hline_hline",title:"Hlines Background",zorder:-2}],inputs:[{id:"in_0",name:"length",defval:20,type:"integer",min:1,max:2e3},{id:"smoothingLine",name:"Smoothing Line",defval:"SMA",type:"text",options:["SMA","EMA","WMA"]},{id:"smoothingLength",name:"Smoothing Length",defval:20,type:"integer",min:1,max:1e4}],id:"Commodity Channel Index@tv-basicstudies-1",scriptIdPart:"",name:"Commodity Channel Index",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e,t,i){return(e-t)/(.015*i)},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.hlc3(this._context),s=this._input(0),n=this._input(1),o=this._input(2);this._context.setMinimumAdditionalDepth(s+o);var a,l=this._context.new_var(i),c=r.Std.sma(l,s,this._context),h=this._context.new_var(i),d=r.Std.dev(h,s,this._context),u=this.f_0(i,c,d),p=this._context.new_var(u);return"EMA"===n?a=r.Std.ema(p,o,this._context):"WMA"===n?a=r.Std.wma(p,o,this._context):"SMA"===n&&(a=r.Std.sma(p,o,this._context)),[u,a]}}},{name:"Connors RSI",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},bands:[{color:"#787B86",
linestyle:2,linewidth:1,visible:!0,value:70},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:30}],filledAreasStyle:{fill_0:{color:"#2196F3",transparency:90,visible:!0}},inputs:{in_0:3,in_1:2,in_2:100}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"CRSI",histogramBase:0,joinPoints:!1,zorder:1}},description:"Connors RSI",shortDescription:"CRSI",is_price_study:!1,bands:[{id:"hline_0",name:"UpperLimit",zorder:-1.1},{id:"hline_1",name:"LowerLimit",zorder:-1.11}],filledAreas:[{id:"fill_0",objAId:"hline_0",objBId:"hline_1",type:"hline_hline",title:"Hlines Background",zorder:-2}],inputs:[{id:"in_0",name:"RSI Length",defval:3,type:"integer",min:1},{id:"in_1",name:"UpDown Length",defval:2,type:"integer",min:1},{id:"in_2",name:"ROC Length",defval:100,type:"integer",min:1}],id:"Connors RSI@tv-basicstudies-1",scriptIdPart:"",name:"Connors RSI",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){var e;this.f_1=function(e,t,i){var s=i.new_var(r.Std.max(r.Std.change(e),0));return r.Std.rma(s,t,i)},this.f_2=function(e,t,i){var s=i.new_var(-r.Std.min(r.Std.change(e),0));return r.Std.rma(s,t,i)},this.f_3=(e=0,function(t){var i=t.get(0),s=t.get(1);return e=i===s?0:i>s?r.Std.nz(e)<=0?1:r.Std.nz(e)+1:r.Std.nz(e)>=0?-1:r.Std.nz(e)-1,this._context.new_var(e)}),this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._context.new_var(i),n=this._input(0),o=this._input(1),a=this._input(2);this._context.setMinimumAdditionalDepth(a);var l=r.Std.rsi(this.f_1(s,n,this._context),this.f_2(s,n,this._context)),c=this.f_3(s),h=r.Std.rsi(this.f_1(c,o,this._context),this.f_2(c,o,this._context)),d=this._context.new_var(r.Std.roc(s,1)),u=r.Std.percentrank(d,a);return[r.Std.avg(l,h,u)]}}},{name:"Coppock Curve",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:10,in_1:14,in_2:11}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Coppock Curve",shortDescription:"Coppock Curve",is_price_study:!1,inputs:[{id:"in_0",name:"WMA Length",defval:10,type:"integer",min:-1e12,max:5e3},{id:"in_1",name:"Long RoC Length",defval:14,type:"integer",min:1,max:4999},{id:"in_2",name:"Short RoC Length",defval:11,type:"integer",min:1,max:4999}],id:"Coppock Curve@tv-basicstudies-1",scriptIdPart:"",name:"Coppock Curve",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return e+t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=this._input(2);this._context.setMinimumAdditionalDepth(i+Math.max(s,n));var o=r.Std.close(this._context),a=this._context.new_var(o),l=r.Std.roc(a,s),c=this._context.new_var(o),h=r.Std.roc(c,n),d=this.f_0(l,h),u=this._context.new_var(d);return[r.Std.wma(u,i,this._context)]}}},{name:"Correlation Coeff",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{
styles:{plot_0:{linestyle:0,linewidth:1,plottype:4,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:"",in_1:20}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Correlation Coefficient",shortDescription:"CC",is_price_study:!1,inputs:[{id:"in_0",name:"sym",defval:"",type:"symbol"},{id:"in_1",name:"length",defval:20,type:"integer",min:1,max:2e3}],id:"Correlation Coeff@tv-basicstudies-1",scriptIdPart:"",name:"Correlation Coeff",format:{precision:2,type:"price"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this._context.new_sym(this._input(0),r.Std.period(this._context))},this.main=function(e,t){this._context=e,this._input=t;var i=this._context.new_unlimited_var(this._context.symbol.time),s=(this._input(0),r.Std.period(this._context),r.Std.close(this._context)),n=this._input(1);this._context.select_sym(1);var o=this._context.new_unlimited_var(this._context.symbol.time),a=r.Std.close(this._context),l=this._context.new_unlimited_var(a);this._context.select_sym(0);var c=l.adopt(o,i,0),h=this._context.new_var(s),d=this._context.new_var(c);return[r.Std.correlation(h,d,n,this._context)]}}},{name:"Correlation - Log",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!1,id:"Correlation - Log@tv-basicstudies-1",scriptIdPart:"",name:"Correlation - Log",description:"Correlation - Log",shortDescription:"Correlation - Log",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#2196F3"}},inputs:{instrument:"",instrument2:"",periods:25}},styles:{plot_0:{title:"Plot"}},inputs:[{id:"instrument",name:"Instrument 1",type:"symbol",defval:"",confirm:!0},{id:"instrument2",name:"Instrument 2",type:"symbol",defval:"",confirm:!0},{id:"periods",name:"Periods",type:"integer",defval:25}],format:{precision:2,type:"price"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this._context.new_sym(this._input(0),r.Std.period(this._context)),this._context.new_sym(this._input(1),r.Std.period(this._context)),this.period=this._input(2)},this.correlationLog=function(e,t,i,s){var n=r.Std.sma(e,i,s),o=r.Std.sma(t,i,s),a=s.new_var(e.get()*t.get());return(r.Std.sma(a,i,s)-n*o)/Math.sqrt(r.Std.variance2(e,n,i)*r.Std.variance2(t,o,i))},this.main=function(e,t){this._context=e,this._input=t,this._context.select_sym(1);var i=this._context.new_var(this._context.symbol.time);this._context.select_sym(2);var s=this._context.new_var(r.Std.close(this._context)),n=this._context.new_var(r.Std.log(s.get()/s.get(1))),o=this._context.new_var(this._context.symbol.time);this._context.select_sym(1);var a=this._context.new_var(r.Std.close(this._context)),l=this._context.new_var(r.Std.log(a.get()/a.get(1))),c=this._context.new_var(n.adopt(o,i,0)),h=this.correlationLog(l,c,this.period,this._context);return[r.Std.round(1e3*h)/1e3]}}},{name:"Detrended Price Oscillator",metainfo:{_metainfoVersion:52,isTVScript:!1,
isTVScriptStub:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#43A047"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{in_0:21,in_1:!1}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"DPO",histogramBase:0,joinPoints:!1,isHidden:!1,zorder:1}},description:"Detrended Price Oscillator",shortDescription:"DPO",is_price_study:!1,is_hidden_study:!1,id:"detrended_price_oscillator@tv-basicstudies-1",bands:[{id:"hline_0",name:"Zero",isHidden:!1,zorder:-1}],inputs:[{id:"in_0",name:"Period",defval:21,type:"integer",min:1,max:1e12},{id:"in_1",name:"isCentered",defval:!1,type:"bool"}],scriptIdPart:"",name:"Detrended Price Oscillator",format:{type:"price",precision:2},usePlotsZOrder:!0},constructor:function(){this.f_0=function(){var e=this._input(0),t=this._input(1),i=Math.floor(e/2+1);this._context.setMinimumAdditionalDepth(e+i);var s=this._context.new_var(r.Std.close(this._context)),n=this._context.new_var(r.Std.sma(s,e,this._context)),o=this._context.new_var(r.Std.close(this._context)).get(i)-n,a=r.Std.close(this._context)-n.get(i);return[t?o:a,t?-i:0]},this.main=function(e,t){this._context=e,this._input=t;var i=this.f_0();return[{value:i[0],offset:i[1]}]}}},{name:"Directional Movement Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"},plot_3:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#F50057"},plot_2:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FFA726"},plot_4:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#ab47bc"}},inputs:{in_0:14,in_1:14}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"},{id:"plot_3",type:"line"},{id:"plot_4",type:"line"}],styles:{plot_0:{title:"+DI",histogramBase:0,joinPoints:!1},plot_1:{title:"-DI",histogramBase:0,joinPoints:!1},plot_2:{title:"DX",histogramBase:0,joinPoints:!1},plot_3:{title:"ADX",histogramBase:0,joinPoints:!1},plot_4:{title:"ADXR",histogramBase:0,joinPoints:!1}},description:"Directional Movement",shortDescription:"DMI",is_price_study:!1,inputs:[{id:"in_0",name:"DI Length",defval:14,type:"integer",min:1,max:2e3},{id:"in_1",name:"ADX Smoothing",defval:14,type:"integer",min:1,max:50}],id:"Directional Movement Index@tv-basicstudies-1",scriptIdPart:"",name:"Directional Movement Index",format:{precision:4,type:"price"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1);return this._context.setMinimumAdditionalDepth(2*i+s),r.Std.dmi(i,s,this._context)}}},{name:"Donchian Channels",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,
trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_2:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"}},filledAreasStyle:{fill_0:{color:"#2196F3",transparency:95,visible:!0}},inputs:{in_0:20}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],styles:{plot_0:{title:"Lower",histogramBase:0,joinPoints:!1},plot_1:{title:"Upper",histogramBase:0,joinPoints:!1},plot_2:{title:"Basis",histogramBase:0,joinPoints:!1}},description:"Donchian Channels",shortDescription:"DC",is_price_study:!0,filledAreas:[{id:"fill_0",objAId:"plot_1",objBId:"plot_0",type:"plot_plot",title:"Plots Background"}],inputs:[{id:"in_0",name:"length",defval:20,type:"integer",min:1,max:2e3}],id:"Donchian Channels@tv-basicstudies-1",scriptIdPart:"",name:"Donchian Channels",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=r.Std.low(this._context),n=this._context.new_var(s),o=r.Std.lowest(n,i,this._context),a=r.Std.high(this._context),l=this._context.new_var(a),c=r.Std.highest(l,i,this._context);return[o,c,r.Std.avg(c,o)]}}},{name:"Double Exponential Moving Average",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#43A047"}},inputs:{in_0:9}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Double EMA",shortDescription:"DEMA",is_price_study:!0,inputs:[{id:"in_0",name:"length",defval:9,type:"integer",min:1,max:1e4}],id:"Double Exponential Moving Average@tv-basicstudies-1",scriptIdPart:"",name:"Double Exponential Moving Average",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return 2*e-t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0);this._context.setMinimumAdditionalDepth(2*i);var s=r.Std.close(this._context),n=this._context.new_var(s),o=r.Std.ema(n,i,this._context),a=this._context.new_var(o),l=r.Std.ema(a,i,this._context);return[this.f_0(o,l)]}}},{name:"Ease of Movement",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#43A047"}},inputs:{in_0:1e4,in_1:14}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Ease Of Movement",shortDescription:"EOM",is_price_study:!1,inputs:[{id:"in_0",name:"Divisor",defval:1e4,type:"integer",min:1,max:1e9},{id:"in_1",name:"length",defval:14,type:"integer",min:1,max:2e3}],id:"Ease of Movement@tv-basicstudies-1",scriptIdPart:"",name:"Ease of Movement",format:{type:"volume"}},constructor:function(){this.f_0=function(e,t,i,s,r){return e*t*(i-s)/r},this.main=function(e,t){this._context=e,this._input=t
;var i=this._input(0),s=this._input(1),n=r.Std.hl2(this._context),o=this._context.new_var(n),a=r.Std.change(o),l=this.f_0(i,a,r.Std.high(this._context),r.Std.low(this._context),r.Std.volume(this._context)),c=this._context.new_var(l);return[r.Std.sma(c,s,this._context)]}}},{name:"Elders Force Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:a}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{in_0:13}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:1}},description:"Elder's Force Index",shortDescription:"EFI",is_price_study:!1,bands:[{id:"hline_0",name:"Zero",zorder:-1}],inputs:[{id:"in_0",name:"length",defval:13,type:"integer",min:1,max:2e3}],id:"Elders Force Index@tv-basicstudies-1",scriptIdPart:"",name:"Elders Force Index",format:{type:"volume"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e,t){return e*t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=r.Std.close(this._context),n=this._context.new_var(s),o=r.Std.change(n),a=this.f_0(o,r.Std.volume(this._context)),l=this._context.new_var(a);return[r.Std.ema(l,i,this._context)]}}},{name:"EMA Cross",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#43A047"},plot_2:{linestyle:0,linewidth:4,plottype:3,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:9,in_1:26}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],styles:{plot_0:{title:"Short",histogramBase:0,joinPoints:!1},plot_1:{title:"Long",histogramBase:0,joinPoints:!1},plot_2:{title:"Crosses",histogramBase:0,joinPoints:!1}},description:"EMA Cross",shortDescription:"EMA Cross",is_price_study:!0,inputs:[{id:"in_0",name:"Short",defval:9,type:"integer",min:1,max:2e3},{id:"in_1",name:"Long",defval:26,type:"integer",min:1,max:2e3}],id:"EMA Cross@tv-basicstudies-1",scriptIdPart:"",name:"EMA Cross",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return e?t:r.Std.na()},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=r.Std.close(this._context),o=this._context.new_var(n),a=r.Std.ema(o,i,this._context),l=this._context.new_var(n),c=r.Std.ema(l,s,this._context),h=a,d=c,u=r.Std.cross(a,c,this._context);return[h,d,this.f_0(u,a)]}}},{name:"Envelopes",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_2:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,
transparency:0,visible:!0,color:"#2196F3"}},filledAreasStyle:{fill_0:{color:"#2196F3",transparency:95,visible:!0}},inputs:{in_0:20,in_1:10,in_2:10,in_3:"Simple",in_4:"close"}},plots:[{id:"plot_1",type:"line"},{id:"plot_0",type:"line"},{id:"plot_2",type:"line"}],styles:{plot_0:{title:"Average",histogramBase:0,joinPoints:!1},plot_1:{title:"Upper",histogramBase:0,joinPoints:!1},plot_2:{title:"Lower",histogramBase:0,joinPoints:!1}},description:"Envelopes",shortDescription:"Envelopes",is_price_study:!0,filledAreas:[{id:"fill_0",objAId:"plot_1",objBId:"plot_2",type:"plot_plot",title:"Plots Background"}],inputs:[{id:"in_0",name:"Length",defval:20,type:"integer",min:1,max:2e3},{id:"in_1",name:"Upper Percentage",defval:2,type:"float",min:0},{id:"in_2",name:"Lower Percentage",defval:2,type:"float",min:0},{id:"in_3",name:"Method",type:"text",defval:"Simple",options:["Simple","Exponential","Weighted"]},{id:"in_4",name:"Source",defval:"close",type:"source",options:["open","high","low","close","hl2","hlc3","ohlc4"]}],id:"Envelope@tv-basicstudies-1",scriptIdPart:"",name:"Envelopes",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return e*(1+t)},this.f_1=function(e,t){return e*(1-t)},this.main=function(e,t){this._context=e,this._input=t;var i=this._context.new_var(r.Std[this._input(4)](this._context)),s=r.Std.sma(i,this._input(0),this._context);return"Exponential"===this._input(3)?s=r.Std.ema(i,this._input(0),this._context):"Weighted"===this._input(3)&&(s=r.Std.wma(i,this._input(0),this._context)),[this.f_0(s,this._input(1)/100),s,this.f_1(s,this._input(2)/100)]}}},{name:"Standard Error",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!1,id:"Standard Error@tv-basicstudies-1",scriptIdPart:"",name:"Standard Error",description:"Standard Error",shortDescription:"Standard Error",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#FF6D00"}},inputs:{length:14}},styles:{plot_0:{title:"Plot"}},inputs:[{id:"length",type:"integer",name:"Length",min:3}],format:{precision:2,type:"price"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.period=this._input(0)},this.main=function(e,t){this._context=e,this._input=t;for(var i,s,n=this._context.new_var(r.Std.close(this._context)),o=0,a=0,l=0;l<this.period;l++)o+=l+1,a+=n.get(l);i=o/this.period,s=a/this.period;var c=0,h=0,d=0;for(l=0;l<this.period;l++)d+=Math.pow(s-n.get(l),2),h+=(i-l-1)*(s-n.get(l)),c+=Math.pow(i-l-1,2);return h=Math.pow(h,2),[Math.sqrt((d-h/c)/(this.period-2))]}}},{name:"Standard Error Bands",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!0,id:"Standard Error Bands@tv-basicstudies-1",scriptIdPart:"",name:"Standard Error Bands",description:"Standard Error Bands",shortDescription:"Standard Error Bands",plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,
linewidth:1,plottype:0,transparency:0,trackPrice:!1,color:"#2196F3"},plot_1:{linestyle:0,visible:!0,linewidth:1,transparency:0,plottype:0,trackPrice:!1,color:"#FF6D00"},plot_2:{linestyle:0,visible:!0,linewidth:1,transparency:0,plottype:0,trackPrice:!1,color:"#2196F3"}},filledAreasStyle:{fill_0:{color:"#2196F3",transparency:95,visible:!0}},inputs:{periods:21,errors:2,method:"Simple",averagePeriods:3}},styles:{plot_0:{title:"Plot 1"},plot_1:{title:"Plot 2"},plot_2:{title:"Plot 3"}},filledAreas:[{id:"fill_0",objAId:"plot_0",objBId:"plot_2",type:"plot_plot",title:"Background"}],inputs:[{id:"periods",type:"integer",name:"Periods"},{id:"errors",type:"float",name:"Standard Errors"},{id:"method",name:"Method",type:"text",defval:"Simple",options:["Simple","Exponential","Weighted"]},{id:"averagePeriods",type:"integer",name:"Averaging Periods"}],format:{type:"inherit"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.period=this._input(0),this.errorDeviation=this._input(1),this.maMethod=this._input(2),this.averagePeriod=this._input(3)},this.main=function(e,t){this._context=e,this._input=t;for(var i,s,n=this._context.new_var(r.Std.close(this._context)),o=0,a=0,l=0;l<this.period;l++)o+=l+1,a+=n.get(l);i=o/this.period,s=a/this.period;var c=0,h=0,d=0;for(l=0;l<this.period;l++)d+=Math.pow(s-n.get(l),2),h+=(i-l-1)*(s-n.get(l)),c+=Math.pow(i-l-1,2);h=Math.pow(h,2);var u,p,_,m=Math.sqrt((d-h/c)/(this.period-2)),g=r.Std.linreg(n,this.period,0),f=this._context.new_var(g+this.errorDeviation*m),v=this._context.new_var(g),S=this._context.new_var(g-this.errorDeviation*m);return"Simple"===this.maMethod?(u=r.Std.sma(f,this.averagePeriod,this._context),p=r.Std.sma(v,this.averagePeriod,this._context),_=r.Std.sma(S,this.averagePeriod,this._context)):"Exponential"===this.maMethod?(u=r.Std.ema(f,this.averagePeriod,this._context),p=r.Std.ema(v,this.averagePeriod,this._context),_=r.Std.ema(S,this.averagePeriod,this._context)):(u=r.Std.wma(f,this.averagePeriod,this._context),p=r.Std.wma(v,this.averagePeriod,this._context),_=r.Std.wma(S,this.averagePeriod,this._context)),[u,p,_]}}},{name:"Fisher Transform",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"}},bands:[{color:"#E91E63",linestyle:2,linewidth:1,visible:!0,value:1.5},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:.75},{color:"#E91E63",linestyle:2,linewidth:1,visible:!0,value:0},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:-.75},{color:"#E91E63",linestyle:2,linewidth:1,visible:!0,value:-1.5}],inputs:{in_0:9}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"Fisher",histogramBase:0,joinPoints:!1,isHidden:!1,zorder:1},plot_1:{title:"Trigger",histogramBase:0,joinPoints:!1,isHidden:!1,zorder:1.1}},description:"Fisher Transform",shortDescription:"Fisher",
is_price_study:!1,bands:[{id:"hline_0",name:"Level",isHidden:!1,zorder:-1.1},{id:"hline_1",name:"Level",isHidden:!1,zorder:-1.11},{id:"hline_2",name:"Level",isHidden:!1,zorder:-1.111},{id:"hline_3",name:"Level",isHidden:!1,zorder:-1.1111},{id:"hline_4",name:"Level",isHidden:!1,zorder:-1.11111}],inputs:[{id:"in_0",name:"Length",defval:9,type:"integer",min:1,max:1e12}],id:"fisher_transform@tv-basicstudies-1",scriptIdPart:"",name:"Fisher Transform",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e){var t=r.Std.lt(e,-.99)?-.999:e;return[r.Std.gt(e,.99)?.999:t]},this.f_1=function(){var e=this._input(0),t=this._context.new_var(r.Std.hl2(this._context)),i=r.Std.highest(t,e,this._context),s=this._context.new_var(r.Std.hl2(this._context)),n=r.Std.lowest(s,e,this._context),o=this._context.new_var(),a=this.f_0(.66*((r.Std.hl2(this._context)-n)/r.Std.max(i-n,.001)-.5)+.67*r.Std.nz(o.get(1)));o.set(a[0]);var l=this._context.new_var();l.set(.5*r.Std.log((1+o.get(0))/r.Std.max(1-o.get(0),.001))+.5*r.Std.nz(l.get(1)));var c=l.get(1);return[l.get(0),c]},this.main=function(e,t){return this._context=e,this._input=t,this.f_1()}}},{name:"Historical Volatility",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:10}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,isHidden:!1}},description:"Historical Volatility",shortDescription:"HV",is_price_study:!1,inputs:[{id:"in_0",name:"length",defval:10,type:"integer",min:1,max:1e12}],id:"historical_volatility@tv-basicstudies-1",scriptIdPart:"",name:"Historical Volatility",format:{precision:2,type:"price"}},constructor:function(){this.f_0=function(){var e=this._input(0),t=r.Std.or(r.Std.isintraday(this._context),r.Std.and(r.Std.isdaily(this._context),r.Std.eq(r.Std.interval(this._context),1)))?1:7,i=this._context.new_var(r.Std.close(this._context)),s=this._context.new_var(r.Std.log(r.Std.close(this._context)/i.get(1)));return[100*r.Std.stdev(s,e,this._context)*r.Std.sqrt(365/t)]},this.main=function(e,t){return this._context=e,this._input=t,this.f_0()}}},{name:"Hull MA",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:9}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Hull Moving Average",shortDescription:"HMA",is_price_study:!0,inputs:[{id:"in_0",name:"length",defval:9,type:"integer",min:1,max:1e4}],id:"Hull MA@tv-basicstudies-1",scriptIdPart:"",name:"Hull MA",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return 2*e-t},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._input(0),n=s/2;this._context.setMinimumAdditionalDepth(Math.ceil(s+n))
;var o=this._context.new_var(i),a=r.Std.wma(o,n,this._context),l=this._context.new_var(i),c=r.Std.wma(l,s,this._context),h=this.f_0(a,c),d=r.Std.sqrt(s),u=r.Std.round(d),p=this._context.new_var(h);return[r.Std.wma(p,u,this._context)]}}},{name:"Ichimoku Cloud",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:l},plot_2:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#43A047"},plot_3:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#A5D6A7"},plot_4:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:o}},palettes:{palette_0:{colors:{0:{color:"#43A047",width:1,style:0},1:{color:a,width:1,style:0}}}},filledAreasStyle:{fill_0:{color:"#000080",transparency:90,visible:!0}},inputs:{in_0:9,in_1:26,in_2:52,in_3:26}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"},{id:"plot_3",type:"line"},{id:"plot_4",type:"line"},{id:"plot_5",palette:"palette_0",target:"fill_0",type:"colorer"}],styles:{plot_0:{title:"Conversion Line",histogramBase:0,joinPoints:!1,isHidden:!1},plot_1:{title:"Base Line",histogramBase:0,joinPoints:!1,isHidden:!1},plot_2:{title:"Lagging Span",histogramBase:0,joinPoints:!1,isHidden:!1},plot_3:{title:"Leading Span A",histogramBase:0,joinPoints:!1,isHidden:!1},plot_4:{title:"Leading Span B",histogramBase:0,joinPoints:!1,isHidden:!1}},description:"Ichimoku Cloud",shortDescription:"Ichimoku",is_price_study:!0,is_hidden_study:!1,id:"Ichimoku Cloud@tv-basicstudies-1",palettes:{palette_0:{colors:{0:{name:"Color 0"},1:{name:"Color 1"}},valToIndex:{0:0,1:1}}},filledAreas:[{id:"fill_0",objAId:"plot_3",objBId:"plot_4",type:"plot_plot",title:"Plots Background",isHidden:!1,palette:"palette_0"}],inputs:[{id:"in_0",name:"Conversion Line Periods",defval:9,type:"integer",min:1,max:1e12},{id:"in_1",name:"Base Line Periods",defval:26,type:"integer",min:1,max:1e12},{id:"in_2",name:"Leading Span B",defval:52,type:"integer",min:1,max:1e12},{id:"in_3",name:"Lagging Span",defval:26,type:"integer",min:1,max:1e12}],scriptIdPart:"",name:"Ichimoku Cloud",format:{type:"inherit"}},constructor:function(){this.donchian=function(e){var t=this._context.new_var(r.Std.low(this._context)),i=this._context.new_var(r.Std.high(this._context));return r.Std.avg(r.Std.lowest(t,e,this._context),r.Std.highest(i,e,this._context))},this.f_1=function(){var e=this._input(0),t=this._input(1),i=this._input(2),s=this._input(3),n=this.donchian(e),o=this.donchian(t),a=r.Std.avg(n,o),l=this.donchian(i);return[n,o,r.Std.close(this._context),a,l,1-s,s-1,s-1,r.Std.gt(a,l)?0:1]},this.main=function(e,t){this._context=e,this._input=t;var i=this.f_1();return[i[0],i[1],{value:i[2],offset:i[5]},{value:i[3],offset:i[6]},{value:i[4],offset:i[7]},i[8]]}}},{name:"Keltner Channels",metainfo:{_metainfoVersion:52,isTVScript:!1,
isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_2:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},filledAreasStyle:{fill_0:{color:"#2196F3",transparency:95,visible:!0}},inputs:{in_0:!0,in_1:20,in_2:1}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],styles:{plot_0:{title:"Upper",histogramBase:0,joinPoints:!1},plot_1:{title:"Middle",histogramBase:0,joinPoints:!1},plot_2:{title:"Lower",histogramBase:0,joinPoints:!1}},description:"Keltner Channels",shortDescription:"KC",is_price_study:!0,filledAreas:[{id:"fill_0",objAId:"plot_0",objBId:"plot_2",type:"plot_plot",title:"Plots Background"}],inputs:[{id:"in_0",name:"useTrueRange",defval:!0,type:"bool"},{id:"in_1",name:"length",defval:20,type:"integer",min:1,max:2e3},{id:"in_2",name:"mult",defval:1,type:"float",min:-1e12,max:1e12}],id:"Keltner Channels@tv-basicstudies-1",scriptIdPart:"",name:"Keltner Channels",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t,i,s){return e?t:i-s},this.f_1=function(e,t,i){return e+t*i},this.f_2=function(e,t,i){return e-t*i},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._input(0),n=this._input(1),o=this._input(2),a=this._context.new_var(i),l=r.Std.ema(a,n,this._context),c=this.f_0(s,r.Std.tr(this._context),r.Std.high(this._context),r.Std.low(this._context)),h=this._context.new_var(c),d=r.Std.ema(h,n,this._context);return[this.f_1(l,d,o),l,this.f_2(l,d,o)]}}},{name:"Klinger Oscillator",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#43A047"}},inputs:{}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1},plot_1:{title:"Signal",histogramBase:0,joinPoints:!1}},description:"Klinger Oscillator",shortDescription:"Klinger Oscillator",is_price_study:!1,inputs:[],id:"Klinger Oscillator@tv-basicstudies-1",scriptIdPart:"",name:"Klinger Oscillator",format:{type:"volume"}},constructor:function(){this.f_0=function(e,t){return r.Std.ge(e,0)?t:-t},this.f_1=function(e,t){return e-t},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.hlc3(this._context);this._context.setMinimumAdditionalDepth(66);var s=this._context.new_var(i),n=r.Std.change(s),o=this.f_0(n,r.Std.volume(this._context)),a=this._context.new_var(o),l=r.Std.ema(a,34,this._context),c=this._context.new_var(o),h=r.Std.ema(c,55,this._context),d=this.f_1(l,h),u=this._context.new_var(d);return[d,r.Std.ema(u,13,this._context)]}}},{name:"Know Sure Thing",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,
is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:u},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:a}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{in_0:10,in_1:15,in_2:20,in_3:30,in_4:10,in_5:10,in_6:10,in_7:15,in_8:9}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"KST",histogramBase:0,joinPoints:!1,zorder:1.1},plot_1:{title:"Signal",histogramBase:0,joinPoints:!1,zorder:1.11}},description:"Know Sure Thing",shortDescription:"KST",is_price_study:!1,bands:[{id:"hline_0",name:"Zero",zorder:-1}],inputs:[{id:"in_0",name:"roclen1",defval:10,type:"integer",min:1,max:2e3},{id:"in_1",name:"roclen2",defval:15,type:"integer",min:1,max:2e3},{id:"in_2",name:"roclen3",defval:20,type:"integer",min:1,max:2e3},{id:"in_3",name:"roclen4",defval:30,type:"integer",min:1,max:2e3},{id:"in_4",name:"smalen1",defval:10,type:"integer",min:1,max:2e3},{id:"in_5",name:"smalen2",defval:10,type:"integer",min:1,max:2e3},{id:"in_6",name:"smalen3",defval:10,type:"integer",min:1,max:2e3},{id:"in_7",name:"smalen4",defval:15,type:"integer",min:1,max:2e3},{id:"in_8",name:"siglen",defval:9,type:"integer",min:1,max:2e3}],id:"Know Sure Thing@tv-basicstudies-1",scriptIdPart:"",name:"Know Sure Thing",format:{type:"price",precision:4},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e,t,i,s){return e+2*t+3*i+4*s},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=this._input(2),o=this._input(3),a=this._input(4),l=this._input(5),c=this._input(6),h=this._input(7),d=this._input(8);this._context.setMinimumAdditionalDepth(Math.max(a+i,l+s,c+n,h+o)+d);var u=r.Std.close(this._context),p=i,_=this._context.new_var(u),m=r.Std.roc(_,p),g=a,f=this._context.new_var(m),v=r.Std.sma(f,g,this._context),S=s,y=this._context.new_var(u),b=r.Std.roc(y,S),w=l,P=this._context.new_var(b),C=r.Std.sma(P,w,this._context),T=n,x=this._context.new_var(u),I=r.Std.roc(x,T),M=c,L=this._context.new_var(I),A=r.Std.sma(L,M,this._context),k=o,E=this._context.new_var(u),D=r.Std.roc(E,k),B=h,V=this._context.new_var(D),R=r.Std.sma(V,B,this._context),N=this.f_0(v,C,A,R),O=this._context.new_var(N);return[N,r.Std.sma(O,d,this._context)]}}},{name:"Least Squares Moving Average",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:25,in_1:0}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Least Squares Moving Average",shortDescription:"LSMA",is_price_study:!0,inputs:[{id:"in_0",name:"Length",defval:25,type:"integer",min:1,max:1e12},{id:"in_1",name:"Offset",defval:0,type:"integer",min:-1e12,max:1e12}],id:"Least Squares Moving Average@tv-basicstudies-1",scriptIdPart:"",name:"Least Squares Moving Average",format:{type:"inherit"}},constructor:function(){
this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=r.Std.close(this._context),o=this._context.new_var(n);return[r.Std.linreg(o,i,s)]}}},{name:"Linear Regression Curve",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:9}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Linear Regression Curve",shortDescription:"LRC",is_price_study:!0,inputs:[{id:"in_0",name:"Length",defval:9,type:"integer",min:1,max:2e3}],id:"Linear Regression Curve@tv-basicstudies-1",scriptIdPart:"",name:"Linear Regression Curve",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._input(0),n=this._context.new_var(i);return[r.Std.linreg(n,s,0)]}}},{name:"Linear Regression Slope",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!1,id:"Linear Regression Slope@tv-basicstudies-1",scriptIdPart:"",name:"Linear Regression Slope",description:"Linear Regression Slope",shortDescription:"Linear Regression Slope",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:c}},inputs:{periods:14}},styles:{plot_0:{title:"Plot"}},inputs:[{id:"periods",type:"integer",name:"Periods",min:2}],format:{precision:2,type:"price"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.period=this._input(0)},this.linregSlope=function(e,t,i){var s,r,n,o=0,a=0,l=0,c=0;for(s=0;s<t;++s)o+=n=t-1-s+1,a+=r=e.get(s),l+=n*n,c+=r*n;return(t*c-o*a)/(t*l-o*o)},this.main=function(e,t){this._context=e,this._input=t;var i=this._context.new_var(r.Std.close(this._context));return[this.linregSlope(i,this.period,0)]}}},{name:"MA Cross",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#43A047"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"},plot_2:{linestyle:0,linewidth:4,plottype:3,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:9,in_1:26}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],styles:{plot_0:{title:"Short",histogramBase:0,joinPoints:!1},plot_1:{title:"Long",histogramBase:0,joinPoints:!1},plot_2:{title:"Crosses",histogramBase:0,joinPoints:!1}},description:"MA Cross",shortDescription:"MA Cross",is_price_study:!0,inputs:[{id:"in_0",name:"Short",defval:9,type:"integer",min:1,max:2e3},{id:"in_1",name:"Long",defval:26,type:"integer",min:1,max:2e3}],id:"MA Cross@tv-basicstudies-1",scriptIdPart:"",name:"MA Cross",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return e?t:r.Std.na()},this.main=function(e,t){
this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=r.Std.close(this._context),o=this._context.new_var(n),a=r.Std.sma(o,i,this._context),l=this._context.new_var(n),c=r.Std.sma(l,s,this._context),h=a,d=c,u=r.Std.cross(a,c,this._context);return[h,d,this.f_0(u,a)]}}},{name:"MA with EMA Cross",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#43A047"},plot_2:{linestyle:0,linewidth:4,plottype:3,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:10,in_1:10}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],styles:{plot_0:{title:"MA",histogramBase:0,joinPoints:!1},plot_1:{title:"EMA",histogramBase:0,joinPoints:!1},plot_2:{title:"Crosses",histogramBase:0,joinPoints:!1}},description:"MA with EMA Cross",shortDescription:"MA/EMA Cross",is_price_study:!0,inputs:[{id:"in_0",name:"Length MA",defval:10,type:"integer",min:1,max:2e3},{id:"in_1",name:"Length EMA",defval:10,type:"integer",min:1,max:2e3}],id:"MA with EMA Cross@tv-basicstudies-1",scriptIdPart:"",name:"MA with EMA Cross",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return e?t:r.Std.na()},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=r.Std.close(this._context),o=this._context.new_var(n),a=r.Std.sma(o,i,this._context),l=this._context.new_var(n),c=r.Std.ema(l,s,this._context),h=a,d=c,u=r.Std.cross(a,c,this._context);return[h,d,this.f_0(u,a)]}}},{name:"Mass Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:10}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Mass Index",shortDescription:"Mass Index",is_price_study:!1,inputs:[{id:"in_0",name:"length",defval:10,type:"integer",min:1,max:2e3}],id:"Mass Index@tv-basicstudies-1",scriptIdPart:"",name:"Mass Index",format:{precision:2,type:"price"}},constructor:function(){this.f_0=function(e,t){return e-t},this.f_1=function(e,t){return e/t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this.f_0(r.Std.high(this._context),r.Std.low(this._context)),n=this._context.new_var(s),o=r.Std.ema(n,9,this._context),a=this._context.new_var(o),l=r.Std.ema(a,9,this._context),c=this.f_1(o,l),h=this._context.new_var(c);return[r.Std.sum(h,i,this._context)]}}},{name:"McGinley Dynamic",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:14}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,isHidden:!1}},description:"McGinley Dynamic",
shortDescription:"McGinley Dynamic",is_price_study:!0,is_hidden_study:!1,id:"mcginley_dynamic@tv-basicstudies-1",inputs:[{id:"in_0",name:"length",defval:14,type:"integer",min:1,max:1e12}],scriptIdPart:"",name:"McGinley Dynamic",format:{type:"inherit"}},constructor:function(){this.f_0=function(){var e=this._input(0),t=r.Std.close(this._context),i=this._context.new_var(t),s=r.Std.ema(i,e,this._context),n=this._context.new_var(),o=n.get(1)+(t-n.get(1))/(e*r.Std.pow(t/n.get(1),4));return n.set(r.Std.na(n.get(1))?s:o),[n.get(0)]},this.main=function(e,t){return this._context=e,this._input=t,this.f_0()}}},{name:"Median Price",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,id:"Median Price@tv-basicstudies-1",scriptIdPart:"",name:"Median Price",description:"Median Price",shortDescription:"Median Price",is_price_study:!0,plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#FF6D00"}},inputs:{}},styles:{plot_0:{title:"Plot"}},inputs:[],format:{type:"inherit"}},constructor:function(){this.main=function(e,t){return this._context=e,this._input=t,[r.Std.hl2(this._context)]}}},{name:"Momentum",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{in_0:10,in_1:"close"}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Mom",histogramBase:0,joinPoints:!1,isHidden:!1,zorder:0}},description:"Momentum",shortDescription:"Mom",is_price_study:!1,bands:[{id:"hline_0",name:"Zero",zorder:-1}],inputs:[{id:"in_0",name:"Length",defval:10,type:"integer",min:1,max:2e3},{id:"in_1",name:"Source",defval:"close",type:"source",options:["open","high","low","close","hl2","hlc3","ohlc4"]}],id:"Momentum@tv-basicstudies-1",scriptIdPart:"",name:"Momentum",format:{type:"inherit"},usePlotsZOrder:!0},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=r.Std[this._input(1)](this._context),n=this._context.new_var(s).get(i);return[n?s-n:null]}}},{name:"Money Flow Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#7E57C2"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:80},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:20}],filledAreasStyle:{fill_0:{color:"#7E57C2",transparency:90,visible:!0}},inputs:{in_0:14}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:1}},description:"Money Flow Index",shortDescription:"MFI",is_price_study:!1,bands:[{id:"hline_0",name:"UpperLimit",zorder:-1.1},{id:"hline_1",name:"LowerLimit",zorder:-1.11}],filledAreas:[{id:"fill_0",objAId:"hline_0",objBId:"hline_1",type:"hline_hline",title:"Hlines Background",zorder:-2}],
inputs:[{id:"in_0",name:"Length",defval:14,type:"integer",min:1,max:2e3}],id:"Money Flow@tv-basicstudies-1",scriptIdPart:"",name:"Money Flow Index",format:{precision:2,type:"price"}},constructor:function(){this.f_0=function(e,t,i){return e*(r.Std.le(t,0)?0:i)},this.f_1=function(e,t,i){return e*(r.Std.ge(t,0)?0:i)},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=r.Std.hlc3(this._context),n=this._context.new_var(s),o=r.Std.change(n),a=this.f_0(r.Std.volume(this._context),o,s),l=this._context.new_var(a),c=r.Std.sum(l,i,this._context),h=this.f_1(r.Std.volume(this._context),o,s),d=this._context.new_var(h),u=r.Std.sum(d,i,this._context);return[r.Std.rsi(c,u)]}}},{name:"Moving Average",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},smoothedMA:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!1}},inputs:{symbol:"",length:9,source:"close",offset:0,smoothingLine:"SMA",smoothingLength:9}},plots:[{id:"plot_0",type:"line"},{id:"smoothedMA",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1},smoothedMA:{title:"Smoothed MA",histogramBase:0,joinPoints:!1}},description:"Moving Average",shortDescription:"MA",is_price_study:!0,inputs:[{id:"symbol",name:"Other Symbol",defval:"",type:"symbol",optional:!0,isHidden:!1},{id:"length",name:"Length",defval:9,type:"integer",min:1,max:1e4},{id:"source",name:"Source",defval:"close",type:"source",options:["open","high","low","close","hl2","hlc3","ohlc4"]},{id:"offset",name:"Offset",defval:0,type:"integer",min:-1e4,max:1e4},{id:"smoothingLine",name:"Smoothing Line",defval:"SMA",type:"text",options:["SMA","EMA","WMA"]},{id:"smoothingLength",name:"Smoothing Length",defval:9,type:"integer",min:1,max:1e4}],id:"Moving Average@tv-basicstudies-1",scriptIdPart:"",name:"Moving Average",format:{type:"inherit"},symbolSource:{type:"symbolInputSymbolSource",inputId:"symbol"}},constructor:function(){this.init=function(e,t){this._context=e,""!==t(0)&&this._context.new_sym(t(0),r.Std.period(this._context))},this.main=function(e,t){this._context=e,this._input=t;var i=this._context.new_var(this._context.symbol.time),s=r.Std[this._input(2)](this._context),n=this._input(1),o=this._input(3),a=this._input(4),l=this._input(5);if(this._context.setMinimumAdditionalDepth(n+l),""!==this._input(0)){this._context.select_sym(1);var c=this._context.new_var(this._context.symbol.time),h=r.Std[this._input(2)](this._context);s=this._context.new_var(h).adopt(c,i,1),this._context.select_sym(0)}var d,u=this._context.new_var(s),p=r.Std.sma(u,n,this._context),_=this._context.new_var(p);return"EMA"===a?d=r.Std.ema(_,l,this._context):"WMA"===a?d=r.Std.wma(_,l,this._context):"SMA"===a&&(d=r.Std.sma(_,l,this._context)),[{value:p,offset:o},{value:d,offset:o}]}}},{name:"Moving Average Channel",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,
linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"}},filledAreasStyle:{fill_0:{color:"#2196F3",transparency:90,visible:!0}},inputs:{in_0:20,in_1:20,in_2:0,in_3:0}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"Upper",histogramBase:0,joinPoints:!1},plot_1:{title:"Lower",histogramBase:0,joinPoints:!1}},filledAreas:[{id:"fill_0",objAId:"plot_0",objBId:"plot_1",type:"plot_plot",title:"Plots Background"}],description:"Moving Average Channel",shortDescription:"MAC",is_price_study:!0,inputs:[{id:"in_0",name:"Upper Length",defval:20,type:"integer",min:1,max:1e4},{id:"in_1",name:"Lower Length",defval:20,type:"integer",min:1,max:1e4},{id:"in_2",name:"Upper Offset",defval:0,type:"integer",min:-1e4,max:1e4},{id:"in_3",name:"Lower Offset",defval:0,type:"integer",min:-1e4,max:1e4}],id:"Moving Average Channel@tv-basicstudies-1",scriptIdPart:"",name:"Moving Average Channel",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.high(this._context),s=r.Std.low(this._context),n=this._input(0),o=this._input(1),a=this._input(2),l=this._input(3),c=this._context.new_var(i),h=this._context.new_var(s);return[{value:r.Std.sma(c,n,this._context),offset:a},{value:r.Std.sma(h,o,this._context),offset:l}]}}},{name:"Moving Average Convergence/Divergence",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:5,trackPrice:!1,transparency:0,visible:!0,color:c},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_2:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"}},palettes:{palette_0:{colors:{0:{color:d,width:1,style:0},1:{color:h,width:1,style:0},2:{color:n,width:1,style:0},3:{color:"#FF5252",width:1,style:0}}}},inputs:{in_0:12,in_1:26,in_3:"close",in_2:9}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"},{id:"plot_3",palette:"palette_0",target:"plot_0",type:"colorer"}],styles:{plot_0:{title:"Histogram",histogramBase:0,joinPoints:!1},plot_1:{title:"MACD",histogramBase:0,joinPoints:!1},plot_2:{title:"Signal",histogramBase:0,joinPoints:!1}},description:"MACD",shortDescription:"MACD",is_price_study:!1,palettes:{palette_0:{colors:{0:{name:"Color 0"},1:{name:"Color 1"},2:{name:"Color 2"},3:{name:"Color 3"}}}},inputs:[{id:"in_0",name:"fastLength",defval:12,type:"integer",min:1,max:2e3},{id:"in_1",name:"slowLength",defval:26,type:"integer",min:1,max:2e3},{id:"in_3",name:"Source",defval:"close",type:"source",options:["open","high","low","close","hl2","hlc3","ohlc4"]},{id:"in_2",name:"signalLength",defval:9,type:"integer",min:1,max:50}],id:"Moving Average Convergence/Divergence@tv-basicstudies-1",scriptIdPart:"",name:"MACD",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return e-t},
this.f_1=function(e){var t=e>0?1:3,i=r.Std.change(this._context.new_var(e));return t-(r.Std.le(i,0)?0:1)},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std[this._input(2)](this._context),s=this._input(0),n=this._input(1),o=this._input(3);this._context.setMinimumAdditionalDepth(Math.max(s,n)+o);var a=this._context.new_var(i),l=r.Std.ema(a,s,this._context),c=this._context.new_var(i),h=r.Std.ema(c,n,this._context),d=this.f_0(l,h),u=this._context.new_var(d),p=r.Std.ema(u,o,this._context),_=this.f_0(d,p);return[_,d,p,this.f_1(_)]}}},{name:"Moving Average Exponential",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},smoothedMA:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!1}},inputs:{length:9,source:"close",offset:0,smoothingLine:"SMA",smoothingLength:9}},plots:[{id:"plot_0",type:"line"},{id:"smoothedMA",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1},smoothedMA:{title:"Smoothed MA",histogramBase:0,joinPoints:!1}},description:"Moving Average Exponential",shortDescription:"EMA",is_price_study:!0,inputs:[{id:"length",name:"Length",defval:9,type:"integer",min:1,max:1e4},{id:"source",name:"Source",defval:"close",type:"source",options:["open","high","low","close","hl2","hlc3","ohlc4"]},{id:"offset",name:"Offset",defval:0,type:"integer",min:-1e4,max:1e4},{id:"smoothingLine",name:"Smoothing Line",defval:"SMA",type:"text",options:["SMA","EMA","WMA"]},{id:"smoothingLength",name:"Smoothing Length",defval:9,type:"integer",min:1,max:1e4}],id:"Moving Average Exponential@tv-basicstudies-1",scriptIdPart:"",name:"Moving Average Exponential",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=r.Std[this._input(1)](this._context),s=this._input(0),n=this._input(2),o=this._input(3),a=this._input(4);this._context.setMinimumAdditionalDepth(s+a);var l,c=this._context.new_var(i),h=r.Std.ema(c,s,this._context),d=this._context.new_var(h);return"EMA"===o?l=r.Std.ema(d,a,this._context):"WMA"===o?l=r.Std.wma(d,a,this._context):"SMA"===o&&(l=r.Std.sma(d,a,this._context)),[{value:h,offset:n},{value:l,offset:n}]}}},{name:"Moving Average Weighted",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:9,in_1:"close",in_2:0}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Moving Average Weighted",shortDescription:"WMA",is_price_study:!0,inputs:[{id:"in_0",name:"Length",defval:9,type:"integer",min:1,max:2e3},{id:"in_1",name:"Source",defval:"close",type:"source",options:["open","high","low","close","hl2","hlc3","ohlc4"]},{id:"in_2",name:"Offset",defval:0,type:"integer",min:-1e4,max:1e4}],id:"Moving Average Weighted@tv-basicstudies-1",scriptIdPart:"",
name:"Moving Average Weighted",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=r.Std[this._input(1)](this._context),s=this._input(0),n=this._input(2),o=this._context.new_var(i);return[{value:r.Std.wma(o,s,this._context),offset:n}]}}},{name:"Moving Average Double",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,id:"Moving Average Double@tv-basicstudies-1",scriptIdPart:"",name:"Moving Average Double",description:"Moving Average Double",shortDescription:"Moving Average Double",is_price_study:!0,plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#FF6D00"},plot_1:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#2196F3"}},inputs:{firstPeriods:14,secondPeriods:21,method:"Simple"}},styles:{plot_0:{title:"Plot 1"},plot_1:{title:"Plot 2"}},inputs:[{id:"firstPeriods",name:"1st Period",type:"integer",defval:14,min:1,max:1e4},{id:"secondPeriods",name:"2nd Period",type:"integer",defval:21,min:1,max:1e4},{id:"method",name:"Method",type:"text",defval:"Simple",options:["Simple","Exponential","Weighted"]}],format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i,s,n=this._context.new_var(r.Std.close(this._context));return"Exponential"===this._input(2)?(i=r.Std.ema(n,this._input(0),this._context),s=r.Std.ema(n,this._input(1),this._context)):"Weighted"===this._input(2)?(i=r.Std.wma(n,this._input(0),this._context),s=r.Std.wma(n,this._input(1),this._context)):(i=r.Std.sma(n,this._input(0),this._context),s=r.Std.sma(n,this._input(1),this._context)),[i,s]}}},{name:"Moving Average Triple",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!0,id:"Moving Average Triple@tv-basicstudies-1",scriptIdPart:"",name:"Moving Average Triple",description:"Moving Average Triple",shortDescription:"Moving Average Triple",plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,transparency:0,trackPrice:!1,color:"#FF6D00"},plot_1:{linestyle:0,visible:!0,linewidth:1,transparency:0,plottype:0,trackPrice:!1,color:"#2196F3"},plot_2:{linestyle:0,visible:!0,linewidth:1,transparency:0,plottype:0,trackPrice:!1,color:"#26C6DA"}},inputs:{firstPeriods:14,secondPeriods:21,thirdPeriods:35,method:"Simple"}},styles:{plot_0:{title:"Plot 1"},plot_1:{title:"Plot 2"},plot_2:{title:"Plot 3"}},inputs:[{id:"firstPeriods",name:"1st Period",type:"integer",defval:14,min:1,max:1e4},{id:"secondPeriods",name:"2nd Period",type:"integer",defval:21,min:1,max:1e4},{id:"thirdPeriods",name:"3rd Period",type:"integer",defval:35,min:1,max:1e4},{id:"method",name:"Method",type:"text",defval:"Simple",options:["Simple","Exponential","Weighted"]}],format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t
;var i,s,n,o=this._context.new_var(r.Std.close(this._context));return"Exponential"===this._input(3)?(i=r.Std.ema(o,this._input(0),this._context),s=r.Std.ema(o,this._input(1),this._context),n=r.Std.ema(o,this._input(2),this._context)):"Weighted"===this._input(3)?(i=r.Std.wma(o,this._input(0),this._context),s=r.Std.wma(o,this._input(1),this._context),n=r.Std.wma(o,this._input(2),this._context)):(i=r.Std.sma(o,this._input(0),this._context),s=r.Std.sma(o,this._input(1),this._context),n=r.Std.sma(o,this._input(2),this._context)),[i,s,n]}}},{name:"Moving Average Adaptive",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!0,id:"Moving Average Adaptive@tv-basicstudies-1",scriptIdPart:"",name:"Moving Average Adaptive",description:"Moving Average Adaptive",shortDescription:"Moving Average Adaptive",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,transparency:0,trackPrice:!1,color:"#AB47BC"}},inputs:{periods:10}},styles:{plot_0:{title:"Plot 1"}},inputs:[{id:"periods",name:"Period",type:"integer",defval:10,min:2,max:1e4}],format:{type:"inherit"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.periods=this._input(0)},this.ama=function(e,t){var i=this.periods,s=this._context.new_var(),n=e.get(),o=r.Std.stdev(t,i,this._context),a=r.Std.log(n/e.get(i))/(o*Math.sqrt(i)),l=.1*Math.abs(a),c=(n-s.get(1))*l+s.get(1);return s.set(isNaN(c)?n:c),c},this.main=function(e,t){this._context=e,this._input=t;var i=this._context.new_var(r.Std.close(this._context)),s=this._context.new_var(r.Std.log(i.get()/i.get(1)));return[this.ama(i,s)]}}},{name:"Moving Average Hamming",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!0,id:"Moving Average Hamming@tv-basicstudies-1",scriptIdPart:"",name:"Moving Average Hamming",description:"Moving Average Hamming",shortDescription:"Moving Average Hamming",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,transparency:0,trackPrice:!1,color:"#4CAF50"}},inputs:{periods:10}},styles:{plot_0:{title:"Plot 1"}},inputs:[{id:"periods",name:"Period",type:"integer",defval:10,min:1,max:1e4}],format:{type:"inherit"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.periods=this._input(0);for(var i=[],s=0,r=1;r<=this.periods;++r){var n=Math.sin((1+r)/this.periods*Math.PI/2);i.unshift(n),s+=n}this.hmaFactors=i,this.hmaFactorsSum=s},this.hma=function(e){for(var t=this.periods,i=0,s=0;s<t;++s)i+=e.get(t-s-1)*this.hmaFactors[s];return i/=this.hmaFactorsSum},this.main=function(e,t){this._context=e,this._input=t;var i=this._context.new_var(r.Std.close(this._context));return[this.hma(i)]}}},{name:"Moving Average Multiple",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!0,id:"Moving Average Multiple@tv-basicstudies-1",scriptIdPart:"",name:"Moving Average Multiple",description:"Moving Average Multiple",
shortDescription:"Moving Average Multiple",plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"},{id:"plot_3",type:"line"},{id:"plot_4",type:"line"},{id:"plot_5",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,transparency:0,trackPrice:!1,color:"#9C27B0"},plot_1:{linestyle:0,visible:!0,linewidth:1,transparency:0,plottype:0,trackPrice:!1,color:"#FF6D00"},plot_2:{linestyle:0,visible:!0,linewidth:1,transparency:0,plottype:0,trackPrice:!1,color:"#43A047"},plot_3:{linestyle:0,visible:!0,linewidth:1,transparency:0,plottype:0,trackPrice:!1,color:"#26C6DA"},plot_4:{linestyle:0,visible:!0,linewidth:1,transparency:0,plottype:0,trackPrice:!1,color:"#F50057"},plot_5:{linestyle:0,visible:!0,linewidth:1,transparency:0,plottype:0,trackPrice:!1,color:"#2196F3"}},inputs:{firstPeriods:14,secondPeriods:21,thirdPeriods:35,fourthPeriods:50,fifthPeriods:100,sixthPeriods:200,method:"Simple"}},styles:{plot_0:{title:"Plot 1"},plot_1:{title:"Plot 2"},plot_2:{title:"Plot 3"},plot_3:{title:"Plot 4"},plot_4:{title:"Plot 5"},plot_5:{title:"Plot 6"}},inputs:[{id:"firstPeriods",name:"1st Period",type:"integer",defval:14,min:1,max:1e4},{id:"secondPeriods",name:"2nd Period",type:"integer",defval:21,min:1,max:1e4},{id:"thirdPeriods",name:"3rd Period",type:"integer",defval:35,min:1,max:1e4},{id:"fourthPeriods",name:"4th Period",type:"integer",defval:50,min:1,max:1e4},{id:"fifthPeriods",name:"5th Period",type:"integer",defval:100,min:1,max:1e4},{id:"sixthPeriods",name:"6th Period",type:"integer",defval:200,min:1,max:1e4},{id:"method",name:"Method",type:"text",defval:"Simple",options:["Simple","Exponential","Weighted"]}],format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i,s,n,o,a,l,c=this._context.new_var(r.Std.close(this._context));return"Exponential"===this._input(6)?(i=r.Std.ema(c,this._input(0),this._context),s=r.Std.ema(c,this._input(1),this._context),n=r.Std.ema(c,this._input(2),this._context),o=r.Std.ema(c,this._input(3),this._context),a=r.Std.ema(c,this._input(4),this._context),l=r.Std.ema(c,this._input(5),this._context)):"Weighted"===this._input(6)?(i=r.Std.wma(c,this._input(0),this._context),s=r.Std.wma(c,this._input(1),this._context),n=r.Std.wma(c,this._input(2),this._context),o=r.Std.wma(c,this._input(3),this._context),a=r.Std.wma(c,this._input(4),this._context),l=r.Std.wma(c,this._input(5),this._context)):(i=r.Std.sma(c,this._input(0),this._context),s=r.Std.sma(c,this._input(1),this._context),n=r.Std.sma(c,this._input(2),this._context),o=r.Std.sma(c,this._input(3),this._context),a=r.Std.sma(c,this._input(4),this._context),l=r.Std.sma(c,this._input(5),this._context)),[i,s,n,o,a,l]}}},{name:"Majority Rule",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!1,id:"Majority Rule@tv-basicstudies-1",scriptIdPart:"",name:"Majority Rule",description:"Majority Rule",shortDescription:"Majority Rule",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,
linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:c}},inputs:{rollingPeriod:14}},styles:{plot_0:{title:"Majority Rule"}},inputs:[{id:"rollingPeriod",type:"integer",name:"Rolling Period",min:1}],format:{precision:2,type:"price"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.rollingPeriod=this._input(0)},this.main=function(e,t){this._context=e,this._input=t;var i,s=r.Std.close(this._context);return i=s>this._context.new_var(s).get(1)?1:0,[100*r.Std.sma(this._context.new_var(i),this.rollingPeriod,this._context)]}}},{name:"Net Volume",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Net Volume",shortDescription:"Net Volume",is_price_study:!1,inputs:[],id:"Net Volume@tv-basicstudies-1",scriptIdPart:"",name:"Net Volume",format:{type:"volume"}},constructor:function(){this.f_0=function(e,t,i){return r.Std.gt(e,0)?t:r.Std.lt(i,0)?-t:0*t},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._context.new_var(i),n=r.Std.change(s);return[this.f_0(n,r.Std.volume(this._context),n)]}}},{name:"On Balance Volume",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},smoothedMA:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!1}},inputs:{smoothingLine:"SMA",smoothingLength:9}},plots:[{id:"plot_0",type:"line"},{id:"smoothedMA",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1},smoothedMA:{title:"Smoothed MA",histogramBase:0,joinPoints:!1}},description:"On Balance Volume",shortDescription:"OBV",is_price_study:!1,inputs:[{id:"smoothingLine",name:"Smoothing Line",defval:"SMA",type:"text",options:["SMA","EMA","WMA"]},{id:"smoothingLength",name:"Smoothing Length",defval:9,type:"integer",min:1,max:1e4}],id:"On Balance Volume@tv-basicstudies-1",scriptIdPart:"",name:"On Balance Volume",format:{type:"volume"}},constructor:function(){this.f_0=function(e,t,i){return r.Std.gt(e,0)?t:r.Std.lt(i,0)?-t:0*t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=r.Std.close(this._context),o=this._context.new_var(n),a=r.Std.change(o),l=this.f_0(a,r.Std.volume(this._context),a),c=r.Std.cum(l,this._context);this._context.setMinimumAdditionalDepth(s);var h,d=this._context.new_var(c);return"EMA"===i?h=r.Std.ema(d,s,this._context):"WMA"===i?h=r.Std.wma(d,s,this._context):"SMA"===i&&(h=r.Std.sma(d,s,this._context)),[c,h]}}},{name:"Parabolic SAR",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:3,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:.02,in_1:.02,in_2:.2}},
plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Parabolic SAR",shortDescription:"SAR",is_price_study:!0,inputs:[{id:"in_0",name:"start",defval:.02,type:"float",min:-1e12,max:1e12},{id:"in_1",name:"increment",defval:.02,type:"float",min:-1e12,max:1e12},{id:"in_2",name:"maximum",defval:.2,type:"float",min:-1e12,max:1e12}],id:"Parabolic SAR@tv-basicstudies-1",scriptIdPart:"",name:"Parabolic SAR",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=this._input(2);return[r.Std.sar(i,s,n,this._context)]}}},{name:"Price Channel",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#F50057"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#F50057"},plot_2:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:20,in_1:0}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],styles:{plot_0:{title:"Highprice Line",histogramBase:0,joinPoints:!1},plot_1:{title:"Lowprice Line",histogramBase:0,joinPoints:!1},plot_2:{title:"Centerprice Line",histogramBase:0,joinPoints:!1}},description:"Price Channel",shortDescription:"PC",is_price_study:!0,inputs:[{id:"in_0",name:"Length",defval:20,type:"integer",min:1,max:2e3},{id:"in_1",name:"Offset Length",defval:0,type:"integer",min:1,max:2e3}],id:"Price Channel@tv-basicstudies-1",scriptIdPart:"",name:"Price Channel",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.high(this._context),s=this._context.new_var(i),n=r.Std.low(this._context),o=this._context.new_var(n),a=this._input(0),l=this._input(1),c=r.Std.highest(s,a,this._context),h=r.Std.lowest(o,a,this._context);return[{value:c,offset:l},{value:h,offset:l},{value:r.Std.avg(c,h),offset:l}]}}},{name:"Price Oscillator",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:u}},inputs:{in_0:10,in_1:21}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Price Oscillator",shortDescription:"PPO",is_price_study:!1,inputs:[{id:"in_0",name:"shortlen",defval:10,type:"integer",min:1,max:2e3},{id:"in_1",name:"longlen",defval:21,type:"integer",min:1,max:2e3}],id:"Price Oscillator@tv-basicstudies-1",scriptIdPart:"",name:"Price Oscillator",format:{type:"price",precision:2}},constructor:function(){this.f_0=function(e,t){return(e-t)/t*100},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._input(0),n=this._input(1),o=this._context.new_var(i),a=r.Std.sma(o,s,this._context),l=this._context.new_var(i),c=r.Std.sma(l,n,this._context);return[this.f_0(a,c)]}}},{
name:"Price Volume Trend",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"PVT",histogramBase:0,joinPoints:!1,isHidden:!1}},description:"Price Volume Trend",shortDescription:"PVT",is_price_study:!1,is_hidden_study:!1,id:"price_volume_trend@tv-basicstudies-1",inputs:[],scriptIdPart:"",name:"Price Volume Trend",format:{type:"volume"}},constructor:function(){this.f_0=function(){var e=this._context.new_var(r.Std.close(this._context));return[r.Std.cum(r.Std.change(e)/e.get(1)*r.Std.volume(this._context),this._context)]},this.main=function(e,t){return this._context=e,this._input=t,[this.f_0()[0]]}}},{name:"Rate Of Change",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{in_0:9}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"ROC",histogramBase:0,joinPoints:!1,isHidden:!1,zorder:1}},description:"Rate Of Change",shortDescription:"ROC",is_price_study:!1,bands:[{id:"hline_0",name:"Zero Line",isHidden:!1,zorder:-1}],inputs:[{id:"in_0",name:"length",defval:9,type:"integer",min:1,max:1e12}],id:"rate_of_change@tv-basicstudies-1",scriptIdPart:"",name:"Rate Of Change",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._context.new_var(r.Std.close(this._context)),s=this._input(0);return[100*(i.get(0)-i.get(s))/i.get(s)]}}},{name:"Relative Strength Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#7E57C2"},smoothedMA:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!1}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:70,zorder:-1.1},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:50,zorder:-1.11},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:30,zorder:-1.111}],filledAreasStyle:{fill_0:{color:"#7E57C2",transparency:90,visible:!0}},inputs:{length:14,smoothingLine:"SMA",smoothingLength:14}},plots:[{id:"plot_0",type:"line"},{id:"smoothedMA",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:1},smoothedMA:{title:"Smoothed MA",histogramBase:0,joinPoints:!1,zorder:2}},description:"Relative Strength Index",shortDescription:"RSI",is_price_study:!1,bands:[{id:"hline_0",name:"UpperLimit",zorder:-1.1},{id:"hline_2",name:"MiddleLimit",zorder:-1.11},{id:"hline_1",name:"LowerLimit",zorder:-1.111}],filledAreas:[{id:"fill_0",objAId:"hline_0",objBId:"hline_1",type:"hline_hline",title:"Hlines Background",zorder:-2}],inputs:[{id:"length",name:"Length",defval:14,type:"integer",min:1,max:2e3},{
id:"smoothingLine",name:"Smoothing Line",defval:"SMA",type:"text",options:["SMA","EMA","WMA"]},{id:"smoothingLength",name:"Smoothing Length",defval:14,type:"integer",min:1,max:1e4}],id:"Relative Strength Index@tv-basicstudies-1",scriptIdPart:"",name:"Relative Strength Index",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e){return r.Std.max(e,0)},this.f_1=function(e){return-r.Std.min(e,0)},this.f_2=function(e,t){return r.Std.eq(e,0)?100:r.Std.eq(t,0)?0:100-100/(1+t/e)},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._input(0),n=this._input(1),o=this._input(2);this._context.setMinimumAdditionalDepth(s+o);var a,l=this._context.new_var(i),c=r.Std.change(l),h=this.f_0(c),d=this._context.new_var(h),u=r.Std.rma(d,s,this._context),p=this.f_1(c),_=this._context.new_var(p),m=r.Std.rma(_,s,this._context),g=this.f_2(m,u),f=this._context.new_var(g);return"EMA"===n?a=r.Std.ema(f,o,this._context):"WMA"===n?a=r.Std.wma(f,o,this._context):"SMA"===n&&(a=r.Std.sma(f,o,this._context)),[{value:g},{value:a}]}}},{name:"Relative Vigor Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:u},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:a}},inputs:{in_0:10}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"RVGI",histogramBase:0,joinPoints:!1},plot_1:{title:"Signal",histogramBase:0,joinPoints:!1}},description:"Relative Vigor Index",shortDescription:"RVGI",is_price_study:!1,inputs:[{id:"in_0",name:"Length",defval:10,type:"integer",min:1,max:2e3}],id:"Relative Vigor Index@tv-basicstudies-1",scriptIdPart:"",name:"Relative Vigor Index",format:{precision:4,type:"price"}},constructor:function(){this.f_0=function(e,t){return e-t},this.f_1=function(e,t){return e/t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this.f_0(r.Std.close(this._context),r.Std.open(this._context)),n=this._context.new_var(s),o=r.Std.swma(n,this._context),a=this._context.new_var(o),l=r.Std.sum(a,i,this._context),c=this.f_0(r.Std.high(this._context),r.Std.low(this._context)),h=this._context.new_var(c),d=r.Std.swma(h,this._context),u=this._context.new_var(d),p=r.Std.sum(u,i,this._context),_=this.f_1(l,p),m=this._context.new_var(_);return[_,r.Std.swma(m,this._context)]}}},{name:"Relative Volatility Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#7E57C2"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:80},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:20}],filledAreasStyle:{fill_0:{color:"#7E57C2",transparency:90,visible:!0}},inputs:{in_0:10}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:1}},
description:"Relative Volatility Index",shortDescription:"RVI",is_price_study:!1,bands:[{id:"hline_0",name:"UpperLimit",zorder:-1.1},{id:"hline_1",name:"LowerLimit",zorder:-1.11}],filledAreas:[{id:"fill_0",objAId:"hline_0",objBId:"hline_1",type:"hline_hline",title:"Hlines Background",zorder:-2}],inputs:[{id:"in_0",name:"length",defval:10,type:"integer",min:1,max:2e3}],id:"Relative Volatility Index@tv-basicstudies-1",scriptIdPart:"",name:"Relative Volatility Index",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e,t){return r.Std.le(e,0)?0:t},this.f_1=function(e,t){return r.Std.gt(e,0)?0:t},this.f_2=function(e,t){return e/(e+t)*100},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0);this._context.setMinimumAdditionalDepth(i+12);var s=r.Std.close(this._context),n=this._context.new_var(s),o=r.Std.stdev(n,i,this._context),a=this._context.new_var(s),l=r.Std.change(a),c=this.f_0(l,o),h=this._context.new_var(c),d=r.Std.ema(h,14,this._context),u=this.f_1(l,o),p=this._context.new_var(u),_=r.Std.ema(p,14,this._context);return[this.f_2(d,_)]}}},{name:"SMI Ergodic Indicator/Oscillator",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"},plot_2:{linestyle:0,linewidth:1,plottype:1,trackPrice:!1,transparency:0,visible:!0,color:c}},inputs:{in_0:5,in_1:20,in_2:5}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],styles:{plot_0:{title:"Indicator",histogramBase:0,joinPoints:!1},plot_1:{title:"Signal",histogramBase:0,joinPoints:!1},plot_2:{title:"Oscillator",histogramBase:0,joinPoints:!1}},description:"SMI Ergodic Indicator/Oscillator",shortDescription:"SMIIO",is_price_study:!1,inputs:[{id:"in_0",name:"shortlen",defval:5,type:"integer",min:1,max:2e3},{id:"in_1",name:"longlen",defval:20,type:"integer",min:1,max:2e3},{id:"in_2",name:"siglen",defval:5,type:"integer",min:1,max:2e3}],id:"SMI Ergodic Indicator/Oscillator@tv-basicstudies-1",scriptIdPart:"",name:"SMI Ergodic Indicator/Oscillator",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t){return e-t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=this._input(2);this._context.setMinimumAdditionalDepth(i+s+n);var o=r.Std.close(this._context),a=this._context.new_var(o),l=r.Std.tsi(a,i,s,this._context),c=this._context.new_var(l),h=r.Std.ema(c,n,this._context);return[l,h,this.f_0(l,h)]}}},{name:"Smoothed Moving Average",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#673AB7"}},inputs:{in_0:7,in_1:"close"}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,isHidden:!1}},
description:"Smoothed Moving Average",shortDescription:"SMMA",is_price_study:!0,inputs:[{id:"in_0",name:"Length",defval:7,type:"integer",min:1,max:1e12},{id:"in_1",name:"Source",defval:"close",type:"source",options:["open","high","low","close","hl2","hlc3","ohlc4"]}],id:"smoothed_moving_average@tv-basicstudies-1",scriptIdPart:"",name:"Smoothed Moving Average",format:{type:"inherit"}},constructor:function(){this.f_0=function(){var e=this._input(0),t=r.Std[this._input(1)](this._context);return[r.Std.smma(t,e,this._context)]},this.main=function(e,t){return this._context=e,this._input=t,this.f_0()}}},{name:"Standard Deviation",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,id:"Standard Deviation@tv-basicstudies-1",scriptIdPart:"",name:"Standard Deviation",description:"Standard Deviation",shortDescription:"Standard Deviation",is_price_study:!1,plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:u}},inputs:{periods:5,deviations:1}},styles:{plot_0:{title:"Plot"}},inputs:[{id:"periods",name:"Periods",type:"integer"},{id:"deviations",name:"Deviations",type:"float"}],format:{precision:2,type:"price"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=this._context.new_var(r.Std.close(this._context));return[r.Std.stdev(n,i,this._context)*s]}}},{name:"Stochastic",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:80},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:20}],filledAreasStyle:{fill_0:{color:"#2196F3",transparency:90,visible:!0}},inputs:{in_0:14,in_1:1,in_2:3}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"%K",histogramBase:0,joinPoints:!1,zorder:1.1},plot_1:{title:"%D",histogramBase:0,joinPoints:!1,zorder:1.11}},description:"Stochastic",shortDescription:"Stoch",is_price_study:!1,bands:[{id:"hline_0",name:"UpperLimit",zorder:-1.1},{id:"hline_1",name:"LowerLimit",zorder:-1.11}],filledAreas:[{id:"fill_0",objAId:"hline_0",objBId:"hline_1",type:"hline_hline",title:"Hlines Background",zorder:-2}],inputs:[{id:"in_0",name:"K",defval:14,type:"integer",min:1,max:1e4},{id:"in_1",name:"D",defval:1,type:"integer",min:1,max:1e4},{id:"in_2",name:"smooth",defval:3,type:"integer",min:1,max:1e4}],id:"Stochastic@tv-basicstudies-1",scriptIdPart:"",name:"Stochastic",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=this._input(2);this._context.setMinimumAdditionalDepth(i+s+n)
;var o=r.Std.close(this._context),a=r.Std.high(this._context),l=r.Std.low(this._context),c=this._context.new_var(o),h=this._context.new_var(a),d=this._context.new_var(l),u=r.Std.stoch(c,h,d,i,this._context),p=this._context.new_var(u),_=r.Std.sma(p,s,this._context),m=this._context.new_var(_);return[_,r.Std.sma(m,n,this._context)]}}},{name:"Stochastic RSI",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#FF6D00"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:80},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:20}],filledAreasStyle:{fill_0:{color:"#2196F3",transparency:90,visible:!0}},inputs:{in_0:14,in_1:14,in_2:3,in_3:3}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"%K",histogramBase:0,joinPoints:!1,zorder:1.1},plot_1:{title:"%D",histogramBase:0,joinPoints:!1,zorder:1.11}},description:"Stochastic RSI",shortDescription:"Stoch RSI",is_price_study:!1,bands:[{id:"hline_0",name:"UpperLimit",zorder:-1.1},{id:"hline_1",name:"LowerLimit",zorder:-1.11}],filledAreas:[{id:"fill_0",objAId:"hline_0",objBId:"hline_1",type:"hline_hline",title:"Hlines Background",zorder:-2}],inputs:[{id:"in_0",name:"lengthRSI",defval:14,type:"integer",min:1,max:1e4},{id:"in_1",name:"lengthStoch",defval:14,type:"integer",min:1,max:1e4},{id:"in_2",name:"smoothK",defval:3,type:"integer",min:1,max:1e4},{id:"in_3",name:"smoothD",defval:3,type:"integer",min:1,max:1e4}],id:"Stochastic RSI@tv-basicstudies-1",scriptIdPart:"",name:"Stochastic RSI",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.f_1=function(e,t,i){var s=i.new_var(r.Std.max(r.Std.change(e),0));return r.Std.rma(s,t,i)},this.f_2=function(e,t,i){var s=i.new_var(-r.Std.min(r.Std.change(e),0));return r.Std.rma(s,t,i)},this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._input(0),n=this._input(1),o=this._input(2),a=this._input(3);e.setMinimumAdditionalDepth(s+n+o+a);var l=this._context.new_var(i),c=r.Std.rsi(this.f_1(l,s,this._context),this.f_2(l,s,this._context)),h=this._context.new_var(c),d=this._context.new_var(c),u=this._context.new_var(c),p=r.Std.stoch(h,d,u,n,this._context),_=this._context.new_var(p),m=r.Std.sma(_,o,this._context),g=this._context.new_var(m);return[m,r.Std.sma(g,a,this._context)]}}},{name:"TRIX",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:a}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{in_0:18}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"TRIX",histogramBase:0,joinPoints:!1,zorder:1}},description:"TRIX",shortDescription:"TRIX",is_price_study:!1,bands:[{id:"hline_0",name:"Zero",zorder:-1}],inputs:[{id:"in_0",
name:"length",defval:18,type:"integer",min:1,max:2e3}],id:"TRIX@tv-basicstudies-1",scriptIdPart:"",name:"TRIX",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e){return r.Std.log(e)},this.f_1=function(e){return 1e4*e},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0);e.setMinimumAdditionalDepth(3*i);var s=this.f_0(r.Std.close(this._context)),n=this._context.new_var(s),o=r.Std.ema(n,i,this._context),a=this._context.new_var(o),l=r.Std.ema(a,i,this._context),c=this._context.new_var(l),h=r.Std.ema(c,i,this._context),d=this._context.new_var(h),u=r.Std.change(d);return[this.f_1(u)]}}},{name:"Triple EMA",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:9}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"Triple EMA",shortDescription:"TEMA",is_price_study:!0,inputs:[{id:"in_0",name:"length",defval:9,type:"integer",min:1,max:1e4}],id:"Triple EMA@tv-basicstudies-1",scriptIdPart:"",name:"Triple EMA",format:{type:"inherit"}},constructor:function(){this.f_0=function(e,t,i){return 3*(e-t)+i},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0);this._context.setMinimumAdditionalDepth(3*i);var s=r.Std.close(this._context),n=this._context.new_var(s),o=r.Std.ema(n,i,this._context),a=this._context.new_var(o),l=r.Std.ema(a,i,this._context),c=this._context.new_var(l),h=r.Std.ema(c,i,this._context);return[this.f_0(o,l,h)]}}},{name:"True Strength Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#E91E63"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{in_0:25,in_1:13,in_2:13}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"True Strength Index",histogramBase:0,joinPoints:!1,zorder:1.1},plot_1:{title:"Signal",histogramBase:0,joinPoints:!1,zorder:1.11}},description:"True Strength Index",shortDescription:"True Strength Index",is_price_study:!1,bands:[{id:"hline_0",name:"Zero",zorder:-1}],inputs:[{id:"in_0",name:"long",defval:25,type:"integer",min:1,max:4999},{id:"in_1",name:"short",defval:13,type:"integer",min:1,max:4999},{id:"in_2",name:"siglen",defval:13,type:"integer",min:1,max:4999}],id:"True Strength Indicator@tv-basicstudies-1",scriptIdPart:"",name:"True Strength Index",format:{precision:4,type:"price"},usePlotsZOrder:!0},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=this._input(2);this._context.setMinimumAdditionalDepth(this._input(0)+this._input(1)+this._input(2))
;var o=r.Std.close(this._context),a=this._context.new_var(o),l=r.Std.tsi(a,s,i,this._context),c=this._context.new_var(l);return[l,r.Std.ema(c,n,this._context)]}}},{name:"Trend Strength Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!1,id:"Trend Strength Index@tv-basicstudies-1",scriptIdPart:"",name:"Trend Strength Index",description:"Trend Strength Index",shortDescription:"Trend Strength Index",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:c}},inputs:{periods:14}},styles:{plot_0:{title:"Plot"}},inputs:[{id:"periods",type:"integer",name:"Periods"}],format:{type:"inherit"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.period=this._input(0),this.invertedPeriod=1/this.period,this.sumX=(this.period-1)*this.period/2,this.sumXX=(this.period-1)*this.period*(2*this.period-1)/6,this.invertedPeriodSumXSumX=this.invertedPeriod*this.sumX*this.sumX},this.trendStrengthIndex=function(){for(var e=this._context.new_var(r.Std.close(this._context)),t=r.Std.sum(e,this.period,this._context),i=0,s=0,n=0;n<this.period;n++){var o=e.get(n);s+=(this.period-1-n)*o,i+=o*o}var a=s-this.invertedPeriod*this.sumX*t,l=(this.sumXX-this.invertedPeriodSumXSumX)*(i-this.invertedPeriod*t*t);return l<0?0==a?0:a>0?1:-1:a/(l=Math.sqrt(l))},this.main=function(e,t){return this._context=e,this._input=t,[this.trendStrengthIndex()]}}},{name:"Typical Price",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,id:"TypicalPrice@tv-basicstudies-1",scriptIdPart:"",name:"Typical Price",description:"Typical Price",shortDescription:"Typical Price",is_price_study:!0,plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#FF6D00"}},inputs:{}},styles:{plot_0:{title:"Plot"}},inputs:[],format:{type:"inherit"}},constructor:function(){this.main=function(e,t){return this._context=e,this._input=t,[r.Std.hlc3(this._context)]}}},{name:"Ultimate Oscillator",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:a}},inputs:{in_0:7,in_1:14,in_2:28}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"UO",histogramBase:0,joinPoints:!1,isHidden:!1}},description:"Ultimate Oscillator",shortDescription:"UO",is_price_study:!1,inputs:[{id:"in_0",name:"length7",defval:7,type:"integer",min:1,max:1e12},{id:"in_1",name:"length14",defval:14,type:"integer",min:1,max:1e12},{id:"in_2",name:"length28",defval:28,type:"integer",min:1,max:1e12}],id:"ultimate_oscillator@tv-basicstudies-1",scriptIdPart:"",name:"Ultimate Oscillator",format:{precision:2,type:"price"}},constructor:function(){this.f_0=function(e,t,i){var s=this._context.new_var(e),n=this._context.new_var(t);return[r.Std.sum(s,i,this._context)/r.Std.sum(n,i,this._context)]},this.f_1=function(){
var e=this._input(0),t=this._input(1),i=this._input(2),s=this._context.new_var(r.Std.close(this._context)),n=r.Std.max(r.Std.high(this._context),s.get(1)),o=this._context.new_var(r.Std.close(this._context)),a=r.Std.min(r.Std.low(this._context),o.get(1)),l=r.Std.close(this._context)-a,c=n-a,h=this.f_0(l,c,e),d=this.f_0(l,c,t),u=this.f_0(l,c,i);return[100*(4*h[0]+2*d[0]+u[0])/7]},this.main=function(e,t){return this._context=e,this._input=t,this.f_1()}}},{name:"Volatility Close-to-Close",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!1,id:"Volatility Close-to-Close@tv-basicstudies-1",scriptIdPart:"",name:"Volatility Close-to-Close",description:"Volatility Close-to-Close",shortDescription:"Volatility Close-to-Close",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#2196F3"}},inputs:{periods:10,daysPerYear:252}},styles:{plot_0:{title:"Plot"}},inputs:[{id:"periods",name:"Periods",type:"integer",defval:10,min:2},{id:"daysPerYear",name:"Days Per Year",type:"integer",defval:252,min:1,max:366}],format:{precision:2,type:"percent"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.period=this._input(0),this.daysPerYear=this._input(1)},this.stdev=function(e,t,i){var s=this.variance(e,t,i);return r.Std.sqrt(s)},this.variance=function(e,t,i){var s=r.Std.sma(e,t,i);return this.variance2(e,s,t)},this.variance2=function(e,t,i){var s,r,n=0;for(s=0;s<i;s++)n+=(r=e.get(s)-t)*r;return n/(i-1)},this.standardHistVol=function(){var e=this._context.new_var(r.Std.close(this._context)),t=this._context.new_var(r.Std.log(e.get()/e.get(1)));return 100*this.stdev(t,this.period,this._context)*r.Std.sqrt(this.daysPerYear)},this.main=function(e,t){return this._context=e,this._input=t,[this.standardHistVol()]}}},{name:"Volatility Zero Trend Close-to-Close",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!1,id:"Volatility Zero Trend Close-to-Close@tv-basicstudies-1",scriptIdPart:"",name:"Volatility Zero Trend Close-to-Close",description:"Volatility Zero Trend Close-to-Close",shortDescription:"Volatility Zero Trend Close-to-Close",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#2196F3"}},inputs:{periods:10,daysPerYear:252}},styles:{plot_0:{title:"Plot"}},inputs:[{id:"periods",name:"Periods",type:"integer",min:0,max:1e4},{id:"daysPerYear",name:"Days Per Year",type:"integer"}],format:{precision:2,type:"percent"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.period=this._input(0),this.daysPerYear=this._input(1)},this.volatliityZTCTC=function(){this._context.setMinimumAdditionalDepth(this._input(0)+1)
;for(var e=this._context.new_var(r.Std.close(this._context)),t=this._context.new_var(e.symbol.time),i=Math.sqrt((t.get(0)-t.get(1))/864e5/this.daysPerYear),s=Math.log(r.Std.close(this._context)/e.get(1)),n=this._context.new_var(s/i),o=this._context.new_var(Math.pow(n,2)),a=0,l=0;l<this.period;l++)a+=o.get(l);return 100*Math.sqrt(a/this.period)},this.main=function(e,t){return this._context=e,this._input=t,[this.volatliityZTCTC()]}}},{name:"Volatility O-H-L-C",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!1,id:"Volatility O-H-L-C@tv-basicstudies-1",scriptIdPart:"",name:"Volatility O-H-L-C",description:"Volatility O-H-L-C",shortDescription:"Volatility O-H-L-C",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:c}},inputs:{periods:10,marketClosedPercentage:0,daysPerYear:252}},styles:{plot_0:{title:"Plot"}},inputs:[{id:"periods",type:"integer",name:"Periods"},{id:"marketClosedPercentage",type:"float",name:"Market Closed Percentage",min:0,max:.999},{id:"daysPerYear",type:"integer",name:"Days Per Year"}],format:{precision:2,type:"percent"}},constructor:function(){this.init=function(e,t){this._context=e,this._input=t,this.period=this._input(0),this.marketClosedPercentage=this._input(1),this.daysPerYear=this._input(2),this.secondsPerYear=86400*this.daysPerYear},this.square=function(e){return e*e},this.volatilityOHLC=function(){var e=this._context.new_var(Math.log(r.Std.open(this._context))),t=this._context.new_var(Math.log(r.Std.high(this._context))),i=this._context.new_var(Math.log(r.Std.low(this._context))),s=this._context.new_var(Math.log(r.Std.close(this._context))),n=this._context.new_var(r.Std.close(this._context)),o=this._context.new_var(n.symbol.time),a=(o.get(0)-o.get(1))/1e3,l=.5*this.square(t.get()-i.get());l-=(Math.log(4)-1)*this.square(s.get()-e.get()),this.marketClosedPercentage>0&&(l=.12*this.square(e.get()-s.get(1))/this.marketClosedPercentage+.88*l/(1-this.marketClosedPercentage)),l/=a,l*=this.secondsPerYear;var c=this._context.new_var(l);return 100*Math.sqrt(r.Std.sum(c,this.period,this._context)/this.period)},this.main=function(e,t){return this._context=e,this._input=t,[this.volatilityOHLC()]}}},{name:"Volatility Index",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,is_price_study:!0,id:"Volatility Index@tv-basicstudies-1",scriptIdPart:"",name:"Volatility Index",description:"Volatility Index",shortDescription:"Volatility Index",plots:[{id:"plot_0",type:"line"}],defaults:{styles:{plot_0:{linestyle:0,visible:!0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:c}},inputs:{periods:10,atrMult:3,method:"Wilder Smoothing"}},styles:{plot_0:{title:"Plot"}},inputs:[{id:"periods",name:"Periods",type:"integer"},{id:"atrMult",name:"ATR Mult",type:"float"},{id:"method",name:"Method",type:"text",defval:"Exponential",options:["Exponential","Wilder Smoothing"]}],format:{type:"inherit"}},constructor:function(){this.init=function(e,t){
this._context=e,this._input=t,this.period=this._input(0),this.atrMult=this._input(1),this.maMethod=this._input(2),this.nextsar=null,this.position=null,this.sic=null,this.bars=[],this.count=0,this.lastSar=null,this._context.setMinimumAdditionalDepth("Exponential"===this.maMethod?2*this.period+2:this.period)},this.computeATR=function(){var e=r.Std.high(this._context)-r.Std.low(this._context),t=r.Std.high(this._context)-this.bars[this.bars.length-2],i=this.bars[this.bars.length-2]-r.Std.low(this._context);return this.tr=Math.max(e,t,i),"Exponential"===this.maMethod?this.atr=r.Std.ema(this._context.new_var(this.tr),this.period,this._context):this.atr=this.tr/this.period+(1-1/this.period)*this.atr,this.atr*this.atrMult},this.calculateVolatility=function(){if(r.Std.close(this._context)===this.bars[this.bars.length-1])return this.lastSar;if(this.bars.push(r.Std.close(this._context)),1===this.count)this.atr=r.Std.high(this._context)-r.Std.low(this._context),this.sic=r.Std.close(this._context);else if(this.count<this.period){var e=r.Std.high(this._context)-r.Std.low(this._context),t=r.Std.high(this._context)-this.bars[this.bars.length-2],i=this.bars[this.bars.length-2]-r.Std.low(this._context);this.atr+=Math.max(e,t,i),r.Std.close(this._context)>this.sic&&(this.sic=r.Std.close(this._context))}else if(this.count===this.period){e=r.Std.high(this._context)-r.Std.low(this._context),t=r.Std.high(this._context)-this.bars[this.bars.length-2],i=this.bars[this.bars.length-2]-r.Std.low(this._context);this.atr+=Math.max(e,t,i),this.atr*=1/this.period,r.Std.close(this._context)>this.sic&&(this.sic=r.Std.close(this._context)),this.position="LONG",this.nextsar=this.sic-this.atr*this.atrMult}else{var s=this.nextsar;"LONG"===this.position?r.Std.close(this._context)<s?(this.position="SHORT",this.sic=r.Std.close(this._context),this.nextsar=this.sic+this.computeATR()):(this.position="LONG",this.sic=Math.max(r.Std.close(this._context),this.sic),this.nextsar=this.sic-this.computeATR()):"SHORT"===this.position&&(r.Std.close(this._context)>s?(this.position="LONG",this.sic=r.Std.close(this._context),this.nextsar=this.sic-this.computeATR()):(this.position="SHORT",this.sic=Math.min(r.Std.close(this._context),this.sic),this.nextsar=this.sic+this.computeATR())),this.lastSar=s}return this.count++,s},this.main=function(e,t){return this._context=e,this._input=t,this._context.select_sym(0),[this.calculateVolatility()]}}},{name:"VWAP",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:0,transparency:0,visible:!0,color:"#2196F3"}}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"VWAP",histogramBase:0,joinPoints:!1,isHidden:!1}},description:"VWAP",shortDescription:"VWAP",is_price_study:!0,inputs:[],id:"VWAP@tv-basicstudies-1",scriptIdPart:"",name:"VWAP",format:{type:"inherit"}},constructor:function(){this.f_1=function(e){e.hist=null,e.add_hist()},this.init=function(e,t){this._isNewSession=null},this.main=function(e,t){this._context=e,this._input=t
;var i=e.new_var(),s=e.new_var(),n=this._context.symbol.time;return n&&(null===this._isNewSession&&(this._isNewSession=r.Std.createNewSessionCheck(e)),this._isNewSession(n)&&(this.f_1(i),this.f_1(s))),i.set(r.Std.nz(i.get(1))+r.Std.hlc3(this._context)*r.Std.volume(this._context)),s.set(r.Std.nz(s.get(1))+r.Std.volume(this._context)),[i.get(0)/s.get(0)]}}},{name:"VWMA",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},inputs:{in_0:20}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1}},description:"VWMA",shortDescription:"VWMA",is_price_study:!0,inputs:[{id:"in_0",name:"len",defval:20,type:"integer",min:1,max:1e4}],id:"VWMA@tv-basicstudies-1",scriptIdPart:"",name:"VWMA",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=r.Std.close(this._context),s=this._input(0),n=this._context.new_var(i);return[r.Std.vwma(n,s,this._context)]}}},{name:"Volume Oscillator",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:0}],inputs:{in_0:5,in_1:10}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:1}},description:"Volume Oscillator",shortDescription:"Volume Osc",is_price_study:!1,bands:[{id:"hline_0",name:"Zero",zorder:-1}],inputs:[{id:"in_0",name:"shortlen",defval:5,type:"integer",min:1,max:4999},{id:"in_1",name:"longlen",defval:10,type:"integer",min:1,max:4999}],id:"Volume Oscillator@tv-basicstudies-1",scriptIdPart:"",name:"Volume Oscillator",format:{precision:2,type:"percent"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e,t){return 100*(e-t)/t},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=r.Std.volume(this._context),o=this._context.new_var(n),a=r.Std.ema(o,i,this._context),l=this._context.new_var(n),c=r.Std.ema(l,s,this._context);return[this.f_0(a,c)]}}},{name:"Vortex Indicator",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#E91E63"}},inputs:{in_0:14}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"}],styles:{plot_0:{title:"VI +",histogramBase:0,joinPoints:!1,isHidden:!1},plot_1:{title:"VI -",histogramBase:0,joinPoints:!1,isHidden:!1}},description:"Vortex Indicator",shortDescription:"VI",is_price_study:!1,is_hidden_study:!1,id:"vortex_indicator@tv-basicstudies-1",inputs:[{id:"in_0",name:"Period",defval:14,type:"integer",min:2,max:1e12}],scriptIdPart:"",name:"Vortex Indicator",format:{precision:4,type:"price"}},
constructor:function(){this.f_0=function(){var e=this._input(0),t=this._context.new_var(r.Std.low(this._context)),i=this._context.new_var(r.Std.abs(r.Std.high(this._context)-t.get(1))),s=r.Std.sum(i,e,this._context),n=this._context.new_var(r.Std.high(this._context)),o=this._context.new_var(r.Std.abs(r.Std.low(this._context)-n.get(1))),a=r.Std.sum(o,e,this._context),l=this._context.new_var(r.Std.atr(1,this._context)),c=r.Std.sum(l,e,this._context);return[s/c,a/c]},this.main=function(e,t){return this._context=e,this._input=t,this.f_0()}}},{name:"Willams %R",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#7E57C2"}},bands:[{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:-20},{color:"#787B86",linestyle:2,linewidth:1,visible:!0,value:-80}],filledAreasStyle:{fill_0:{color:"#7E57C2",transparency:90,visible:!0}},inputs:{in_0:14}},plots:[{id:"plot_0",type:"line"}],styles:{plot_0:{title:"Plot",histogramBase:0,joinPoints:!1,zorder:1}},description:"Williams %R",shortDescription:"%R",is_price_study:!1,bands:[{id:"hline_0",name:"UpperLimit",zorder:-1.1},{id:"hline_1",name:"LowerLimit",zorder:-1.11}],filledAreas:[{id:"fill_0",objAId:"hline_0",objBId:"hline_1",type:"hline_hline",title:"Hlines Background",zorder:-2}],inputs:[{id:"in_0",name:"length",defval:14,type:"integer",min:1,max:2e3}],id:"Willams %R@tv-basicstudies-1",scriptIdPart:"",name:"Willams %R",format:{precision:2,type:"price"},usePlotsZOrder:!0},constructor:function(){this.f_0=function(e,t,i){return 100*(e-t)/(t-i)},this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=r.Std.high(this._context),n=this._context.new_var(s),o=r.Std.highest(n,i,this._context),a=r.Std.low(this._context),l=this._context.new_var(a),c=r.Std.lowest(l,i,this._context);return[this.f_0(r.Std.close(this._context),o,c)]}}},{name:"Williams Alligator",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,defaults:{styles:{plot_0:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#2196F3"},plot_1:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#E91E63"},plot_2:{linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0,color:"#66BB6A"}},inputs:{in_0:21,in_1:13,in_2:8,in_3:8,in_4:5,in_5:3}},plots:[{id:"plot_0",type:"line"},{id:"plot_1",type:"line"},{id:"plot_2",type:"line"}],styles:{plot_0:{title:"Jaw",histogramBase:0,joinPoints:!1},plot_1:{title:"Teeth",histogramBase:0,joinPoints:!1},plot_2:{title:"Lips",histogramBase:0,joinPoints:!1}},description:"Williams Alligator",shortDescription:"Alligator",is_price_study:!0,inputs:[{id:"in_0",name:"Jaw Length",defval:21,type:"integer",min:1,max:2e3},{id:"in_1",name:"Teeth Length",defval:13,type:"integer",min:1,max:2e3},{id:"in_2",name:"Lips Length",defval:8,type:"integer",min:1,max:2e3},{id:"in_3",name:"Jaw Offset",defval:8,type:"integer",min:1,max:2e3},{id:"in_4",name:"Teeth Offset",
defval:5,type:"integer",min:1,max:2e3},{id:"in_5",name:"Lips Offset",defval:3,type:"integer",min:1,max:2e3}],id:"Williams Alligator@tv-basicstudies-1",scriptIdPart:"",name:"Williams Alligator",format:{type:"inherit"}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._input(0),s=this._input(1),n=this._input(2),o=this._input(3),a=this._input(4),l=this._input(5),c=r.Std.hl2(this._context);return[{value:r.Std.smma(c,i,this._context),offset:o},{value:r.Std.smma(c,s,this._context),offset:a},{value:r.Std.smma(c,n,this._context),offset:l}]}}},{name:"Williams Fractals",metainfo:{_metainfoVersion:52,isTVScript:!1,isTVScriptStub:!1,defaults:{styles:{plot_0:{plottype:"shape_triangle_down",visible:!0,location:"BelowBar",transparency:0,color:a},plot_1:{plottype:"shape_triangle_up",visible:!0,location:"AboveBar",transparency:0,color:u}},inputs:{in_0:2}},plots:[{id:"plot_0",type:"shapes"},{id:"plot_1",type:"shapes"}],styles:{plot_0:{title:"Down fractals",isHidden:!1},plot_1:{title:"Up fractals",isHidden:!1}},description:"Williams Fractal",shortDescription:"Fractals",is_price_study:!0,is_hidden_study:!1,id:"Williams Fractals@tv-basicstudies-1",inputs:[{id:"in_0",name:"Periods",defval:2,type:"integer",min:2,max:1e12}],scriptIdPart:"",name:"Williams Fractals",isCustomIndicator:!0,format:{type:"inherit"}},constructor:function(){this.f_0=function(){for(var e=this._input(0),t=this._context.new_var(r.Std.high(this._context)),i=!0,s=!0,n=!0,o=!0,a=!0,l=!0,c=1;c<=e;c++)i=r.Std.and(i,r.Std.lt(t.get(e-c),t.get(e))),s=r.Std.and(s,r.Std.lt(t.get(e+c),t.get(e))),n=r.Std.and(n,r.Std.and(r.Std.le(t.get(e+1),t.get(e)),r.Std.lt(t.get(e+c+1),t.get(e)))),o=r.Std.and(o,r.Std.and(r.Std.le(t.get(e+1),t.get(e)),r.Std.and(r.Std.le(t.get(e+2),t.get(e)),r.Std.lt(t.get(e+c+2),t.get(e))))),a=r.Std.and(a,r.Std.and(r.Std.le(t.get(e+1),t.get(e)),r.Std.and(r.Std.le(t.get(e+2),t.get(e)),r.Std.and(r.Std.le(t.get(e+3),t.get(e)),r.Std.lt(t.get(e+c+3),t.get(e)))))),l=r.Std.and(l,r.Std.and(r.Std.le(t.get(e+1),t.get(e)),r.Std.and(r.Std.le(t.get(e+2),t.get(e)),r.Std.and(r.Std.le(t.get(e+3),t.get(e)),r.Std.and(r.Std.le(t.get(e+4),t.get(e)),r.Std.lt(t.get(e+c+4),t.get(e)))))));var h=r.Std.or(s,r.Std.or(n,r.Std.or(o,r.Std.or(a,l)))),d=r.Std.and(i,h),u=this._context.new_var(r.Std.low(this._context)),p=1,_=1,m=1,g=1,f=1,v=1;for(c=1;c<=e;c++)p=r.Std.and(p,r.Std.gt(u.get(e-c),u.get(e))),_=r.Std.and(_,r.Std.gt(u.get(e+c),u.get(e))),m=r.Std.and(m,r.Std.and(r.Std.ge(u.get(e+1),u.get(e)),r.Std.gt(u.get(e+c+1),u.get(e)))),g=r.Std.and(g,r.Std.and(r.Std.ge(u.get(e+1),u.get(e)),r.Std.and(r.Std.ge(u.get(e+2),u.get(e)),r.Std.gt(u.get(e+c+2),u.get(e))))),f=r.Std.and(f,r.Std.and(r.Std.ge(u.get(e+1),u.get(e)),r.Std.and(r.Std.ge(u.get(e+2),u.get(e)),r.Std.and(r.Std.ge(u.get(e+3),u.get(e)),r.Std.gt(u.get(e+c+3),u.get(e)))))),v=r.Std.and(v,r.Std.and(r.Std.ge(u.get(e+1),u.get(e)),r.Std.and(r.Std.ge(u.get(e+2),u.get(e)),r.Std.and(r.Std.ge(u.get(e+3),u.get(e)),r.Std.and(r.Std.ge(u.get(e+4),u.get(e)),r.Std.gt(u.get(e+c+4),u.get(e)))))))
;var S=r.Std.or(_,r.Std.or(m,r.Std.or(g,r.Std.or(f,v))));return[r.Std.and(p,S),d]},this.main=function(e,t){this._context=e,this._input=t;var i=this.f_0();return[{value:i[0],offset:-this._input(0)},{value:i[1],offset:-this._input(0)}]}}},{name:"Guppy Multiple Moving Average",metainfo:{isTVScript:!1,isTVScriptStub:!1,is_hidden_study:!1,description:"Guppy Multiple Moving Average",shortDescription:"GMMA",is_price_study:!0,id:"Guppy Multiple Moving Average@tv-basicstudies-1",_metainfoVersion:52,format:{type:"inherit"},defaults:{inputs:{traderEMA1Length:3,traderEMA2Length:5,traderEMA3Length:8,traderEMA4Length:10,traderEMA5Length:12,traderEMA6Length:15,investorEMA1Length:30,investorEMA2Length:35,investorEMA3Length:40,investorEMA4Length:45,investorEMA5Length:50,investorEMA6Length:60},styles:{traderEMA1:{color:"#00FFFF",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:15,visible:!0},traderEMA2:{color:"#00FFFF",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:12,visible:!0},traderEMA3:{color:"#00FFFF",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:9,visible:!0},traderEMA4:{color:"#00FFFF",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:6,visible:!0},traderEMA5:{color:"#00FFFF",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:3,visible:!0},traderEMA6:{color:"#00FFFF",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0},investorEMA1:{color:"#FF0000",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:15,visible:!0},investorEMA2:{color:"#FF0000",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:12,visible:!0},investorEMA3:{color:"#FF0000",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:9,visible:!0},investorEMA4:{color:"#FF0000",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:6,visible:!0},investorEMA5:{color:"#FF0000",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:3,visible:!0},investorEMA6:{color:"#FF0000",linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,visible:!0}}},inputs:[{defval:3,id:"traderEMA1Length",max:1e3,min:1,name:"Trader EMA 1 length",type:"integer"},{defval:5,id:"traderEMA2Length",max:1e3,min:1,name:"Trader EMA 2 length",type:"integer"},{defval:8,id:"traderEMA3Length",max:1e3,min:1,name:"Trader EMA 3 length",type:"integer"},{defval:10,id:"traderEMA4Length",max:1e3,min:1,name:"Trader EMA 4 length",type:"integer"},{defval:12,id:"traderEMA5Length",max:1e3,min:1,name:"Trader EMA 5 length",type:"integer"},{defval:15,id:"traderEMA6Length",max:1e3,min:1,name:"Trader EMA 6 length",type:"integer"},{defval:30,id:"investorEMA1Length",max:1e3,min:1,name:"Investor EMA 1 length",type:"integer"},{defval:35,id:"investorEMA2Length",max:1e3,min:1,name:"Investor EMA 2 length",type:"integer"},{defval:40,id:"investorEMA3Length",max:1e3,min:1,name:"Investor EMA 3 length",type:"integer"},{defval:45,id:"investorEMA4Length",max:1e3,min:1,name:"Investor EMA 4 length",type:"integer"},{defval:50,id:"investorEMA5Length",max:1e3,min:1,name:"Investor EMA 5 length",
type:"integer"},{defval:60,id:"investorEMA6Length",max:1e3,min:1,name:"Investor EMA 6 length",type:"integer"}],plots:[{id:"traderEMA1",type:"line"},{id:"traderEMA2",type:"line"},{id:"traderEMA3",type:"line"},{id:"traderEMA4",type:"line"},{id:"traderEMA5",type:"line"},{id:"traderEMA6",type:"line"},{id:"investorEMA1",type:"line"},{id:"investorEMA2",type:"line"},{id:"investorEMA3",type:"line"},{id:"investorEMA4",type:"line"},{id:"investorEMA5",type:"line"},{id:"investorEMA6",type:"line"}],styles:{traderEMA1:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Trader EMA 1"},traderEMA2:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Trader EMA 2"},traderEMA3:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Trader EMA 3"},traderEMA4:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Trader EMA 4"},traderEMA5:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Trader EMA 5"},traderEMA6:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Trader EMA 6"},investorEMA1:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Investor EMA 1"},investorEMA2:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Investor EMA 2"},investorEMA3:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Investor EMA 3"},investorEMA4:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Investor EMA 4"},investorEMA5:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Investor EMA 5"},investorEMA6:{histogramBase:0,isHidden:!1,joinPoints:!1,title:"Investor EMA 6"}}},constructor:function(){this.main=function(e,t){this._context=e,this._input=t;var i=this._context.new_var(r.Std.close(this._context)),s=this._input(0),n=this._input(1),o=this._input(2),a=this._input(3),l=this._input(4),c=this._input(5),h=r.Std.ema(i,s,this._context),d=r.Std.ema(i,n,this._context),u=r.Std.ema(i,o,this._context),p=r.Std.ema(i,a,this._context),_=r.Std.ema(i,l,this._context),m=r.Std.ema(i,c,this._context),g=this._input(6),f=this._input(7),v=this._input(8),S=this._input(9),y=this._input(10),b=this._input(11);return[h,d,u,p,_,m,r.Std.ema(i,g,this._context),r.Std.ema(i,f,this._context),r.Std.ema(i,v,this._context),r.Std.ema(i,S,this._context),r.Std.ema(i,y,this._context),r.Std.ema(i,b,this._context)]}}}]},238695:(e,t,i)=>{"use strict";var s;i.d(t,{SubsessionId:()=>s}),function(e){e.Regular="regular",e.Extended="extended",e.PreMarket="premarket",e.PostMarket="postmarket"}(s||(s={}))},266349:(e,t,i)=>{"use strict";i.d(t,{PointsetsManager:()=>n});var s=i(638273);const r=(0,i(817808).getLogger)("ChartApi.PointsetsManager");class n{constructor(){this._pointsetsDataBySymbol=new Map}destroy(){this._pointsetsDataBySymbol.clear()}createPointset(e,t,i,s,n){let o=this._pointsetsDataBySymbol.get(t);void 0===o&&(o=new Map,this._pointsetsDataBySymbol.set(t,o));const a=[];for(const t of s){const[i,s]=t;"number"!=typeof i||Number.isNaN(i)?r.logWarn(`Pointset time is invalid: id=${e}, ${i} of type ${typeof i}`):a.push({point:t,extrapolation:n.extrapolateTimeWithOffsetToTime(1e3*i,s)})}s.length===a.length&&o.set(e,{resolution:i,points:a})}removePointset(e){const t=[];this._pointsetsDataBySymbol.forEach(((i,s)=>{
i.delete(e),0===i.size&&t.push(s)}));for(const e of t)this._pointsetsDataBySymbol.delete(e)}invalidatePointsetsForSymbol(e,t){const i=this._pointsetsDataBySymbol.get(e);void 0!==i&&i.forEach(((e,i)=>{if(s.Interval.isEqual(e.resolution,t))for(const t of e.points)null!==t.extrapolation&&t.extrapolation.exact&&(t.extrapolation.exact=!1)}))}getUpdatesForSymbol(e,t,i,s){const r=new Map,n=this._pointsetsDataBySymbol.get(e);return void 0!==n&&n.forEach(((e,n)=>{const o=this._refreshPointsetData(e,t,i,s);null!==o&&r.set(n,o)})),r}_refreshPointsetData(e,t,i,n){if(s.Interval.isEqual(e.resolution,t))for(let t=0;t<e.points.length;++t){const s=e.points[t];if(null!==s.extrapolation&&s.extrapolation.exact)continue;const[r,n]=s.point;s.extrapolation=i.extrapolateTimeWithOffsetToTime(1e3*r,n)}const o=[];for(let i=0;i<e.points.length;++i){const s=e.points[i];if(null===s.extrapolation)return null;const a=n.indexOfTime(s.extrapolation.timeMs);if(null===a)return r.logWarn(`Cannot get index of time: time=${s.extrapolation.timeMs}, ${e.resolution} -> ${t}`),null;o.push({index:i,value:[a.index,a.timeMs/1e3]})}return o}}},249999:(e,t,i)=>{"use strict";i.d(t,{SessionTimeScale:()=>v});var s=i(650151),r=i(484727),n=i(871555),o=i(624595),a=i(85761),l=i(724912),c=i(802737);function h(e){return 60*e*60*1e3}function d(e){return 60*e*1e3}const u=[{divisor:1,weight:18},{divisor:(p=1,1e3*p),weight:19},{divisor:d(1),weight:20},{divisor:d(5),weight:21},{divisor:d(30),weight:22},{divisor:h(1),weight:30},{divisor:h(3),weight:31},{divisor:h(6),weight:32},{divisor:h(12),weight:33}];var p;function _(e,t){if(null!==t){if(e.getUTCFullYear()!==t.getUTCFullYear())return 70;if(e.getUTCMonth()!==t.getUTCMonth())return 60;if(e.getUTCDate()!==t.getUTCDate())return 50;const i=t.getTime(),s=e.getTime();for(let e=u.length-1;e>=0;--e)if(Math.floor(i/u[e].divisor)!==Math.floor(s/u[e].divisor))return u[e].weight}return 18}function m(e,t,i=0){if(0===e.length)return[];let s=i,r=i;const n=[];for(;s<e.length;)r>=t.length?(n.push({old:s,new:l.INVALID_TIME_POINT_INDEX}),s++):e[s].timeMs===t[r].timeMs?(s!==r&&n.push({old:s,new:r}),s++,r++):e[s].timeMs<t[r].timeMs?(n.push({old:s,new:l.INVALID_TIME_POINT_INDEX}),s++):r++;return n.sort(((e,t)=>{if(e.new===t.new&&e.new===l.INVALID_TIME_POINT_INDEX)return e.old-t.old;if(e.new===l.INVALID_TIME_POINT_INDEX)return-1;if(t.new===l.INVALID_TIME_POINT_INDEX)return 1;const i=e.old-e.new,s=t.old-t.new;return i>0?s>0?e.old-t.old:-1:s<0?t.new-e.new:1}))}function g(e,t){return{span:e.markWeight,time:e.displayTime,index:t}}const f=r.enabled("end_of_period_timescale_marks");class v{constructor(){this._completed=!0,this._mainSymbolExtrapolator=null,this._pointDataByTimePoint=new Map,this._seriesIds=new Set,this._displayTimezone=null,this._minFutureBarsCount=0,this._sortedTimePoints=[]}destroy(){this.clearTimeScale()}setCompleted(e){this._completed=e}isCompleted(){return this._completed}clearTimeScale(){return this._pointDataByTimePoint.clear(),this._seriesIds.clear(),this._sortedTimePoints=[],{baseIndex:null,pointsIndex:0,indexChange:[],marks:[],
points:[]}}indexOfTime(e){if(0===this._sortedTimePoints.length)return null===this._mainSymbolExtrapolator?null:this._mainSymbolExtrapolator.indexOfTime(e);if(e<this._sortedTimePoints[0].timeMs){if(null===this._mainSymbolExtrapolator)return null;const t=this._mainSymbolExtrapolator.indexOfTime(e),i=this._mainSymbolExtrapolator.indexOfTime(this._sortedTimePoints[0].timeMs);if(null===t||null===i)return null;let s=t.index-i.index;return i.timeMs!==this._sortedTimePoints[0].timeMs&&(s-=1),{index:s,timeMs:t.timeMs}}if(e>this._sortedTimePoints[this._sortedTimePoints.length-1].timeMs){if(null===this._mainSymbolExtrapolator)return null;const t=this._mainSymbolExtrapolator.indexOfTime(e),i=this._mainSymbolExtrapolator.indexOfTime(this._sortedTimePoints[this._sortedTimePoints.length-1].timeMs);if(null===t||null===i)return null;const s=t.index-i.index-1;return{index:this._sortedTimePoints.length+s,timeMs:t.timeMs}}let t=(0,o.lowerbound)(this._sortedTimePoints,e,((e,t)=>e.timeMs<t));return this._sortedTimePoints[t].timeMs!==e&&(t-=1),{index:t,timeMs:this._sortedTimePoints[t].timeMs}}setMainSymbolExtrapolator(e){this._mainSymbolExtrapolator=e,this._updateFutureBars(),this._fillPointsData(this._sortedTimePoints,0)}setMinFutureBarsCount(e){this._minFutureBarsCount=e,this._updateFutureBars()}minFutureBarsCount(){return this._minFutureBarsCount}firstFutureBarIndex(){return this._sortedTimePoints.length}firstSessionBarIndex(){return 0===this._sortedTimePoints.length?null:0}lastSessionBarIndex(){return 0===this._sortedTimePoints.length?null:this._sortedTimePoints.length-1}tickMarks(e=0){const t=this.firstFutureBarIndex();(0,s.assert)(e<=t,"tickmarks cannot be filtered in the future");const i=this._futureBars().map(((e,t)=>({timeMs:e,markWeight:0,displayTime:NaN})));this._fillPointsData(i,0,0!==this._sortedTimePoints.length?this._sortedTimePoints[this._sortedTimePoints.length-1].displayTime:null);const r=[];for(let t=e;t<this._sortedTimePoints.length;++t)r.push(g(this._sortedTimePoints[t],t));const n=i.map(((e,i)=>g(e,i+t)));return r.concat(n)}setTimezone(e){this._displayTimezone="exchange"===e?null:(0,n.get_timezone)(e),this._fillPointsData(this._sortedTimePoints,0)}fillIndexesInRows(e){if(0===e.length)return;let t=-1,i=(0,o.lowerbound)(this._sortedTimePoints,Math.round(1e3*e[0].value[0]),((e,t)=>e.timeMs<t));for(const r of e){const e=Math.round(1e3*r.value[0]);for(;i<this._sortedTimePoints.length&&this._sortedTimePoints[i].timeMs<e;)i+=1;i!==this._sortedTimePoints.length&&this._sortedTimePoints[i].timeMs===e||(i-=1),(0,s.assert)(i!==t,"data must have unique times"),t=i,r.index=i}(0,s.assert)(i<this._sortedTimePoints.length,"data must be within a data range")}convertTimesToIndexes(e){if(0===e.length)return[];let t=-1,i=(0,o.lowerbound)(this._sortedTimePoints,e[0],((e,t)=>e.timeMs<t));return e.map((e=>{for(;i<this._sortedTimePoints.length&&this._sortedTimePoints[i].timeMs<e;)i+=1;if(0===i&&e<this._sortedTimePoints[0].timeMs)return l.INVALID_TIME_POINT_INDEX;if(i>=this._sortedTimePoints.length){const t=this.indexOfTime(e)
;if(null===t)return l.INVALID_TIME_POINT_INDEX;i=t.timeMs!==e?t.index+1:t.index}return(0,s.assert)(i>t,"data must have unique sorted times"),t=i,i}))}firstSeriesBarTime(){return 0===this._sortedTimePoints.length?null:this._sortedTimePoints[0].timeMs}replaceSeriesBarsTimesTail(e,t){if(0===t.length)return null;if(!this._seriesIds.has(e))return this.setSeriesBarsTimes(e,t);const i=[],s=(0,o.lowerbound)(this._sortedTimePoints,t[0],((e,t)=>e.timeMs<t));for(let t=s;t<this._sortedTimePoints.length;++t){const s=this._sortedTimePoints[t];s.pointData.series.delete(e)&&0===s.pointData.series.size&&i.push(s)}const r=this._addBarsTimesToSeries(e,t,!0);this._cleanupPointsData(i);const n=r.map((e=>({timeMs:e.timeMs,pointData:e.pointData,markWeight:0,displayTime:NaN})));for(let e=s;e<this._sortedTimePoints.length;++e){const t=this._sortedTimePoints[e];0!==t.pointData.series.size&&n.push(t)}n.sort(((e,t)=>e.timeMs-t.timeMs));const a=this._updateTimeScalePointsTail(n);return this._applyTimeScaleChanges(a,!1)}setSeriesBarsTimes(e,t){let i=0!==this._pointDataByTimePoint.size;if(this._seriesIds.has(e))if(1===this._seriesIds.size)i=!1,this._pointDataByTimePoint.clear();else for(const t of this._sortedTimePoints)t.pointData.series.delete(e);this._addBarsTimesToSeries(e,t,!1);const s=this._seriesIds.size;0===t.length?this._seriesIds.delete(e):this._seriesIds.add(e),i&&this._cleanupPointsData(this._sortedTimePoints);const r=s<this._seriesIds.size,n=s>this._seriesIds.size,o=r&&2===this._seriesIds.size||n&&1===this._seriesIds.size,a=[];this._pointDataByTimePoint.forEach(((e,t)=>{a.push({markWeight:0,timeMs:t,displayTime:NaN,pointData:e})})),a.sort(((e,t)=>e.timeMs-t.timeMs));const l=this._updateTimeScalePoints(a);return this._applyTimeScaleChanges(l,o)}_updateFutureBars(){if(0===this._minFutureBarsCount||null===this._mainSymbolExtrapolator)return;if(0!==this._sortedTimePoints.length){const e=this._sortedTimePoints[this._sortedTimePoints.length-1].timeMs;this._mainSymbolExtrapolator.ensureExtrapolatedToFutureTime(e)}const e=this._futureBarsFirstPointIndex();this._mainSymbolExtrapolator.setMinFutureBarsCount(e+this._minFutureBarsCount)}_addBarsTimesToSeries(e,t,i){const s=i?[]:null;for(const i of t){const t=this._pointDataByTimePoint.get(i);if(void 0===t){const t=new Set;t.add(e);const r={index:0,series:t};this._pointDataByTimePoint.set(i,r),null!==s&&s.push({timeMs:i,pointData:r})}else t.series.add(e)}return s}_futureBarsFirstPointIndex(){if(null===this._mainSymbolExtrapolator||0===this._sortedTimePoints.length)return 0;const e=this._mainSymbolExtrapolator.futureBars();return(0,o.upperbound_int)(e,this._sortedTimePoints[this._sortedTimePoints.length-1].timeMs)}_futureBars(){return null===this._mainSymbolExtrapolator?[]:this._mainSymbolExtrapolator.futureBars().slice(this._futureBarsFirstPointIndex(),this._futureBarsFirstPointIndex()+1e3)}_cleanupPointsData(e){for(const t of e)0===t.pointData.series.size&&this._pointDataByTimePoint.delete(t.timeMs)}_updateTimeScalePoints(e){let t=-1;for(let i=0;i<this._sortedTimePoints.length&&i<e.length;++i){
const s=this._sortedTimePoints[i],r=e[i];if(s.timeMs!==r.timeMs){t=i;break}r.markWeight=s.markWeight,r.displayTime=s.displayTime}if(t=S(t,this._sortedTimePoints.length,e.length),-1===t)return null;for(let i=t;i<e.length;++i){e[i].pointData.index=i}this._fillPointsData(e,t);const i=m(this._sortedTimePoints,e,t);return this._sortedTimePoints=e,this._updateFutureBars(),{pointsIndex:t,indexChange:i}}_updateTimeScalePointsTail(e){if(0===e.length)return null;const t=(0,o.lowerbound)(this._sortedTimePoints,e[0].timeMs,((e,t)=>e.timeMs<t));let i=-1;for(let s=0;s<e.length;++s){const r=e[s],n=t+s;if(r.pointData.index=n,n>=this._sortedTimePoints.length)continue;this._sortedTimePoints[n].timeMs!==r.timeMs&&-1===i&&(i=n)}const s=t+e.length;if(i=S(i,this._sortedTimePoints.length,s),-1===i)return null;this._fillPointsData(e,0,0===t||0===this._sortedTimePoints.length?null:this._sortedTimePoints[t-1].displayTime);const r=m(this._sortedTimePoints.slice(t),e).map((e=>({old:e.old+t,new:e.new===l.INVALID_TIME_POINT_INDEX?e.new:e.new+t})));{const i=this._sortedTimePoints;let r=0;for(;t+r<i.length&&r<e.length;)i[t+r]=e[r],r+=1;for(;r<e.length;++r)i.push(e[r]);i.length=s}return this._updateFutureBars(),{pointsIndex:i,indexChange:r}}_getBaseIndex(){return 0===this._sortedTimePoints.length?null:this._sortedTimePoints.length-1}_fillPointsData(e,t,i=null){this._fillDiplayTimeForPoints(e,t),function(e,t=0,i=null){let s=0===t||0===e.length?i:e[t-1].displayTime,r=null!==s?new Date(1e3*s):null,n=0;for(let i=t;i<e.length;++i){const t=e[i],o=new Date(1e3*t.displayTime);t.markWeight=_(o,r),n+=t.displayTime-(s||t.displayTime),r=o,s=t.displayTime}if(0===t&&e.length>1&&null===i){const t=Math.ceil(n/(e.length-1)),i=new Date(1e3*(e[0].displayTime-t));e[0].markWeight=_(new Date(1e3*e[0].displayTime),i)}}(e,t,i)}_applyTimeScaleChanges(e,t){if(null===e)return t?(this._fillPointsData(this._sortedTimePoints,0),{points:[],pointsIndex:0,baseIndex:this._getBaseIndex(),indexChange:[],marks:this.tickMarks(0)}):null;let i=e.pointsIndex;if(0!==i&&t&&(this._fillPointsData(this._sortedTimePoints,0),i=0),0===this._sortedTimePoints.length)return{baseIndex:null,pointsIndex:0,indexChange:[],marks:[],points:[]};const s=[];for(let t=e.pointsIndex;t<this._sortedTimePoints.length;++t)s.push(this._sortedTimePoints[t].timeMs/1e3);return{...e,points:s,baseIndex:this._getBaseIndex(),marks:this.tickMarks(i)}}_fillDiplayTimeForPoints(e,t=0){if(null===this._mainSymbolExtrapolator)return;const i=this._mainSymbolExtrapolator.interval(),s=this._mainSymbolExtrapolator.barBuilder(),r=this._mainSymbolExtrapolator.symbolInfo(),o=null===this._displayTimezone?(0,n.get_timezone)(r.timezone):this._displayTimezone,l=1===this._seriesIds.size,h=i.isDWM(),d=h?(0,a.createDwmAligner)(i.value(),{timezone:r.timezone,corrections:l?r.corrections:void 0,session_holidays:l?r.session_holidays:void 0,session:l?r.session:"24x7"}):null,u=!h;for(let r=t;r<e.length;++r){let t=e[r].timeMs/1e3;f&&(t=(0,c.barTimeToEndOfPeriod)(s,t,i)),null!==d&&(t=Math.floor(d.timeToExchangeTradingDay(1e3*t)/1e3)),
u&&(t=Math.floor((0,n.utc_to_cal_ts)(o,1e3*t)/1e3)),e[r].displayTime=t}}}function S(e,t,i){return-1===e&&t!==i&&(e=i<t?Math.max(0,i-1):t),e}},198217:(e,t,i)=>{"use strict";var s=i(905417),r=i(603610),n=i(832205),o=i(457794).SymbolExtrapolator,a=i(249999).SessionTimeScale,l=i(266349).PointsetsManager,c=i(290728),h=i(85761).createDwmAligner,d=i(638273).Interval,u=i(559410),p=i(496772).visitObject,_=i(486028).isObject;i(951008),i(360741);var m=i(935844).DatafeedRequestsCachedProcessor,g=i(968381).timezoneIsAvailable,f=i(85761).isAlignmentEnabled,v=i(881881),S=v.isEncodedExtendedSymbol,y=v.decodeExtendedSymbol,b=i(632054).extractSymbolNameFromSymbolInfo,w=i(975234).replaceGraphicsTimesWithTimePointIndexIndex,P=i(484727),C=i(238695).SubsessionId,T=i(290728).getPeriodsBetweenDates;const x="pre_post_market_sessions",I=P.enabled(x);var M=-5e6;function L(e){var t=e.findIndex((function(e){return e.index!==M}));return-1===t?[]:0===t?e:e.slice(t)}function A(e,t){return e+"_"+t}var k=function(e){var t=this;this._studiesCache={},this._objectsDataCache={},this._studiesNonSeriesTimes={},this._metainfoCache=[],this._barsCoefficientsCache={},this._externalDatafeed=e,e.getVolumeProfileResolutionForPeriod&&r.overwriteVolumeProfileResolutionForPeriodGetter((function(t,i,s,r){return e.getVolumeProfileResolutionForPeriod(t,i,s,r)})),this._datafeedConfiguration=null,this._marketStatusWatchers={},this._resolveRequests={},this._resolvePromisesBySymbolId=new Map,this._symbolIdToSymbolRequestString=new Map,this._callbacks={},this._serverTimeOffset=0,t._logMessage("Datafeed settings received: {0}".format(JSON.stringify(window.configurationData))),t._datafeedConfiguration=t._adoptConfigurationData(window.configurationData),t._fireEvent("configuration_received"),t._externalDatafeed.getServerTime&&t._externalDatafeed.getServerTime((function(e){t._serverTimeOffset=e-(new Date).valueOf()/1e3})),this._invalidatedPointsetSessions=new Set,this._refreshPointsetsTimerId=null,this._pointsetsManagers={},this._quotesInfo=[],this._depthInfo=[],this._endOfData={},this._computeStudyCounter=0,this._symbolExtrapolators={},this._timeScales={},this._cachedDatafeed=new m(e,this.serverTimeOffset.bind(this),this._datafeedConfiguration.reset_cache_timeout),n.setupFeed({resolve:function(e,i,s,r){t._resolveSymbolByName(e,i,s,r)},subscribe:function(e,i,s,r,n){return t._cachedDatafeed.subscribe(e,i,s,function(e,i,s){var r=new c.SessionInfo(e.timezone,e.session,e.session_holidays,e.corrections),n=c.newBarBuilder(i,r,r);return function(e){if(e&&e.count()){var i=1e3*t.getCurrentUTCTime();n.moveTo(i),n.indexOfBar(i)>=0&&e.setLastBarClosed(!1)}s(e)}}(e,i,r),n)},unsubscribe:function(e){return t._cachedDatafeed.unsubscribe(e)}})};function E(e,t){return e+"_"+t}function D(e,t,i,s){return e+(t?"_#_"+t:"")+(i?"_#_"+i:"")+(s?"_#_"+s:"")}k.prototype._getSymbolExtrapolator=function(e,t,i){var s=d.normalize(i),r=function(e,t,i){const s=void 0!==t.subsession_id?","+t.subsession_id:"";return e+","+t.full_name+","+i+s}(e,t,s),n=this._symbolExtrapolators[r];return void 0===n&&(n=new o(t,s),
this._symbolExtrapolators[r]=n),n},k.prototype._barsCoefficients=function(e,t){if(void 0===y(e).type)return{};var i=e+t;return this._barsCoefficientsCache[i]||(this._barsCoefficientsCache[i]={}),this._barsCoefficientsCache[i]},k.prototype.destroy=function(){this._cachedDatafeed.destroy(),this._externalDatafeed=null,Object.keys(this._pointsetsManagers).forEach((function(e){this._pointsetsManagers[e].destroy()}),this),this._pointsetsManagers={}},k.prototype.purgeCache=function(){this._endOfData={},this._resolveRequests={},this._objectsDataCache={},this._studiesNonSeriesTimes={},this._studiesCache={},this._resolvePromisesBySymbolId.clear(),this._symbolIdToSymbolRequestString.clear(),Object.keys(this._pointsetsManagers).forEach((function(e){this._pointsetsManagers[e].destroy()}),this),this._pointsetsManagers={},Object.keys(this._timeScales).forEach((function(e){this._timeScales[e].destroy()}),this),this._timeScales={},Object.keys(this._symbolExtrapolators).forEach((function(e){this._symbolExtrapolators[e].destroy()}),this),this._symbolExtrapolators={}},k.prototype.purgeDataCache=function(){this._cachedDatafeed.purgeCache()},k.prototype._logMessage=function(e){P.enabled("charting_library_debug_mode")&&console.log(e)},k.prototype.on=function(e,t){return this._callbacks.hasOwnProperty(e)||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},k.prototype._fireEvent=function(e,t,i){if(this._callbacks.hasOwnProperty(e)){for(var s=this._callbacks[e],r=0;r<s.length;++r)s[r](t);i||(this._callbacks[e]=[])}},k.prototype._adoptConfigurationData=function(e){var t=TradingView.merge({},e),i=t.supported_resolutions;if(!i||0===i.length)return t.supported_resolutions=void 0,t;for(var s=[],r=0;r<i.length;r++){var n=i[r];if(-1!==s.indexOf(n))throw new Error("Duplicating resolution `"+n+"`");s.push(n)}return t.supported_resolutions=s,t},k.prototype.supportedResolutions=function(){return this._datafeedConfiguration.supported_resolutions},k.prototype.supportedCurrencies=function(){return this._datafeedConfiguration.currency_codes||[]},k.prototype.supportedUnits=function(){return this._datafeedConfiguration.units||[]},k.prototype.supportedPriceSources=function(){return this._datafeedConfiguration.price_sources},k.prototype.supportedSymbolsTypes=function(){return this._datafeedConfiguration.symbols_types||[]},k.prototype.symbolsGrouping=function(){return this._datafeedConfiguration.symbols_grouping||{futures:/$a/}},k.prototype._findStudyObject=function(e){e.endsWith("!")&&(e=e.slice(0,-1));var t=e.split("@")[0],i=JSServer.studyLibrary.filter((function(i){return i.metainfo.id===e||i.metainfo.shortDescription===t}));return 0===i.length?null:i[0]},k.prototype.getMarks=function(e,t,i,s,r){var n={red:6,green:5,blue:4,yellow:3};if(this._externalDatafeed.getMarks&&this._datafeedConfiguration.supports_marks){this._logMessage("Requesting bars marks: symbol {0}, resolution {1}, range [{2} ... {3}]".format(e.full_name,r,new Date(1e3*t).toUTCString(),new Date(1e3*i).toUTCString()));var o=this;this._externalDatafeed.getMarks(e,t,i,(function(t){
var i=t.map((function(e){return e.time=parseInt(e.time),e}));o._logMessage("Received bars marks: symbol {0}, resolution {1}, marks {2}".format(e.full_name,r,JSON.stringify(i)));var a=h(r,e),l=P.enabled("two_character_bar_marks_labels"),c=i.map((function(e){return e.tickmark=null!==a?a.timeToSessionStart(1e3*e.time)/1e3:e.time,e.direction=n[e.color],e.onClicked=function(){u.emit("onMarkClick",e.id)},e.label=!!e.label&&(l?e.label.slice(0,2):e.label[0]),e}));s(c)}),r)}},k.prototype.getTimescaleMarks=function(e,t,i,s,r){if(this._externalDatafeed.getTimescaleMarks&&this._datafeedConfiguration.supports_timescale_marks){this._logMessage("Requesting timescale marks: symbol {0}, resolution {1}, range [{2} ... {3}]".format(e.full_name,r,new Date(1e3*t).toUTCString(),new Date(1e3*i).toUTCString()));var n=this;this._externalDatafeed.getTimescaleMarks(e,t,i,(function(t){n._logMessage("Received timescale marks: symbol {0}, resolution {1}, marks {2}".format(e.full_name,r,JSON.stringify(t)));var i=h(r,e),o=t.map((function(e){return e.tickmark=null!==i?i.timeToSessionStart(1e3*e.time)/1e3:e.time,e}));s(o)}),r)}},k.prototype.getSeriesLastBarTime=function(e,t){var i=this._getSeriesData(e,t);return null===i||0===i.length?null:i[i.length-1].timeMs},k.prototype.getSeriesInterval=function(e,t){var i=this._studiesCache[e][t];return i?i.resolution:null},k.prototype.getSeriesSymbolInfo=function(e,t){var i=this._studiesCache[e][t];return i?i.symbolInfo:null},k.prototype._getSeriesData=function(e,t){return this._objectsDataCache[E(e,t)]||null},k.prototype._computeStudy=async function(e,t,i,s,n,o,a,l,c,u){var p=!0,_=[];null!==l&&(this._objectsDataCache[l]=null);var m=this._computeStudyCounter++;function g(e,t){if(e<c())return M;if(0===t)return 0;var i=_[t-1].index;return i===M?0:i+1}var v=new Map;var S=!1,y=this,b=function(){return y._studiesCache[e]&&y._studiesCache[e][n]&&y._studiesCache[e][n].activeResolve===m};y._studiesCache[e][n].activeResolve=m;var w,C,x=this._resolvePromisesBySymbolId.get(A(e,i));if(void 0===x)throw new Error("This should never happen");try{var I=await x;w=I.symbolInfo,C=I.requestedSymbol}catch(e){return void(b()&&u.onSymbolErrorCallback(e))}b()&&function(i,c){var m=d.parse(s);if(!m.isIntraday()||i.has_intraday){if(d.isDWM(s)&&void 0!==a.to){var b=h(s,i);null!==b&&(a.to=b.timeToExchangeTradingDay(a.to))}if(a.from&&a.to){const e=T(i.session,i.session_holidays,i.corrections,m.letter(),m.multiplier(),a.from,a.to);a.countBack=Math.max(e,a.countBack)}try{var w=new r.StudyEngine({tickerid:c,symbolInfo:i,period:s,body:t,sessionId:e,onErrorCallback:u.onErrorCallback,dataRange:a,subsessionId:i.subsession_id,forceAlignBars:!P.enabled("disable_sameinterval_aligning")&&f(),input:function(e){return o[e]},out:function(e,t){!function(e,t,i){for(var s=e.time,r="number"==typeof t?[t]:t,n=0;n<r.length;++n){var o=r[n];o&&"object"==typeof o&&(v.set(n,o.offset),o=o.value),"number"==typeof o&&isNaN(o)&&(o=void 0),r[n]=o}var a=_.length-1,l=a<0||s>_[a].timeMs;l?_.push({index:g(s,_.length),value:[s/1e3].concat(r),timeMs:s}):(_[a].index=g(s,a),
_[a].value=[s/1e3].concat(r),_[a].timeMs=s),p||u.onRealtimeCallback([_[_.length-1]],l,_.length,v,i)}(e,t,i)},nonseriesOut:function(e,t){u.onNonSeriesDataUpdate(t,i)},setNoMoreData:function(){S=!0},recalc:function(e,s){p=!1,_.endOfData=S,_.emptyBarCount=s.emptyBarCount,t.error&&null!==t.error()||(null!==l&&(y._objectsDataCache[l]=_),u.onDataReadyCallback(_,v,i,s))}});if(!y._studiesCache[e]||!y._studiesCache[e][n])throw Error("This should never happen");y._studiesCache[e][n].engine=w}catch(e){if(!e.studyError)throw e;u.onErrorCallback(e.message)}}else u.onErrorCallback("Unsupported resolution. Did you forget to set has_intraday to true?")}(w,C)},k.prototype._createStudy=function(e,t,i,s,r,n,o,a){var l=this;function c(e,t,i){e=L(e),l._timeScales[s].fillIndexesInRows(e),TradingView.ChartapiMessagerInstances[s].onDataUpdate(r,n,e,t),TradingView.ChartapiMessagerInstances[s].onStudyCompleted(r,n)}function h(e){var t={};if(0!==e.size){var i={},n=l._studiesCache[s][r].metainfo;e.forEach((function(e,t){i[n.plots[t].id]=e})),t.data={offsets:i}}return t}a=function(e){if(Array.isArray(e))return e;for(var t=[],i=l._studiesCache[s][r].metainfo.inputs,n=0;n<i.length;n++)t[n]=e[i[n].id];return t}(a),TradingView.ChartapiMessagerInstances[s].onStudyLoading(r,n);var d=null,u=!1;l._computeStudy(s,i,e,t,r,a,this._seriesDataRange(s,o),null,(function(){if(null===d){var e=l._getSeriesData(s,o)[0];if(void 0===e)return 1/0;d=e.timeMs}return d}),{onDataReadyCallback:function(e,t,i){u&&0===e.length||c(e,h(t))},onRealtimeCallback:function(e,t,i,o,a){e=L(e),l._timeScales[s].fillIndexesInRows(e),TradingView.ChartapiMessagerInstances[s].onDataUpdate(r,n,e,h(o))},onSymbolErrorCallback:function(){TradingView.ChartapiMessagerInstances[s].onStudyError(r,n,"error in series")},onErrorCallback:function(e){TradingView.ChartapiMessagerInstances[s].onStudyError(r,n,e)},onNonSeriesDataUpdate:function(e,t){switch(u=!0,e.type){case"projection":break;case"study_graphics":var i={data:e.data,indexes:[]},n=w(i);l._studiesNonSeriesTimes[s][r]=n,i.indexes=l._timeScales[s].convertTimesToIndexes(n),c([],i);break;case"non_series_data":n=function(e){var t={};p(e,(function(e){_(e)&&Object.keys(e).forEach((function(i){i.endsWith("__t")&&(t[e[i]]=!0)}))}),{visitInstances:!0});var i=Object.keys(t).map(Number).sort((function(e,t){return e-t}));return i.forEach((function(e,i){t[e]=i})),Object.assign(e,p(e,(function(e){return _(e)&&Object.keys(e).forEach((function(i){i.endsWith("__t")&&(e[i.slice(0,-3)]=t[e[i]])})),e}),{visitInstances:!0})),i}(i={data:e.data,indexes:[]});l._studiesNonSeriesTimes[s][r]=n,i.indexes=l._timeScales[s].convertTimesToIndexes(n),c([],i);break;default:console.warn("unsupported non-series data type for study "+e.type)}}})},k.prototype.onSessionSeriesError=function(e){this.stopSources(e);var t=this._mainSeriesRecord(e);null!==t&&(t.error=!0),this._applyTimeScaleUpdate(e,this._timeScales[e].clearTimeScale())},k.prototype.modifySeries=function(e,t,i,s,r){var n=this._mainSeriesRecord(e);if(null===n||n.guid!==t){
if(null!==n&&n.error)return this._studiesCache[e][t].symbolId=i,this._studiesCache[e][t].resolution=s,void(this._studiesCache[e][t].turnaround=r);for(var o in this._stopSourcesTree(e,t),this.createSeries(e,t,r,i,s,{countBack:0},!0),this._studiesCache[e]){var a=this._studiesCache[e][o];if(a&&"study"===a.type&&a.parentId===t){this._studiesNonSeriesTimes[e][o]=null;var l=this._studiesCache[e][a.parentId];this._createStudy(l.symbolId,l.resolution,a.studyObject,e,o,a.turnaround,a.parentId,a.inputs)}}}else this._modifyMainSeries(e,i,s,r)},k.prototype._modifyMainSeries=function(e,t,i,s){this.stopSources(e);var r=this._mainSeriesRecord(e);for(var n in this._studiesCache[e]){(o=this._studiesCache[e][n])&&"series"===o.type&&(o.guid===r.guid?this.createSeries(e,r.guid,s,t,i,{countBack:0},!0):this.createSeries(e,o.guid,o.turnaround,o.symbolId,i,{countBack:0},!0))}for(var n in this._studiesCache[e]){var o;if((o=this._studiesCache[e][n])&&"study"===o.type){this._studiesNonSeriesTimes[e][n]=null;var a=this._studiesCache[e][o.parentId];this._createStudy(a.symbolId,a.resolution,o.studyObject,e,n,o.turnaround,o.parentId,o.inputs)}}this._applyTimeScaleUpdate(e,this._timeScales[e].clearTimeScale())},k.prototype.stopSources=function(e){for(var t in this._studiesCache[e]){var i=this._studiesCache[e][t];i&&"series"===i.type&&this._stopSourcesTree(e,t)}},k.prototype._stopSourcesTree=function(e,t){for(var i in this._studiesCache[e]){var s=this._studiesCache[e][i];s&&(("series"===s.type&&i===t||"study"===s.type&&s.parentId===t)&&(s.engine&&s.engine.isStarted()&&s.engine.stop(),s.activeResolve=-1))}n.unsubscribeUnused()},k.prototype._recreateSourcesForDataRange=function(e,t){var i=[];for(var s in this._studiesCache[e]){(r=this._studiesCache[e][s])&&"series"===r.type&&!this._isEndOfData(e,s,r.turnaround)&&(this._stopSourcesTree(e,s),i.push(s))}for(var s in i.forEach((function(i){this._startSourcesTree(e,i,Object.assign({},t))}),this),this._studiesCache[e]){var r;"series"===(r=this._studiesCache[e][s]).type&&this._isEndOfData(e,s,r.turnaround)&&TradingView.ChartapiMessagerInstances[e].onSeriesCompleted(s,r.turnaround,r.engine.runner.host.symbolInfo.data_status)}this._updateTimeScaleState(e)},k.prototype._startSourcesTree=function(e,t,i){var s=this._studiesCache[e][t];for(var r in this.createSeries(e,t,s.turnaround,s.symbolId,s.resolution,i,!0),this._studiesCache[e]){var n=this._studiesCache[e][r];n&&"study"===n.type&&n.parentId===t&&this._createStudy(s.symbolId,s.resolution,n.studyObject,e,r,n.turnaround,n.parentId,n.inputs)}},k.prototype.removeStudy=function(e,t){this._studiesCache[e]&&this._studiesCache[e][t]&&this._studiesCache[e][t].engine&&(this._studiesCache[e][t].engine.stop(),n.unsubscribeUnused()),delete this._studiesCache[e][t],delete this._studiesNonSeriesTimes[e][t]},k.prototype.removeSeries=function(e,t){this._stopSourcesTree(e,t),delete this._studiesCache[e][t],this._updateMainTsBuilder(e),this._timeScales[e].isCompleted()&&this._timeScales[e].setCompleted(!1);var i=this._timeScales[e].setSeriesBarsTimes(t,[])
;this._applyTimeScaleUpdate(e,i),this._updateTimeScaleState(e)},k.prototype.modifyStudy=function(e,t,i,s){var r=this._studiesCache[e][t];if(!r)throw Error("This should never happen");var o=this._studiesCache[e][r.parentId];r.inputs=s,r.turnaround=i,r.engine&&(r.engine.stop(),n.unsubscribeUnused()),this._studiesNonSeriesTimes[e][t]=null,this._createStudy(o.symbolId,o.resolution,r.studyObject,e,t,i,r.parentId,s)},k.prototype.createStudy=function(e,t,i,s,r,n){var o=this._studiesCache[e][i],a=this._findStudyObject(r);if(null===a)return console.warn("Study does not exist: "+r),void TradingView.ChartapiMessagerInstances[e].onStudyError(t,s,"unknown study name");var l=new a.constructor;this._studiesCache[e]=this._studiesCache[e]||{},this._studiesCache[e][t]={studyObject:l,guid:t,type:"study",inputs:n,metainfo:a.metainfo,turnaround:s,parentId:i},this._studiesNonSeriesTimes[e][t]=null,this._createStudy(o.symbolId,o.resolution,l,e,t,s,i,n)},k.prototype.sessionTimeScale=function(e){return this._timeScales[e]||null},k.prototype.isTimeScaleExtendedTo=function(e,t){var i=this._mainSeriesRecord(e);if(d.isDWM(i.resolution)&&null!=i.symbolInfo){var s=h(i.resolution,i.symbolInfo);null!==s&&(t=s.timeToSessionStart(t))}var r=this._timeScales[e].indexOfTime(t);return null!==r&&r.index>=0},k.prototype.ensureExtendedTo=function(e,t,i){if(!this._studiesCache[t][e])throw Error("This should never happen");var s=this;setTimeout((function(){s._recreateSourcesForDataRange(t,{to:i})}),0)},k.prototype.extendSeriesRange=function(e,t){var i=this._timeScales[e].firstSeriesBarTime();if(null!==i){var s=this._mainSeriesRecord(e);if(d.isDWM(s.resolution)&&null!=s.symbolInfo){var r=h(s.resolution,s.symbolInfo);null!==r&&(i=r.timeToExchangeTradingDay(i))}var n=this._symbolIdToSymbolRequestString.get(A(e,s.symbolId)),o=this._barsCoefficients(n,s.resolution),a=o.barsCoefficient||1;if(!o.barsCoefficient){var l=this._getSeriesData(e,s.guid);null!==l&&(o.expectedBarsCount=l.length+t)}var c=this;setTimeout((function(){c._recreateSourcesForDataRange(e,{to:i,countBack:(t+2)*a})}),0)}else this._logMessage("Nothing to extend - there is no points on time scale")},k.prototype.seriesTurnaround=function(e,t){return this._studiesCache[e]&&this._studiesCache[e][t]&&this._studiesCache[e][t].turnaround},k.prototype._seriesDataRange=function(e,t){var i=this._studiesCache[e][t];return null!==i.firstLoadedTimeMs?{to:i.firstLoadedTimeMs,countBack:0}:i.dataRange},k.prototype._applyTimeScaleUpdate=function(e,t){if(null!==t){var i=[];for(var s in this._studiesCache[e]){var r=this._studiesCache[e][s];if(r&&"study"===r.type){var n=this._studiesNonSeriesTimes[e][s];if(n){var o={indexes:this._timeScales[e].convertTimesToIndexes(n),data:{indexes_replace:!0}};i.push({objId:s,turnaround:r.turnaround,data:[],nonSeriesData:o})}}}TradingView.ChartapiMessagerInstances[e].onTimescaleUpdate(t,i),Promise.resolve().then(function(){var t=this._mainSeriesRecord(e);if(null!==t&&null!=t.symbolInfo){var i=this._getSymbolExtrapolator(e,t.symbolInfo,t.resolution)
;this._pointsetsManagers[e].getUpdatesForSymbol(t.symbolInfo.full_name,t.resolution,i,this._timeScales[e]).forEach((function(t,i){TradingView.ChartapiMessagerInstances[e].onPointsetDataUpdate(i,null,t)}))}}.bind(this))}},k.prototype._updateMainTsBuilder=function(e){var t=this._mainSeriesRecord(e);if(null!==t&&null!=t.symbolInfo){var i=this._getSymbolExtrapolator(e,t.symbolInfo,t.resolution);this._timeScales[e].setMainSymbolExtrapolator(i)}},k.prototype._updateTimeScaleState=function(e){var t=!0,i=!0;for(var s in this._studiesCache[e]){var r=this._studiesCache[e][s];"series"===r.type&&(i=i&&this._isEndOfData(e,s,r.turnaround),t=t&&r.completed)}this._timeScales[e].isCompleted()!==t&&(this._timeScales[e].setCompleted(t),t&&TradingView.ChartapiMessagerInstances[e].onTimescaleCompleted(i))},k.prototype._mainSeriesRecord=function(e){var t=null,i=null;for(var s in this._studiesCache[e]){var r=this._studiesCache[e][s];if("series"===r.type&&(null===t&&(t=r),r.isMain)){i=r;break}}return null===i&&(i=t),null!==i&&(i.isMain=!0),i},k.prototype._seriesCount=function(e){var t=0;for(var i in this._studiesCache[e]){"series"===this._studiesCache[e][i].type&&(t+=1)}return t},k.prototype._prepareSeriesNonSeriesData=function(e,t,i){var s=i.data[i.data.length-1],r=this._getSeriesData(e,t),n=null===r?[]:i.data;return{data:{data:{reversalAmount:i.reversalAmount,boxSize:i.boxSize,price:s?s[4]:i.price,bars:n.map((function(e,t){return{time:t,open:e[1],high:e[2],low:e[3],close:e[4],volume:e[5],factor:e[6],additionalPrice:e[6]}}))}},indexes:this._timeScales[e].convertTimesToIndexes(n.map((function(e){var t=e[0]||0;return t<0?r[r.length+t].timeMs:i.projectionTime+t})))}},k.prototype.createSeries=function(e,t,i,s,n,o,a){this._setEndOfData(e,t,i,!1);var l=new r.OHLCV;this._studiesCache[e]=this._studiesCache[e]||{};var c=this._getSeriesData(e,t),h=this._studiesCache[e][t],u=this._seriesCount(e),p=this._mainSeriesRecord(e);if(!h||d.isEqual(h.resolution,n)&&h.symbolId===s)void 0!==o.countBack&&null!==c&&0!==c.length&&(o.to=c[0].timeMs),h&&null!=h.firstLoadedTimeMs?o.to=void 0!==o.to?Math.min(h.firstLoadedTimeMs,o.to):h.firstLoadedTimeMs:h||0===u||null!==p&&(null!=p.firstLoadedTimeMs?(o.to=p.firstLoadedTimeMs,o.countBack=0):o=Object.assign({},p.dataRange));else if(1===u)o=Object.assign({},h.initialDatarange);else{var _=this._timeScales[e].firstSeriesBarTime();(void 0===o.to||null!==_&&_<o.to)&&(o.to=_,o.countBack=0)}if(void 0===o.countBack&&(o.countBack=0),void 0===o.to&&0===o.countBack&&(o.countBack=100),this._studiesCache[e][t]={symbolId:s,resolution:n,studyObject:l,guid:t,type:"series",turnaround:i,dataRange:o,initialDatarange:h&&h.initialDatarange||Object.assign({},o),firstLoadedTimeMs:null,symbolInfo:null,isMain:h&&h.isMain||0===u,completed:!1},null===p||p.guid===t||!p.error){this._updateMainTsBuilder(e),this._updateTimeScaleState(e),TradingView.ChartapiMessagerInstances[e].onSeriesLoading(t,i);var m=this;this._computeStudy(e,l,s,n,t,[],o,E(e,t),(function(){return-1/0}),{onDataReadyCallback:function(r,o,l,c){var h=m._studiesCache[e][t]
;if(!h)throw Error("This should never happen");if(h.symbolInfo=l,h.firstLoadedTimeMs=c.firstLoadedTimeMs,h.completed=!0,m._updateMainTsBuilder(e),a&&m._pointsetsManagers[e].invalidatePointsetsForSymbol(l.full_name,n),0!==r.length){var d=m._symbolIdToSymbolRequestString.get(A(e,s)),u=m._barsCoefficients(d,n);u.expectedBarsCount&&u.barsCount&&(u.barsCoefficient=Math.min(Math.max(u.barsCoefficient||1,parseInt(u.expectedBarsCount/(r.length-u.barsCount)+.5)),100)),u.barsCount=r.length,m._clearSeriesData(e,t)}else!c.endOfData&&h.isMain&&setTimeout((function(){m._studiesCache[e]&&m._recreateSourcesForDataRange(e,{countBack:10})}),0);g(l),c.endOfData&&(m._logMessage("Series has no more data on server: {0}".format(l.full_name)),m._setEndOfData(e,t,i)),0===r.length&&m._clearSeriesData(e,t),TradingView.ChartapiMessagerInstances[e].onSeriesCompleted(t,i,l.data_status),m._updateTimeScaleState(e)},onRealtimeCallback:function(s,r,n,o,a){g(a,s),m._timeScales[e].fillIndexesInRows(s);var l=s[s.length-1];if(r){if(!m._studiesCache[e][t])throw Error("This should never happen");m._logMessage("New bar arrived: symbol {0}, bar {1}".format(a.full_name,JSON.stringify(l)))}else m._logMessage("Last bar update: symbol {0}, bar {1}".format(a.full_name,JSON.stringify(l))),TradingView.ChartapiMessagerInstances[e].onDataUpdate(t,i,s,null);m._fireEvent("realtime_tick",s[s.length-1],!0)},onSymbolErrorCallback:function(t){m._logMessage("Series symbol resolve error"),TradingView.ChartapiMessagerInstances[e].onSymbolError(s,t||"resolve error"),f(t||"resolve error")},onErrorCallback:function(e){m._logMessage("Series error: "+e),f(e)},onNonSeriesDataUpdate:function(s,r){if("projection"!==s.type)throw new Error("unexpected non-series data type for series "+s.type);var n=m._getSeriesData(e,t);if(null!==n)g(r,0===n.length?void 0:[n[n.length-1]],s);else{s=m._prepareSeriesNonSeriesData(e,t,s);TradingView.ChartapiMessagerInstances[e].onDataUpdate(t,i,[],s)}}})}function g(s,r,o){var a=[];if(void 0!==o){var l=(o.data||[]).reduce((function(e,t){return Math.max(e,t[0]||0)}),-1);if(null!=o.projectionTime)for(var c=0;c<=l;++c)a.push(o.projectionTime+c)}var h=null,d=null,u=s?m._getSymbolExtrapolator(e,s,n):null;if(void 0!==r){var p=r.map((function(e){return e.timeMs})).concat(a);null!==u&&u.replaceBarsTimesTail(p,r.length),d=m._timeScales[e].replaceSeriesBarsTimesTail(t,p),h=r}else{var _=m._getSeriesData(e,t)||[],g=_.map((function(e){return e.timeMs})).concat(a);null!==u&&u.setBarsTimes(g,_.length),d=m._timeScales[e].setSeriesBarsTimes(t,g),h=_}if(m._applyTimeScaleUpdate(e,d),0!==h.length||void 0!==o){m._timeScales[e].fillIndexesInRows(h);var f=void 0!==o?m._prepareSeriesNonSeriesData(e,t,o):null;TradingView.ChartapiMessagerInstances[e].onDataUpdate(t,i,h,f)}}function f(s){var r=m._studiesCache[e][t];r.completed=!0,TradingView.ChartapiMessagerInstances[e].onSeriesError(t,i,s),P.enabled("clear_bars_on_series_error")&&(r.isMain?m.onSessionSeriesError(e):m._clearSeriesData(e,t))}},k.prototype._clearSeriesData=function(e,t){var i={};for(var s in i[t]={
turnaround:this._studiesCache[e][t].turnaround},this._studiesCache[e]){var r=this._studiesCache[e][s];"study"===r.type&&r.parentId===t&&(i[s]={turnaround:r.turnaround})}TradingView.ChartapiMessagerInstances[e].onClearData(i)},k.prototype.requestMoreTickmarks=function(e,t){var i=this._timeScales[e];i.setMinFutureBarsCount(i.minFutureBarsCount()+t);var s=i.firstFutureBarIndex(),r=i.tickMarks(s);TradingView.ChartapiMessagerInstances[e].onTickmarksUpdated(s,r)},k.prototype.chartCreateSession=function(e){this._pointsetsManagers[e]=new l,this._timeScales[e]=new a,this._studiesNonSeriesTimes[e]={}},k.prototype.chartDeleteSession=function(e){this._pointsetsManagers[e].destroy(),delete this._pointsetsManagers[e],this._timeScales[e].destroy(),delete this._timeScales[e],delete this._studiesNonSeriesTimes[e]},k.prototype.removePointset=function(e,t){this._pointsetsManagers[e].removePointset(t)},k.prototype.createPointset=async function(e,t,i,s,r){var n,o=this._resolvePromisesBySymbolId.get(A(e,i));try{n=(await o).symbolInfo}catch(e){return}var a=this._getSymbolExtrapolator(e,n,s);if(this._pointsetsManagers[e].createPointset(t,n.full_name,s,r,a),null===this._refreshPointsetsTimerId){var l=this;this._refreshPointsetsTimerId=setTimeout((function(){l._refreshPointsetsTimerId=null,l._refreshPointsets(l._invalidatedPointsetSessions),l._invalidatedPointsetSessions.clear()}),0)}this._invalidatedPointsetSessions.add(e)},k.prototype._refreshPointsets=function(e){var t=this;e.forEach((function(e){var i=t._studiesCache[e];if(null!=i){var s=null;for(var r in i){var n=i[r];if("series"===n.type){s=n;break}}if(null!==s&&null!=s.symbolInfo){var o=t._getSymbolExtrapolator(e,s.symbolInfo,s.resolution);t._pointsetsManagers[e].getUpdatesForSymbol(s.symbolInfo.full_name,s.resolution,o,t._timeScales[e]).forEach((function(t,i){TradingView.ChartapiMessagerInstances[e].onPointsetDataUpdate(i,null,t)}))}}}))},k.prototype.studiesMetadata=function(){return 0===this._metainfoCache.length&&(this._metainfoCache=JSServer.studyLibrary.map((function(e){return e.metainfo})),this._metainfoCache.push({palettes:{},inputs:[],plots:[{id:"open",type:"line"},{id:"high",type:"line"},{id:"low",type:"line"},{id:"close",type:"line"},{id:"volume",type:"line"}],graphics:{},_metainfoVersion:48,description:"Unnamed Study",format:{type:"inherit"},is_hidden_study:!0,is_price_study:!1,shortDescription:"Unnamed Study",description_localized:"Unnamed Study",id:"BarSetHeikenAshi@tv-prostudies",shortId:"BarSetHeikenAshi",packageId:"tv-basicstudies",version:"13",fullId:"BarSetHeikenAshi@tv-basicstudies-13",productId:"tv-basicstudies",name:"BarSetHeikenAshi@tv-basicstudies"}),this._metainfoCache.push({palettes:{},inputs:[{defval:"close",id:"source",name:"Source",options:["open","high","low","close","hl2","hlc3","ohlc4"],type:"text"},{defval:"ATR",id:"style",name:"Style",options:["ATR","Traditional"],type:"text"},{defval:5,id:"boxSize",max:17976931348623157e292,min:1e-4,name:"BoxSize",type:"float",visible:"style==Traditional"},{defval:14,id:"atrLength",max:100,min:1,name:"AtrLength",
type:"integer",visible:"style==ATR"}],plots:[{id:"open",type:"line"},{id:"high",type:"line"},{id:"low",type:"line"},{id:"close",type:"line"},{id:"volume",type:"line"}],graphics:{},defaults:{inputs:{atrLength:14,boxSize:5,source:"close",style:"ATR"},precision:"4"},_metainfoVersion:28,description:"Unnamed Study",id:"BarSetRenko@tv-prostudies",is_hidden_study:!0,is_price_study:!1,shortDescription:"Unnamed Study",description_localized:"Unnamed Study",shortId:"BarSetRenko",packageId:"tv-prostudies",version:"13",fullId:"BarSetRenko@tv-prostudies-13",productId:"tv-prostudies",name:"BarSetRenko@tv-prostudies"}),this._metainfoCache.push({palettes:{},inputs:[{defval:"close",id:"source",name:"Source",options:["open","high","low","close","hl2","hlc3","ohlc4"],type:"text"},{defval:3,id:"lb",max:100,min:1,name:"Lb",type:"integer"}],plots:[{id:"open",type:"line"},{id:"high",type:"line"},{id:"low",type:"line"},{id:"close",type:"line"},{id:"volume",type:"line"}],graphics:{},defaults:{inputs:{lb:3,source:"close"},precision:"4"},_metainfoVersion:28,description:"Unnamed Study",id:"BarSetPriceBreak@tv-prostudies",is_hidden_study:!0,is_price_study:!1,shortDescription:"Unnamed Study",description_localized:"Unnamed Study",shortId:"BarSetPriceBreak",packageId:"tv-prostudies",version:"13",fullId:"BarSetPriceBreak@tv-prostudies-13",productId:"tv-prostudies",name:"BarSetPriceBreak@tv-prostudies"}),this._metainfoCache.push({palettes:{},inputs:[{defval:"open",id:"source",name:"Source",options:["open","high","low","close","hl2","hlc3","ohlc4"],type:"text"},{defval:"Traditional",id:"style",name:"Style",options:["ATR","Traditional"],type:"text"},{defval:14,id:"atrLength",max:100,min:1,name:"AtrLength",type:"integer",visible:"style==ATR"},{defval:1,id:"reversalAmount",max:17976931348623157e292,min:1e-4,name:"ReversalAmount",type:"float",visible:"style==Traditional"}],plots:[{id:"open",type:"line"},{id:"high",type:"line"},{id:"low",type:"line"},{id:"close",type:"line"},{id:"volume",type:"line"},{id:"change_price",type:"line"}],graphics:{},defaults:{inputs:{atrLength:14,reversalAmount:1,source:"open",style:"Traditional"},precision:"4"},_metainfoVersion:28,description:"Unnamed Study",id:"BarSetKagi@tv-prostudies",is_hidden_study:!0,is_price_study:!1,shortDescription:"Unnamed Study",description_localized:"Unnamed Study",shortId:"BarSetKagi",packageId:"tv-prostudies",version:"13",fullId:"BarSetKagi@tv-prostudies-13",productId:"tv-prostudies",name:"BarSetKagi@tv-prostudies"}),this._metainfoCache.push({palettes:{},inputs:[{defval:"HL",id:"sources",name:"Sources",options:["HL","Open","High","Low","Close"],type:"text"},{defval:"ATR",id:"style",name:"Style",options:["ATR","Traditional"],type:"text"},{defval:1,id:"boxSize",max:17976931348623157e292,min:1e-4,name:"BoxSize",type:"float",visible:"style==Traditional"},{defval:14,id:"atrLength",max:100,min:1,name:"AtrLength",type:"integer",visible:"style==ATR"},{defval:3,id:"reversalAmount",max:100,min:1,name:"ReversalAmount",type:"integer"}],plots:[{id:"open",type:"line"},{id:"high",type:"line"},{id:"low",
type:"line"},{id:"close",type:"line"},{id:"volume",type:"line"},{id:"factor",type:"line"}],graphics:{},defaults:{inputs:{atrLength:14,boxSize:1,reversalAmount:3,sources:"HL",style:"ATR"},precision:"4"},_metainfoVersion:28,description:"Unnamed Study",id:"BarSetPnF@tv-prostudies",is_hidden_study:!0,is_price_study:!1,shortDescription:"Unnamed Study",description_localized:"Unnamed Study",shortId:"BarSetPnF",packageId:"tv-prostudies",version:"13",fullId:"BarSetPnF@tv-prostudies-13",productId:"tv-prostudies",name:"BarSetPnF@tv-prostudies"})),this._metainfoCache},k.prototype.searchSymbols=function(e,t,i,s){this._logMessage("Symbol search requested: search string `{0}`, exchange: `{1}`, type `{2}`".format(e,t,i));var r=this;this._externalDatafeed.searchSymbols(e,t,i,(function(e){r._logMessage("Symbol search response: {0}".format(JSON.stringify(e))),s(e)}))},k.prototype.resolveSymbol=function(e,t,i){var s=this;this._symbolIdToSymbolRequestString.set(A(e,t),i),this._resolvePromisesBySymbolId.set(A(e,t),new Promise((function(r,n){s._resolveSymbolImpl(i,(function(s){TradingView.ChartapiMessagerInstances[e].onSymbolResolved(t,s),r({symbolInfo:s,requestedSymbol:i})}),(function(i){TradingView.ChartapiMessagerInstances[e].onSymbolError(t,i),n(i)}))})))},k.prototype._resolveSymbolImpl=function(e,t,i){S(e)||console.error("Expect to get symbol encoded string, but got the following instead: "+e);var s=y(e),r="string"==typeof s.symbol?s:s.symbol,n=r.symbol,o=r["currency-id"],a=r["unit-id"],l=r.session===C.Regular?void 0:r.session;this._resolveSymbolByName(n,{currency:o,unit:a,session:l},t,i)},k.prototype._resolveSymbolByName=function(e,t,i,s){var r,n=t&&t.currency,o=t&&t.unit,a=t&&t.session,l=D(e,n,o,a);if(this._resolveRequests[l])r=this._resolveRequests[l];else{r=this._resolveSymbolInternal(e,n||void 0,o||void 0,a||void 0),this._resolveRequests[l]=r;var c=this;r.then((function(t){c._resolveRequests[D(e,t.currency_id,t.unit_id,t.subsession_id)]=r,c._resolveRequests[D(b(t,null),t.currency_id,t.unit_id,t.subsession_id)]=r,c._resolveRequests[D(b(t,null),n,o,a)]=r})).catch((function(){}))}r.then(i).catch(s)},k.prototype._resolveSymbolInternal=function(e,t,i,s){var r=this;return new Promise(function(n,o){this._logMessage("Symbol resolve requested: `{0}` ".format(e));var a=!0;this._externalDatafeed.resolveSymbol(e,(function(t){a&&console.warn("`resolveSymbol` should return result asynchronously. Use `setTimeout` with 0 interval to execute the callback function."),r._logMessage("Symbol resolved: `{0}`, SymbolInfo in server response {1}".format(e,JSON.stringify(t))),function(e){if(e.base_name||(e.base_name=[e.name]),e.legs||(e.legs=[e.name]),e.exchange||(e.exchange=e["exchange-listed"]),e.full_name||(e.full_name=e.ticker||(e.exchange?e.exchange+":"+e.name:e.name)),e.pro_name||(e.pro_name=e.full_name),e.data_status||(e.data_status="streaming"),e.ticker||(e.ticker=e.symbol||e.name),!e.session&&e["session-regular"]&&(e.session=e["session-regular"]),!e.minmov&&e.minmovement&&(e.minmov=e.minmovement),e.currency_code&&(e.currency_id=e.currency_code),
e.original_currency_code&&(e.original_currency_id=e.original_currency_code),e.holidays&&(e.session_holidays=e.holidays),void 0!==e.has_no_volume&&(e.visible_plots_set=e.has_no_volume?"ohlc":"ohlcv"),e.supported_resolutions)for(var t=0;t<e.supported_resolutions.length;t++){var i=d.parse(e.supported_resolutions[t]);i.isValid()&&(e.supported_resolutions[t]=i.value())}if(I&&Array.isArray(e.subsessions))for(let t=0;t<e.subsessions.length;t++){const i=e.subsessions[t];switch(i["session-display"]=i.session,i.id){case C.Regular:case C.Extended:i.private=!1;break;case C.PreMarket:case C.PostMarket:i.private=!0}}}(t),function(e){function t(e){console.warn("SymbolInfo validation: "+e)}if(e.has_empty_bars&&!f()&&t('both has_empty_bars field and featureset "disable_resolution_rebuild" are enabled and may cause data issues (see #3329)'),(void 0===e.minmov||e.minmov<=0)&&t("minmov must be positive"),(void 0===e.pricescale||e.pricescale<=0)&&t("pricescale must be positive"),void 0!==e.name&&0!==e.name.length||t("name must be non-empty string"),void 0!==e.session&&0!==e.session.length||t("session must be non-empty string"),void 0!==e.holidays&&t("field holidays is deprecated, use session_holidays instead"),void 0!==e.has_no_volume&&t("field has_no_volume is deprecated, use visible_plots_set instead"),void 0===e.timezone||0===e.timezone.length?t("timezone must be non-empty string"):"exchange"!==e.timezone&&g(e.timezone)||"UTC"!==e.timezone&&t('unsupported timezone "{0}"'.format(e.timezone)),void 0!==e.intraday_multipliers){var i=e.intraday_multipliers;if(Array.isArray(i))for(var s=0;s<i.length;++s)"string"!=typeof i[s]&&t('intraday_multipliers[{0}] = "{1}" must be string (now: {2})'.format(s+1,i[s],typeof i[s]));else t("intraday_multipliers must be array")}(e.supported_resolutions||[]).filter((function(e){return!d.isValid(e)})).forEach((function(e){t("supported_resolutions field contains invalid value: "+e)})),I||(void 0!==e.subsessions&&t("Symbol info contains subsessions but the pre_post_market_sessions feature is not enabled, so the subsessions will be ignored"),void 0!==e.subsession_id&&t("Symbol info contains a subsession ID but the pre_post_market_sessions feature is not enabled, so the subsession ID will be ignored"))}(t),r._logMessage("Symbol info after post-processing: `{0}`, SymbolInfo {1}".format(e,JSON.stringify(t))),n(t)}),(function(t){r._logMessage("Symbol resolve failed: `{0}`, reason: `{1}`".format(e,t)),o(t)}),{currencyCode:t,unitId:i,session:s}),a=!1}.bind(this))},k.prototype._createMarketStatusWatchers=function(e,t){void 0===this._marketStatusWatchers[e]&&(this._marketStatusWatchers[e]={});var i=this;t.forEach((function(t){void 0===i._marketStatusWatchers[e][t]&&(i._marketStatusWatchers[e][t]=new s(i._resolveSymbolByName.bind(i),e,t))}))},k.prototype._removeMarketStatusWatchers=function(e){var t=this;Object.keys(this._marketStatusWatchers[e]||{}).forEach((function(i){t._marketStatusWatchers[e][i].stop()})),this._marketStatusWatchers[e]={}},k.prototype._stopQuotesSubscription=function(e){
this._quotesInfo[e].listenerGUID&&(this._externalDatafeed.unsubscribeQuotes(this._quotesInfo[e].listenerGUID),this._quotesInfo[e].listenerGUID=void 0),this._removeMarketStatusWatchers(e)},k.prototype._startQuotesSubscription=function(e){var t={},i=this;function s(t,s){var r=i._marketStatusWatchers[e][t.n];t.symbolname=t.n,t.status=t.s,t.values=t.v,t.values.change=t.v.ch,t.values.last_price=t.v.lp,t.values.change_percent=t.v.chp,t.values.current_session=t.v.cs||r&&r.marketStatus(),t.values.pricescale=s.pricescale,t.values.minmov=s.minmov,t.values.minmove2=s.minmove2||0,t.values.fractional=s.fractional||!1,r&&t.v.cs&&r.stop(),TradingView.ChartapiMessagerInstances[e].onQuotesData([e].concat([t]))}function r(e){e.forEach((function(e){void 0!==t[e.n]?null!==t[e.n]&&s(e,t[e.n]):i._resolveSymbolByName(e.n,null,(function(i){t[e.n]=i,s(e,i)}),(function(){t[e.n]=null}))}))}var n=this._quotesInfo[e].symbols;0!==n.length&&(this._externalDatafeed.getQuotes&&!P.enabled("charting_library")?this._externalDatafeed.getQuotes(n,(function(t){i._quotesInfo[e]&&0!==i._quotesInfo[e].symbols.length&&(r(t),i._quotesInfo[e].listenerGUID=e,i._externalDatafeed.subscribeQuotes(n,i._quotesInfo[e].fastSymbols,r,i._quotesInfo[e].listenerGUID))}),(function(e){})):!this._externalDatafeed.getQuotes&&P.enabled("trading_terminal")&&setTimeout((function(){r(n.map((function(e){return{n:e,s:"ok",v:{}}})))})),this._createMarketStatusWatchers(e,n))},k.prototype._restartQuotesSubscription=function(e){this._stopQuotesSubscription(e),this._startQuotesSubscription(e)},k.prototype.quoteCreateSession=function(e){this._quotesInfo[e]={symbols:[],fastSymbols:[],listenerGUID:void 0}},k.prototype.quoteDeleteSession=function(e){this._stopQuotesSubscription(e),this._quotesInfo[e]=null},k.prototype.quoteSetFields=function(e,t){},k.prototype.quoteAddSymbols=function(e,t){this._quotesInfo[e].symbols=this._filteredSymbols(this._quotesInfo[e].symbols.concat(t)),this._restartQuotesSubscription(e)},k.prototype.quoteRemoveSymbols=function(e,t){this._quotesInfo[e].symbols=this._quotesInfo[e].symbols.filter((function(e){return t.indexOf(e)<0})),this._restartQuotesSubscription(e)},k.prototype.quoteFastSymbols=function(e,t){this._quotesInfo[e].fastSymbols=this._filteredSymbols(t),this._restartQuotesSubscription(e)},k.prototype.quoteHibernateAll=function(e){},k.prototype._stopDepthSubscription=function(e){this._depthInfo[e].listenerGUID&&(this._externalDatafeed.unsubscribeDepth(this._depthInfo[e].listenerGUID),this._depthInfo[e].listenerGUID=void 0)},k.prototype._startDepthSubscription=function(e){var t=this,i=this._depthInfo[e].symbol;function s(e){return e.map((function(e){return{p:e.price,v:e.volume}}))}function r(e){var t={};return t.s=i,t.bids=s(e.bids),t.asks=s(e.asks),t}i&&this._externalDatafeed.subscribeDepth&&(t._depthInfo[e].listenerGUID=this._externalDatafeed.subscribeDepth(i,(function(i){var s;t._depthInfo[e]&&((s=i).snapshot?TradingView.ChartapiMessagerInstances[e].onDepthData([e].concat([r(s)])):TradingView.ChartapiMessagerInstances[e].onDepthUpdate([e].concat([r(s)])))
})))},k.prototype._restartDepthSubscription=function(e){this._stopDepthSubscription(e),this._startDepthSubscription(e)},k.prototype.depthCreateSession=function(e){this._depthInfo[e]={symbol:null,listenerGUID:void 0}},k.prototype.depthDeleteSession=function(e){this._depthInfo[e].symbol=null,this._stopDepthSubscription(e),delete this._depthInfo[e]},k.prototype.depthSetSymbol=function(e,t){this._depthInfo[e].symbol=t,this._restartDepthSubscription(e)},k.prototype._filteredSymbols=function(e){var t=[];return e.forEach((function(e){e instanceof Object||t.indexOf(e)<0&&t.push(e)})),t},k.prototype._isEndOfData=function(e,t,i){var s=e+"!"+t+"@"+i;return!!this._endOfData[s]},k.prototype._setEndOfData=function(e,t,i,s){var r=e+"!"+t+"@"+i;this._endOfData[r]=!1!==s},k.prototype.serverTimeOffset=function(){return this._serverTimeOffset},k.prototype.serverTime=function(){return 1e3*this.getCurrentUTCTime()},k.prototype.getCurrentUTCTime=function(){return(new Date).valueOf()/1e3+this._serverTimeOffset},k.prototype.switchTimezone=function(e,t){this._timeScales[e].setTimezone(t);var i=this._timeScales[e].tickMarks();null!==i&&TradingView.ChartapiMessagerInstances[e].onTickmarksUpdated(0,i)},e.exports=k},457794:(e,t,i)=>{"use strict";i.d(t,{SymbolExtrapolator:()=>c});var s=i(650151),r=i(624595),n=i(290728),o=i(831551),a=i(638273);function l(e,t){return e.length>t}class c{constructor(e,t,i=2e5){this._firstRealBarTimeMs=null,this._historyBarsCache=[],this._projectionFirstIndex=1/0,this._barsTimes=[],this._minFutureBarsCount=0,this._lastRealBarTimeMs=null,this._futureBarsCache=[],this._symbolInfo=e,this._interval=a.Interval.parse(t),this._extrapolateLimit=i,this._barBuilder=(0,n.newBarBuilder)(t,new n.SessionInfo(e.timezone,e.session,e.session_holidays,e.corrections),null)}destroy(){this.clear()}interval(){return this._interval}barBuilder(){return this._barBuilder}symbolInfo(){return this._symbolInfo}clear(){this._firstRealBarTimeMs=null,this._historyBarsCache=[],this._barsTimes=[],this._lastRealBarTimeMs=null,this._futureBarsCache=[],this._minFutureBarsCount=0,this._projectionFirstIndex=1/0}firstFutureBarIndex(){return this._barsTimes.length}futureBars(){return this._futureBarsCache}replaceBarsTimesTail(e,t=e.length){if(0===e.length)return;if(0===this._barsTimes.length)return void this.setBarsTimes(e,t);const i=e[0],n=this._barsTimes[this._barsTimes.length-1],o=i>n?this._barsTimes.length:(0,r.lowerbound_int)(this._barsTimes,i);0!==o?(this._barsTimes.splice(o,this._barsTimes.length,...e),this._projectionFirstIndex=t===e.length?this._barsTimes.length:this._barsTimes.indexOf(e[t]),(0,s.assert)(-1!==this._projectionFirstIndex,"something went wrong"),n!==e[e.length-1]&&this._setLastRealBarTime(e[e.length-1])):this.setBarsTimes(e,t)}setBarsTimes(e,t=e.length){const i=this._barsTimes;if(this._barsTimes=e.slice(),this._projectionFirstIndex=0===this._barsTimes.length?1/0:t,0===e.length)return this._historyBarsCache=[],this._futureBarsCache=[],this._firstRealBarTimeMs=null,void(this._lastRealBarTimeMs=null)
;0!==i.length&&i[i.length-1]===e[e.length-1]||this._setLastRealBarTime(e[e.length-1]),0!==i.length&&i[0]===e[0]||(this._historyBarsCache=[],this._firstRealBarTimeMs=e[0])}extrapolateTimeWithOffsetToTime(e,t){if(0===t)return{timeMs:e,exact:!0};0===this._barsTimes.length&&(t<0?null===this._firstRealBarTimeMs?this._firstRealBarTimeMs=e:(this._extendHistoryCacheToTimeFromRight(Math.min(e,null!==this._lastRealBarTimeMs?this._lastRealBarTimeMs:1/0)),this._ensureExtrapolatedToHistoryTime(e)):null===this._lastRealBarTimeMs?this._lastRealBarTimeMs=e:(this._extendFutureCacheToTimeFromLeft(Math.max(e,null!==this._firstRealBarTimeMs?this._firstRealBarTimeMs:1/0)),this._ensureExtrapolatedToFutureTime(e)));const i=this.indexOfTime(e);if(null===i)return null;const s=this._timeOfBarIndex(i.index+t);return null===s?null:((i.index<0||this._projectionFirstIndex<=i.index)&&(s.exact=!1),s)}indexOfTime(e){if(null!==this._firstRealBarTimeMs&&e<this._firstRealBarTimeMs){this._ensureExtrapolatedToHistoryTime(e);let t=(0,r.lowerbound_int)(this._historyBarsCache,e);if(0!==this._historyBarsCache.length&&0===t&&e<this._historyBarsCache[0])return null;t!==this._historyBarsCache.length&&this._historyBarsCache[t]===e||(t-=1);return{index:t-this._historyBarsCache.length,timeMs:this._historyBarsCache[t]}}if(null!==this._lastRealBarTimeMs&&e>this._lastRealBarTimeMs){this._ensureExtrapolatedToFutureTime(e);let t=(0,r.lowerbound_int)(this._futureBarsCache,e);if(0!==this._futureBarsCache.length&&t===this._futureBarsCache.length&&e>this._futureBarsCache[this._futureBarsCache.length-1])return null;this._futureBarsCache[t]!==e&&(t-=1);const i=Math.max(1,this._barsTimes.length)+t;return{index:i,timeMs:i===this._barsTimes.length-1?(0,s.ensureNotNull)(this._lastRealBarTimeMs):this._futureBarsCache[t]}}if(0===this._barsTimes.length)return null!==this._firstRealBarTimeMs&&this._firstRealBarTimeMs<=e||null!==this._lastRealBarTimeMs&&e<=this._lastRealBarTimeMs?{index:0,timeMs:(0,s.ensureNotNull)(this._timeOfBarIndex(0)).timeMs}:null;let t=(0,r.lowerbound_int)(this._barsTimes,e);return this._barsTimes[t]!==e&&(t-=1),{index:t,timeMs:this._barsTimes[t]}}setMinFutureBarsCount(e){this._minFutureBarsCount=e,0!==this._barsTimes.length&&this._ensureExtrapolatedToFutureBar(e)}ensureExtrapolatedToFutureTime(e){this._ensureExtrapolatedToFutureTime(e)}_setLastRealBarTime(e){const t=this._futureBarsCache.length,i=(0,r.upperbound_int)(this._futureBarsCache,e);0===i?this._extendFutureCacheToTimeFromLeft(e):(this._lastRealBarTimeMs=e,this._futureBarsCache=this._futureBarsCache.slice(i)),this._ensureExtrapolatedToFutureBar(Math.max(t,this._minFutureBarsCount))}_timeOfBarIndex(e){var t;if(e<0){const t=Math.abs(e);this._ensureExtrapolatedToHistoryBar(t);const i=this._historyBarsCache.length-t;return i<0?null:{timeMs:this._historyBarsCache[i],exact:!1}}if(0===e&&0===this._barsTimes.length)return{timeMs:(0,s.ensureNotNull)(null!==(t=this._firstRealBarTimeMs)&&void 0!==t?t:this._lastRealBarTimeMs),exact:!1};if(e>=this._barsTimes.length){const t=e-Math.max(1,this._barsTimes.length)
;return this._ensureExtrapolatedToFutureBar(t+1),t>=this._futureBarsCache.length?null:{timeMs:this._futureBarsCache[t],exact:!1}}return{timeMs:this._barsTimes[e],exact:e<this._projectionFirstIndex}}_extendFutureCacheFromRight(e){const t=0!==this._futureBarsCache.length?this._futureBarsCache[this._futureBarsCache.length-1]:this._lastRealBarTimeMs;if(null===t)return!1;const i=e(t,this._futureBarsCache.length);return 0!==i.length&&(this._futureBarsCache=this._futureBarsCache.concat(i),!0)}_extendHistoryCacheFromLeft(e){const t=0!==this._historyBarsCache.length?this._historyBarsCache[0]:this._firstRealBarTimeMs;if(null===t)return;const i=e(t,this._historyBarsCache.length);this._historyBarsCache=i.concat(this._historyBarsCache)}_extendFutureCacheToTimeFromLeft(e){if(null!==this._lastRealBarTimeMs&&this._lastRealBarTimeMs<=e)return;if((0,s.assert)(0===this._barsTimes.length||e===this._barsTimes[this._barsTimes.length-1],"invalid argument"),this._lastRealBarTimeMs=e,0===this._futureBarsCache.length)return;const t=(0,o.extrapolateBarsFrontToTime)(this._barBuilder,e,this._futureBarsCache[0]-1,this._extrapolateLimit,!0).times;this._futureBarsCache=t.concat(this._futureBarsCache)}_extendHistoryCacheToTimeFromRight(e){if(null!==this._firstRealBarTimeMs&&this._firstRealBarTimeMs>=e)return;if((0,s.assert)(0===this._barsTimes.length,"bars should be empty"),this._firstRealBarTimeMs=e,0===this._historyBarsCache.length)return;const t=(0,o.extrapolateBarsFrontToTime)(this._barBuilder,this._historyBarsCache[this._historyBarsCache.length-1],e-1,this._extrapolateLimit,!0).times;this._historyBarsCache=this._historyBarsCache.concat(t)}_ensureExtrapolatedToFutureBar(e){return!(this._futureBarsCache.length>=e||l(this._futureBarsCache,this._extrapolateLimit))&&this._extendFutureCacheFromRight(((t,i)=>(0,o.extrapolateBarsFrontByCount)(this._barBuilder,t,e-i,!0).times))}_ensureExtrapolatedToFutureTime(e){null!==this._lastRealBarTimeMs&&this._lastRealBarTimeMs>=e||l(this._futureBarsCache,this._extrapolateLimit)||0!==this._futureBarsCache.length&&this._futureBarsCache[this._futureBarsCache.length-1]>=e||(this._extendFutureCacheFromRight(((t,i)=>(0,o.extrapolateBarsFrontToTime)(this._barBuilder,t,e,this._extrapolateLimit,!0).times)),this._futureBarsCache[this._futureBarsCache.length-1]<e&&this._ensureExtrapolatedToFutureBar(this._futureBarsCache.length+1))}_ensureExtrapolatedToHistoryBar(e){this._historyBarsCache.length>=e||l(this._historyBarsCache,this._extrapolateLimit)||this._extendHistoryCacheFromLeft(((t,i)=>(0,o.extrapolateBarsFrontByCount)(this._barBuilder,t,-(e-i),!0).times.reverse()))}_ensureExtrapolatedToHistoryTime(e){null!==this._firstRealBarTimeMs&&this._firstRealBarTimeMs<=e||l(this._historyBarsCache,this._extrapolateLimit)||0!==this._historyBarsCache.length&&this._historyBarsCache[0]<=e||(this._extendHistoryCacheFromLeft(((t,i)=>{const s=(0,o.extrapolateBarsFrontToTime)(this._barBuilder,t-1,e-1,this._extrapolateLimit,!0).times;return s[s.length-1]===t?s.slice(0,-1):s})),
(0===this._historyBarsCache.length||this._historyBarsCache[0]>e)&&this._ensureExtrapolatedToHistoryBar(this._historyBarsCache.length+1))}}},646846:(e,t,i)=>{"use strict";i.d(t,{backend:()=>s});const s=i(520159)},850190:(e,t,i)=>{"use strict";i.d(t,{defaultWatchlistSymbols:()=>n,setDefaultWatchlistSymbols:()=>o});var s=i(484727);let r=[];function n(){return s.enabled("uppercase_instrument_names")?r.map((e=>e.toUpperCase())):r}function o(e){r=e}},643770:(e,t,i)=>{"use strict";var s=i(220863);function r(e,t,i){if(this._chartApi=e,this._sessionid="ds_"+s.randomHash(),this._sessionstarted=!1,!isFinite(t))throw new RangeError("scale must be a finite number");if(!isFinite(i))throw new RangeError("viewportWidth must be a finite number");this._scale=t,this._viewportWidth=i}r.prototype.connected=function(){return this._chartApi.connected()},r.prototype.connect=function(e){this._globalHandler=e,this._chartApi.createSession(this._sessionid,this),this._chartApi.connect()},r.prototype.disconnect=function(){this._chartApi.disconnect()},r.prototype.depthSetSymbol=function(e){this._chartApi.depthSetSymbol(this._sessionid,e)},r.prototype.depthClearSymbol=function(){this._chartApi.depthClearSymbol(this._sessionid)},r.prototype.depthSetScale=function(e){if(!isFinite(e))throw new RangeError("scale must be a finite number");this._chartApi.depthSetScale(this._sessionid,e),this._scale=e},r.prototype.onMessage=function(e){switch(e.method){case"connected":this._sessionstarted||(this._chartApi.depthCreateSession(this._sessionid,this._scale,this._viewportWidth),this._sessionstarted=!0);break;case"disconnected":this._sessionstarted=!1}this._globalHandler(e)},r.prototype.stopSession=function(){this._chartApi.depthDeleteSession(this._sessionid),this._sessionstarted=!1},e.exports=r},577027:(e,t,i)=>{"use strict";i.d(t,{HandlerInfo:()=>s});class s{constructor(e,t){this.handler=e,this.customId=t}}},820402:(e,t,i)=>{"use strict";var s,r;function n(e,t){return"period-back"===e.type&&"period-back"===t.type?e.value===t.value:"time-range"===e.type&&"time-range"===t.type&&(e.from===t.from&&e.to===t.to)}i.d(t,{TIMEFRAMETYPE:()=>r,areEqualTimeFrames:()=>n}),function(e){e.extractErrorReason=function(e){return e.params[1]}}(s||(s={})),function(e){e.PeriodBack="period-back",e.TimeRange="time-range"}(r||(r={}))},80037:()=>{"use strict";TradingView.Pro=function(){this.hasPackage=function(){return!1}},window.user={is_pro:!1,settings:{}},TradingView.Pro.prototype.isPaidPro=function(){return!1},TradingView.Pro.prototype.isSupportAvailable=function(){return!1},TradingView.Pro.prototype.getProduct=function(){return{}},TradingView.Pro.prototype.getStudiesOrder=function(){return[]}},900446:(e,t,i)=>{"use strict";i.r(t),i.d(t,{QuoteCache:()=>r,QUOTE_FIELDS:()=>n,QUOTE_FIELDS_CACHE:()=>o});var s=i(650151);class r{constructor(e){this._cache=new Map,this._fields=[...e.fields]}update(e,t,i){const r=(0,s.ensureDefined)(e.symbolname);if(this._cache.has(r)||this._cache.set(r,{symbolname:r,status:e.status,values:{}}),"error"===e.status)return;const n=(0,
s.ensureDefined)(this._cache.get(r));n.status=e.status;for(const s of this._fields)t.has(s)&&(i||void 0!==e.values[s])&&(n.values[s]=e.values[s])}get(e){var t;return null!==(t=this._cache.get(e))&&void 0!==t?t:null}fields(){return this._fields}}const n=new Set(["pro_name","base_name","logoid","currency-logoid","base-currency-logoid","short_name","description","exchange","listed_exchange","type","country_code","provider_id","sector","typespecs","industry","currency_id","last_price","fractional","minmov","minmove2","pricescale","change","change_percent","volume","average_volume","market_cap_basic","total_revenue","earnings_per_share_basic_ttm","price_earnings_ttm","beta_1_year","dps_common_stock_prim_issue_fy","dividends_yield","earnings_release_next_date","earnings_per_share_forecast_next_fq","earnings_release_date","earnings_per_share_fq","fundamental_currency_code","symbol-primaryname","currency_code","rates_mc","rates_fy","rates_ttm","value_unit_id","update_mode","language","local_description","short_description","source","source2","format","recommendation_mark","last_report_frequency"]),o=new r({fields:n})},588163:(e,t,i)=>{"use strict";i.d(t,{getQuoteSessionInstance:()=>o,getQuoteSessionNoEnsure:()=>a,destroyQuoteSessions:()=>l});var s=i(9427),r=i.n(s);const n={};function o(e="full"){return n[e]||function(e="full",t){n[e]=t}(e,new(r())(e)),n[e]}function a(e="full"){return n[e]}function l(){for(const e in n)if(n.hasOwnProperty(e)){const t=n[e];void 0!==t&&t.destroy(),delete n[e]}}},959030:(e,t,i)=>{"use strict";i.d(t,{QuoteSession:()=>r});var s=i(220863);class r{constructor(e,t=(0,s.randomHash)()){this._sessionstarted=!1,this._globalHandler=null,this._chartApi=e,this._sessionid="qs_"+t}destroy(){this._sessionstarted&&(this._chartApi.quoteDeleteSession(this._sessionid),this._sessionstarted=!1)}connected(){return this._chartApi.connected()}connect(e){this._globalHandler=e,this._chartApi.createSession(this._sessionid,this),this._chartApi.connect()}disconnect(){this._chartApi.disconnect()}quoteAddSymbols(e){this._chartApi.quoteAddSymbols(this._sessionid,e)}quoteRemoveSymbols(e){this._chartApi.quoteRemoveSymbols(this._sessionid,e)}quoteFastSymbols(e){this._chartApi.quoteFastSymbols(this._sessionid,e)}quoteSetFields(e){this._chartApi.quoteSetFields(this._sessionid,e)}onMessage(e){var t;switch(e.method){case"connected":this._sessionstarted||(this._chartApi.quoteCreateSession(this._sessionid),this._sessionstarted=!0);break;case"disconnected":this._sessionstarted=!1}null===(t=this._globalHandler)||void 0===t||t.call(this,e)}quoteHibernateAll(){this._chartApi.quoteHibernateAll(this._sessionid)}}window.TradingView.QuoteSession=r},9427:(e,t,i)=>{"use strict";e=i.nmd(e);var s=i(922157),r=i(343370).default,n=i(304889).default,o=i(821737).PriceFormatter;const{uniq:a}=i(909196);var l=i(220863);const{normalizeUpdateMode:c}=i(84776);var h=i(606615).deepExtend;const{QUOTE_FIELDS_CACHE:d,QUOTE_FIELDS:u}=i(900446);var p;function _(e,t){this.options=Object.assign({throttleTimeout:125},t),this._connected=!1,this._symbol_data={},
this._subscriptions={},this.onConnect=new s,this.onDisconnect=new s,this._quoteApi=new p(window.ChartApiInstance),this._type=e||"full",this._delayUpdateFastSymbols=n(this._updateFastSymbols,250),this._throttledSymbolData={},this._formatterValuesCache={},this._waitingForFormatters={},this._snapshotValuesCache={},this._waitingForSnapshot={},this.connect()}p=i(959030).QuoteSession,_.prototype.destroy=function(){this._quoteApi.destroy(),this._quoteApi=null,this._connected=!1,this.onDisconnect.fire()},_.prototype.typeFields={},_.prototype.typeFields.simple=["base-currency-logoid","ch","chp","currency-logoid","currency_code","currency_id","base_currency_id","current_session","description","exchange","format","fractional","is_tradable","language","local_description","listed_exchange","logoid","lp","lp_time","minmov","minmove2","original_name","pricescale","pro_name","short_name","type","typespecs","update_mode","volume","value_unit_id"],_.prototype.typeFields.simpleDetailed=[].concat(_.prototype.typeFields.simple,["ask","bid","fundamentals","high_price","is_tradable","low_price","open_price","prev_close_price","rch","rchp","rtc","rtc_time","status","basic_eps_net_income","beta_1_year","earnings_per_share_basic_ttm","industry","market_cap_basic","price_earnings_ttm","sector","volume","dividends_yield","timezone"]),_.prototype.typeFields.full=[],_.prototype.typeFields.watchlist=[].concat(_.prototype.typeFields.simple,["rchp","rtc","country_code","provider_id"]),_.prototype.typeFields.portfolio=["pro_name","short_name","exchange","listed_exchange","description","sector","type","typespecs","industry","currency_code","currency_id","ch","chp","logoid","currency-logoid","base-currency-logoid","earnings_per_share_forecast_next_fq","earnings_release_next_date","earnings_release_date","earnings_per_share_fq","lp","fractional","minmov","minmove2","pricescale","volume","average_volume","market_cap_basic","total_revenue","earnings_per_share_basic_ttm","price_earnings_ttm","beta_1_year","dps_common_stock_prim_issue_fy","dividends_yield","fundamental_currency_code","rates_mc","rates_fy","rates_ttm","format"],_.prototype.typeFields.notes=["short_name","pro_name","logoid","currency-logoid","base-currency-logoid","symbol-primaryname","type","typespecs"],_.prototype.connect=function(e){this._quoteApi.connect(this.quoteHandler.bind(this))},_.prototype.quoteHandler=function(e){var t=e.method,i=e.params;switch(t){case"connected":this._connected||(this._connected=!0,this.onConnected());break;case"quote_list_fields":break;case"quote_symbol_data":this._connected&&this.onSymbolData(i[0]);break;case"quote_completed":this._connected&&this.onSymbolData({symbolname:i[0],complete:performance.now(),values:{}});break;case"disconnected":this._connected&&(this._connected=!1,this.onDisconnect.fire())}},_.prototype.onConnected=function(){this.setFields();var e=Object.keys(this._symbol_data);e.length&&(this._quoteApi.quoteAddSymbols(e),this._delayUpdateFastSymbols()),this.onConnect.fire()},_.prototype.setFields=function(){
var e=_.prototype.typeFields[this._type];e&&e.length&&this._quoteApi.quoteSetFields(e)},_.prototype.onSymbolData=function(e){try{e.status&&d.update(e,u,!1)}catch(e){}var t=e.symbolname,i=this._throttledSymbolData[t];i||(i=this._throttledSymbolData[t]={fnDispatch:r(this.dipatchSymbolData.bind(this),this.options.throttleTimeout)}),i.cache?h(i.cache,e):i.cache=e,i.fnDispatch(t)},_.prototype._parseUpdateMode=function(e){c(e)},_.prototype.dipatchSymbolData=function(e){var t=this._symbol_data[e],i=this._throttledSymbolData[e].cache;if(delete this._throttledSymbolData[e].cache,this._symbol_data[e])for(var s in h(t,i),t.values&&this._parseUpdateMode(t.values),this._subscriptions){var r=this._subscriptions[s];r.has(e)&&r.get(e).forEach((function(e){e(t,i)}))}},_.prototype.subscribe=function(e,t,i){this._subscriptions[e]=this._subscriptions[e]||new Map;var s=this._subscriptions[e];t=[].concat(t);var r=[];t.forEach((function(e){this._symbol_data[e]?s&&s.has(e)||this._symbol_data[e].subscribers_count++:(this._symbol_data[e]={subscribers_count:1},r.push(e)),s.has(e)||s.set(e,[]),s.get(e).push(i),s.get(e).fast=!0,this._symbol_data[e]&&this._symbol_data[e].values&&i(this._symbol_data[e],this._symbol_data[e])}),this),r.length&&this._connected&&(this._quoteApi.quoteAddSymbols(r),this._delayUpdateFastSymbols())},_.prototype.unsubscribe=function(e,t,i){t=[].concat(t);for(var s=this._subscriptions[e],r=[],n=0;n<t.length;n++){var o=t[n];if(s)if(s.has(o)&&i){var a=s.get(o).indexOf(i);~a&&s.get(o).splice(a,1),s.get(o).length||s.delete(o)}else s.delete(o);s&&0===s.size&&delete this._subscriptions[e],this._symbol_data.hasOwnProperty(o)&&(s&&!s.has(o)&&this._symbol_data[o].subscribers_count--,this._symbol_data[o].subscribers_count||(delete this._symbol_data[o],r.push(o)))}r.length&&this._connected&&(this._quoteApi.quoteRemoveSymbols(r),this._delayUpdateFastSymbols())},_.prototype.setFastSymbols=function(e,t){if(this._subscriptions[e])for(var i=this._subscriptions[e],s=Array.from(i.keys()),r=0;r<s.length;++r){var n=s[r];i.get(n).fast=-1!==t.indexOf(n)}this._delayUpdateFastSymbols()},_.prototype._updateFastSymbols=function(){if(this._connected){var e=this._fastSymbols();0===e.length?this._quoteApi.quoteHibernateAll():this._quoteApi.quoteFastSymbols(e)}},_.prototype._delayUpdateFastSymbols=_.prototype._updateFastSymbols,_.prototype._fastSymbols=function(){var e=[];for(var t in this._subscriptions)for(var i=this._subscriptions[t],s=Array.from(i.keys()),r=0;r<s.length;++r){var n=s[r];i.get(n).fast&&e.push(n)}return e=a(e)},_.prototype.formatter=function(e,t){var i=this;if(this._waitingForFormatters[e])return this._waitingForFormatters[e];function s(e){var i=t&&!e.fractional?1:e.minmov;return new o(e.pricescale,i,e.fractional,e.minmove2)}var r=new Promise((function(t,r){if(i._formatterValuesCache[e])t(s(i._formatterValuesCache[e]));else{var n=l.guid();i.subscribe(n,[e],(function(o){"error"===o.status&&(i._waitingForFormatters[e]=null,r("Quotes snapshot is not received")),function(e){return e&&null!=e.pricescale&&null!=e.minmov
}(o.values)&&(i._waitingForFormatters[e]=null,i._formatterValuesCache[e]=o.values,t(s(o.values)),i.unsubscribe(n,e))}))}}));return this._waitingForFormatters[e]=r,r},_.prototype.snapshot=function(e){var t=this;if(this._waitingForSnapshot[e])return this._waitingForSnapshot[e];var i=new Promise((function(i,s){if(t._snapshotValuesCache[e])i(t._snapshotValuesCache[e]);else{var r=l.guid();t.subscribe(r,[e],(function(n){"error"===n.status&&(t._waitingForSnapshot[e]=null,s("Quotes snapshot is not received"));var o=n.values;o&&o.minmov&&o.pricescale&&(t._waitingForSnapshot[e]=null,t._snapshotValuesCache[e]=o,i(o),t.unsubscribe(r,e))}))}}));return this._waitingForSnapshot[e]=i,i},TradingView.QuoteSessionMultiplexer=_,e&&e.exports&&(e.exports=_)},188035:(e,t,i)=>{"use strict";function s(e,t,i){const s=e.get(t);return void 0!==s?s:(e.set(t,i),i)}function r(e,t,i){const s=e.get(t);if(void 0!==s)return s;const r=i();return e.set(t,r),r}function n(e,t,i,n){return r(s(e,t,new Map),i,n)}function o(e,t,i,r,n){const o=s(e,t,new Map),a=s(o,i,new Map);return s(a,r,n)}i.d(t,{getDefault2Lazy:()=>n,getDefault3:()=>o,AbstractMapContainer:()=>a});class a{constructor(){this._map=new Map,this._size=0}size(){return this._size}clear(){this._map.clear(),this._size=0}}},624595:(e,t,i)=>{"use strict";i.r(t),i.d(t,{lowerboundExt:()=>n,lowerbound:()=>o,lowerbound_int:()=>a,upperbound:()=>l,upperbound_int:()=>c,subtract:()=>h,moveToHead:()=>d,moveAfter:()=>u,moveBefore:()=>p,intersect:()=>_,removeItemFromArray:()=>m});var s=i(650151);function r(e,t){return e<t}function n(e,t,i,s,r){let n=r-s;for(;0<n;){const r=n>>1,o=s+r;i(e(o),t)?(s=o+1,n-=r+1):n=r}return s}function o(e,t,i,s=0,r=e.length){return n((t=>e[t]),t,i,s,r)}function a(e,t,i=0,s=e.length){return o(e,t,r,i,s)}function l(e,t,i,s=0,r=e.length){let n=r-s;for(;0<n;){const r=n>>1,o=s+r;i(t,e[o])?n=r:(s=o+1,n-=r+1)}return s}function c(e,t,i=0,s=e.length){return l(e,t,r,i,s)}function h(e,t){return e.filter((e=>!t.includes(e)))}function d(e,t){const i=e.indexOf(t);return i<0?e.slice():[t].concat(e.slice(0,i)).concat(e.slice(i+1))}function u(e,t,i){const s=new Set(t),r=[],n=[],o=[];return e.forEach(((e,t)=>{s.has(e)?n.push(e):(r.push(e),o.push(t))})),i=i<e.length-1?a(o,i+1):r.length,r.splice(i,0,...n),{newItems:r,movedItemsStartIndex:i}}function p(e,t,i){const s=new Set(t),r=[],n=[],o=[];return e.forEach(((e,t)=>{s.has(e)?n.push(e):(r.push(e),o.push(t))})),i=i<=e.length-1?a(o,i):r.length,r.splice(i,0,...n),{newItems:r,movedItemsStartIndex:i}}function _(e,t){const i=new Set;return e.forEach((e=>{t.has(e)&&i.add(e)})),i}function m(e,t){const i=e.indexOf(t);(0,s.assert)(-1!==i,"Item is not found"),e.splice(i,1)}},871555:(e,t,i)=>{"use strict";var s=i(125191),r=i(498856).tzData;let n;function o(e){this._name=e;var t=r[e];if(!t&&n&&(t=n.instance().getTimezoneData(e)),t||(t={time:[],offset:[]},this._invalid=!0),t.time.length!==t.offset.length&&(t={time:[],offset:[]},this._invalid=!0),!t.time_utc){for(var i=t.time,s=t.offset,o=i.length,a=new Array(o),l=0;l<o;l++)i[l]*=1e3,s[l]*=1e3,a[l]=i[l]-s[l]
;t.time_utc=a}this.tz=t}function a(e,t){var i=e.length;if(0===i)return-1;if(isNaN(t))throw Error("Key is NaN");for(var s=0,r=i-1,n=l((s+r)/2);;){if(e[n]>t){if((r=n-1)<s)return n}else if(r<(s=n+1))return n<i-1?n+1:-1;n=l((s+r)/2)}}o.prototype.offset_utc=function(e){return o._offset(this.tz.time_utc,this.tz.offset,e)},o.prototype.offset_loc=function(e){return o._offset(this.tz.time,this.tz.offset,e)},o.prototype.name=function(){return this._name},o.prototype.correction_loc=function(e){var t=this.tz.time,i=this.tz.offset,s=a(t,e);if(s<1)return 0;var r=i[s]-i[s-1];if(r>0&&e-t[s-1]<=r)return r;return 0},o.prototype.is_valid=function(){return!this._invalid},o._offset=function(e,t,i){var s=a(e,i);return-1===s?0:t[s]};var l=function(e){return 0|e},c=function(e){return 60*e*1e3},h=function(e,t){return d(e)-d(t)},d=function(e){return e<0?l(e/1e3)-(e%1e3!=0?1:0):l(e/1e3)};function u(e){return e%4==0&&(e%100!=0||e%400==0)}var p={0:0,1:31,2:59,3:90,4:120,5:151,6:181,7:212,8:243,9:273,10:304,11:334},_={...s.WeekDays,...s.Months,YEAR:1,MONTH:2,WEEK_OF_YEAR:3,DAY_OF_MONTH:5,DAY_OF_YEAR:6,DAY_OF_WEEK:7,HOUR_OF_DAY:11,MINUTE:12,SECOND:13,minutesPerDay:1440,millisecondsPerDay:c(1440),get_minutes_from_hhmm:function(e){return-1!==e.indexOf(":")&&(e=e.split(":").join("")),e%100+60*l(e/100)},get_year:function(e){return e.getUTCFullYear()},get_month:function(e){return e.getUTCMonth()},get_hours:function(e){return e.getUTCHours()},get_minutes:function(e){return e.getUTCMinutes()},get_seconds:function(e){return e.getUTCSeconds()},get_day_of_month:function(e){return e.getUTCDate()},get_day_of_week:function(e){return e.getUTCDay()+1},get_day_of_year:function(e){var t=e.getUTCMonth(),i=p[t];return t>_.JANUARY+1&&u(e.getUTCFullYear())&&(i+=1),i+e.getUTCDate()},get_week_of_year:function(e){var t=new Date(Date.UTC(e.getUTCFullYear(),0,1)).getUTCDay(),i=0===t?1:8-t,s=_.get_day_of_year(e)-i;return Math.ceil(s/7)+1},get_minutes_from_midnight:function(e){return 60*_.get_hours(e)+_.get_minutes(e)},set_hms:function(e,t,i,s,r,n){e.setUTCHours(t),e.setUTCMinutes(i),e.setUTCSeconds(s),e.setUTCMilliseconds(r),void 0!==n&&_.correct_time(e,n)},correct_time:function(e,t){var i=e.getTime(),s=t.correction_loc(i);e.setTime(i+s)},add_days_considering_dst:function(e,t,i){var s=e.offset_utc(t),r=this.clone(t);this.add_date(r,i);var n=e.offset_utc(r);return r.setTime(r.getTime()+s-n),r},add_date:function(e,t){e.setTime(e.getTime()+t*_.millisecondsPerDay)},add_minutes:function(e,t){e.setTime(e.getTime()+c(t))},clone:function(e){return new Date(e.getTime())},get_days_per_year:function(e){var t=e.getUTCFullYear();return this.days_per_year(t)},days_per_year:function(e){return u(e)?366:365},get_days_in_month:function(e,t){let i;switch(e){case 0:case 2:case 4:case 6:case 7:case 9:case 11:i=31;break;case 1:i=28,u(t)&&i++;break;default:i=30}return i},get_part:function(e,t){switch(t){case _.YEAR:return _.get_year(e);case _.MONTH:return _.get_month(e);case _.DAY_OF_MONTH:return _.get_day_of_month(e);case _.WEEK_OF_YEAR:return _.get_week_of_year(e);case _.DAY_OF_WEEK:
return _.get_day_of_week(e);case _.HOUR_OF_DAY:return _.get_hours(e);case _.MINUTE:return _.get_minutes(e);case _.DAY_OF_YEAR:return _.get_day_of_year(e);case _.SECOND:return _.get_seconds(e);default:return e.getTime()}},time_minutes:c,time_seconds:function(e){return 1e3*e},time_minutes_diff:function(e,t){return l(h(e,t)/60)},time_seconds_diff:h,utc_to_cal:function(e,t){return new Date(_.utc_to_cal_ts(e,t))},utc_to_cal_ts:function(e,t){return t+e.offset_utc(t)},get_cal:function(e,t,i,s,r,n,o){var a=new Date(Date.UTC(t,i,s,r||0,n||0,o||0)),l=e.offset_utc(+a);return new Date(a.valueOf()-l)},get_cal_from_unix_timestamp_ms:function(e,t){return new Date(t+e.offset_utc(t))},get_cal_utc:function(e,t,i){return new Date(Date.UTC(e,t,i))},cal_to_utc:function(e,t){var i=t.getTime();return i-e.offset_loc(i)},get_timezone:function(e){return new o(e)},shift_day:function(e,t){var i=e-1;return(i+=t)>6?i%=7:i<0&&(i=(7+i%7)%7),i+1},setCustomTimezones:function(e){n=e}};e.exports=_},284269:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LINESTYLE_SOLID:()=>s,LINESTYLE_DOTTED:()=>r,LINESTYLE_DASHED:()=>n,LINESTYLE_LARGE_DASHED:()=>o,LINESTYLE_SPARSE_DOTTED:()=>a,LINESTYLE_SMALL_DASHED:()=>l});const s=0,r=1,n=2,o=3,a=4,l=5},96401:(e,t,i)=>{"use strict";i.d(t,{combineWithFilteredUpdate:()=>o,combine:()=>a});var s=i(210596),r=i.n(s);function n(e,t,...i){const s=(...t)=>e(...t.map((e=>e.value()))),n=new(r())(s(...i)),o=()=>{t(...i.map((e=>e.value())))&&n.setValue(s(...i))},a=i.map((e=>e.spawn()));for(const e of a)e.subscribe(o);return n.readonly().spawn((()=>a.forEach((e=>e.destroy()))))}function o(e,t,...i){return n(e,t,...i)}function a(e,...t){return n(e,(()=>!0),...t)}},968381:(e,t,i)=>{"use strict";i.r(t),i.d(t,{availableTimezones:()=>l,updateAvailableTimezones:()=>d,timezoneIsAvailable:()=>u,timezoneIsSupported:()=>p,timezoneTitle:()=>_});var s=i(509806),r=i(8990);const n=[{id:"Etc/UTC",title:s.t(null,void 0,i(850406))},{id:"exchange",title:s.t(null,void 0,i(777295))}],o=[{id:"Africa/Cairo",title:s.t(null,void 0,i(994099)),offset:0},{id:"Africa/Johannesburg",title:s.t(null,void 0,i(387469)),offset:0},{id:"Africa/Lagos",title:s.t(null,void 0,i(89155)),offset:0},{id:"Africa/Nairobi",title:s.t(null,void 0,i(679023)),offset:0},{id:"Africa/Tunis",title:s.t(null,void 0,i(193855)),offset:0},{id:"America/Argentina/Buenos_Aires",title:s.t(null,void 0,i(882446)),offset:0},{id:"America/Bogota",title:s.t(null,void 0,i(54173)),offset:0},{id:"America/Caracas",title:s.t(null,void 0,i(846837)),offset:0},{id:"America/Chicago",title:s.t(null,void 0,i(228244)),offset:0},{id:"America/El_Salvador",title:s.t(null,void 0,i(768553)),offset:0},{id:"America/Juneau",title:s.t(null,void 0,i(124435)),offset:0},{id:"America/Lima",title:s.t(null,void 0,i(725846)),offset:0},{id:"America/Los_Angeles",title:s.t(null,void 0,i(687604)),offset:0},{id:"America/Mexico_City",title:s.t(null,void 0,i(185095)),offset:0},{id:"America/New_York",title:s.t(null,void 0,i(291203)),offset:0},{id:"America/Phoenix",title:s.t(null,void 0,i(219093)),offset:0},{id:"America/Santiago",
title:s.t(null,void 0,i(965412)),offset:0},{id:"America/Sao_Paulo",title:s.t(null,void 0,i(913538)),offset:0},{id:"America/Toronto",title:s.t(null,void 0,i(83836)),offset:0},{id:"America/Vancouver",title:s.t(null,void 0,i(115771)),offset:0},{id:"US/Mountain",title:s.t(null,void 0,i(257701)),offset:0},{id:"Asia/Almaty",title:s.t(null,void 0,i(14452)),offset:0},{id:"Asia/Ashkhabad",title:s.t(null,void 0,i(559340)),offset:0},{id:"Asia/Bahrain",title:s.t(null,void 0,i(53260)),offset:0},{id:"Asia/Bangkok",title:s.t(null,void 0,i(732376)),offset:0},{id:"Asia/Chongqing",title:s.t(null,void 0,i(649648)),offset:0},{id:"Asia/Colombo",title:s.t(null,void 0,i(115168)),offset:0},{id:"Asia/Dubai",title:s.t(null,void 0,i(822429)),offset:0},{id:"Asia/Ho_Chi_Minh",title:s.t(null,void 0,i(587338)),offset:0},{id:"Asia/Hong_Kong",title:s.t(null,void 0,i(532918)),offset:0},{id:"Asia/Jakarta",title:s.t(null,void 0,i(652707)),offset:0},{id:"Asia/Jerusalem",title:s.t(null,void 0,i(642890)),offset:0},{id:"Asia/Karachi",title:s.t(null,void 0,i(202693)),offset:0},{id:"Asia/Kathmandu",title:s.t(null,void 0,i(303155)),offset:0},{id:"Asia/Kolkata",title:s.t(null,void 0,i(916245)),offset:0},{id:"Asia/Kuwait",title:s.t(null,void 0,i(872374)),offset:0},{id:"Asia/Manila",title:s.t(null,void 0,i(290271)),offset:0},{id:"Asia/Muscat",title:s.t(null,void 0,i(442769)),offset:0},{id:"Asia/Nicosia",title:s.t(null,void 0,i(733566)),offset:0},{id:"Asia/Qatar",title:s.t(null,void 0,i(619056)),offset:0},{id:"Asia/Riyadh",title:s.t(null,void 0,i(152588)),offset:0},{id:"Asia/Seoul",title:s.t(null,void 0,i(605961)),offset:0},{id:"Asia/Shanghai",title:s.t(null,void 0,i(969240)),offset:0},{id:"Asia/Singapore",title:s.t(null,void 0,i(156683)),offset:0},{id:"Asia/Taipei",title:s.t(null,void 0,i(438788)),offset:0},{id:"Asia/Tehran",title:s.t(null,void 0,i(16267)),offset:0},{id:"Asia/Tokyo",title:s.t(null,void 0,i(294284)),offset:0},{id:"Asia/Yangon",title:s.t(null,void 0,i(769293)),offset:0},{id:"Atlantic/Reykjavik",title:s.t(null,void 0,i(626833)),offset:0},{id:"Australia/Adelaide",title:s.t(null,void 0,i(717365)),offset:0},{id:"Australia/Brisbane",title:s.t(null,void 0,i(511741)),offset:0},{id:"Australia/Perth",title:s.t(null,void 0,i(635590)),offset:0},{id:"Australia/Sydney",title:s.t(null,void 0,i(111020)),offset:0},{id:"Europe/Amsterdam",title:s.t(null,void 0,i(688010)),offset:0},{id:"Europe/Athens",title:s.t(null,void 0,i(921983)),offset:0},{id:"Europe/Belgrade",title:s.t(null,void 0,i(254861)),offset:0},{id:"Europe/Berlin",title:s.t(null,void 0,i(326825)),offset:0},{id:"Europe/Bratislava",title:s.t(null,void 0,i(605262)),offset:0},{id:"Europe/Brussels",title:s.t(null,void 0,i(690204)),offset:0},{id:"Europe/Bucharest",title:s.t(null,void 0,i(537728)),offset:0},{id:"Europe/Budapest",title:s.t(null,void 0,i(787143)),offset:0},{id:"Europe/Copenhagen",title:s.t(null,void 0,i(743432)),offset:0},{id:"Europe/Dublin",title:s.t(null,void 0,i(609497)),offset:0},{id:"Europe/Helsinki",title:s.t(null,void 0,i(899820)),offset:0},{id:"Europe/Istanbul",
title:s.t(null,void 0,i(537885)),offset:0},{id:"Europe/Lisbon",title:s.t(null,void 0,i(450091)),offset:0},{id:"Europe/London",title:s.t(null,void 0,i(50286)),offset:0},{id:"Europe/Luxembourg",title:s.t(null,void 0,i(164352)),offset:0},{id:"Europe/Madrid",title:s.t(null,void 0,i(758038)),offset:0},{id:"Europe/Malta",title:s.t(null,void 0,i(334190)),offset:0},{id:"Europe/Moscow",title:s.t(null,void 0,i(118665)),offset:0},{id:"Europe/Oslo",title:s.t(null,void 0,i(782906)),offset:0},{id:"Europe/Paris",title:s.t(null,void 0,i(595995)),offset:0},{id:"Europe/Riga",title:s.t(null,void 0,i(605871)),offset:0},{id:"Europe/Rome",title:s.t(null,void 0,i(974214)),offset:0},{id:"Europe/Stockholm",title:s.t(null,void 0,i(248767)),offset:0},{id:"Europe/Tallinn",title:s.t(null,void 0,i(939108)),offset:0},{id:"Europe/Vilnius",title:s.t(null,void 0,i(475354)),offset:0},{id:"Europe/Warsaw",title:s.t(null,void 0,i(48474)),offset:0},{id:"Europe/Zurich",title:s.t(null,void 0,i(984301)),offset:0},{id:"Pacific/Auckland",title:s.t(null,void 0,i(824143)),offset:0},{id:"Pacific/Chatham",title:s.t(null,void 0,i(59884)),offset:0},{id:"Pacific/Fakaofo",title:s.t(null,void 0,i(520466)),offset:0},{id:"Pacific/Honolulu",title:s.t(null,void 0,i(961351)),offset:0},{id:"Pacific/Norfolk",title:s.t(null,void 0,i(99203)),offset:0}];function a(e,t,i){const s=function(e){return e.map((({id:e,title:t})=>{const{string:i,offset:s}=(0,r.parseTzOffset)(e);return{id:e,offset:s,title:`(${i}) ${t}`}}))}(e),n=i.filter((({alias:e})=>Boolean(e))).map((({title:e,alias:t,id:i})=>{const{string:s,offset:n}=(0,r.parseTzOffset)(t);return{id:i,offset:n,title:`(${s}) ${e}`,alias:t}})),o=function(e){return e.sort(((e,t)=>{const i=e.offset-t.offset;return 0!==i?i:e.title.localeCompare(t.title)}))}(s.concat(n));return t.concat(o)}const l=a(o,n,[]),c=new Map;l.forEach((e=>{c.set(e.id,!0)}));const h=new Map;n.concat(o).forEach((e=>{h.set(e.id,!0)}));const d=e=>{l.splice(0,l.length,...a(o,n,e)),l.forEach((e=>{c.set(e.id,!0)}))};function u(e){return c.has(e)}function p(e){return h.get(e)||!1}function _(e){for(const{id:t,title:i}of o)if(t===e){return`${i} (${(0,r.parseTzOffset)(e).string})`}return e}},922157:(e,t,i)=>{"use strict";e=i.nmd(e);const s=i(817808).getLogger("Common.Delegate");function r(){this._listeners=[]}function n(e){return!e.singleshot}r.prototype.subscribe=function(e,t,i){const s={object:e,member:t,singleshot:!!i,skip:!1};this._listeners.push(s)},r.prototype.unsubscribe=function(e,t){for(let i=0;i<this._listeners.length;++i){const s=this._listeners[i];if(s.object===e&&s.member===t){s.skip=!0,this._listeners.splice(i,1);break}}},r.prototype.unsubscribeAll=function(e){for(let t=this._listeners.length-1;t>=0;--t){const i=this._listeners[t];i.object===e&&(i.skip=!0,this._listeners.splice(t,1))}},r.prototype.destroy=function(){delete this._listeners},r.prototype.fire=function(){const e=this._listeners;this._listeners=this._listeners.filter(n);const t=e.length;for(let i=0;i<t;++i){const t=e[i];if(!t.skip)try{t.member.apply(t.object||null,arguments)}catch(e){
s.logError(e.stack||e.message)}}},"undefined"!=typeof window&&(window.Delegate=r),e&&e.exports&&(e.exports=r)},667968:(e,t,i)=>{"use strict";i.d(t,{getImage:()=>n});const s=new Map;function r(e){e.crossOrigin="anonymous"}function n(e,t,i=r){let n=s.get(e);return void 0===n&&(n=new Promise(((e,s)=>{const r=new Image;r.onload=()=>{e(r),r.onload=null,r.onerror=null},r.onerror=()=>{s(),r.onload=null,r.onerror=null},i(r),r.src=t})),s.set(e,n)),n}},218954:(e,t,i)=>{"use strict";function s(e,t){return e<=t}function r(e,t){return e>=t}function n(e,t,i){return Math.min(Math.max(e,t),i)}function o(e){return e<0?-1:e>0?1:0}function a(e){if(e<0)return!1;if(e>1e18)return!0;for(let t=e;t>1;t/=10)if(t%10!=0)return!1;return!0}function l(e,t,i){return t-e<=i}function c(e,t,i){return Math.abs(e-t)<i}function h(e){return e<=0?NaN:Math.log(e)/Math.log(10)}function d(e,t){return e<t?-1:e>t?1:0}function u(e,t=d){if(e.length<1)throw Error("array is empty");let i=e[0];for(let s=0;s<e.length;++s)t(e[s],i)<0&&(i=e[s]);return i}function p(e,t=d){if(e.length<1)throw Error("array is empty");let i=e[0];for(let s=0;s<e.length;++s)t(e[s],i)>0&&(i=e[s]);return i}function _(e){const t=Math.ceil(e);return t%2!=0?t-1:t}function m(e){return e>0?Math.floor(e):Math.ceil(e)}i.r(t),i.d(t,{lessThan:()=>s,greaterThan:()=>r,clamp:()=>n,sign:()=>o,isBaseDecimal:()=>a,greaterOrEqual:()=>l,equal:()=>c,log10:()=>h,defComparator:()=>d,min:()=>u,max:()=>p,ceiledEven:()=>_,toInt:()=>m})},717861:(e,t,i)=>{"use strict";i.d(t,{numOfDecimalPlaces:()=>r});var s=i(960521);function r(e){return(new s.Big(e).toFixed().split(".")[1]||"").length}},8990:(e,t,i)=>{"use strict";i.d(t,{parseTzOffset:()=>r});var s=i(871555);function r(e,t=Date.now()){const i=(0,s.get_timezone)(e).offset_utc(t);let r="";const n=i/1e3/60/60;n%1&&(r=":"+Math.round(Math.abs(n%1*60)).toString().padStart(2,"0"));let o="";return o=n>0?"+"+(n-n%1)+r:0===n?"":String(n-n%1+r),{offset:i,string:"UTC"+o}}},373728:(e,t,i)=>{"use strict";var s=i(484727),r=[{d:"E-Mini S&P 500",t:"ES"},{d:"E-Mini Nasdaq 100",t:"NQ"},{d:"Gold",t:"GC"},{d:"Silver",t:"SI"},{d:"Crude Oil WTI",t:"CL"},{d:"Natural Gas",t:"NG"},{d:"Australian Dollar",t:"6A"},{d:"Australian Dollar (Floor)",t:"AD"},{d:"Euro FX",t:"6E"},{d:"Euro FX (Floor)",t:"EC"},{d:"Corn",t:"ZC"},{d:"Corn (Floor)",t:"C"},{d:"Eurodollar",t:"GE"},{d:"Eurodollar (Floor)",t:"ED"}],n=function(){var e=[{pattern:"(",ctor:o},{pattern:")",ctor:a},{pattern:"+",ctor:c},{pattern:"-",ctor:h},{pattern:"*",ctor:d},{pattern:"/",ctor:u},{pattern:"^",ctor:p},{pattern:/\d+(?:\.\d*|(?![a-zA-Z0-9_!:.&]))|\.\d+/,ctor:f},{pattern:/\./,ctor:y},{pattern:s.enabled("charting_library_base")?/[a-zA-Z0-9_\u0370-\u1FFF_\u2E80-\uFFFF^][a-zA-Z0-9_\u0020\u0370-\u1FFF_\u2E80-\uFFFF_!:.&]*|'.+?'/:/[a-zA-Z0-9_\u0370-\u1FFF_\u2E80-\uFFFF][a-zA-Z0-9_\u0020\u0370-\u1FFF_\u2E80-\uFFFF_!|:.&]*|'.+?'/,ctor:g},{pattern:/'[^']*/,ctor:S},{pattern:/[\0-\x20\s]+/,ctor:n}];function t(e,t){var i=function(){};return i.prototype=t.prototype,e.prototype=new i,e}function i(){}function n(e){this.value=e}function o(){}
function a(){}function l(){}function c(){}function h(){}function d(){}function u(){}function p(){}i.prototype.toString=function(){return this.value},t(n,i),t(o,i),o.prototype.value="(",t(a,i),a.prototype.value=")",t(l,i),t(c,l),c.prototype.value="+",c.prototype.precedence=0,c.prototype.commutative=!0,t(h,l),h.prototype.value="-",h.prototype.precedence=0,h.prototype.commutative=!1,t(d,l),d.prototype.value="*",d.prototype.precedence=1,d.prototype.commutative=!0,t(u,l),u.prototype.value="/",u.prototype.precedence=1,u.prototype.commutative=!1,t(p,l),p.prototype.value="^",p.prototype.precedence=2,p.prototype.commutative=!1;var _=/^'?(?:([A-Z0-9_]+):)?(.*?)'?$/i,m=/[+\-/*]/;function g(e){this.value=e}function f(e){this.value=e}function v(e){this.value=e}function S(){g.apply(this,arguments)}function y(){f.apply(this,arguments)}t(g,i),g.prototype.toString=function(){if(this.hasOwnProperty("_ticker")){var e=m.test(this._ticker)?"'":"";return e+(this._exchange?this._exchange+":":"")+this._ticker+e}return this.value},g.prototype.parse=function(){var e=_.exec(this.value);e[1]&&(this._exchange=e[1]),this._ticker=e[2]},g.prototype.parseAsFutures=function(){this.hasOwnProperty("_ticker")||this.parse();for(var e=function(e){return r.some((function(t){return t.t===e}))},t=2;t>=1;--t){var i=this._ticker.slice(0,t);if(e(i)){this._root=i,this._contract=this._ticker.slice(t);break}}},g.prototype.exchange=function(e){if(this.hasOwnProperty("_ticker")||this.parse(),!(arguments.length>0))return this._exchange;null==e?delete this._exchange:this._exchange=e+""},g.prototype.ticker=function(e){if(this.hasOwnProperty("_ticker")||this.parse(),!(arguments.length>0))return this._ticker;null==e?delete this._ticker:this._ticker=e+"",delete this._root,delete this._contract},g.prototype.root=function(e){if(this.hasOwnProperty("_root")||this.parseAsFutures(),!(arguments.length>0))return this._root;null==e?delete this._root:(this._root=e+"",this._root&&(this._ticker=this._root+(this._contract||"")))},g.prototype.contract=function(e){if(this.hasOwnProperty("_contract")||this.parseAsFutures(),!(arguments.length>0))return this._root;null==e?delete this._contract:(this._contract=e+"",this._root&&(this._ticker=this._root+this._contract))},t(f,i),f.prototype.toString=function(){return this.hasOwnProperty("_normalizedValue")?this._normalizedValue:this.value},f.prototype.parse=function(){this._normalizedValue=this.value.replace(/^0+|\.0*$/g,"").replace(/(\.\d*?)0+$/,"$1").replace(/^(\.|$)/,"0$1")},v.prototype.toString=function(){return this.value},t(S,g),S.prototype.isIncomplete=!0,S.prototype.incompleteSuggest=function(){if("'"!==this.value)return String("'")},t(y,f),y.prototype.isIncomplete=!0;var b=new RegExp(e.map((function(e){return"("+("string"==typeof e.pattern?e.pattern.replace(/[\^$()[\]{}*+?|\\]/g,"\\$&"):e.pattern.source)+")"})).concat(".").join("|"),"g");function w(t,i){var s,r=[];e:for(;s=b.exec(t);){for(var o=e.length;o--;)if(s[o+1]){if(e[o].ctor){var a=new e[o].ctor(s[o+1]);a._offset=s.index,r.push(a)}continue e}var l=new v(s[0])
;l._offset=s.index,r.push(l)}if(i&&i.recover){var c;for(o=r.length;o--;){var h=r[o];if(h instanceof f||h instanceof g){if(void 0!==c){var d=new g(""),u=r.splice(o,c-o+1,d);d.value=u.map((function(e){return e.value})).join("")}c=o}else h instanceof n||(c=void 0)}}return r}function P(e){for(var t=[],i=0;i<e.length;i++)e[i]instanceof n||t.push(e[i]);return t}function C(e){e=P(e);for(var t,i=[],s=[],r=0;r<e.length;r++){var n=e[r];if(n instanceof l)s.length&&s[s.length-1].minPrecedence>n.precedence&&(s[s.length-1].minPrecedence=n.precedence);else if(n instanceof o)s.push(t={minPrecedence:1/0,openBraceIndex:r});else if(n instanceof a){var c=e[(t=s.pop()).openBraceIndex-1],h=e[r+1];h instanceof l&&!(h.precedence<=t.minPrecedence)||!(!(c instanceof l)||c.precedence<t.minPrecedence||c.precedence===t.minPrecedence&&c.commutative)||(i.unshift(t.openBraceIndex),i.push(r),s.length&&s[s.length-1].minPrecedence>t.minPrecedence&&(s[s.length-1].minPrecedence=t.minPrecedence))}}for(r=i.length;r--;)e.splice(i[r],1);return e}function T(e){if("string"!=typeof e)throw new TypeError("expression must be a string");return(e=w(e)).filter((function(e){return e instanceof g})).map((function(e){return e.exchange()})).filter((function(e){return e}))}function x(e){return 1!==(e=T(e)).length?null:e[0]}function I(e,t){return(e=T(e)).some((function(e){return t.includes((e||"").toUpperCase())}))}function M(e){return e.join("")}return{tokenize:w,validate:function(e){if(s.enabled("charting_library_base"))return{currentState:"var"};for(var t="init",i="var",r=t,c={warnings:[],errors:[],isEmpty:!0},h=[],d=0;d<e.length;d++){if(!((p=e[d])instanceof n)){if(delete c.isEmpty,p.isIncomplete){var u={status:"incomplete",reason:"incomplete_token",offset:p._offset,token:p};if(p.incompleteSuggest&&(u.recover={append:p.incompleteSuggest()}),c.warnings.push(u),d!==e.length-1){u.status="error";continue}}if(p instanceof g||p instanceof f){if(r===i){c.errors.push({status:"error",reason:"unexpected_token",offset:p._offset,token:p});continue}r=i}else if(p instanceof l){if(r!==i){c.errors.push({status:"error",reason:"unexpected_token",offset:p._offset,token:p});continue}r="operator"}else if(p instanceof o){if(r===i){c.errors.push({status:"error",reason:"unexpected_token",offset:p._offset,token:p});continue}h.push(p),r=t}else if(p instanceof a){if(r!==i){c.errors.push({status:"error",reason:"unexpected_token",offset:p._offset,token:p});continue}h.pop()||c.errors.push({status:"error",reason:"unbalanced_brace",offset:p._offset,token:p,recover:{prepend:new o}}),r=i}else p instanceof v&&c.errors.push({status:"error",reason:"unparsed_entity",offset:p._offset,token:p})}}for(c.braceBalance=h.length,r!==i&&c.warnings.push({status:"incomplete"});h.length;){var p;u={status:"incomplete",reason:"unbalanced_brace",offset:(p=h.pop())._offset,token:p};r===i&&(u.recover={append:new a}),c.warnings.push(u)}return c.currentState=r,0===c.warnings.length&&delete c.warnings,0===c.errors.length&&delete c.errors,c},factorOutBraces:C,normalizeTokens:function(e){
for(var t=0;t<e.length;t++)e[t].parse&&e[t].parse();return e},flip:function(e){var t=function(e){for(var t,i=0,s=1,r=2,c=3,h=i,d=0,p=0;p<e.length;p++){var _=e[p];if(!(_ instanceof n))switch(h){case i:if(!(_ instanceof f&&1==+_.value))return!1;h=s;break;case s:if(!(h===s&&_ instanceof u))return!1;h=r,t=p+1;break;case r:if(_ instanceof o)h=c,d=1;else if(_ instanceof l)return!1;break;case c:_ instanceof o?d++:_ instanceof a&&--d<=0&&(h=r)}}return e.slice(t)}(e);return C(t||[new f("1"),new u,new o].concat(e).concat(new a))},hasBatsSymbols:function(e){return I(e,["BATS"])},hasEodSymbols:function(e){return(e=x(e))&&-1!==e.toUpperCase().indexOf("_EOD")},hasChxjpySymbols:function(e){return I(e,["CHXJPY"])},hasFreeDelaySymbols:function(e){return I(e,pro.getProductsByType(pro.PRODUCT_TYPES.exchange).map((function(e){return e.exchange.toUpperCase()+"_DLY"})))},getExchange:x,getExchanges:T,isExchange:function(e,t){return!!(e=x(e))&&e.substring(0,t.length)===t},SymbolToken:g,IncompleteSymbolToken:S,NumberToken:f,BinaryOperatorToken:l,OpenBraceToken:o,CloseBraceToken:a,ticker:function(e){return new g(e).ticker()},shortName:function(e){if("string"!=typeof e)throw new TypeError("expression must be a string");var t=C(P(w(e)));return t.forEach((function(e){e instanceof g&&e.exchange(null)})),M(t)},normalize:function(e){if("string"!=typeof e)throw new TypeError("expression must be a string");return M(C(P(w(e))))}}}();e.exports=n},440097:(e,t,i)=>{"use strict";i.d(t,{TranslatedString:()=>s});class s{constructor(e,t){this._originalText=e,this._translatedText=t}originalText(){return this._originalText}translatedText(){return this._translatedText}format(e){const t={},i={};for(const r of Object.keys(e)){const n=e[r];n instanceof s?(t[r]=n.originalText(),i[r]=n.translatedText()):(t[r]=n.toString(),i[r]=n.toString())}const r=this._originalText.format(t),n=this._translatedText.format(i);return new s(r,n)}}},498856:e=>{e.exports.tzData={"America/New_York":{
time:[-2717668562,-1633298400,-1615154400,-1601848800,-1583704800,-1570399200,-1551650400,-1536530400,-1523224800,-1504476e3,-1491775200,-1473026400,-1459720800,-1441576800,-1428271200,-1410127200,-1396821600,-1378677600,-1365372e3,-1347228e3,-1333922400,-1315173600,-1301868e3,-1283724e3,-1270418400,-1252274400,-1238968800,-1220824800,-1207519200,-1189375200,-1176069600,-1157320800,-114462e4,-1125871200,-1112565600,-1094421600,-1081116e3,-1062972e3,-1049666400,-1031522400,-1018216800,-1000072800,-986767200,-968018400,-955317600,-936568800,-923263200,-905119200,-891813600,-880236e3,-76941e4,-765410400,-747266400,-733960800,-715816800,-702511200,-684367200,-671061600,-652917600,-639612e3,-620863200,-608162400,-589413600,-576108e3,-557964e3,-544658400,-526514400,-513208800,-495064800,-481759200,-463615200,-447285600,-431560800,-415836e3,-400111200,-384386400,-368661600,-352936800,-337212e3,-321487200,-305762400,-289432800,-273708e3,-257983200,-242258400,-226533600,-210808800,-195084e3,-179359200,-163634400,-147909600,-13158e4,-11646e4,-100130400,-84405600,-68680800,-52956e3,-37231200,-21506400,-5781600,9943200,25668e3,41392800,57722400,73447200,89172e3,104896800,120621600,126669600,152071200,162352800,183520800,199245600,215575200,230695200,247024800,262749600,278474400,294199200,309924e3,325648800,341373600,357098400,372823200,388548e3,404877600,419997600,436327200,452052e3,467776800,483501600,499226400,514951200,530676e3,544586400,562125600,576036e3,59418e4,607485600,625629600,638935200,657079200,670989600,688528800,702439200,719978400,733888800,752032800,765338400,783482400,796788e3,814932e3,828842400,846381600,860292e3,877831200,891741600,909280800,923191200,941335200,954640800,972784800,986090400,1004234400,1018144800,1035684e3,1049594400,1067133600,1081044e3,1099188e3,1112493600,1130637600,1143943200,1162087200,1173578400,1194141600,1205028e3,1225591200,1236477600,1257040800,1268532e3,1289095200,1299981600,1320544800,1331431200,1351994400,1362880800,1383444e3,1394330400,1414893600,142578e4,1446343200,1457834400,1478397600,1489284e3,1509847200,1520733600,1541296800,1552183200,1572746400,1583632800,1604196e3,1615687200,1636250400,1647136800,16677e5,1678586400,1699149600,1710036e3,1730599200,1741485600,1762048800,1772935200,1793498400,1804989600,1825552800,1836439200,1857002400,1867888800,1888452e3,1899338400,1919901600,1930788e3],
offset:[-17762,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3]},"America/Los_Angeles":{
time:[-2717668378,-1633298400,-1615154400,-1601848800,-1583704800,-880236e3,-769420800,-765410400,-687995940,-662680800,-620866800,-608162400,-589417200,-576108e3,-557967600,-544658400,-526518e3,-513208800,-495068400,-481759200,-463618800,-450309600,-431564400,-418255200,-400114800,-386805600,-368665200,-355356e3,-337215600,-323906400,-305766e3,-292456800,-273711600,-261007200,-242262e3,-226533600,-210812400,-195084e3,-179362800,-163634400,-147913200,-13158e4,-116463600,-100130400,-84405600,-68680800,-52956e3,-37231200,-21506400,-5781600,9943200,25668e3,41392800,57722400,73447200,89172e3,104896800,120621600,126669600,152071200,162352800,183520800,199245600,215575200,230695200,247024800,262749600,278474400,294199200,309924e3,325648800,341373600,357098400,372823200,388548e3,404877600,419997600,436327200,452052e3,467776800,483501600,499226400,514951200,530676e3,544586400,562125600,576036e3,59418e4,607485600,625629600,638935200,657079200,670989600,688528800,702439200,719978400,733888800,752032800,765338400,783482400,796788e3,814932e3,828842400,846381600,860292e3,877831200,891741600,909280800,923191200,941335200,954640800,972784800,986090400,1004234400,1018144800,1035684e3,1049594400,1067133600,1081044e3,1099188e3,1112493600,1130637600,1143943200,1162087200,1173578400,1194141600,1205028e3,1225591200,1236477600,1257040800,1268532e3,1289095200,1299981600,1320544800,1331431200,1351994400,1362880800,1383444e3,1394330400,1414893600,142578e4,1446343200,1457834400,1478397600,1489284e3,1509847200,1520733600,1541296800,1552183200,1572746400,1583632800,1604196e3,1615687200,1636250400,1647136800,16677e5,1678586400,1699149600,1710036e3,1730599200,1741485600,1762048800,1772935200,1793498400,1804989600,1825552800,1836439200,1857002400,1867888800,1888452e3,1899338400,1919901600,1930788e3],offset:[-28378,-28800,-25200,-28800,-25200,-28800,-25200,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800]},"America/Chicago":{
time:[-2717668236,-1633298400,-1615154400,-1601848800,-1583704800,-1563746400,-1551650400,-1538949600,-1520200800,-1504476e3,-1491775200,-1473026400,-1459720800,-1441576800,-1428271200,-1410127200,-1396821600,-1378677600,-1365372e3,-1347228e3,-1333922400,-1315173600,-1301868e3,-1283724e3,-1270418400,-1252274400,-1238968800,-1220824800,-1207519200,-1189375200,-1176069600,-1157320800,-114462e4,-1125871200,-1112565600,-1094421600,-1081116e3,-1067810400,-1045432800,-1031522400,-1018216800,-1000072800,-986767200,-968018400,-955317600,-936568800,-923263200,-905119200,-891813600,-880236e3,-769413600,-765410400,-747266400,-733960800,-715816800,-702511200,-684367200,-671061600,-652917600,-639612e3,-620863200,-608162400,-589413600,-576108e3,-557964e3,-544658400,-526514400,-513208800,-495064800,-481759200,-463615200,-447285600,-431560800,-415836e3,-400111200,-384386400,-368661600,-352936800,-337212e3,-321487200,-305762400,-289432800,-273708e3,-257983200,-242258400,-226533600,-210808800,-195084e3,-179359200,-163634400,-147909600,-13158e4,-11646e4,-100130400,-84405600,-68680800,-52956e3,-37231200,-21506400,-5781600,9943200,25668e3,41392800,57722400,73447200,89172e3,104896800,120621600,126669600,152071200,162352800,183520800,199245600,215575200,230695200,247024800,262749600,278474400,294199200,309924e3,325648800,341373600,357098400,372823200,388548e3,404877600,419997600,436327200,452052e3,467776800,483501600,499226400,514951200,530676e3,544586400,562125600,576036e3,59418e4,607485600,625629600,638935200,657079200,670989600,688528800,702439200,719978400,733888800,752032800,765338400,783482400,796788e3,814932e3,828842400,846381600,860292e3,877831200,891741600,909280800,923191200,941335200,954640800,972784800,986090400,1004234400,1018144800,1035684e3,1049594400,1067133600,1081044e3,1099188e3,1112493600,1130637600,1143943200,1162087200,1173578400,1194141600,1205028e3,1225591200,1236477600,1257040800,1268532e3,1289095200,1299981600,1320544800,1331431200,1351994400,1362880800,1383444e3,1394330400,1414893600,142578e4,1446343200,1457834400,1478397600,1489284e3,1509847200,1520733600,1541296800,1552183200,1572746400,1583632800,1604196e3,1615687200,1636250400,1647136800,16677e5,1678586400,1699149600,1710036e3,1730599200,1741485600,1762048800,1772935200,1793498400,1804989600,1825552800,1836439200,1857002400,1867888800,1888452e3,1899338400,1919901600,1930788e3],
offset:[-21036,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600]},"America/Phoenix":{time:[-2717670498,-1633298400,-1615154400,-1601848800,-1583704800,-880236e3,-820540740,-812678340,-796867140,-84405600,-68680800,1924966800],offset:[-26898,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200]},"America/Toronto":{
time:[-2366755200,-1632088800,-1615154400,-1601771400,-1583712e3,-1567375200,-1554681600,-1534716e3,-1524088800,-1503266400,-149238e4,-1471816800,-1460930400,-1440972e3,-1428876e3,-1409522400,-1397426400,-1378072800,-1365976800,-1346623200,-1333922400,-1315173600,-1301868e3,-1283724e3,-1270418400,-1252274400,-1238968800,-1220824800,-1207519200,-1188770400,-1176069600,-1157320800,-1144015200,-1125871200,-1112565600,-1094421600,-1081116e3,-1062972e3,-1049666400,-1031522400,-1018216800,-1000072800,-986767200,-968018400,-955317600,-936568800,-880232400,-76941e4,-765410400,-747266400,-733960800,-715824e3,-702518400,-684374400,-671068800,-652924800,-634176e3,-620863200,-602719200,-589413600,-576108e3,-557964e3,-544658400,-526514400,-513208800,-495064800,-481759200,-463615200,-450309600,-431560800,-418255200,-400111200,-384386400,-368661600,-352936800,-337212e3,-321487200,-305762400,-289432800,-273708e3,-257983200,-242258400,-226533600,-210808800,-195084e3,-179359200,-163634400,-147909600,-13158e4,-11646e4,-100130400,-84405600,-68680800,-52956e3,-37231200,-21506400,-5781600,9943200,25668e3,41392800,57722400,73447200,89172e3,104896800,120621600,136346400,152071200,167796e3,183520800,199245600,215575200,230695200,247024800,262749600,278474400,294199200,309924e3,325648800,341373600,357098400,372823200,388548e3,404877600,419997600,436327200,452052e3,467776800,483501600,499226400,514951200,530676e3,544586400,562125600,576036e3,59418e4,607485600,625629600,638935200,657079200,670989600,688528800,702439200,719978400,733888800,752032800,765338400,783482400,796788e3,814932e3,828842400,846381600,860292e3,877831200,891741600,909280800,923191200,941335200,954640800,972784800,986090400,1004234400,1018144800,1035684e3,1049594400,1067133600,1081044e3,1099188e3,1112493600,1130637600,1143943200,1162087200,1173578400,1194141600,1205028e3,1225591200,1236477600,1257040800,1268532e3,1289095200,1299981600,1320544800,1331431200,1351994400,1362880800,1383444e3,1394330400,1414893600,142578e4,1446343200,1457834400,1478397600,1489284e3,1509847200,1520733600,1541296800,1552183200,1572746400,1583632800,1604196e3,1615687200,1636250400,1647136800,16677e5,1678586400,1699149600,1710036e3,1730599200,1741485600,1762048800,1772935200,1793498400,1804989600,1825552800,1836439200,1857002400,1867888800,1888452e3,1899338400,1919901600,1930788e3],
offset:[-19052,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-14400,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3]},"America/Vancouver":{
time:[-2713910400,-1632088800,-1615154400,-880236e3,-769420800,-765410400,-747266400,-733960800,-715816800,-702511200,-684367200,-671061600,-652917600,-639612e3,-620863200,-608162400,-589413600,-576108e3,-557964e3,-544658400,-526514400,-513208800,-495064800,-481759200,-463615200,-450309600,-431560800,-418255200,-400111200,-386805600,-368661600,-355356e3,-337212e3,-323906400,-305762400,-292456800,-273708e3,-261007200,-242258400,-226533600,-210808800,-195084e3,-179359200,-163634400,-147909600,-13158e4,-11646e4,-100130400,-84405600,-68680800,-52956e3,-37231200,-21506400,-5781600,9943200,25668e3,41392800,57722400,73447200,89172e3,104896800,120621600,136346400,152071200,167796e3,183520800,199245600,215575200,230695200,247024800,262749600,278474400,294199200,309924e3,325648800,341373600,357098400,372823200,388548e3,404877600,419997600,436327200,452052e3,467776800,483501600,499226400,514951200,530676e3,544586400,562125600,576036e3,59418e4,607485600,625629600,638935200,657079200,670989600,688528800,702439200,719978400,733888800,752032800,765338400,783482400,796788e3,814932e3,828842400,846381600,860292e3,877831200,891741600,909280800,923191200,941335200,954640800,972784800,986090400,1004234400,1018144800,1035684e3,1049594400,1067133600,1081044e3,1099188e3,1112493600,1130637600,1143943200,1162087200,1173578400,1194141600,1205028e3,1225591200,1236477600,1257040800,1268532e3,1289095200,1299981600,1320544800,1331431200,1351994400,1362880800,1383444e3,1394330400,1414893600,142578e4,1446343200,1457834400,1478397600,1489284e3,1509847200,1520733600,1541296800,1552183200,1572746400,1583632800,1604196e3,1615687200,1636250400,1647136800,16677e5,1678586400,1699149600,1710036e3,1730599200,1741485600,1762048800,1772935200,1793498400,1804989600,1825552800,1836439200,1857002400,1867888800,1888452e3,1899338400,1919901600,1930788e3],
offset:[-29548,-28800,-25200,-28800,-25200,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800]},"America/Argentina/Buenos_Aires":{time:[-2372112e3,-1567468800,-1233446400,-1222992e3,-1205971200,-1194048e3,-117288e4,-1162512e3,-1141344e3,-1130976e3,-1109808e3,-109944e4,-1078272e3,-1067817600,-1046649600,-1036281600,-1015113600,-1004745600,-983577600,-973209600,-952041600,-941587200,-931046400,-900892800,-890352e3,-83376e4,-82728e4,-752284800,-733795200,-197337600,-190857600,-184204800,-164505600,-152668800,-132969600,-121132800,-101433600,-86832e3,-71107200,-54777600,-39052800,-23328e3,-7603200,128131200,136598400,596937600,605059200,624412800,636508800,656467200,667958400,687916800,699408e3,719366400,731462400,938908800,952041600,1198972800,1205625600,1224374400,1237075200,1924981200],offset:[-14028,-15408,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-10800,-10800,-7200,-10800,-7200,-10800]},"America/El_Salvador":{time:[-1546300800,546998400,559699200,578448e3,591148800,1924970400],offset:[-21408,-21600,-18e3,-21600,-18e3,-21600]},"America/Sao_Paulo":{
time:[-1767225600,-1206968400,-1191369600,-1175385600,-1159833600,-633830400,-622076400,-602294400,-59184e4,-570758400,-560217600,-539136e3,-53136e4,-195436800,-184204800,-155174400,-150076800,-128908800,-121132800,-99964800,-89596800,-68428800,-57974400,499737600,511228800,530582400,540259200,562118400,571190400,592963200,602035200,624412800,634694400,656467200,666748800,687916800,697593600,719971200,728438400,750816e3,761702400,782265600,793152e3,813715200,823996800,84456e4,856051200,876096e3,888710400,908064e3,919555200,938908800,951609600,970963200,982454400,1003017600,1013904e3,1036281600,1045353600,1066521600,1076803200,1099353600,1108857600,1129420800,1140307200,1162684800,1172361600,119232e4,1203206400,1224374400,1234656e3,1255824e3,1266710400,1287273600,129816e4,1318723200,1330214400,1350777600,1361059200,1382227200,1392508800,1413676800,1424563200,1445126400,1456012800,1476576e3,1487462400,1508025600,1518912e3,1541289600,1550361600,1924981200],offset:[-11188,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800,-7200,-10800]},"America/Bogota":{time:[-2707689600,-1739059200,704851200,729043200,1924974e3],offset:[-17776,-17776,-18e3,-14400,-18e3]},"America/Caracas":{time:[-2524521600,-1826755200,-157766400,1197169200,1462069800,1924977600],offset:[-16064,-16060,-16200,-14400,-16200,-14400]},"Europe/Moscow":{time:[-2840140800,-1688256e3,-165681e4,-1641340800,-1627956e3,-1618700400,-1596416400,-1593804521,-1589846400,-1542416400,-1539478800,-1525305600,-1522713600,-1491177600,-1247529600,354931200,370742400,386467200,402278400,418003200,433814400,449625600,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,695786400,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1414288800,1925002800],
offset:[9017,9017,9079,12679,9079,16279,12679,16279,14400,10800,14400,18e3,14400,10800,7200,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,10800,7200,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800]},"Europe/Athens":{time:[-2344636800,-1686095940,-1182988800,-1178150400,-906854400,-904867200,-85725e4,-844473600,-828230400,-812419200,-552355200,-541641600,166492800,186195600,198036e3,213764400,228880800,244090800,260330400,275457600,291805200,307418400,323395200,338947200,354682800,370411200,386132400,401860800,417582e3,433310400,449031600,465364800,481086e3,496814400,512535600,528264e3,543985200,559713600,575434800,591163200,606884400,622612800,638334e3,654667200,670388400,686116800,701838e3,717566400,733287600,749016e3,764737200,780465600,796186800,811915200,828241200,846388800,859690800,877838400,891140400,909288e3,92259e4,941342400,954039600,972792e3,985489200,1004241600,1017543600,1035691200,1048993200,1067140800,1080442800,1099195200,1111892400,1130644800,1143342e3,1162094400,1174791600,1193544e3,1206846e3,1224993600,1238295600,1256443200,1269745200,1288497600,1301194800,1319947200,1332644400,1351396800,1364698800,1382846400,1396148400,1414296e3,1427598e3,1445745600,1459047600,14778e5,1490497200,1509249600,1521946800,1540699200,1554001200,1572148800,1585450800,1603598400,1616900400,1635652800,164835e4,1667102400,1679799600,1698552e3,1711854e3,1730001600,1743303600,1761451200,1774753200,1792900800,1806202800,1824955200,1837652400,1856404800,1869102e3,1887854400,1901156400,1919304e3,1932606e3],offset:[5692,5692,7200,10800,7200,10800,7200,3600,7200,3600,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200]},"Europe/Belgrade":{
time:[-2713910400,-905821200,-85725e4,-844552800,-828219600,-812498400,-79677e4,-777938400,-766616400,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],offset:[4920,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Berlin":{time:[-2422051200,-1693702800,-1680476400,-1663452e3,-1650142800,-1632002400,-1618693200,-938901600,-85725e4,-844552800,-828219600,-812498400,-79677e4,-781048800,-776556e3,-765925200,-761173200,-748476e3,-733266e3,-717627600,-714603600,-71037e4,-701902800,-684972e3,-670453200,-654127200,-639003600,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],
offset:[3208,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,10800,7200,3600,7200,3600,7200,10800,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Bratislava":{time:[-3786825600,-2469398400,-1693702800,-1680476400,-1663452e3,-1650142800,-1632002400,-1618693200,-938901600,-85725e4,-844552800,-828219600,-812498400,-79677e4,-781048800,-765320400,-746575200,-733352400,-728514e3,-72126e4,-716421600,-701902800,-684972e3,-670453200,-654213600,-639003600,29178e4,307508400,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],offset:[3464,3464,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,0,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Bucharest":{
time:[-2469398400,-1213142400,-1187049600,-1175468400,-1159747200,-1144018800,-1127692800,-1111964400,-1096243200,-1080514800,-1064793600,-1049065200,-1033344e3,-1017615600,-1001894400,-986166e3,-970444800,-954716400,296611200,307497600,323823600,338950800,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670377600,686106e3,701827200,717555600,733276800,749005200,764726400,780451200,796176e3,811900800,828230400,846374400,859690800,877838400,891140400,909288e3,92259e4,941342400,954039600,972792e3,985489200,1004241600,1017543600,1035691200,1048993200,1067140800,1080442800,1099195200,1111892400,1130644800,1143342e3,1162094400,1174791600,1193544e3,1206846e3,1224993600,1238295600,1256443200,1269745200,1288497600,1301194800,1319947200,1332644400,1351396800,1364698800,1382846400,1396148400,1414296e3,1427598e3,1445745600,1459047600,14778e5,1490497200,1509249600,1521946800,1540699200,1554001200,1572148800,1585450800,1603598400,1616900400,1635652800,164835e4,1667102400,1679799600,1698552e3,1711854e3,1730001600,1743303600,1761451200,1774753200,1792900800,1806202800,1824955200,1837652400,1856404800,1869102e3,1887854400,1901156400,1919304e3,1932606e3],offset:[6264,6264,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200]},"Europe/Budapest":{
time:[-2498256e3,-1693702800,-1680476400,-1663452e3,-1650142800,-1632002400,-1618693200,-1600466400,-1587243600,-1569708e3,-1555189200,-906771600,-85725e4,-844552800,-828219600,-812498400,-79677e4,-778467600,-762649200,-749685600,-733269600,-717631200,-701902800,-686181600,-670453200,-654127200,-639003600,-492652800,-481161600,-461196e3,-449701200,-428536800,-418251600,-397087200,-386802e3,323827200,338950800,354672e3,370400400,386121600,40185e4,417571200,433299600,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],offset:[4580,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/London":{
time:[-3852662400,-1691964e3,-1680469200,-1664143200,-1650142800,-1633903200,-1617483600,-1601848800,-1586034e3,-1570399200,-1552165200,-1538344800,-152253e4,-15075e5,-1490562e3,-1473631200,-1460926800,-1442786400,-1428872400,-1410732e3,-1396213200,-1379282400,-1364763600,-1348437600,-1333314e3,-1315778400,-1301259600,-1284328800,-126981e4,-1253484e3,-1238360400,-1221429600,-1206910800,-118998e4,-1175461200,-1159135200,-1143406800,-1126476e3,-1111957200,-1095631200,-1080507600,-1063576800,-1049058e3,-1032127200,-1017608400,-1001282400,-986158800,-969228e3,-950475600,-942012e3,-904514400,-896043600,-875484e3,-864594e3,-844034400,-832539600,-812584800,-798066e3,-781048800,-772059600,-764802e3,-748476e3,-733352400,-719445600,-717026400,-706741200,-699483600,-687996e3,-668034e3,-654732e3,-636584400,-622072800,-605739600,-590623200,-57429e4,-558568800,-542235600,-527119200,-512600400,-496274400,-481150800,-46422e4,-449701200,-432165600,-417646800,-401320800,-386197200,-369266400,-354747600,-337816800,-323298e3,-306972e3,-291848400,-276732e3,-257979600,-245282400,-22653e4,-213228e3,-195080400,-182383200,-163630800,-150933600,-132181200,-119484e3,-100731600,-88034400,-68677200,-59004e3,-37238400,57726e3,69818400,89175600,101268e3,120625200,132717600,152074800,164167200,183524400,196221600,214974e3,227671200,246423600,259120800,278478e3,290570400,309927600,32202e4,341377200,354675600,372823200,386125200,404272800,417574800,435722400,449024400,467776800,481078800,499226400,512528400,530676e3,543978e3,562125600,575427600,593575200,606877200,625629600,638326800,657079200,670381200,688528800,701830800,719978400,733280400,751428e3,76473e4,782877600,796179600,814327200,828234e3,846381600,859683600,877831200,891133200,909280800,922582800,941335200,954032400,972784800,985482e3,1004234400,1017536400,1035684e3,1048986e3,1067133600,1080435600,1099188e3,1111885200,1130637600,1143334800,1162087200,1174784400,1193536800,1206838800,1224986400,1238288400,1256436e3,1269738e3,1288490400,1301187600,131994e4,1332637200,1351389600,1364691600,1382839200,1396141200,1414288800,1427590800,1445738400,1459040400,1477792800,149049e4,1509242400,1521939600,1540692e3,1553994e3,1572141600,1585443600,1603591200,1616893200,1635645600,1648342800,1667095200,1679792400,1698544800,1711846800,1729994400,1743296400,1761444e3,1774746e3,1792893600,1806195600,1824948e3,1837645200,1856397600,1869094800,1887847200,1901149200,1919296800,1932598800],
offset:[-75,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,0,3600,0,3600,7200,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0]},"Europe/Luxembourg":{time:[-2069712e3,-1692493200,-1680476400,-1662339600,-165015e4,-1632002400,-1618693200,-1612656e3,-1604278800,-1585515600,-1574038800,-1552255200,-1539997200,-1520546400,-1507510800,-1490569200,-1473642e3,-1459116e3,-1444006800,-142767e4,-1411866e3,-1396220400,-1379293200,-1364770800,-1348448400,-1333321200,-1316394e3,-1301266800,-1284339600,-126981e4,-1253484e3,-1238360400,-1221429600,-1206910800,-1191189600,-1175461200,-1160344800,-1143406800,-1127685600,-1111957200,-1096840800,-1080507600,-1063576800,-1049058e3,-1033336800,-1017608400,-1002492e3,-986158800,-969228e3,-950475600,-942012e3,-935182800,-85725e4,-844552800,-828219600,-812498400,-797979600,-781048800,-766616400,-745452e3,-733266e3,228880800,244004400,260330400,276058800,29178e4,307508400,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],
offset:[1476,3600,7200,3600,7200,3600,7200,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Madrid":{time:[-2177453684,-1631926800,-1616886e3,-1601168400,-158535e4,-1442451600,-142767e4,-1379293200,-1364770800,-1348448400,-1333321200,-1316390400,-1301266800,-1284339600,-1269817200,-1026954e3,-1017615600,-1001898e3,-999478800,-986083200,-954111600,-940208400,-873075600,-862614e3,-842835600,-828313200,-811386e3,-796863600,-779936400,-765414e3,-748486800,-733964400,-652323600,-639010800,135126e3,150253200,166575600,181702800,196815600,212547600,22887e4,243997200,260330400,276058800,29178e4,307508400,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],
offset:[-884,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,7200,3600,0,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Paris":{time:[-2486592e3,-1855958400,-1689814800,-1680393600,-1665363600,-1648339200,-1635123600,-1616889600,-1604278800,-158544e4,-1574038800,-1552262400,-1539997200,-1520553600,-1507510800,-1490572800,-1470618e3,-1459123200,-1444006800,-1427673600,-1411952400,-1396224e3,-1379293200,-1364774400,-1348448400,-1333324800,-1316394e3,-1301270400,-1284339600,-1269820800,-1253494800,-1238371200,-1221440400,-1206921600,-1191200400,-1175472e3,-1160355600,-1143417600,-1127696400,-1111968e3,-1096851600,-1080518400,-1063587600,-1049068800,-1033347600,-1017619200,-1002502800,-986169600,-969238800,-950486400,-942012e3,-932432400,-85725e4,-844552800,-828219600,-812498400,-800064e3,-796258800,-781048800,-766616400,196822800,212547600,228880800,244004400,260330400,276058800,29178e4,307508400,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],
offset:[561,561,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,7200,3600,7200,3600,7200,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Rome":{time:[-3252096e3,-2403562204,-1690761600,-168048e4,-1664755200,-1648944e3,-163512e4,-1616889600,-1604275200,-1585526400,-1571011200,-1555286400,-932428800,-85725e4,-844552800,-828219600,-812498400,-798066e3,-781048800,-76671e4,-750895200,-733352400,-719452800,-70191e4,-689205600,-670453200,-114048e3,-103161600,-81993600,-71708400,-50544e3,-40258800,-18489600,-8204400,1296e4,23245200,43804800,54694800,75859200,86749200,107913600,118198800,138758400,149648400,170812800,181098e3,202262400,212547600,233107200,243997200,265161600,276051600,296611200,307501200,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],
offset:[2996,2996,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Warsaw":{time:[-2840140800,-1717027200,-1693702800,-1680476400,-1663452e3,-1650142800,-1632002400,-1618693200,-1600466400,-1587157200,-1501718400,-931730400,-85725e4,-844552800,-828219600,-812498400,-796600800,-778723200,-762652800,-748483200,-733266e3,-715212e3,-701902800,-684972e3,-670453200,-654127200,-639003600,-397090800,-386805600,-371084400,-355356e3,-334191600,-323301600,-307580400,-291852e3,-271292400,-260402400,-239842800,-228952800,-208393200,-197503200,-176338800,-166053600,228877200,244000800,260326800,276055200,291776400,307504800,323830800,338954400,354675600,370404e3,386125200,401853600,417574800,433303200,449024400,465357600,481078800,496807200,512528400,528256800,543978e3,559706400,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],
offset:[5040,5040,3600,7200,3600,7200,3600,7200,7200,10800,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Istanbul":{time:[-2840140800,-1869868800,-1693699200,-168048e4,-1570406400,-1552176e3,-1538352e3,-1522540800,-1507507200,-1490572800,-1440201600,-1428019200,-1409702400,-1396483200,-931046400,-922665600,-917827200,-892425600,-875836800,-764726400,-744336e3,-733795200,-716428800,-701913600,-684979200,-670464e3,-654134400,-639014400,-62208e4,-60696e4,-590025600,-575510400,-235612800,-194832e3,-177724800,-165715200,107917200,121226400,133927200,152676e3,164685600,184125600,196221600,215575200,228880800,245815200,260330400,267926400,428464800,433908e3,468122400,482806800,496720800,512528400,528256800,543978e3,559706400,575427600,591156e3,606877200,622605600,638326800,65466e4,670381200,686109600,701830800,717559200,733280400,749008800,764125200,780458400,796179600,811908e3,828234e3,846381600,859683600,877831200,891133200,909280800,922582800,941335200,954032400,972784800,985482e3,1004234400,1017536400,1035684e3,1048986e3,1067133600,1080435600,1099188e3,1111885200,1130637600,1143334800,1162087200,1174791600,1193544e3,1206846e3,1224993600,1238295600,1256443200,1269745200,1288497600,1301281200,1319947200,1332644400,1351396800,1364698800,1382846400,1396234800,1414296e3,1427598e3,1446955200,1459047600,1473206400,1925002800],offset:[6952,7016,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,10800,14400,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,10800]},"Europe/Zurich":{
time:[-3675196800,-2385244800,-904431600,-891122400,-872982e3,-859672800,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],offset:[2048,1786,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Australia/Sydney":{time:[-2364076800,-1672524e3,-1665349200,-883605600,-876085200,-860364e3,-844635600,-828309600,-813186e3,57722400,68007600,89172e3,100062e3,120621600,131511600,152071200,162961200,183520800,195015600,215575200,226465200,247024800,257914800,278474400,289364400,309924e3,320814e3,341373600,352263600,372823200,386737200,404877600,415767600,436327200,447217200,467776800,478666800,499226400,511326e3,530071200,542775600,562125600,57483e4,59418e4,606279600,625629600,636519600,657079200,667969200,688528800,699418800,719978400,731473200,752032800,762922800,783482400,794372400,814932e3,828241200,846381600,859690800,877831200,891140400,909280800,92259e4,941335200,954039600,967341600,985489200,1004234400,1017543600,1035684e3,1048993200,1067133600,1080442800,1099188e3,1111892400,1130637600,1143946800,1162087200,1174791600,1193536800,1207450800,1223172e3,1238900400,1254621600,127035e4,1286071200,1301799600,1317520800,1333249200,1349575200,1365303600,1381024800,1396753200,1412474400,1428202800,1443924e3,1459652400,1475373600,1491102e3,1506823200,1522551600,1538877600,1554606e3,1570327200,1586055600,1601776800,1617505200,1633226400,1648954800,1664676e3,1680404400,1696125600,1712458800,172818e4,1743908400,1759629600,1775358e3,1791079200,1806807600,1822528800,1838257200,1853978400,1869706800,1886032800,1901761200,1917482400,1933210800],
offset:[36292,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600]},"Australia/Brisbane":{time:[-2366755200,-1672524e3,-1665349200,-883605600,-876085200,-860364e3,-844635600,-828309600,-813186e3,57722400,68007600,625629600,636519600,657079200,667969200,688528800,699418800,1925028e3],offset:[36728,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3]},"Australia/Adelaide":{time:[-2364076800,-2230156800,-1672524e3,-1665349200,-883605600,-876085200,-860364e3,-844635600,-828309600,-813186e3,57722400,68007600,89172e3,100062e3,120621600,131511600,152071200,162961200,183520800,195015600,215575200,226465200,247024800,257914800,278474400,289364400,309924e3,320814e3,341373600,352263600,372823200,384318e3,404877600,415767600,436327200,447217200,467776800,478666800,499226400,511326e3,530071200,542775600,562125600,57483e4,59418e4,606279600,625629600,637729200,657079200,667969200,688528800,701233200,719978400,731473200,752032800,764132400,783482400,796186800,814932e3,828241200,846381600,859690800,877831200,891140400,909280800,92259e4,941335200,954039600,972784800,985489200,1004234400,1017543600,1035684e3,1048993200,1067133600,1080442800,1099188e3,1111892400,1130637600,1143946800,1162087200,1174791600,1193536800,1207450800,1223172e3,1238900400,1254621600,127035e4,1286071200,1301799600,1317520800,1333249200,1349575200,1365303600,1381024800,1396753200,1412474400,1428202800,1443924e3,1459652400,1475373600,1491102e3,1506823200,1522551600,1538877600,1554606e3,1570327200,1586055600,1601776800,1617505200,1633226400,1648954800,1664676e3,1680404400,1696125600,1712458800,172818e4,1743908400,1759629600,1775358e3,1791079200,1806807600,1822528800,1838257200,1853978400,1869706800,1886032800,1901761200,1917482400,1933210800],
offset:[33260,32400,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800,34200,37800]},"Australia/ACT":{time:[-2364076800,-1672524e3,-1665349200,-883605600,-876085200,-860364e3,-844635600,-828309600,-813186e3,57722400,68007600,89172e3,100062e3,120621600,131511600,152071200,162961200,183520800,195015600,215575200,226465200,247024800,257914800,278474400,289364400,309924e3,320814e3,341373600,352263600,372823200,386737200,404877600,415767600,436327200,447217200,467776800,478666800,499226400,511326e3,530071200,542775600,562125600,57483e4,59418e4,606279600,625629600,636519600,657079200,667969200,688528800,699418800,719978400,731473200,752032800,762922800,783482400,794372400,814932e3,828241200,846381600,859690800,877831200,891140400,909280800,92259e4,941335200,954039600,967341600,985489200,1004234400,1017543600,1035684e3,1048993200,1067133600,1080442800,1099188e3,1111892400,1130637600,1143946800,1162087200,1174791600,1193536800,1207450800,1223172e3,1238900400,1254621600,127035e4,1286071200,1301799600,1317520800,1333249200,1349575200,1365303600,1381024800,1396753200,1412474400,1428202800,1443924e3,1459652400,1475373600,1491102e3,1506823200,1522551600,1538877600,1554606e3,1570327200,1586055600,1601776800,1617505200,1633226400,1648954800,1664676e3,1680404400,1696125600,1712458800,172818e4,1743908400,1759629600,1775358e3,1791079200,1806807600,1822528800,1838257200,1853978400,1869706800,1886032800,1901761200,1917482400,1933210800],offset:[36292,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600,36e3,39600]},"Asia/Almaty":{
time:[-1441152e3,-1247529600,354931200,370742400,386467200,402278400,418003200,433814400,449625600,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,695786400,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1925013600],offset:[18468,18e3,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,21600,18e3,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600,25200,21600]},"Asia/Ashkhabad":{time:[-1441152e3,-1247529600,354931200,370742400,386467200,402278400,418003200,433814400,449625600,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,695786400,192501e4],offset:[14012,14400,18e3,21600,18e3,21600,18e3,21600,18e3,21600,18e3,21600,18e3,21600,18e3,21600,18e3,21600,18e3,21600,18e3,21600,18e3,18e3,14400,18e3]},"Asia/Colombo":{time:[-2840140800,-2019686400,-883267200,-862617600,-764028e3,832982400,846289800,1145061e3,1925011800],offset:[19164,19172,19800,21600,23400,19800,23400,21600,19800]},"Asia/Tokyo":{time:[-2587678861,-683769600,-672274800,-654739200,-640825200,-620265600,-609375600,-588816e3,-577926e3,1925024400],offset:[33539,32400,36e3,32400,36e3,32400,36e3,32400,36e3,32400]},"Asia/Taipei":{time:[-2335219200,-1017792e3,-766191600,-745804800,-733795200,-716860800,-699580800,-683856e3,-670636800,-65232e4,-639100800,-620784e3,-607564800,-589248e3,-576028800,-562896e3,-541728e3,-528681600,-510192e3,-497145600,-478656e3,-465609600,-449798400,-433987200,-418176e3,-402451200,-38664e4,-370915200,-355104e3,-339379200,-323568e3,-302486400,-291945600,-270950400,-260409600,134006400,149817600,165542400,181353600,299635200,307584e3,1925020800],offset:[29160,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800]},"Asia/Singapore":{time:[-2177452800,-2038176e3,-1167609600,-1073001600,-894153600,-879638400,-766972800,378689400,1925020800],offset:[24925,24925,25200,26400,26400,27e3,32400,27e3,28800]},"Asia/Karachi":{time:[-1988150400,-862617600,-764121600,-576115200,38793600,1018137600,1033862400,1212278400,1225497600,1239753600,1257033600,192501e4],offset:[16092,19800,23400,19800,18e3,18e3,21600,18e3,21600,18e3,21600,18e3]},"Asia/Manila":{time:[-3944678400,-2229292800,-1046649600,-1038700800,-873244800,-794188800,-496195200,-489283200,259372800,275184e3,1925020800],offset:[-57360,29040,28800,32400,28800,32400,28800,32400,28800,32400,28800]},"Asia/Shanghai":{
time:[-2177452800,-1600646400,-1585872e3,-933638400,-922060800,-908841600,-888796800,-881020800,-767836800,-745804800,-733795200,-716860800,-699580800,-683856e3,-670636800,-65232e4,-649987200,515556e3,527047200,545191200,558496800,577245600,589946400,608695200,622000800,640144800,653450400,671594400,6849e5,1925020800],offset:[29143,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800]},"Asia/Seoul":{time:[-1948752e3,-1830384e3,-767318400,-681177600,-672192e3,-654739200,-640828800,-623376e3,-609379200,-588816e3,-577929600,-498096e3,-462672e3,-451699200,-429753600,-418262400,-399513600,-387417600,-368064e3,-355968e3,-336614400,-324518400,-305164800,-293068800,-264902400,547610400,560919600,57906e4,592369200,1925024400],offset:[30472,30600,32400,32400,36e3,32400,36e3,32400,36e3,32400,36e3,32400,30600,34200,30600,34200,30600,34200,30600,34200,30600,34200,30600,34200,30600,32400,36e3,32400,36e3,32400]},"Asia/Tehran":{time:[-1704153600,-1090454400,227833200,24624e4,259632e3,271126800,283996800,296611200,306547200,322444800,338515200,673228800,685497600,701222400,71712e4,732758400,748656e3,764294400,780192e3,795830400,811728e3,827366400,843264e3,858988800,874886400,890524800,906422400,922060800,937958400,953596800,969494400,985219200,1001116800,1016755200,1032652800,1048291200,1064188800,1079827200,1095724800,1111449600,1127347200,1206057600,1221955200,123768e4,1253577600,1269216e3,1285113600,1300752e3,1316649600,1332288e3,1348185600,1363910400,1379808e3,1395446400,1411344e3,1426982400,144288e4,1458518400,1474416e3,1490140800,1506038400,1521676800,1537574400,1553212800,1569110400,1584748800,1600646400,1616371200,1632268800,1647907200,1663804800,1925004600],offset:[12344,12344,12600,16200,14400,18e3,14400,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600,16200,12600]},"Asia/Dubai":{time:[-1577923200,1925006400],offset:[13272,14400]},"Asia/Kolkata":{time:[-3645216e3,-3155673600,-2019686400,-891561600,-872035200,-862617600,-764121600,1925011800],offset:[21208,21200,19270,19800,23400,19800,23400,19800]},"Asia/Hong_Kong":{
time:[-2056663398,-900882e3,-891547200,-884217600,-761176800,-747878400,-728508600,-717021e3,-697059e3,-683757e3,-668028600,-654726600,-636579e3,-623277e3,-605129400,-591827400,-573679800,-559773e3,-541625400,-528323400,-510179400,-498083400,-478729800,-466633800,-446675400,-435184200,-415225800,-403129800,-383776200,-371680200,-352326600,-340230600,-320877e3,-308781e3,-288822600,-277331400,-257373e3,-245881800,-225923400,-213827400,-194473800,-182377800,-163024200,-148509e3,-132784200,-117059400,-101334600,-85609800,-69280200,-53555400,-37830600,-22105800,-6381e3,9343800,25068600,40793400,56518200,72243e3,88572600,104297400,120022200,126070200,151471800,167196600,182921400,198646200,214371e3,295414200,309324600,1925020800],offset:[27402,28800,32400,30600,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800]},"Asia/Bangkok":{time:[-2840140800,-1570060800,1925017200],offset:[24124,24124,25200]},"Asia/Chongqing":{time:[-2177452800,-1600646400,-1585872e3,-933638400,-922060800,-908841600,-888796800,-881020800,-767836800,-745804800,-733795200,-716860800,-699580800,-683856e3,-670636800,-65232e4,-649987200,515556e3,527047200,545191200,558496800,577245600,589946400,608695200,622000800,640144800,653450400,671594400,6849e5,1925020800],offset:[29143,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800]},"Asia/Jerusalem":{
time:[-2840140800,-1640995200,-933631200,-923086800,-919029600,-857336400,-844293600,-825800400,-812671200,-794178e3,-779839200,-762642e3,-748303200,-731106e3,-681948e3,-673214400,-667947600,-652312800,-636411600,-622072800,-608936400,-591832800,-572475600,-558568800,-542840400,-527724e3,-514414800,-490831200,-482965200,-459381600,-451515600,-428536800,-418251600,-400111200,-387406800,142387200,150854400,167184e3,178675200,334108800,337741200,452649600,46233e4,482284800,494380800,516758400,526435200,545443200,558489600,576633600,589334400,609897600,620784e3,638323200,651628800,669772800,683683200,701827200,715737600,733708800,747187200,765158400,778032e3,796608e3,810086400,826848e3,842832e3,858902400,874195200,890352e3,90504e4,923018400,936324e3,955677600,970794e3,986778e3,1001293200,1017363600,1033952400,1048813200,1065142800,1081299600,1095814800,1112320800,1128823200,1143770400,1159668e3,117522e4,1189908e3,1206669600,1223172e3,1238119200,1254016800,1269568800,1284256800,1301623200,1317520800,1333072800,1348365600,1364522400,1382839200,1395972e3,1414288800,1427421600,1445738400,1458871200,1477792800,1490320800,1509242400,1521770400,1540692e3,1553824800,1572141600,1585274400,1603591200,1616724e3,1635645600,1648173600,1667095200,1679623200,1698544800,1711677600,1729994400,1743127200,1761444e3,1774576800,1792893600,1806026400,1824948e3,1837476e3,1856397600,1868925600,1887847200,190098e4,1919296800,1932429600],offset:[8454,8440,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,14400,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200]},"Asia/Kuwait":{time:[-631152e3,1925002800],offset:[11516,10800]},"Asia/Muscat":{time:[-1577923200,1925006400],offset:[14064,14400]},"Asia/Nicosia":{
time:[-1518912e3,166579200,182304e3,200966400,21384e4,228873600,243993600,260323200,276134400,291772800,307497600,323827200,338947200,354672e3,370396800,386121600,401846400,417571200,433296e3,449020800,465350400,481075200,4968e5,512524800,528249600,543974400,559699200,575424e3,591148800,606873600,622598400,638323200,654652800,670377600,686102400,701827200,717552e3,733276800,749001600,764726400,780451200,796176e3,811900800,828230400,843955200,85968e4,875404800,891129600,909288e3,92259e4,941342400,954039600,972792e3,985489200,1004241600,1017543600,1035691200,1048993200,1067140800,1080442800,1099195200,1111892400,1130644800,1143342e3,1162094400,1174791600,1193544e3,1206846e3,1224993600,1238295600,1256443200,1269745200,1288497600,1301194800,1319947200,1332644400,1351396800,1364698800,1382846400,1396148400,1414296e3,1427598e3,1445745600,1459047600,14778e5,1490497200,1509249600,1521946800,1540699200,1554001200,1572148800,1585450800,1603598400,1616900400,1635652800,164835e4,1667102400,1679799600,1698552e3,1711854e3,1730001600,1743303600,1761451200,1774753200,1792900800,1806202800,1824955200,1837652400,1856404800,1869102e3,1887854400,1901156400,1919304e3,1932606e3],offset:[8008,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200]},"Asia/Qatar":{time:[-1577923200,76204800,1925002800],offset:[12368,14400,10800]},"Asia/Riyadh":{time:[-719625600,1925002800],offset:[11212,10800]},"Asia/Yangon":{time:[-2840140800,-1577923200,-873244800,-778377600,1925015400],offset:[23087,23087,23400,32400,23400]},"Pacific/Auckland":{
time:[-3192393600,-1330293600,-1320012e3,-1300658400,-1287352800,-1269208800,-1255903200,-1237759200,-1224453600,-1206309600,-1192399200,-117486e4,-1160949600,-1143410400,-1125871200,-1112565600,-1094421600,-1081116e3,-1062972e3,-1049666400,-1031522400,-1018216800,-1000072800,-986767200,-968018400,-955317600,-936568800,-923263200,-757382400,152676e3,162356400,183520800,195015600,215575200,226465200,247024800,257914800,278474400,289364400,309924e3,320814e3,341373600,352263600,372823200,384318e3,404877600,415767600,436327200,447217200,467776800,478666800,499226400,510116400,530676e3,541566e3,562125600,573620400,59418e4,60507e4,623815200,637729200,655264800,669178800,686714400,700628400,718164e3,732682800,749613600,764132400,781063200,795582e3,812512800,827031600,844567200,858481200,876016800,889930800,907466400,921985200,938916e3,953434800,970365600,984884400,100242e4,1016334e3,1033869600,1047783600,1065319200,1079838e3,1096768800,1111287600,1128218400,1142737200,1159668e3,1174186800,1191117600,1207450800,1222567200,1238900400,1254016800,127035e4,1285466400,1301799600,1316916e3,1333249200,1348970400,1365303600,138042e4,1396753200,1411869600,1428202800,1443319200,1459652400,1474768800,1491102e3,1506218400,1522551600,1538272800,1554606e3,1569722400,1586055600,1601172e3,1617505200,1632621600,1648954800,1664071200,1680404400,1695520800,1712458800,1727575200,1743908400,1759024800,1775358e3,1790474400,1806807600,1821924e3,1838257200,1853373600,1869706800,1885428e3,1901761200,1916877600,1933210800],offset:[41944,41400,45e3,41400,43200,41400,43200,41400,43200,41400,43200,41400,43200,41400,43200,41400,43200,41400,43200,41400,43200,41400,43200,41400,43200,41400,43200,41400,43200,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800,43200,46800]},"Pacific/Chatham":{
time:[-3192393600,-757382400,152678700,162359100,183523500,195018300,215577900,226467900,247027500,257917500,278477100,289367100,309926700,320816700,341376300,352266300,372825900,384320700,404880300,415770300,436329900,447219900,467779500,478669500,499229100,510119100,530678700,541568700,562128300,573623100,594182700,605072700,623817900,637731900,655267500,669181500,686717100,700631100,718166700,732685500,749616300,764135100,781065900,795584700,812515500,827034300,844569900,858483900,876019500,889933500,907469100,921987900,938918700,953437500,970368300,984887100,1002422700,1016336700,1033872300,1047786300,1065321900,1079840700,1096771500,1111290300,1128221100,1142739900,1159670700,1174189500,1191120300,1207453500,1222569900,1238903100,1254019500,1270352700,1285469100,1301802300,1316918700,1333251900,1348973100,1365306300,1380422700,1396755900,1411872300,1428205500,1443321900,1459655100,1474771500,1491104700,1506221100,1522554300,1538275500,1554608700,1569725100,1586058300,1601174700,1617507900,1632624300,1648957500,1664073900,1680407100,1695523500,1712461500,1727577900,1743911100,1759027500,1775360700,1790477100,1806810300,1821926700,1838259900,1853376300,1869709500,1885430700,1901763900,1916880300,1933213500],offset:[44028,44100,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500,45900,49500]},"Pacific/Fakaofo":{time:[-2177452800,1325203200,1925038800],offset:[-41096,-39600,46800]},"Pacific/Honolulu":{time:[-2334139200,-1157320800,-1155470400,-880236e3,-769429800,-765410400,-712188e3,1924956e3],offset:[-37886,-37800,-34200,-37800,-34200,-34200,-37800,-36e3]},"America/Mexico_City":{time:[-1514763396,-1343091600,-1234828800,-1220317200,-1207180800,-1191369600,-975283200,-963187200,-917136e3,-907372800,-821923200,-810086400,-627523200,-613008e3,828842400,846381600,860292e3,877831200,891741600,909280800,923191200,941335200,954640800,972784800,989114400,1001815200,1018144800,1035684e3,1049594400,1067133600,1081044e3,1099188e3,1112493600,1130637600,1143943200,1162087200,1175392800,1193536800,1207447200,1224986400,1238896800,1256436e3,1270346400,1288490400,1301796e3,131994e4,1333245600,1351389600,13653e5,1382839200,1396749600,1414288800,1428199200,1445738400,1459648800,1477792800,1491098400,1509242400,1522548e3,1540692e3,1554602400,1572141600,1586052e3,1603591200,1617501600,1635645600,1648951200,1667095200,1924970400],
offset:[-23796,-25200,-21600,-25200,-21600,-25200,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600,-18e3,-21600]},"Africa/Cairo":{time:[-2185401600,-929836800,-923097600,-906163200,-892857600,-875836800,-857779200,-844300800,-825811200,-812678400,-794188800,-779846400,-762652800,-399081600,-38664e4,-368323200,-355104e3,-336783600,-323643600,-305161200,-292021200,-273625200,-260485200,-242089200,-228949200,-210553200,-197413200,-178930800,-165790800,-147394800,-134254800,-115858800,-102632400,-84322800,-71096400,-52700400,-39474e3,-21164400,-7938e3,10371600,23598e3,41907600,55134e3,7353e4,86756400,105066e3,118292400,136602e3,149828400,168138e3,181364400,199760400,212986800,231296400,244522800,262832400,276058800,294368400,307594800,325990800,339217200,357526800,370753200,396406800,402289200,426819600,433825200,452221200,465447600,483757200,496983600,515293200,528519600,546829200,560055600,578451600,591678e3,610419600,623214e3,641523600,65475e4,673059600,686286e3,704682e3,717908400,736218e3,749444400,767754e3,780980400,799027200,812332800,830476800,843782400,861926400,875232e3,893376e3,906681600,925430400,938736e3,95688e4,970185600,988329600,1001635200,1019779200,1033084800,1051228800,1064534400,1083283200,1096588800,1114732800,1128038400,1146182400,1158883200,1177632e3,1189123200,1209081600,1219968e3,1240531200,1250812800,1272585600,1281484800,1284076800,1285891200,1400198400,1403827200,1406851200,1411689600,168264e4,1698364800,1714089600,1730419200,1745539200,1761868800,1776988800,1793318400,1809043200,1824768e3,1840492800,1856217600,1871942400,1887667200,1903392e3,1919721600,1934841600],offset:[7509,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200]},"Africa/Johannesburg":{time:[-2458166400,-2109283200,-860968800,-845244e3,-829519200,-813794400,1924999200],offset:[6720,5400,7200,10800,7200,10800,7200]},"Africa/Nairobi":{time:[-194616e4,-1309737600,-1261958400,-1041379200,-865296e3,1925002800],offset:[8836,9e3,10800,9e3,9900,10800]},"Africa/Tunis":{
time:[-27972e5,-1855958400,-969238800,-950486400,-941936400,-891129600,-877824e3,-85725e4,-844552800,-842911200,-84222e4,-828223200,-812498400,-796262400,-781048800,-766627200,231206400,243910800,262828800,276051600,581126400,591152400,606873600,622602e3,64152e4,654656400,1114905600,1128045600,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1924995600],offset:[2444,561,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Asia/Kathmandu":{time:[-1577923200,504921600,1925012700],offset:[20476,19800,20700]},"US/Mountain":{time:[-2717668796,-1633298400,-1615154400,-1601848800,-1583704800,-1570399200,-1551650400,-1538949600,-1534111200,-880236e3,-769417200,-765410400,-147909600,-13158e4,-11646e4,-100130400,-84405600,-68680800,-52956e3,-37231200,-21506400,-5781600,9943200,25668e3,41392800,57722400,73447200,89172e3,104896800,120621600,126669600,152071200,162352800,183520800,199245600,215575200,230695200,247024800,262749600,278474400,294199200,309924e3,325648800,341373600,357098400,372823200,388548e3,404877600,419997600,436327200,452052e3,467776800,483501600,499226400,514951200,530676e3,544586400,562125600,576036e3,59418e4,607485600,625629600,638935200,657079200,670989600,688528800,702439200,719978400,733888800,752032800,765338400,783482400,796788e3,814932e3,828842400,846381600,860292e3,877831200,891741600,909280800,923191200,941335200,954640800,972784800,986090400,1004234400,1018144800,1035684e3,1049594400,1067133600,1081044e3,1099188e3,1112493600,1130637600,1143943200,1162087200,1173578400,1194141600,1205028e3,1225591200,1236477600,1257040800,1268532e3,1289095200,1299981600,1320544800,1331431200,1351994400,1362880800,1383444e3,1394330400,1414893600,142578e4,1446343200,1457834400,1478397600,1489284e3,1509847200,1520733600,1541296800,1552183200,1572746400,1583632800,1604196e3,1615687200,1636250400,1647136800,16677e5,1678586400,1699149600,1710036e3,1730599200,1741485600,1762048800,1772935200,1793498400,1804989600,1825552800,1836439200,1857002400,1867888800,1888452e3,1899338400,1919901600,1930788e3],
offset:[-25196,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200,-21600,-25200]},"Europe/Helsinki":{time:[-2890252800,-1535932800,-875664e3,-859762800,354679200,370407600,386128800,401857200,417582e3,433310400,449031600,465364800,481086e3,496814400,512535600,528264e3,543985200,559713600,575434800,591163200,606884400,622612800,638334e3,654667200,670388400,686116800,701838e3,717566400,733287600,749016e3,764737200,780465600,796186800,811915200,828241200,846388800,859690800,877838400,891140400,909288e3,92259e4,941342400,954039600,972792e3,985489200,1004241600,1017543600,1035691200,1048993200,1067140800,1080442800,1099195200,1111892400,1130644800,1143342e3,1162094400,1174791600,1193544e3,1206846e3,1224993600,1238295600,1256443200,1269745200,1288497600,1301194800,1319947200,1332644400,1351396800,1364698800,1382846400,1396148400,1414296e3,1427598e3,1445745600,1459047600,14778e5,1490497200,1509249600,1521946800,1540699200,1554001200,1572148800,1585450800,1603598400,1616900400,1635652800,164835e4,1667102400,1679799600,1698552e3,1711854e3,1730001600,1743303600,1761451200,1774753200,1792900800,1806202800,1824955200,1837652400,1856404800,1869102e3,1887854400,1901156400,1919304e3,1932606e3],offset:[5989,5989,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200]},"Europe/Stockholm":{
time:[-2871676800,-2208988800,-1692493200,-1680476400,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],offset:[4332,3614,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Copenhagen":{time:[-2524521600,-2398291200,-1692493200,-1680483600,-935107200,-85725e4,-844552800,-828219600,-812498400,-79677e4,-781048800,-769381200,-747007200,-736376400,-715212e3,-706741200,-683157600,-675291600,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],
offset:[3020,3020,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Atlantic/Reykjavik":{time:[-1956614400,-1668214800,-1647212400,-1636678800,-161343e4,-1605142800,-1581894e3,-1539565200,-153135e4,-968029200,-952293600,-942012e3,-920239200,-909961200,-888789600,-877906800,-857944800,-846457200,-826495200,-815007600,-795045600,-783558e3,-762991200,-752108400,-731541600,-717634800,-700092e3,-686185200,-668642400,-654735600,-636588e3,-623286e3,-605743200,-591836400,-573688800,-559782e3,-542239200,-528332400,-510789600,-496882800,-47934e4,-465433200,-447890400,-433983600,-415836e3,-401929200,-384386400,-370479600,-352936800,-33903e4,-321487200,-307580400,-290037600,-276130800,-258588e3,-244681200,-226533600,-212626800,-195084e3,-181177200,-163634400,-149727600,-132184800,-118278e3,-100735200,-86828400,-68680800,-54774e3,1924992e3],offset:[-5280,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0,-3600,0]},"Europe/Tallinn":{time:[-2840140800,-1638316800,-1632002400,-1618693200,-1593820800,-1535932800,-927936e3,-892944e3,-85725e4,-844552800,-828219600,-812498400,-797644800,354931200,370742400,386467200,402278400,418003200,433814400,449625600,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909288e3,92259e4,941342400,1017543600,1035691200,1048993200,1067140800,1080442800,1099195200,1111892400,1130644800,1143342e3,1162094400,1174791600,1193544e3,1206846e3,1224993600,1238295600,1256443200,1269745200,1288497600,1301194800,1319947200,1332644400,1351396800,1364698800,1382846400,1396148400,1414296e3,1427598e3,1445745600,1459047600,14778e5,1490497200,1509249600,1521946800,1540699200,1554001200,1572148800,1585450800,1603598400,1616900400,1635652800,164835e4,1667102400,1679799600,1698552e3,1711854e3,1730001600,1743303600,1761451200,1774753200,1792900800,1806202800,1824955200,1837652400,1856404800,1869102e3,1887854400,1901156400,1919304e3,1932606e3],
offset:[5940,5940,3600,7200,3600,5940,7200,10800,7200,3600,7200,3600,7200,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200]},"Europe/Riga":{time:[-2840140800,-1632002400,-1618693200,-1601676e3,-1597266e3,-1377302400,-928022400,-899510400,-85725e4,-844552800,-828219600,-812498400,-79677e4,-795830400,354931200,370742400,386467200,402278400,418003200,433814400,449625600,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,843966e3,859690800,877838400,891140400,909288e3,92259e4,941342400,985489200,1004241600,1017543600,1035691200,1048993200,1067140800,1080442800,1099195200,1111892400,1130644800,1143342e3,1162094400,1174791600,1193544e3,1206846e3,1224993600,1238295600,1256443200,1269745200,1288497600,1301194800,1319947200,1332644400,1351396800,1364698800,1382846400,1396148400,1414296e3,1427598e3,1445745600,1459047600,14778e5,1490497200,1509249600,1521946800,1540699200,1554001200,1572148800,1585450800,1603598400,1616900400,1635652800,164835e4,1667102400,1679799600,1698552e3,1711854e3,1730001600,1743303600,1761451200,1774753200,1792900800,1806202800,1824955200,1837652400,1856404800,1869102e3,1887854400,1901156400,1919304e3,1932606e3],offset:[5794,5794,9394,5794,9394,5794,7200,10800,7200,3600,7200,3600,7200,3600,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200]},"Europe/Vilnius":{
time:[-2840140800,-1672531200,-1585094400,-1561248e3,-1553558400,-928195200,-900115200,-85725e4,-844552800,-828219600,-812498400,-802137600,354931200,370742400,386467200,402278400,418003200,433814400,449625600,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891140400,909284400,922586400,941338800,1048993200,1067140800,1080442800,1099195200,1111892400,1130644800,1143342e3,1162094400,1174791600,1193544e3,1206846e3,1224993600,1238295600,1256443200,1269745200,1288497600,1301194800,1319947200,1332644400,1351396800,1364698800,1382846400,1396148400,1414296e3,1427598e3,1445745600,1459047600,14778e5,1490497200,1509249600,1521946800,1540699200,1554001200,1572148800,1585450800,1603598400,1616900400,1635652800,164835e4,1667102400,1679799600,1698552e3,1711854e3,1730001600,1743303600,1761451200,1774753200,1792900800,1806202800,1824955200,1837652400,1856404800,1869102e3,1887854400,1901156400,1919304e3,1932606e3],offset:[6076,5040,5736,3600,7200,3600,10800,7200,3600,7200,3600,7200,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,14400,10800,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,7200,3600,7200,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200,10800,7200]},"America/Lima":{time:[-2524521600,-1938556800,-1009843200,-1002067200,-986774400,-971049600,-955324800,-9396e5,504921600,512697600,536457600,544233600,631152e3,638928e3,757382400,765158400,1924974e3],offset:[-18492,-18516,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3]},"America/Santiago":{
time:[-2524521600,-1892678400,-1688428800,-1619222400,-1593820800,-1336003200,-13176e5,-1304380800,-1286064e3,-1272844800,-1254528e3,-1241308800,-1222992e3,-1209772800,-1191369600,-1178150400,-870566400,-865296e3,-740534400,-736646400,-718070400,-713667600,-36633600,-23932800,-3369600,7516800,24451200,37756800,55900800,69206400,87955200,100656e3,118195200,132105600,150854400,163555200,182304e3,195609600,213753600,227059200,245203200,258508800,277257600,289958400,308707200,321408e3,340156800,353462400,371606400,384912e3,403056e3,416361600,434505600,447811200,46656e4,479260800,498009600,510710400,529459200,545184e3,560908800,574214400,592358400,605664e3,624412800,637113600,653443200,668563200,687312e3,700617600,718761600,732067200,750211200,763516800,781660800,794966400,813715200,826416e3,845164800,85968e4,876614400,88992e4,906854400,923184e3,939513600,952819200,971568e3,984268800,1003017600,1015718400,1034467200,1047168e3,1065916800,1079222400,1097366400,1110672e3,1128816e3,1142121600,1160870400,1173571200,119232e4,1206835200,1223769600,1237075200,1255219200,1270339200,1286668800,1304812800,1313884800,1335657600,1346544e3,1367107200,1378598400,1398556800,1410048e3,1463270400,1471132800,149472e4,1502582400,1526169600,1534032e3,1554595200,1567900800,1586044800,1599350400,1617494400,16308e5,1648944e3,1662854400,1680393600,1693699200,1712448e3,1725753600,1743897600,1757203200,1775347200,1788652800,1806796800,1820102400,1838246400,1851552e3,1870300800,1883001600,1901750400,1915056e3,19332e5],offset:[-16965,-16965,-18e3,-16965,-14400,-16965,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-18e3,-14400,-10800,-14400,-18e3,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800,-14400,-10800]},"Asia/Bahrain":{time:[-897868800,-820540800,76204800,1925002800],offset:[12140,12600,14400,10800]},"Asia/Jakarta":{time:[-3231273600,-1451693568,-117288e4,-876614400,-766022400,-683856e3,-620784e3,-189388800,1925017200],offset:[25632,25632,26400,27e3,32400,27e3,28800,27e3,25200]},"Africa/Lagos":{time:[-2035584e3,-1940889600,-1767225600,-1588464e3,1924995600],offset:[815,0,815,1800,3600]},"Pacific/Norfolk":{
time:[-2177452800,-599616e3,152071200,162961200,1443924e3,1570327200,1586055600,1601776800,1617505200,1633226400,1648954800,1664676e3,1680404400,1696125600,1712458800,172818e4,1743908400,1759629600,1775358e3,1791079200,1806807600,1822528800,1838257200,1853978400,1869706800,1886032800,1901761200,1917482400,1933210800],offset:[40312,40320,41400,45e3,41400,39600,43200,39600,43200,39600,43200,39600,43200,39600,43200,39600,43200,39600,43200,39600,43200,39600,43200,39600,43200,39600,43200,39600,43200]},"America/Juneau":{time:[-3225169588,-2188987200,-880236e3,-769420800,-765410400,-21506400,-5781600,9943200,25668e3,41392800,57722400,73447200,89172e3,104896800,120621600,126669600,152071200,162352800,183520800,199245600,215575200,230695200,247024800,262749600,278474400,294199200,309924e3,325648800,341373600,357098400,372823200,388548e3,404877600,419997600,436327200,438998400,452052e3,467776800,483501600,499226400,514951200,530676e3,544586400,562125600,576036e3,59418e4,607485600,625629600,638935200,657079200,670989600,688528800,702439200,719978400,733888800,752032800,765338400,783482400,796788e3,814932e3,828842400,846381600,860292e3,877831200,891741600,909280800,923191200,941335200,954640800,972784800,986090400,1004234400,1018144800,1035684e3,1049594400,1067133600,1081044e3,1099188e3,1112493600,1130637600,1143943200,1162087200,1173578400,1194141600,1205028e3,1225591200,1236477600,1257040800,1268532e3,1289095200,1299981600,1320544800,1331431200,1351994400,1362880800,1383444e3,1394330400,1414893600,142578e4,1446343200,1457834400,1478397600,1489284e3,1509847200,1520733600,1541296800,1552183200,1572746400,1583632800,1604196e3,1615687200,1636250400,1647136800,16677e5,1678586400,1699149600,1710036e3,1730599200,1741485600,1762048800,1772935200,1793498400,1804989600,1825552800,1836439200,1857002400,1867888800,1888452e3,1899338400,1919901600,1930788e3],offset:[54139,-32261,-28800,-25200,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-25200,-28800,-28800,-28800,-25200,-28800,-25200,-28800,-25200,-32400,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400,-28800,-32400]},"Asia/Ho_Chi_Minh":{time:[-2004048e3,-1851552e3,-852080400,-782614800,-767836800,-718070400,-457747200,-315622800,171849600,1925017200],offset:[25590,25590,25200,28800,32400,25200,28800,25200,28800,25200]},"Australia/Perth":{
time:[-2337897600,-1672524e3,-1665349200,-883605600,-876085200,-860364e3,-844635600,152071200,162961200,436327200,447217200,690343200,699418800,1165111200,1174791600,1193536800,1206846e3,1224986400,1238295600,1925020800],offset:[27804,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800,32400,28800]},"Europe/Malta":{time:[-2403475200,-1690761600,-168048e4,-1664755200,-1648944e3,-163512e4,-1616889600,-1604275200,-1585526400,-1571011200,-1555286400,-932428800,-85725e4,-844552800,-828219600,-812584800,-798066e3,-781048800,-76671e4,-750895200,-733352400,-719452800,-70191e4,-689205600,-670453200,-114048e3,-103161600,-81993600,-71708400,-50544e3,-40258800,-18489600,-8204400,1296e4,23245200,43804800,54694800,75859200,86749200,102384e3,118112400,135734400,148525200,167191200,180496800,198640800,211946400,230090400,243396e3,26154e4,274845600,292989600,306295200,323316e3,338349600,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],offset:[3484,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Amsterdam":{
time:[-4260211200,-1693699200,-168048e4,-1663452e3,-1650142800,-1633212e3,-1617483600,-1601157600,-1586034e3,-1569708e3,-1554584400,-1538258400,-1523134800,-15075e5,-1490562e3,-1470175200,-1459112400,-1443996e3,-1427662800,-1406671200,-1396213200,-1376949600,-1364763600,-1345413600,-1333314e3,-1313791200,-1301259600,-1282255200,-126981e4,-1250719200,-1238360400,-1219183200,-1206910800,-1186956e3,-1175461200,-1156024800,-1143406800,-1124488800,-1111957200,-1092952800,-1080507600,-1061330400,-1049058e3,-1029189600,-1025740800,-1017608400,-998258400,-986158800,-966722400,-954104400,-935020800,-85725e4,-844552800,-828219600,-812498400,-79677e4,-781048800,-766616400,228880800,244004400,260330400,276058800,29178e4,307508400,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],offset:[1172,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,1172,4772,4800,1200,4800,1200,4800,1200,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Brussels":{
time:[-2840140800,-2450994150,-1740355200,-1693699200,-1680476400,-1663452e3,-1650142800,-1632002400,-1618693200,-1613822400,-1604278800,-1585526400,-1574038800,-1552262400,-1539997200,-1520553600,-1507510800,-1490572800,-1473642e3,-1459123200,-1444006800,-1427673600,-1411952400,-1396224e3,-1379293200,-1364774400,-1348448400,-1333324800,-1316394e3,-1301259600,-1284328800,-126981e4,-1253484e3,-1238360400,-1221429600,-1206910800,-1191189600,-1175461200,-1160344800,-1143406800,-1127685600,-1111957200,-1096840800,-1080507600,-1063576800,-1049058e3,-1033336800,-1017608400,-1002492e3,-986158800,-969228e3,-950475600,-942012e3,-934664400,-85725e4,-844552800,-828219600,-812498400,-798066e3,-781048800,-766616400,-745452e3,-733266e3,228880800,244004400,260330400,276058800,29178e4,307508400,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],offset:[1050,1050,0,3600,7200,3600,7200,3600,7200,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]},"Europe/Lisbon":{
time:[-1830386205,-1689555600,-1677798e3,-1667437200,-1647734400,-1635814800,-1616198400,-1604365200,-1584662400,-1572742800,-155304e4,-1541206800,-1521504e3,-1442451600,-1426809600,-1379293200,-1364774400,-1348448400,-1333324800,-1316394e3,-1301270400,-1284339600,-1269820800,-1221440400,-1206921600,-1191200400,-1175472e3,-1127696400,-1111968e3,-1096851600,-1080518400,-1063587600,-1049068800,-1033347600,-1017619200,-1002502800,-986169600,-969238800,-950486400,-942022800,-922665600,-906944400,-891129600,-877309200,-873680400,-864e6,-857952e3,-845859600,-842835600,-831340800,-825897600,-81441e4,-810781200,-799891200,-794448e3,-782960400,-779331600,-768441600,-762998400,-749091600,-733363200,-717631200,-701902800,-686181600,-670453200,-654732e3,-639003600,-623282400,-607554e3,-591832800,-575499600,-559778400,-54405e4,-528328800,-512600400,-496879200,-481150800,-465429600,-449701200,-43398e4,-417646800,-401925600,-386197200,-370476e3,-354747600,-339026400,-323298e3,-307576800,-291848400,-276127200,-260398800,-244677600,-228344400,-212623200,-196894800,-181173600,-165445200,-149724e3,-133995600,-118274400,212547600,228268800,243997200,260323200,276051600,291772800,307504800,323222400,338954400,354675600,370404e3,386125200,401853600,417578400,433303200,449024400,465357600,481078800,496807200,512528400,528256800,543978e3,559706400,575427600,591156e3,606877200,622605600,638326800,65466e4,670381200,686109600,701830800,717559200,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846381600,859683600,877831200,891133200,909280800,922582800,941335200,954032400,972784800,985482e3,1004234400,1017536400,1035684e3,1048986e3,1067133600,1080435600,1099188e3,1111885200,1130637600,1143334800,1162087200,1174784400,1193536800,1206838800,1224986400,1238288400,1256436e3,1269738e3,1288490400,1301187600,131994e4,1332637200,1351389600,1364691600,1382839200,1396141200,1414288800,1427590800,1445738400,1459040400,1477792800,149049e4,1509242400,1521939600,1540692e3,1553994e3,1572141600,1585443600,1603591200,1616893200,1635645600,1648342800,1667095200,1679792400,1698544800,1711846800,1729994400,1743296400,1761444e3,1774746e3,1792893600,1806195600,1824948e3,1837645200,1856397600,1869094800,1887847200,1901149200,1919296800,1932598800],offset:[-2205,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,7200,3600,0,3600,7200,3600,0,3600,7200,3600,0,3600,7200,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,3600,7200,3600,7200,3600,7200,3600,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0]},"Europe/Dublin":{
time:[-2821651200,-1691964e3,-1680469200,-1664143200,-1650142800,-1633903200,-1617483600,-1601848800,-1586034e3,-1570399200,-1552165200,-1538344800,-152253e4,-15075e5,-1490562e3,-1473631200,-1460926800,-1442786400,-1428872400,-1410732e3,-1396213200,-1379282400,-1364763600,-1348437600,-1333314e3,-1315778400,-1301259600,-1284328800,-126981e4,-1253484e3,-1238360400,-1221429600,-1206910800,-118998e4,-1175461200,-1159135200,-1143406800,-1126476e3,-1111957200,-1095631200,-1080507600,-1063576800,-1049058e3,-1032127200,-1017608400,-1001282400,-986158800,-969228e3,-950475600,-942012e3,-733352400,-719445600,-699483600,-684972e3,-668034e3,-654732e3,-636584400,-622072800,-605739600,-590623200,-57429e4,-558568800,-542235600,-527119200,-512600400,-496274400,-481150800,-46422e4,-449701200,-432165600,-417646800,-401320800,-386197200,-369266400,-354747600,-337816800,-323298e3,-306972e3,-291848400,-276732e3,-257979600,-245282400,-22653e4,-213228e3,-195080400,-182383200,-163630800,-150933600,-132181200,-119484e3,-100731600,-88034400,-68677200,-59004e3,57726e3,69818400,89175600,101268e3,120625200,132717600,152074800,164167200,183524400,196221600,214974e3,227671200,246423600,259120800,278478e3,290570400,309927600,32202e4,341377200,354675600,372823200,386125200,404272800,417574800,435722400,449024400,467776800,481078800,499226400,512528400,530676e3,543978e3,562125600,575427600,593575200,606877200,625629600,638326800,657079200,670381200,688528800,701830800,719978400,733280400,751428e3,76473e4,782877600,796179600,814327200,828234e3,846381600,859683600,877831200,891133200,909280800,922582800,941335200,954032400,972784800,985482e3,1004234400,1017536400,1035684e3,1048986e3,1067133600,1080435600,1099188e3,1111885200,1130637600,1143334800,1162087200,1174784400,1193536800,1206838800,1224986400,1238288400,1256436e3,1269738e3,1288490400,1301187600,131994e4,1332637200,1351389600,1364691600,1382839200,1396141200,1414288800,1427590800,1445738400,1459040400,1477792800,149049e4,1509242400,1521939600,1540692e3,1553994e3,1572141600,1585443600,1603591200,1616893200,1635645600,1648342800,1667095200,1679792400,1698544800,1711846800,1729994400,1743296400,1761444e3,1774746e3,1792893600,1806195600,1824948e3,1837645200,1856397600,1869094800,1887847200,1901149200,1919296800,1932598800],offset:[-1521,-1521,2079,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0,3600,0]},"Europe/Oslo":{
time:[-2366755200,-1691881200,-1680566400,-927507600,-85725e4,-844552800,-828219600,-812498400,-79677e4,-781048800,-765320400,-340840800,-324507600,-308786400,-293058e3,-277336800,-261608400,-245887200,-230158800,-214437600,-198709200,-182988e3,-166654800,-147909600,-135205200,323834400,338958e3,354679200,370407600,386128800,401857200,417578400,433306800,449028e3,465361200,481082400,496810800,512532e3,528260400,543981600,55971e4,575431200,591159600,606880800,622609200,638330400,654663600,670384800,686113200,701834400,717562800,733284e3,749012400,764733600,780462e3,796183200,811911600,828237600,846385200,859687200,877834800,891136800,909284400,922586400,941338800,954036e3,972788400,985485600,1004238e3,101754e4,1035687600,1048989600,1067137200,1080439200,1099191600,1111888800,1130641200,1143338400,1162090800,1174788e3,1193540400,1206842400,122499e4,1238292e3,1256439600,1269741600,1288494e3,1301191200,1319943600,1332640800,1351393200,1364695200,1382842800,1396144800,1414292400,1427594400,1445742e3,1459044e3,1477796400,1490493600,1509246e3,1521943200,1540695600,1553997600,1572145200,1585447200,1603594800,1616896800,1635649200,1648346400,1667098800,1679796e3,1698548400,1711850400,1729998e3,17433e5,1761447600,1774749600,1792897200,1806199200,1824951600,1837648800,1856401200,1869098400,1887850800,1901152800,1919300400,1932602400],offset:[2580,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600,7200,3600]}}},79581:(e,t,i)=>{"use strict";i.d(t,{getMinTick:()=>n,makeVariableMinTickData:()=>o,makePriceToPriceIndexConverter:()=>a,makePriceIndexToPriceConverter:()=>l});var s=i(960521),r=i(486028);function n(e){const{minTick:t,price:i,variableMinTickData:s,shouldCheckForEquality:r}=e;return void 0===s?t:function(e,t,i=!1){for(let s=0;s<t.length;s++){if(e<t[s].price)return t[s].minTick;if(i&&e===t[s].price)return t[s].minTick}return t[t.length-1].minTick}(i,s,r)}function o(e,t){var i,n,o,a,l;const c=t.split(" ").map(Number);if((0,r.isEven)(c.length)||c.some(Number.isNaN))return[{minTick:e,price:1/0,maxIndex:1/0}];const h=[];for(let e=0;e<c.length;e+=2){const t=null!==(i=c[e+1])&&void 0!==i?i:1/0,r=null!==(o=null===(n=h[h.length-1])||void 0===n?void 0:n.price)&&void 0!==o?o:0,d=null!==(l=null===(a=h[h.length-1])||void 0===a?void 0:a.maxIndex)&&void 0!==l?l:0,u=t===1/0?1/0:new s.Big(t).minus(r).div(c[e]).plus(d).toNumber();h.push({minTick:c[e],price:t,maxIndex:u})}return h}function a(e,t){return i=>{var r,n,o,a;if(!Number.isFinite(i))return NaN
;if(void 0===t)return new s.Big(i).div(e).round().toNumber();for(let e=0;e<t.length;e++){const{price:l,minTick:c}=t[e],h=null!==(n=null===(r=t[e-1])||void 0===r?void 0:r.price)&&void 0!==n?n:0,d=null!==(a=null===(o=t[e-1])||void 0===o?void 0:o.maxIndex)&&void 0!==a?a:0;if(i<l)return new s.Big(i).minus(h).div(c).plus(d).round().toNumber()}return NaN}}function l(e,t){return i=>{var r,n,o,a;if(!Number.isFinite(i))return NaN;if(void 0===t)return(0,s.Big)(i).mul(e).toNumber();for(let e=0;e<t.length;e++){const{maxIndex:l,minTick:c}=t[e],h=null!==(n=null===(r=t[e-1])||void 0===r?void 0:r.price)&&void 0!==n?n:0,d=null!==(a=null===(o=t[e-1])||void 0===o?void 0:o.maxIndex)&&void 0!==a?a:0;if(i<l)return new s.Big(i).minus(d).mul(c).plus(h).toNumber()}return NaN}}},550967:(e,t,i)=>{"use strict";i.d(t,{Version:()=>r});var s=i(650151);class r{constructor(e,t){this._major=e,this._minor=t}major(){return this._major}minor(){return this._minor}isZero(){return 0===this._major&&0===this._minor}toString(){return this._major+"."+this._minor}compareTo(e){return this._major<e._major?-1:this._major>e._major?1:this._minor<e._minor?-1:this._minor>e._minor?1:0}isLess(e){return this.compareTo(e)<0}isLessOrEqual(e){return this.compareTo(e)<=0}isEqual(e){return 0===this.compareTo(e)}isGreater(e){return this.compareTo(e)>0}isGreaterOrEqual(e){return this.compareTo(e)>=0}static parse(e){if(e instanceof r)return new r(e.major(),e.minor());if("number"==typeof e)return(0,s.assert)(Math.floor(e)===e,"Version should not be a float number"),new r(e,0);if("string"==typeof e){const t=e.split(".");if(1===t.length){const i=parseInt(t[0],10);return(0,s.assert)(!isNaN(i),"Bad version string: "+e),new r(i,0)}if(2===t.length){const i=parseInt(t[0],10);(0,s.assert)(!isNaN(i),"Bad version string: "+e);const n=parseInt(t[1],10);return(0,s.assert)(!isNaN(n),"Bad version string: "+e),new r(i,n)}throw new Error("Bad version string (one dot expected): "+e)}throw new Error("Bad version: "+e)}}r.ZERO=new r(0,0)},812813:(e,t,i)=>{"use strict";i.d(t,{WatchedObject:()=>a});var s=i(210596),r=i.n(s),n=i(486028);function o(e,t){return(0,n.deepEquals)(e,t)[0]}class a extends(r()){constructor(e,t=o){super(e),this._comparator=t}setValue(e,t){!1===this._comparator(this.value(),e)&&super.setValue(e,t)}}},210596:(e,t,i)=>{"use strict";e=i.nmd(e);var s=i(817808).getLogger("Common.WatchedValue");function r(){}function n(e){if(!(this instanceof n))return new n(e);arguments.length>0&&(this._value=e),this._listeners=[]}n.prototype.value=function(){return this._owner?this._owner._value:this._value},n.prototype.setValue=function(e,t){var i=this._owner?this._owner:this;if("function"==typeof i.hook&&(e=i.hook(e)),i.writeLock)return i._value;var r=i._value===e||Number.isNaN(i._value)&&Number.isNaN(e);if(!t&&r&&i.hasOwnProperty("_value"))return e;i._value=e;for(var n=i._listeners.slice(),o=0,a=0;a<n.length;a++){n[a].once&&(i._listeners.splice(a-o,1),o++);try{n[a].cb(e)}catch(e){s.logError(e.stack||e.message)}}return e},n.prototype.deleteValue=function(){var e=this._owner?this._owner:this
;if(e.hasOwnProperty("_value")){if(e.writeLock)return e._value;delete e._value;for(var t=e._listeners.slice(),i=0,r=0;r<t.length;r++){t[r].once&&(e._listeners.splice(r-i,1),i++);try{t[r].cb()}catch(e){s.logError(e.stack||e.message)}}}},n.prototype.subscribe=function(e,t){if("function"!=typeof e)throw new TypeError("callback must be a function");var i=!!t&&!!t.once,r=!!t&&!!t.callWithLast,n=this._owner?this._owner:this;if(r&&n.hasOwnProperty("_value")){try{e(n._value)}catch(e){s.logError(e.stack||e.message)}if(i)return}n._listeners.push({cb:e,owner:this,once:!!t&&!!t.once})},n.prototype.unsubscribe=function(e){var t=this._owner?this._owner:this;void 0===e&&(e=null);for(var i=t._listeners,s=i.length;s--;)i[s].owner!==this&&t!==this||i[s].cb!==e&&null!==e||i.splice(s,1)},n.prototype.listeners=function(){return(this._owner?this._owner:this)._listeners},n.prototype.readonly=function(){if(this._readonlyInstance)return this._readonlyInstance;var e=this._readonlyInstance=new r;return e.subscribe=this.subscribe.bind(this),e.unsubscribe=this.unsubscribe.bind(this),e.value=this.value.bind(this),e.when=this.when.bind(this),e.spawn=function(){return this.spawn.apply(this,arguments).readonly()}.bind(this),this.destroy&&(e.destroy=this.destroy.bind(this)),e},n.prototype.spawn=function(e){var t=new n;return delete t._listeners,t._owner=this._owner||this,t.destroy=function(){if("function"==typeof e)try{e()}catch(e){s.logError(e.stack||e.message)}this.unsubscribe(),delete this._owner},t},n.prototype.when=function(e){var t=this;if(this.value())try{e()}catch(e){s.logError(e.stack||e.message)}else{var i=function(s){s&&(t.unsubscribe(i),e())};t.subscribe(i)}},n.prototype.opposite=function(){if(!this._opposite){var e=this,t=new n(!this.value());this.subscribe((function(e){t.setValue(!e)})),t.subscribe((function(t){e.setValue(!t)})),this._opposite=t}return this._opposite},"undefined"!=typeof window&&(window.WatchedValue=n),e&&e.exports&&(e.exports=n)},703302:(e,t,i)=>{"use strict";i.d(t,{TOOLBAR_WIDTH_EXPANDED:()=>s,TOOLBAR_WIDTH_COLLAPSED:()=>r});const s=52,r=5},331621:(e,t,i)=>{"use strict";i.d(t,{DrawingToolbarBootloader:()=>a});var s=i(584052),r=i(703302),n=i(181370),o=i(939535);class a extends n.ChunkLoader{constructor(e){super(),this._opts=e,s.isDrawingToolbarVisible.value()&&(this._opts.resizerBridge.negotiateWidth(r.TOOLBAR_WIDTH_EXPANDED),this._opts.resizerBridge.container.value().appendChild((0,o.createStubElem)()))}_startLoading(){return Promise.all([i.e(4782),i.e(7624),i.e(8230),i.e(9333),i.e(6092),i.e(4412),i.e(8251),i.e(6879),i.e(6880),i.e(3626),i.e(3305),i.e(962),i.e(9255),i.e(37),i.e(412),i.e(1890),i.e(6181),i.e(2878)]).then(i.bind(i,963191)).then((e=>new e.DrawingToolbarRenderer(this._opts.resizerBridge.container.value(),{...this._opts})))}}},584052:(e,t,i)=>{"use strict";i.d(t,{isDrawingToolbarVisible:()=>c});var s=i(870122),r=i(484727),n=i(210596),o=i.n(n);const a=!r.enabled("hide_left_toolbar_by_default"),l=s.getBool("ChartDrawingToolbarWidget.visible",a),c=new(o())(l)},692932:(e,t,i)=>{"use strict";i.d(t,{
HeaderToolbarBootloader:()=>o});var s=i(887905),r=i(939535),n=i(181370);class o extends n.ChunkLoader{constructor(e,t){super(),this._toolsBootloader=e,this._headerProps=t,this._headerProps.resizerBridge.negotiateHeight(s.HEADER_TOOLBAR_HEIGHT_EXPANDED),this._headerProps.resizerBridge.container.value().appendChild((0,r.createStubElem)())}_startLoading(){return Promise.all([this._toolsBootloader.load(),this._loadHeaderToolbar()]).then((([e,t])=>new t(this._headerProps.resizerBridge.container.value(),{...this._headerProps,tools:e})))}_loadHeaderToolbar(){return Promise.all([i.e(8955),i.e(8110),i.e(962),i.e(9255),i.e(3005)]).then(i.bind(i,35832)).then((e=>e.HeaderToolbarRenderer))}}},887905:(e,t,i)=>{"use strict";i.d(t,{HEADER_TOOLBAR_HEIGHT_EXPANDED:()=>r,HEADER_TOOLBAR_HEIGHT_COLLAPSED:()=>n});var s=i(568515);const r=parseInt(s["css-value-header-toolbar-height"]),n=3},231392:(e,t,i)=>{"use strict";i.d(t,{RestrictedToolsetBootloader:()=>r});var s=i(181370);class r extends s.ChunkLoader{_startLoading(){return Promise.all([i.e(1263),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(8825),i.e(105),i.e(1140),i.e(8009),i.e(3795),i.e(4412),i.e(8819),i.e(7507),i.e(537),i.e(1033),i.e(9776),i.e(3626),i.e(3704),i.e(7417),i.e(962),i.e(4104),i.e(412),i.e(5516)]).then(i.bind(i,773434)).then((e=>e.getRestrictedToolSet()))}}},580458:(e,t,i)=>{"use strict";i.d(t,{FavoriteStudyTemplateService:()=>r});var s=i(271552);class r extends s.CommonJsonStoreService{constructor(e,t){super(e,t,"FAVORITE_STUDY_TEMPLATES_CHANGED","StudyTemplates.quicks",[])}remove(e){this.set(this.get().filter((t=>t!==e)))}}},369472:(e,t,i)=>{"use strict";i.d(t,{DropdownApi:()=>s});class s{constructor(e,t){this._headerToolbar=e,this._dropdownId=t}applyOptions(e){this._headerToolbar.updateDropdown(this._dropdownId,e)}remove(){this._headerToolbar.removeDropdown(this._dropdownId)}}},890255:(e,t,i)=>{"use strict";var s;i.d(t,{ACTION_ID:()=>s}),function(e){e.TVActionId="TVActionId",e.ChartApplyIndicatorsToAllCharts="Chart.ApplyIndicatorsToAllCharts",e.ChartChangeTimeZone="Chart.ChangeTimeZone",e.ChartDialogsShowChangeInterval="Chart.Dialogs.ShowChangeInterval",e.ChartDialogsShowChangeSymbol="Chart.Dialogs.ShowChangeSymbol",e.ChartDialogsShowCompareOrAddSymbol="Chart.Dialogs.ShowCompareOrAddSymbol",e.ChartDialogsShowGeneralSettings="Chart.Dialogs.ShowGeneralSettings",e.ChartDialogsShowGeneralSettingsSymbolTab="Chart.Dialogs.ShowGeneralSettings.SymbolTab",e.ChartDialogsShowGoToDate="Chart.Dialogs.ShowGoToDate",e.ChartDialogsShowInsertIndicators="Chart.Dialogs.ShowInsertIndicators",e.ChartDialogsShowSymbolInfo="Chart.Dialogs.ShowSymbolInfo",e.ChartDrawingToolbarToggleVisibility="Chart.DrawingToolbar.ToggleVisibility",e.ChartLinesToggleBidAskLinesVisibility="Chart.Lines.ToggleBidAskLinesVisibility",e.ChartLinesToggleHighLowLinesVisibility="Chart.Lines.ToggleHighLowLinesVisibility",e.ChartLinesToggleAverageLineVisibility="Chart.Lines.ToggleAverageLineVisibility",e.ChartLinesToggleSeriesPrevCloseLineVisibility="Chart.Lines.ToggleSeriesPrevCloseLineVisibility",
e.ChartLinesToggleSeriesPriceLineVisibility="Chart.Lines.ToggleSeriesPriceLineVisibility",e.ChartLineToolPitchforkChangeTypeToInside="Chart.LineTool.Pitchfork.ChangeTypeToInside",e.ChartLineToolPitchforkChangeTypeToModifiedSchiff="Chart.LineTool.Pitchfork.ChangeTypeToModifiedSchiff",e.ChartLineToolPitchforkChangeTypeToOriginal="Chart.LineTool.Pitchfork.ChangeTypeToOriginal",e.ChartLineToolPitchforkChangeTypeToSchiff="Chart.LineTool.Pitchfork.ChangeTypeToSchiff",e.ChartMarksToggleVisibility="Chart.Marks.ToggleVisibility",e.ChartMoveChartInLayout="Chart.MoveChartInLayout",e.ChartMoveChartInLayoutBack="Chart.MoveChartInLayout.Back",e.ChartMoveChartInLayoutForward="Chart.MoveChartInLayout.Forward",e.ChartObjectTreeShow="Chart.ObjectTree.Show",e.ChartPriceScaleLabelsToggleBidAskLabelsVisibility="Chart.PriceScale.Labels.ToggleBidAskLabelsVisibility",e.ChartPriceScaleLabelsToggleHighLowPriceLabelsVisibility="Chart.PriceScale.Labels.ToggleHighLowPriceLabelsVisibility",e.ChartPriceScaleLabelsToggleAveragePriceLabelVisibility="Chart.PriceScale.Labels.ToggleAveragePriceLabelVisibility",e.ChartPriceScaleLabelsToggleIndicatorsNameLabelsVisibility="Chart.PriceScale.Labels.ToggleIndicatorsNameLabelsVisibility",e.ChartPriceScaleLabelsToggleIndicatorsValueLabelsVisibility="Chart.PriceScale.Labels.ToggleIndicatorsValueLabelsVisibility",e.ChartPriceScaleLabelsToggleSeriesLastValueVisibility="Chart.PriceScale.Labels.ToggleSeriesLastValueVisibility",e.ChartPriceScaleLabelsToggleSymbolNameLabelsVisibility="Chart.PriceScale.Labels.ToggleSymbolNameLabelsVisibility",e.ChartPriceScaleLabelsToggleSymbolPrevCloseValueVisibility="Chart.PriceScale.Labels.ToggleSymbolPrevCloseValueVisibility",e.ChartPriceScaleMergeAllScalesToLeft="Chart.PriceScale.MergeAllScalesToLeft",e.ChartPriceScaleMergeAllScalesToRight="Chart.PriceScale.MergeAllScalesToRight",e.ChartPriceScaleMoveToLeft="Chart.PriceScale.MoveToLeft",e.ChartPriceScaleMoveToRight="Chart.PriceScale.MoveToRight",e.ChartPriceScaleToggleAddOrderPlusButtonVisibility="Chart.PriceScale.ToggleAddOrderPlusButtonVisibility",e.ChartPriceScaleToggleAutoScaleSeriesOnly="Chart.PriceScale.ToggleAutoScaleSeriesOnly",e.ChartPriceScaleToggleCountdownToBarCloseVisibility="Chart.PriceScale.ToggleCountdownToBarCloseVisibility",e.ChartRedo="Chart.Redo",e.ChartRemoveAllIndicators="Chart.RemoveAllIndicators",e.ChartRemoveAllIndicatorsAndLineTools="Chart.RemoveAllIndicatorsAndLineTools",e.ChartRemoveAllLineTools="Chart.RemoveAllLineTools",e.ChartScalesReset="Chart.Scales.Reset",e.ChartScalesToggleLockPriceToBarRatio="Chart.Scales.ToggleLockPriceToBarRatio",e.ChartSelectedObjectHide="Chart.SelectedObject.Hide",e.ChartSelectedObjectRemove="Chart.SelectedObject.Remove",e.ChartSelectedObjectShowSettingsDialog="Chart.SelectedObject.ShowSettingsDialog",e.ChartSelectedObjectToggleLocked="Chart.SelectedObject.ToggleLocked",e.ChartSeriesPriceScaleToggleAutoScale="Chart.Series.PriceScale.ToggleAutoScale",e.ChartSeriesPriceScaleToggleIndexedTo100="Chart.Series.PriceScale.ToggleIndexedTo100",
e.ChartSeriesPriceScaleToggleInvertPriceScale="Chart.Series.PriceScale.ToggleInvertPriceScale",e.ChartSeriesPriceScaleToggleLogarithmic="Chart.Series.PriceScale.ToggleLogarithmic",e.ChartSeriesPriceScaleTogglePercentage="Chart.Series.PriceScale.TogglePercentage",e.ChartSeriesPriceScaleToggleRegular="Chart.Series.PriceScale.ToggleRegular",e.ChartSessionBreaksToggleVisibility="Chart.SessionBreaks.ToggleVisibility",e.ChartTimeScaleReset="Chart.TimeScale.Reset",e.ChartUndo="Chart.Undo",e.ChartSourceIntervalsVisibility="Chart.Source.IntervalsVisibility",e.ChartSourceIntervalsVisibilityCurrentAndAbove="Chart.Source.IntervalsVisibility.CurrentAndAbove",e.ChartSourceIntervalsVisibilityCurrentAndBelow="Chart.Source.IntervalsVisibility.CurrentAndBelow",e.ChartSourceIntervalsVisibilityOnlyCurrent="Chart.Source.IntervalsVisibility.Current",e.ChartSourceIntervalsVisibilityAll="Chart.Source.IntervalsVisibility.All"}(s||(s={}))},710567:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Action:()=>l,ActionAsync:()=>c,Separator:()=>h,Loader:()=>d});var s=i(650151),r=i(922157),n=i.n(r),o=i(180185),a=i(220863);class l{constructor(e,t=a.guid()){this.type="action",this._destroyed=!1,this._binding=null,(0,s.assert)(void 0!==e.actionId,"actionId must be defined"),this.id=t,this._onUpdate=new(n()),this._options=e,this.update(e)}execute(){this._options.checkable&&this.update({checked:!this._options.checked}),this._options.onExecute&&this._options.onExecute(this)}getLabel(){return this._options.label||""}getSubItems(){return this._options.subItems||[]}isDisabled(){return!0===this._options.disabled}isActive(){return!0===this._options.active}isCheckable(){return!0===this._options.checkable}isChecked(){return!0===this._options.checked}isLoading(){return!0===this._options.loading}getSize(){var e;return null!==(e=this._options.size)&&void 0!==e?e:"normal"}getPayload(){return this._options.payload}update(e){this._destroyed||(this._unbindShortcut(),e.hotkeyHash&&(this._options.shortcutHint=(0,o.humanReadableHash)(e.hotkeyHash)),this._options=Object.assign(this._options,e),this._bindShortcut(),this._onUpdate.fire(this))}onUpdate(){return this._onUpdate}getState(){return{actionId:this._options.actionId,label:this.getLabel(),disabled:this.isDisabled(),active:this.isActive(),subItems:this.getSubItems(),checkable:this.isCheckable(),checked:this.isChecked(),loading:this.isLoading(),size:this.getSize(),doNotCloseOnClick:this._options.doNotCloseOnClick||!1,shortcutHint:this._options.shortcutHint,hint:this._options.hint,icon:this._options.icon,iconChecked:this._options.iconChecked,toolbox:this._options.toolbox,showToolboxOnHover:this._options.showToolboxOnHover||!1,statName:this._options.statName,name:this._options.name,invisibleHotkey:this._options.invisibleHotkey,noInteractive:this._options.noInteractive}}getBinding(){return this._binding}setBinding(e){this._binding=e}destroy(){var e,t;this._destroyed=!0,this._onUpdate.destroy(),null!==this._binding&&this._binding.destroy(),this._unbindShortcut(),null===(t=(e=this._options).onDestroy)||void 0===t||t.call(e)}options(){
return this._options}_bindShortcut(){if(!this._options.hotkeyGroup||!this._options.hotkeyHash)return;const e="string"==typeof this._options.label?this._options.label:this._options.name;this._hotkeyAction=this._options.hotkeyGroup.add({hotkey:this._options.hotkeyHash,desc:e,handler:()=>this.execute(),isDisabled:()=>this.isDisabled()})}_unbindShortcut(){this._hotkeyAction&&(this._hotkeyAction.destroy(),delete this._hotkeyAction)}}class c extends l{constructor(e,t,i){super({actionId:e},i),this._loader=t,this._loaded=!1}loadOptions(){return this._loadingPromise||(this._loadingPromise=this._loader().then((e=>{this._loaded=!0,this.update(e)}))),this._loadingPromise}getState(){return this.loadOptions(),super.getState()}isLoading(){return!this.isLoaded()}isLoaded(){return this._loaded}}class h{constructor(e){this.type="separator",this.id=a.guid(),this._hint=e}getHint(){return this._hint}}class d extends l{constructor(e){super({actionId:e})}isLoading(){return!0}getSize(){return"big"}}},412905:(e,t,i)=>{"use strict";i.d(t,{defaultContextMenuOptions:()=>it,createActionTrade:()=>st,createPasteAction:()=>rt,createVisualOrderAction:()=>nt,createChangeIntervalsVisibilitiesAction:()=>ot,createActionCopyPrice:()=>at,createMTPredictorActions:()=>lt,createLinesAction:()=>ct,createSyncDrawingActions:()=>ht,ActionsProvider:()=>dt});var s=i(650151),r=i(817808),n=i(960521),o=i(486028),a=i(509806),l=i(484727),c=i(710567),h=i(72588),d=i(16397),u=i(663890),p=(i(577535),i(554511)),_=i(139352),m=i(140641),g=i(808510),f=i(510986),v=i(991444),S=i(564571),y=i(180185),b=i(76821),w=i(675786),P=i(57730),C=(i(632054),i(979322)),T=i(127958),x=i(232468),I=i(296055),M=i(21218),L=i(440097),A=i(358076),k=i(638273),E=i(224778),D=i(976052);const B=(0,r.getLogger)("Chart.ActionsProvider"),V=(new L.TranslatedString("show alert label lines",a.t(null,void 0,i(916237))),new L.TranslatedString("hide alert label lines",a.t(null,void 0,i(491842))),new L.TranslatedString("change visibility",a.t(null,void 0,i(521511)))),R=new L.TranslatedString("pin to scale {label}",a.t(null,void 0,i(156015))),N=new L.TranslatedString("pin to right scale",a.t(null,void 0,i(22615))),O=new L.TranslatedString("pin to left scale",a.t(null,void 0,i(84018))),F=(new L.TranslatedString("change earnings visibility",a.t(null,void 0,i(88217))),new L.TranslatedString("change dividends visibility",a.t(null,void 0,i(184944))),new L.TranslatedString("change splits visibility",a.t(null,void 0,i(374488))),new L.TranslatedString("change continuous contract switch visibility",a.t(null,void 0,i(407017))),new L.TranslatedString("change futures contract expiration visibility",a.t(null,void 0,i(628288))),new L.TranslatedString("change latest news visibility",a.t(null,void 0,i(77578))),new L.TranslatedString("show all ideas",a.t(null,void 0,i(813622)))),W=new L.TranslatedString("show ideas of followed users",a.t(null,void 0,i(826267))),z=new L.TranslatedString("show my ideas only",a.t(null,void 0,i(740061))),H=(new L.TranslatedString("change events visibility on chart",a.t(null,void 0,i(979574))),
new L.TranslatedString("add this symbol to entire layout",a.t(null,void 0,i(527982)))),U=new L.TranslatedString("add this indicator to entire layout",a.t(null,void 0,i(182388))),j=(new L.TranslatedString("add this strategy to entire layout",a.t(null,void 0,i(894292))),new L.TranslatedString("add this financial metric to entire layout",a.t(null,void 0,i(422856))),new L.TranslatedString("apply drawing template",a.t(null,void 0,i(349037)))),G=new L.TranslatedString("lock objects",a.t(null,void 0,i(168163))),q=new L.TranslatedString("unlock objects",a.t(null,void 0,i(766824))),$=new L.TranslatedString("change visibility at current interval and above",a.t(null,void 0,i(678422))),Y=new L.TranslatedString("change visibility at current interval and below",a.t(null,void 0,i(249529))),K=new L.TranslatedString("change visibility at current interval",a.t(null,void 0,i(416698))),Z=new L.TranslatedString("change visibility at all intervals",a.t(null,void 0,i(666927))),X=(a.t(null,void 0,i(108700)),a.t(null,void 0,i(690830)),a.t(null,void 0,i(364885)),(0,M.appendEllipsis)(a.t(null,void 0,i(893512)))),J=(a.t(null,void 0,i(727558)),a.t(null,void 0,i(287085))),Q=(0,M.appendEllipsis)(a.t(null,void 0,i(952302))),ee=a.t(null,void 0,i(581428)),te=a.t(null,void 0,i(831971)),ie=(a.t(null,void 0,i(311156)),a.t(null,void 0,i(615682)),a.t(null,void 0,i(266631)),a.t(null,void 0,i(737422)),a.t(null,void 0,i(805716)),a.t(null,void 0,i(650352)),a.t(null,void 0,i(819263)),a.t(null,void 0,i(615818)),a.t(null,void 0,i(705897)),a.t(null,void 0,i(958976)),a.t(null,void 0,i(611661)),a.t(null,void 0,i(466560)),a.t(null,void 0,i(953958)),a.t(null,void 0,i(734150)),a.t(null,void 0,i(783927)),a.t(null,void 0,i(315644)),a.t(null,void 0,i(442660)),a.t(null,void 0,i(844788)),a.t(null,void 0,i(770437)),a.t(null,void 0,i(571263)),a.t(null,void 0,i(370573)),a.t(null,void 0,i(259560)),a.t(null,void 0,i(514125))),se=a.t(null,void 0,i(444538)),re=a.t(null,void 0,i(556948)),ne=a.t(null,void 0,i(920207)),oe=a.t(null,void 0,i(665810)),ae=a.t(null,void 0,i(603822)),le=a.t(null,void 0,i(697324)),ce=a.t(null,void 0,i(500764)),he=a.t(null,void 0,i(708128)),de=a.t(null,void 0,i(361201)),ue=a.t(null,void 0,i(832156)),pe=a.t(null,void 0,i(591130)),_e=a.t(null,void 0,i(737680)),me=a.t(null,void 0,i(243707)),ge=a.t(null,void 0,i(739065)),fe=a.t(null,void 0,i(454727)),ve=a.t(null,void 0,i(366156)),Se=a.t(null,void 0,i(976598)),ye=a.t(null,void 0,i(203485)),be=a.t(null,void 0,i(745828)),we=a.t(null,void 0,i(702899)),Pe=a.t(null,void 0,i(640887)),Ce=a.t(null,void 0,i(753387)),Te=a.t(null,void 0,i(796712)),xe=a.t(null,void 0,i(126354)),Ie=a.t(null,void 0,i(219796)),Me=a.t(null,void 0,i(559901)),Le=a.t(null,void 0,i(223221)),Ae=a.t(null,void 0,i(422198)),ke=a.t(null,void 0,i(127557)),Ee=a.t(null,void 0,i(598486)),De=a.t(null,void 0,i(973106)),Be=a.t(null,void 0,i(85964)),Ve=a.t(null,void 0,i(559192)),Re=a.t(null,void 0,i(583182)),Ne=((0,M.appendEllipsis)(a.t(null,void 0,i(592206))),(0,M.appendEllipsis)(a.t(null,void 0,i(303612))),(0,
M.appendEllipsis)(a.t(null,void 0,i(389517)))),Oe=a.t(null,void 0,i(813345)),Fe=(0,M.appendEllipsis)(a.t(null,void 0,i(309908))),We=a.t(null,void 0,i(35216)),ze=a.t(null,void 0,i(552977)),He=a.t(null,void 0,i(419611)),Ue=a.t(null,void 0,i(738342)),je=a.t(null,void 0,i(715101)),Ge=a.t(null,void 0,i(642284)),qe=(a.t(null,void 0,i(246771)),a.t(null,void 0,i(966263)),a.t(null,void 0,i(830816)),a.t(null,void 0,i(124620)),a.t(null,void 0,i(484813)),a.t(null,void 0,i(430709)),a.t(null,void 0,i(748284))),$e=a.t(null,void 0,i(487933)),Ye=a.t(null,void 0,i(258669)),Ke=((0,M.appendEllipsis)(a.t(null,void 0,i(389517))),a.t(null,void 0,i(308251)),a.t(null,void 0,i(34059))),Ze=a.t(null,void 0,i(364288)),Xe=(a.t(null,void 0,i(777920)),a.t(null,void 0,i(575669)),a.t(null,void 0,i(608886))),Je=a.t(null,void 0,i(618008)),Qe=(a.t(null,void 0,i(733606)),(0,M.appendEllipsis)(a.t(null,void 0,i(665986)))),et=a.t(null,void 0,i(729682)),tt=a.t(null,void 0,i(28851)),it={general:!0,mainSeries:!0,mainSeriesTrade:!1,esdStudies:!0,studies:!0,fundamentals:!0,lineTools:!0,publishedCharts:!0,ordersAndPositions:!0,alerts:!0,chartEvents:!0,objectTree:!0,gotoLineTool:!1};function st(e,t,i){if(e.model().isInReplay())return null;const s=e.model().mainSeries();return s.isConvertedToOtherCurrency()||s.isConvertedToOtherUnit()?null:new c.ActionAsync("Trading.TradeFromChart",(()=>{const t=new Promise(((t,s)=>{const r=(0,m.tradingService)();if(null===r||0===r.brokersList().length)return void t({label:J,disabled:!0});const n=e.model().mainSeries();let o;i&&(o=i.localY),(0,g.createTradeContext)(n,o).then((e=>{try{return r.chartContextMenuActions(e)}catch(e){return B.logError(e.message),[]}})).then((e=>{0!==e.length?t({name:"trade",label:J,subItems:e,statName:"Trading"}):t({label:J,disabled:!0})})).catch((()=>{s("Unable to get Trade Context")}))}));return(0,f.makeTimeLimited)(t,5e3,"Action trade not received")}))}function rt(e,t){return!t.isEmpty()&&l.enabled("datasource_copypaste")?new c.Action({actionId:"Chart.Clipboard.PasteSource",label:et.trim(),shortcutHint:(0,y.humanReadableHash)(y.Modifiers.Mod+86),statName:"Paste",onExecute:()=>e.chartWidgetCollection().clipboard.uiRequestPaste(t)}):null}function nt(e,t){const s=e.model(),r=s.availableZOrderOperations(t),n=[new c.Action({actionId:"Chart.Source.VisualOrder.BringToFront",label:xe,statName:"BringToFront",disabled:!r.bringToFrontEnabled,onExecute:()=>s.bringToFront(t)}),new c.Action({actionId:"Chart.Source.VisualOrder.SendToBack",label:Ie,statName:"SendToBack",disabled:!r.sendToBackEnabled,onExecute:()=>s.sendToBack(t)}),new c.Action({actionId:"Chart.Source.VisualOrder.BringForward",label:Me,statName:"BringForward",disabled:!r.bringForwardEnabled,onExecute:()=>s.bringForward(t)}),new c.Action({actionId:"Chart.Source.VisualOrder.SendBackward",label:Le,statName:"SendBackward",disabled:!r.sendBackwardEnabled,onExecute:()=>s.sendBackward(t)})];return new c.Action({actionId:"Chart.Source.VisualOrder",label:Ae,icon:i(677067),statName:"VisualOrder",subItems:n})}function ot(e,t){const i=e.model(),s=(e,s)=>{
const r=k.Interval.parse(i.mainSeries().interval()),n=(0,E.getIntervalsVisibilitiesForMode)(r,e),o=[],a=[];t.forEach((e=>{const t=e.properties().intervalsVisibilities.childs();o.push(t.ticks),a.push(n.ticks),o.push(t.seconds),a.push(n.seconds),o.push(t.secondsFrom),a.push(n.secondsFrom),o.push(t.secondsTo),a.push(n.secondsTo),o.push(t.minutes),a.push(n.minutes),o.push(t.minutesFrom),a.push(n.minutesFrom),o.push(t.minutesTo),a.push(n.minutesTo),o.push(t.hours),a.push(n.hours),o.push(t.hoursFrom),a.push(n.hoursFrom),o.push(t.hoursTo),a.push(n.hoursTo),o.push(t.days),a.push(n.days),o.push(t.daysFrom),a.push(n.daysFrom),o.push(t.daysTo),a.push(n.daysTo),o.push(t.weeks),a.push(n.weeks),o.push(t.weeksFrom),a.push(n.weeksFrom),o.push(t.weeksTo),a.push(n.weeksTo),o.push(t.months),a.push(n.months),o.push(t.monthsFrom),a.push(n.monthsFrom),o.push(t.monthsTo),a.push(n.monthsTo),o.push(t.ranges),a.push(n.ranges)})),i.setProperties(o,a,s)},r=[new c.Action({actionId:"Chart.Source.IntervalsVisibility.CurrentAndAbove",label:Ee,statName:"currentAndAboveIntervals",onExecute:()=>s(3,$)}),new c.Action({actionId:"Chart.Source.IntervalsVisibility.CurrentAndBelow",label:De,statName:"currentAndBelowIntervals",onExecute:()=>s(2,Y)}),new c.Action({actionId:"Chart.Source.IntervalsVisibility.Current",label:Be,statName:"currentInterval",onExecute:()=>s(1,K)}),new c.Action({actionId:"Chart.Source.IntervalsVisibility.All",label:Ve,statName:"allIntervals",onExecute:()=>s(0,Z)})];return new c.Action({actionId:"Chart.Source.IntervalsVisibility",label:ke,statName:"IntervalsVisibility",subItems:r})}function at(e,t){var i,s,r;const n=e.defaultPriceScale(),o=void 0!==t?n.coordinateToPrice(t,null!==(s=null===(i=e.mainDataSource())||void 0===i?void 0:i.firstValue())&&void 0!==s?s:0):e.model().mainSeries().lastValueData(4,!0,!0).price,a=null===(r=e.mainDataSource())||void 0===r?void 0:r.formatter();if(void 0===o||!a)return null;const l=a.format(o);return new c.Action({actionId:"Chart.Clipboard.CopyPrice",label:`${tt} (${l})`,statName:"CopyPrice",onExecute:()=>(0,D.getClipboard)().writeText(l)})}function lt(e,t,i,s){return null}function ct(e){const t=e.actions(),i=[t.showPriceLine];return i.push(t.showSeriesPrevCloseLine),i.push(t.showHighLowPriceLines),l.enabled("show_average_close_price_line_and_label")&&i.push(t.showAverageClosePriceLine),e.model().model().hasCustomSource("bidask")&&i.push(t.showBidAskLines),new c.Action({actionId:"Chart.Lines",label:Re,statName:"Lines",subItems:i})}function ht(e,t){const i=[];{if(A.isToolCreatingNow.value())return i;const s=()=>{var t;return null!==(t=e.chartWidgetCollection().activeChartWidget.value())&&void 0!==t?t:e},r=()=>t.some((e=>e.isSynchronizable()));if(l.enabled("support_multicharts")&&e.isMultipleLayout()){if(!r())return i;const e=t.every((e=>!!e.linkKey().value()));i.push(new c.Separator,new c.Action({actionId:"Chart.LineTool.NoSync",label:Xe,statName:"NoSyncDrawing",checkable:!0,checked:!e,onExecute:e=>{e.isChecked()&&s().unlinkSelectedLine()}}),new c.Action({actionId:"Chart.LineTool.SyncInLayout",label:Je,
statName:"SyncDrawingInLayout",checkable:!0,checked:e,onExecute:e=>{e.isChecked()&&s().copyLineToOtherCharts()}}))}}return i}class dt{constructor(e,t){this._chartWidget=e,this._options=(0,o.merge)((0,o.clone)(it),t||{})}async contextMenuActionsForSources(e,t,i){const s=e[0],r=this._options;if(s===this._chartWidget.model().mainSeries()&&r.mainSeries)return this._contextMenuActionsForSeries(s,t);if((0,u.isStudy)(s)&&r.studies)return this._contextMenuActionsForStudy(s);if((s instanceof v.LineToolOrder||s instanceof S.LineToolPosition)&&r.ordersAndPositions)return this._contextMenuActionsForTradingDrawings(s);if((0,x.isLineTool)(s)&&r.lineTools){const t=e.filter(x.isLineTool);return this._contextMenuActionsForLineTool(t)}return[]}_isReadOnly(){return this._chartWidget.readOnly()}_createActionHide(e){return new c.Action({actionId:"Chart.SelectedObject.Hide",label:te,icon:i(484959),statName:"HideSelectedObject",onExecute:this._chartWidget.hideDataSources.bind(this._chartWidget,[e])})}_createActionShow(e){const t=new c.Action({actionId:"Chart.SelectedObject.Show",checkable:!0,label:ee,icon:i(416911),statName:"ToggleShow"}),s=new h.ActionBinder(t,e.properties().visible,this._chartWidget.model(),V);return t.setBinding(s),s.setValue(e.properties().visible.value()),t}_createActionScale(e){const t=(0,s.ensureNotNull)(e.priceScale()),r=this._chartWidget.model().model(),n=(0,s.ensureNotNull)(r.paneForSource(e)),o=n.priceScalePosition(t),a=("left"===o?n.leftPriceScales():n.rightPriceScales()).indexOf(t),l=r.priceScaleSlotsCount().totallySlots<2?"dontneedname":"needname",h="overlay"===o?"":(0,d.getPriceAxisNameInfo)(o,a).label,u=ge.format({label:h}),p={"left-needname":u,"left-dontneedname":ve,"right-needname":u,"right-dontneedname":Se,"overlay-needname":fe,"overlay-dontneedname":fe}[o+"-"+l];return new c.Action({actionId:"Chart.Source.ChangePriceScale",label:p,icon:i(225191),subItems:this._createActionScaleItems(e)})}_createActionScaleDetach(e,t,i,r){const n=this._chartWidget.model().model(),o=(0,s.ensureNotNull)(n.paneForSource(e));if(!o.canCreateNewPriceScale())return null;const a=(0,s.ensureNotNull)(e.priceScale()),l=a.canDetachSource(e),h=o.priceScalePosition(a),u=l||h!==t;if(!u)return null;const p=n.priceScaleSlotsCount(),_={left:{labelled:le,sided:_e},right:{labelled:le,sided:me}},m="left"===t?o.leftPriceScales().length:o.rightPriceScales().length,g=p[t]>m?"labelled":"sided",f=(0,d.getPriceAxisNameInfo)(t,m).label,v=_[t][g].format({label:f});return new c.Action({actionId:"Chart.Source.ChangePriceScale",checkable:!1,disabled:!u,label:v,statName:r,payload:e,onExecute:i})}_onDetachLeft(e){const t=e.getPayload(),i=this._chartWidget.model().model(),r=(0,s.ensureNotNull)(i.paneForSource(t));this._chartWidget.model().detachToLeft(t,r)}_onDetachRight(e){const t=e.getPayload(),i=this._chartWidget.model().model(),r=(0,s.ensureNotNull)(i.paneForSource(t));this._chartWidget.model().detachToRight(t,r)}_createActionScaleDetachLeft(e){return this._createActionScaleDetach(e,"left",this._onDetachLeft.bind(this),"ToggleScaleLeft")}
_createActionScaleDetachRight(e){return this._createActionScaleDetach(e,"right",this._onDetachRight.bind(this),"ToggleScaleRight")}_onMoveToScale(e){const t=e.getPayload();if(t.datasource.priceScale()===t.priceScale)return;const i=this._chartWidget.model().model(),r=(0,s.ensureNotNull)(i.paneForSource(t.datasource));this._chartWidget.model().moveToScale(t.datasource,r,t.priceScale,t.undoText)}_createMoveToScaleAction(e,t,i,s){const r=e.priceScale()===t;return new c.Action({actionId:"Chart.Source.MoveToOtherScale",checkable:!0,checked:r,label:i,statName:"ToggleScale",payload:{datasource:e,priceScale:t,undoText:s},onExecute:this._onMoveToScale.bind(this)})}_onNoScale(e){const t=e.getPayload().datasource,i=this._chartWidget.model().model(),r=(0,s.ensureNotNull)(i.paneForSource(t));r.isOverlay(t)||this._chartWidget.model().detachNoScale(t,r)}_createActionNoScale(e){const t=this._chartWidget.model().model(),i=(0,s.ensureNotNull)(t.paneForSource(e)),r=i.actionNoScaleIsEnabled(e);return new c.Action({actionId:"Chart.Source.MoveToNoScale",checkable:!0,checked:i.isOverlay(e),label:ye,disabled:!r,statName:"ToggleNoScale",payload:{datasource:e},onExecute:this._onNoScale.bind(this)})}_createActionScaleItems(e){const t=[],i=this._chartWidget.model().model(),r=(0,s.ensureNotNull)(i.paneForSource(e)),n=i.priceScaleSlotsCount().totallySlots>1,o=r.rightPriceScales(),a=r.leftPriceScales(),l=this._createActionScaleDetachRight(e),h=this._createActionScaleDetachLeft(e),u=o.length+a.length+(null===l?0:1)+(null===h?0:1)>2,p={right:{hidden:{checked:{labelled:ie,sided:se},unchecked:{labelled:re,sided:ne}},visible:{checked:{labelled:oe,sided:ae},unchecked:{labelled:le,sided:ce}}},left:{hidden:{checked:{labelled:ie,sided:he},unchecked:{labelled:re,sided:de}},visible:{checked:{labelled:oe,sided:ue},unchecked:{labelled:le,sided:pe}}}},_={right:N,left:O},m={left:r.visibleLeftPriceScales(),right:r.visibleRightPriceScales()},g=(t,i)=>{const s=("right"===i?o:a)[t],r=m[i].includes(s)?"visible":"hidden",l=e.priceScale()===s?"checked":"unchecked",c=n?"labelled":"sided",h=p[i],u=(0,d.getPriceAxisNameInfo)(i,t).label;return{actionText:h[r][l][c].format({label:u}),undoText:n?R.format({label:u}):_[i]}};t.push(...o.map(((t,i)=>{const s=g(i,"right");return this._createMoveToScaleAction(e,t,s.actionText,s.undoText)}))),null!==l&&t.push(l);u&&(o.length>0||null!==l)&&t.push(new c.Separator);t.push(...a.map(((t,i)=>{const s=g(i,"left");return this._createMoveToScaleAction(e,t,s.actionText,s.undoText)}))),null!==h&&t.push(h);u&&(a.length>0||null!==h)&&t.push(new c.Separator);return t.push(this._createActionNoScale(e)),t}_createActionMergeUp(e){const t=this._chartWidget.model();return t.model().isMergeUpAvailableForSource(e)?new c.Action({actionId:"Chart.Source.MergeUp",label:we,statName:"MergeUp",onExecute:()=>t.mergeSourceUp(e)}):null}_createActionUnmergeUp(e){const t=this._chartWidget.model();return t.model().isUnmergeAvailableForSource(e)?new c.Action({actionId:"Chart.Source.UnmergeUp",label:Pe,statName:"UnmergeUp",onExecute:()=>t.unmergeSourceUp(e)}):null}
_createActionMergeDown(e){const t=this._chartWidget.model();return t.model().isMergeDownAvailableForSource(e)?new c.Action({actionId:"Chart.Source.MergeDown",label:Ce,statName:"MergeDown",onExecute:()=>t.mergeSourceDown(e)}):null}_createActionUnmergeDown(e){const t=this._chartWidget.model();return t.model().isUnmergeAvailableForSource(e)?new c.Action({actionId:"Chart.Source.UnmergeDown",label:Te,statName:"UnmergeDown",onExecute:()=>t.unmergeSourceDown(e)}):null}_mergeContentMenuItems(e){return[this._createActionMergeUp(e),this._createActionUnmergeUp(e),this._createActionMergeDown(e),this._createActionUnmergeDown(e)].filter(o.notNull)}_createActionMove(e){const t=this._mergeContentMenuItems(e);return t.length>0?new c.Action({actionId:"Chart.Source.MoveToPane",label:be,icon:i(854190),subItems:t}):null}_contextMenuActionsForSeries(e,t){var i;const r=[],n=e.properties().childs().visible.value(),o=this._chartWidget.model().model(),a=(0,s.ensureNotNull)(o.paneForSource(e)),h=this._chartWidget.actions();if(this._isReadOnly())r.push(n?this._createActionHide(e):this._createActionShow(e)),r.push(new c.Separator),r.push(this._createActionScale(e));else{if(this._options.mainSeriesTrade){const e=st(this._chartWidget);null!==e&&r.push(e)}r.length>0&&!(r[r.length-1]instanceof c.Separator)&&r.push(new c.Separator),l.enabled("symbol_info")&&r.push(h.showSymbolInfoDialog);o.mainSeries().symbolInfo();if(r.length>0&&!(r[r.length-1]instanceof c.Separator)&&r.push(new c.Separator),!a.isEmpty()&&l.enabled("datasource_copypaste")){const e=at(a,t&&"localY"in t?t.localY:void 0),i=rt(this._chartWidget,a);(e||i)&&(e&&r.push(e),i&&r.push(i),r.push(new c.Separator))}r.push(nt(this._chartWidget,[e]));const s=this._createActionMove(e);null!==s&&r.push(s),r.push(this._createActionScale(e)),r.push(n?this._createActionHide(e):this._createActionShow(e)),r.push(new c.Separator),r.push(ct(this._chartWidget)),r.push(new c.Separator);Boolean(null===(i=window.widgetbar)||void 0===i?void 0:i.widget("watchlist"))&&h.addToWatchlist&&r.push(h.addToWatchlist),l.enabled("text_notes")&&r.push(h.addToTextNotes),r[r.length-1]instanceof c.Separator||r.push(new c.Separator),l.enabled("show_chart_property_page")&&!this._chartWidget.onWidget()&&r.push(h.mainSeriesPropertiesAction),r[r.length-1]instanceof c.Separator&&r.pop()}return r}_createActionAddChildStudy(e){throw new Error("unsupported")}_createActionAddFundamentals(e){return null}_createActionShowSymbolInfoDialog(e,t){const s=this._chartWidget.model().model();return new c.Action({actionId:"Chart.Dialogs.ShowSymbolInfo",label:Qe,icon:i(437924),checkable:!1,statName:"SymbolInfo",onExecute:()=>{const i=e.symbol(),r={symbolInfo:e.symbolInfo(),unitDescription:e=>t.description(e),dateFormatter:s.dateFormatter()};(0,C.showSymbolInfoDialog)(i,r)}})}_createActionShowProperties(e){return new c.Action({actionId:"Chart.Indicator.ShowSettingsDialog",label:Ne,icon:i(951983),statName:"EditSelectedObject",onExecute:()=>this._chartWidget.showSourceProperties(e)})}async _contextMenuActionsForStudy(e){
const t=this._chartWidget.actions(),i=e.properties().childs().visible.value(),s=[];if(!e.userEditEnabled())return s;if(this._chartWidget.readOnly())s.push(i?this._createActionHide(e):this._createActionShow(e)),s.push(new c.Separator),(0,p.isNonSeriesStudy)(e)||s.push(this._createActionScale(e));else{0,l.enabled("study_on_study")&&e.canHaveChildren()&&s.push(this._createActionAddChildStudy(e));const r=this._createApplyToEntireLayoutCommand(e);if(null!==r&&s.push(r),s.length>0&&!(s[s.length-1]instanceof c.Separator)&&s.push(new c.Separator),l.enabled("symbol_info")&&(e instanceof P.StudyCompare||e instanceof w.study_Overlay)&&null!==e.symbolInfo()&&(s.push(this._createActionShowSymbolInfoDialog(e,this._chartWidget.model().model().availableUnits())),s.push(new c.Separator)),s.push(nt(this._chartWidget,[e])),s.push(ot(this._chartWidget,[e])),!(0,p.isNonSeriesStudy)(e)){const t=this._createActionMove(e);null!==t&&s.push(t),s.push(this._createActionScale(e))}s.push(new c.Separator);const n=e.metaInfo();if(e.copiable()){const t=new c.Action({actionId:"Chart.Clipboard.CopySource",label:We,shortcutHint:(0,y.humanReadableHash)(y.Modifiers.Mod+67),statName:"Copy",onExecute:()=>{this._chartWidget.chartWidgetCollection().clipboard.uiRequestCopy([e])}});s.push(t)}s.push(i?this._createActionHide(e):this._createActionShow(e)),s.push(t.studyRemove),s.push(new c.Separator),l.enabled("property_pages")&&new _.MetaInfoHelper(n).hasUserEditableOptions()&&s.push(this._createActionShowProperties(e)),s[s.length-1]instanceof c.Separator&&s.pop()}return s}_createEditAlertDrawingAction(e){return new TVAction({label:X.format({title:e.title()}),icon:TbbiEditAlertSvg,statName:"EditAlert",onExecute:()=>{window.runOrSignIn((()=>{e.editAlert("pane_context_menu_edit_alert")}),{source:"Alert edit from pane context menu"})}})}_createLineToolTemplateAction(e){{const t=this._chartWidget.model(),s=i=>{t.applyLineToolTemplate(e,i,j)};return new c.ActionAsync("Chart.LineTool.Templates",(async()=>{const{LinetoolTemplatesList:r}=await Promise.all([i.e(1323),i.e(3177)]).then(i.bind(i,16143)),n=new r(e.toolname,s),o=[],a=new c.Action({actionId:"Chart.LineTool.Templates.SaveAs",label:Fe,statName:"SaveAs",onExecute:()=>{n.showSaveDialog((t=>{const i=JSON.stringify(e.template());n.saveTemplate(t,i)}))}});o.push(a);const l=new c.Action({actionId:"Chart.LineTool.Templates.ApplyDefaults",label:Oe,statName:"ApplyDefault",onExecute:()=>{t.restorePropertiesForSource(e),window.lineToolPropertiesToolbar.onSourceChanged([e])}});return o.push(l),new Promise((e=>{n.templatesLoaded().then((()=>{var e;const t=null!==(e=n.getData())&&void 0!==e?e:[];t.length>0&&o.push(new c.Separator),t.forEach(((e,t)=>{const i=new c.Action({actionId:"Chart.LineTool.Templates.Apply",label:e,statName:"ApplyTemplate",onExecute:()=>n.loadTemplate(e),toolbox:{type:b.ToolboxType.Delete,action:()=>{n.deleteAction(e)}},showToolboxOnHover:!0});o.push(i)}))}),(e=>{B.logWarn(e)})).then((()=>{e({label:He,statName:"Template",subItems:o})}))}))}))}}_createActionToggleLockLineTools(e){
const t=e[0].properties().frozen.value(),s=t?je:Ge;return new c.Action({actionId:"Chart.SelectedObject.ToggleLocked",label:s,statName:"ToggleLockSelectedObject",checkable:!0,icon:i(t?397874:902872),onExecute:()=>{if(1===e.length)this._chartWidget.toggleLockSelectedObject();else{const i=t?q:G,s=this._chartWidget.model();s.withMacro(i,(()=>{e.forEach((e=>{s.setProperty(e.properties().frozen,!t,i)}))}))}}})}async _contextMenuActionsForLineTool(e){const t=[],r=this._chartWidget.actions(),o=this._chartWidget.model().model(),a=()=>{t.push(nt(this._chartWidget,e))},h=()=>{t.push(ot(this._chartWidget,e))},d=()=>{const s=e.filter((e=>e.cloneable()));if(s.length>0){const e=new c.Action({actionId:"Chart.LineTool.Clone",label:ze,icon:i(201457),shortcutHint:(0,y.humanReadableModifiers)(y.Modifiers.Mod)+"Drag",statName:"Clone",onExecute:()=>this._chartWidget.model().cloneLineTools(s,!1)},"Clone");t.push(e)}return!!s.length},u=()=>{const i=e.filter((e=>e.copiable()));if(i.length>0){const e=new c.Action({actionId:"Chart.Clipboard.CopyLineTools",label:We,shortcutHint:(0,y.humanReadableHash)(y.Modifiers.Mod+67),statName:"Copy",onExecute:()=>this._chartWidget.chartWidgetCollection().clipboard.uiRequestCopy(i)},"Copy");t.push(e)}return!!i.length},p=()=>{const i=ht(this._chartWidget,e);return t.push(...i),i.length>0},_=async e=>{if(this._chartWidget.model().isInReplay())return;const i=e.getOrderTemplate();if(null===i)return;const r=(0,m.tradingService)();if(null!==r){const e=r.activeBroker();if(e&&1===e.connectionStatus()&&e.metainfo().configFlags.supportLimitOrders){const r=o.mainSeries();i.symbol=r.proSymbol();if((await e.isTradable(i.symbol)).tradable){const{qty:{step:r}}=await e.symbolInfo(i.symbol);i.qty=function(e,t){return(0,n.Big)(e).div(t).round(void 0,0).mul(t).toNumber()}(i.qty,r),t.push(new c.Separator),t.push(function(e){const t=(0,s.ensureNotNull)((0,m.tradingService)());return new c.Action({actionId:"Chart.LineTool.CreateLimitOrderFromState",label:Q,statName:"CreateLimitOrder",onExecute:()=>{t.trackEvent("Chart Context Menu","RiskRewardCreateLimitOrder"),(0,s.ensureNotNull)(t.brokerCommandsUI()).placeOrder(e)}})}(i))}}else 0}},g=e=>{const i=new c.Action({actionId:"Chart.ScrollToLineTool",label:Ue.format({lineToolName:e.title()}),statName:"GoToLineTool",checkable:!1,onExecute:async()=>this._chartWidget.model().scrollToLineTool(e)});t.push(i)},f=e=>{const t=this._chartWidget.model().model().lineToolsGroupModel(),i=e.map((e=>t.groupForLineTool(e)));return new Set(i).size<=1};if(1===e.length){const i=e[0];if(this._chartWidget.readOnly())t.push(r.lineHide);else if(i.userEditEnabled()){0;{const e=this._createLineToolTemplateAction(i);null!==e&&t.push(e)}a(),h(),this._options.objectTree&&r.paneObjectTree&&t.push(r.paneObjectTree),await _(i),t.push(new c.Separator);let e=d();e=u()||e,e=p()||e,e&&t.push(new c.Separator),t.push(this._createActionToggleLockLineTools([i])),t.push(r.lineHide),t.push(r.lineRemove),i.points().length>0&&this._options.gotoLineTool&&(t.push(new c.Separator),g(i))
;const s=await this._chartWidget.propertiesDefinitionsForSource(i);if(l.enabled("property_pages")&&null!==s&&(t.push(new c.Separator),t.push(r.format)),i.additionalActions){t.push(new c.Separator);const e=i.additionalActions(this._chartWidget.model());t.push(...e)}}}else this._options.objectTree&&r.paneObjectTree&&t.push(r.paneObjectTree),f(e)&&a(),h(),t.length>0&&t.push(new c.Separator),d(),u(),p(),t.push(new c.Separator),t.push(this._createActionToggleLockLineTools(e)),t.push(r.lineHide),t.push(r.lineRemove),l.enabled("property_pages")&&(t.push(new c.Separator),t.push(r.format));return t}_createEarningsShow(){return null}_createDividendsShow(){return null}_createSplitsShow(){return null}_contextMenuActionsForESD(){return[]}_contextMenuActionsForRollDates(){return[]}_contextMenuActionsForFuturesContractExpiration(){return[]}_contextMenuActionsForLastNews(){return[]}_contextMenuActionsForPublishedTimeline(e){const t=this._chartWidget.actions(),i=[];if(i.push(t.lineHide),window.is_authenticated){const t=e.properties().childs().filter,s=new TVAction({checked:t.value()===PublishedChartsFilter.None,checkable:!0,label:qe,name:"ToggleAllIdeas",statName:"ToggleAllIdeas",onExecute:()=>this._chartWidget.model().setProperty(t,PublishedChartsFilter.None,F)}),r=new TVAction({checked:t.value()===PublishedChartsFilter.Following,checkable:!0,label:$e,name:"ToggleIdeasOfPeopleAndUser",statName:"ToggleIdeasOfPeopleAndUser",onExecute:()=>this._chartWidget.model().setProperty(t,PublishedChartsFilter.Following,W)}),n=new TVAction({checked:t.value()===PublishedChartsFilter.Private,checkable:!0,label:Ye,name:"ToggleUserIdeas",statName:"ToggleUserIdeas",onExecute:()=>this._chartWidget.model().setProperty(t,PublishedChartsFilter.Private,z)});i.push(new c.Separator,s,r,n)}return i}_contextMenuActionsForTradingDrawings(e){return e.contextMenuItems()}_createAlertToggleHorzLineLabelAction(e){throw new Error("Not implemented")}_contextMenuActionsForAlertLabel(e,t){throw new Error("Not implemented")}_contextMenuActionsForChartEvents(e){return[]}_createApplyToEntireLayoutCommand(e){if(!this._chartWidget.chartWidgetCollection().applyIndicatorsToAllChartsAvailable())return null;const t=this._chartWidget.model().model();if(e.parentSources().length>0)return null;const i=(0,s.ensureNotNull)(t.paneForSource(e)),r=t.paneForSource(t.mainSeries())===i,n=e instanceof P.StudyCompare&&e.priceScale()===t.mainSeries().priceScale()&&(0,s.ensureNotNull)(e.priceScale()).isPercentage(),o=r?void 0:t.panes().indexOf(i);let a=Ze,l=U,h="AddStudyToEntireLayout";return(0,I.isActingAsSymbolSource)(e)&&(a=Ke,l=H,h="AddSymbolToEntireLayout"),new c.Action({actionId:"Chart.AddIndicatorToAllCharts",label:a,statName:h,onExecute:()=>{const i=(0,s.ensureNotNull)((0,T.clipboardDataForSources)(t.id(),[e])),a=this._chartWidget.chartWidgetCollection(),c={isOnMainPane:r,asCompare:n,paneIndex:o};a.applyIndicatorToAllCharts(this._chartWidget,i,c,l)}},"applyStudyToEntireLayout")}}},546561:(e,t,i)=>{"use strict";i.r(t),i.d(t,{supportedLineTools:()=>s});const s={cursor:{name:"cursor",
onlySelectable:!0},dot:{name:"dot",onlySelectable:!0},arrow_cursor:{name:"arrow",onlySelectable:!0},eraser:{name:"eraser",onlySelectable:!0},measure:{name:"measure",onlySelectable:!0},zoom:{name:"zoom",onlySelectable:!0},brush:{name:"LineToolBrush"},highlighter:{name:"LineToolHighlighter"},text:{name:"LineToolText"},anchored_text:{name:"LineToolTextAbsolute",isAnchored:!0},note:{name:"LineToolNote"},anchored_note:{name:"LineToolNoteAbsolute",isAnchored:!0},signpost:{name:"LineToolSignpost"},callout:{name:"LineToolCallout"},balloon:{name:"LineToolBalloon"},comment:{name:"LineToolComment"},arrow_up:{name:"LineToolArrowMarkUp"},arrow_down:{name:"LineToolArrowMarkDown"},arrow_left:{name:"LineToolArrowMarkLeft"},arrow_right:{name:"LineToolArrowMarkRight"},price_label:{name:"LineToolPriceLabel"},price_note:{name:"LineToolPriceNote"},arrow_marker:{name:"LineToolArrowMarker"},flag:{name:"LineToolFlagMark"},vertical_line:{name:"LineToolVertLine"},horizontal_line:{name:"LineToolHorzLine"},cross_line:{name:"LineToolCrossLine"},horizontal_ray:{name:"LineToolHorzRay"},trend_line:{name:"LineToolTrendLine"},info_line:{name:"LineToolInfoLine"},trend_angle:{name:"LineToolTrendAngle"},arrow:{name:"LineToolArrow"},ray:{name:"LineToolRay"},extended:{name:"LineToolExtended"},parallel_channel:{name:"LineToolParallelChannel"},disjoint_angle:{name:"LineToolDisjointAngle"},flat_bottom:{name:"LineToolFlatBottom"},pitchfork:{name:"LineToolPitchfork"},schiff_pitchfork_modified:{name:"LineToolSchiffPitchfork"},schiff_pitchfork:{name:"LineToolSchiffPitchfork2"},inside_pitchfork:{name:"LineToolInsidePitchfork"},pitchfan:{name:"LineToolPitchfan"},gannbox:{name:"LineToolGannSquare"},gannbox_square:{name:"LineToolGannComplex"},gannbox_fixed:{name:"LineToolGannFixed"},gannbox_fan:{name:"LineToolGannFan"},fib_retracement:{name:"LineToolFibRetracement"},fib_trend_ext:{name:"LineToolTrendBasedFibExtension"},fib_speed_resist_fan:{name:"LineToolFibSpeedResistanceFan"},fib_timezone:{name:"LineToolFibTimeZone"},fib_trend_time:{name:"LineToolTrendBasedFibTime"},fib_circles:{name:"LineToolFibCircles"},fib_spiral:{name:"LineToolFibSpiral"},fib_speed_resist_arcs:{name:"LineToolFibSpeedResistanceArcs"},fib_wedge:{name:"LineToolFibWedge"},fib_channel:{name:"LineToolFibChannel"},xabcd_pattern:{name:"LineTool5PointsPattern"},cypher_pattern:{name:"LineToolCypherPattern"},abcd_pattern:{name:"LineToolABCD"},triangle_pattern:{name:"LineToolTrianglePattern"},"3divers_pattern":{name:"LineToolThreeDrivers"},head_and_shoulders:{name:"LineToolHeadAndShoulders"},elliott_impulse_wave:{name:"LineToolElliottImpulse"},elliott_triangle_wave:{name:"LineToolElliottTriangle"},elliott_triple_combo:{name:"LineToolElliottTripleCombo"},elliott_correction:{name:"LineToolElliottCorrection"},elliott_double_combo:{name:"LineToolElliottDoubleCombo"},cyclic_lines:{name:"LineToolCircleLines"},time_cycles:{name:"LineToolTimeCycles"},sine_line:{name:"LineToolSineLine"},long_position:{name:"LineToolRiskRewardLong"},short_position:{name:"LineToolRiskRewardShort"},forecast:{name:"LineToolPrediction"
},date_range:{name:"LineToolDateRange"},price_range:{name:"LineToolPriceRange"},date_and_price_range:{name:"LineToolDateAndPriceRange"},bars_pattern:{name:"LineToolBarsPattern"},ghost_feed:{name:"LineToolGhostFeed"},projection:{name:"LineToolProjection"},rectangle:{name:"LineToolRectangle"},rotated_rectangle:{name:"LineToolRotatedRectangle"},circle:{name:"LineToolCircle"},ellipse:{name:"LineToolEllipse"},triangle:{name:"LineToolTriangle"},polyline:{name:"LineToolPolyline"},path:{name:"LineToolPath"},curve:{name:"LineToolBezierQuadro"},double_curve:{name:"LineToolBezierCubic"},arc:{name:"LineToolArc"},icon:{name:"LineToolIcon"},emoji:{name:"LineToolEmoji"},regression_trend:{name:"LineToolRegressionTrend"},fixed_range_volume_profile:{name:"LineToolFixedRangeVolumeProfile"}}},127958:(e,t,i)=>{"use strict";i.d(t,{clipboardDataForSources:()=>o});var s=i(650151),r=i(663890),n=i(232468);function o(e,t){if(1===t.length&&(0,r.isStudy)(t[0])){const e=t[0];return{title:e.title(),sources:[{source:(0,s.ensureNotNull)(e.state()),type:"study"}]}}const i={sources:[],title:""};return i.sources=t.filter((e=>e.copiable()&&(0,n.isLineTool)(e))).map((t=>{const i={type:"drawing",geometry:t.geometry(),source:{...t.state(!1),points:t.normalizedPoints()},modelId:e};return delete i.source.alertId,i})),i.sources.length>0?(1===i.sources.length?i.title=t[0].title&&t[0].title():i.title="Drawings",i):null}},896483:(e,t,i)=>{"use strict";i.d(t,{addBrandingSource:()=>Q});var s=i(96401),r=i(327714),n=i(304889),o=i(86441),a=i(934026),l=i(676507),c=i(650151),h=i(509806),d=(i(601227),i(484727)),u=i(404493),p=i(777277),_=i(635991),m=i(602564),g=i(131227),f=i(664114),v=i(289763),S=i(291753),y=i(574570),b=i(256776);i(541483);const w=d.enabled("adaptive_logo"),P=d.enabled("small_no_display"),C=d.enabled("38914"),T="site_branding",x="widget_branding",I="widget_referral_branding",M="widget_custom_branding",L="widget_custom_no_powered_branding",A="fundamental_branding",k="fundamental_custom_branding",E="fundamental_custom_no_powered_branding",D="library_branding",B="library_custom_branding",V="library_custom_no_powered_branding",R=navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&-1===navigator.userAgent.toLowerCase().indexOf("edge"),N=window.urlParams||{};window.initData;N.no_referral_id&&enable(N.referral_id||"","aggressive");const O=!1,F=h.t(null,void 0,i(726619)),W=C?h.t(null,void 0,i(105607)):h.t(null,void 0,i(968111));h.t(null,void 0,i(782128)),h.t(null,void 0,i(988841)),h.t(null,void 0,i(299769));function z(e){return"px EuclidCircular"===e?.1:0}class H extends u.CustomSourceBase{constructor(e,t,i){super(e,t),this._canvasWidth=0,this._paneHeight=0,this._left=13,this._bottom=16,this._layout=T,this._needToShow=!0,this._showBranding=!1,this._customLogoSrc="",this._customLogoLink="",this._cubicBezier=new _.CubicBezier(.4,.01,.22,1),this._openAnimation=null,this._closeAnimation=null,this._powBy=null,this._custom=null,this._mainSeries=this._model.mainSeries(),this._visibleSpawn=i,this._showForPro=O,this._visibleSpawn.subscribe((()=>{
this._model.updateSource(this)})),this._checkLayout(),this._layout!==M&&this._layout!==k||(this._left=8,this._bottom=5);const s=()=>{this._needToShow?this._showBranding=!0:this._showBranding=!1};this._resizeHandlerDelayed=(0,n.default)(s,200),s(),window.addEventListener("resize",this._resizeHandlerDelayed),this._monitorCanvas=(0,v.createDisconnectedBoundCanvas)(document,(0,r.size)({width:0,height:0})),this._monitorCanvas.subscribeSuggestedBitmapSizeChanged((()=>{this._init()})),this._model.isSnapshot()?this._init():(this._mainSeries.dataEvents().symbolResolved().subscribe(this,this._init),null!==this._mainSeries.symbolInfo()&&this._init()),this._renderer={draw:this.draw.bind(this),hitTest:this.hitTest.bind(this)}}destroy(){window.removeEventListener("resize",this._resizeHandlerDelayed),this._mainSeries.dataEvents().symbolResolved().unsubscribeAll(this),this._powBy&&this._powBy.destroy(),this._visibleSpawn.destroy()}paneViews(e){if(window.TradingView.printing)return[];if(!this._visibleSpawn.value())return[];if(this._layout===T&&!this._showForPro&&window.user&&window.user.is_pro)return[];const t=d.enabled("move_logo_to_main_pane");let i=!1;if(e.maximized().value())i=!0;else if(t)i=this._model.mainPane().collapsed().value()?e===this._model.panes().find((e=>!e.collapsed().value())):e.isMainPane();else if(this._model.lastPane().collapsed().value()){const t=this._model.panes();for(let s=t.length-1;s>=0;--s){const r=t[s];if(!r.collapsed().value()){i=r===e;break}}}else i=e.isLast();return i?[{renderer:this.renderer.bind(this)}]:[]}labelPaneViews(e){return[]}priceAxisViews(e,t){return[]}updateAllViews(){}updateViewsForPane(e){}priceScale(){return null}renderer(e,t){return this._paneHeight=e,this._canvasWidth=t,this._renderer}hasContextMenu(){return!1}onClickOutside(){this._hasAnimation()&&this._startCloseAnimation()}hitTest(e){return!this._showBranding||d.enabled("logo_without_link")?null:this._powBy&&this._layout!==L&&this._layout!==E&&(this._powBy.hitTest(e)||this._custom&&this._custom.hitTest(e))?new p.HitTestResult(p.HitTestResult.CUSTOM,{hideCrosshairLinesOnHover:!0,clickHandler:()=>{this._openLink()},tapHandler:()=>{this._hasAnimation()?this._toggleOpenAnimatedOrOpenLink():this._openLink()},mouseEnterHandler:()=>{this._hasAnimation()&&this._startOpenAnimation()},mouseLeaveHandler:()=>{this._hasAnimation()&&this._startCloseAnimation()}}):null}tvUrl(){let e=new URL("https://www.tradingview.com/");if(this._customLogoLink)return this._customLogoLink;if(this._layout===D||this._layout===B){let t;switch(!0){case d.enabled("charting_library"):t="library";break;case d.enabled("trading_terminal"):t="trading-terminal"}return e.searchParams.append("utm_source",window.location.origin),e.searchParams.append("utm_medium","library"),t&&e.searchParams.append("utm_campaign",t),e.toString()}return e.toString()}draw(e,t){if(!this._showBranding)return;let i=0;N.utm=!0,(0,v.drawScaled)(e,t.pixelRatio,(()=>{this._powBy&&this._powBy.show&&(i=this._powBy.height,e.save(),e.translate(this._left,this._paneHeight-this._bottom-i),
this._powBy.draw(e,t,this._canvasWidth),e.restore()),this._custom&&this._custom.show&&(e.save(),e.translate(this._left,this._paneHeight-this._bottom-i-this._custom.height),this._custom.draw(e,t),e.restore())}))}_init(){const e=this._mainSeries.symbolInfo();this._powBy&&this._powBy.destroy(),this._powBy=new X(this._layout,(null==e?void 0:e.name)||"",this._model,(()=>this._model.fullUpdate())),this._custom=new J(this._layout,this._customLogoSrc,(()=>this._model.fullUpdate())),this._openAnimation=null,this._closeAnimation=null}_checkLayout(){if(d.enabled("widget"))0;else if(d.enabled("charting_library")||d.enabled("trading_terminal")){const e=JSON.parse(N.logo)||{};e.image?(this._customLogoSrc=e.image,this._customLogoLink=e.link,this._needToShow=d.enabled("widget_logo"),d.enabled("link_to_tradingview")?this._layout=B:this._layout=V):(this._layout=D,this._needToShow=d.enabled("widget_logo"))}else this._layout=T}_startOpenAnimation(){null===this._openAnimation&&(null!==this._closeAnimation&&(this._closeAnimation.stop(),this._closeAnimation=null),this._openAnimation=(0,g.doAnimate)({from:this._currentStateForAnimation(),to:this._openedStateForAnimation(),duration:200,easing:this._cubicBezier.easingFunc,onStep:this._animatedDrawStep.bind(this)}))}_startCloseAnimation(){null===this._closeAnimation&&(null!==this._openAnimation&&(this._openAnimation.stop(),this._openAnimation=null),this._closeAnimation=(0,g.doAnimate)({from:this._currentStateForAnimation(),to:this._closedStateForAnimation(),duration:200,easing:this._cubicBezier.easingFunc,onStep:this._animatedDrawStep.bind(this)}))}_currentStateForAnimation(){return(0,c.ensureNotNull)(this._powBy).width}_closedStateForAnimation(){return(0,c.ensureNotNull)(this._powBy).minimizedAnimationWidth()}_openedStateForAnimation(){return(0,c.ensureNotNull)(this._powBy).maximizedAnimationWidth()}_animatedDrawStep(e,t){(0,c.ensureNotNull)(this._powBy).animatedDrawStep(e,t),this._model.lightUpdate()}_hasAnimation(){return null!==this._powBy&&this._powBy.hasAnimation()}_openLink(){if(this._layout===T)return!1;d.enabled("widget");return(0,c.ensureNotNull)(window.open(this.tvUrl(),"_blank")).opener=null,!0}_toggleOpenAnimatedOrOpenLink(){null!==this._openAnimation&&this._openAnimation.completed()?this._openLink()||this._startCloseAnimation():this._startOpenAnimation()}}function U(e){return!P||e>480}function j(e){return!w||e>500}const G={customBrandingTradingViewText:l.colorsPalette["color-brand"],customBrandingText:l.colorsPalette["color-cold-gray-850"],background:l.colorsPalette["color-cold-gray-900"],shadow:(0,m.generateColor)(l.colorsPalette["color-white"],91),text:l.colorsPalette["color-white"],staticTextBackground:(0,m.generateColor)(l.colorsPalette["color-cold-gray-800"],20),logo:l.colorsPalette["color-white"]},q={customBrandingTradingViewText:l.colorsPalette["color-brand"],customBrandingText:l.colorsPalette["color-cold-gray-850"],background:l.colorsPalette["color-white"],shadow:(0,m.generateColor)(l.colorsPalette["color-black"],91),text:l.colorsPalette["color-cold-gray-900"],
staticTextBackground:(0,m.generateColor)(l.colorsPalette["color-white"],20),logo:l.colorsPalette["color-cold-gray-900"]};const $={};function Y(e,t){const i=$[e];if(void 0!==i)return i.image||null;const s={};return $[e]=s,function(e){return new Promise((t=>{const i=S.replace(/fill="#[\da-f]{6}"/i,`fill="${e}"`),s=new Image;s.onload=()=>{s.onload=null,t(s)},s.src=URL.createObjectURL(new Blob([i],{type:"image/svg+xml"}))}))}(e).then((e=>{s.image=e,t()})),null}function K(e){const{a:t,d:i,e:s,f:r}=e;return new o.Point(s/t,r/i)}class Z{constructor(){this._originPoint=null}hitTest(e){const t=this._getHitTestBox();if(t)return(0,a.pointInBox)(e,t)}_getHitTestBox(){const e=this._originPoint;if(e){const{x:t,y:i}=e;return(0,o.box)(e,new o.Point(t+this.width,i+this.height))}}}class X extends Z{constructor(e,t,i,s){super(),this.show=!0,this.borderRadius=0,this._needDisplayImage=!1,this._imageWidth=22,this._imageHeight=11,this._animatedWidth=32,this._font=`px ${y.CHART_FONT_FAMILY}`,this._txt="TradingView",this._textWidth=0,this._maximizedAnimationTextWidth=0,this._textWidthCache=new b.TextWidthCache,this._pixelRatio=1,this._model=i,this._layout=e,this._symbol=t,this._showAnimatedBranding=d.enabled("show_animated_logo")||this._layout===x,this._alwaysMaximized=d.enabled("logo_always_maximized")||O,this._fontSize=this._showAnimatedBranding||this._layout===I?11:14,this._showAnimatedBranding||this._layout!==M&&this._layout!==k||(this._fontSize=12),this.width=32,this.height=this._fontSize+2,this._requestRepaint=s,this._init(),this._checkFontLoaded(),this._recalculateMetrics()}destroy(){this._model.properties().childs().paneProperties.childs().background.unsubscribeAll(this),this._model.onChartThemeLoaded().unsubscribeAll(this)}hasAnimation(){return this._showAnimatedBranding&&!this._alwaysMaximized}minimizedAnimationWidth(){return 32}maximizedAnimationWidth(){return this._maximizedAnimationTextWidth+32-3}animatedDrawStep(e,t){this._animatedWidth=t}draw(e,t,i){t.pixelRatio!==this._pixelRatio&&(this._textWidthCache.reset(),this._pixelRatio=t.pixelRatio);const s=this._colors;if(this._showAnimatedBranding)this._needDisplayImage&&null!==this._getLogoImage(s.logo)&&(e.save(),e.translate(-Math.ceil((32-this._imageWidth)/2),Math.floor((32-this._imageHeight)/2)),this._originPoint=K(e.getTransform()),this.borderRadius=16,this._drawFillRectWithRoundedCorner(e,-.5,0,this._animatedWidth,32,this.borderRadius),this._drawLogoImage(e,Math.round((32-this._imageWidth)/2),Math.round((32-this._imageHeight)/2)+0),this._animatedWidth>32&&(e.translate(Math.round(32),Math.round(this._fontSize*z(this._font))),this._drawFillTextCropWidth(e,this._animatedWidth-32)),e.restore(),this.width=this._animatedWidth);else if(this._layout===M||this._layout===k){e.font=this._fontSize+this._font;const t=e.measureText(this._txt).width+2;this.width=t+e.measureText("TradingView").width+2,this._originPoint=K(e.getTransform()),e.save(),e.globalAlpha=.7,e.fillStyle=this._colors.customBrandingText,e.fillText(this._txt,0,12),e.fillStyle=this._colors.customBrandingTradingViewText,
e.fillText("TradingView",t,12),e.restore()}else if(U(i)&&this._layout===I){if(this._getLogoImage(s.logo)){e.save(),e.translate(-Math.ceil((32-this._imageWidth)/2),Math.floor((32-this._imageHeight)/2)),this.borderRadius=16,this.width=32;const t=j(i);t&&(this.width+=this._maximizedAnimationTextWidth+4),this._drawFillRectWithRoundedCorner(e,-.5,0,this.width,32,this.borderRadius),this._drawLogoImage(e,Math.round((32-this._imageWidth)/2)+4,Math.round((32-this._imageHeight)/2)+0),t&&(e.translate(35,Math.round(this._fontSize*z(this._font))),this._drawTextFill(e)),e.restore()}}else if(U(i))if(this._needDisplayImage&&null!==this._getLogoImage(s.logo)){e.save(),e.translate(-Math.ceil((32-this._imageWidth)/2),Math.floor((32-this._imageHeight)/2)),this._originPoint=K(e.getTransform()),this.borderRadius=16,this._drawBgCircle(e),e.drawImage((0,c.ensureNotNull)(this._getLogoImage(s.logo)),Math.round((32-this._imageWidth)/2),Math.round((32-this._imageHeight)/2)+0);const t=j(i);t&&(e.translate(37,Math.round(this._fontSize*z(this._font))),this._drawTextStroke(e),this._drawTextFill(e)),e.restore(),this.width=32,t&&(this.width+=this._maximizedAnimationTextWidth)}else{const t=j(i);t&&(e.save(),e.translate(R?-.5:0,-.5),this._drawTextStroke(e),this._drawTextFill(e),e.restore()),t&&(this.width=this._maximizedAnimationTextWidth)}else this.width=0}_init(){this._checkLayout(),this.show&&(this.height=this._needDisplayImage?32:this._fontSize+2,this._updateColors(),this._model.properties().childs().paneProperties.childs().background.subscribe(this,this._updateColors),this._model.onChartThemeLoaded().subscribe(this,this._updateColors))}_checkFontLoaded(){if(document.fonts&&document.fonts.check&&document.fonts.load){document.fonts.check(`${this._fontSize}px EuclidCircular`)?this._font="px EuclidCircular":document.fonts.load(`${this._fontSize}px EuclidCircular`,this._txt).then((()=>{this._font="px EuclidCircular",this._recalculateMetrics(),this._requestRepaint()}))}}_recalculateMetrics(){const e=(0,v.createDisconnectedBoundCanvas)(document,(0,r.size)({width:0,height:0})),t=(0,v.getPretransformedContext2D)(e,!0);t.font=this._fontSize+this._font,this._textWidth=Math.ceil(t.measureText(this._txt).width)+2;let i=this._textWidth+8;i%2==0&&(i+=1),this._maximizedAnimationTextWidth=i,this._textWidthCache.reset(),this._alwaysMaximized&&(this._animatedWidth=this.maximizedAnimationWidth())}_updateColors(){this._colors=this._model.isDark()?G:q}_getLogoImage(e){return Y(e,this._requestRepaint)}_checkLayout(){switch(this._layout){case x:case I:case M:case A:case k:case B:case D:case T:this.show=!0;break;case L:case E:case V:this.show=!1}switch(this._layout){case D:this._needDisplayImage=!0,this._txt=F;break;case B:this._txt=W}}_drawTextStroke(e){e.save(),e.textBaseline="middle",e.textAlign="start",e.font=this._fontSize+this._font,e.strokeStyle=this._colors.staticTextBackground,e.lineWidth=4,e.lineJoin="round",e.strokeText(this._txt,0,16+this._textWidthCache.yMidCorrection(e,this._txt)),e.restore()}_drawTextFill(e){e.save(),e.textBaseline="middle",
e.textAlign="start",e.font=this._fontSize+this._font,e.fillStyle=this._colors.text,e.fillText(this._txt,0,16+this._textWidthCache.yMidCorrection(e,this._txt)),e.restore()}_drawFillTextCropWidth(e,t){e.save(),e.beginPath(),e.rect(0,0,t,this.height),e.clip(),this._drawTextFill(e),e.restore()}_drawBgCircle(e){const t=this.borderRadius,i=2*Math.PI;e.save(),e.beginPath(),e.fillStyle=this._colors.shadow,e.arc(t,t,t+1,0,i),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.fillStyle=this._colors.background,e.arc(t,t,t,0,i,!1),e.fill(),e.closePath(),e.restore()}_drawFillRectWithRoundedCorner(e,t,i,s,r,n){e.save(),(0,f.drawRoundRect)(e,t-1,i-1,s+2,r+2,n),e.fillStyle=this._colors.shadow,e.fill(),e.closePath(),e.restore(),e.save(),(0,f.drawRoundRect)(e,t,i,s,r,n),e.fillStyle=this._colors.background,e.fill(),e.closePath(),e.restore()}_drawLogoImage(e,t,i){e.drawImage((0,c.ensureNotNull)(this._getLogoImage(this._colors.logo)),t,i)}}class J extends Z{constructor(e,t,i){super(),this.show=!1,this.width=0,this.height=0,this._ready=!1,this._layout=e,this._src=t,this._onReadyCallback=i,this._checkLayout();const s=new Image;this._img=s,this.show&&(s.addEventListener("load",(()=>{this.width=Math.round(s.width),this.height=Math.round(s.height),this._ready=!0,this._onReadyCallback&&this._onReadyCallback()})),s.crossOrigin="anonymous",s.src=this._src)}draw(e,t){this._ready&&(e.drawImage(this._img,-.5,-.5,this.width,this.height),this._originPoint=K(e.getTransform()))}_checkLayout(){switch(this._layout){case M:case L:case k:case E:case B:case V:this.show=!0;break;case T:case x:case I:case A:case D:this.show=!1}}}function Q(e){e.addCustomSource("branding",((t,i)=>{const r=(0,s.combine)(((e,t)=>{const s=null!=e?e:t;return null!==s&&s.hasModel()&&s.model().model()===i}),e.maximizedChartWidget(),e.leftBottomChartWidget());return new H(t,i,r)}))}},289763:(e,t,i)=>{"use strict";i.d(t,{getCanvasDevicePixelRatio:()=>a,getBindingPixelRatio:()=>l,getContext2D:()=>c,getPrescaledContext2D:()=>h,getPretransformedContext2D:()=>d,fillRect:()=>u,clearRect:()=>p,drawScaled:()=>_,createDisconnectedCanvas:()=>m,createDisconnectedBoundCanvas:()=>g,createBoundCanvas:()=>v,calcTextHorizontalShift:()=>S,disableSelection:()=>y,addExclusionArea:()=>b,measureText:()=>P});var s=i(327714),r=i(650151),n=i(561626),o=i(601227);function a(e){var t,i;return Math.max(1,(null===(i=null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===i?void 0:i.devicePixelRatio)||1)}function l(e){return a(e.canvasElement)}function c(e){const t=(0,r.ensureNotNull)(e.getContext("2d"));return t.setTransform(1,0,0,1,0,0),t}function h(e){const t=(0,r.ensureNotNull)(e.getContext("2d")),i=a(e);return t.setTransform(i,0,0,i,0,0),t}function d(e,t){const i=(0,r.ensureNotNull)(e.canvasElement.getContext("2d")),s=l(e);return i.setTransform(s,0,0,s,0,0),t||i.translate(.5,.5),i}function u(e,t,i,s,r,n){e.save(),e.translate(-.5,-.5),e.fillStyle=n,e.fillRect(t,i,s,r),e.restore()}function p(e,t,i,s,r,n){e.save(),e.translate(-.5,-.5),e.globalCompositeOperation="copy",e.fillStyle=n,
e.fillRect(t,i,s,r),e.restore()}function _(e,t,i){e.save(),e.scale(t,t),i(),e.restore()}function m(e,t,i){const s=f(e);return void 0===i&&(i=a(s)),s.width=t.width*i,s.height=t.height*i,s}function g(e,t){const i=f(e),r=(0,s.bindCanvasElementBitmapSizeTo)(i,{type:"device-pixel-content-box",transform:(e,t)=>({width:Math.max(e.width,t.width),height:Math.max(e.height,t.height)})});return r.resizeCanvasElement(t),r}function f(e){const t=e.createElement("canvas");return y(t),t}function v(e,t){const i=f((0,r.ensureNotNull)(e.ownerDocument));e.appendChild(i);const n=(0,s.bindCanvasElementBitmapSizeTo)(i,{type:"device-pixel-content-box",transform:(e,t)=>({width:Math.max(e.width,t.width),height:Math.max(e.height,t.height)})});return n.resizeCanvasElement(t),n}function S(e,t){return"center"===e.textAlign?0:(0,n.isRtl)()?"start"===e.textAlign||"right"===e.textAlign?t:0:"start"===e.textAlign||"left"===e.textAlign?0:t}function y(e){e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.msUserSelect="none",e.style.MozUserSelect="none",e.style.webkitTapHighlightColor="transparent"}function b(e,t,i){e.beginPath(),e.rect(0,0,t.physicalWidth,t.physicalHeight);for(let s=0;s<i.length;s++){let{x:r,y:n}=i[s];r*=t.pixelRatio,n*=t.pixelRatio,0!==s?e.lineTo(r,n):e.moveTo(r,n)}e.closePath(),e.clip("evenodd")}let w;function P(e,t){return w||function(){const e=document.createElement("canvas");e.width=0,e.height=0,(0,o.isMac)()&&(e.style.display="none",document.body.append(e)),w=(0,r.ensureNotNull)(e.getContext("2d")),w.textBaseline="alphabetic",w.textAlign="center"}(),w.font=t,w.measureText(e)}},525668:(e,t,i)=>{"use strict";i.d(t,{changedAll:()=>n,ChartChangesWatcher:()=>o});var s=i(922157),r=i.n(s);const n=3;class o{constructor(e,t,i){this._undoHistoryHasChanges=!1,this._changesMask=0,this._recursiveLoopingGuard=!1,this._handleMetainfoChanged=()=>{this._changesMask=1|this._changesMask},this._recalculateHaveChanges=(e,t)=>{if(!this._recursiveLoopingGuard)try{this._recursiveLoopingGuard=!0;const e=this._undoHistoryHasChanges?1:0;let i=this._lineToolsHaveChanges.value()?2:0;const s=this._changesMask;this._changesMask=e|i,s!==this._changesMask&&(this._changesMask&&(this._chartWidgetCollection.getAll().forEach((e=>{var i;null===(i=e.lineToolsSynchronizer())||void 0===i||i.markAsValidatedBecuaseOfSavingToContent(!!t)})),i=this._lineToolsHaveChanges.value()?2:0,this._changesMask=e|i),this._onValueChanged.fire(0!==this._changesMask))}finally{this._recursiveLoopingGuard=!1}},this._chartWidgetCollection=e,this._undoHistory=e.undoHistory,this._lineToolsHaveChanges=e.lineToolsSynchronizerHasChanges,this._chartSaver=t,this._globalEvents=i,this._onValueChanged=new(r()),this._subscribe()}destroy(){this._unsubscribe(),this._onValueChanged.destroy()}changes(){return this._changesMask}hasChanges(){return this._changesMask>0}getOnChange(){return this._onValueChanged}_subscribe(){this._globalEvents.subscribe("chart_loaded",this._handleChartLoaded,this),this._undoHistory.undoStack().onChange().subscribe(this,this._handleUndoHistoryChange),
this._chartSaver.chartSaved().subscribe(this,this._handleChartSaved),this._lineToolsHaveChanges.subscribe(this._recalculateHaveChanges);this._chartWidgetCollection.metaInfo.name.subscribe(this._handleMetainfoChanged)}_unsubscribe(){this._globalEvents.unsubscribe("chart_loaded",this._handleChartLoaded,this),this._undoHistory.undoStack().onChange().unsubscribe(this,this._handleUndoHistoryChange),this._chartSaver.chartSaved().unsubscribe(this,this._handleChartSaved),this._lineToolsHaveChanges.unsubscribe(this._recalculateHaveChanges);this._chartWidgetCollection.metaInfo.name.unsubscribe(this._handleMetainfoChanged)}_setUndoHistoryHasChanges(e,t){this._undoHistoryHasChanges=e,this._recalculateHaveChanges(e,t)}_handleChartLoaded(){this._setUndoHistoryHasChanges(!1)}_handleUndoHistoryChange(e){e&&!e.customFlag("doesnt_affect_save")&&this._setUndoHistoryHasChanges(!0)}_handleChartSaved(e){e&&this._setUndoHistoryHasChanges(!1,!0)}}},568822:(e,t,i)=>{"use strict";i.d(t,{shiftPressed:()=>g,modifierPressed:()=>f,globalEnvironmentState:()=>v,ChartHotkeysListener:()=>S});var s,r,n,o=i(411589),a=i(180185),l=i(698043),c=i(210596),h=i.n(c),d=i(98747);const u=new(h())(Boolean((null!==(s=o.pressedKeys.value())&&void 0!==s?s:0)&a.Modifiers.Shift)),p=new(h())(Boolean((null!==(r=o.pressedKeys.value())&&void 0!==r?r:0)&a.Modifiers.Mod)),_=new(h())(Boolean((null!==(n=o.pressedKeys.value())&&void 0!==n?n:0)&a.Modifiers.Alt)),m=[a.Modifiers.None,a.Modifiers.Alt,a.Modifiers.Mod,a.Modifiers.Alt+a.Modifiers.Shift];function g(){return u}function f(){return p}function v(){return new d.EnvironmentState({altKey:_.value(),ctrlKey:f().value(),metaKey:f().value(),shiftKey:g().value()})}o.pressedKeys.subscribe(((e=0)=>{u.setValue(Boolean(e&a.Modifiers.Shift)),p.setValue(Boolean(e&a.Modifiers.Mod)),_.setValue(Boolean(e&a.Modifiers.Alt))}));class S{constructor(e,t){this._pressedKeyCode=null,this._boundKeydownHandler=null,this._boundKeyupHandler=null,this._chartWidget=e,this._parent=t,this._boundKeydownHandler=this._keydownHandler.bind(this),this._boundKeyupHandler=this._keyupHandler.bind(this),this._parent.ownerDocument.addEventListener("keydown",this._boundKeydownHandler),this._parent.ownerDocument.addEventListener("keyup",this._boundKeyupHandler)}destroy(){null!==this._boundKeydownHandler&&(this._parent.ownerDocument.removeEventListener("keydown",this._boundKeydownHandler),this._boundKeydownHandler=null),null!==this._boundKeyupHandler&&(this._parent.ownerDocument.removeEventListener("keyup",this._boundKeyupHandler),this._boundKeyupHandler=null)}_keydownHandler(e){this._chartWidget.hasModel()&&window.document.activeElement===window.document.body&&this._chartWidget.isActive()&&(this._handleMoveDrawingsKeyDown(e)||this._handleScrollKeyDown(e)||this._handleZoomKeyDown(e))&&e.preventDefault()}_keyupHandler(e){this._chartWidget.hasModel()&&this._handleScrollKeyUp(e)}_handleMoveDrawingsKeyDown(e){const t=255&(0,a.hashFromEvent)(e),i=this._chartWidget.model();switch(t){case 37:return i.moveSelectedToolsLeft();case 39:return i.moveSelectedToolsRight();case 38:
return i.moveSelectedToolsUp();case 40:return i.moveSelectedToolsDown()}return!1}_handleScrollKeyDown(e){if(null!==this._pressedKeyCode)return!1;const t=(0,a.hashFromEvent)(e),i=255&t,s=(0,a.modifiersFromEvent)(e);let r;if(37===i)r=1;else{if(39!==i)return!1;r=-1}return!(a.isMacKeyboard&&s===a.Modifiers.Mod||!m.includes(s))&&(!(0,l.isNativeUIInteraction)(t,e.target)&&(this._pressedKeyCode=i,s===a.Modifiers.None?this._chartWidget.scrollHelper().moveByBar(r):s===a.Modifiers.Alt||s===a.Modifiers.Mod?this._chartWidget.scrollHelper().move(r):-1===r?this._chartWidget.model().timeScale().scrollToRealtime(!0):this._chartWidget.model().timeScale().scrollToFirstBar(),!0))}_handleScrollKeyUp(e){if(null===this._pressedKeyCode)return!1;const t=(0,a.hashFromEvent)(e);if((0,l.isNativeUIInteraction)(t,e.target))return!1;return(255&t)===this._pressedKeyCode&&(this._pressedKeyCode=null,this._chartWidget.scrollHelper().stopMove(),!0)}_handleZoomKeyDown(e){const t=(0,a.hashFromEvent)(e),i=255&t;if((0,a.modifiersFromEvent)(e)!==a.Modifiers.Mod||(0,l.isNativeUIInteraction)(t,e.target))return!1;const s=this._chartWidget.model();if(38===i)s.zoomIn();else{if(40!==i)return!1;s.zoomOut()}return!0}}},248345:(e,t,i)=>{"use strict";i.d(t,{ChartWidgetApiBase:()=>M});var s=i(650151),r=i(509806),n=i(440097),o=i(638273),a=i(103526),l=i(290728),c=i(802737);class h{constructor(e){this._timeScale=e}coordinateToTime(e){const t=this._timeScale.coordinateToIndex(e);return this._timeScale.indexToTimePoint(t)}barSpacingChanged(){return this._timeScale.barSpacingChanged()}rightOffsetChanged(){return this._timeScale.rightOffsetChanged()}setRightOffset(e){this._timeScale.setRightOffset(e)}setBarSpacing(e){this._timeScale.setBarSpacing(e)}barSpacing(){return this._timeScale.barSpacing()}rightOffset(){return this._timeScale.rightOffset()}width(){return this._timeScale.width()}defaultRightOffset(){return this._timeScale.defaultRightOffset().spawn()}defaultRightOffsetPercentage(){return this._timeScale.defaultRightOffsetPercentage().spawn()}usePercentageRightOffset(){return this._timeScale.usePercentageRightOffset().spawn()}isEmpty(){return this._timeScale.isEmpty()}}var d=i(922157),u=i.n(d),p=i(968381);const _=new n.TranslatedString("change timezone",r.t(null,void 0,i(820505)));class m{constructor(e){this._onTimezoneChanged=new(u()),this._chartWidget=e,this._timezoneProperty=e.properties().childs().timezone,this._timezoneProperty.subscribe(this,(e=>{this._onTimezoneChanged.fire(e.value())})),e.onAboutToBeDestroyed().subscribe(this,(()=>{this._timezoneProperty.unsubscribeAll(this)}),!0)}availableTimezones(){return p.availableTimezones}getTimezone(){const e=this._timezoneProperty.value();return(0,s.ensureDefined)(this.availableTimezones().find((t=>t.id===e)))}setTimezone(e,t){(0,s.assert)((0,p.timezoneIsAvailable)(e),`Incorrect timezone: ${e}`),(null==t?void 0:t.disableUndo)?this._timezoneProperty.setValue(e):this._chartWidget.model().setProperty(this._timezoneProperty,e,_)}onTimezoneChanged(){return this._onTimezoneChanged}}var g=i(620793),f=i(974350),v=i(172687)
;function S(e,t){const i=()=>{e.completed().unsubscribe(null,s),t(!1)},s=()=>{e.error().unsubscribe(null,i),t(!0)};e.completed().subscribe(null,i,!0),e.error().subscribe(null,s,!0)}var y=i(324745),b=i(898005),w=i(358076),P=i(546561),C=i(857425);const T=new n.TranslatedString("change price to bar ratio",r.t(null,void 0,i(569510))),x=new n.TranslatedString("toggle lock scale",r.t(null,void 0,i(121203))),I=new n.TranslatedString("change series style",r.t(null,void 0,i(53438)));class M{constructor(e,t){this._visibleBarsChanged=new(u()),this._crosshairMoved=new(u()),this._ranges=null,this._chartWidget=e,this._activateChart=t,this._timezoneApi=new m(e),this._chartWidget.withModel(this,(()=>{this._chartWidget.model().crossHairSource().moved().subscribe(this,this._onCrosshairMoved)}))}getPriceToBarRatio(){return this._chartWidget.model().model().mainSeriesScaleRatioProperty().value()}setPriceToBarRatio(e,t){const i=this._chartWidget.model(),s=i.model(),r=s.mainSeriesScaleRatioProperty();(null==t?void 0:t.disableUndo)?new v.SetScaleRatioPropertiesCommand(r,e,null,s).redo():i.setScaleRatioProperty(r,e,T)}isPriceToBarRatioLocked(){return this._chartWidget.model().model().mainSeries().priceScale().isLockScale()}setPriceToBarRatioLocked(e,t){const i=this._chartWidget.model(),s=i.model(),r=s.mainSeries().priceScale();(null==t?void 0:t.disableUndo)?new f.SetPriceScaleModeCommand({lockScale:e},r,null,s).redo():i.setPriceScaleMode({lockScale:e},r,x)}onDataLoaded(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().dataEvents().completed())}onSymbolChanged(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().dataEvents().symbolResolved())}onIntervalChanged(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().onIntervalChanged())}onVisibleRangeChanged(){return this._makeSubscriptionFromDelegate(this._visibleBarsChanged)}onChartTypeChanged(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().onStyleChanged())}onSeriesTimeframe(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().dataEvents().seriesTimeFrame())}whenChartReady(e){this._chartWidget.withModel(this,e)}crossHairMoved(){return this._makeSubscriptionFromDelegate(this._crosshairMoved)}setSymbol(e,t){if(e===this.symbol())return void(null==t||t());const i=e=>{!e&&t&&t()},s=this._chartWidget.model().mainSeries().dataEvents();t&&S(s,i),this._activateChart(),this._chartWidget.setSymbol(e)}setResolution(e,t){let i=o.Interval.normalize(e);if(null!==i&&(i=this._chartWidget.model().mainSeries().getSupportedResolution(i)),null===i||i===this.resolution())return void(null==t||t());const s=e=>{!e&&t&&t()},r=this._chartWidget.model().mainSeries().dataEvents();t&&S(r,s),this._activateChart(),this._chartWidget.setResolution(i)}setChartType(e,t){const i=this._chartWidget.model().mainSeries().properties().childs().style;if(i.value()===e)return void(null==t||t());const s=e=>{!e&&t&&t()},r=this._chartWidget.model().mainSeries().dataEvents();t&&S(r,s),
this._chartWidget.model().setChartStyleProperty(i,e,I)}getBarsMarksSources(){return this._chartWidget.model().barsMarksSources()}getAllStudies(){return this._chartWidget.model().model().allStudies(!0).map(g.studyEntityInfo)}getAllPanesHeight(){const e=this._chartWidget.model().model().panes();if(this._chartWidget.isMaximizedPane()){let t=0,i=0;e.forEach((e=>{t+=e.height(),i+=e.stretchFactor()}));const s=i/t;return e.map((e=>Math.round(e.stretchFactor()/s*100)/100))}return e.map((e=>e.height()))}setAllPanesHeight(e){const t=this._chartWidget.model().model(),i=t.panes();(0,s.assert)(i.length===e.length,"There`s a mismatch between the number of heights you provided and the number of panes.");const r=i.reduce(((e,t)=>e+t.stretchFactor()),0)/e.reduce(((e,t)=>e+t));e.forEach(((e,t)=>{const s=e*r;i[t].setStretchFactor(s)})),t.fullUpdate()}maximizeChart(){this._chartWidget.getResizerDetacher().requestFullscreen()}restoreChart(){this._chartWidget.getResizerDetacher().exitFullscreen()}sessions(){return this._chartWidget.model().model().sessions()}getTimeScaleLogicalRange(){return this._chartWidget.model().timeScale().logicalRange()}createStudy(e,t,i,s,r,n){if("function"==typeof r)return console.warn('"createStudy" does not take "callback" parameter anymore'),Promise.resolve(null);if(n=n||{},"string"!=typeof e)return this._createStudy(e);if(n.checkLimit&&!this._chartWidget.model().canCreateStudy())return(0,y.showTooManyStudiesNotice)(),Promise.resolve(null);e=e.toLowerCase();const o=n.disableUndo?this._chartWidget.model().model():this._chartWidget.model(),l=b.StudyMetaInfo.findStudyMetaInfoByDescription(o.studiesMetaData(),e),c=o.createStudyInserter({type:"java",studyId:l.id},[]);if(c.setForceOverlay(!!t),n.priceScale&&c.setPreferredPriceScale(function(e){switch(e){case"no-scale":return"overlay";case"as-series":return"as-series";case"new-left":return"left";case"new-right":return"right";default:throw new Error('The pricescale "'+e+'" is invalid, the only valid options are "no-scale", "as-series", "new-left" and "new-right".')}}(n.priceScale)),n.allowChangeCurrency&&c.setAllowChangeCurrency(!0),n.allowChangeUnit&&c.setAllowChangeUnit(!0),Array.isArray(s)){console.warn("Passing study inputs as an ordered array is now deprecated. Please use an object where keys correspond to the inputs of your study instead.");const e={};for(let t=0;t<l.inputs.length;++t)e[l.inputs[t].id]=s[t];s=e}return c.insert((()=>Promise.resolve({inputs:s||{},parentSources:[]}))).then((e=>(r&&(0,a.applyOverridesToStudy)(e,r),i&&e.setUserEditEnabled(!1),e.id())))}symbolExt(){const e=this._chartWidget.model().mainSeries().symbolInfo();return null===e?null:{symbol:e.name,full_name:e.full_name,exchange:e.exchange,description:e.description,type:e.type,pro_name:e.pro_name,typespecs:e.typespecs,delay:e.delay}}getVisibleRange(){const e={from:0,to:0},t=this._chartWidget.model().timeScale();if(t.isEmpty())return e;const i=t.coordinateToVisibleIndex(0),r=t.coordinateToVisibleIndex(t.width()-1),n=this._convertIndexToPublicTime(r);if(null===n)return e;const o=Math.max((0,
s.ensureNotNull)(t.points().range().value()).firstIndex,i);return e.from=(0,s.ensureNotNull)(this._convertIndexToPublicTime(o)),e.to=n,e}getTimezoneApi(){return this._timezoneApi}exportData(e){const t={...e};return void 0!==t.from&&(t.from=this._convertTimeFromPublic(t.from)),void 0!==t.to&&(t.to=this._convertTimeFromPublic(t.to)),i.e(9498).then(i.bind(i,568058)).then((e=>e.exportData(this._chartWidget.model().model(),t)))}isSelectBarRequested(){return this._chartWidget.selectPointMode().value()!==w.SelectPointMode.None}barTimeToEndOfPeriod(e){const t=this._prepareEndOfPeriodArgs();return(0,c.barTimeToEndOfPeriod)(t.barBuilder,e,t.intervalObj)}endOfPeriodToBarTime(e){const t=this._prepareEndOfPeriodArgs();return(0,c.endOfPeriodToBarTime)(t.barBuilder,e,t.intervalObj)}createAnchoredShape(e,t){if(!0!==P.supportedLineTools[t.shape].isAnchored)return console.warn(`${t.shape} is not an anchored shape. It can be created using createShape or createMultipointShape`),null;const i=this._chartWidget.model().model(),s=i.mainSeries();if(i.timeScale().isEmpty())return null;const r=void 0!==t.ownerStudyId?i.dataSourceForId(t.ownerStudyId):s,n=this._convertPositionPercentToPricedPoint(e,r);return null===n?null:this.createMultipointShape([n],t)}properties(){return this._chartWidget.properties()}setBarSpacing(e){this._chartWidget.model().timeScale().setBarSpacing(e)}scrollChartByBar(e){this._chartWidget.model().scrollChartByBar(e)}mergeAllScales(e){this._chartWidget.model().mergeAllScales(e)}chartPainted(){return this._chartWidget.chartPainted()}axesSizeReady(){for(const e of this._chartWidget.paneWidgets()){for(const t of e.leftPriceAxisesContainer().axes())if(!t.sizeReady())return!1;for(const t of e.rightPriceAxisesContainer().axes())if(!t.sizeReady())return!1}return!0}applyOverrides(e){this._chartWidget.applyOverrides(e)}addOverlayStudy(e,t,i){return this._chartWidget.addOverlayStudy(e,t,i)}lineToolsSynchronizer(){return this._chartWidget.lineToolsSynchronizer()}ranges(){throw new Error("not implemented")}getTimeScale(){return new h(this._chartWidget.model().timeScale())}_destroy(){this._chartWidget.hasModel()&&this._chartWidget.model().crossHairSource().moved().unsubscribeAll(this)}_createStudy(e){return Promise.reject("Pine Script™ and java studies are not supported")}_convertTimeToPublic(e){return this._getTimeConverter().convertInternalTimeToPublicTime(e)}_convertIndexToPublicTime(e){return null===this._chartWidget.model().mainSeries().symbolInfo()?null:this._getTimeConverter().convertTimePointIndexToPublicTime(e)}_getDefaultCreateMultipointShapeOptions(){return{filled:!0}}_convertPositionPercentToPricedPoint(e,t){const i=this._chartWidget.model().timeScale(),s=t.priceScale(),r=t.firstValue();if(null==r||!isFinite(r)||null===s)return null;const n=i.coordinateToIndex(e.x*i.width()),o=i.indexToTimePoint(n);if(null===o)return null;return{price:s.coordinateToPrice(e.y*s.height(),r),time:o}}_convertTimeFromPublic(e){return this._getTimeConverter().convertPublicTimeToInternalTime(e)}_getTimeConverter(){
const e=this._chartWidget.model().mainSeries();return(0,C.getChartWidgetApiTimeConverter)(e.interval(),(0,s.ensureNotNull)(e.symbolInfo(),"main series symbol info"),this._chartWidget.model().model())}_onCrosshairMoved(e){const t=this._convertIndexToPublicTime(e.index);null!==t&&this._crosshairMoved.fire({price:e.price,time:t})}_makeSubscriptionFromDelegate(e){return{subscribe:e.subscribe.bind(e),unsubscribe:e.unsubscribe.bind(e),unsubscribeAll:e.unsubscribeAll.bind(e)}}_prepareEndOfPeriodArgs(){const e=this._chartWidget.model().model(),t=e.timezone(),i=(0,s.ensureNotNull)(e.mainSeries().symbolInfo()),r=e.mainSeries().interval(),n=new l.SessionInfo(t,i.session,i.session_holidays,i.corrections);return{barBuilder:(0,l.newBarBuilder)(r,n,n),intervalObj:o.Interval.parse(r)}}}},857425:(e,t,i)=>{"use strict";i.d(t,{getChartWidgetApiTimeConverter:()=>o});var s=i(650151),r=i(85761);const n=new Map;function o(e,t,i){const s=function(e,t){return e+t.session+t.timezone+(t.corrections||"")+(t.session_holidays||"")}(e,t);let o=n.get(s);return void 0!==o||(o=new a((0,r.createDwmAligner)(e,t),i),n.set(s,o)),o}class a{constructor(e,t){this._dwmAligner=e,this._chartModel=t}convertPublicTimeToInternalTime(e){return null!==this._dwmAligner?this._dwmAligner.timeToSessionStart(1e3*e)/1e3:e}convertInternalTimeToPublicTime(e){return null!==this._dwmAligner?this._dwmAligner.timeToExchangeTradingDay(1e3*e)/1e3:e}convertTimePointIndexToPublicTime(e){let t=this.convertTimePointIndexToInternalTime(e);return null!==t&&(t=this.convertInternalTimeToPublicTime(t)),t}convertTimePointIndexToInternalTime(e){const t=this._chartModel.timeScale();if(t.isEmpty())return null;const i=t.points(),{firstIndex:r,lastIndex:n}=(0,s.ensureNotNull)(i.range().value());let o=null;if(r<=e&&e<=n)o=i.valueAt(e);else if(e>n){const i=this._chartModel.mainSeries().syncModel();if(null!==i){const r=(0,s.ensureNotNull)(t.indexToTimePoint(n));o=i.projectTime(r,e-n)}}return o}}},886694:(e,t,i)=>{"use strict";i.d(t,{ChartWidgetBase:()=>Di});var s=i(327714),r=i(650151),n=i(509806),o=i(817808);function a(e,t){const i=Object.create(Object.getPrototypeOf(e));for(const s of t)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s]);return i}var l=i(870122),c=i(601227),h=i(114122),d=i(559410),u=i(421721),p=i(374589),_=i(486028),m=i(96401),g=i(902864);var f=i(898005),v=i(656788),S=i(550967);const y=(0,o.getLogger)("Chart.Studies.StudyMetaInfoRepository",{color:"#606"});class b{constructor(e){this._nextRequestNumber=1,this._rawStudiesMetaInfo=[],this._isReady=!1,this._metaInfoQueryQueue=[],this._javaMetaInfoQueryQueue=[],this._javaStudiesMetaInfo=[],this._pineMetaInfoCache=[],this._studiesMigrations=[],this._gateway=e}requestMetaInfo(){this._requestStarted();const e=this._makeNextRequestId();return y.logNormal(`Requesting metainfo #${e}`),new Promise((t=>{y.logNormal(`Requesting studies metadata #${e}`),this._gateway.requestMetadata(e,(i=>{y.logNormal(`Requesting studies metadata #${e} finished`);const s=i.params[1].metainfo.slice();this._processLibraryMetaInfo(s),this._requestFinished(),
t()}))}))}findById(e){if(!this._isReady)return this._enqueueMetaInfoQuery(e);const t=this._findStudyMetaInfo(e);return null!==t?Promise.resolve(t):"pine"===e.type?this._compilePine(e):Promise.reject(`unexpected study id=${e.studyId} with type=${e.type}`)}findByIdSync(e){return this._findStudyMetaInfo(e)}isReady(){return this._isReady}findAllJavaStudies(){return this._isReady?Promise.resolve(this._javaStudiesMetaInfo):this._enqueueJavaMetaInfoQuery()}getInternalMetaInfoArray(){return this._javaStudiesMetaInfo}getMigrations(){return this._studiesMigrations}addPineMetaInfo(e){return P(this._pineMetaInfoCache,e)}async getLatestMetaInfoForPineStudy(e,t){return null}_processMigrations(e){throw new Error("not implemented")}_processSiteMetaInfo(e,t){throw new Error("not implemented")}_processLibraryMetaInfo(e){for(const t of e)w(t),P(this._javaStudiesMetaInfo,t);this._javaStudiesMetaInfo=this._javaStudiesMetaInfo.sort(((e,t)=>{const i=e.description_localized||e.description,s=t.description_localized||t.description;return i>s?1:i<s?-1:0})),f.StudyMetaInfo.overrideDefaults(this._javaStudiesMetaInfo)}_requestStarted(){this._isReady=!1,this._javaStudiesMetaInfo=[],this._pineMetaInfoCache=[],this._studiesMigrations=[],this._rawStudiesMetaInfo=[]}_requestFinished(){this._isReady=!0,this._processPendingMetaInfoQueries(),this._processPendingFullMetaInfoQueries()}_enqueueMetaInfoQuery(e){return new Promise((t=>{this._metaInfoQueryQueue.push({studyDescriptor:e,resolver:t})}))}_enqueueJavaMetaInfoQuery(){return new Promise((e=>{this._javaMetaInfoQueryQueue.push({resolver:e})}))}_processPendingMetaInfoQueries(){for(;this._metaInfoQueryQueue.length;){const e=this._metaInfoQueryQueue.shift();this.findById(e.studyDescriptor).then(e.resolver)}}_processPendingFullMetaInfoQueries(){for(;this._javaMetaInfoQueryQueue.length;){this._javaMetaInfoQueryQueue.shift().resolver(this._javaStudiesMetaInfo)}}_findStudyMetaInfo(e){return"java"===e.type?this._javaStudiesMetaInfo.find((t=>t.id===e.studyId))||null:this._pineMetaInfoCache.find((t=>t.scriptIdPart===e.pineId&&(void 0===e.pineVersion||(0,r.ensureDefined)(t.pine).version===e.pineVersion)))||null}_makeNextRequestId(){return"metadata_"+this._nextRequestNumber++}_compilePine(e){throw new Error("unsupported")}}function w(e){e.description_localized=n.t(e.description,{context:"study"},i(168716))}function P(e,t){const i=new f.StudyMetaInfo(t);(0,v.migrateMetaInfoAndPropState)(i);let s=!0;const r=e.findIndex((e=>e.id===i.id));if(-1===r)e.push(i);else{const t=e[r],n=void 0!==t.pine?S.Version.parse(t.pine.version):null,o=void 0!==i.pine?S.Version.parse(i.pine.version):null;null===o||null===n||o.isGreaterOrEqual(n)?(t.removeDefaults(),e[r]=i):s=!1}return s&&i.createDefaults(),i}var C=i(232468),T=i(663890),x=i(508547),I=i(706486),M=i(316230),L=(i(863697),i(86441)),A=i(676507),k=i(812297),E=i(440097),D=i(242786),B=i(606615),V=i(777277),R=i(927079),N=i(98747),O=i(622200),F=i(358076),W=i(820958),z=i(685023),H=i(289763),U=i(664114),j=i(779292),G=i(9316),q=i(832164),$=i(89494),Y=i(574570)
;const K=parseInt($.labelheight),Z=parseInt($.bottommargin);function X(e){return e/11}class J{constructor(){this._wrapper=document.createElement("div"),this._element=document.createElement("div"),this._labelElement=document.createElement("div"),this._gearElement=document.createElement("div"),this._currentScale=1,this._info=null,this._mode="auto",this._wrapper.appendChild(this._element),this._wrapper.classList.add($.wrapper),this._element.classList.add($.label),this._labelElement.className=$.symbol,this._element.appendChild(this._labelElement),this._gearElement.className=$.gear,this._gearElement.innerHTML=q,this._element.appendChild(this._gearElement)}getElement(){return this._wrapper}setMode(e){this._mode!==e&&(this._mode=e)}align(e,t){const i=X(t);Math.abs(i-this._currentScale)>.1&&(this._currentScale=i,Math.abs(this._currentScale-1)>.1?this._element.style.transform=`scale(${this._currentScale})`:(this._currentScale=1,this._element.style.transform=""))}drawLabelForScreenshot(e,t){if(null===this._info||"gear"===this._mode)return;const i=(0,j.makeFont)(t.fontSize,Y.CHART_FONT_FAMILY);e.fillStyle=G.themes[t.theme].getThemedColor("color-price-axis-label-back"),e.globalAlpha=.5,e.beginPath();const s=X(t.fontSize)*K/2,r=(0,L.point)(t.offset+t.width/2,t.height/2);e.arc(r.x,r.y,s,0,2*Math.PI,!0),e.fill(),e.globalAlpha=1,e.fillStyle=G.themes[t.theme].getThemedColor("color-price-axis-label-text"),e.textAlign="center",e.font=i,e.textBaseline="middle",e.fillText(this._info.label,r.x,r.y)}setAxisNameInfo(e){this._info=e,null!==e&&(this._labelElement.textContent=e.label)}static height(e){return(K+Z)*e}}var Q=i(922157),ee=i.n(Q),te=i(282926),ie=i(72304);const se={enableTooltip:!0,showLabels:!0,enableMenu:!0,enableHighlight:!0};class re{constructor(e,t,i,r,n,o=null){this._invalidated=!0,this._size=(0,s.size)({width:0,height:0}),this._offset=0,this._axisInfo=null,this._onLabelHovered=new(ee()),this._highlighted=!1,this._labelMode="auto",this._fixedLabelMode=null,this._canvasConfiguredHandler=()=>this.update(),this._timeAxisWidget=o,this._isLeft="left"===e,this._rendererOptionsProvider=r.rendererOptionsProvider,this._sourcesTitlesProvider=r.sourcesTitlesProvider,this._contextMenuItemsProvider=r.contextMenuItemsProvider,this._backgroundBasedTheme=r.backgroundBasedTheme,this._getBackgroundTopColor=r.getBackgroundTopColor,this._getBackgroundBottomColor=r.getBackgroundBottomColor,this._showHorizontalBorder=Boolean(r.showHorizontalBorder),this._properties=t,this._axisInfo=i,this._labelOptions={...se,...n},this._properties.lineColor.subscribe(this,this._onPropertyChanged),this._cell=document.createElement("div"),this._cell.classList.add($["price-axis-stub"]),this._labelOptions.enableTooltip&&this._cell.classList.add("apply-common-tooltip"),this._cell.style.width="25px",this._cell.style.height="100%",this._cell.style.position="absolute",this._cell.style.left="0",this._cell.style.overflow="hidden",this._labelOptions.showLabels?(this._label=new J,this._label.setAxisNameInfo(this._axisInfo),this._cell.appendChild(this._label.getElement()),
this._labelOptions.enableTooltip&&(0,ie.setTooltipData)(this._cell,"text",(e=>this._tooltipContent()))):this._label=null,this._mouseEventHandler=new z.MouseEventHandler(this._cell,this,{treatHorzTouchDragAsPageScroll:!0,treatVertTouchDragAsPageScroll:!0}),this._canvasBinding=(0,H.createBoundCanvas)(this._cell,(0,s.size)({width:16,height:16})),this._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler);const a=this._canvasBinding.canvasElement;a.style.position="absolute",a.style.left="0",a.style.top="0"}destroy(){this._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler),this._canvasBinding.dispose(),this._properties.lineColor.unsubscribe(this,this._onPropertyChanged),this._mouseEventHandler.destroy()}mouseEnterEvent(e){this._mouseOrTouchEnterEvent(e)}touchStartEvent(e){this._mouseOrTouchEnterEvent(e)}mouseLeaveEvent(e){this._mouseOrTouchLeaveEvent(e)}touchEndEvent(e){this._mouseOrTouchLeaveEvent(e)}mouseClickEvent(e){this._mouseClickOrTapEvent(e)}tapEvent(e){this._mouseClickOrTapEvent(e)}update(){this._invalidated=!0}getElement(){return this._cell}onLabelHovered(){return this._onLabelHovered}setSizeAndOffset(e,t){(0,s.equalSizes)(this._size,e)||(this._size=e,this._canvasBinding.resizeCanvasElement(e),this._cell.style.width=`${e.width}px`,this._cell.style.minWidth=`${e.width}px`,this._cell.style.height=`${e.height}px`,this._invalidated=!0),this._offset!==t&&(this._offset=t,this._cell.style.left=`${t}px`)}paint(e){if(e<I.InvalidationLevel.Light&&!this._invalidated)return;if(0===this._size.width||0===this._size.height)return;this._invalidated=!1,this._canvasBinding.applySuggestedBitmapSize();const t=(0,H.getBindingPixelRatio)(this._canvasBinding),i=(0,H.getContext2D)(this._canvasBinding.canvasElement);this._drawBackground(i,t),this._drawVerticalBorder(i,t),this._showHorizontalBorder&&this._drawHorizontalBorder(i,t)}getWidth(){return this._size.width}getImage(){const e=(0,H.createDisconnectedCanvas)(document,this._size),t=(0,H.getPrescaledContext2D)(e),i=this._getBackgroundTopColor(),s=this._getBackgroundBottomColor();return i===s?(0,H.clearRect)(t,0,0,this._size.width,this._size.height,i):(0,U.clearRectWithGradient)(t,0,0,this._size.width,this._size.height,i,s),t.drawImage(this._canvasBinding.canvasElement,0,0,this._size.width,this._size.height),null!==this._label&&this._label.drawLabelForScreenshot(t,{offset:0,width:this._size.width,height:this._size.height,fontSize:this._properties.fontSize.value(),theme:this._backgroundBasedTheme.value()}),e}setLabelMode(e){e!==this._labelMode&&(this._labelMode=e,null!==this._label&&this._label.setMode(e),this._cell.classList.toggle($["fixed-gear"],"gear"===e),this._cell.classList.toggle($["fixed-symbol"],"symbol"===e),this._cell.classList.toggle("apply-common-tooltip","symbol"!==e&&this._labelOptions.enableTooltip))}_setHighlighted(e){this._labelOptions.enableHighlight&&(this._onLabelHovered.fire("stubButton",e),this._highlighted!==e&&(this._highlighted=e,this._invalidated=!0))}_onPropertyChanged(){this._invalidated=!0}
_drawVerticalBorder(e,t){const i=this._size.width;e.save(),e.fillStyle=this._properties.lineColor.value();const s=Math.max(1,Math.floor(this._rendererOptionsProvider.options().borderSize*t)),r=this._isLeft?Math.floor(i*t)-s:0,n=Math.ceil(this._size.height*t);e.fillRect(r,0,s,n+1),e.restore()}_drawHorizontalBorder(e,t){var i,s;e.save(),e.fillStyle=null!==(s=null===(i=this._timeAxisWidget)||void 0===i?void 0:i.lineColor())&&void 0!==s?s:this._properties.lineColor.value();const r=Math.max(1,Math.floor(this._rendererOptionsProvider.options().borderSize*t)),n=Math.ceil(this._size.width*t),o=this._isLeft?0:r;e.fillRect(o,0,n-r,r),e.restore()}_drawBackground(e,t){const i=Math.ceil(t*this._size.width),s=Math.ceil(t*this._size.height),r=this._getBackgroundTopColor(),n=this._getBackgroundBottomColor();if(r===n?(0,H.clearRect)(e,0,0,i+1,s+1,r):(0,U.clearRectWithGradient)(e,0,0,i+1,s+1,r,n),this._highlighted){const t=G.themes[this._backgroundBasedTheme.value()].getThemedColor("color-price-axis-highlight");(0,H.fillRect)(e,0,0,i+1,s+1,t),e.globalAlpha=1}}_tooltipContent(){return this._sourcesTitlesProvider().join("\n")}_mouseOrTouchEnterEvent(e){null!==this._label&&"symbol"!==this._labelMode&&this._labelOptions.enableHighlight&&this._setHighlighted(!0)}_mouseOrTouchLeaveEvent(e){"symbol"!==this._labelMode&&this._setHighlighted(!1)}_mouseClickOrTapEvent(e){if(e.preventDefault(),null!==this._fixedLabelMode||"symbol"===this._labelMode||!this._labelOptions.enableMenu||!this._labelOptions.showLabels)return void te.ContextMenuManager.hideAll();this._fixedLabelMode=this._labelMode,this.setLabelMode("gear");const t=this._cell.getBoundingClientRect();te.ContextMenuManager.showMenu(this._contextMenuItemsProvider(),{clientX:this._isLeft?t.left:t.right,clientY:t.top,attachToXBy:this._isLeft?"left":"right",attachToYBy:"bottom"},{statName:"PriceScaleLabelContextMenu",doNotCloseOn:this.getElement()},{menuName:"PriceScaleLabelContextMenu"},(()=>{this.setLabelMode((0,r.ensureNotNull)(this._fixedLabelMode)),this._fixedLabelMode=null}))}}var ne=i(16397);class oe{constructor(e,t,i,r,n,o=null){this._axises=[],this._stubs=[],this._size=(0,s.size)({width:0,height:0}),this._onLabelHovered=new(ee()),this._scalesProperties=e,this._priceAxisWidgetFactory=i,this._timeAxisWidget=o,this._rendererOptionsProvider=r.rendererOptionsProvider,this._titlesProvider=r.titlesProvider,this._stubContextMenuProvider=r.stubContextMenuProvider,this._backgroundBasedTheme=r.backgroundBasedTheme,this._getBackgroundTopColor=r.getBackgroundTopColor,this._getBackgroundBottomColor=r.getBackgroundBottomColor,this._showHorisontalBorder=Boolean(r.showHorizontalBorder),this._labelsOptions={...se,...n};const a=this._scalesProperties.childs();this._stubProperties={lineColor:a.lineColor,fontSize:a.fontSize},this._side=t,this._cell=document.createElement("td"),this._cell.classList.add("chart-markup-table","price-axis-container"),this._cell.style.width="25px",this._cell.style.position="relative"}destroy(){this.setScales([],0,0,0)}onLabelHovered(){return this._onLabelHovered}
setScales(e,t,i,s){for(;e.length>this._axises.length&&this._axises.length<t;){const e=(0,ne.getPriceAxisNameInfo)(this._side,this._axises.length),t=this._priceAxisWidgetFactory(this._side,this._rendererOptionsProvider,this._scalesProperties,e,this._backgroundBasedTheme);this._axises.push(t),this._cell.appendChild(t.getElement())}for(;e.length<this._axises.length;){const e=(0,r.ensureDefined)(this._axises.pop());this._cell.removeChild(e.getElement()),e.destroy()}for(let t=0;t<this._axises.length;++t)this._axises[t].setPriceScale(e[t]);const n=t-e.length,o=Math.max(0,n);for(;this._stubs.length>o;){const e=(0,r.ensureDefined)(this._stubs.pop());e.onLabelHovered().unsubscribeAll(this),this._cell.removeChild(e.getElement()),e.destroy()}for(;this._stubs.length<n;){const e=this._labelsOptions.showLabels?(0,ne.getPriceAxisNameInfo)(this._side,this._stubs.length):null,t=new re(this._side,this._stubProperties,e,this._stubParams(this._stubs.length),this._labelsOptions,this._timeAxisWidget);t.onLabelHovered().subscribe(this,((t,i)=>{this._labelsOptions.showLabels&&this._labelsOptions.enableHighlight&&this._onLabelHovered.fire({owner:t,axis:(0,r.ensureNotNull)(e)},i)})),this._stubs.push(t),this._cell.appendChild(t.getElement())}const a=this._labelsOptions.enableMenu;1===s?this._stubs.forEach(((e,t)=>e.setLabelMode(a?"gear":"symbol"))):this._stubs.forEach(((e,t)=>e.setLabelMode(t<i&&a?"auto":"symbol")))}getElement(){return this._cell}updateCurrencyLabels(){return this._axises.forEach((e=>e.updateCurrencyLabel()))}optimalWidths(){return this._axises.map((e=>e.optimalWidth()))}setSizes(e,t){this._size=(0,s.size)({width:t.reduce(((e,t)=>e+t),0),height:e}),this._cell.style.width=this._size.width+"px",this._cell.style.minWidth=this._size.width+"px",this._cell.style.height=this._size.height+"px",t.length!==this._axises.length+this._stubs.length&&(0,r.assert)(t.length===this._axises.length+this._stubs.length,"Widgets count should be the same as widths one");let i=0;this._forEachWidgetFromLeft(((r,n)=>{const o=t[n];r.setSizeAndOffset((0,s.size)({width:o,height:e}),i),i+=o}))}update(){this._axises.forEach((e=>e.update())),this._stubs.forEach((e=>e.update()))}paint(e){this._axises.forEach(((t,i)=>t.paint(e(i)))),this._stubs.forEach(((t,i)=>t.paint(e(i))))}paintStubs(e){this._stubs.forEach((t=>t.paint(e)))}restoreDefaultCursor(){this._axises.forEach((e=>e.restoreDefaultCursor()))}getWidth(){return this._size.width}findAxisWidgetForScale(e){const t=this._axises.find((t=>t.priceScale()===e));return void 0===t?null:t}getScreenshotData(){const e=this._getImage();return{canvas:e,content:e.toDataURL(),contentHeight:this._size.height,contentWidth:this._size.width}}getImage(){return this._getImage()}slotsCount(){return this._axises.length+this._stubs.length}highlightPriceAxisByLabel(e){this._axises.forEach((t=>{const i=t.axisInfo();t.setHighlighted(null!==i&&i.equals(e))}))}axes(){return this._axises}_stubParams(e){return{rendererOptionsProvider:this._rendererOptionsProvider,backgroundBasedTheme:this._backgroundBasedTheme,
sourcesTitlesProvider:()=>this._titlesProvider(this._side,e),contextMenuItemsProvider:()=>this._stubContextMenuProvider(this._side,e),getBackgroundTopColor:this._getBackgroundTopColor,getBackgroundBottomColor:this._getBackgroundBottomColor,showHorizontalBorder:this._showHorisontalBorder}}_getImage(){const e=(0,H.createDisconnectedCanvas)(document,this._size),t=(0,H.getPrescaledContext2D)(e);let i=0;return this._forEachWidgetFromLeft(((e,s)=>{const r=e.getWidth();0!==r&&0!==this._size.height&&(t.drawImage(e.getImage(),i,0,r,this._size.height),i+=r)})),e}_forEachWidgetFromLeft(e){const t=[...this._axises,...this._stubs],i="left"===this._side,s=i?-1:t.length,r=i?-1:1;for(let n=i?t.length-1:0;n!==s;n+=r)e(t[n],n,t)}}var ae=i(256776),le=i(32133),ce=i(724377),he=i(602564),de=i(702054),ue=i(111982),pe=i(218954),_e=i(855824),me=i(781165);const ge=(0,A.getHexColorByName)("color-white"),fe=(0,A.getHexColorByName)("color-cold-gray-100"),ve=(0,he.applyTransparency)((0,A.getHexColorByName)("color-white"),60),Se=(0,A.getHexColorByName)("color-cold-gray-800"),ye=(0,he.applyTransparency)((0,A.getHexColorByName)("color-black"),60);function be(e){const t=(0,he.isHexColor)(e)?e.toLowerCase():(0,ce.rgbToHexString)((0,ce.parseRgb)(e));return de.watchedTheme.value()===ue.StdTheme.Light?t===ge?fe:ve:"#181c27"===t?Se:ye}class we{constructor(){this._width=null,this._currencyInfo=null,this._unitInfo=null,this._measureUnitIdInfo=null,this._fontSize=0,this._backgroundColor="",this._hoverColor="",this._fadeEndColor="",this._hoveredLabel=null,this._currencyAndUnitLabelsWrapper=document.createElement("div"),this._currencyAndUnitLabelsWrapper.className=me["price-axis-currency-label-wrapper"],this._currencyAndUnitLabelsWrapper.setAttribute("data-name","currency-unit-label-wrapper"),this._controlsContainer=document.createElement("div"),this._controlsContainer.className=me["price-axis-currency-label"],this._currencyAndUnitLabelsWrapper.appendChild(this._controlsContainer),this._currencyLabelDiv=document.createElement("div"),this._currencyLabelDiv.className=me.row,this._currencyLabelDiv.classList.add("apply-common-tooltip"),(0,ie.setTooltipData)(this._currencyLabelDiv,"text",(e=>this._currencyTooltipContent())),this._currencyText=document.createElement("span"),this._currencyText.className=me["price-axis-currency-label-text"],this._currencyLabelDiv.appendChild(this._currencyText),this._currencyArrowDown=document.createElement("span"),this._currencyArrowDown.className=me["price-axis-currency-label-arrow-down"],this._currencyArrowDown.innerHTML=_e,this._currencyLabelDiv.appendChild(this._currencyArrowDown),this._measureUnitIdLabelDiv=document.createElement("div"),this._measureUnitIdLabelDiv.className=me.row,this._measureUnitIdLabelDiv.classList.add("apply-common-tooltip"),this._measureUnitIdLabelDiv.classList.add("readonly"),(0,ie.setTooltipData)(this._measureUnitIdLabelDiv,"text",(e=>this._measureUnitIdTooltipContent())),this._measureUnitIdText=document.createElement("span"),this._measureUnitIdText.className=me["price-axis-currency-label-text"],
this._measureUnitIdLabelDiv.appendChild(this._measureUnitIdText),this._unitLabelDiv=document.createElement("div"),this._unitLabelDiv.className=me.row,this._unitLabelDiv.classList.add("apply-common-tooltip"),(0,ie.setTooltipData)(this._unitLabelDiv,"text",(e=>this._unitTooltipContent())),this._unitText=document.createElement("span"),this._unitText.className=me["price-axis-currency-label-text"],this._unitLabelDiv.appendChild(this._unitText),this._unitArrowDown=document.createElement("span"),this._unitArrowDown.className=me["price-axis-currency-label-arrow-down"],this._unitArrowDown.innerHTML=_e,this._unitLabelDiv.appendChild(this._unitArrowDown),this._controlsContainer.appendChild(this._currencyLabelDiv),this._controlsContainer.appendChild(this._measureUnitIdLabelDiv),this._controlsContainer.appendChild(this._unitLabelDiv),this._fadeDiv=document.createElement("div"),this._fadeDiv.className=me["price-axis-currency-label-fade"],this._currencyAndUnitLabelsWrapper.appendChild(this._fadeDiv);const e=e=>{null!==this._hoveredLabel&&this._hoveredLabel!==e&&(this._hoveredLabel.style.background=""),e&&e.classList.contains("readonly")||(this._hoveredLabel=e,""===this._hoverColor&&(this._hoverColor=be(this._backgroundColor)),null!==e&&(e.style.background=this._hoverColor))};this._currencyLabelDiv.addEventListener("mouseover",(()=>e(this._currencyLabelDiv))),this._currencyLabelDiv.addEventListener("mouseout",(()=>e(null))),this._unitLabelDiv.addEventListener("mouseover",(()=>e(this._unitLabelDiv))),this._unitLabelDiv.addEventListener("mouseout",(()=>e(null))),this.disableCurrency(),this.disableUnit()}element(){return this._currencyAndUnitLabelsWrapper}currencyLabelElement(){return this._currencyLabelDiv}unitLabelElement(){return this._unitLabelDiv}measureUnitIdLabelElement(){return this._measureUnitIdLabelDiv}isEnabled(){return this.currencyLabelEnabled()||this.unitLabelEnabled()||this.measureUnitIdLableEnabled()}width(){if(null!==this._width)return this._width;let e=0;if(this.currencyLabelEnabled()){const t=this._currencyText.getBoundingClientRect(),i=this._currencyArrowDown.getBoundingClientRect();e=Math.max(e,t.width+i.width+2*this._textMarginAndPadding())}if(this.measureUnitIdLableEnabled()){const t=this._measureUnitIdText.getBoundingClientRect();e=Math.max(e,t.width+2*this._textMarginAndPadding())}if(this.unitLabelEnabled()){const t=this._unitText.getBoundingClientRect(),i=this._unitArrowDown.getBoundingClientRect();e=Math.max(e,t.width+i.width+2*this._textMarginAndPadding())}return this._width=e}drawLabel(e,t,i){var s,r,n;if(!this.isEnabled())return;const o=[];o.push(this.currencyLabelEnabled()&&null!==(s=this._currencyText.textContent)&&void 0!==s?s:""),o.push(this.measureUnitIdLableEnabled()&&null!==(r=this._measureUnitIdText.textContent)&&void 0!==r?r:""),o.push(this.unitLabelEnabled()&&null!==(n=this._unitText.textContent)&&void 0!==n?n:""),e.font=(0,j.makeFont)(this._fontSize,Y.CHART_FONT_FAMILY);const a=new ae.TextWidthCache,l=o.map((t=>""===t?0:a.yMidCorrection(e,t))),c=Math.round(Number(me.css_wrapper_margin)*i),h=(0,
pe.ceiledEven)(t*i)-2*c,d=Math.round(this.labelBottom()*i);e.fillStyle=this._backgroundColor,e.fillRect(c,0,h,d);const u=Math.round(Number(me.css_fade_height)*i),p=e.createLinearGradient(0,d,0,d+u);p.addColorStop(0,this._backgroundColor),p.addColorStop(1,this._fadeEndColor),e.fillStyle=p;const _=Math.round(Number(me.css_value_currency_label_radius)*i);(0,U.drawRoundRect)(e,c,d,h,u,[0,0,_,_]),e.fill(),e.fillStyle=this._controlsContainer.style.color,e.textBaseline="middle",e.textAlign="left";const m=Math.round(Number(me.css_first_row_top_padding)*i),g=Math.round(this._textMarginAndPadding()*i)+c,f=this._oneLineHeight()/2*i;let v=m+f;o.forEach(((t,s)=>{""!==t&&((0,H.drawScaled)(e,i,(()=>e.fillText(t,g/i,(v+l[s])/i))),v=Math.ceil(v+2*f))}))}setHidden(e){this._controlsContainer.classList.toggle(me.hidden,e),this._fadeDiv.classList.toggle(me.hidden,e)}enableCurrency(){this._currencyLabelDiv.classList.remove("js-hidden"),this._width=null,this._updateVisibility()}disableCurrency(){this._currencyLabelDiv.classList.add("js-hidden"),this._width=null,this._updateVisibility()}enableUnit(){this._unitLabelDiv.classList.remove("js-hidden"),this._width=null,this._updateVisibility()}disableUnit(){this._unitLabelDiv.classList.add("js-hidden"),this._width=null,this._updateVisibility()}enableMeasureUnitId(){this._measureUnitIdLabelDiv.classList.remove("js-hidden"),this._width=null,this._updateVisibility()}disableMeasureUnitId(){this._measureUnitIdLabelDiv.classList.add("js-hidden"),this._width=null,this._updateVisibility()}currencyLabelEnabled(){return!this._currencyLabelDiv.classList.contains("js-hidden")}unitLabelEnabled(){return!this._unitLabelDiv.classList.contains("js-hidden")}measureUnitIdLableEnabled(){return!this._measureUnitIdLabelDiv.classList.contains("js-hidden")}currencyConversionAvailable(){return!this._currencyLabelDiv.classList.contains("readonly")}unitConversionAvailable(){return!this._unitLabelDiv.classList.contains("readonly")}setCurrencyInfo(e){if(this._currencyInfo===e)return!1;this._currencyInfo=e;const t=null===e.selectedCurrency?n.t(null,void 0,i(795093)):(0,r.ensureDefined)(e.displayedValues.get(e.selectedCurrency));return this._currencyText.textContent!==t&&(this._currencyText.textContent=t,this._width=null),this._currencyArrowDown.classList.contains("js-hidden")!==e.readOnly&&(this._currencyArrowDown.classList.toggle("js-hidden",e.readOnly),this._currencyLabelDiv.classList.toggle("readonly",e.readOnly),this._width=null),!0}setUnitInfo(e){if(null!==this._unitInfo&&this._unitInfo.selectedUnit===e.selectedUnit&&0===this._unitInfo.availableGroups.size==(0===e.availableGroups.size)&&this._unitInfo.originalUnits.size===e.originalUnits.size)return this._unitInfo=e,!1;this._unitInfo=e;const t=null===e.selectedUnit?n.t(null,void 0,i(795093)):(0,r.ensureDefined)(e.names.get(e.selectedUnit));return this._unitText.textContent!==t&&(this._unitText.textContent=t,this._width=null),
this._unitArrowDown.classList.contains("js-hidden")!==(0===e.availableGroups.size)&&(this._unitArrowDown.classList.toggle("js-hidden",0===e.availableGroups.size),this._unitLabelDiv.classList.toggle("readonly",0===e.availableGroups.size),this._width=null),!0}setMeasureUnitIdInfo(e){if(this._measureUnitIdInfo===e)return!1;this._measureUnitIdInfo=e;const t=null===e.selectedMeasureUnitId?n.t(null,void 0,i(795093)):(0,r.ensureDefined)(e.names.get(e.selectedMeasureUnitId));return this._measureUnitIdText.textContent!==t&&(this._measureUnitIdText.textContent=t,this._width=null),this._measureUnitIdLabelDiv.classList.contains("js-hidden")!==(0===e.names.size)&&(this._measureUnitIdLabelDiv.classList.toggle("js-hidden",0===e.names.size),this._width=null),!0}updateColors(e,t){this._controlsContainer.style.color=t,this._backgroundColor!==e&&(this._backgroundColor=e,this._fadeEndColor=(0,he.applyTransparency)(e,100),this._hoverColor=be(e)),this._controlsContainer.style.background=this._backgroundColor,null!==this._hoveredLabel&&(this._hoveredLabel.style.background=this._hoverColor),this._fadeDiv.style.background=`linear-gradient(${this._backgroundColor}, ${this._fadeEndColor})`}currencyInfo(){return this._currencyInfo}unitInfo(){return this._unitInfo}measureUnitIdInfo(){return this._measureUnitIdInfo}setFontSize(e){this._fontSize!==e&&(this._fontSize=e,this._currencyLabelDiv.style.fontSize=e+"px",this._measureUnitIdLabelDiv.style.fontSize=e+"px",this._unitLabelDiv.style.fontSize=e+"px",this._width=null,this._setLineHeight(this._oneLineHeight()))}labelBottom(){const e=this._oneLineHeight();let t=(this.currencyLabelEnabled()?e:0)+(this.measureUnitIdLableEnabled()?e:0)+(this.unitLabelEnabled()?e:0);return t>0&&(t+=Number(me.css_first_row_top_padding)),t}_textMarginAndPadding(){return Number(me.css_row_left_right_margin)+Number(me.css_row_left_right_padding)}_currencyTooltipContent(){const e=this._currencyInfo;return null===e?"":null===e.selectedCurrency?Array.from(e.currencies).map((t=>(0,r.ensureDefined)(e.displayedValues.get(t)))).join(", "):e.displayedValues.get(e.selectedCurrency)||""}_unitTooltipContent(){const e=this._unitInfo;return null===e?"":null===e.selectedUnit?Array.from(e.units).map((t=>(0,r.ensureDefined)(e.names.get(t)))).join(", "):e.descriptions.get(e.selectedUnit)||""}_measureUnitIdTooltipContent(){const e=this._measureUnitIdInfo;return null===e?"":null===e.selectedMeasureUnitId?Array.from(e.measureUnitIds).map((t=>(0,r.ensureDefined)(e.names.get(t)))).join(", "):e.descriptions.get(e.selectedMeasureUnitId)||""}_setLineHeight(e){this._currencyLabelDiv.style.lineHeight=e+"px",this._measureUnitIdLabelDiv.style.lineHeight=e+"px",this._unitLabelDiv.style.lineHeight=e+"px"}_updateVisibility(){const e=this.isEnabled();this._currencyAndUnitLabelsWrapper.classList.toggle("js-hidden",!e),this._fadeDiv.classList.toggle("js-hidden",!e)}_oneLineHeight(){return 7+this._fontSize}}async function Pe(e,t,s,r){
const{UnitConversionRenderer:n}=await Promise.all([i.e(7624),i.e(8230),i.e(4819),i.e(9602),i.e(1901),i.e(1428),i.e(1685),i.e(8271),i.e(3795),i.e(4412),i.e(6972),i.e(9776),i.e(9703),i.e(962),i.e(766),i.e(4104),i.e(412),i.e(2704)]).then(i.bind(i,380016));return new n(e,s,t,r)}function Ce(e,t){let{deltaX:i,deltaY:s}=e;switch(i/=100,s/=100,t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,s*=120;break;case t.DOM_DELTA_LINE:i*=32,s*=32}return{deltaX:i,deltaY:s}}class Te{constructor(){this._totalDeltaX=0,this._totalDeltaY=0,this._prevWheelTime=0}processWheel(e){e.timeStamp-this._prevWheelTime>100&&this._reset(),this._totalDeltaX+=e.deltaX,this._totalDeltaY+=e.deltaY,this._prevWheelTime=e.timeStamp;const t={deltaX:e.deltaX,deltaY:e.deltaY};return 0===this._totalDeltaX||0===this._totalDeltaY||(Math.abs(this._totalDeltaX)>=Math.abs(3*this._totalDeltaY)&&(t.deltaY=0),Math.abs(this._totalDeltaY)>=Math.abs(3*this._totalDeltaX)&&(t.deltaX=0)),Ce(t,e)}_reset(){this._totalDeltaX=0,this._totalDeltaY=0}}var xe=i(180185),Ie=i(72588),Me=i(628454),Le=i(484727),Ae=i(412905),ke=i(710567),Ee=i(588535),De=i(139267);i(591663);const Be=new E.TranslatedString("change no overlapping labels",n.t(null,void 0,i(783935))),Ve=n.t(null,void 0,i(375633)),Re=n.t(null,void 0,i(194420)),Ne=n.t(null,void 0,i(881520)),Oe=n.t(null,void 0,i(125933)),Fe=n.t(null,void 0,i(417258)),We=n.t(null,void 0,i(550834)),ze=n.t(null,{context:"scale_menu"},i(670361)),He=n.t(null,{context:"scale_menu"},i(547807)),Ue=n.t(null,{context:"scale_menu"},i(934727)),je=n.t(null,{context:"scale_menu"},i(172116)),Ge=n.t(null,{context:"scale_menu"},i(19238)),qe=n.t(null,{context:"scale_menu"},i(454138));const $e=function(e){const t=new Me.LimitedPrecisionNumericFormatter(e);return(e,i)=>(0,_.isNumber)(i)&&!e.isLog()?t.format(i):""}(4),Ye={contextMenuEnabled:!0,currencyConversionEnabled:!1,unitConversionEnabled:!1,countdownEnabled:!0,contextMenu:{general:!0,source:!0},pressedMouseMoveScale:!0,mouseWheelScale:!0,pinchScale:!0,croppedTickMarks:!0};class Ke{constructor(e,t,i,r,n,o,a,l,c){this._actions=null,this._priceScale=null,this._widthCache=new ae.TextWidthCache(1e3),this._color=null,this._fontSize=null,this._currencyFontSize=0,this._currencyLabelWidth=null,this._isVisible=!0,this._updateTimeout=null,this._currencyMenu=null,this._unitMenu=null,this._prevOptimalWidth=0,this._size=(0,s.size)({width:0,height:0}),this._currentCursorClassName="",this._destroyed=!1,this._highlighted=!1,this._mouseWheelHelper=null,this._dragScaleActive=!1,this._offset=NaN,this._pinching=!1,this._lastHittestResult=null,this._recalcCurrencyAndUnitVisibility=()=>{if(null===this._currencyLabel)return;let e=!0;switch((0,Ee.currencyUnitVisibilityProperty)().value()){case"alwaysOff":e=!1;break;case"visibleOnMouseOver":const t=this._chart.anyPriceAxisHovered().value(),i=null!==this._currencyMenu&&this._currencyMenu.isOpened(),s=null!==this._unitMenu&&this._unitMenu.isOpened();e=t||i||s}this._currencyLabel.setHidden(!e)},this._chart=e,this._pane=t,this._undoModel=i,this._properties=r,this._isLeft="left"===o,
this._options=(0,_.merge)((0,_.clone)(Ye),a),this._rendererOptionsProvider=n,this._backgroundBasedTheme=c,this._cell=document.createElement("div"),this._cell.className="price-axis",this._cell.style.width="25px",this._cell.style.left="0",this._canvasConfiguredHandler=()=>{this._undoModel.model().lightUpdate()},this._canvasBinding=(0,H.createBoundCanvas)(this._cell,(0,s.size)({width:16,height:16})),this._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler);const h=this._canvasBinding.canvasElement;h.style.position="absolute",h.style.zIndex="1",h.style.left="0",h.style.top="0",this._topCanvasBinding=(0,H.createBoundCanvas)(this._cell,(0,s.size)({width:16,height:16})),this._topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler);const d=this._topCanvasBinding.canvasElement;d.style.position="absolute",d.style.zIndex="2",d.style.left="0",d.style.top="0",this._mouseEventHandler=new z.MouseEventHandler(this._cell,this,{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0}),this._options.currencyConversionEnabled||this._options.unitConversionEnabled?(this._currencyLabel=new we,this._cell.appendChild(this._currencyLabel.element())):this._currencyLabel=null,this._properties.childs().fontSize.subscribe(this,this._onFontSizeChanged),this._options.mouseWheelScale&&(this._mouseWheelHelper=new Te,this._cell.addEventListener("wheel",this._onMousewheel.bind(this),{passive:!1})),this._axisInfo=l,this._offset=0,this.restoreDefaultCursor(),(0,Ee.currencyUnitVisibilityProperty)().subscribe(this,this._recalcCurrencyAndUnitVisibility),this._chart.anyPriceAxisHovered().subscribe(this._recalcCurrencyAndUnitVisibility),this._recalcCurrencyAndUnitVisibility(),this.update()}getContextMenuActions(){this._initActions();const e=(0,r.ensureNotNull)(this._actions),t=this._chart.actions(),i=[];return i.push(e.reset,new ke.Separator,this._autoScaleAction()),this._isMainSeriesAxis()&&i.push(this._lockScaleAction()),i.push(t.scaleSeriesOnly,this._invertAction(),new ke.Separator,this._regularScaleAction(),this._percentageAction(),this._indexedTo100Action(),this._logAction(),new ke.Separator),c.CheckMobile.any()||(i.push(this._createMergeScalesAction()),i.push(new ke.Separator)),Le.enabled("fundamental_widget")||i.push(new ke.Action({actionId:"Chart.PriceScale.Labels",label:Re,subItems:[t.showSymbolLabelsAction,t.showSeriesLastValue,t.showSeriesPrevCloseValue,null,t.showHighLowPriceLabels,Le.enabled("show_average_close_price_line_and_label")?t.showAverageClosePriceLabel:null,this._undoModel.model().hasCustomSource("bidask")&&t.showBidAskLabels,t.showStudyPlotNamesAction,t.showStudyLastValue,e.alignLabels].filter(Boolean)})),i.push((0,Ae.createLinesAction)(this._chart)),this._options.countdownEnabled&&i.push(t.showCountdown),this._undoModel.crossHairSource().isMenuEnabled()&&i.push(t.addPlusButton),!(0,c.onWidget)()&&Le.enabled("show_chart_property_page")&&Le.enabled("chart_property_page_scales")&&t.scalesProperties&&i.push(new ke.Separator,t.scalesProperties),i}getElement(){
return this._cell}onOptimalWidthNeedToBeRecalculated(e){const t=this.optimalWidth();(this._prevOptimalWidth<t||e)&&null===this._updateTimeout&&(this._updateTimeout=setTimeout((()=>{this._undoModel.model().fullUpdate(),this._updateTimeout=null}),100)),this._prevOptimalWidth=t}optimalWidth(){var e;if(!this.isVisible())return 0;let t=0;const i=this.rendererOptions();if(this._pane.hasState()){const i=(0,H.getContext2D)(this._canvasBinding.canvasElement);i.font=this.baseFont();const s=this.backLabels(!0);for(let e=s.length;e--;){if(!s[e].isAxisLabelVisible())continue;const r=this._widthCache.measureText(i,s[e].text());t=Math.max(t,r);const n=s[e].secondLineText();n&&(t=Math.max(t,this._widthCache.measureText(i,n)));const o=s[e].thirdLineText();o&&(t=Math.max(t,this._widthCache.measureText(i,o)))}const r=this.priceScale(),n=r.marks();n.length>0&&(t=Math.max(t,this._widthCache.measureText(i,n[0].label),this._widthCache.measureText(i,n[n.length-1].label)));const o=(null===(e=r.mainSource())||void 0===e?void 0:e.firstValue())||null;if(null!==o){const e=r.coordinateToPrice(1,o),s=r.coordinateToPrice(this._size.height-2,o);if(Math.abs(e-s)>1e-14){const n=r.formatPrice(Math.floor(Math.min(e,s))+.11111111111111,o),a=r.formatPrice(Math.ceil(Math.max(e,s))-.11111111111111,o);t=Math.max(t,this._widthCache.measureText(i,n),this._widthCache.measureText(i,a))}}}let s=0;this._isCurrencyLabelEnabled()&&(null===this._currencyLabelWidth&&(this._currencyLabelWidth=(0,r.ensureNotNull)(this._currencyLabel).width()),s=Math.round(this._currencyLabelWidth));const n=t||34;let o=Math.max(s,Math.ceil(i.borderSize+i.offsetSize+i.paddingInner+i.paddingOuter+n+4));return o+=o%2,o}backLabels(e){const t=[],i=this._grouppedSources(),s=s=>{for(const r of s){if(!e&&i.topLevelSources.has(r))continue;const s=r.priceAxisViews(this._pane.state(),this.priceScale());if(s)for(const e of s)t.push(e)}};return s(i.sources),s(this._pane.state().customSources()),t}setSizeAndOffset(e,t){(0,s.equalSizes)(this._size,e)||(this._size=e,this._canvasBinding.resizeCanvasElement(e),this._topCanvasBinding.resizeCanvasElement(e),this._cell.style.width=e.width+"px",this._cell.style.height=e.height+"px",this._cell.style.minWidth=e.width+"px"),this._offset!==t&&(this._offset=t,this._cell.style.left=t+"px")}getWidth(){return this._size.width}getImage(){const e=this._size,t=(0,H.createDisconnectedCanvas)(document,e);return(0,H.getPrescaledContext2D)(t).drawImage(this._canvasBinding.canvasElement,0,0,e.width,e.height),null!==this._currencyLabel&&this._currencyLabel.isEnabled()&&this._currencyLabel.drawLabel((0,H.getContext2D)(t),e.width,(0,H.getCanvasDevicePixelRatio)(t)),t}update(){}paint(e){if(!this._isVisible||0===this._size.width||0===this._size.height)return;if(e===I.InvalidationLevel.None)return;const t=this._pane.state(),i=!t.maximized().value()&&t.collapsed().value();if(this._canvasBinding.applySuggestedBitmapSize(),this._topCanvasBinding.applySuggestedBitmapSize(),e>I.InvalidationLevel.Cursor){const e=(0,H.getContext2D)(this._canvasBinding.canvasElement),t=(0,
H.getBindingPixelRatio)(this._canvasBinding);i||this._alignLabels(),this._drawBackground(e,t),this._drawBorder(e,t),this._pane.hasState()&&(this.updateCurrencyLabel(),i||(this._drawTickMarks(e,t),this._drawBackLabels(e,t)))}if(this._pane.hasState()&&!i){const e=(0,H.getContext2D)(this._topCanvasBinding.canvasElement),t=(0,H.getBindingPixelRatio)(this._topCanvasBinding);e.clearRect(0,0,Math.ceil(this._size.width*t)+1,Math.ceil(this._size.height*t)+1),this._drawCrossHairLabel(e,t)}}restoreDefaultCursor(){this._setCursor("")}priceScale(){return(0,r.ensureNotNull)(this._priceScale)}setPriceScale(e){this._priceScale!==e&&(null!==this._priceScale&&(this._priceScale.onMarksChanged().unsubscribe(this,this.onOptimalWidthNeedToBeRecalculated),this._priceScale.modeChanged().unsubscribeAll(this)),this._priceScale=e,null!==e&&(e.onMarksChanged().subscribe(this,this.onOptimalWidthNeedToBeRecalculated),e.modeChanged().subscribe(this,(()=>this.onOptimalWidthNeedToBeRecalculated(!0)))))}isVisible(){return this._isVisible}setVisible(e){(e=!!e)!==this._isVisible&&(this._cell.style.display=e?"table-cell":"none",this._isVisible=e)}destroy(){null!==this._currencyMenu&&(this._currencyMenu.close(),this._currencyMenu=null),null!==this._unitMenu&&(this._unitMenu.close(),this._unitMenu=null),this._topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler),this._topCanvasBinding.dispose(),this._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler),this._canvasBinding.dispose(),null!==this._priceScale&&(this._priceScale.onMarksChanged().unsubscribe(this,this.onOptimalWidthNeedToBeRecalculated),this._priceScale.modeChanged().unsubscribeAll(this)),this._priceScale=null,this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=null),this._mouseEventHandler.destroy(),this._properties.childs().fontSize.unsubscribe(this,this._onFontSizeChanged),null!==this._actions&&this._actions.reset&&this._actions.reset.destroy(),(0,Ee.currencyUnitVisibilityProperty)().unsubscribeAll(this),this._chart.anyPriceAxisHovered().unsubscribe(this._recalcCurrencyAndUnitVisibility),this._chart.setPriceAxisHovered(this,!1),this._destroyed=!0}axisInfo(){return this._axisInfo}setHighlighted(e){this._highlighted=e}backgroundColor(){return this._pane.state().model().backgroundColor().value()}backgroundTopColor(){return this._pane.state().model().backgroundTopColor().value()}lineColor(){return this._properties.childs().lineColor.value()}textColor(){return this._properties.childs().textColor.value()}fontSize(){return this._properties.childs().fontSize.value()}baseFont(){return(0,j.makeFont)(this.fontSize(),Y.CHART_FONT_FAMILY,"")}rendererOptions(){let e=this._rendererOptionsProvider.options();return this._color===e.color&&this._fontSize===e.fontSize||(this._color=e.color),this._fontSize!==e.fontSize&&(this._widthCache.reset(),this._fontSize=e.fontSize,this._currencyLabelWidth=null,this._currencyFontSize=0,this._updateCurrencyLabelFont(),this.onOptimalWidthNeedToBeRecalculated()),e}mouseEnterEvent(e){
this._chart.setPriceAxisHovered(this,!0),this._mouseEnterOrTouchStartEvent(e)}mouseMoveEvent(e){this._mouseOrTouchMoveEvent(e)}mouseDownEvent(e){this._mouseDownOrTouchStartEvent(e)}touchStartEvent(e){this._mouseOrTouchMoveEvent(e),this._mouseEnterOrTouchStartEvent(e),this._mouseDownOrTouchStartEvent(e)}pressedMouseMoveEvent(e){this._pressedMouseOrTouchMoveEvent(e)}touchMoveEvent(e){this._pressedMouseOrTouchMoveEvent(e)}pinchStartEvent(){}pinchEvent(e,t,i){if(this._zoomAvailable()&&this._options.pinchScale){if(this._dragScaleActive&&this._finishScale(),!this._pinching)return this._pinching=!0,void this._undoModel.startTwoPointsScalePrice(this._pane.state(),this.priceScale(),t.y,i.y);this._undoModel.twoPointsScalePriceTo(this._pane.state(),this.priceScale(),t.y,i.y)}}pinchEndEvent(){this._pinching=!1,this._undoModel.endTwoPointsScalePrice(this._pane.state(),this.priceScale())}mouseDownOutsideEvent(){this._finishScale()}touchStartOutsideEvent(){this._finishScale()}mouseUpEvent(e){this._mouseUpOrTouchEndEvent(e)}touchEndEvent(e){this._mouseLeaveOrTouchEndEvent(e),this._mouseUpOrTouchEndEvent(e)}mouseClickEvent(e){this._mouseClickOrTapEvent(e)}tapEvent(e){this._mouseClickOrTapEvent(e)}mouseLeaveEvent(e){this._chart.setPriceAxisHovered(this,!1),this._mouseLeaveOrTouchEndEvent(e)}mouseDoubleClickEvent(e){this._mouseDoubleClickOrDoubleTapEvent(e)}doubleTapEvent(e){this._mouseDoubleClickOrDoubleTapEvent(e)}contextMenuEvent(e){this._contextMenuOrTouchContextMenuEvent(e)}touchContextMenuEvent(e){this._contextMenuOrTouchContextMenuEvent(e)}dataSourceAtPoint(e,t){const i=this._pane.state();if(!i.maximized().value()&&i.collapsed().value())return null;const s=this._grouppedSources(),r=[...s.sources,...s.topLevelSources,...i.customSources()];let n=null,o=null;if(!this._priceScale)return null;const a=(e,t)=>{var i;const s=null!==(i=null==o?void 0:o.result())&&void 0!==i?i:0;e.result()>s&&(o=e,n=t)},l=new L.Point(e,t);for(let e=r.length-1;e>=0;--e){const t=r[e],s=t.priceAxisViews(i,this._priceScale);if(s&&0!==s.length)for(let e=s.length-1;e>=0;--e){const i=s[e].renderer();if(void 0!==i.hitTest){const e=i.hitTest(l,this._size.width,this._isLeft?"left":"right");null!==e&&a(e,t)}}}return this._lastHittestResult=o,n}reset(){const e=this._pane.state(),t=this.priceScale();this._undoModel.resetPriceScale(e,t),this.onOptimalWidthNeedToBeRecalculated(!0)}sizeReady(){return this.getWidth()>=this.optimalWidth()&&null===this._updateTimeout}updateCurrencyLabel(){if(null===this._currencyLabel)return;let e=!1;if(this._options.currencyConversionEnabled){const t=this.priceScale().currency(this._undoModel.model().availableCurrencies());null===t||"alwaysOff"===(0,Ee.currencyUnitVisibilityProperty)().value()?(e=this._currencyLabel.currencyLabelEnabled(),this._currencyLabel.disableCurrency()):(e=!this._currencyLabel.currencyLabelEnabled(),this._currencyLabel.enableCurrency(),this._currencyLabel.updateColors(this.backgroundTopColor(),this.textColor()),e=this._currencyLabel.setCurrencyInfo(t)||e)}if(this._options.unitConversionEnabled){
const t="alwaysOff"===(0,Ee.currencyUnitVisibilityProperty)().value(),i=this._undoModel.model().availableUnits(),s=this.priceScale().unit(i);null===s||t?(e=e||this._currencyLabel.unitLabelEnabled(),this._currencyLabel.disableUnit()):(e=e||!this._currencyLabel.unitLabelEnabled(),this._currencyLabel.enableUnit(),this._currencyLabel.updateColors(this.backgroundTopColor(),this.textColor()),e=this._currencyLabel.setUnitInfo(s)||e);const r=this.priceScale().measureUnitId(i);null===r||t?(e=e||this._currencyLabel.measureUnitIdLableEnabled(),this._currencyLabel.disableMeasureUnitId()):(e=e||!this._currencyLabel.measureUnitIdLableEnabled(),this._currencyLabel.enableMeasureUnitId(),this._currencyLabel.updateColors(this.backgroundTopColor(),this.textColor()),e=this._currencyLabel.setMeasureUnitIdInfo(r)||e)}this._updateCurrencyLabelFont(),e&&(this._currencyLabelWidth=null)}_grouppedSources(){var e;const t=this._pane,i=t.state().model(),s=this._sameSideSources().slice(),r=t.state(),n=this.priceScale(),o=new Set,a=null!==(e=i.lineBeingEdited())&&void 0!==e?e:i.lineBeingCreated();a&&o.add(a);const l=i.customSourceBeingMoved();null!==l&&o.add(l),i.sourcesBeingMoved().forEach((e=>o.add(e))),i.selection().allSources().forEach((e=>o.add(e)));const c=i.hoveredSource();null!==c&&o.add(c);if(n===r.defaultPriceScale()){const e=this._pane.state().dataSources();for(const t of e)r.isOverlay(t)&&s.push(t)}return{sources:s,topLevelSources:o}}_isCurrencyLabelEnabled(){return null!==this._currencyLabel&&this._currencyLabel.isEnabled()}_updateCurrencyLabelFont(){if(null===this._currencyLabel)return;const e=this.fontSize();e!==this._currencyFontSize&&(this._currencyLabel.setFontSize(e),this._currencyFontSize=e,this._currencyLabelWidth=null,this.onOptimalWidthNeedToBeRecalculated())}_alignLabels(){var e,t;const i=this._size.height;let s=i/2;const r=[],n=this.priceScale(),o=n.orderedSources().slice(),a=this._pane.state(),l=this.rendererOptions();if(n===a.defaultPriceScale()){const e=a.priceDataSources();for(let t=0;t<e.length;t++)a.isOverlay(e[t])&&o.push(e[t])}const c=n.mainSource();for(const e of[o,a.customSources()])for(let t=0;t<e.length;++t){const o=e[t],h=o.priceAxisViews(a,n);if(h){const e=h.filter((e=>{if(e.ignoreAlignment()||!e.isVisible())return!1;const{total:t}=e.topBottomTotalHeight(l),s=e.floatCoordinate();return s>-t&&s<i+t}));if(!e.length)continue;r.push(...e),c===o&&(s=e[0].floatCoordinate())}}const h=r.filter((e=>e.floatCoordinate()<=s)),d=r.filter((e=>e.floatCoordinate()>s));h.sort(((e,t)=>t.floatCoordinate()-e.floatCoordinate())),h.length>0&&d.length>0&&d.push(h[0]),d.sort(((e,t)=>e.floatCoordinate()-t.floatCoordinate()));for(const e of r)e.setFixedCoordinate(e.coordinate());if(n.properties().childs().alignLabels.value()){if(d.length>0||h.length>0){{const t=null!==(e=h[0])&&void 0!==e?e:d[0],s=t.getFixedCoordinate(),{top:r,bottom:n,total:o}=t.topBottomTotalHeight(l);o<i&&s-r<0&&s+n>0&&t.setFixedCoordinate(r)}{const e=null!==(t=d[0])&&void 0!==t?t:h[0],s=e.getFixedCoordinate(),{top:r,bottom:n,total:o}=e.topBottomTotalHeight(l)
;o<i&&s-r<i&&s+n>i&&e.setFixedCoordinate(i-n)}}for(let e=1;e<h.length;e++){const t=h[e],i=h[e-1],{top:s,bottom:r,total:n}=t.topBottomTotalHeight(l),o=t.getFixedCoordinate(),a=i.getFixedCoordinate();if(o>a-n)t.setFixedCoordinate(a-n);else if(a>0&&o-s<0&&o+r>0){const{top:e}=i.topBottomTotalHeight(l);t.setFixedCoordinate(Math.min(a-e-r,s))}}for(let e=1;e<d.length;e++){const t=d[e],s=d[e-1],{bottom:r,total:n}=s.topBottomTotalHeight(l),o=t.getFixedCoordinate(),a=s.getFixedCoordinate();if(o<a+n)t.setFixedCoordinate(a+n);else if(a<i){const{top:e,bottom:s}=t.topBottomTotalHeight(l);o-e<i&&o+s>i&&t.setFixedCoordinate(Math.max(a+r+e,i-s))}}}}_drawTickMarks(e,t){const i=this.priceScale().marks();e.save(),e.font=this.baseFont();const s=this.rendererOptions(),n=this._isLeft?Math.floor((this._size.width-s.offsetSize)*t):0,o=this._isLeft?Math.round(n-s.paddingInner*t):Math.round(n+(s.offsetSize+s.paddingInner)*t),a=this.fontSize(),l=this._isCurrencyLabelEnabled()?(0,r.ensureNotNull)(this._currencyLabel).labelBottom():0,c=i.map((t=>{if(this._options.croppedTickMarks)return{visible:!0,yCorrection:this._widthCache.yMidCorrection(e,t.label)};const i=t.coord-a/2,s=t.coord+a/2,r=!(s>this._size.height||i<l);return{visible:!(s>this._size.height||i<l),yCorrection:r?this._widthCache.yMidCorrection(e,t.label):0}}));e.fillStyle=this.textColor(),e.textAlign=this._isLeft?"right":"left",e.textBaseline="middle",(0,H.drawScaled)(e,t,(()=>{for(let s=i.length;s--;){if(!c[s].visible)continue;const r=i[s];e.fillText(r.label,o/t,r.coord+c[s].yCorrection)}})),e.restore()}_hasAlertLabel(){return!1}async _showCurrenciesContextMenu(){if(null!==this._currencyMenu&&this._currencyMenu.isOpened())return void this._currencyMenu.close();(0,le.trackEvent)("GUI","Currency conversion");const{currencyActions:e}=await Promise.all([i.e(7624),i.e(8230),i.e(4819),i.e(9602),i.e(1901),i.e(1428),i.e(1685),i.e(8271),i.e(3795),i.e(4412),i.e(6972),i.e(9776),i.e(9703),i.e(962),i.e(766),i.e(4104),i.e(412),i.e(2704)]).then(i.bind(i,814854)),t=await Pe(Ne,(()=>e(this._undoModel,(0,r.ensureNotNull)(this._currencyLabel).currencyInfo(),this.priceScale())),(0,r.ensureNotNull)(this._currencyLabel).currencyLabelElement(),(()=>this._recalcCurrencyAndUnitVisibility()));this._destroyed?t.close():this._currencyMenu=t}async _showUnitsContextMenu(){if(null!==this._unitMenu&&this._unitMenu.isOpened())return void this._unitMenu.close();(0,le.trackEvent)("GUI","Unit conversion");const{unitActions:e}=await Promise.all([i.e(7624),i.e(8230),i.e(4819),i.e(9602),i.e(1901),i.e(1428),i.e(1685),i.e(8271),i.e(3795),i.e(4412),i.e(6972),i.e(9776),i.e(9703),i.e(962),i.e(766),i.e(4104),i.e(412),i.e(2704)]).then(i.bind(i,647332)),t=await Pe(Oe,(()=>e(this._undoModel,(0,r.ensureNotNull)(this._currencyLabel).unitInfo(),this.priceScale())),(0,r.ensureNotNull)(this._currencyLabel).unitLabelElement(),(()=>this._recalcCurrencyAndUnitVisibility()));this._destroyed?t.close():this._unitMenu=t}_onFontSizeChanged(){this._currencyLabelWidth=null,this._currencyFontSize=0,this._updateCurrencyLabelFont(),
this.onOptimalWidthNeedToBeRecalculated()}_mouseOrTouchMoveEvent(e){if(!this._priceScale)return;this.dataSourceAtPoint(e.localX,e.localY)?this._setCursorClassName("pointer"):this._setResizeCursor()}_mouseDownOrTouchStartEvent(e){this._zoomAvailable()&&this._options.pressedMouseMoveScale&&!this._pinching&&(this._dragScaleActive=!0,this._undoModel.startScalePrice(this._pane.state(),this.priceScale(),e.localY))}_mouseEnterOrTouchStartEvent(e){this._setResizeCursor()}_pressedMouseOrTouchMoveEvent(e){if(this._dragScaleActive){const t=this.priceScale();this._undoModel.scalePriceTo(this._pane.state(),t,e.localY)}}_mouseUpOrTouchEndEvent(e){this._finishScale()}_finishScale(){this._dragScaleActive&&(this._undoModel.endScalePrice(this._pane.state(),this.priceScale()),this.restoreDefaultCursor(),this._dragScaleActive=!1)}_mouseClickOrTapEvent(e){if(this._currencyLabel){if(this._currencyLabel.currencyConversionAvailable()&&this._currencyLabel.currencyLabelElement().contains(e.target))return void this._showCurrenciesContextMenu();if(this._currencyLabel.unitConversionAvailable()&&this._currencyLabel.unitLabelElement().contains(e.target))return void this._showUnitsContextMenu()}const t=this.dataSourceAtPoint(e.localX,e.localY);t&&this._undoModel.selectionMacro((e=>{e.selection().isSelected(t)||(e.clearSelection(),e.addSourceToSelection(t))}))}_mouseLeaveOrTouchEndEvent(e){this._setCursorClassName("")}_mouseDoubleClickOrDoubleTapEvent(e){var t;const i=this.dataSourceAtPoint(e.localX,e.localY);i?this._pane.processDoubleClickOnSource(i,null!==(t=this._lastHittestResult)&&void 0!==t?t:void 0,{origin:"price_scale"}):(this.reset(),(0,le.trackEvent)("GUI","Double click price scale"))}_contextMenuOrTouchContextMenuEvent(e){if(this._options.contextMenuEnabled){const t=this.dataSourceAtPoint(e.localX,e.localY);if(null!==t&&this._options.contextMenu.source){return void this._undoModel.model().selectionMacro((i=>{i.selection().isSelected(t)||(i.clearSelection(),i.addSourceToSelection(t)),this._pane.showContextMenuForSelection(e,{origin:"price_scale"})}))}this._options.contextMenu.general&&te.ContextMenuManager.showMenu(this.getContextMenuActions(),e,{statName:"PriceScaleContextMenu"},{menuName:"PriceScaleContextMenu"})}}_setResizeCursor(){const e=this.priceScale();e.isPercentage()||e.isIndexedTo100()?this._setCursorClassName(""):this._zoomAvailable()&&(this._options.pressedMouseMoveScale||this._options.mouseWheelScale)&&this._setCursorClassName("ns-resize")}_setCursorClassName(e){let t="";e&&(t="price-axis--cursor-"+e),this._currentCursorClassName!==t&&(this._currentCursorClassName&&this._cell.classList.remove(this._currentCursorClassName),t&&this._cell.classList.add(t),this._currentCursorClassName=t)}_zoomAvailable(){return!this.priceScale().isEmpty()&&this._undoModel.model().zoomEnabled()}_onMousewheel(e){if(!this._zoomAvailable()||!this._options.mouseWheelScale)return;const t=(0,r.ensureNotNull)(this._mouseWheelHelper).processWheel(e).deltaY;if(0===t)return;e.cancelable&&e.preventDefault()
;const i=this._undoModel,s=this._pane.state(),n=this.priceScale(),o=this._cell.getBoundingClientRect(),a=e.clientY-o.top,l=a+15*t;i.startScalePrice(s,this.priceScale(),a,!0),i.scalePriceTo(s,n,l),i.endScalePrice(s,n),e.stopPropagation()}_drawCrossHairLabel(e,t){var i,s;e.save();const r=this._pane.state(),n=r.model(),o=this.priceScale(),a=[],l=this.priceScale()===r.defaultPriceScale(),c=null!==(i=n.lineBeingEdited())&&void 0!==i?i:n.lineBeingCreated();if(c&&(c.priceScale()===o||l&&r.isOverlay(c))){const e=c.priceAxisViews(r,o);e&&e.length&&a.push(e)}const h=n.customSourceBeingMoved();this._addViewsOrMaxMin(null===h?[]:[h],a),this._addViewsOrMaxMin(n.sourcesBeingMoved(),a),this._addViewsOrMaxMin(n.selection().allSources(),a);const d=n.hoveredSource();if(d){const e=r.customSources().includes(d)?o:d.priceScale();if(!n.selection().isSelected(d)&&(this._isFromSameSide(e)||l&&r.isOverlay(d))){const e=null===(s=n.hoveredSource())||void 0===s?void 0:s.priceAxisViews(r,o);e&&e.length&&a.push(e)}}const u=n.crossHairSource().priceAxisViews(r,o);u&&u.length&&a.push(u);const p=this.rendererOptions(),_=this._isLeft?"right":"left";a.forEach((i=>{i.forEach((i=>{e.save(),i.renderer().draw(e,p,this._widthCache,this._size.width,this._size.height,_,t),e.restore()}))})),e.restore()}_drawBackground(e,t){const i=Math.ceil(this._size.width*t),s=Math.ceil(this._size.height*t),r=this.backgroundTopColor(),n=this.backgroundColor();if(r===n?(0,H.clearRect)(e,0,0,i+1,s+1,this.backgroundColor()):(0,U.clearRectWithGradient)(e,0,0,i+1,s+1,r,n),this._highlighted){e.globalAlpha=.5;const t=G.themes[this._backgroundBasedTheme.value()].getThemedColor("color-price-axis-highlight");(0,H.fillRect)(e,0,0,i+1,s+1,t),e.globalAlpha=1}const o=this._pane.state().model(),a=this.priceScale(),l=o.selection().lineDataSources().filter((e=>e.priceScale()===a)).reduce(((e,t)=>{const i=t.priceAxisPoints();return 0===i.length?e:e.concat(i)}),[]);l.length>0&&this._hightlightBackground(e,l,this.priceScale().mainSource(),t);const c=o.crossHairSource();c.startMeasurePoint()&&this._hightlightBackground(e,c.measurePoints(),this.priceScale().mainSource(),t)}_drawBorder(e,t){e.save(),e.fillStyle=this.lineColor();const i=Math.max(1,Math.floor(this.rendererOptions().borderSize*t)),s=this._isLeft?Math.floor(this._size.width*t)-i:0;e.fillRect(s,0,i,Math.ceil(this._size.height*t)+1),e.restore()}_drawBackLabels(e,t){e.save();const i=this.backLabels(),s=this.rendererOptions(),r=this._isLeft?"right":"left";for(const n of i)n.isAxisLabelVisible()&&(e.save(),n.renderer().draw(e,s,this._widthCache,this._size.width,this._size.height,r,t),e.restore());e.restore()}_hightlightBackground(e,t,i,s){if(!i)return;const r=i.firstValue();if(null===r)return;let n=t[0].price,o=t[0].price;for(let e=1;e<t.length;e++)n=Math.min(n,t[e].price),o=Math.max(o,t[e].price);const a=this.priceScale(),l=Math.floor(a.priceToCoordinate(n,r)*s),c=Math.ceil(a.priceToCoordinate(o,r)*s);(0,H.fillRect)(e,Math.floor(s),l,Math.ceil((this._size.width-1)*s)+1,c-l,this._properties.childs().axisHighlightColor.value())}
_addViewsOrMaxMin(e,t){const i=this._pane.state(),s=this.priceScale();if(s!==i.defaultPriceScale()&&(e=e.filter((e=>i.isOverlay(e)||this._isFromSameSide(e.priceScale())))),0!==e.length)if(1===e.length){const r=e[0].priceAxisViews(i,s);r&&r.length&&t.push(r)}else t.push(this._minMaxViews(e))}_minMaxViews(e){const t=this._pane.state(),i=this.priceScale(),s=[];let r=1/0,n=-1/0,o=null,a=null;for(const s of e){const e=s.priceAxisViews(t,i);if(e&&e.length)for(let t=0;t<e.length;t++){const i=e[t],s=i.coordinate();s>=n&&(n=s,a=i),s<=r&&(r=s,o=i)}}return a&&s.push(a),o&&s.push(o),s}_isFromSameSide(e){return null!==e&&(this._isLeft?this._pane.state().leftPriceScales():this._pane.state().rightPriceScales()).includes(e)}_sameSideSources(){const e=this._pane.state().sourcesByGroup();return this._isLeft?e.leftPriceScalesSources():e.rightPriceScalesSources()}_initActions(){if(!this._pane.hasState()||null!==this._actions)return;const e=this._undoModel,t=new ke.Action({actionId:"Chart.PriceScale.Reset",label:Fe,icon:De,shortcutHint:(0,xe.humanReadableHash)(xe.Modifiers.Alt+82),statName:"ResetScale",onExecute:()=>this.reset()}),i=new ke.Action({actionId:"Chart.PriceScale.ToggleAutoScale",label:We,checkable:!0,checked:!0,statName:"ToggleAutoScale",onExecute:()=>{e.togglePriceScaleAutoScaleMode(this.priceScale()),this._updateScalesActions()}}),s=new ke.Action({actionId:"Chart.PriceScale.TogglePercentage",label:ze,checkable:!0,checked:this.priceScale().isPercentage(),statName:"TogglePercantage",onExecute:()=>{e.togglePriceScalePercentageScaleMode(this.priceScale()),this._updateScalesActions()}}),r=new ke.Action({actionId:"Chart.PriceScale.ToggleIndexedTo100",label:He,checkable:!0,checked:this.priceScale().isIndexedTo100(),statName:"ToggleIndexedTo100",onExecute:()=>{e.togglePriceScaleIndexedTo100ScaleMode(this.priceScale()),this._updateScalesActions()}}),n=new ke.Action({actionId:"Chart.PriceScale.ToggleLogarithmic",label:Ue,checkable:!0,checked:this.priceScale().isLog(),statName:"ToggleLogScale",onExecute:()=>{e.togglePriceScaleLogScaleMode(this.priceScale()),this._updateScalesActions()}}),o=new ke.Action({actionId:"Chart.PriceScale.ToggleRegular",label:je,checkable:!0,checked:this.priceScale().isRegular(),statName:"ToggleRegularScale",onExecute:()=>{e.setPriceScaleRegularScaleMode(this.priceScale()),this._updateScalesActions()}}),a=new ke.Action({actionId:"Chart.PriceScale.Labels.ToggleNoOverlappingLabelsVisibility",label:Ge,checkable:!0,checked:this.priceScale().properties().childs().alignLabels.value(),statName:"TogglePreciseLabels"});a.setBinding(new Ie.ActionBinder(a,this.priceScale().properties().childs().alignLabels,e,Be));const l=new ke.Action({actionId:"Chart.PriceScale.ToggleInvertScale",label:qe,checkable:!0,checked:this.priceScale().isInverted(),statName:"Invert Scale",onExecute:()=>{e.invertPriceScale(this.priceScale()),this._updateScalesActions()}});this._actions={reset:t,setAutoScale:i,setPercentage:s,setIndexedTo100:r,setLog:n,setRegular:o,alignLabels:a,invertScale:l},this._updateScalesActions()}_logAction(){
return this._isMainSeriesAxis()?this._chart.actions().logSeriesScale:(0,r.ensureNotNull)(this._actions).setLog}_percentageAction(){return this._isMainSeriesAxis()?this._chart.actions().percentSeriesScale:(0,r.ensureNotNull)(this._actions).setPercentage}_indexedTo100Action(){return this._isMainSeriesAxis()?this._chart.actions().indexedTo100SeriesScale:(0,r.ensureNotNull)(this._actions).setIndexedTo100}_autoScaleAction(){return this._isMainSeriesAxis()?this._chart.actions().autoSeriesScale:(0,r.ensureNotNull)(this._actions).setAutoScale}_regularScaleAction(){return this._isMainSeriesAxis()?this._chart.actions().regularSeriesScale:(0,r.ensureNotNull)(this._actions).setRegular}_lockScaleAction(){const e=this._chart.actions().lockSeriesScale,t=$e(this.priceScale(),this._undoModel.model().mainSeriesScaleRatio());return e.update({hint:t}),e}_invertAction(){return this._isMainSeriesAxis()?this._chart.actions().invertSeriesScale:(0,r.ensureNotNull)(this._actions).invertScale}_isMainSeriesAxis(){return this.priceScale().hasMainSeries()}_updateScalesActions(){const e=this.priceScale(),t=this._isMainSeriesAxis(),i=(0,r.ensureNotNull)(e.mainSource()).properties(),s=t&&e.isLockScale(),n=t&&6===i.style.value(),o=(0,r.ensureNotNull)(this._actions);o.setRegular.update({checked:e.isRegular(),disabled:s||n}),o.setPercentage.update({checked:e.isPercentage(),disabled:s||n}),o.setIndexedTo100.update({checked:e.isIndexedTo100(),disabled:s||n}),o.setLog.update({checked:e.isLog(),disabled:s||n}),o.setAutoScale.update({checked:e.isAutoScale(),disabled:e.properties().childs().autoScaleDisabled.value()})}_createMergeScalesAction(){const e=this._chart.actions(),t=this._undoModel.model().priceScaleSlotsCount();if(t.left+t.right===1)return 0===t.left?e.moveScaleToLeft:e.moveScaleToRight;const i=[];return i.push(e.mergeLeftScalesAction),i.push(e.mergeRightScalesAction),new ke.Action({actionId:"Chart.PriceScale.MergeAllScales",label:Ve,subItems:i})}_setCursor(e){let t="";"grabbing"!==e&&"ns-resize"!==e||(t="price-axis--cursor-"+e),this._currentCursorClassName!==t&&(this._currentCursorClassName&&this._cell.classList.remove(this._currentCursorClassName),t&&this._cell.classList.add(t),this._currentCursorClassName=t,this._cell.style.cursor)}}function Ze(e,t){return e.position-t.position}function Xe(e,t,i){const s=(e.position-t.position)/(e.time-t.time);return Math.sign(s)*Math.min(Math.abs(s),i)}class Je{constructor(e,t,i,s){this._position1=null,this._position2=null,this._position3=null,this._position4=null,this._animationStartPosition=null,this._durationMsecs=0,this._speedPxPerMsec=0,this._terminated=!1,this._minSpeed=e,this._maxSpeed=t,this._dumpingCoeff=i,this._minMove=s}addPosition(e,t){if(null!==this._position1){if(this._position1.time===t)return void(this._position1.position=e);if(Math.abs(this._position1.position-e)<this._minMove)return}this._position4=this._position3,this._position3=this._position2,this._position2=this._position1,this._position1={time:t,position:e}}start(e,t){if(null===this._position1||null===this._position2)return
;if(t-this._position1.time>50)return;let i=0;const s=Xe(this._position1,this._position2,this._maxSpeed),r=Ze(this._position1,this._position2),n=[s],o=[r];if(i+=r,null!==this._position3){const e=Xe(this._position2,this._position3,this._maxSpeed);if(Math.sign(e)===Math.sign(s)){const t=Ze(this._position2,this._position3);if(n.push(e),o.push(t),i+=t,null!==this._position4){const e=Xe(this._position3,this._position4,this._maxSpeed);if(Math.sign(e)===Math.sign(s)){const t=Ze(this._position3,this._position4);n.push(e),o.push(t),i+=t}}}}let a=0;for(let e=0;e<n.length;++e)a+=o[e]/i*n[e];Math.abs(a)<this._minSpeed||(this._animationStartPosition={position:e,time:t},this._speedPxPerMsec=a,this._durationMsecs=function(e,t){const i=Math.log(t);return Math.log(1*i/-e)/i}(Math.abs(a),this._dumpingCoeff))}getPosition(e){const t=(0,r.ensureNotNull)(this._animationStartPosition),i=e-t.time;return t.position+this._speedPxPerMsec*(Math.pow(this._dumpingCoeff,i)-1)/Math.log(this._dumpingCoeff)}finished(e){return null===this._animationStartPosition||this._progressDuration(e)===this._durationMsecs}terminate(){this._terminated=!0}terminated(){return this._terminated}_progressDuration(e){const t=e-(0,r.ensureNotNull)(this._animationStartPosition).time;return Math.min(t,this._durationMsecs)}}var Qe=i(210596),et=i.n(Qe),tt=i(779602),it=i(340116),st=i(539301),rt=i(873402),nt=i(315264),ot=i(577535),at=i(411404),lt=i(744471);async function ct(){return(await Promise.all([i.e(1960),i.e(962),i.e(139)]).then(i.bind(i,42898))).ErrorCardRenderer}var ht=i(592884),dt=i(568822);function ut(e){return"startMoving"in e&&"move"in e&&"endMoving"in e&&"convertYCoordinateToPriceForMoving"in e}var pt=i(793713),_t=i(744687),mt=i(108342);i(493249);const gt=parseInt(mt["css-value-pane-controls-padding-left"]),ft=parseInt(mt["css-value-pane-controls-padding-right"]),vt=(0,A.getHexColorByName)("color-cold-gray-700"),St=(0,A.getHexColorByName)("color-cold-gray-400"),yt=new E.TranslatedString("scroll",n.t(null,void 0,i(468193))),bt=n.t(null,void 0,i(482232));n.t(null,void 0,i(398478));function wt(e,t,i){e.drawBackground&&e.drawBackground(t,i)}function Pt(e,t,i){e.draw(t,i)}function Ct(e,t){return e.paneViews(t)}function Tt(e,t){return e.topPaneViews()}function xt(e,t){return e.labelPaneViews(t)}function It(e,t){const i=e.strategyOrdersPaneView();return null===i?null:[i]}function Mt(e,t){return null===e||e.source!==t?null:e.hittest.data()}function Lt(e,t,i,s,r){var n,o;const a=null!==(o=null===(n=e.result)||void 0===n?void 0:n.hittest.result())&&void 0!==o?o:0;t.result()>a&&(e.result={hittest:t,source:i,renderer:s,isCustom:r})}const At={contextMenuEnabled:!0,contextMenu:Ae.defaultContextMenuOptions,priceScaleContextMenuEnabled:!0,legendWidgetEnabled:!0,controlsEnabled:!0,propertyPagesEnabled:!0,sourceSelectionEnabled:!0,countdownEnabled:!0},kt=new Map([[V.AreaName.Text,"Text"],[V.AreaName.Style,"Style"]]),Et=!Le.enabled("display_legend_on_all_charts");let Dt=null;function Bt(e,t){return!(0,V.shouldDefaultActionBeExecuted)(e,t,"pressedMouseMoveHandler","touchMoveHandler")
}class Vt{constructor(e,t,i,r){this._legendWidget=null,this._paneControls=null,this._isDestroyed=!1,this._trackCrosshairOnlyAfterLongTap=(0,D.lastMouseOrTouchEventInfo)().isTouch,this._startTrackPoint=null,this._exitTrackingModeOnNextTry=!1,this._startMoveSourceParams=null,this._startChangeLineToolParams=null,this._preventSourceChange=!1,this._clonningAtMoveLineTools=null,this._startCloningPoint=null,this._size=(0,s.size)({width:0,height:0}),this._themedTopColor=null,this._initCrossHairPosition=null,this._firstZoomPoint=null,this._editDialog=null,this._processing=!1,this._pressedMoveStage=0,this._touchMove=!1,this._startTouchPoint=null,this._isSelecting=!1,this._prevHoveredHittest=null,this._contextMenuX=0,this._contextMenuY=0,this._startScrollingPos=null,this._isScrolling=!1,this._scrollPriceScale=null,this._scrollXAnimation=null,this._prevPinchScale=1,this._pinching=!1,this._wasPinched=!1,this._longTap=!1,this._contextMenuOpenedOnLastTap=!1,this._paneControlsResizeObserver=null,this._lastClickedSource=null,this._customLegendWidgetsFactoryMap=new Map,this._prevMoveEventPosition=null,this._onMagnetStateChangedListener=this._onMagnetStateChanged.bind(this),this._onShiftKeyStateChangedListener=this._onShiftKeyStateChanged.bind(this),this._currentCursorClassName="",this._lastFinishedToolId=null,this._needResetMeasureLater=!1,this._currentChangingLineToolHitTest=null,this._currentMovingHitTest=null,this._prevTooltipData=null,this._errorRenderer=null,this._highlightedPriceAxis=new(et())({owner:"",axis:null}),this._visuallyCollapsed=new(et())(!1),this._endOfSeriesDataBanner=null,this._canvasConfiguredHandler=()=>this._state&&this._chartModel().lightUpdate(),this._updateVisuallyCollapsed=()=>{this._visuallyCollapsed.setValue(!this.state().maximized().value()&&this.state().collapsed().value())},this._chart=e,this._state=t,this._options=(0,_.merge)((0,_.clone)(At),i),this._paneWidgetsSharedState=r,this._state&&this._subscribeToState();const n={contextMenuEnabled:this._options.priceScaleContextMenuEnabled,pressedMouseMoveScale:this._options.handleScale.axisPressedMouseMove.price,mouseWheelScale:this._options.handleScale.mouseWheel,currencyConversionEnabled:this._options.currencyConversionEnabled,unitConversionEnabled:this._options.unitConversionEnabled,countdownEnabled:this._options.countdownEnabled,croppedTickMarks:this._options.croppedTickMarks};void 0!==this._options.priceScaleContextMenu&&(n.contextMenu=this._options.priceScaleContextMenu);const o=(e,t,i,s,r)=>new Ke(this._chart,this,this._chartUndoModel(),i,t,e,n,s,r),a=e.properties().childs().scalesProperties,l=this._chartModel().rendererOptionsProvider(),c={backgroundBasedTheme:e.backgroundBasedTheme(),rendererOptionsProvider:l,getBackgroundTopColor:()=>this._chartModel().backgroundTopColor().value(),getBackgroundBottomColor:()=>this._chartModel().backgroundColor().value()},h={showLabels:!1};this._lhsPriceAxisesContainer=new oe(a,"left",o,c,h),this._rhsPriceAxisesContainer=new oe(a,"right",o,c,h),this._paneCell=document.createElement("td"),
this._paneCell.classList.add("chart-markup-table","pane"),this._div=document.createElement("div"),this._div.classList.add("chart-gui-wrapper"),this._div.setAttribute("data-name","pane-widget-chart-gui-wrapper"),this._paneCell.appendChild(this._div),this._canvasBinding=(0,H.createBoundCanvas)(this._div,(0,s.size)({width:16,height:16})),this._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler);const d=this._canvasBinding.canvasElement;d.style.position="absolute",d.style.left="0",d.style.top="0",this._topCanvasBinding=(0,H.createBoundCanvas)(this._div,(0,s.size)({width:16,height:16})),this._topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler);const u=this._topCanvasBinding.canvasElement;u.style.position="absolute",u.style.left="0",u.style.top="0",this._rowElement=document.createElement("tr"),this._rowElement.appendChild(this._lhsPriceAxisesContainer.getElement()),this._rowElement.appendChild(this._paneCell),this._rowElement.appendChild(this._rhsPriceAxisesContainer.getElement()),this._options.legendWidgetEnabled&&(this._options.customLegendWidgetFactories&&(this._customLegendWidgetsFactoryMap=this._options.customLegendWidgetFactories),this._loadAndCreateLegendWidget()),this._state&&!this._chart.readOnly()&&this._options.controlsEnabled&&this._loadAndCreatePaneControlsWidget(),(0,ht.magnetEnabled)().subscribe(this._onMagnetStateChangedListener),(0,dt.shiftPressed)().subscribe(this._onShiftKeyStateChangedListener),this._paneCell.addEventListener("dragover",(e=>{e.dataTransfer&&Array.from(e.dataTransfer.files).some(blobImageFilter)&&e.preventDefault()})),this.setCursorForTool(),this._mouseEventHandler=new z.MouseEventHandler(this._topCanvasBinding.canvasElement,this,{treatVertTouchDragAsPageScroll:!this._options.handleScroll.vertTouchDrag,treatHorzTouchDragAsPageScroll:!this._options.handleScroll.horzTouchDrag}),this._prevHoveredHittest=null,this._highlightedPriceAxis.subscribe((e=>this._highlightPriceAxisByLabel(e.axis))),this._prevPinchScale=0,this._isDestroyed=!1}destroy(){var e;this._chart.onPaneWidgetDestroyed(this),this._customLegendWidgetsFactoryMap.clear(),this._topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler),this._topCanvasBinding.dispose(),this._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler),this._canvasBinding.dispose(),this._legendWidget&&(this._legendWidget.destroy(),this._legendWidget=null),null!==this._paneControlsResizeObserver&&this._paneControlsResizeObserver.disconnect(),null!==this._paneControls&&(this._paneControls.destroy(),this._paneControls=null),this._lhsPriceAxisesContainer.destroy(),this._rhsPriceAxisesContainer.destroy(),this.hasState()&&this._unsubscribeFromState(),(0,ht.magnetEnabled)().unsubscribe(this._onMagnetStateChangedListener),(0,dt.shiftPressed)().unsubscribe(this._onShiftKeyStateChangedListener),this._paneWidgetsSharedState.onPaneDestroyed(this),this._errorRenderer&&this._errorRenderer.then((e=>{e.destroy(),this._errorRenderer=null})),
this._prevHoveredHittest=null,this._mouseEventHandler.destroy(),null===(e=this._rowElement.parentElement)||void 0===e||e.removeChild(this._rowElement),this._isDestroyed=!0}size(){return this._size}setSize(e){(0,s.equalSizes)(this._size,e)||(this._size=e,this._canvasBinding.resizeCanvasElement(e),this._topCanvasBinding.resizeCanvasElement(e),this._paneCell.style.width=e.width+"px",this._paneCell.style.height=e.height+"px",this._div.style.width=e.width+"px",this._div.style.height=e.height+"px",this._rowElement.classList.toggle("js-hidden",0===e.height),null!==this._legendWidget&&this._legendWidget.updateWidgetModeBySize(e),null!==this._paneControls&&this._paneControls.updateWidgetModeByWidth(e.width))}width(){return this._size.width}height(){return this._size.height}backgroundColor(){return this._chartModel().backgroundColor().value()}highlightedPriceAxis(){return this._highlightedPriceAxis}processDoubleClickOnSource(e,t,i){(0,O.isDataSource)(e)&&e.id()!==this._lastFinishedToolId&&this._showEditDialogForSource(e,t)}stretchFactor(){return this._state?this._state.stretchFactor():0}setStretchFactor(e){this.hasState()&&this.state().setStretchFactor(e)}setCursorForTool(e,t,i){if(t&&t.mod()&&e)return void this._setCursorClassName("pointer");if(void 0!==i){switch(i){case at.PaneCursorType.VerticalResize:this._setCursorClassName("ns-resize");break;case at.PaneCursorType.HorizontalResize:this._setCursorClassName("ew-resize");break;case at.PaneCursorType.DiagonalNeSwResize:this._setCursorClassName("nesw-resize");break;case at.PaneCursorType.DiagonalNwSeResize:this._setCursorClassName("nwse-resize");break;case at.PaneCursorType.Default:this._setCursorClassName("default");break;case at.PaneCursorType.Pointer:this._setCursorClassName("pointer");break;case at.PaneCursorType.Grabbing:this._setCursorClassName("grabbing")}return}const s=F.tool.value();if((0,F.toolIsCursor)(s)){if(null!==this._paneWidgetsSharedState.draggingSource()||this._isScrolling||this._chartUndoModel()&&this._chartUndoModel().model().sourcesBeingMoved().length)return void this._setCursorClassName("grabbing");if(e&&this._options.sourceSelectionEnabled)return void this._setCursorClassName("pointer")}if("eraser"===s)return void this._setCursorClassName("eraser");if("zoom"===s)return void this._setCursorClassName("zoom-in");const r=F.cursorTool.value();"dot"!==r?"arrow"!==r?this._setCursorClassName(""):this._setCursorClassName("default"):this._setCursorClassName("dot")}showContextMenuForSelection(e,t){const i=this._chartUndoModel().selection();if(i.isEmpty())return;const s=i.dataSources().filter((e=>e.hasContextMenu()));this.showContextMenuForSources(s,e,void 0,t)}async showContextMenuForSources(e,t,i,s){var r;if(!e.length)return Promise.resolve(null);const n=e[0],o=(0,_.merge)((0,_.clone)(this._options.contextMenu),i||{}),a=new Ae.ActionsProvider(this._chart,o);if(n===this._chartUndoModel().crossHairSource())return n.handleContextMenuEvent(t),Promise.resolve(null);{const i=await a.contextMenuActionsForSources(e,t,null==s?void 0:s.origin)
;if(0===i.length)return Promise.resolve(null);{let e;return e=n instanceof pt.Series?{menuName:"ObjectTreeContextMenu",detail:{type:"series",id:n.instanceId()}}:(0,C.isLineTool)(n)?{menuName:"ObjectTreeContextMenu",detail:{type:"shape",id:null!==(r=null==n?void 0:n.id())&&void 0!==r?r:null}}:{menuName:"ObjectTreeContextMenu",detail:{type:"study",id:(null==n?void 0:n.id())||null}},te.ContextMenuManager.createMenu(i,void 0,e).then((e=>(e.show(t),e)))}}}leftPriceAxisesContainer(){return this._lhsPriceAxisesContainer}rightPriceAxisesContainer(){return this._rhsPriceAxisesContainer}setPriceAxisSizes(e,t,i){this._priceAxisesContainer(e).setSizes(t,i)}state(){return(0,r.ensureNotNull)(this._state)}hasState(){return null!==this._state}setState(e){this._state!==e&&(this.hasState()&&this._unsubscribeFromState(),this._state=e,this.hasState()&&(this._subscribeToState(),this.updatePriceAxisWidgets()))}getScreenshotData(e){var t,i,s,r;const n=[],o=[];let a,l=[];const c=this.state().sourcesByGroup().priceSources().slice().reverse(),h=this._chart.properties().childs().paneProperties.childs().legendProperties.childs();for(const d of c){const c=d.statusView();if((0,T.isStudy)(d)&&(h.showLegend.value()||(null==e?void 0:e.showCollapsedStudies))){const s=h.showStudyTitles.value(),r=s;if(d.properties().childs().visible.value()&&c&&r){n.push(s?d.statusProvider(null==e?void 0:e.status).text():"");const r=Le.enabled("use_last_visible_bar_value_in_legend")&&null!==(i=null===(t=this._chartModel().timeScale().visibleBarsStrictRange())||void 0===t?void 0:t.lastBar())&&void 0!==i?i:null,a=d.valuesProvider().getValues(r);o.push(a)}}else if(d===this._chartModel().mainSeries()&&c&&h.showSeriesTitle.value()){a=d.statusProvider((null==e?void 0:e.status)||{}).text();const t=Le.enabled("use_last_visible_bar_value_in_legend")&&null!==(r=null===(s=this._chartModel().timeScale().visibleBarsStrictRange())||void 0===s?void 0:s.lastBar())&&void 0!==r?r:null;l=d.valuesProvider().getValues(t)}}return{type:"pane",leftAxis:this._lhsPriceAxisesContainer.getScreenshotData(),rightAxis:this._rhsPriceAxisesContainer.getScreenshotData(),content:this._canvasBinding.canvasElement.toDataURL(),canvas:this._canvasBinding.canvasElement,contentWidth:this._size.width,contentHeight:this._size.height,studies:n,studiesValues:o,containsMainSeries:this.containsMainSeries(),mainSeriesText:a,mainSeriesValues:l}}updatePriceAxisWidgets(){if(!this.hasState())return;const e=this._chartModel(),t=e.paneForSource(e.mainSeries());if(!t)return;const i=e.priceScaleSlotsCount(),s=this.state(),r=s.visibleLeftPriceScales(),n=s.visibleRightPriceScales();this._lhsPriceAxisesContainer.setScales(r,i.left,t.leftPriceScales().length,i.left+i.right),this._rhsPriceAxisesContainer.setScales(n,i.right,t.rightPriceScales().length,i.left+i.right)}update(){this.hasState()&&(this._lhsPriceAxisesContainer.update(),this._rhsPriceAxisesContainer.update(),null!==this._legendWidget&&this._legendWidget.update(),this.updateControls())}updateStatusWidget(e){
this.hasState()&&null!==this._legendWidget&&(e.legendWidgetLayoutInvalidated()?this._legendWidget.updateLayout():this._legendWidget.update())}updateControls(){this.hasState()&&null!==this._paneControls&&this._paneControls.update()}updateThemedColors(e){this._themedTopColor=e.topColor,this._updateByThemedColors()}statusWidget(){return this._legendWidget}getElement(){return this._rowElement}canvasElement(){return this._canvasBinding.canvasElement}hasCanvas(e){return this._canvasBinding.canvasElement===e||this._topCanvasBinding.canvasElement===e}pinchStartEvent(){null===this._paneWidgetsSharedState.scrollingPane()&&null===this._paneWidgetsSharedState.pinchingPane()&&(this._onTouchEvent(),this._options.handleScale.pinch&&(this._chartModel().stopTimeScaleAnimation(),this._prevPinchScale=1,this._pinching=!0,this._wasPinched=!0,this._paneWidgetsSharedState.setPinchingPane(this)))}pinchEvent(e,t,i,s){if(null!==this._paneWidgetsSharedState.scrollingPane()||this._paneWidgetsSharedState.pinchingPane()!==this)return;if(this._onTouchEvent(),!this._options.handleScale.pinch)return;const r=10*(s-this._prevPinchScale);this._prevPinchScale=s,this._chartModel().zoomTime(e.x,r,!0),this._prevPinchScale=s}pinchEndEvent(){null===this._paneWidgetsSharedState.scrollingPane()&&this._paneWidgetsSharedState.pinchingPane()===this&&(this._onTouchEvent(),this._pinching=!1,this._paneWidgetsSharedState.setPinchingPane(null))}mouseClickEvent(e){this._onMouseEvent(),this._mouseClickOrTapEvent(e)}tapEvent(e){this._preventTouchEventsExceptPinch()||(this._onTouchEvent(),this._mouseClickOrTapEvent(e))}mouseDownEvent(e){this._onMouseEvent(),this.hasState()&&this._mouseDownOrTouchStartEvent(e,this._dataSourceAtPoint(e.localX,e.localY))}touchStartEvent(e){if(this._paneWidgetsSharedState.startTouch(this),this._preventTouchEventsExceptPinch())return;const t=!this._trackCrosshairOnlyAfterLongTap&&null!==Dt&&Dt.stateId===this.state().id()&&Math.abs(Dt.x-e.localX)+Math.abs(Dt.y-e.localY)<5;this._onTouchEvent(),this._chart.setActivePaneWidget(this);const i=this._dataSourceAtPoint(e.localX,e.localY);if(t){const t=this._chartModel().crossHairSource();null!==i&&i.source===t||t.selectPointMode().value()!==F.SelectPointMode.None?this.startTrackingMode(new L.Point(e.localX,e.localY),new L.Point(e.localX,e.localY)):!this._chart.readOnly()&&null!==i&&(0,C.isLineTool)(i.source)&&i.source.userEditEnabled()&&this._chartUndoModel().selectionMacro((e=>{e.clearSelection(),e.addSourceToSelection(i.source,i.hittest.data())}))}this._mouseDownOrTouchStartEvent(e,i),this._mouseOrTouchMoveEvent(e)}mouseUpEvent(e){this._onMouseEvent(),this._mouseUpOrTouchEndEvent(e)}touchEndEvent(e){this._paneWidgetsSharedState.endTouch(this),this._preventTouchEventsExceptPinch()||(this._onTouchEvent(),this._mouseOrTouchLeaveEvent(e),this._mouseUpOrTouchEndEvent(e))}mouseMoveEvent(e){this._onMouseEvent(),this._mouseOrTouchMoveEvent(e)}pressedMouseMoveEvent(e){this._onMouseEvent(),this._pressedMouseOrTouchMoveEvent(e)}touchMoveEvent(e){this._preventTouchEventsExceptPinch()||(this._onTouchEvent(),
this._pressedMouseOrTouchMoveEvent(e))}mouseLeaveEvent(e){this._onMouseEvent(),this._mouseOrTouchLeaveEvent(e)}mouseDoubleClickEvent(e){this._onMouseEvent(),this._mouseDoubleClickOrDoubleTapEvent(e)}wheelClickEvent(e){if(this._chart.readOnly())return;const t=this._dataSourceAtPoint(e.localX,e.localY);if(null===t||t.isCustom)return;if((t.hittest.result()||0)<=V.HitTestResult.MOVEPOINT_BACKGROUND)return;const i=new N.EnvironmentState(e),s=t.hittest.eraseMarker();if(i.mod()&&void 0!==s&&t.source.processErase)return void t.source.processErase(this._chartUndoModel(),s);const n=this._chartUndoModel();n.selection().isSelected(t.source)||n.selectionMacro((e=>{e.clearSelection();const i=(0,r.ensureNotNull)(t.source);e.addSourceToSelection(i,Mt(t,i))})),this._chart.removeSelectedSources()}doubleTapEvent(e){this._preventTouchEventsExceptPinch()||(this._onTouchEvent(),this._mouseDoubleClickOrDoubleTapEvent(e))}longTapEvent(e){if(null===this._state||this._preventTouchEventsExceptPinch())return;if(this._onTouchEvent(),this._longTap=!0,null!==this._startTrackPoint||!this._trackingModeShouldBeActive())return;const t=this._chartModel().selection();if(!t.isEmpty()){const i=this._dataSourceAtPoint(e.localX,e.localY);if(null!==i&&t.isSelected(i.source))return}this.startTrackingMode(new L.Point(e.localX,e.localY),new L.Point(e.localX,e.localY),new N.EnvironmentState(e))}mouseEnterEvent(e){this._onMouseEvent(),this.hasState()&&(this._chart.setActivePaneWidget(this),this._setCursorPosition(e.localX,e.localY,new N.EnvironmentState(e)))}contextMenuEvent(e){this._onMouseEvent(),this._contextMenuEvent(e)}touchContextMenuEvent(e){this._preventTouchEventsExceptPinch()||(this._onTouchEvent(),this._contextMenuEvent(e))}mouseDownOutsideEvent(e){this._processOutsideClick(null,e)}touchStartOutsideEvent(e){this._processOutsideClick(null,e)}cancelZoom(){this._chartModel().crossHairSource().clearSelection(),this._firstZoomPoint=null,this._preventCrossHairMove()&&this._clearCursorPosition()}startTrackingMode(e,t,i){this._startChangeLineToolParams=null,this._startMoveSourceParams=null,this._currentChangingLineToolHitTest=null,this._currentMovingHitTest=null,this._chartUndoModel().selectionMacro((e=>e.clearSelection())),this._startTrackPoint=e,this._exitTrackingModeOnNextTry=!1,this._setCursorPosition(t.x,t.y,i),this._initCrossHairPosition=this._chartModel().crossHairSource().currentPoint()}setDragToAnotherPaneCursor(){this._setCursorClassName("grabbing")}cloneLineTools(e,t){return this._chartUndoModel().cloneLineTools(e,t)}exitTrackingMode(){null!==this._state&&null!==this._startTrackPoint&&(this._exitTrackingModeOnNextTry=!0,this._tryExitTrackingMode())}trackingModeEnabled(){return null!==this._state&&null!==this._startTrackPoint}addCustomWidgetToLegend(e,t){this._options.legendWidgetEnabled&&(this._customLegendWidgetsFactoryMap.set(e,t),null!==this._legendWidget&&this._legendWidget.addCustomWidgetToLegend(e,t))}containsMainSeries(){return!!this.hasState()&&this.state().containsMainSeries()}paint(e){
if(!this._chartUndoModel()||!this.hasState()||0===this._size.width||0===this._size.height)return;this._canvasBinding.applySuggestedBitmapSize(),this._topCanvasBinding.applySuggestedBitmapSize(),this._state&&(e.priceScaleSideMaxLevel("left")>I.InvalidationLevel.Cursor||e.priceScaleSideMaxLevel("right")>I.InvalidationLevel.Cursor)&&(this._recalculatePriceScales((0,_t.viewportChangeEvent)()),null!==Dt&&Dt.stateId===this.state().id()&&this._setCursorPosition(Dt.x,Dt.y,Dt.envState));const t=e.fullInvalidation();if(t>I.InvalidationLevel.Cursor&&null!==Dt&&Dt.stateId===this.state().id()){const e=this._dataSourceAtPoint(Dt.x,Dt.y);null!==e&&this._updateHoveredSource(e,(0,dt.globalEnvironmentState)())}if(this._lhsPriceAxisesContainer.paint(e.getterForPriceScaleInvalidationLevelBySide("left")),this._rhsPriceAxisesContainer.paint(e.getterForPriceScaleInvalidationLevelBySide("right")),t===I.InvalidationLevel.None)return;const i=this._state&&(this._state.maximized().value()||!this._state.collapsed().value());if(t>I.InvalidationLevel.Cursor){const e=(0,r.ensureNotNull)(this._canvasBinding.canvasElement.getContext("2d"));e.setTransform(1,0,0,1,0,0);const t=this._canvasRenderParams();this._drawBackground(e,t),i&&this._drawSources(e,t)}if(null!==this._state){const e=(0,r.ensureNotNull)(this._topCanvasBinding.canvasElement.getContext("2d"));e.setTransform(1,0,0,1,0,0);const t=this._topCanvasRenderParams();e.clearRect(0,0,Math.ceil(this._size.width*t.pixelRatio),Math.ceil(this._size.height*t.pixelRatio)),i&&this._drawSeriesTopViews(e,t),this._drawCrossHair(e,t),i&&this._drawActiveLineTools(e,t)}}cancelCreatingLineTool(){const e=this._chartUndoModel(),t=this._chartUndoModel().lineBeingCreated();if(t)if(t.pointsCount()<=0&&!(0,nt.isLineDrawnWithPressedButton)(t.toolname)){const i=t.points();if(i.length>2){const s=i[i.length-2];e.continueCreatingLine(s),this._finishTool(t)}else e.cancelCreatingLine()}else e.cancelCreatingLine();null!==this._firstZoomPoint&&this.cancelZoom(),this.setCursorForTool()}drawRightThere(e){if((0,C.isLineToolName)(e)&&this.hasState()){const t=this._chartUndoModel(),i=t.crossHairSource(),s=t.model().magnet().align(i.price,i.index,this.state());t.createLineTool({pane:this.state(),point:{index:i.index,price:s},linetool:e})}}cancelMeasuring(){this._chartUndoModel().crossHairSource().clearMeasure(),(0,F.resetToCursor)(),this.setCursorForTool()}async setErrorMessage(e){var t,i,s;e&&!this._errorRenderer&&(this._errorRenderer=this._createErrorBlock()),null===(t=await this._errorRenderer)||void 0===t||t.update({message:null==e?void 0:e.message,icon:(null===(i=this._state)||void 0===i?void 0:i.containsMainSeries())||(null===(s=this._state)||void 0===s?void 0:s.maximized().value())?null==e?void 0:e.icon:void 0,backgroundColor:`linear-gradient(${this._chartModel().backgroundTopColor().value()}, ${this._chartModel().backgroundColor().value()})`,textColor:this._chartModel().isDark()?St:vt,solutionId:null==e?void 0:e.solutionId})}collapsedHeight(){var e,t
;return Math.max(Math.ceil(null!==(t=null===(e=this._paneControls)||void 0===e?void 0:e.bottomWithMargin())&&void 0!==t?t:0),33)}_topCanvasRenderParams(){return{pixelRatio:(0,H.getBindingPixelRatio)(this._topCanvasBinding),physicalWidth:this._topCanvasBinding.canvasElement.width,physicalHeight:this._topCanvasBinding.canvasElement.height,cssWidth:this._chartModel().timeScale().width(),cssHeight:this.height()}}_canvasRenderParams(){return{pixelRatio:(0,H.getBindingPixelRatio)(this._canvasBinding),physicalWidth:this._canvasBinding.canvasElement.width,physicalHeight:this._canvasBinding.canvasElement.height,cssWidth:this._chartModel().timeScale().width(),cssHeight:this.height()}}_tryExitTrackingMode(e){this._exitTrackingModeOnNextTry&&(this._startTrackPoint=null,e||this._clearCursorPosition())}_tryStartMeasure(e,t,i,s,r){return!(!(0,F.toolIsMeasure)(F.tool.value())||t.startMeasurePoint())&&(e.isTouch||this._preventCrossHairMove()||this._setCursorPosition(e.localX,e.localY,i),s=this._chartModel().magnet().align(s,r,this.state()),t.startMeasuring({price:s,index:r},this.state()),!0)}_tryFinishMeasure(e,t){if(t.startMeasurePoint()&&!t.endMeasurePoint()){let i=t.price;const s=t.index;return i=this._chartModel().magnet().align(i,s,this.state()),t.finishMeasure({price:i,index:s}),e.isTouch?(0,F.resetToCursor)():this._needResetMeasureLater=!0,this._preventCrossHairMove()&&this._clearCursorPosition(),!0}return!1}_tryStartZoom(e,t,i,s){const r=this._chart.model().model().zoomEnabled();if("zoom"===F.tool.value()&&r){const r=this._chartUndoModel(),n=r.timeScale().indexToCoordinate(i)-.5*r.timeScale().barSpacing();return this._firstZoomPoint={price:t,index:i,x:n,y:e.localY},this._preventCrossHairMove()||this._setCursorPosition(e.localX,e.localY,s),this._chartModel().crossHairSource().startSelection(this.state()),!0}return!1}_finishZoom(e){const t=this.state(),i=t.defaultPriceScale(),s=(0,r.ensureNotNull)(t.mainDataSource()).firstValue(),n=i.coordinateToPrice(e.localY,(0,r.ensureNotNull)(s)),o=this._chartUndoModel(),a=Math.round(o.timeScale().coordinateToIndex(e.localX)),l=(0,r.ensureNotNull)(this._firstZoomPoint);a!==l.index&&o.zoomToViewport(l.index,a,l.price,n,t),this._chartModel().crossHairSource().clearSelection(),this._firstZoomPoint=null,(0,F.resetToCursor)(),this._preventCrossHairMove()&&this._clearCursorPosition()}_tryFinishZoom(e){return null!==this._firstZoomPoint&&(this._finishZoom(e),!0)}_tryHandleEraserMouseDown(e,t){if(!("eraser"!==F.tool.value()||e.isCustom||(i=e.source,i&&i.customization&&i.customization.disableErasing))){const i=this._chartUndoModel();if((0,C.isLineTool)(e.source)||(0,T.isStudy)(e.source)){const s=e.hittest.eraseMarker();return t.mod()&&void 0!==s&&e.source.processErase?e.source.processErase(i,s):i.removeSource(e.source,!1),!0}}var i;return!1}_tryStartChangingLineTool(e,t,i,s){var n,o;if(e.isTouch&&null!==this._startTrackPoint)return!1;const a=t.hittest;if((!e.isTouch||!this._preventSourceChange)&&a&&(0,C.isLineTool)(t.source)&&a.result()===V.HitTestResult.CHANGEPOINT){
const l=this._chartUndoModel(),c=(0,r.ensure)(null===(n=this.state().mainDataSource())||void 0===n?void 0:n.firstValue()),h=(0,r.ensureNotNull)(t.source.priceScale()).coordinateToPrice(e.localY,c);l.selectionMacro((e=>{e.clearSelection(),e.addSourceToSelection(t.source,a.data())}));let d=h;t.source.priceScale()===l.mainSeries().priceScale()&&(d=l.model().magnet().align(h,s,this.state()));const u=null===(o=a.data())||void 0===o?void 0:o.pointIndex;return this._startChangeLineToolParams={source:t.source,startPoint:{index:s,price:d},screenPoint:{x:e.localX,y:e.localY},pointIndex:u,envState:i},!0}return this._startChangeLineToolParams=null,!1}_tryStartCloning(e,t,i,s){if(i.mod()){const t=this._chartUndoModel().selection().dataSources().filter((e=>e.cloneable()));if(s&&s.cloneable()&&t.push(s),t.length>0)return this._clonningAtMoveLineTools=t.map((e=>e.id())),this._startCloningPoint=new L.Point(e.localX,e.localY),!0}return!1}_tryFinishClonning(e,t,i){const s=this._chartUndoModel(),n=this._chartModel();if(t.mod()&&this._clonningAtMoveLineTools){const o=new L.Point(e.localX,e.localY),a=(0,r.ensureNotNull)(this._startCloningPoint).subtract(o).length(),l=[];for(const e of this._clonningAtMoveLineTools){const t=n.dataSourceForId(e);null!==t&&l.push(t)}if(0===l.length)return!1;if(a>8){const n=this.cloneLineTools(l,!0).map((e=>(0,r.ensureNotNull)(s.model().dataSourceForId(e))));s.selectionMacro((e=>{e.clearSelection();let t=null;n.forEach((s=>{null===t&&(t=Mt(i,s)),e.addSourceToSelection(s,t)}))}));const o=new L.Point(e.localX,e.localY),a=(0,r.ensureNotNull)(n[0].priceScale()),c=(0,r.ensureNotNull)(this.state().mainDataSource()).firstValue(),h={index:s.timeScale().coordinateToIndex(e.localX),price:a.coordinateToPrice(e.localY,(0,r.ensureNotNull)(c))};s.startMovingSources(n,{logical:h,screen:o},null,t),this._clonningAtMoveLineTools=null,this._startCloningPoint=null}return!0}return!1}_mouseDownEventForLineTool(e,t,i,s){var n,o;const a=F.tool.value();if(!this.hasState()||(0,nt.isLineToolDrawWithoutPoints)(a))return;const l=this._chartUndoModel();let c=!1,h=null;(0,F.hideAllDrawings)().value()&&(0,k.toggleHideMode)(),(0,F.lockDrawings)().setValue(!1),e.isTouch&&!e.stylus&&((0,C.isLineToolName)(a)&&!(0,nt.isLineDrawnWithPressedButton)(a)||l.lineBeingCreated())&&this._initToolCreationModeParams(e);const d=l.lineBeingCreated();if(d&&!(0,nt.isLineDrawnWithPressedButton)(d.toolname)){const a=(0,r.ensure)(null===(n=d.ownerSource())||void 0===n?void 0:n.firstValue());if(e.isTouch&&!e.stylus){if(!this._startTouchPoint){this._startTouchPoint=new L.Point(e.pageX,e.pageY);const t=d.points(),i=t[t.length-1],s=l.timeScale().indexToCoordinate(i.index),n=(0,r.ensureNotNull)(d.priceScale()).priceToCoordinate(i.price,a);return void(this._initCrossHairPosition=new L.Point(s,n))}}else if(!e.isTouch){h=d;const n=l.model().paneForSource(d);if(n!==this._state&&null!==n){const i=this._externalPaneXCoord(n,e.localX),s=this._externalPaneYCoord(n,e.localY);c=l.continueCreatingLine({index:Math.round(l.timeScale().coordinateToIndex(i)),price:(0,
r.ensure)(null===(o=d.priceScale())||void 0===o?void 0:o.coordinateToPrice(s,a))},t)}else{const e=l.model().magnet().align(s,i,this.state());c=l.continueCreatingLine({index:i,price:e},t)}}}else if(!e.isTouch||e.stylus||(0,nt.isLineDrawnWithPressedButton)(a)){const e={index:i,price:l.model().magnet().align(s,i,this.state())};h=l.createLineTool({pane:this.state(),point:e,linetool:a}),l.lineBeingCreated()||(c=!0)}const u=this._dataSourceAtPoint(e.localX,e.localY);h&&l.selectionMacro((e=>{e.addSourceToSelection((0,r.ensureNotNull)(h),null==u?void 0:u.hittest.data())})),c&&h&&(this._finishTool(h,u),e.preventDefault())}_handleSelectionMouseDownAndGetJustDeselectedSource(e,t,i){const s=this._chartUndoModel();let r=null;return(null===t||t.source.isSelectionEnabled())&&s.selectionMacro((s=>{!this._preventSourceChange&&null!==t&&(e.isTouch?t.hittest.result()>=V.HitTestResult.MOVEPOINT_BACKGROUND:t.hittest.result()>V.HitTestResult.MOVEPOINT_BACKGROUND)?(i.mod()||s.selection().isSelected(t.source)||s.clearSelection(),i.mod()&&s.selection().isSelected(t.source)?(r=t.source,s.removeSourceFromSelection(t.source)):s.addSourceToSelection(t.source,t.hittest.data()),s.selection().allSources().length>1&&(0,le.trackEvent)("GUI","Multiselect","Click Select")):i.mod()||s.clearSelection()})),r}_processMouseMoveWhileZoom(e,t){this._preventCrossHairMove()||this._setCursorPosition(e.localX,e.localY,t)}_updateCommonTooltip(e,t){let i=null;if(null!==e&&null!==e.hittest){const t=e.hittest.data();t&&(i=t.tooltip||null)}if(null===this._prevTooltipData&&null===i)return;if(null===i||""===i.text)return this._prevTooltipData=null,void(0,lt.hide)(t);if(this._prevTooltipData&&(0,M.default)(i,this._prevTooltipData))return;this._prevTooltipData=i;const s=(0,_.clone)(i);if(void 0!==s.rect){const e=this._paneCell.getBoundingClientRect();s.rect.x+=e.left,s.rect.y+=e.top}(0,lt.show)(s)}_setCursorPositionOnExternalPane(e,t,i,s){t=this._externalPaneXCoord(e,t),i=this._externalPaneYCoord(e,i);this._chart.paneByState(e)._setCursorPosition(t,i,s)}_setCursorPosition(e,t,i){this._updateLastCrosshairPosition(e,t,i),this._chartModel().setAndSaveCurrentPosition(this._correctXCoord(e),this._correctYCoord(t),this.state(),i)}_updateLastCrosshairPosition(e,t,i){const s=this.state().id();Dt={x:e,y:t,envState:i,stateId:s}}_setCursorClassName(e){let t="";e&&(t="pane--cursor-"+e),this._currentCursorClassName!==t&&(this._currentCursorClassName&&this._paneCell.classList.remove(this._currentCursorClassName),t&&this._paneCell.classList.add(t),this._currentCursorClassName=t,this._paneCell.style.cursor)}_processMouseUpOrTouchEndHandler(e){const t=this._dataSourceAtPoint(e.localX,e.localY);null!==t&&t.hittest.tryCallMouseUpOrTouchEndHandler(e)}_crossHairShouldBeVisible(){const e=this._chartModel().crossHairSource();return(0,C.isLineToolName)(F.tool.value())||(0,F.toolIsMeasure)(F.tool.value())||e.startMeasurePoint()&&!e.endMeasurePoint()||null!==this._firstZoomPoint||null!==this._chartModel().lineBeingEdited()||null!==this._chartModel().lineBeingCreated()}_clearCursorPosition(){
Dt=null,this._chartModel().clearCurrentPosition()}_dataSourceAtPoint(e,t){if(!this.hasState())return null;const i={result:null},s=this._chartUndoModel();if((0,C.isLineToolName)(F.tool.value())||null!==s.lineBeingCreated())return i.result;if(this._currentChangingLineToolHitTest)return this._currentChangingLineToolHitTest;if(this._currentMovingHitTest)return this._currentMovingHitTest;const r=this.state(),n=r.height(),o=r.width(),a=Lt.bind(null,i),l=this._canvasRenderParams(),c=new L.Point(e,t);if(!this.state().maximized().value()&&this.state().collapsed().value()||(0,D.lastMouseOrTouchEventInfo)().isTouch&&(F.activePointSelectionMode.value()!==F.SelectPointMode.None||null!==this._startTrackPoint))return this._hitTestSources(l,[s.crossHairSource()],c,a,!1),i.result;const h=r.sourcesByGroup(),d=s.selection();this._hitTestSources(l,d.dataSources(),c,a,!1),this._hitTestSources(l,d.customSources(),c,a,!0);const u=new Set(d.allSources().map((e=>e.id())));this._hitTestSources(l,[s.crossHairSource()],c,a,!1,u),this._hitTestSources(l,r.customSources(R.CustomSourceLayer.Topmost),c,a,!0,u),this._hitTestSources(l,h.tradingSources(),c,a,!1,u),this._hitTestSources(l,r.customSources(R.CustomSourceLayer.Foreground),c,a,!0,u);const p=[...this._chartModel().multiPaneSources(r),...h.hitTestSources()];if(this._hitTestSources(l,p,c,a,!1,u),this.containsMainSeries()){const e=s.activeStrategySource().value();if(null!==e){const t=e.strategyOrdersPaneView();if(null!==t){const s=t.renderer(n,o);if(null!==s){const t=s.hitTest(c,l);t&&Lt(i,t,e,s,!1)}}}}return null===i.result&&this._hitTestSources(l,r.customSources(R.CustomSourceLayer.Background),c,a,!0,u),i.result}_hitTestSources(e,t,i,s,n,o){const a=(0,r.ensureNotNull)(this._state),l=a.height(),c=a.width();for(let r=t.length-1;r>=0;--r){const h=t[r];if(void 0!==o&&o.has(h.id()))continue;const d=h.paneViews(a);if(null!==d&&0!==d.length)for(let t=d.length-1;t>=0;--t){const r=d[t].renderer(l,c);if(r&&r.hitTest){const t=r.hitTest(i,e);null!==t&&s(t,h,r,n)}}}}_tryStartMovingLineTool(e,t,i,s){var n;if(null===t.source||!t.source.movable()||null!==this._startTrackPoint)return!1;if(!this._preventSourceChange){const o=this._chartUndoModel(),a=(0,r.ensureNotNull)((0,r.ensureNotNull)(this._state).mainDataSource()).firstValue(),l=(0,r.ensureNotNull)(t.source.priceScale()).coordinateToPrice(e.localY,(0,r.ensureNotNull)(a));let c=(t.source.isSelectionEnabled()?o.selection().allSources():[t.source]).filter(ut);const h=c.filter(C.isLineTool);c=h.length>0?h:c.includes(t.source)?[t.source]:[c[0]];const d=new L.Point(e.localX,e.localY),u={index:s,price:l},p=null===(n=t.hittest.data())||void 0===n?void 0:n.activeItem;return this._startMoveSourceParams={source:c,startPoint:{logical:u,screen:d},activeItem:void 0===p?null:p,envState:i},!0}return this._startMoveSourceParams=null,!1}_chartModel(){return this._chart.model().model()}_chartUndoModel(){return this._chart.model()}_externalPaneXCoord(e,t){t+=this._div.getBoundingClientRect().left+document.body.scrollLeft;const i=(0,
r.ensureNotNull)(this._chart.paneByState(e)),s=i._div.getBoundingClientRect().left+document.body.scrollLeft;return i._correctXCoord(t-s)}_externalPaneYCoord(e,t){t+=this._div.getBoundingClientRect().top+document.body.scrollTop;const i=(0,r.ensureNotNull)(this._chart.paneByState(e)),s=i._div.getBoundingClientRect().top+document.body.scrollTop;return i._correctYCoord(t-s)}_correctXCoord(e){return Math.max(0,Math.min(e,this._size.width-1))}_correctYCoord(e){return Math.max(0,Math.min(e,this._size.height-1))}_processScroll(e){if(!this._chart.model().model().scrollEnabled())return;const t=performance.now();this._startScrollingPos||this._preventScroll()||(this._startScrollingPos={x:e.clientX,y:e.clientY,timestamp:t,localX:e.localX,localY:e.localY});const i=this._chartUndoModel(),s=this._chartModel().timeScale();let r=this.state().defaultPriceScale();if(this._startScrollingPos&&!this._isScrolling&&(this._startScrollingPos.x!==e.clientX||this._startScrollingPos.y!==e.clientY)){if(i.beginUndoMacro(yt,!0),null===this._scrollXAnimation&&this._options.useKineticScroll){const e=s.barSpacing();this._scrollXAnimation=new Je(.2/e,7/e,.997,15/e),this._scrollXAnimation.addPosition(s.rightOffset(),this._startScrollingPos.timestamp)}return i.selection().isEmpty()||(r=i.selection().allSources()[0].priceScale()),null===r||r.isEmpty()||(this._scrollPriceScale=r,i.startScrollPrice(this.state(),r,e.localY)),i.startScrollTime(e.localX),this._isScrolling=!0,this.setCursorForTool(),void this._paneWidgetsSharedState.setScrollingPane(this)}this._isScrolling&&(null!==this._scrollPriceScale&&i.scrollPriceTo(this.state(),this._scrollPriceScale,e.localY),i.scrollTimeTo(e.localX),null!==this._scrollXAnimation&&this._scrollXAnimation.addPosition(s.rightOffset(),t))}_finishScroll(){const e=this._chartUndoModel();e.endScrollTime(),null!==this._scrollPriceScale&&e.endScrollPrice(this.state(),this._scrollPriceScale),e.endUndoMacro(),this._isScrolling=!1,this._startScrollingPos=null,this._scrollPriceScale=null,this.setCursorForTool(),this._paneWidgetsSharedState.setScrollingPane(null)}_endScroll(e){if(!this._isScrolling)return!1;this._finishScroll();const t=this._scrollUndoCommandInStack(),i=performance.now(),s=this._chartUndoModel().timeScale();return null!==this._scrollXAnimation&&(this._scrollXAnimation.start(s.rightOffset(),i),this._scrollXAnimation.finished(i)||(this._chartModel().setTimeScaleAnimation(this._scrollXAnimation),this._scrollXAnimation=null)),t}_preventScroll(){return this._trackCrosshairOnlyAfterLongTap&&this._longTap||this._contextMenuOpenedOnLastTap||(0,C.isLineToolName)(F.tool.value())||Boolean(this._chartUndoModel().lineBeingCreated())||null!==this._startTrackPoint}_isSelectPointModeEnabled(){return this._chartUndoModel().crossHairSource().selectPointMode().value()!==F.SelectPointMode.None}_preventCrossHairMove(){return!!this._trackCrosshairOnlyAfterLongTap&&(null===this._chart.trackingModePaneWidget()&&(!!this._contextMenuOpenedOnLastTap||!this._crossHairShouldBeVisible()&&null===this._startTrackPoint))}_finishTool(e,t=null){
const i=this._chartUndoModel(),s=e.toolname;if(s===F.tool.value()&&(0,F.resetToCursor)(),this._preventCrossHairMove()&&this._clearCursorPosition(),i.selectionMacro((i=>{i.addSourceToSelection(e,Mt(t,e))})),(0,nt.isTextToolName)(s)){const t=i.createUndoCheckpoint();this._chart.showChartPropertiesForSource(e,ot.TabNames.text,void 0,t).then((e=>{0}))}this._lastFinishedToolId=e.id(),(0,d.emit)("drawing_event",e.id(),"create"),(0,rt.trackDrawingCreated)(e)}_alignSourcesThatBeingMoved(e,t,i,s){const r=this._chartUndoModel(),n=r.timeScale().coordinateToIndex(t);r.model().sourcesBeingMoved().forEach((e=>{var o;let a=n,l=e.convertYCoordinateToPriceForMoving(i,this.state().mainDataSource());if(null!==l){if((0,T.isStudy)(e)){const e=r.mainSeries(),t=e.bars().firstIndex(),i=e.bars().lastIndex();null!==t&&null!==i&&(a=Math.min(Math.max(n,t),i)),l=this._chartModel().magnet().align(l,n,this.state())}null!==this._currentMovingHitTest&&void 0!==(null===(o=this._currentMovingHitTest.hittest.data())||void 0===o?void 0:o.cursorType)||this.setCursorForTool(),r.moveSources({screen:new L.Point(t,i),logical:{index:a,price:l}},s)}}))}_resetMeasureIfRequired(){this._needResetMeasureLater&&((0,F.resetToCursor)(),this._needResetMeasureLater=!1)}_drawBackground(e,t){const i=Math.ceil(t.pixelRatio*this._size.width),s=Math.ceil(t.pixelRatio*this._size.height),r=this._chartModel(),n=r.backgroundTopColor().value(),o=r.backgroundColor().value();n===o?(0,H.clearRect)(e,0,0,i+1,s+1,o):(0,U.clearRectWithGradient)(e,0,0,i+1,s+1,n,o)}_drawWatermark(e,t){const i=this._chartModel().watermarkSource();if(null===i)return;const s=this.state();if(!s.containsMainSeries())return;const r=i.paneViews(),n=s.height(),o=s.width();for(const i of r){e.save();const s=i.renderer(n,o);s&&s.draw(e,t),e.restore()}}_drawCrossHair(e,t){const i=this._chartUndoModel().crossHairSource();!i.visible&&(0,F.lockTimeAxis)().value()&&(i.setLockedPosition((0,r.ensureNotNull)(this._state)),i.updateAllViews((0,_t.sourceChangeEvent)(i.id()))),this._drawSourceImpl(e,t,Ct,Pt,i)}_drawActiveLineTools(e,t){const i=this._chartModel(),s=[i.lineBeingCreated(),i.lineBeingEdited(),...i.sourcesBeingMoved(),i.customSourceBeingMoved()].filter((e=>!!e));for(const r of s){(i.paneForSource(r)===this.state()||(0,O.isDataSource)(r)&&r.isMultiPaneEnabled())&&this._drawSourceImpl(e,t,Ct,Pt,r)}}_drawSeriesTopViews(e,t){this.state().containsMainSeries()&&this._drawSourceImpl(e,t,Tt,Pt,this._chartUndoModel().mainSeries())}_drawSources(e,t){const i=this.state(),s=i.model(),r=i.sourcesByGroup(),n=r.tradingSources(),o=[...s.multiPaneSources(i),...r.generalSources()],a=r.phantomSources(),l=i.customSources(R.CustomSourceLayer.Background).slice(),c=i.customSources(R.CustomSourceLayer.Foreground).slice(),h=i.customSources(R.CustomSourceLayer.Topmost).slice();{const e=s.panes();for(let t=e.length-1;t>=0;t--)e[t].createDrawingsCaches()}this._drawSourceImpl(e,t,Ct,Pt,s.gridSource()),this._drawWatermark(e,t);for(const i of l)this._drawSourceImpl(e,t,Ct,wt,i);for(const i of o)this._drawSourceImpl(e,t,Ct,wt,i)
;for(const i of c)this._drawSourceImpl(e,t,Ct,wt,i);for(const i of a)this._drawSourceImpl(e,t,Ct,wt,i);const d=new Set;[s.lineBeingCreated(),s.lineBeingEdited(),...s.sourcesBeingMoved(),s.customSourceBeingMoved()].filter(_.notNull).forEach((e=>d.add(e.id())));let u=s.hoveredSource();null!==u&&((0,O.isDataSource)(u)&&!u.showOnTopOnHovering()||d.has(u.id())||(0,O.isDataSource)(u)&&!o.includes(u)?u=null:d.add(u.id()));const p=s.selection().allSources().filter((e=>!((0,O.isDataSource)(e)&&!o.includes(e))&&!d.has(e.id())));p.forEach((e=>d.add(e.id())));{for(const i of l)this._drawSourceImpl(e,t,Ct,Pt,i,d);for(const i of o)this._drawSourceImpl(e,t,Ct,Pt,i,d);for(const i of c)this._drawSourceImpl(e,t,Ct,Pt,i,d);const i=s.activeStrategySource().value();i&&this.containsMainSeries()&&this._drawSourceImpl(e,t,It,Pt,i)}for(const i of n)this._drawSourceImpl(e,t,Ct,wt,i);for(const i of h)this._drawSourceImpl(e,t,Ct,wt,i);for(const i of o)this._drawSourceImpl(e,t,xt,Pt,i,d);for(const i of c)this._drawSourceImpl(e,t,xt,Pt,i,d);for(const i of n)this._drawSourceImpl(e,t,Ct,Pt,i,d);for(const i of h)this._drawSourceImpl(e,t,Ct,Pt,i,d);for(const i of p)this._drawSourceImpl(e,t,Ct,Pt,i);for(const i of p)this._drawSourceImpl(e,t,xt,Pt,i);u&&(this._drawSourceImpl(e,t,Ct,Pt,u),this._drawSourceImpl(e,t,xt,Pt,u));for(const i of a)this._drawSourceImpl(e,t,Ct,Pt,i,d);{const e=s.panes();for(let t=e.length-1;t>=0;t--)e[t].clearDrawingCaches()}}_drawSourceImpl(e,t,i,s,r,n){if(n&&n.has(r.id()))return;const o=this.state(),a=o.height(),l=o.width(),c=i(r,this.state());if(c)for(const i of c){const r=i.renderer(a,l);r&&(e.save(),s(r,e,t),e.restore())}}_updateByThemedColors(){null!==this._legendWidget&&this._legendWidget.updateThemedColors(this._themedTopColor),null!==this._paneControls&&this._paneControls.updateThemedColors(this._themedTopColor)}_scrollUndoCommandInStack(){const e=this._chartUndoModel().undoHistory().undoStack();if(e.isEmpty())return!1;const t=e.head();if(!(t instanceof W.UndoMacroCommand))return!1;if(t.isEmpty())return!1;const i=t.commands()[0];return i instanceof it.PriceScaleChangeUndoCommand||i instanceof tt.TimeScaleChangeUndoCommand}_onStateDestroyed(){this.setState(null)}_onDataSourcesCollectionChanged(){this._startMoveSourceParams=null}_processMouseEnterLeaveMoveHandlers(e,t){var i,s,r,n;null===this._prevHoveredHittest||this._prevHoveredHittest.renderer===(null==e?void 0:e.renderer)&&(null===(i=this._prevHoveredHittest.hittest.data())||void 0===i?void 0:i.activeItem)===(null===(s=e.hittest.data())||void 0===s?void 0:s.activeItem)||((0,V.tryCallHandler)(t,null===(r=this._prevHoveredHittest.hittest.data())||void 0===r?void 0:r.mouseLeaveHandler),this._prevHoveredHittest=null),t.isTouch||null!==e&&((null===(n=this._prevHoveredHittest)||void 0===n?void 0:n.renderer)!==e.renderer&&(e.hittest.tryCallMouseEnterHandler(t),this._prevHoveredHittest=e),e.hittest.tryCallMouseMoveHandler(t))}_startChangeOrMoveLineToolIfNeeded(){if(null!==this._startChangeLineToolParams){const e=this._startChangeLineToolParams
;this._chartUndoModel().startChangingLinetool(e.source,e.startPoint,e.pointIndex,e.envState)}if(null!==this._startMoveSourceParams){const e=this._startMoveSourceParams;this._chartUndoModel().startMovingSources(e.source,e.startPoint,e.activeItem,e.envState)}this._startMoveSourceParams=null,this._startChangeLineToolParams=null}_trackingModeShouldBeActive(){return!(!this._trackCrosshairOnlyAfterLongTap||this._contextMenuOpenedOnLastTap||this._crossHairShouldBeVisible())&&this._longTap}_processOutsideClick(e,t){var i;let s=null;const r=this._chartModel();if(null!==e&&(s=e.isCustom?r.customSourceName(e.source):e.source.id()),null!==this._lastClickedSource&&this._lastClickedSource.id!==s){const e=this._lastClickedSource.id;let i=this._lastClickedSource.isCustom?r.customSourceForName(e):r.dataSourceForId(e);null!==i||this._lastClickedSource.isCustom||(i=r.dataSourceForId(e)),null!==i&&i.onClickOutside&&(i.onClickOutside(t),this._chartModel().updateSource(i))}this._lastClickedSource=null!==s?{id:s,isCustom:null!==(i=null==e?void 0:e.isCustom)&&void 0!==i&&i}:null}_mouseClickOrTapEvent(e){var t;if(!this.hasState())return;const i=this._dataSourceAtPoint(e.localX,e.localY),s=i&&i.source,n=this._chartUndoModel(),o=Boolean(null===(t=null==i?void 0:i.hittest.data())||void 0===t?void 0:t.hideCrosshairLinesOnHover);this._processOutsideClick(i,e),!this._isSelectPointModeEnabled()||o||e.isTouch&&this.trackingModeEnabled()&&!this._exitTrackingModeOnNextTry||n.crossHairSource().trySelectCurrentPoint(),null!==i&&i.hittest.tryCallClickOrTapHandler(e)&&n.model().updateSource((0,r.ensureNotNull)(s)),!e.isTouch||this._isSelectPointModeEnabled()||i&&i.source===n.crossHairSource()||this._tryExitTrackingMode(),s&&(0,C.isLineTool)(s)&&this._lastFinishedToolId!==s.id()&&(0,d.emit)("drawing_event",s.id(),"click"),this._resetMeasureIfRequired()}_mouseDownOrTouchStartEvent(e,t){var i,s,n,o,a;if(this._pressedMoveStage=1,e.isTouch&&(this._longTap=!1,this._exitTrackingModeOnNextTry=null!==this._startTrackPoint,this._paneWidgetsSharedState.clearDraggingSource()),this._contextMenuOpenedOnLastTap=!1,this._lastFinishedToolId=null,this._chartModel().stopTimeScaleAnimation(),e.isTouch&&this._switchTrackingModeFromAnotherPaneIfNeeded(e),document.activeElement!==document.body&&document.activeElement!==document.documentElement)document.activeElement&&document.activeElement.blur?document.activeElement.blur():document.body.focus();else{const e=document.getSelection();null!==e&&e.removeAllRanges()}(0,d.emit)("mouse_down",{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY}),this._updateCommonTooltip(null);const l=this._chartUndoModel(),c=new N.EnvironmentState(e);l.mainSeries().clearGotoDateResult();const h=this.state().defaultPriceScale();if(h.isEmpty()||l.timeScale().isEmpty())return;const u=l.crossHairSource();if(!e.isTouch&&!(0,nt.isLineDrawnWithPressedButton)(F.tool.value())){const t=l.lineBeingCreated(),i=null!==t?l.model().paneForSource(t):null
;null!==i&&i!==this._state?this._setCursorPositionOnExternalPane(i,e.localX,e.localY,c):this._setCursorPosition(e.localX,e.localY,c)}e.isTouch&&(0,C.isLineToolName)(F.tool.value())&&((0,nt.isLineDrawnWithPressedButton)(F.tool.value())||null!==u.pane?(0,nt.isLineDrawnWithPressedButton)(F.tool.value())&&this._clearCursorPosition():this._chart.updateCrossHairPositionIfNeeded());const p=(0,r.ensureNotNull)(this.state().mainDataSource()).firstValue();if(null===p)return void(this._chart.readOnly()||(this._handleSelectionMouseDownAndGetJustDeselectedSource(e,t,c),null!==t&&(0,st.isPriceDataSource)(t.source)&&t.source.isDraggable()&&this._paneWidgetsSharedState.trySetDraggingSource(t.source,this)));let _=h.coordinateToPrice(e.localY,p),m=this._chartModel().timeScale().coordinateToIndex(e.localX);if(u.startMeasurePoint()&&u.endMeasurePoint()&&u.clearMeasure(),c.shift()&&(null===t||!(null===(s=null===(i=t.hittest.data())||void 0===i?void 0:i.hasOwnShortcutsBehaviourFor)||void 0===s?void 0:s.shiftKey))&&(0,F.toolIsCursor)(F.tool.value())&&l.selection().isEmpty()&&F.tool.setValue("measure"),(e.isTouch&&!e.stylus||!this._tryStartMeasure(e,u,c,_,m))&&(e.isTouch&&!e.stylus||!this._tryFinishMeasure(e,u))&&!this._tryFinishZoom(e)&&!this._tryStartZoom(e,_,m,c)){if(e.isTouch&&(null!==this._startTrackPoint?(this._initCrossHairPosition=u.currentPoint(),this._startTrackPoint=new L.Point(e.localX,e.localY)):this._isSelectPointModeEnabled()&&null===this._chart.trackingModePaneWidget()&&this.startTrackingMode(new L.Point(e.localX,e.localY),new L.Point(e.localX,e.localY),new N.EnvironmentState(e))),e.isTouch&&(this._preventSourceChange=null===t||!l.selection().isSelected(t.source)),!this._isSelectPointModeEnabled()&&!this._isScrolling){if(e.isTouch&&!e.stylus&&((0,F.toolIsMeasure)(F.tool.value())||null!==u.measurePane().value()))return void this._initToolCreationModeParams(e);if((0,C.isLineToolName)(F.tool.value())||l.lineBeingCreated())return c.shift()||l.selectionMacro((e=>e.clearSelection())),void this._mouseDownEventForLineTool(e,c,m,_)}if(null!==t&&t.hittest.tryCallMouseDownOrTouchStartHandler(e),!this._chart.readOnly()){const i=this._handleSelectionMouseDownAndGetJustDeselectedSource(e,t,c);if(null!==t&&!this._preventSourceChange){const i=t.hittest.data();if(t.isCustom){if(t.hittest.hasPressedMoveHandler(e))return l.model().setMovingCustomSource(t.source,i),this._currentMovingHitTest=t,void l.selectionMacro((e=>{e.clearSelection(),e.addSourceToSelection((0,r.ensureNotNull)(t.source),(0,r.ensureNotNull)(i))}))}else if((null==i?void 0:i.areaName)===V.AreaName.SourceItemMove){const s=null==i?void 0:i.activeItem;if(void 0!==s)return l.startCustomMoving(t.source,s,e),this._currentMovingHitTest=t,void l.selectionMacro((e=>{e.clearSelection(),e.addSourceToSelection((0,r.ensureNotNull)(t.source),(0,r.ensureNotNull)(i))}))}}if(null!==t&&this._tryHandleEraserMouseDown(t,c))return;const s=null!==t&&(0,C.isLineTool)(t.source)&&t.source.isLocked&&t.source.isLocked();if(!((0,F.lockDrawings)().value()||s)&&null!==t&&!t.isCustom){
if(!t.source.userEditEnabled())return;const s=null===(n=t.hittest.data())||void 0===n?void 0:n.snappingPrice,l=null===(o=t.hittest.data())||void 0===o?void 0:o.snappingIndex;let h=e.localY,d=e.localX;if(void 0!==s&&(h=(0,r.ensure)(null===(a=t.source)||void 0===a?void 0:a.priceScale()).priceToCoordinate(s,p),_=s),void 0!==l&&(d=this._chartModel().timeScale().indexToCoordinate(l),m=l),h===e.localY&&d===e.localX||(e={...e,localY:h,localX:d},this._setCursorPosition(e.localX,e.localY,c)),this._tryStartChangingLineTool(e,t,c,m))return void(this._currentChangingLineToolHitTest=t);if(this._currentChangingLineToolHitTest=null,(g=t.hittest.result())===V.HitTestResult.MOVEPOINT||g===V.HitTestResult.MOVEPOINT_BACKGROUND&&(0,D.lastMouseOrTouchEventInfo)().isTouch){if(this._tryStartCloning(e,t,c,i))return;if(this._tryStartMovingLineTool(e,t,c,m))return void(this._currentMovingHitTest=t);this._currentMovingHitTest=null}}if(null!==t&&(0,st.isPriceDataSource)(t.source)&&t.source.isDraggable()&&this._paneWidgetsSharedState.trySetDraggingSource(t.source,this))return}var g;null!==t&&t.hittest.result()===V.HitTestResult.REGULAR||(this._processing=!0)}}_mouseUpOrTouchEndEvent(e){var t,i;if(!this.hasState())return;this._pressedMoveStage=0;const s=e.isTouch&&null!==this._startTrackPoint,n=e.isTouch&&this._wasPinched;e.isTouch&&(this._wasPinched=!1,this._longTap=!1),this._startMoveSourceParams=null,this._startChangeLineToolParams=null,this._currentChangingLineToolHitTest=null,this._currentMovingHitTest=null;const o=this._chartUndoModel(),a=o.model().customSourceMovingHitTestData();null!==a||o.customMoveBeingProcessed()||this._processMouseUpOrTouchEndHandler(e),this._isSelecting=!1;const l=o.model(),c=l.crossHairSource(),h=this._dataSourceAtPoint(e.localX,e.localY);if(c.selection()&&null===this._firstZoomPoint){const e=this.state().lineToolsForArea(c.selection());o.selectionMacro((t=>{let i=null;e.forEach((e=>{null===i&&(i=Mt(h,e)),t.addSourceToSelection(e,i)}))})),c.clearSelection(),(0,le.trackEvent)("GUI","Multiselect","Area Select")}(0,d.emit)("mouse_up",{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY});const u=e.isTouch&&this._touchMove;e.isTouch&&(this._touchMove=!1);const p=new N.EnvironmentState(e),_=F.tool.value();if(e.isTouch&&((0,F.toolIsMeasure)(_)||null!==c.measurePane().value())){if(!u&&!e.stylus&&null===c.measurePane().value()&&c.pane!==this._state)return void this._setCursorPosition(e.localX,e.localY);if(!u&&!e.stylus&&this._tryStartMeasure(e,c,p,c.price,c.index))return;if((!u||e.stylus)&&this._tryFinishMeasure(e,c))return}if(e.isTouch&&!u&&!(0,nt.isLineDrawnWithPressedButton)(_)&&(0,C.isLineToolName)(_)&&!o.lineBeingCreated()){if(this._chart.justActivated())return;if(c.pane!==this._state)return void this._setCursorPosition(e.localX,e.localY,p);const i=c.currentPoint(),s=this.state().defaultPriceScale(),n=(0,r.ensure)(null===(t=this.state().mainDataSource())||void 0===t?void 0:t.firstValue()),a={index:Math.round(o.timeScale().coordinateToIndex(i.x)),
price:s.coordinateToPrice(i.y,n)},l=(0,r.ensureNotNull)(o.createLineTool({pane:this.state(),point:a,linetool:_}));return o.selectionMacro((e=>{e.addSourceToSelection(l)})),o.lineBeingCreated()||(this._finishTool(l,h),e.preventDefault()),void(this._startTouchPoint=null)}const m=o.lineBeingCreated();if(m&&!(0,nt.isLineDrawnWithPressedButton)(m.toolname)&&e.isTouch&&(this._startTouchPoint||e.stylus)){if(this._startTouchPoint=null,!u||e.stylus){const t=m.points()[m.points().length-1],i=o.continueCreatingLine({index:t.index,price:t.price},new N.EnvironmentState(e));this._initCrossHairPosition=null,i&&(this._finishTool(m,h),e.preventDefault())}return}if(null!==this._firstZoomPoint&&this._firstZoomPoint.draggingMode)return void this._finishZoom(e);if(this._processing=!1,o.customMoveBeingProcessed())return void o.endCustomMoving();if(null!==a&&(a.beingMoved&&((0,V.tryCallHandler)(e,a.mouseUpHandler,a.touchEndHandler),this.setCursorForTool()),l.setMovingCustomSource(null,null),Bt(e,a)))return;if(l.lineBeingEdited())return o.endChangingLinetool(!1),void(this._preventCrossHairMove()&&this._clearCursorPosition());if((0,nt.isLineDrawnWithPressedButton)(_)&&!this._isSelectPointModeEnabled()){const t=o.lineBeingCreated();null!==t&&((0,rt.trackDrawingCreated)(t),t.finish());const s=this.state().defaultPriceScale();if(s.isEmpty())return;if(!t)return;const n=(0,r.ensure)(null===(i=t.ownerSource())||void 0===i?void 0:i.firstValue()),a=s.coordinateToPrice(e.localY,n),l={index:Math.round(o.timeScale().coordinateToIndex(e.localX)),price:a};return void o.continueCreatingLine(l)}if(l.sourcesBeingMoved().length)return o.endMovingSource(!1,!1),l.sourcesBeingMoved().filter(C.isLineTool).forEach((e=>{this.setCursorForTool(e)})),void l.invalidate(I.InvalidationMask.cursor());if(!this._chart.readOnly()){const t=e.localX>=0&&e.localX<this._size.width;if((!h||h.source!==c)&&t){const t=o.timeScale().coordinateToIndex(e.localX);l.onSyncScrollNeeded(t)}}const g=this._isScrolling,f=this._endScroll(e),v=this._paneWidgetsSharedState.draggingSource();if(null!==v){const t=e.target,i=this._chart.paneByCanvas(t);i&&i!==this&&(f&&o.undoHistory().undo(),o.mergeToPane(v,i.state()));if(this._chart.timeAxisByCanvas(t))if(l.isUnmergeAvailableForSource(v))f&&o.undoHistory().undo(),o.unmergeToNewBottomPane(v);else{const e=l.panes(),t=(0,r.ensureNotNull)(l.paneForSource(v)),i=e.indexOf(t);i!==e.length-1&&(f&&o.undoHistory().undo(),t.maximized().value()&&this._chart.toggleMaximizePane(null),o.movePane(i,e.length-1))}this._paneWidgetsSharedState.clearDraggingSource();const s=this._chart.getTimeScale();s&&s.restoreDefaultCursor();const n=this._chart.paneWidgets();for(let e=0;e<n.length;e++){const t=n[e];t===this&&h&&!h.isCustom?t.setCursorForTool(h.source||void 0):t.setCursorForTool(),t.leftPriceAxisesContainer().restoreDefaultCursor(),t.rightPriceAxisesContainer().restoreDefaultCursor()}}this._chart.readOnly()||s||p.mod()||g||n||null!==this._lastFinishedToolId||null!==h&&(h.hittest.result()>V.HitTestResult.MOVEPOINT_BACKGROUND||(0,
D.lastMouseOrTouchEventInfo)().isTouch)&&o.selectionMacro((e=>{e.clearSelection();const t=(0,r.ensureNotNull)(h.source);e.addSourceToSelection(t,Mt(h,t))})),e.isTouch&&(this._touchMove=!1)}_mouseOrTouchMoveEvent(e){if(!this.hasState())return;this._resetMeasureIfRequired();const t=this._dataSourceAtPoint(e.localX,e.localY);this._processMouseEnterLeaveMoveHandlers(t,e);const i=this._chartUndoModel();if(!i)return;const s=e.localX,r=e.localY;this._prevMoveEventPosition=new L.Point(s,r);const n=new N.EnvironmentState(e);if(null===this._firstZoomPoint){if(this._updateHoveredSource(t,n,e),!e.isTouch&&i.lineBeingCreated()){const e=i.lineBeingCreated(),t=null===e?null:i.model().paneForSource(e);if(null!==t&&t!==this._state)return void this._setCursorPositionOnExternalPane(t,s,r,n)}e.isTouch||this._setCursorPosition(s,r,n)}else this._processMouseMoveWhileZoom(e,n)}_pressedMouseOrTouchMoveEvent(e){var t;if(!this.hasState()||this._pinching||e.isTouch&&this._contextMenuOpenedOnLastTap)return;this._pressedMoveStage=2,this._resetMeasureIfRequired(),this._startChangeOrMoveLineToolIfNeeded(),e.isTouch&&(this._touchMove=!0,this._preventSourceChange=!1);const i=new N.EnvironmentState(e),s=this._chartUndoModel(),n=s.crossHairSource(),o=e.localX,a=e.localY;if(this._prevMoveEventPosition=new L.Point(o,a),null!==this._firstZoomPoint)return this._processMouseMoveWhileZoom(e),void(this._firstZoomPoint.draggingMode=!0);const l=F.tool.value();if(e.isTouch&&this._startTouchPoint&&(0,C.isLineToolName)(l)&&!(0,nt.isLineDrawnWithPressedButton)(l)&&!s.lineBeingCreated()&&!this._isSelectPointModeEnabled())return void this._updateCrosshairPositionInToolCreationMode(e,this.state());const c=n.measurePane().value();if(e.isTouch&&(this._startTouchPoint||e.stylus)&&((0,F.toolIsMeasure)(l)||null!==c))return void(e.stylus?this._setCursorPosition(e.localX,e.localY,new N.EnvironmentState(e)):this._updateCrosshairPositionInToolCreationMode(e,c||this.state()));const h=s.lineBeingCreated();if(e.isTouch&&!e.stylus&&h&&!(0,nt.isLineDrawnWithPressedButton)(h.toolname)){if(this._startTouchPoint){const t=(0,r.ensureNotNull)(s.lineBeingCreated()),i=(0,r.ensureNotNull)(s.model().paneForSource(t));this._updateCrosshairPositionInToolCreationMode(e,i)}return}if(e.isTouch&&null!==this._startTrackPoint){this._exitTrackingModeOnNextTry=!1;const e=(0,r.ensureNotNull)(this._initCrossHairPosition),t=new L.Point(o,a).subtract(this._startTrackPoint),s=e.add(t);this._setCursorPosition(s.x,s.y,i)}else e.isTouch&&this._preventCrossHairMove()||this._setCursorPosition(o,a,i);const d=this._isSelectPointModeEnabled();if((0,C.isLineToolName)(l)&&!(0,nt.isLineDrawnWithPressedButton)(l)&&!d&&!i.mod())return;if((0,nt.isLineDrawnWithPressedButton)(l)&&!d){const i=this.state().defaultPriceScale();if(i.isEmpty())return;const n=s.lineBeingCreated();if(!n)return;const o=new L.Point(e.localX,e.localY),a=(0,r.ensure)(null===(t=n.ownerSource())||void 0===t?void 0:t.firstValue());return o.price=i.coordinateToPrice(e.localY,a),o.index=Math.round(s.timeScale().coordinateToIndex(e.localX)),
void s.continueCreatingLine(o)}if(null!==this._paneWidgetsSharedState.draggingSource()){const t=e.target,i=this._chart.paneByCanvas(t);i&&(i!==this?i.setDragToAnotherPaneCursor():i.setCursorForTool());const s=this._chart.timeAxisByCanvas(t);s&&s.setCursor("grabbing")}if(s.timeScale().isEmpty())return;const u=this._options.handleScroll;if((!u.pressedMouseMove||e.isTouch)&&(!u.horzTouchDrag&&!u.vertTouchDrag||!e.isTouch))return;if(s.customMoveBeingProcessed())return void s.processCustomMove(e);const p=s.model().customSourceMovingHitTestData();if(null!==p&&(this._updateCommonTooltip(null,!0),s.model().processingCustomSourceMove(),(0,V.tryCallHandler)(e,p.pressedMouseMoveHandler,p.touchMoveHandler),Bt(e,p)))return;if(s.model().lineBeingEdited())return void this._setCursorPosition(o,a,i);if(s.model().sourcesBeingMoved().length)return void this._alignSourcesThatBeingMoved(s.model().sourcesBeingMoved(),e.localX,e.localY,i);const _=this._dataSourceAtPoint(e.localX,e.localY);if(this._tryFinishClonning(e,new N.EnvironmentState(e),_))return;const m=(0,F.toolIsMeasure)(l)||n.startMeasurePoint()&&n.endMeasurePoint();this._chart.readOnly()||!i.mod()||(0,C.isLineToolName)(l)||m||d?(this._processScroll(e),this._preventScroll()&&!this._preventCrossHairMove()&&null===this._startTrackPoint&&this._setCursorPosition(e.localX,e.localY,new N.EnvironmentState(e))):this._isSelecting||(n.startSelection(this.state()),this._isSelecting=!0)}_mouseOrTouchLeaveEvent(e){var t;if(!this.hasState())return;const i=this._chartUndoModel();if(!i)return;const s=i.crossHairSource();e.isTouch||null!==s.measurePane().value()&&null===s.endMeasurePoint()||this._clearCursorPosition(),i.model().setHoveredSource(null,null),null!==this._prevHoveredHittest&&((0,V.tryCallHandler)(e,null===(t=this._prevHoveredHittest.hittest.data())||void 0===t?void 0:t.mouseLeaveHandler),this._prevHoveredHittest=null),this._updateCommonTooltip(null),this._chart.unsetActivePaneWidget()}_mouseDoubleClickOrDoubleTapEvent(e){if(!this.hasState())return;const t=!this._chart.readOnly()&&!(0,C.isLineToolName)(F.tool.value())&&this._dataSourceAtPoint(e.localX,e.localY)||null;if(null!==t&&t.isCustom)t.hittest.tryCallDblClickOrDblTapHandler(e);else if(null!==t&&(e.isTouch||t.hittest.result()>V.HitTestResult.MOVEPOINT_BACKGROUND))this.processDoubleClickOnSource(t.source,t.hittest?t.hittest:void 0);else if(!this._chart.readOnly()&&!(0,C.isLineToolName)(F.tool.value())&&!this._chartUndoModel().lineBeingCreated()&&this._chartUndoModel().selection().isEmpty()){const t=this.state();new N.EnvironmentState(e).mod()&&!t.maximized().value()?(t.collapsed().value()||this._chartModel().paneCollapsingAvailable().value())&&this._chart.toggleCollapsedPane(this):this._chart.toggleMaximizePane(this)}}_contextMenuEvent(e){const t=this._chartUndoModel();if(t.crossHairSource().startMeasurePoint()&&!this._trackCrosshairOnlyAfterLongTap)return t.crossHairSource().clearMeasure(),void(0,F.resetToCursor)(!0);if(this._pinching)return;if(null===this._firstZoomPoint||this._trackCrosshairOnlyAfterLongTap||this.cancelZoom(),
!(0,F.toolIsCursor)(F.tool.value())||this._isSelectPointModeEnabled()){if(e.isTouch)return;return(0,F.resetToCursor)(!0),this.setCursorForTool(),void(t.lineBeingCreated()&&t.cancelCreatingLine())}if(!this._options.contextMenuEnabled)return;const i=this._dataSourceAtPoint(e.localX,e.localY),s=i?i.source:null;if(e.isTouch&&null!==this._startTrackPoint){if(this._preventSourceChange)return;this._clearCursorPosition()}e.isTouch&&(this._contextMenuOpenedOnLastTap=!0,this._startTrackPoint=null),this._contextMenuX=e.localX,this._contextMenuY=e.localY;const r=i&&i.hittest?i.hittest.result():0,n=r>=V.HitTestResult.REGULAR||r>=V.HitTestResult.MOVEPOINT_BACKGROUND&&e.isTouch;this._chart.updateActions(),t.selectionMacro((t=>{null!==s&&n?t.selection().isSelected(s)||(t.clearSelection(),t.addSourceToSelection(s,Mt(i,s))):(this._options.contextMenu.general&&this._showContextMenu(e),t.clearSelection())})),null!==i&&n&&null!==s&&((0,O.isDataSource)(s)&&s.hasContextMenu()?s.isSelectionEnabled()?this.showContextMenuForSelection(e):this.showContextMenuForSources([s],e):i.hittest.tryCallContextMenuHandler(e))}_onMouseEvent(){this._preventSourceChange=!1,this._startTrackPoint=null,this._trackCrosshairOnlyAfterLongTap=!1}_onTouchEvent(){this._trackCrosshairOnlyAfterLongTap=!0}_switchTrackingModeFromAnotherPaneIfNeeded(e){const t=this._chart.trackingModePaneWidget();if(null!==t&&t!==this){const i=this._chartModel().crossHairSource().currentPoint();t._exitTrackingModeOnNextTry=!0,t._tryExitTrackingMode(!0),this.startTrackingMode(new L.Point(e.localX,e.localY),new L.Point(i.x,e.localY),new N.EnvironmentState(e))}}_showContextMenu(e){const t=e=>e instanceof ke.Separator,i=this._customActions(),s=this._initActions(e).filter((e=>null!==e));i.remove.forEach((e=>{for(let t=0;t<s.length;t++){const i=s[t];if(i instanceof ke.Action&&i.getLabel()===e){s.splice(t,1);break}}}));const r=i.top.concat(s).concat(i.bottom);for(let e=r.length-1;e>0;e--)t(r[e])&&t(r[e-1])&&r.splice(e,1);r.length&&t(r[0])&&r.splice(0,1),r.length&&t(r[r.length-1])&&r.splice(r.length-1,1),te.ContextMenuManager.showMenu(r,e,{statName:"ChartContextMenu"},{menuName:"ChartContextMenu"})}_initActions(e){var t,i;const s=this._chart.actions(),r=[];if(r.push(s.chartReset),r.push(new ke.Separator),!this.state().isEmpty()&&Le.enabled("datasource_copypaste")){const t=(0,Ae.createActionCopyPrice)(this.state(),e.localY),i=(0,Ae.createPasteAction)(this._chart,this.state());(t||i)&&(t&&r.push(t),i&&r.push(i),r.push(new ke.Separator))}this._options.contextMenu.mainSeriesTrade&&this.containsMainSeries()&&r.push((0,Ae.createActionTrade)(this._chart,this.state(),e)),r[r.length-1]instanceof ke.Separator||r.push(new ke.Separator);return Boolean(null===(t=window.widgetbar)||void 0===t?void 0:t.widget("watchlist"))&&s.addToWatchlist&&r.push(s.addToWatchlist),Le.enabled("text_notes")&&r.push(s.addToTextNotes),r[r.length-1]instanceof ke.Separator||r.push(new ke.Separator),s.moveChartAction&&!s.moveChartAction.isDisabled()&&r.push(s.moveChartAction,new ke.Separator),
r.push(this._createLockTimeAxisAction(e)),r.push(new ke.Separator),s.paneObjectTree&&r.push(s.paneObjectTree),r.push((0,Ae.createLinesAction)(this._chart)),!Le.enabled("charting_library_base")&&s.applyColorTheme&&r.push(s.applyColorTheme),r[r.length-1]instanceof ke.Separator||r.push(new ke.Separator),this._chart.applyIndicatorsToAllChartsAvailable()&&(r.push(s.applyStudiesToAllCharts),r.push(new ke.Separator)),r.push(s.paneRemoveAllDrawingTools),r.push(s.paneRemoveAllStudies),r.push(new ke.Separator),(null===(i=window.pro)||void 0===i?void 0:i.hasPackage("mtp-mtpredictor"))&&this.state().containsMainSeries()&&r.push((0,Ae.createMTPredictorActions)(this._chart,this.state(),this._contextMenuX,this._contextMenuY),new ke.Separator),r.push(s.hideAllMarks),r.push(new ke.Separator),Le.enabled("show_chart_property_page")&&r.push(s.chartProperties),r[r.length-1]instanceof ke.Separator&&r.pop(),r}_loadAndCreateLegendWidget(){Promise.all([i.e(7257),i.e(2301),i.e(2670),i.e(9255),i.e(5093)]).then(i.bind(i,276268)).then((e=>{if(this._isDestroyed)return;const t=e.LegendWidget,i=(0,B.deepExtend)({},this._options.legendWidget);i.canShowSourceCode=!this._chart.onWidget()&&!c.CheckMobile.any(),i.readOnlyMode=i.readOnlyMode||this._chart.readOnly(),i.statusesWidgets={sourceStatusesEnabled:this._options.sourceStatusesWidgetEnabled,sourceStatuses:this._options.sourceStatusesWidget||{},marketStatusEnabled:this._options.marketStatusWidgetEnabled,dataUpdateModeEnabled:this._options.chartWarningWidgetEnabled,dataUpdateMode:this._options.chartWarningWidget||{},dataProblemEnabled:this._options.dataProblemWidgetEnabled};const s=(0,m.combine)(((e,t)=>Et&&this._chart!==e&&!t),this._chart.chartWidgetCollection().activeChartWidget,this._chart.chartWidgetCollection().lock.crosshair),n=(0,m.combine)(((e,t)=>null!==e?e===this._state:(0,F.toolIsMeasure)(t)),this._chartModel().crossHairSource().measurePane(),F.tool);this._legendWidget=new t(this._chartUndoModel(),this,this._chart.backgroundTopTheme().spawn(),s,this._visuallyCollapsed.spawn(),n,i,{showContextMenuForSelection:this.showContextMenuForSelection.bind(this),showContextMenuForSources:this.showContextMenuForSources.bind(this),updateActions:this._chart.updateActions.bind(this._chart),showChartPropertiesForSource:this._chart.showChartPropertiesForSource.bind(this._chart),showGeneralChartProperties:this._chart.showGeneralChartProperties.bind(this._chart),showObjectsTreeDialog:this._chart.showObjectsTreeDialog.bind(this._chart)}),this._div.appendChild(this._legendWidget.getElement()),this._legendWidget.updateLayout(),this._legendWidget.updateWidgetModeBySize(this._size),this._legendWidget.updateThemedColors(this._themedTopColor);for(const e of Array.from(this._customLegendWidgetsFactoryMap.keys()))this._legendWidget.addCustomWidgetToLegend(e,(0,r.ensureDefined)(this._customLegendWidgetsFactoryMap.get(e)))}))}_loadAndCreatePaneControlsWidget(){
Promise.all([Promise.all([i.e(7257),i.e(2301),i.e(2670),i.e(9255),i.e(5093)]).then(i.bind(i,771906)),Promise.all([i.e(7257),i.e(2301),i.e(2670),i.e(9255),i.e(5093)]).then(i.bind(i,159255))]).then((([e,t])=>{var i;if(this._isDestroyed)return;const s=e.PaneControlsWidget;this._paneControls=new s(this._chartUndoModel(),this,{backgroundThemeName:this._chart.backgroundTopTheme()},{toggleMaximizePane:this._chart.toggleMaximizePane.bind(this._chart),toggleCollapsedPane:this._chart.toggleCollapsedPane.bind(this._chart)},this._div),this._paneControls.updateWidgetModeByWidth(this._size.width),this._paneControls.updateThemedColors(this._themedTopColor),this._paneControlsResizeObserver=new t.default(this._handleRestrictLegendWidth.bind(this)),this._paneControlsResizeObserver.observe(this._paneControls.getElement()),(null===(i=this._state)||void 0===i?void 0:i.collapsed().value())&&this._chartModel().fullUpdate()}))}_handleRestrictLegendWidth(e){if(null===this._legendWidget||null===this._paneControls)return;const t=e[e.length-1].contentRect.width,i=0===t?0:t+gt+ft;this._legendWidget.addMargin(i)}_onMagnetStateChanged(){this._chart.isActive()&&(this._isSelectPointModeEnabled()||this._isToolActionActiveOnPane(!0))&&this._chartModel().crossHairSource().visible&&this._updateLineToolUsingMagnetOrShift()}_onShiftKeyStateChanged(){this._chart.isActive()&&this._isToolActionActiveOnPane(!1)&&this._chartModel().crossHairSource().visible&&this._updateLineToolUsingMagnetOrShift(N.EnvironmentState.create((0,dt.shiftPressed)().value()))}_isToolActionActiveOnPane(e){const t=this._chartModel(),i=t.lineBeingCreated()||t.lineBeingEdited()||t.sourcesBeingMoved().length>0&&t.sourcesBeingMoved()[0];return i?t.paneForSource(i)===this._state:e&&(0,C.isLineToolName)(F.tool.value())&&t.crossHairSource().pane===this._state}_updateLineToolUsingMagnetOrShift(e){if(null===this._prevMoveEventPosition)return;const{x:t,y:i}=this._prevMoveEventPosition,s=this._chartModel().sourcesBeingMoved();s.length>0?(F.isStudyEditingNow.value()&&this._setCursorPosition(t,i,e),this._alignSourcesThatBeingMoved(s,t,i,e)):this._setCursorPosition(t,i,e)}_showEditDialogForSource(e,t){if(this._options.propertyPagesEnabled&&e.userEditEnabled())if(e===this._chartUndoModel().mainSeries())this._chart.showGeneralChartProperties(ot.TabNames.symbol);else if((0,C.isLineTool)(e)||(0,T.isStudy)(e)){let i;const s=null==t?void 0:t.data();if(null!=s){const e=s.areaName;void 0!==e&&(i=kt.get(e))}this._chart.showChartPropertiesForSource(e,i).then((e=>{this._editDialog=e}))}}_initToolCreationModeParams(e){this._startTouchPoint=new L.Point(e.pageX,e.pageY),this._initCrossHairPosition=this._chartModel().crossHairSource().currentPoint()}_updateCrosshairPositionInToolCreationMode(e,t){if(t!==this._state){const i=this._chart.paneByState(t);return i._startTouchPoint=this._startTouchPoint,i._initCrossHairPosition=this._initCrossHairPosition,void i._updateCrosshairPositionInToolCreationMode(e,t)}const i=this._chartModel().crossHairSource()
;this._chart.justActivated()&&(this._initCrossHairPosition=i.currentPoint());const s=e.pageX,n=e.pageY,o=(0,r.ensureNotNull)(this._initCrossHairPosition),a=new L.Point(s,n).subtract((0,r.ensureNotNull)(this._startTouchPoint)),l=o.add(a);this._setCursorPosition(l.x,l.y,new N.EnvironmentState(e))}_priceAxisesContainer(e){return"left"===e?this._lhsPriceAxisesContainer:this._rhsPriceAxisesContainer}_recalculatePriceScales(e){const t=this.state();for(const i of t.leftPriceScales())t.recalculatePriceScale(i,e);for(const i of t.rightPriceScales())t.recalculatePriceScale(i,e);for(const i of t.sourcesByGroup().overlayPriceScaleSources())(0,C.isLineTool)(i)||t.recalculatePriceScale(i.priceScale(),e)}_createLockTimeAxisAction(e){const t=(0,F.lockTimeAxis)().value();return new ke.Action({actionId:"Chart.Crosshair.LockVerticalCursor",label:bt,statName:"LockCursorInTime",checkable:!0,checked:t,onExecute:()=>this._toggleLockTimeAxis(e.localX,!t)})}_toggleLockTimeAxis(e,t){if(t){const t=this._chartUndoModel().timeScale(),i=t.coordinateToIndex(e),s=t.points().roughTime(i);null!==s&&F.lockTimeAxisTime.setValue(s)}(0,F.lockTimeAxis)().setValue(t)}_preventTouchEventsExceptPinch(){return this._paneWidgetsSharedState.hasTouchesOnOtherPanes(this)||null!==this._paneWidgetsSharedState.pinchingPane()}_updateHoveredSource(e,t,i){var s,r;const n=this._chartUndoModel(),o=n.model();let a=!1;const l=e&&e.source,c=this._chart.readOnly();if(o.crossHairSource().isReplaySelection())this._setCursorClassName("none");else if(!(!c||e&&(0,C.isLineTool)(e.source))||this._editDialog&&this._editDialog.visible().value())c&&(o.setHoveredSource(null,null),this.setCursorForTool());else{const h=F.tool.value();let d=null;if(!this._processing&&((0,F.toolIsCursor)(h)||"eraser"===h&&!c||t.mod()||!n.lineBeingCreated())){const t=null==e?void 0:e.hittest;a=Boolean(null===(s=null==t?void 0:t.data())||void 0===s?void 0:s.hideCrosshairLinesOnHover),t&&t.result()>V.HitTestResult.MOVEPOINT_BACKGROUND?(d=l,!(null==l?void 0:l.isHoveredEnabled())||"eraser"===h&&l===n.mainSeries()?o.setHoveredSource(null,null):o.setHoveredSource(l,t.data())):o.setHoveredSource(null,null)}c?this.setCursorForTool(d,t,at.PaneCursorType.Default):this._options.sourceSelectionEnabled&&(this._isSelectPointModeEnabled()?this._setCursorClassName("pointer"):this.setCursorForTool(d,t,null===(r=null==e?void 0:e.hittest.data())||void 0===r?void 0:r.cursorType));const u=o.customSourceBeingMoved(),p=null!==u?[u]:o.sourcesBeingMoved();if((!p.length||null!==e&&-1===p.indexOf(e.source))&&this._updateCommonTooltip(e),!c&&null!==e&&i&&e.hittest.hasPressedMoveHandler(i)){switch((e.hittest.data()||{}).cursorType){case at.PaneCursorType.VerticalResize:this._setCursorClassName("ns-resize");break;case at.PaneCursorType.HorizontalResize:this._setCursorClassName("we-resize");break;case at.PaneCursorType.DiagonalNeSwResize:this._setCursorClassName("nesw-resize");break;case at.PaneCursorType.DiagonalNwSeResize:this._setCursorClassName("nwse-resize")}}}this._preventCrossHairMove()&&this._clearCursorPosition(),
1!==this._pressedMoveStage&&o.crossHairSource().setLinesShouldBeHidden(a)}async _createErrorBlock(){const e=new(await ct());return this._div.insertBefore(e.container,this._topCanvasBinding.canvasElement.nextSibling),e}_customActions(){const e={top:[],bottom:[],remove:[]},t=this._chartUndoModel().timeScale(),i=this._state&&this._state.defaultPriceScale();if(!Le.enabled("custom_items_in_context_menu"))return e;const s=t.isEmpty()?void 0:t.indexToUserTime(t.coordinateToIndex(this._contextMenuX));let n;if(i&&!i.isEmpty()){const e=(0,r.ensureNotNull)(this.state().mainDataSource()).firstValue();n=i.coordinateToPrice(this._contextMenuY,(0,r.ensureNotNull)(e))}return(0,d.emit)("onContextMenu",{unixtime:null!=s?s.getTime()/1e3:void 0,price:n,callback:t=>{[...t].forEach((t=>{if(t.text)if(t.text.length>1&&"-"===t.text[0])e.remove.push(t.text.slice(1));else{let i;i="-"===t.text?new ke.Separator:new ke.Action({actionId:"Chart.ExternalActionId",label:t.text,onExecute:t.click}),t.position&&"top"===t.position?e.top.push(i):e.bottom.push(i)}}))}}),e}_highlightPriceAxisByLabel(e){this._lhsPriceAxisesContainer.highlightPriceAxisByLabel(e),this._rhsPriceAxisesContainer.highlightPriceAxisByLabel(e)}_subscribeToState(){const e=this.state();e.onDestroyed().subscribe(this,this._onStateDestroyed,!0),e.dataSourcesCollectionChanged().subscribe(this,this._onDataSourcesCollectionChanged),e.maximized().subscribe(this._updateVisuallyCollapsed),e.collapsed().subscribe(this._updateVisuallyCollapsed)}_unsubscribeFromState(){const e=this.state();e.onDestroyed().unsubscribeAll(this),e.dataSourcesCollectionChanged().unsubscribeAll(this),e.maximized().unsubscribe(this._updateVisuallyCollapsed),e.collapsed().unsubscribe(this._updateVisuallyCollapsed)}async _updateEndOfSeriesBanner(){}}var Rt=i(951782);class Nt{constructor(e,t,i){this._handleEl=null,this._resizeInfo=null,this._colorCache={lineColor:"",backgroundColor:"",color:""},this._chart=e,this._topPaneIndex=t,this._bottomPaneIndex=i,this._row=document.createElement("tr"),this._cell=document.createElement("td"),this._row.appendChild(this._cell),this._cell.classList.add(Rt.paneSeparator),this._cell.setAttribute("colspan","3"),this._cell.style.background=this._color(),this.adjustSize(),this._cell.addEventListener("click",(()=>{}));const s=document.createElement("div");s.classList.add(Rt.handle),this._cell.appendChild(s),this._mouseEventHandler=new z.MouseEventHandler(s,this,{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0}),this._handleEl=s}destroy(){this._mouseEventHandler.destroy(),this._row.parentElement&&this._row.parentElement.removeChild(this._row)}getElement(){return this._row}hide(){this._row.classList.add("js-hidden")}show(){this._row.classList.remove("js-hidden")}adjustSize(){this._row.style.height=Nt.height()+"px"}mouseEnterEvent(e){const{topPane:t,bottomPane:i}=this._topBottomPane(!0);null!==t&&null!==i&&(0,r.ensureNotNull)(this._handleEl).classList.add(Rt.hovered)}mouseLeaveEvent(e){(0,r.ensureNotNull)(this._handleEl).classList.remove(Rt.hovered)}mouseDownEvent(e){
this._mouseDownOrTouchStartEvent(e)}touchStartEvent(e){this._mouseDownOrTouchStartEvent(e)}pressedMouseMoveEvent(e){this._pressedMouseOrTouchMoveEvent(e)}touchMoveEvent(e){this._pressedMouseOrTouchMoveEvent(e)}mouseUpEvent(e){this._mouseUpOrTouchEndEvent(e)}touchEndEvent(e){this._mouseUpOrTouchEndEvent(e)}update(){this._cell.style.background=this._color().toString()}paint(){}image(){const{topPane:e}=this._topBottomPane(!1),t=e.leftPriceAxisesContainer().getWidth(),i=e.width(),r=e.rightPriceAxisesContainer().getWidth(),n=this._color(),o=(0,H.createDisconnectedCanvas)(document,(0,s.size)({width:t,height:1})),a=(0,H.getPrescaledContext2D)(o);a.fillStyle=n,a.fillRect(0,0,t,1);const l=(0,H.createDisconnectedCanvas)(document,(0,s.size)({width:i,height:1})),c=(0,H.getPrescaledContext2D)(l);c.fillStyle=n,c.fillRect(0,0,i,1);const h=(0,H.createDisconnectedCanvas)(document,(0,s.size)({width:r,height:1})),d=(0,H.getPrescaledContext2D)(h);return d.fillStyle=n,d.fillRect(0,0,r,1),{type:"separator",leftAxis:{content:o.toDataURL(),canvas:o,contentWidth:t,contentHeight:1},rightAxis:{content:h.toDataURL(),canvas:h,contentWidth:r,contentHeight:1},content:l.toDataURL(),canvas:l,contentWidth:i,contentHeight:1}}static height(){const e=window.devicePixelRatio||1;return e>=1?1:1/e}_mouseDownOrTouchStartEvent(e){const{topPane:t,bottomPane:i}=this._topBottomPane(!0);if(null===t||null===i)return;const s=t.state().stretchFactor()+i.state().stretchFactor(),n=s/(t.height()+i.height()),o=30*n;s<=2*o||(this._resizeInfo={startY:e.pageY,prevStretchTopPane:t.state().stretchFactor(),maxPaneStretch:s-o,totalStretch:s,pixelStretchFactor:n,minPaneStretch:o},(0,r.ensureNotNull)(this._handleEl).classList.add(Rt.active))}_pressedMouseOrTouchMoveEvent(e){const{topPane:t,bottomPane:i}=this._topBottomPane(!0),s=this._resizeInfo;if(null===s||null===t||null===i)return;const r=(e.pageY-s.startY)*s.pixelStretchFactor,n=(0,pe.clamp)(s.prevStretchTopPane+r,s.minPaneStretch,s.maxPaneStretch);t.state().setStretchFactor(n),i.state().setStretchFactor(s.totalStretch-n),this._chart.model().model().fullUpdate()}_mouseUpOrTouchEndEvent(e){const{topPane:t,bottomPane:i}=this._topBottomPane(!0),s=this._resizeInfo;null!==s&&null!==t&&null!==i&&(this._chart.model().addPaneStretchFactorUndoCommand(t.state(),i.state(),s.prevStretchTopPane,t.state().stretchFactor()),this._resizeInfo=null,(0,r.ensureNotNull)(this._handleEl).classList.remove(Rt.active))}_color(){const e=this._chart.properties().childs().paneProperties.childs().separatorColor.value(),t=this._chart.model().model().backgroundColor().value();if(this._colorCache.lineColor!==e||this._colorCache.backgroundColor!==t){const i=(0,ce.parseRgba)(t),s=(0,ce.parseRgba)(e),r=0===i[3]&&0===s[3]?"rgba(0,0,0,0)":(0,ce.rgbaToString)((0,ce.blendRgba)(i,s));this._colorCache={lineColor:e,backgroundColor:t,color:r}}return this._colorCache.color}_topBottomPane(e){const t=this._chart.paneWidgets();let i=null,s=null;for(let s=this._topPaneIndex;s>=0;--s){const r=t[s];if(!e||!r.state().collapsed().value()){i=r;break}}
for(let i=this._bottomPaneIndex;i<t.length;++i){const r=t[i];if(!e||!r.state().collapsed().value()){s=r;break}}return{topPane:i,bottomPane:s}}}var Ot=i(451144),Ft=i(694568);i(488656);const Wt={contextMenuEnabled:!0,timezoneMenuEnabled:!0,pressedMouseMoveScale:!0},zt=new E.TranslatedString("change session",n.t(null,void 0,i(765303))),Ht=n.t(null,void 0,i(25866));class Ut{constructor(e,t,i,r,n){this._rendererOptions=null,this._onLabelHovered=new(ee()),this._mousedown=!1,this._currentCursorClassName="invalid",this._options=(0,_.merge)((0,_.clone)(Wt),t||{}),this.chart=e,this._properties=e.properties().childs().scalesProperties,this._element=document.createElement("tr"),this._backgroundBasedTheme=n;const o=()=>this.backgroundColor(),a=()=>{throw new Error("Time axis does not support real price scales")},l={titlesProvider:i,stubContextMenuProvider:(e,t)=>{const i=this.getContextMenuActions(!0);let s=r(e,t);if(s[s.length-1]===this.chart.actions().scalesProperties){const e=[new ke.Separator].concat(i);Array.prototype.splice.apply(s,[s.length-2,0,...e])}else s.push(new ke.Separator),s=s.concat(i);return s},backgroundBasedTheme:n,rendererOptionsProvider:e.model().model().rendererOptionsProvider(),getBackgroundTopColor:o,getBackgroundBottomColor:o,showHorizontalBorder:!0};this._lhsStubContainer=new oe(this._properties,"left",a,l,this._options.priceAxisLabelsOptions,this),this._lhsStubContainer.onLabelHovered().subscribe(this,((e,t)=>{this._onLabelHovered.fire(e,t)})),this._rhsStubContainer=new oe(this._properties,"right",a,l,this._options.priceAxisLabelsOptions,this),this._rhsStubContainer.onLabelHovered().subscribe(this,((e,t)=>{this._onLabelHovered.fire(e,t)})),this._element.appendChild(this._lhsStubContainer.getElement()),this._cell=document.createElement("td"),this._element.appendChild(this._cell),this._cell.classList.add("chart-markup-table","time-axis"),this._cell.style.height="25px",this._dv=document.createElement("div"),this._dv.style.width="100%",this._dv.style.height="100%",this._dv.style.position="relative",this._dv.style.overflow="hidden",this._cell.appendChild(this._dv),this._canvasConfiguredHandler=()=>this.chart.model().model().lightUpdate(),this._canvasBinding=(0,H.createBoundCanvas)(this._dv,(0,s.size)({width:16,height:16})),this._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler);const c=this._canvasBinding.canvasElement;c.style.position="absolute",c.style.zIndex="1",c.style.left="0",c.style.top="0",this._topCanvasBinding=(0,H.createBoundCanvas)(this._dv,(0,s.size)({width:16,height:16})),this._topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler);const h=this._topCanvasBinding.canvasElement;h.style.position="absolute",h.style.zIndex="2",h.style.left="0",h.style.top="0",this._element.appendChild(this._rhsStubContainer.getElement()),this.restoreDefaultCursor(),this.update(),this._minVisibleSpan=Ot.MINUTE_SPAN,this._mouseEventHandler=new z.MouseEventHandler(this._topCanvasBinding.canvasElement,this,{treatVertTouchDragAsPageScroll:!0,
treatHorzTouchDragAsPageScroll:!1}),this.size=(0,s.size)({width:0,height:0}),(0,F.hideMarksOnBars)().subscribe(this,(()=>this.chart.model().model().lightUpdate()))}destroy(){this._mouseEventHandler.destroy(),this._topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler),this._topCanvasBinding.dispose(),this._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasConfiguredHandler),this._canvasBinding.dispose(),this._rhsStubContainer.onLabelHovered().unsubscribeAll(this),this._lhsStubContainer.onLabelHovered().unsubscribeAll(this),this._lhsStubContainer.destroy(),this._rhsStubContainer.destroy(),this.chart.properties().childs().paneProperties.childs().background.unsubscribeAll(this),(0,F.hideMarksOnBars)().unsubscribeAll(this)}setCursor(e){let t="";"grabbing"!==e&&"ew-resize"!==e||(t="time-axis--cursor-"+e),this._currentCursorClassName!==t&&(this._currentCursorClassName&&this._cell.classList.remove(this._currentCursorClassName),t&&this._cell.classList.add(t),this._currentCursorClassName=t,this._cell.style.cursor)}restoreDefaultCursor(){this.setCursor("")}getElement(){return this._element}optimalHeight(){const e=this.rendererOptions();return Math.ceil(e.borderSize+e.offsetSize+e.fontSize+e.paddingTop+e.paddingBottom+e.labelBottomOffset)}setSizes(e,t,i){this.size&&(0,s.equalSizes)(this.size,e)||(this.size=e,this._canvasBinding.resizeCanvasElement(e),this._topCanvasBinding.resizeCanvasElement(e),this._cell.style.width=e.width+"px",this._cell.style.height=e.height+"px"),this._lhsStubContainer.setSizes(e.height,t),this._rhsStubContainer.setSizes(e.height,i)}rendererOptions(){if(!this._rendererOptions||this._rendererOptions.fontSize!==this.fontSize()){const e=this.fontSize();this._rendererOptions={borderSize:1,offsetSize:5,fontSize:e,font:(0,j.makeFont)(e,Y.CHART_FONT_FAMILY,""),widthCache:new ae.TextWidthCache,paddingTop:3*e/12,paddingBottom:3*e/12,paddingHorizontal:9*e/12,labelBottomOffset:4*e/12}}return this._rendererOptions}backgroundColor(){return this.chart.model().model().backgroundColor().value()}lineColor(){const e=this._properties.childs().lineColor.value();if(0===(0,ce.parseRgba)(e)[3]){const e=this.chart.model().model().lastPane();if(e&&(e.collapsed().value()||e.isMainPane()&&this._areEventsEnabled()))return this.chart.properties().childs().paneProperties.childs().separatorColor.value()}return e}textColor(){return this._properties.childs().textColor.value()}fontSize(){return this._properties.childs().fontSize.value()}baseFont(){return(0,j.makeFont)(this.fontSize(),Y.CHART_FONT_FAMILY)}baseBoldFont(){return(0,j.makeFont)(this.fontSize(),Y.CHART_FONT_FAMILY,"","bold")}hasCanvas(e){return this._canvasBinding.canvasElement===e||this._topCanvasBinding.canvasElement===e}onLabelHovered(){return this._onLabelHovered}getScreenshotData(){return{content:this._canvasBinding.canvasElement.toDataURL(),canvas:this._canvasBinding.canvasElement,contentWidth:this.size.width,contentHeight:this.size.height,lhsStub:this._lhsStubContainer.getScreenshotData(),
rhsStub:this._rhsStubContainer.getScreenshotData()}}getContextMenuActions(e){var t;const i=this.chart;i.updateActions();const s=i.actions(),r=[];if(e||r.push(s.timeScaleReset,new ke.Separator),this._options.timezoneMenuEnabled&&r.push(s.applyTimeZone),r.push(s.sessionBreaks),!i.model().mainSeries().isDWM()){const e=null===(t=i.model())||void 0===t?void 0:t.mainSeries().symbolInfo();if(e){const t=i.model().mainSeries().properties().childs().sessionId,s=(e.subsessions||[]).filter((e=>!e.private));if(s.length>1){const e=s.map((e=>{const s={label:(0,Ft.translateSessionDescription)(e.description),checkable:!0,checked:t.value()===e.id,statName:"SetSession",onExecute:()=>{i.model().setProperty(t,e.id,zt)}};return new ke.Action({...s,actionId:"Chart.SetSession"})})),n={label:Ht,statName:"SetSession",subItems:e},o=new ke.Action({...n,actionId:"Chart.SetSession"});r.push(o)}}}return r}update(){if(!this.chart.hasModel())return;const e=this.chart.model().timeScale().marks();if(e){this._minVisibleSpan=Ot.YEAR_SPAN;for(const t of e)this._minVisibleSpan=Math.min(t.span,this._minVisibleSpan)}}updatePriceAxisStubs(){const e=this.chart.model().model(),t=this.chart.isMaximizedPane()?(0,r.ensureNotNull)(this.chart.maximizedPaneWidget()).state():e.paneForSource(e.mainSeries());if(!t)return;const i=e.priceScaleSlotsCount();this._lhsStubContainer.setScales([],i.left,t.leftPriceScales().length,i.left+i.right),this._rhsStubContainer.setScales([],i.right,t.rightPriceScales().length,i.left+i.right)}paint(e){if(e===I.InvalidationLevel.None||0===this.size.width||0===this.size.height)return;this._canvasBinding.applySuggestedBitmapSize(),this._topCanvasBinding.applySuggestedBitmapSize();const t=(0,H.getContext2D)(this._topCanvasBinding.canvasElement);if(e>I.InvalidationLevel.Cursor){const i=(0,H.getContext2D)(this._canvasBinding.canvasElement),s=(0,H.getBindingPixelRatio)(this._canvasBinding);this.drawBackground(i,s),this.chart.hasModel()&&(this.drawBorder(i,s),this.drawTickMarks(i,s),this.drawBackLabels(i,s),this.drawCrossHairLabel(t,s)),this._lhsStubContainer.paintStubs(e),this._rhsStubContainer.paintStubs(e)}this.drawCrossHairLabel(t,(0,H.getBindingPixelRatio)(this._topCanvasBinding))}drawBackground(e,t){if((0,H.clearRect)(e,0,0,Math.ceil(this.size.width*t)+1,Math.ceil(this.size.height*t)+1,this.backgroundColor()),!this.chart.hasModel())return;const i=this.chart.model();if(!i.timeScale().isEmpty()){const s=i.model().selection().lineDataSources().reduce(((e,t)=>{const i=t.timeAxisPoints();return 0===i.length?e:e.concat(i)}),[]);s.length>0&&this._hightlightBackground(e,s,t)}const s=i.model().crossHairSource();s.startMeasurePoint()&&this._hightlightBackground(e,s.measurePoints(),t)}drawBorder(e,t){e.save(),e.fillStyle=this.lineColor();const i=Math.max(1,Math.floor(this.rendererOptions().borderSize*t)),s=Math.ceil(this.size.width*t);e.fillRect(0,0,s+1,i),e.restore()}drawTickMarks(e,t){const i=this.chart.model().timeScale().marks();if(!i||0===i.length)return;let s=i.reduce(((e,t)=>e.span>t.span?e:t),i[0]).span;s>30&&s<40&&(s=30),e.save(),
e.strokeStyle=this.lineColor();const r=this.rendererOptions(),n=r.borderSize+r.offsetSize+r.paddingTop+r.fontSize/2;e.textAlign="center",e.textBaseline="middle",e.fillStyle=this.textColor(),(0,H.drawScaled)(e,t,(()=>{e.font=this.baseFont();for(let t=0;t<i.length;t++){const r=i[t];r.span<s&&e.fillText(r.label,r.coord,n)}e.font=this.baseBoldFont();for(let t=0;t<i.length;t++){const r=i[t];r.span>=s&&e.fillText(r.label,r.coord,n)}})),e.restore()}drawBackLabels(e,t){var i;e.save();const s=new Set,r=this.chart.model().model();let n=r.dataSources();const o=r.selection().allSources();for(const e of o)s.add(e);r.hoveredSource()&&s.add(r.hoveredSource());for(const e of r.sourcesBeingMoved())s.add(e);const a=r.customSourceBeingMoved();null!==a&&s.add(a);const l=null!==(i=r.lineBeingEdited())&&void 0!==i?i:r.lineBeingCreated();l&&s.add(l),s.add(this.chart.model().crossHairSource()),n=n.concat(r.customSources());const c=this.rendererOptions();for(let i=0;i<n.length;i++){const r=n[i];if(!s.has(r)&&r.timeAxisViews){const i=r.timeAxisViews();if(i)for(let s=0;s<i.length;s++)i[s].renderer().draw(e,c,t)}}e.restore()}drawCrossHairLabel(e,t){var i;e.save(),e.clearRect(0,0,Math.ceil(this.size.width*t)+1,Math.ceil(this.size.height*t)+1);const s=this.chart.model().model(),r=[],n=null!==(i=s.lineBeingEdited())&&void 0!==i?i:s.lineBeingCreated();if(n&&n.timeAxisViews){const e=n.timeAxisViews();e&&e.length&&r.push(e)}const o=s.customSourceBeingMoved();this._addViewsOrMaxMin(null===o?[]:[o],r),this._addViewsOrMaxMin(s.sourcesBeingMoved(),r),this._addViewsOrMaxMin(s.selection().allSources(),r);const a=s.hoveredSource();if(a&&(0,O.isDataSource)(a)&&!s.selection().isSelected(a)&&a.timeAxisViews){const e=a.timeAxisViews();e&&e.length&&r.push(e)}const l=s.crossHairSource(),c=l.timeAxisViews&&l.timeAxisViews();c&&c.length&&r.push(c);const h=this.rendererOptions();for(const i of r)for(const s of i)e.save(),s.renderer().draw(e,h,t),e.restore();e.restore()}mouseDownEvent(e){this._mouseDownOrTouchStartEvent(e)}touchStartEvent(e){this._mouseOrTouchEnterEvent(e),this._mouseDownOrTouchStartEvent(e)}mouseDownOutsideEvent(){this._outsideMouseDownOrTouchStartEvent()}touchStartOutsideEvent(){this._outsideMouseDownOrTouchStartEvent()}pressedMouseMoveEvent(e){this._pressedMouseOrTouchMoveEvent(e)}touchMoveEvent(e){this._pressedMouseOrTouchMoveEvent(e)}mouseUpEvent(e){this._mouseUpOrTouchEndEvent(e)}touchEndEvent(e){this._mouseUpOrTouchEndEvent(e),this._mouseOrTouchLeaveEvent(e)}contextMenuEvent(e){this._contextMenuOrTouchContextMenuEvent(e)}touchContextMenuEvent(e){this._contextMenuOrTouchContextMenuEvent(e)}mouseEnterEvent(e){this._mouseOrTouchEnterEvent(e)}mouseLeaveEvent(e){this._mouseOrTouchLeaveEvent(e)}mouseDoubleClickEvent(e){this._mouseDoubleClickOrDoubleTapEvent(e)}doubleTapEvent(e){this._mouseDoubleClickOrDoubleTapEvent(e)}_outsideMouseDownOrTouchStartEvent(){this._zoomAvailable()&&this._mousedown&&(this._mousedown=!1,this.chart.model().endScaleTime(),this.restoreDefaultCursor())}_hightlightBackground(e,t,i){const s=this.chart.model().timeScale()
;let r=t[0].index,n=t[0].index;for(let e=1;e<t.length;e++)r=Math.min(r,t[e].index),n=Math.max(n,t[e].index);const o=Math.floor(s.indexToCoordinate(r)*i),a=Math.ceil(s.indexToCoordinate(n)*i);(0,H.fillRect)(e,o,0,a-o,Math.ceil(this.size.height*i)+1,this._properties.childs().axisHighlightColor.value())}_addViewsOrMaxMin(e,t){if(e.length<=1){for(const i of e)if(i.timeAxisViews){const e=i.timeAxisViews();e&&e.length&&t.push(e)}}else t.push(this._minMaxViews(e))}_minMaxViews(e){const t=[];let i=1/0,s=-1/0,r=null,n=null;for(const t of e)if(t.timeAxisViews){const e=t.timeAxisViews();if(e&&e.length)for(let t=0;t<e.length;++t){const o=e[t],a=o.coordinate();a>=s&&(s=a,n=o),a<=i&&(i=a,r=o)}}return n&&t.push(n),r&&t.push(r),t}_zoomAvailable(){return!this.chart.model().timeScale().isEmpty()&&this.chart.model().model().zoomEnabled()&&this._options.pressedMouseMoveScale}_mouseDownOrTouchStartEvent(e){if(this._mousedown||!this._zoomAvailable())return;this._mousedown=!0;const t=this.chart.model();t.timeScale().isEmpty()||t.startScaleTime(e.localX)}_pressedMouseOrTouchMoveEvent(e){this._zoomAvailable()&&this.chart.model().scaleTimeTo(e.localX)}_mouseUpOrTouchEndEvent(e){this._zoomAvailable()&&(this._mousedown=!1,this.chart.model().endScaleTime(),this.restoreDefaultCursor())}_contextMenuOrTouchContextMenuEvent(e){this._options.contextMenuEnabled&&te.ContextMenuManager.showMenu(this.getContextMenuActions(),e,{statName:"TimeScaleContextMenu"},{menuName:"TimeScaleContextMenu"})}_mouseOrTouchEnterEvent(e){this._zoomAvailable()&&this.setCursor("ew-resize")}_mouseOrTouchLeaveEvent(e){this.restoreDefaultCursor()}_mouseDoubleClickOrDoubleTapEvent(e){(0,le.trackEvent)("GUI","Double click time scale"),this.chart.model().resetTimeScale()}_areEventsEnabled(){return!(0,F.hideMarksOnBars)().value()}}function jt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Gt(e){return e.reduce(((e,t)=>{for(const i in t)if(jt(t,i)){const s=t[i],r=e[i];r?r.push(s):e[i]=[s]}return e}),{})}const qt=new E.TranslatedString("move left",n.t(null,void 0,i(415086))),$t=new E.TranslatedString("move right",n.t(null,void 0,i(461711))),Yt={moving:"wait_finishing",wait_finishing:"stop",stop:"moving"};class Kt{constructor(e){this._chartModel=null,this._currentDistance=0,this._deferredFinishTimeout=0,this._finishingTimeout=0,this._moveType="",this._startTime=0,this._state="stop",this._movingTimeout=0,this._chart=e,this._chart.withModel(this,(()=>{this._chartModel=this._chart.model()}))}destroy(){clearTimeout(this._movingTimeout)}move(e){if(null!==this._chartModel&&"stop"===this._state&&this._chartModel.beginUndoMacro(1===e?qt:$t),this._state=Yt.stop,this._moveType="animated",this._deferredFinishTimeout&&(clearTimeout(this._deferredFinishTimeout),this._deferredFinishTimeout=0),this._finishingTimeout&&(clearTimeout(this._finishingTimeout),this._finishingTimeout=0),this._startTime=Date.now(),0===this._movingTimeout){const t=this._startTime,i=10,s=()=>{this.moveStep(t,0,50*e,1e3),this._movingTimeout=setTimeout(s,i)};this._movingTimeout=setTimeout(s,i)}}
moveStep(e,t,i,s){if(null!==this._chartModel&&!this._chartModel.timeScale().isEmpty()){const r=Date.now();r<e&&(e=r);let n=(r-e)/s;(n>1||!isFinite(n))&&(n=1);const o=1-Math.pow(1-n,3);return this._currentDistance=(i-t)*o+t,this._chartModel.scrollChart(this._currentDistance),n}}moveByBar(e){if(null!==this._chartModel){const t=this._chartModel.timeScale();if(t.isEmpty())return;if("stop"===this._state&&this._chartModel.beginUndoMacro(1===e?qt:$t),null!==t.visibleBarsStrictRange()){const e=t.indexToCoordinate(t.visibleBarsStrictRange().lastBar())+t.barSpacing()/2;Math.abs(t.width()-e)>t.barSpacing()/6&&this._chartModel.scrollChart(t.width()-e)}if(this._state=Yt.stop,this._moveType="by_bar",this._startTime=Date.now(),!this._movingTimeout){let t=0,i=150;const s=400,r=()=>{this._moveByBarStep(e),t++,i>100&&(i-=t/5*20),this._movingTimeout=setTimeout(r,i)};this._movingTimeout=setTimeout(r,s),this._moveByBarStep(e)}}}stopMove(){"by_bar"===this._moveType?this.stopMoveByBar():this._stopMove()}stopMoveByBar(){"moving"===this._state&&(clearTimeout(this._movingTimeout),this._movingTimeout=0,this._state=Yt.wait_finishing,this._moveType="",this._movingTimeout=0,this._currentDistance=0,null!==this._chartModel&&this._chartModel.endUndoMacro())}scrollToRealtime(e){null!==this._chartModel&&this._chartModel.timeScale().scrollToRealtime(e)}_finishMove(){clearTimeout(this._movingTimeout),this._movingTimeout=0,this._deferredFinishTimeout=0;const e=this._currentDistance,t=Date.now(),i=()=>{const s=this.moveStep(t,e,0,700);s&&s<1?this._finishingTimeout=setTimeout(i,10):null!==this._chartModel&&(this._state=Yt.wait_finishing,this._moveType="",this._movingTimeout=0,this._currentDistance=0,this._chartModel.endUndoMacro())};this._finishingTimeout=setTimeout(i,10)}_stopMove(){"moving"===this._state&&(this._state=Yt.moving,Date.now()-this._startTime<200?this._deferredFinishTimeout=setTimeout(this._finishMove.bind(this),200-(Date.now()-this._startTime)):this._finishMove())}_moveByBarStep(e){if(null!==this._chartModel){if(this._chartModel.timeScale().isEmpty())return;this._chartModel.scrollChartByBar(e)}}}var Zt=i(220863);const Xt=(0,o.getLogger)("ChartApi.AbstractSession");class Jt extends class{constructor(e,t,i){this._isConnected=new(et())(!1),this._state=0,this._isConnectForbidden=!1,this._sessionId="",this._sessionIdChanged=new(ee()),this._chartApi=e,this._sessionPrefix=t,this._shouldReconnectAfterCriticalError=i}destroy(){this._logNormal("Destroying session"),this._isConnected.unsubscribe(),this.disconnect(),this._sessionIdChanged.destroy(),delete this._chartApi,this._logNormal("Session has been destroyed")}isConnected(){return this._isConnected}sessionId(){return this._sessionId}onSessionIdChanged(){return this._sessionIdChanged}connect(){0===this._state&&((0,r.assert)(!this._isConnectForbidden,"Cannot call connect because it is forbidden at this moment"),this._setSessionId(`${this._sessionPrefix}_${(0,Zt.randomHash)()}`),this._logNormal("Connecting session - wait until transport stay connected"),this._state=1,
this._chartApi.createSession(this._sessionId,this))}disconnect(){0!==this._state&&((0,r.assert)(""!==this._sessionId,"sessionId must not be invalid"),this._logNormal("Disconnecting session..."),this._forbidConnectWhile((()=>{this._chartApi.connected()&&this._sendRemoveSession(),this._processDestroyingOnServer()})))}onMessage(e){switch(e.method){case"connected":return void this._onChartApiConnected();case"disconnected":return void this._onChartApiDisconnected();case"critical_error":const t=String(e.params[0]),i=String(e.params[1]);return void this._onCriticalError(t,i)}this._onMessage(e)}_getChartApi(){return this._chartApi}_generateLogMessage(e){return`[${this._sessionId}] ${e}`}_onCriticalError(e,t){this._logError(`Critical error. Reason=${e}, info=${t}.`),this._forbidConnectWhile((()=>{this._processDestroyingOnServer()})),this._shouldReconnectAfterCriticalError?(this._logNormal("Reconnecting after critical error..."),this.connect()):this._logNormal("Reconnecting after critical error skipped")}_onChartApiConnected(){(0,r.assert)(1===this._state,"Session is not registered"),this._logNormal("Transport is connected. Creating session on the server"),this._sendCreateSession(),this._state=2,this._isConnected.setValue(!0)}_onChartApiDisconnected(){this._logNormal("Transport is disconnected. Reconnecting..."),this._forbidConnectWhile((()=>{this._processDestroyingOnServer()})),this.connect()}_setSessionId(e){const t=this._sessionId;this._logNormal(`Changing sessionId: old=${t}, new=${e}`),this._sessionId=e,this._sessionIdChanged.fire(e,t)}_logNormal(e){Xt.logNormal(this._generateLogMessage(e))}_logError(e){Xt.logError(this._generateLogMessage(e))}_processDestroyingOnServer(){this._state=0,this._isConnected.setValue(!1),this._chartApi.removeSession(this._sessionId),this._setSessionId("")}_forbidConnectWhile(e){this._isConnectForbidden=!0,e(),this._isConnectForbidden=!1}}{constructor(e,t=!1){super(e,"cs",!1),this._sessionDisabled=!1,this._handler=null,this._criticalError=new(ee()),this._symbolResolveMap=new Map,this._disableStatistics=t}destroy(){this._criticalError.destroy(),this._handler=null,this._symbolResolveMap.clear(),super.destroy()}serverTimeOffset(){return this._getChartApi().serverTimeOffset()}switchTimezone(e){return this._getChartApi().switchTimezone(this.sessionId(),e)}defaultResolutions(){return this._getChartApi().defaultResolutions()}availableCurrencies(){return this._getChartApi().availableCurrencies()}availableUnits(){return this._getChartApi().availableUnits()}availablePriceSources(){return this._getChartApi().availablePriceSources()}resolveSymbol(e,t,i){if(this._symbolResolveMap.has(t)){const[e,s]=this._symbolResolveMap.get(t);return Array.isArray(s)?s.push(i):s.then(i),e}{const s=[i];return this._getChartApi().resolveSymbol(this.sessionId(),e,t,(i=>{"symbol_error"===i.method?this._symbolResolveMap.delete(t):this._symbolResolveMap.set(t,[e,Promise.resolve(i)]),s.forEach((e=>e(i)))})),this._symbolResolveMap.set(t,[e,s]),e}}requestFirstBarTime(e,t,i){
return this._getChartApi().requestFirstBarTime(this.sessionId(),e,t,i)}createSeries(e,t,i,s,r,n,o){return this._getChartApi().createSeries(this.sessionId(),e,t,i,s,r,n,o)}modifySeries(e,t,i,s,r,n){return this._getChartApi().modifySeries(this.sessionId(),e,t,i,s,r,n)}removeSeries(e){return!!this.isConnected().value()&&this._getChartApi().removeSeries(this.sessionId(),e)}requestMoreData(e,t,i){return"number"==typeof e?this._getChartApi().requestMoreData(this.sessionId(),e):this._getChartApi().requestMoreData(this.sessionId(),e,t,i)}requestMoreTickmarks(e,t,i){return(0,_.isNumber)(e)?this._getChartApi().requestMoreTickmarks(this.sessionId(),e):this._getChartApi().requestMoreTickmarks(this.sessionId(),e,t,i)}requestMetadata(e,t){this._getChartApi().requestMetadata(this.sessionId(),e,t)}canCreateStudy(e){return this._getChartApi().canCreateStudy(e)}createStudy(e,t,i,s,r,n,o){return this._getChartApi().createStudy(this.sessionId(),e,t,i,s,r,n,o)}rebindStudy(e,t,i,s,r,n,o){return this._getChartApi().rebindStudy(this.sessionId(),e,t,i,s,r,n,o)}modifyStudy(e,t,i,s,r){return this._getChartApi().modifyStudy(this.sessionId(),e,t,i,s,r)}removeStudy(e,t){return this._getChartApi().removeStudy(this.sessionId(),e,t)}createPointset(e,t,i,s,r,n){return this._getChartApi().createPointset(this.sessionId(),e,t,i,s,r,n)}modifyPointset(e,t,i,s){return this._getChartApi().modifyPointset(this.sessionId(),e,t,i,s)}removePointset(e){return this._getChartApi().removePointset(this.sessionId(),e)}setVisibleTimeRange(e,t,i,s,r,n){this._getChartApi().setVisibleTimeRange(this.sessionId(),e,t,i,s,!0,r,n)}criticalError(){return this._criticalError}connect(e=null){null!==e&&(this._handler=e),this._symbolResolveMap.clear(),super.connect()}setHandler(e){this._handler=e}connected(){return this.isConnected().value()&&!this._sessionDisabled}disable(){this._sessionDisabled=!0}chartApi(){return this._getChartApi()}_sendCreateSession(){Object.keys(this).forEach((e=>{/^(s|st|symbol_)\d+$/.test(e)&&delete this[e]})),this._getChartApi().chartCreateSession(this.sessionId(),this._disableStatistics)}_sendRemoveSession(){this._getChartApi().chartDeleteSession(this.sessionId())}_onMessage(e){this._handler&&this._handler(e)}_onCriticalError(e,t){this._criticalError.fire(e,t),super._onCriticalError(e,t)}}var Qt=i(632054),ei=i(382213);class ti{constructor(){this._draggingSource=null,this._activeTouchPanes=new Set,this._scrollingPane=null,this._pinchingPane=null}onPaneDestroyed(e){this._activeTouchPanes.delete(e),this._scrollingPane===e&&(this._scrollingPane=null),this._pinchingPane===e&&(this._pinchingPane=null)}startTouch(e){this._activeTouchPanes.add(e)}endTouch(e){this._activeTouchPanes.delete(e)}hasTouchesOnOtherPanes(e){return this._activeTouchPanes.size>1||1===this._activeTouchPanes.size&&!this._activeTouchPanes.has(e)}trySetDraggingSource(e,t){return!this.hasTouchesOnOtherPanes(t)&&((0,r.assert)(null===this._draggingSource||this._draggingSource===e),this._draggingSource=e,!0)}clearDraggingSource(){null!==this._draggingSource&&(this._draggingSource=null)}
draggingSource(){return this._draggingSource}setScrollingPane(e){(0,r.assert)(null===e||null===this._scrollingPane||this._scrollingPane===e),this._scrollingPane=e}scrollingPane(){return this._scrollingPane}setPinchingPane(e){(0,r.assert)(null===e||null===this._pinchingPane||this._pinchingPane===e),this._pinchingPane=e}pinchingPane(){return this._pinchingPane}}let ii=null;i(538246);function si(e,t,s,r,n){return Promise.all([i.e(842),i.e(6534),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(9602),i.e(1901),i.e(8825),i.e(5761),i.e(1428),i.e(8619),i.e(1685),i.e(4884),i.e(3287),i.e(8707),i.e(8009),i.e(1282),i.e(8271),i.e(3795),i.e(3578),i.e(7177),i.e(2405),i.e(3261),i.e(3562),i.e(149),i.e(9415),i.e(9686),i.e(8955),i.e(8251),i.e(5020),i.e(3046),i.e(1033),i.e(9230),i.e(9519),i.e(962),i.e(37),i.e(1323),i.e(1990),i.e(7125),i.e(1534),i.e(3667),i.e(5150),i.e(9843),i.e(6265)]).then(i.bind(i,566894)).then((i=>{const o=new(0,i.EditObjectDialogRenderer)(e,t,r,n);return o.show(s),o}))}let ri=null;var ni=i(702434);const oi={[ot.TabNames.symbol]:"symbol",[ot.TabNames.legend]:"legend",[ot.TabNames.scales]:"scales",[ot.TabNames.trading]:"trading",[ot.TabNames.events]:"events",[ot.TabNames.timezoneSessions]:"appearance",[ot.TabNames.text]:"text",[ot.TabNames.style]:"style",[ot.TabNames.visibility]:"visibility"},ai={[ot.TabNames.style]:"style",[ot.TabNames.visibility]:"visibilities"};async function li(e,t,s={},r,n){const o=r.activeChartWidget.value(),{initialTab:a,tabName:l}=s;if(l&&!a&&(s.initialTab=ai[l]),(0,C.isStudyLineTool)(e)&&function(e){return[ni.LineToolVbPFixed].some((t=>e instanceof t))}(e))return o.propertiesDefinitionsForSource(e).then((i=>null!==i?si(e,t,s,n,i):null));if((0,T.isStudy)(e)&&function(e){const{shortId:t}=e.metaInfo();return"Overlay"===t}(e)||(0,C.isLineTool)(e))return o.propertiesDefinitionsForSource(e).then((s=>{if(null!==s){return function(e){return Promise.all([i.e(842),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(9602),i.e(1901),i.e(8825),i.e(5761),i.e(1428),i.e(8619),i.e(1685),i.e(4884),i.e(3287),i.e(8707),i.e(8009),i.e(1282),i.e(8271),i.e(3795),i.e(3578),i.e(7177),i.e(2405),i.e(3261),i.e(3562),i.e(149),i.e(9415),i.e(9686),i.e(8955),i.e(8251),i.e(5020),i.e(3046),i.e(9230),i.e(7695),i.e(962),i.e(37),i.e(1323),i.e(1990),i.e(7125),i.e(1534),i.e(3667),i.e(5150),i.e(9843),i.e(6780)]).then(i.bind(i,284145)).then((t=>{const i=new(0,t.SourcePropertiesEditorRenderer)(e);return null!==ri&&ri.hide(),i.show(),ri=i,i}))}({propertyPages:s,model:t,source:e,activePageId:l&&oi[l]})}return null}));if((0,T.isStudy)(e))return si(e,t,s,n);{const e=l&&oi[l],t=r.getChartPropertiesDialogRenderer();return t.setActivePage(e),t.show()}}var ci=i(968381),hi=i(928870),di=i(992223),ui=i(994528);class pi{constructor(e,t){this._showed=!1,this._cw=e,this._element=document.createElement("div"),this._element.classList.add("chart-loading-screen"),this._shield=document.createElement("div"),this._shield.classList.add("chart-loading-screen-shield"),this._element.appendChild(this._shield),
t.appendChild(this._element),this._cw.withModel(this,this._connectToModel)}show(e){if(e){const e=this._cw.model().mainSeries().status();if(1!==e&&2!==e)return}this._cw.setInLoadingState(!0),this._showed||(this._showed=!0,this._show())}hide(){this._cw.setInLoadingState(!1),this._showed&&this._hide()}isShown(){return this._showed}_connectToModel(){const e=this._cw.model().mainSeries().dataEvents();e.symbolError().subscribe(this,(e=>{e!==ui.permissionDenied&&this.hide()})),e.seriesError().subscribe(this,(()=>{(0,Le.enabled)("hide_loading_screen_on_series_error")&&this.hide()})),e.completed().subscribe(this,this.hide)}_show(){const e=this._cw.properties().childs().paneProperties.childs();let t;if(e.backgroundType.value()===di.ColorType.Solid)t=e.background.value();else{t=`linear-gradient(${e.backgroundGradientStartColor.value()},${e.backgroundGradientEndColor.value()})`}this._shield.style.background=t,this._element.classList.add("fade")}_hide(){this._showed=!1,this._element.classList.remove("fade")}}var _i=i(624595),mi=i(224778),gi=i(896778);const fi=(0,A.getHexColorByName)("color-cold-gray-700"),vi=(0,A.getHexColorByName)("color-cold-gray-400");class Si{constructor(e){this._container=null,this._errorCardRenderer=null,this._mainSeriesErrorMessage=null,this._banErrorMessage=null,this._errorMessageHandler=e=>{this._chartWidget.hasModel()?this._updatePaneWidgets(e):this._renderErrorWithoutModel(e)},this._chartWidget=e,this._subscribeToMainSeriesErrors()}destroy(){var e,t,i;null===(e=this._mainSeriesErrorMessage)||void 0===e||e.destroy(),null===(t=this._banErrorMessage)||void 0===t||t.destroy(),null===(i=this._errorCardRenderer)||void 0===i||i.then((e=>{e.container.remove(),e.destroy()}))}updatePaneWidgets(){this._updatePaneWidgets()}setContainer(e){var t;if(this._container!==e){this._container=e,null===(t=this._errorCardRenderer)||void 0===t||t.then((e=>e.container.remove()));const i=this._getErrorMessage();i&&this._errorMessageHandler(i)}}_updatePaneWidgets(e=this._getErrorMessage()){this._chartWidget.paneWidgets().forEach((t=>t.setErrorMessage(e)))}async _renderErrorWithoutModel(e){if(null===this._container||null===e&&null===this._errorCardRenderer)return;const t=await this._getErrorCardRenderer();this._container.contains(t.container)||this._container.appendChild(t.container),t.update(this._createErrorCardRendererState(e))}async _getErrorCardRenderer(){return this._errorCardRenderer||(this._errorCardRenderer=this._createErrorCardRenderer())}async _createErrorCardRenderer(){return new(await ct())}_createErrorCardRendererState(e){return e?{message:e.message,icon:e.icon,textColor:de.watchedTheme.value()===ue.StdTheme.Dark?vi:fi,backgroundColor:de.watchedTheme.value()===ue.StdTheme.Dark?"#131722":"#FFF",solutionId:e.solutionId}:{message:null}}_subscribeToMainSeriesErrors(){const e=this._chartWidget;e.withModel(this,(()=>{const t=e.model().model().mainSeries();this._mainSeriesErrorMessage=(0,m.combine)(((t,s,r)=>{if(t)return t;let o;switch(s){case 4:{const t=e.model().model().mainSeries().seriesErrorMessage()
;null!==t&&("resolution_not_entitled"===t||"custom_resolution"===t||"seconds_not_entitled"===t||t.startsWith("study_not_auth:"))||(o=n.t(null,void 0,i(132619)));break}case 1:case 2:break;default:r&&(o=n.t(null,void 0,i(395222)))}return o?{message:o,icon:"ghost"}:null}),this._banErrorMessage||new(et())(null).readonly(),(0,gi.createWVFromGetterAndSubscription)((()=>t.status()),t.onStatusChanged()),(0,gi.createWVFromGetterAndSubscription)((()=>!t.bars().size()&&!t.isInReplay()),t.dataEvents().dataUpdated()),(0,gi.createWVFromGetterAndSubscription)((()=>({})),e.model().model().onChartThemeLoaded())),this._mainSeriesErrorMessage.subscribe(this._errorMessageHandler,{callWithLast:!0})}))}_getErrorMessage(){var e,t;return(null===(e=this._banErrorMessage)||void 0===e?void 0:e.value())||(null===(t=this._mainSeriesErrorMessage)||void 0===t?void 0:t.value())||null}}var yi=i(939291),bi=i(976704),wi=i.n(bi);async function Pi(e,t,s,o,a="default"){let l,c=[];const h=e.model().model(),d=(0,_.clone)((0,r.ensureDefined)(t.defaults.inputs)),u=new(wi())({inputs:d}),p=function(e,t){return"symbol"===t?e.inputs.filter((t=>t.id===e.symbolInputId())):e.inputs.filter((e=>e.confirm))}(t,a),m=()=>{l&&h.removeCustomSource(l)},g=()=>{m(),o()},f=e=>{s({inputs:e,parentSources:c}),m()},v=p.filter(yi.isTimeOrPriceNotHiddenInput);if(v.length>0)try{const s=await Promise.all([i.e(8087),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(346),i.e(9602),i.e(1901),i.e(8825),i.e(5761),i.e(1428),i.e(8619),i.e(1685),i.e(4884),i.e(3287),i.e(8707),i.e(1282),i.e(8271),i.e(3578),i.e(7177),i.e(2405),i.e(3261),i.e(3562),i.e(149),i.e(9686),i.e(4450),i.e(962),i.e(9255),i.e(37),i.e(7125),i.e(1534),i.e(3667),i.e(5150),i.e(3030)]).then(i.bind(i,759393)),r=await s.selectInputValuesOnChart(e,v,u,t.shortDescription,t.inputs);if(l=r.customSourceId,r.destPane){const e=r.destPane.mainDataSource();c=e===h.mainSeries()?[]:[e]}else c=[]}catch(e){return void g()}v.length!==p.length?Promise.all([i.e(8087),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(346),i.e(9602),i.e(1901),i.e(8825),i.e(5761),i.e(1428),i.e(8619),i.e(1685),i.e(4884),i.e(3287),i.e(8707),i.e(1282),i.e(8271),i.e(3578),i.e(7177),i.e(2405),i.e(3261),i.e(3562),i.e(149),i.e(9686),i.e(4450),i.e(962),i.e(9255),i.e(37),i.e(7125),i.e(1534),i.e(3667),i.e(5150),i.e(3030)]).then(i.bind(i,876207)).then((t=>{const s=new t.ConfirmInputsDialogRenderer(function(e){if("symbol"===e)return n.t(null,void 0,i(345743));return n.t(null,void 0,i(846689))}(a),p,u,a,e.model(),f,g);return s.show(),s})):f(u.state().inputs||{})}var Ci=i(290728),Ti=i(638273);var xi=i(658363);const Ii=(0,Le.enabled)("chart_content_overrides_by_defaults"),Mi=(0,o.getLogger)("ChartWidget",{color:"#606"}),Li=new E.TranslatedString("hide {title}",n.t(null,void 0,i(470301)));const Ai={addToWatchlistEnabled:!0,showFinancialsEnabled:!1,sourceSelectionEnabled:!0,propertyPagesEnabled:!0,paneContextMenuEnabled:!0,priceScaleContextMenuEnabled:!0,currencyConversionEnabled:!1,unitConversionEnabled:!1,goToDateEnabled:!1,marketStatusWidgetEnabled:!0,chartWarningWidgetEnabled:!0,
dataProblemWidgetEnabled:!0,paneControlsEnabled:!0,isSymbolAvailable:e=>Promise.resolve(!0),legendWidgetEnabled:!0,chartEventsEnabled:!0,esdEnabled:!1,newsEnabled:!1,continuousContractSwitchesEnabled:!1,futuresContractExpirationEnabled:!1,croppedTickMarks:!0,countdownEnabled:!0,lastPriceAnimationEnabled:!0,useKineticScroll:c.CheckMobile.any(),indicatorsDialogShortcutEnabled:!0,handleScale:{mouseWheel:!0,pinch:!0,axisPressedMouseMove:{time:!0,price:!0}},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0}};function ki(e,t,i,s=0){const r=t.mainSeries().syncModel(),n=e.mainSeries().syncModel();let o=i;if(null!==r&&null!==n){const t=e.createSyncPoint(r.syncSourceTarget(),n.syncSourceTarget());0!==s&&(i=r.projectTime(i,s)),o=t.sourceTimeToTargetTime(i)}return e.timeScale().points().roughIndex(o,n&&n.distance.bind(n))}const Ei=["Overlay@tv-basicstudies","CorrelationCoefficient@tv-basicstudies","Correlation Coeff@tv-basicstudies","Spread@tv-basicstudies","Ratio@tv-basicstudies"];class Di{constructor(e,t,i){this.activePaneWidget=null,this._model=null,this._paneWidgets=[],this._maximizedPaneWidget=null,this._timeAxisWidget=null,this._paneSeparators=[],this._controlBarNavigation=null,this._lineToolsSynchronizer=null,this._modelCreated=new(ee()),this._isDestroyed=!1,this._customLegendWidgetsFactoryMap=new Map,this._backgroundTopTheme=new(et())("light"),this._backgroundBasedTheme=new(et())("light"),this._backgroundBottomTheme=new(et())("light"),this._lhsAxesWidth=0,this._rhsAxesWidth=0,this._lhsPriceAxisWidthChanged=new(ee()),this._rhsPriceAxisWidthChanged=new(ee()),this._mainDiv=null,this._parent=null,this._elTooltipDiv=null,this._hotkeysListener=null,this._mouseWheelHelper=null,this._onWheelBound=null,this._justActivated=!1,this._inited=!1,this._containsData=!1,this._initialLoading=!1,this._defTimeframe=void 0,this._removeMaximizeHotkey=null,this._metaInfoRepository=null,this._invalidationMask=null,this._drawPlanned=!1,this._drawRafId=0,this._inLoadingState=!1,this._timingsMeter=null,this._tagsChanged=new(ee()),this._redraw=new(ee()),this._isVisible=new(et())(!0),this._collapsed=new(et())(!1),this._dataWindowWidget=null,this._resizeHandler=null,this._spinner=null,this._keydownEventListener=null,this._properties=null,this._updateThemedColorBound=this._updateThemedColor.bind(this),this._disconnected=new(ee()),this._reconnectBailout=new(ee()),this._connected=new(ee()),this._chartWidgetInitialized=new(ee()),this._saveChartService=null,this._objectTreeDialogController=null,this._chartPaintedPromise=null,this._noExchangeSubscrptionWarning=null,this._paneWidgetsSharedState=new ti,this._brokerName="",this._onZoom=new(ee()),this._onScroll=new(ee()),this._availableScreen=null,this._hoveredPriceAxes=new Set,this._anyAxisHovered=new(et())(!1),this._invalidationHandler=e=>{if(!(e instanceof I.InvalidationMask))throw new Error("Invalid mask");null!==this._invalidationMask?this._invalidationMask.merge(e):this._invalidationMask=e,this._drawPlanned||(this._drawPlanned=!0,this._options.visible.when((()=>{
const e=!document.hidden,t=this.screen&&this.screen.isShown();null!==this._timingsMeter&&e&&!t&&this._timingsMeter.startWaitingDraw();const i=(0,r.ensureNotNull)((0,r.ensureNotNull)(this._parent).ownerDocument.defaultView);this._drawRafId=i.requestAnimationFrame(this._invalidationRAFCallback.bind(this))})))},this._onChartSessionIsConnectedChanged=e=>{e?this._onConnection():this._onDisconnect()},this._subscribeToBanInfo=e=>{var t,i;e?null===(t=this._spinner)||void 0===t||t.stop():null===(i=this._spinner)||void 0===i||i.spin()},this._id=t,this._layoutId=i,this._options=(0,_.merge)((0,_.clone)(Ai),e),this._options.customLegendWidgetFactories&&(this._customLegendWidgetsFactoryMap=this._options.customLegendWidgetFactories),this._subscribeToDrawingState(),this._chartWidgetCollection=this._options.chartWidgetCollection,this.withModel(this,(()=>{const e=this.model().model();e.backgroundTopColor().subscribe(this._updateThemedColorBound),e.backgroundColor().subscribe(this._updateThemedColorBound)})),this._errorRenderer=new Si(this),this._scrollHelper=new Kt(this),this._objectTreeDialogController=u.ObjectTreeDialogController.getInstance(),this._properties=new x.DefaultProperty("chartproperties",void 0,void 0,this._options.useUserChartPreferences),this._properties.addExclusion("scalesProperties.axisHighlightColor"),this._properties.addExclusion("scalesProperties.axisLineToolLabelBackgroundColorActive"),this._properties.addExclusion("scalesProperties.axisLineToolLabelBackgroundColorCommon"),this._properties.addExclusion("scalesProperties.showPriceScaleCrosshairLabel"),this._properties.addExclusion("scalesProperties.showTimeScaleCrosshairLabel"),this._properties.addExclusion("scalesProperties.crosshairLabelBgColorLight"),this._properties.addExclusion("scalesProperties.crosshairLabelBgColorDark"),this._startSpinner(this._options.container.value()),this._chartSession=new Jt(window.ChartApiInstance),this._metaInfoRepository=new b(this._chartSession)}destroy(){var e,t;null===(e=this._lineToolsSynchronizer)||void 0===e||e.destroy(),null===(t=this._noExchangeSubscrptionWarning)||void 0===t||t.destroy(),window.loginStateChange.unsubscribe(this,this._handleLoginStateChanged),null!==this._model&&(this._model.model().backgroundTopColor().unsubscribe(this._updateThemedColorBound),this._model.model().backgroundColor().unsubscribe(this._updateThemedColorBound),this._model.destroy()),this._customLegendWidgetsFactoryMap.clear(),this._scrollHelper.destroy(),this._errorRenderer.destroy(),this._chartSession.criticalError().unsubscribe(this,this._onChartSessionCriticalError),this._chartSession.isConnected().unsubscribe(this._onChartSessionIsConnectedChanged),this._chartSession.destroy(),this._isDestroyed=!0}emulateCriticalError(){this._chartSession.removeSeries("-1")}chartSession(){return this._chartSession}onDisconnected(){return this._disconnected}onReconnectBailout(){return this._reconnectBailout}onConnected(){return this._connected}chartWidgetInitialized(){return this._chartWidgetInitialized}setVisibleTimeRange(e,t,i,s){{
const n=this.model().mainSeries().seriesSource();this._chartSession.setVisibleTimeRange((0,r.ensureNotNull)(n.instanceId()),n.turnaround(),e,t,null!=i?i:{},null!=s?s:()=>{})}}lineToolsSynchronizer(){return this._lineToolsSynchronizer}model(){return(0,r.ensureNotNull)(this._model)}id(){return this._id}layoutId(){return this._layoutId}crossHairSyncEnabled(){return this._chartWidgetCollection.lock.crosshair.value()}isVisible(){return this._isVisible.value()}setVisible(e){this._isVisible.setValue(e)}setCollapsed(e){this._collapsed.setValue(e)}isJustClonedChart(){return!!(this._options||{}).justCloned}setSymbol(e){this._model?this._model.setSymbol(this._model.mainSeries(),e):this.properties().childs().mainSeriesProperties.merge({symbol:e})}setResolution(e){this._model?this._model.setResolution(this._model.mainSeries(),e):this.properties().childs().mainSeriesProperties.merge({interval:e})}getResolution(){return this._model?this._model.mainSeries().properties().childs().interval.value():this.properties().childs().mainSeriesProperties.childs().interval.value()}loadRange(e){if(this._model){this.screen.show();this._model.loadRange(e)||this.screen.hide()}}async showGeneralChartProperties(e){if(!Le.enabled("show_chart_property_page"))return Promise.resolve(null);const t=await this._showChartProperties(this.model().mainSeries(),e,{doNotCloseOnBgClick:!0,onResetToDefault:async()=>{this.model().restorePreferences();const e=await Promise.resolve().then(i.bind(i,9316)),t=e.getCurrentTheme().name;e.loadTheme(this.chartWidgetCollection(),{themeName:t,standardTheme:!0})}});if(null===t)return null;const s=()=>{t.hide(),this._chartWidgetCollection.activeChartWidget.unsubscribe(s)};return this._chartWidgetCollection.activeChartWidget.subscribe(s),t}async showChartPropertiesForSources(e){if(!(0,Le.enabled)("property_pages"))return Promise.resolve(null);const{sources:t,title:s,tabName:o,renamable:a}=e,l=(0,r.ensureNotNull)(this._model),c=Gt(t.map((e=>e.properties().childs()))),h=Gt(t.map((e=>e.properties().childs().intervalsVisibilities))),[{createPropertyPage:d},{getSelectionStylePropertiesDefinitions:u},{getSelectionIntervalsVisibilitiesPropertiesDefinition:p},{getSelectionCoordinatesPropertyDefinition:_}]=await Promise.all([Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,82348)),Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,24674)),Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,828493)),Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,210577))]);return async function(e){
const{SourcesPropertiesEditorRenderer:t}=await Promise.all([i.e(842),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(9602),i.e(1901),i.e(8825),i.e(5761),i.e(1428),i.e(8619),i.e(1685),i.e(4884),i.e(3287),i.e(8707),i.e(8009),i.e(1282),i.e(8271),i.e(3795),i.e(3578),i.e(7177),i.e(2405),i.e(3261),i.e(3562),i.e(149),i.e(9415),i.e(9686),i.e(8955),i.e(8251),i.e(5020),i.e(3046),i.e(9230),i.e(7695),i.e(962),i.e(37),i.e(1323),i.e(1990),i.e(7125),i.e(1534),i.e(3667),i.e(5150),i.e(9843),i.e(6780)]).then(i.bind(i,772551)),s=new t(e);return null!==ii&&(ii.hide(),ii=s),s.show(),s}({sources:t,propertyPages:[d(u(c,l),"Style",n.t(null,void 0,i(832733))),d({definitions:[_(t,l)]},"Displacement",n.t(null,void 0,i(962764))),d(p(h,l),"Visibility",n.t(null,void 0,i(221852)))],undoModel:l,title:s,activeTabId:o,renamable:a})}getPriceAxisWidthChangedByName(e){return"left"===e?this._lhsPriceAxisWidthChanged:this._rhsPriceAxisWidthChanged}getPriceAxisMaxWidthByName(e){return"left"===e?this._lhsAxesWidth:this._rhsAxesWidth}timeAxisHeight(){return null!==this._timeAxisWidget?this._timeAxisWidget.size.height:0}withModel(e,t){null!==this._model?t.call(e):this.modelCreated().subscribe(e,t,!0)}hasModel(){return null!==this._model}copyLineToOtherCharts(){const e=(0,r.ensureNotNull)(this._model),t=e.selection().lineDataSources().filter((e=>e.isSynchronizable()));e.copyToOtherCharts(t)}hideDataSources(e){if(e.length){const t=e.map((e=>e.properties().visible)),i=e.map((()=>!1));this.model().setProperties(t,i,Li.format({title:new E.TranslatedString(e[0].name(),e[0].title())}))}}hideSelectedObject(){this.hideDataSources(this.model().selection().dataSources().filter((e=>!0)))}unlinkSelectedLine(){const e=(0,r.ensureNotNull)(this._model),t=e.selection().lineDataSources();e.unlinkLines(t)}onScroll(){return this._onScroll}onZoom(){return this._onZoom}images(e){window.TradingView.printing=!0;const t=this.model().selection().allSources();this.model().selectionMacro((e=>e.clearSelection())),this.model().model().recalculateAllPanes((0,_t.globalChangeEvent)());const i=(t,i)=>{t.paint(i);const s={showCollapsedStudies:Boolean(null==e?void 0:e.showCollapsedStudies),status:null==e?void 0:e.status};return t.getScreenshotData(s)},s=[];if(null!==this._maximizedPaneWidget){const e=this._paneWidgets.indexOf(this._maximizedPaneWidget);s.push(i(this._maximizedPaneWidget,I.InvalidationMask.light().invalidateForPane(e)))}else for(let e=0;e<this._paneWidgets.length;++e){const t=this._paneWidgets[e];s.push(i(t,I.InvalidationMask.light().invalidateForPane(e))),e<this._paneWidgets.length-1&&s.push(this._paneSeparators[e].image())}let r;this._timeAxisWidget&&(this._timeAxisWidget.paint(I.InvalidationLevel.Light),r=this._timeAxisWidget.getScreenshotData()),window.TradingView.printing=!1,this.model().selectionMacro((e=>{t.forEach((t=>{e.addSourceToSelection(t)}))})),this.model().model().recalculateAllPanes((0,_t.globalChangeEvent)()),this.model().model().lightUpdate();const n=this.mainSeriesQuotesAndMetainfo();return{panes:s,timeAxis:r,colors:{
text:this.properties().childs().scalesProperties.childs().textColor.value(),bg:this.properties().childs().paneProperties.childs().background.value(),scales:this.properties().childs().scalesProperties.childs().lineColor.value()},meta:n.meta,ohlc:n.ohlc,quotes:n.quotes}}insertStudy(e,t,i,s){return new Promise((r=>{0!==t.length?window.runOrSignIn((()=>{r(this._insertStudy(e,t,i,s))}),{source:"study on study"}):r(this._insertStudy(e,t,i,s))})).catch((()=>null))}addOverlayStudy(e,t,i){const s=this.model();return this._options&&this._options.isSymbolAvailable?this._options.isSymbolAvailable(e).then((r=>{if(!r)return null;const n=s.createStudyInserter({type:"java",studyId:"Overlay@tv-basicstudies"},[]),o={allowExtendTimeScale:i};if(Le.enabled("use_overrides_for_overlay")){const e=(0,xi.factoryDefaults)("study_Overlay@tv-basicstudies.style");o.style=e}return n.setPropertiesState(o),n.setForceOverlay(t),n.insert((()=>Promise.resolve({inputs:{symbol:e},parentSources:[]})))})):Promise.resolve(null)}addCompareStudy(e){const t=this.model();return this._options&&this._options.isSymbolAvailable?this._options.isSymbolAvailable(e).then((i=>i?t.createStudyInserter({type:"java",studyId:"Compare@tv-basicstudies"},[]).insert((()=>Promise.resolve({inputs:{symbol:e},parentSources:[]}))):null)):Promise.resolve(null)}showIndicators(e,t){if(window.studyMarket)return window.studyMarket.visible().value()?void window.studyMarket.hide():(window.studyMarket.show(e,t),window.studyMarket)}setSaveChartService(e){this._saveChartService=e,null!==this._lineToolsSynchronizer&&this._lineToolsSynchronizer.setSaveChartService(e)}getSaveChartService(){return this._saveChartService}mainSeriesQuotesAndMetainfo(){let e,t,i;const s=this._model&&this._model.mainSeries();if(s){const r=e=>null==e?"":s.formatter().format(e,void 0,void 0,!0,!1)+"",n=e=>null==e?"":e+"";e={resolution:s.interval(),symbol:s.symbol(),values:s.valuesProvider().getValues(null)};const o=s.symbolInfo();o&&(e.symbol=o.full_name,e.description=o.description,e.exchange=o.exchange);const a=s.bars().last();null!==a&&(t=a.value.slice(1,5).map(r));const l=s.quotes();l&&(i={change:r(l.change),changePercent:n(l.change_percent),last:r(l.last_price)})}return{meta:e,ohlc:t,quotes:i}}updateCrossHairPositionIfNeeded(){if(this._model){const e=F.tool.value();this._model.model().setCurrentTool(e);const t=(0,D.lastMouseOrTouchEventInfo)();if(t.isTouch){const e=this._maximizedPaneWidget||this._paneWidgets[0];if(e.hasState()&&(!t.stylus&&(this._isLineToolModeExceptBrush()||(0,F.toolIsMeasure)(F.tool.value()))||this.selectPointMode().value()!==F.SelectPointMode.None)){const t=e.state(),i=.5*this._model.model().timeScale().width(),s=.5*t.defaultPriceScale().height();this._model.model().setAndSaveCurrentPosition(i,s,t)}}if(this._model&&t.isTouch){const e=this._model.model().crossHairSource();e.updateAllViews((0,_t.sourceChangeEvent)(e.id()))}}}trackingModePaneWidget(){if(!(0,D.lastMouseOrTouchEventInfo)().isTouch)return null;for(const e of this.paneWidgets())if(e.trackingModeEnabled())return e;return null}
startTrackingMode(){if((0,D.lastMouseOrTouchEventInfo)().isTouch){this.exitTrackingMode(),this.updateCrossHairPositionIfNeeded();const e=this._maximizedPaneWidget||this._paneWidgets[0],t=this.model().model().crossHairSource().currentPoint();e.startTrackingMode(t,t)}}exitTrackingMode(){(0,D.lastMouseOrTouchEventInfo)().isTouch&&this.paneWidgets().some((e=>e.trackingModeEnabled()))&&(this.paneWidgets().forEach((e=>e.exitTrackingMode())),this.model().model().clearCurrentPosition())}onToolChanged(){this.model().lineBeingCreated()&&this._cancelCreatingLine(),this.selectPointMode().value()!==F.SelectPointMode.None&&this.cancelRequestSelectPoint(),this.exitTrackingMode()}setInLoadingState(e){this._inLoadingState=e}paint(e){const t=null!=e?e:I.InvalidationMask.full();t.validationActions().forEach((e=>e())),this._paneWidgets.forEach(((e,i)=>{null!==this._maximizedPaneWidget&&this._maximizedPaneWidget!==e||e.paint(t.invalidateForPane(i))})),this._timeAxisWidget&&this._timeAxisWidget.paint(t.invalidateForTimeScale()),this._redraw.fire()}GUIResetScales(){(0,le.trackEvent)("GUI","Reset Scales"),null!==this._model&&this._model.resetScales()}toggleMaximizePane(e){var t;if(!(this._paneWidgets.length<2)){this._maximizedPaneWidget?(this._maximizedPaneWidget.state().maximized().setValue(!1),this._maximizedPaneWidget=null,this._paneSeparators.forEach((e=>e.show()))):(this._maximizedPaneWidget=e,this._maximizedPaneWidget.state().maximized().setValue(!0),this._paneSeparators.forEach((e=>e.hide())));for(let e=this._paneWidgets.length;e--;)this._paneWidgets[e].updateControls(),this._paneWidgets[e].updatePriceAxisWidgets();this._errorRenderer.updatePaneWidgets(),null===(t=this._timeAxisWidget)||void 0===t||t.updatePriceAxisStubs(),this._adjustSize(),this.updateCrossHairPositionIfNeeded()}}maximizedPaneWidget(){return this._maximizedPaneWidget}isMaximizedPane(){return null!==this._maximizedPaneWidget}toggleCollapsedPane(e){const t=e.state();t.collapsed().setValue(!t.collapsed().value()),this._paneWidgets.forEach((e=>e.updateControls())),this._adjustSize(),this.updateCrossHairPositionIfNeeded()}unsetActivePaneWidget(){this.activePaneWidget=null}setActivePaneWidget(e){this.activePaneWidget=e}onPaneWidgetDestroyed(e){this.activePaneWidget===e&&(this.activePaneWidget=null)}backgroundTopTheme(){return this._backgroundTopTheme.readonly()}backgroundBasedTheme(){return this._backgroundBasedTheme.readonly()}backgroundBottomTheme(){return this._backgroundBottomTheme.readonly()}lineToolsAndGroupsDTO(){return(0,r.ensureNotNull)(this._lineToolsSynchronizer).prepareDTO()}resetLineToolsInvalidated(e,t,i){(0,r.ensureNotNull)(this._lineToolsSynchronizer).resetInvalidated(e,t,i)}applyLineToolUpdateNotification(e,t){(0,r.ensureNotNull)(this._lineToolsSynchronizer).applyLineToolUpdateNotification(e,t)}reloadAllLineTools(){(0,r.ensureNotNull)(this._lineToolsSynchronizer).reloadAllLineTools()}startApplyingLineToolUpdateNotification(){var e;null===(e=this._lineToolsSynchronizer)||void 0===e||e.startApplyingLineToolUpdateNotification()}
endApplyingLineToolUpdateNotification(){var e;null===(e=this._lineToolsSynchronizer)||void 0===e||e.endApplyingLineToolUpdateNotification()}applyAlertIdByExternalSource(e,t){var i;null===(i=this._lineToolsSynchronizer)||void 0===i||i.applyAlertIdByExternalSource(e,t)}deleteAlertByExternalSource(e,t){var i;null===(i=this._lineToolsSynchronizer)||void 0===i||i.deleteAlertByExternalSource(e)}shouldBeSavedEvenIfHidden(){return this._model?this.model().model().shouldBeSavedEvenIfHidden():!!this._options.content.shouldBeSavedEvenIfHidden}showObjectsTreeDialog(){var e;null===(e=this._objectTreeDialogController)||void 0===e||e.show()}addCustomWidgetToLegend(e,t){this._customLegendWidgetsFactoryMap.set(e,t);for(const i of this.paneWidgets())i.addCustomWidgetToLegend(e,t)}applyIndicatorsToAllChartsAvailable(){if(!this.chartWidgetCollection().applyIndicatorsToAllChartsAvailable())return!1;for(const e of this.model().model().panes()){if(e.sourcesByGroup().all().some((e=>(0,T.isStudy)(e)&&!0)))return!0}return!1}restoreState(e,t,i){this._adjustSize();(0,r.ensureNotNull)(this._model).restoreState(this._content,t,i);this._setActions()}addCompareAsOverlay(e,t,i){const s=this.model();return(0,r.ensureDefined)(this._options.isSymbolAvailable)(e).then((r=>{if(!r)return null;const n=s.createStudyInserter({type:"java",studyId:"Overlay@tv-basicstudies"},[]);return n.setForceOverlay(!0),n.setPreferredPriceScale("as-series"),!0!==i&&n.setTargetPriceScaleMode({percentage:!0}),void 0!==t&&n.setPropertiesState({allowExtendTimeScale:t}),n.insert((async()=>({inputs:{symbol:e},parentSources:[]})))}))}scrollHelper(){return this._scrollHelper}setBroker(e){var t;this._brokerName=e,null===(t=this._lineToolsSynchronizer)||void 0===t||t.setBroker(e)}chartPainted(){return this._drawPlanned?(null===this._chartPaintedPromise&&(this._chartPaintedPromise=(0,h.createDeferredPromise)()),this._chartPaintedPromise.promise):Promise.resolve()}setDataWindowWidget(e){this._dataWindowWidget=e}removeDataWindowWidget(){this._dataWindowWidget=null}showSelectedSourcesProperties(e){const t=(0,r.ensureNotNull)(this._model).selection().dataSources();if(1===t.length)this.showSourceProperties(t[0],e);else{const i=t.filter(C.isLineTool);i.length>0&&this.showChartPropertiesForSources({sources:i,tabName:e})}}connect(){this._chartSession.isConnected().subscribe(this._onChartSessionIsConnectedChanged),this._chartSession.criticalError().subscribe(this,this._onChartSessionCriticalError),this._chartSession.connect(this._onData.bind(this))}finishInitWithoutConnect(){this._chartSession.disable(),this._init(),this._chartWidgetInitialized.fire()}reconnect(){this._chartSession.disconnect(),this._chartSession.connect()}update(){if(this.hasModel()){for(const e of this._paneWidgets)e.update();this._timeAxisWidget&&this._timeAxisWidget.update()}}setPriceAxisHovered(e,t){t?this._hoveredPriceAxes.add(e):this._hoveredPriceAxes.delete(e),this._anyAxisHovered.setValue(this._hoveredPriceAxes.size>0)}anyPriceAxisHovered(){return this._anyAxisHovered.readonly()}_insertStudy(e,t,i,s){const n=(0,
r.ensureNotNull)(this._model).createStudyInserter(e,t,i);n.setForceOverlay("java"===e.type&&"Volume@tv-basicstudies"===e.studyId&&Le.enabled("volume_force_overlay"));const o=n.insert(((e,i,r)=>new Promise(((n,o)=>{var a;this.selectPointMode().value()!==F.SelectPointMode.None&&this.cancelRequestSelectPoint(),s?n(s(e,i,r)):!function(e){return Ei.includes(e.id)}(r)?(null!=(a=i)?a:[]).some((e=>e.confirm))?((0,le.trackEvent)("GUI","Confirmation dialogs","Inputs confirmation dialog"),Pi(this,r,n,o)):n({inputs:{},parentSources:t}):((0,le.trackEvent)("GUI","Confirmation dialogs","Symbol confirmation dialog"),Pi(this,r,n,o,"symbol"))}))));return o.then((()=>{(0,F.hideAllIndicators)().value()&&(0,k.toggleHideMode)()})).catch((e=>{})),o}async _showChartProperties(e,t,i,s){if(!this._model)return null;t&&((0,l.setValue)("properties_dialog.active_tab.chart",t),i.tabName=t);const r=await li(e,this._model,i,this._options.chartWidgetCollection,s);return(null==r?void 0:r.visible().value())?r:null}_createLineToolsSynchronizerIfNeeded(){0}_updateThemedColor(){const e=this.model().model(),t=e.backgroundColorAtYPercentFromTop(.5);let i=e.backgroundTopColor().value(),s=e.backgroundColor().value();const r=(0,he.isColorDark)(t),n=(0,he.isColorDark)(i),o=(0,he.isColorDark)(s);this.widget().classList.toggle("chart-widget--themed-dark",r),this.widget().classList.toggle("chart-widget--themed-light",!r),this.widget().classList.toggle("chart-widget__top--themed-dark",n),this.widget().classList.toggle("chart-widget__top--themed-light",!n),this.widget().classList.toggle("chart-widget__bottom--themed-dark",o),this.widget().classList.toggle("chart-widget__bottom--themed-light",!o),this._backgroundTopTheme.setValue(n?"dark":"light"),this._backgroundBasedTheme.setValue(r?"dark":"light"),this._backgroundBottomTheme.setValue(o?"dark":"light"),i===s&&(0,G.isStdThemedDefaultValue)("chartProperties.paneProperties.background",i,this._backgroundBasedTheme.value())&&(i=null,s=null);for(const e of this._paneWidgets)e.updateThemedColors({topColor:i,bottomColor:s})}_isLineToolModeExceptBrush(){const e=F.tool.value();return(0,C.isLineToolName)(e)&&!(0,C.isLineDrawnWithPressedButton)(e)&&this.selectPointMode().value()===F.SelectPointMode.None}_cancelCreatingLine(){const e=(0,r.ensureNotNull)(this._model).model(),t=e.lineBeingCreated();if(null!==t){const i=(0,r.ensureNotNull)(e.paneForSource(t));(0,r.ensureNotNull)(this.paneByState(i)).cancelCreatingLineTool(),t.toolname===F.tool.value()&&(0,F.resetToCursor)()}const i=e.crossHairSource().measurePane().value();if(null!==i){(0,r.ensureNotNull)(this.paneByState(i)).cancelMeasuring()}}_adjustSize(e){var t;let i=0;const r=null===this._model?null:this._model.model().priceScaleSlotsCount(),n=new Uint32Array(null===r?0:r.left),o=new Uint32Array(null===r?0:r.right),a=(0,H.getCanvasDevicePixelRatio)(document.body),l=(e,t)=>e+t,c=(e,t)=>{t.forEach(((t,i)=>{e[i]=Math.max(e[i],t)}))
},h=this._width(),u=this._height(),p=this._paneSeparators.length,_=this.isMaximizedPane()?0:Nt.height()*p,m=null!==this._timeAxisWidget?this._timeAxisWidget.optimalHeight():0;let g=u-m>=61?m:0;g%2&&(g+=1);const f=Math.max(1,Math.floor((u-_-g)/this._paneWidgets.length));let v=0,S=null;for(const e of this._paneWidgets)if(!this._maximizedPaneWidget||this._maximizedPaneWidget===e){e.leftPriceAxisesContainer().updateCurrencyLabels();const t=e.leftPriceAxisesContainer().optimalWidths();e.rightPriceAxisesContainer().updateCurrencyLabels();const s=e.rightPriceAxisesContainer().optimalWidths();c(n,t),c(o,s),this._maximizedPaneWidget!==e&&e.state().collapsed().value()?v+=Math.min(f,e.collapsedHeight()):(i+=e.stretchFactor(),S=e)}let y=n.reduce(l,0),b=o.reduce(l,0),w=Math.max(h-y-b,0);if(w<=102){y=0,b=0,w=h;for(let e=0;e<n.length;e++)n[e]=0;for(let e=0;e<o.length;e++)o[e]=0}for(const e of this._paneSeparators)e.adjustSize();const P=_+v+g,C=u<P?0:u-P,T=C/i;let x=0,I=!1;const M=null===(t=this._model)||void 0===t?void 0:t.model();for(let e=0;e<this._paneWidgets.length;++e){const t=this._paneWidgets[e];void 0!==M&&t.setState(M.panes()[e]);let i=0;if(this.isMaximizedPane())i=this._maximizedPaneWidget===t?C:0;else if(t.state().collapsed().value())i=Math.min(f,t.collapsedHeight());else{const e=t===S?Math.ceil((C-x)*a)/a:Math.round(t.stretchFactor()*T*a)/a;i=Math.max(e,2),x+=i}t.setPriceAxisSizes("left",i,n),t.setPriceAxisSizes("right",i,o),I=I||i!==t.height(),t.setSize((0,s.size)({width:w,height:i})),M&&t.state()&&M.setPaneHeight(t.state(),i)}null!==this._timeAxisWidget&&this._timeAxisWidget.setSizes((0,s.size)({width:w,height:g}),n,o),M&&M.setWidth(w,e),this._controlBarNavigation&&this._controlBarNavigation.updatePosition(),this._lhsAxesWidth!==y&&(this._lhsAxesWidth=y,this._lhsPriceAxisWidthChanged.fire(y)),this._rhsAxesWidth!==b&&(this._rhsAxesWidth=b,this._rhsPriceAxisWidthChanged.fire(b)),I&&d.emit("panes_height_changed")}_makePaneWidgetsAndSeparators(){const e=this.model().model().panes(),t=e.length,i=this._paneWidgets.length;for(let e=t;e<i;e++){(0,r.ensureDefined)(this._paneWidgets.pop()).destroy();const e=this._paneSeparators.pop();e&&e.destroy()}const s=this._options.containsData;for(let r=i;r<t;r++){const t={contextMenuEnabled:this._options.paneContextMenuEnabled,currencyConversionEnabled:this._options.currencyConversionEnabled,unitConversionEnabled:this._options.unitConversionEnabled,handleScale:this._options.handleScale,handleScroll:this._options.handleScroll,priceScaleContextMenuEnabled:this._options.priceScaleContextMenuEnabled,legendWidgetEnabled:this._options.legendWidgetEnabled,sourceStatusesWidgetEnabled:!s,sourceStatusesWidget:this._options.sourceStatusesWidget,marketStatusWidgetEnabled:this._options.marketStatusWidgetEnabled&&!s,chartWarningWidgetEnabled:this._options.chartWarningWidgetEnabled&&!s,chartWarningWidget:this._options.chartWarningWidget,dataProblemWidgetEnabled:this._options.dataProblemWidgetEnabled&&!s,legendWidget:this._options.legendWidget,propertyPagesEnabled:this._options.propertyPagesEnabled,
sourceSelectionEnabled:this._options.sourceSelectionEnabled,controlsEnabled:this._options.paneControlsEnabled,croppedTickMarks:this._options.croppedTickMarks,countdownEnabled:this._options.countdownEnabled,customLegendWidgetFactories:new Map(this._customLegendWidgetsFactoryMap),useKineticScroll:this._options.useKineticScroll};void 0!==this._options.paneContextMenu&&(t.contextMenu=this._options.paneContextMenu),void 0!==this._options.priceScaleContextMenu&&(t.priceScaleContextMenu=this._options.priceScaleContextMenu);const i=new Vt(this,e[r],t,this._paneWidgetsSharedState);if(this._paneWidgets.push(i),r>0){const e=new Nt(this,r-1,r);this._paneSeparators.push(e),this._timeAxisWidget?this._elMainTable.insertBefore(e.getElement(),this._timeAxisWidget.getElement()):this._elMainTable.appendChild(e.getElement())}this._timeAxisWidget?this._elMainTable.insertBefore(i.getElement(),this._timeAxisWidget.getElement()):this._elMainTable.appendChild(i.getElement())}for(let i=0;i<t;i++){const t=e[i],s=this._paneWidgets[i];s.hasState()&&s.state()===t?s.updatePriceAxisWidgets():s.setState(t)}for(let e=t;e--;)this._paneWidgets[e].updateControls();this._errorRenderer.updatePaneWidgets(),this._updateThemedColor()}_width(){return this._options.width.value()}_height(){return this._options.height.value()}_update(e,t){var i;const s=e?e.fullInvalidation():I.InvalidationLevel.Full,r=!!e&&e.isVisibleTimeRangeLockedOnResize();if(null!==this._timingsMeter&&this._timingsMeter.startDraw(s),s===I.InvalidationLevel.Full&&(this._model?this._updateGui(r):this._adjustSize(r)),s>I.InvalidationLevel.Cursor&&(null===(i=this._timeAxisWidget)||void 0===i||i.update(),this._applyTimeScaleInvalidations(e,t)),this.paint(e),this._dataWindowWidget){const t=e.maxPaneInvalidation();t===I.InvalidationLevel.Full?this._dataWindowWidget.fullUpdate():t>I.InvalidationLevel.None&&this._dataWindowWidget.update()}for(let t=0;t<this._paneWidgets.length;t++)this._paneWidgets[t].updateStatusWidget(e.invalidateForPane(t));null!==this._timingsMeter&&this._timingsMeter.stopDraw(),e&&e.panesOrderInvalidated()&&d.emit("panes_order_changed")}_onMousewheel(e){if(!this.model().model().zoomEnabled()||null===this._mouseWheelHelper)return;if(!(0,c.onWidget)()&&parent&&parent!==window&&parent.IS_DEMO_PAGE)return;if(null===this._model)return;if(this.model().timeScale().isEmpty())return;const t=this._mouseWheelHelper.processWheel(e),i=t.deltaX,s=-t.deltaY;if(0!==i&&this._options.handleScroll.mouseWheel||0!==s&&this._options.handleScale.mouseWheel){if(e.cancelable&&e.preventDefault(),0!==s&&this._options.handleScale.mouseWheel){const t=Math.sign(s)*Math.min(1,Math.abs(s)),i=(0,r.ensureNotNull)(this._mainDiv).getBoundingClientRect(),n=e.clientX-this._lhsAxesWidth-i.left;if(!Number.isFinite(n)||!Number.isFinite(t))return void Mi.logWarn("Incorrect mouse wheel processing: scrollPosition: "+n+", zoomScale: "+t);const o=new N.EnvironmentState(e).mod();this.model().model().zoomTime(n,t,!!o||void 0),this._onZoom.fire(o)}0!==i&&this._options.handleScroll.mouseWheel&&this.model().scrollChart(-80*i)}}
_updateGui(e){this._model&&(this._makeTimeAxisWidget(),this._makePaneWidgetsAndSeparators(),this._elMainTable.style.userSelect="none",this._adjustSize(e))}_setElement(e){if(this._mainDiv){this._mainDiv.remove();const e=document.createRange();e.selectNodeContents((0,r.ensureNotNull)(this._parent)),e.deleteContents()}this._controlBarNavigation&&(this._controlBarNavigation.destroy(),this._controlBarNavigation=null),null!==this._removeMaximizeHotkey&&this._removeMaximizeHotkey(),this._removeMaximizeHotkey=this._initMaximizeHotkey(e);const t=e.ownerDocument,i=t.createElement("div");i.classList.add("chart-container-border"),e.insertBefore(i,e.firstChild),this._parent=i;const s=t.createElement("div");if(s.classList.add("chart-widget"),this._mainDiv=s,this._elTooltipDiv=t.createElement("div"),this._elTooltipDiv.className="tooltip-wrapper",this._mainDiv.appendChild(this._elTooltipDiv),this._elMainTable=t.createElement("table"),this._elMainTable.className="chart-markup-table",this._elMainTable.setAttribute("cellpading","0"),this._elMainTable.setAttribute("cellspacing","0"),this._mainDiv.appendChild(this._elMainTable),this._hotkeysListener&&this._hotkeysListener.destroy(),this._errorRenderer.setContainer(this._parent),this._hotkeysListener=new dt.ChartHotkeysListener(this,this._mainDiv),(this._options.controlBarEnabled||(0,Le.enabled)("control_bar"))&&this._createControlBar(),this._options.handleScale.mouseWheel||this._options.handleScroll.mouseWheel){this._mouseWheelHelper=new Te;const e=this._onMousewheel.bind(this);this._onWheelBound=e,this._mainDiv.addEventListener("wheel",e,{passive:!1})}this.resize(),this._justActivated=!1,this.withModel(this,(()=>{i.appendChild(s),s.addEventListener("mousedown",this._beginRequestActive.bind(this)),s.addEventListener("mouseup",this._endRequestActive.bind(this)),s.addEventListener("touchstart",this._beginRequestActive.bind(this)),s.addEventListener("touchmove",this._endRequestActive.bind(this)),s.addEventListener("touchend",this._endRequestActive.bind(this)),s.addEventListener("click",this._requestActive.bind(this))})),this._inited&&(null!==this._timeAxisWidget&&(this._timeAxisWidget.destroy(),this._timeAxisWidget=null),this._paneWidgets.forEach((e=>{e.destroy()})),this._paneWidgets.length=0,this._paneSeparators.forEach((e=>{e.destroy()})),this._paneSeparators.length=0,this._update(I.InvalidationMask.full(),performance.now()))}_init(){this.hasModel()&&this.model().mainSeries().clearData(),this._initColors(),this._makeDefaultGui();this._makeDefaultModel(),(()=>{this._checkObsoleteTimezone(),this._chartSession&&this._chartSession.connected()&&this.model().model().restart(),this._content&&(this._initColors(),this._updateGui(),this.update()),this._resizeHandler=()=>{this._invalidationHandler(I.InvalidationMask.full())},this._resizeHandler(),(0,r.ensureNotNull)(this._parent).appendChild((0,r.ensureNotNull)(this._mainDiv)),this._spinner&&(this._spinner.stop(),this._spinner=null),this._keydownEventListener=e=>{27===e.which&&e.preventDefault()},
window.addEventListener("keydown:chart_"+this._id,this._keydownEventListener),this._activateSymbolSearchHotkeys(),this.model().timeScale().onScroll().subscribe(this,(()=>this._onScroll.fire())),this._inited=!0})()}_makeDefaultModel(){let e;if(this._content&&this._content.timeScale.points){const t=this._content.timeScale.points.items[0];e={startDate:t}}if(!(0,r.ensureNotNull)(this._metaInfoRepository).getInternalMetaInfoArray())throw new Error("Cannot create chart model: studies metainfo is absent");const t=()=>{var t,i;const s={readOnly:this.readOnly(),isSnapshot:!!this._containsData,...a(this._options,["timeScale","crossHair","chartEventsEnabled","esdEnabled","newsEnabled","continuousContractSwitchesEnabled","futuresContractExpirationEnabled","countdownEnabled","lastPriceAnimationEnabled","currencyConversionEnabled","unitConversionEnabled","watermarkEnabled","shiftVisibleRangeOnNewBar","hideIdeas","onWidget"])};let n;n=this._collapsed;const o=function(e,t,i,s,r,n,o,a,l,c,h){const d=new g.ChartUndoModel(e,t,i,s,r,n,o,a,l,c,h);return d.model().fullUpdate(),d}(this._chartSession,this._invalidationHandler,this.properties(),e,(0,r.ensureNotNull)(this._metaInfoRepository),this,this._options.undoHistory,this._options.barsMarksContainersFactory,s,n,null!==(i=null===(t=this._saveChartService)||void 0===t?void 0:t.autoSaveEnabled())&&void 0!==i?i:new(et())(!0));return this._createSessions(o.model()),o};(0,Le.enabled)("lean_chart_load")?this._model=this._model||t():this._model=t(),this._model.model().setChartSaveTime(1e3*this._chartWidgetCollection.metaInfo.lastModified.value()),this._createVolumeIfNeeded();if(this._content){let e={};Ii&&this._initialLoading&&(e={symbol:this._defSymbol,interval:this._defInterval,style:this._defStyle}),this.restoreState(this._content,this._containsData,e),Ii&&this._defSymbol&&this.model().model().recalculatePriceRangeOnce()}else this._setActions();this._createLineToolsSynchronizerIfNeeded(),(()=>{const e=(0,r.ensureNotNull)(this._model);e.onTagsChanged().subscribe(this,(()=>this.onModelTagsChanged())),this._initBackgroundColor(),this._updateGui(),this._modelCreated.fire(e),this._tagsChanged.fire(),Le.enabled("determine_first_data_request_size_using_visible_range")&&this._setFirstRequestNumbarsUsingTimeframeAndInterval(e);const t=e.mainSeries(),i=t.properties().childs();this._defTimeframe&&t.setDefaultTimeframe(this._defTimeframe),t.dataEvents().symbolNotPermitted().subscribe(null,(e=>t.setSymbolParams({symbol:e}))),i.style.unsubscribe(this,this._onChartStyleChanged),i.style.subscribe(this,this._onChartStyleChanged),t.dataEvents().completed().subscribe(this,(()=>this._addPerfMark("SeriesCompleted")),!0),t.dataEvents().barReceived().subscribe(this,(()=>this._addPerfMark("SeriesFirstDataReceived")),!0);this._options;t.dataEvents().chartTypeNotPermitted().subscribe(null,(()=>{t.setSymbolParams({interval:"D"})})),t.dataEvents().intradaySpreadNotPermitted().subscribe(null,(()=>{t.setSymbolParams({interval:"D"})})),t.dataEvents().customIntervalNotPermitted().subscribe(null,(i=>{
const s=e.model().defaultResolutions(),r=s.find((e=>(0,ei.compareResolutions)(e,i)>=0)),n=null!=r?r:s[s.length-1];t.setSymbolParams({interval:n})})),t.dataEvents().intradayExchangeNotPermitted().subscribe(null,(()=>{t.setSymbolParams({interval:"D"})})),t.requestingStyleIsNotSupported.subscribe(null,(()=>{const i=t.interval(),s=e.model().defaultResolutions(),r=(0,Qt.getLastUsedSingleValueBasedStyle)(),n=(0,ei.getResolutionByChartStyle)(r,i,s);t.setChartStyleWithIntervalIfNeeded(r,n)})),t.requestingStyleSupportRecovered.subscribe(null,(i=>{const s=t.interval(),r=e.model().defaultResolutions(),n=(0,ei.getResolutionByChartStyle)(i,s,r);t.setChartStyleWithIntervalIfNeeded(i,n)}))})()}_startSpinner(e){this._spinner||e&&(this._spinner=(new p.Spinner).spin(e))}_handleLoginStateChanged(){0}_checkObsoleteTimezone(){const e=this.properties().childs().timezone.value();(0,ci.timezoneIsAvailable)(e)||this.properties().childs().timezone.setValue({UTC:"Etc/UTC",EST:"America/New_York",CST:"America/Chicago",PST:"America/Los_Angeles"}[e]||"exchange")}_initColors(){const e=this.properties().childs(),t=e.scalesProperties.childs();t.lineColor.listeners().subscribe(this,this._updateAndPaint),t.textColor.listeners().subscribe(this,this._updateAndPaint),e.paneProperties.childs().separatorColor.listeners().subscribe(this,this._setPaneSeparatorLineColor)}_setPaneSeparatorLineColor(){this._paneSeparators.forEach((e=>e.update())),this._updateAndPaint()}_updateAndPaint(){this.update(),this.paint()}_makeDefaultGui(){this._makeLoadingScreen(),this.hasModel()&&(this._makeTimeAxisWidget(),this._makePaneWidgetsAndSeparators()),this._adjustSize(),this._updateScalesActions(),(0,H.disableSelection)(this._elMainTable),this.update(),this.paint()}_makeLoadingScreen(){if(Le.enabled("lean_chart_load")){if(this.screen)return;this.screen=new pi(this,(0,r.ensureNotNull)(this._parent))}else this.screen=new pi(this,(0,r.ensureNotNull)(this._mainDiv))}_makeAvailableOnTVPopup(){throw new Error("Not implemented")}_activateSymbolSearchHotkeys(){this.readOnly()||this._options.hideSymbolSearch||(0,hi.activateKeyPressHandler)()}_makeTimeAxisWidget(){if(this._timeAxisWidget)return void this._timeAxisWidget.updatePriceAxisStubs();const e=this.model();this._timeAxisWidget=new Ut(this,this._options.timeScaleWidget,this._titlesProvider.bind(this),this._menuItemsProvider.bind(this),this._backgroundBasedTheme),this._elMainTable.appendChild(this._timeAxisWidget.getElement()),this._timeAxisWidget.updatePriceAxisStubs(),this._timeAxisWidget.onLabelHovered().subscribe(this,((t,i)=>{const s=this._maximizedPaneWidget?this._maximizedPaneWidget.state():e.paneForSource(e.mainSeries()),n=(0,r.ensureNotNull)(this.paneByState((0,r.ensureNotNull)(s))).highlightedPriceAxis(),o=n.value();(i||o.owner===t.owner)&&(n.setValue({owner:t.owner,axis:i?t.axis:null}),this.model().model().lightUpdate())}))}_titlesProvider(e,t){const i=this.model(),s=(0,
r.ensureNotNull)(this._maximizedPaneWidget?this._maximizedPaneWidget.state():i.paneForSource(i.mainSeries())),n="right"===e?s.rightPriceScales():s.leftPriceScales();if(n.length<t+1)return[];let o=n[t].orderedSources().filter((e=>e===i.mainSeries()||(0,T.isStudy)(e)));return o.reverse(),o=(0,_i.moveToHead)(o,i.mainSeries()),o.map((e=>e.title(!0,void 0,!1)))}_menuItemsProvider(e,t){const i=this.model(),s=(0,r.ensureNotNull)(this._maximizedPaneWidget?this._maximizedPaneWidget.state():i.paneForSource(i.mainSeries())),n="right"===e?s.visibleRightPriceScales():s.visibleLeftPriceScales();if(n.length<t+1)return[];const o=n[t],a=i.model().panes().indexOf(s),l=this._paneWidgets[a],c="right"===e?l.rightPriceAxisesContainer():l.leftPriceAxisesContainer();return(0,r.ensureNotNull)(c.findAxisWidgetForScale(o)).getContextMenuActions()}_invalidationRAFCallback(e){if(this._drawPlanned=!1,this._drawRafId=0,!this._inLoadingState){if(this._invalidationMask){const t=this._invalidationMask;this._update(this._invalidationMask,e),this._invalidationMask=null;for(const i of t.timeScaleInvalidations())if(0===i.type&&!i.value.finished(e)){this.model().model().setTimeScaleAnimation(i.value);break}}null!==this._chartPaintedPromise&&(this._chartPaintedPromise.resolve(),this._chartPaintedPromise=null)}}_applyTimeScaleInvalidations(e,t){for(const i of e.timeScaleInvalidations())this._applyTimeScaleInvalidation(i,t)}_applyTimeScaleInvalidation(e,t){var i;const s=null===(i=this._model)||void 0===i?void 0:i.timeScale();if(s&&0===e.type)e.value.finished(t)||s.setRightOffset(e.value.getPosition(t))}_onChartSessionCriticalError(e,t){this._disconnected.fire(!0)}_onData(e){if("reconnect_bailout"===e.method)this._reconnectBailout.fire();else this.model().model().onData(e)}_onConnection(){this.hasModel()?(this.model().model().restart(),this.model().model().fullUpdate(),this._connected.fire()):this._requestMetadata()}_onDisconnect(){this.hasModel()&&this.model().model().disconnect(),this._model&&this._model.model().fullUpdate(),this._disconnected.fire()}_requestMetadata(){this._addPerfMark("RequestMetadataStart");const e=(0,r.ensureNotNull)(this._metaInfoRepository);e.requestMetaInfo().then((()=>{this._addPerfMark("RequestMetadataEnd"),this._inited?this.model().model().setStudiesMetaData(e.getInternalMetaInfoArray(),e.getMigrations()):(this._init(),this._chartWidgetInitialized.fire(),Le.enabled("charting_library_base")||Mi.logDebug("initialized"))}))}async _createControlBar(){const e=await Promise.all([i.e(7257),i.e(2301),i.e(2670),i.e(9255),i.e(5093)]).then(i.bind(i,570025));this._controlBarNavigation=new e.ControlBarNavigation(this,(0,r.ensureNotNull)(this._mainDiv),this._options.controlBar),this._model&&this._adjustSize()}_subscribeToDrawingState(){if(this._options.readOnly)return;(0,F.init)();const e=(e,t)=>{const i=this._model;if(null===i)return;const s=i.model();e.model!==s&&(this._lineToolsSynchronizer?this._lineToolsSynchronizer.executeSyncedAction((()=>t(s,i))):t(s,i))};F.createdLineTool.subscribe(null,(t=>{e(t,((e,i)=>{const s=(0,
r.ensureNotNull)(e.paneForSource(e.mainSeries()));let n,o=null;if(void 0===t.pointPositionPercents){if(o=ki(e,t.model,t.point.timeStamp),null===o)return;n=t.point.price}else{const i=t.pointPositionPercents.x*e.timeScale().width(),s=e.mainSeries().priceScale(),r=t.pointPositionPercents.y*s.height(),a=e.mainSeries().firstValue();if(null===a)return;o=e.timeScale().coordinateToIndex(i),n=s.coordinateToPrice(r,a)}const a={index:(0,r.ensureNotNull)(o),price:n},l=i.createLineTool({pane:s,point:a,linetool:t.linetool,properties:t.properties,linkKey:t.linkKey,ownerSource:e.mainSeries(),disableSynchronization:!0,id:t.id});null!==l&&!Boolean(this.model().lineBeingCreated())&&t.finalState&&l.restoreExternalPoints(t.finalState,{indexesChanged:!0,pricesChanged:!0})}))})),F.continuedLineTool.subscribe(null,(t=>{e(t,((e,i)=>{var s;const r=ki(e,t.model,t.point.timeStamp);if(null===r)return;const n={index:r,price:t.point.price},o=e.lineBeingCreated();if(null===o)return;i.continueExternalLine(n,null!==(s=t.envState)&&void 0!==s?s:void 0,!!t.finalState)&&t.finalState&&o.restoreExternalPoints(t.finalState,{indexesChanged:!0,pricesChanged:!0})}))})),F.cancelledLineTool.subscribe(null,(t=>{e(t,((e,t)=>{e.cancelCreatingLine()}))})),F.beenSetLineToolLastPoint.subscribe(null,(t=>{e(t,((e,i)=>{const s=e.lineBeingCreated();if(null===s||s.linkKey().value()!==t.linkKey)return;const r=ki(e,t.model,t.point.timeStamp);if(null===r)return;const n={index:r,price:t.point.price};s.setLastPoint(n),s.updateAllViews((0,_t.sourceChangeEvent)(s.id())),e.lightUpdate()}))})),F.startedMovingLineTool.subscribe(null,(t=>{e(t,((e,i)=>{var s;const r=t.linkKeys.map(C.lineToolByLinkKey.bind(null,e)).filter(_.notNull);if(r.length){const i=ki(e,t.model,t.point.timeStamp);if(null===i)return;const n={index:i,price:t.point.price},o=null!==(s=t.activeItem)&&void 0!==s?s:null,a=r[0].pointToScreenPoint(n);a&&e.startMovingSources(r,{logical:n,screen:a},o,t.pointPositionPercents,null===t.envState?void 0:t.envState,!0)}}))})),F.movedLineTool.subscribe(null,(t=>{e(t,((e,i)=>{var s;const r=e.sourcesBeingMoved().filter(C.isLineTool).filter((e=>(e=>t.linkKeys.some((t=>e.linkKey().value()===t)))(e)));if(!r.length)return;const n=ki(e,t.model,t.point.timeStamp);if(null===n)return;const o={index:n,price:t.point.price},a=r[0].pointToScreenPoint(o);a&&e.moveSources({logical:o,screen:a},t.pointPositionPercents,null!==(s=t.envState)&&void 0!==s?s:void 0,!0)}))})),F.finishedMovingLineTool.subscribe(null,(t=>{e(t,((e,i)=>{const s=e.sourcesBeingMoved().filter(C.isLineTool);if(0===s.length)return;s.forEach((i=>{const s=(e=>{for(let i=0;i<t.linkKeys.length;i++)if(t.linkKeys[i]===e.linkKey().value())return{state:t.finalStates[i],changes:t.changes[i]};return null})(i);e.endMovingSources(null!==s,!0),null!==s&&(i.restoreExternalPoints(s.state,s.changes),s.state.pointPositionPercents&&i.restorePositionPercents(s.state.pointPositionPercents))}))}))})),F.startedChangingLineTool.subscribe(null,(t=>{e(t,((e,i)=>{var s;const r=(0,C.lineToolByLinkKey)(e,t.linkKey);if(null!==r){
const i=r.getPoint(t.pointIndex),n=i?i.index:ki(e,t.model,t.point.timeStamp);if(null===n)return;if(r.isActualSymbol()&&r.isActualCurrency()&&r.isActualUnit()){const i={index:n,price:t.point.price};e.startChangingLinetool(r,i,t.pointIndex,null!==(s=t.envState)&&void 0!==s?s:void 0,!0)}}}))})),F.changedLineTool.subscribe(null,(t=>{e(t,((e,i)=>{const s=e.lineBeingEdited();if(null===s||s.linkKey().value()!==t.linkKey)return;let n=null;if(n=t.changes.indexesChanged?ki(e,t.model,t.point.timeStamp):(0,r.ensureNotNull)(e.linePointBeingChanged()).index,null!==n&&s.isActualSymbol()&&s.isActualCurrency()&&s.isActualUnit()){const i={index:n,price:t.point.price};e.changeLinePoint(i,void 0,!0)}}))})),F.finishedChangingLineTool.subscribe(null,(t=>{e(t,((e,i)=>{const s=(0,C.lineToolByLinkKey)(e,t.linkKey);null!==s&&s.isActualSymbol()&&s.isActualCurrency()&&s.isActualUnit()&&null!==e.lineBeingEdited()&&e.endChangingLinetool(!!t.finalState,!0),null!==s&&t.finalState&&s.restoreExternalPoints(t.finalState,t.changes)}))})),F.removedLineTool.subscribe(null,(t=>{e(t,((e,i)=>{const{withUndo:s,unlink:r,linkKey:n}=t,o=(0,C.lineToolByLinkKey)(e,n);if(null!==o)r&&o.detachAlert(),s?i.removeSource(o,!1):e.removeSource(o);else if(this._lineToolsSynchronizer){const{sourceTitle:e,symbol:o,lineToolState:a}=t;i.removeUnloadedLineTool({lineToolsSynchronizer:this._lineToolsSynchronizer,state:a,unlink:r,sourceTitle:e,linkKey:n,symbol:o,withUndo:s})}}))})),F.finishedLineTool.subscribe(null,(t=>{e(t,((e,i)=>{const s=(0,C.lineToolByLinkKey)(e,t.linkKey);null!==s&&(0,nt.isLineToolFinishRequiredWhenCreatedByApi)(s.toolname)&&s.finish()}))})),F.changedLineStyle.subscribe(null,(t=>{e(t,((e,i)=>{const s=(0,C.lineToolByLinkKey)(e,t.linkKey);null!==s&&(s.restoreExternalState(t.state),s.propertiesChanged(!0),t.alertId&&s.syncAlert(t.alertId))}))})),F.restoredLineToolState.subscribe(null,(t=>{e(t,((e,i)=>{const s=(0,C.lineToolByLinkKey)(e,t.linkKey);if(null!==s){const i={...t.state};i.indexes=t.state.points.map((i=>({index:ki(e,t.model,i.time_t),price:i.price}))),e.restoreLineToolState(s,i,!1)}}))})),F.restoredLineTool.subscribe(null,(t=>{e(t,((e,i)=>{e.restoreSource(t.state.restorePane,t.state.paneIndex,t.state.paneState,t.state.sourceState,null)}))})),F.copiedLineTool.subscribe(null,(t=>{e(t,((e,i)=>{const s=(0,r.ensureNotNull)(e.paneForSource(e.mainSeries()));let n;const o={...t.state,intervalsVisibilities:(0,mi.mergeIntervalVisibilitiesDefaults)(t.state.intervalsVisibilities)},a=(0,C.createLineToolProperties)(t.linetool,o,e),l=e.dataSourceForId(t.id);if(l){if(!(0,C.isLineTool)(l))return void Mi.logError(`Error sync creating line tool. Object with id ${t.id} is already in use and it is not a line tool`);if(l.toolname!==t.linetool)return void Mi.logError(`Error sync creating line tool. Object with id ${t.id} is already in use and its type differs: ${l.toolname} and ${t.linetool}`)}if(l&&(l.linkKey().setValue(t.linkKey),l.share(t.sharingMode)),t.pointPositionPercents){const e={index:0,price:0};if(n=null!=l?l:i.createLineTool({pane:s,point:e,linetool:t.linetool,
properties:a,linkKey:t.linkKey,disableSynchronization:!0,id:t.id}),null===n)return;n.restorePositionPercents((0,r.ensureDefined)(t.pointPositionPercents))}else{const o=t.points.map((i=>({index:(0,r.ensureNotNull)(ki(e,t.model,i.timeStamp)),price:i.price}))),c=o[0];if(n=null!=l?l:i.createLineTool({pane:s,point:c,linetool:t.linetool,properties:a,linkKey:t.linkKey,sharingMode:t.sharingMode,disableSynchronization:!0,id:t.id}),null===n)return;if(e.lineBeingCreated())for(let e=1;e<o.length;e++)e===o.length-1&&(0,nt.isLineToolFinishRequiredWhenCreatedByApi)(t.linetool)&&n.finish(),i.continueCreatingLine(o[e],new N.EnvironmentState(void 0,!0),e<o.length-1,!0)}n.properties().interval.setValue(t.state.interval),n.restoreExternalState(t.state),n.restoreData&&n.restoreData(t),n.propertiesChanged(!0),t.finalState&&(n.calcIsActualSymbol(),n.restoreExternalPoints(t.finalState,{pricesChanged:!0,indexesChanged:!0},!0)),t.alertId&&n.syncAlert(t.alertId)}))}))}_setFirstRequestNumbarsUsingTimeframeAndInterval(e){const t=function(e){var t,i,s,r,n,o,a,l,c,h,d,u,p;const _=null!==(t=e.numberExtraBars)&&void 0!==t?t:0,m=e.barSpacing||6,g=Math.ceil(e.width/m)+_;if(e.timeFrame){if(!e.interval)return{barCount:g};const t=Ti.Interval.parse(e.interval);if("string"==typeof e.timeFrame){if("ALL"===e.timeFrame)return{barCount:g};let l=e.timeFrame;"YTD"===e.timeFrame&&(l=`${Math.floor(((new Date).valueOf()-new Date((new Date).getFullYear(),0,0).valueOf())/1e3/60/60/24)}D`);const c=Ti.Interval.parse(l),h=Date.now().valueOf(),d=h-c.inMilliseconds();return{barCount:(0,Ci.getPeriodsBetweenDates)(null!==(s=null===(i=e.symbolInfo)||void 0===i?void 0:i.session)&&void 0!==s?s:"24x7",null!==(n=null===(r=e.symbolInfo)||void 0===r?void 0:r.session_holidays)&&void 0!==n?n:"",null!==(a=null===(o=e.symbolInfo)||void 0===o?void 0:o.corrections)&&void 0!==a?a:"",t.letter(),t.multiplier(),d,h)+_,message:`based on period of ${l}`,shouldAdjustBarSpacing:!0}}if("time-range"===e.timeFrame.type)return{barCount:(0,Ci.getPeriodsBetweenDates)(null!==(c=null===(l=e.symbolInfo)||void 0===l?void 0:l.session)&&void 0!==c?c:"24x7",null!==(d=null===(h=e.symbolInfo)||void 0===h?void 0:h.session_holidays)&&void 0!==d?d:"",null!==(p=null===(u=e.symbolInfo)||void 0===u?void 0:u.corrections)&&void 0!==p?p:"",t.letter(),t.multiplier(),1e3*e.timeFrame.from,1e3*e.timeFrame.to)+_,message:`based on time range: ${e.timeFrame.from} ... ${e.timeFrame.to}`,shouldAdjustBarSpacing:!0}}return{barCount:g}}({width:e.timeScale().width(),barSpacing:e.timeScale().barSpacing(),timeFrame:this.options().defTimeframe,interval:this.options().defInterval});if(Le.enabled("charting_library_debug_mode")&&console.log(`Setting initial data request count to ${t.barCount} bars${t.message?` (${t.message})`:""}`),e.mainSeries().seriesSource().setInitialRequestOptions({count:t.barCount}),t.shouldAdjustBarSpacing&&"number"==typeof t.barCount&&t.barCount>0){const i=Math.ceil(e.timeScale().width()/t.barCount);e.timeScale().setBarSpacing(i)}}}},876364:(e,t,i)=>{"use strict";i.r(t),i.d(t,{allInitialModelsCreated:()=>ni,
allInitialSymbolsResolved:()=>ri,applyIndicatorToAllChartsImpl:()=>ft,applyIndicatorsToAllChartsImpl:()=>gt,applyLineToolUpdateNotificationImpl:()=>Tt,applyThemeImpl:()=>li,chartsSymbolsImpl:()=>Lt,checkProFeatureImpl:()=>oi,computeContentBoxImpl:()=>Ft,copyScreenshotToClipboard:()=>Bt,createBroadcastChannel:()=>ti,createChartStorageSubscriptionsIfRequired:()=>At,createClipboardHandler:()=>It,createLeftBottomChartWidgetWV:()=>Rt,deserializedChartIds:()=>Pt,destroyBroadcastChannel:()=>ii,downloadScreenshot:()=>Dt,generateNewChartId:()=>qt,getAsyncStateForChartImpl:()=>bt,getClientSnapshot:()=>Ot,getSnapshot:()=>Nt,getStateForChartImpl:()=>yt,getVisuallyAdjacentDefImpl:()=>jt,handleConnectionLimitReachedChanged:()=>fi,handleDateRangeLockChange:()=>_i,handleDeviceConnectionClosed:()=>vi,handleInternalDateRangeLockChange:()=>pi,handleInternalIntervalLockChange:()=>di,handleInternalSymbolLockChange:()=>ci,handleInternalTrackTimeLockChange:()=>mi,handleIntervalLockChange:()=>ui,handleSymbolLockChange:()=>hi,handleTrackTimeLockChange:()=>gi,hideChartImpl:()=>Zt,isFirstChartInLayout:()=>wt,lineToolsAndGroupsDTOsImpl:()=>St,removeChartWidgetSubscriptionsImpl:()=>Xt,resetLineToolsInvalidatedImpl:()=>Ct,setBrokerImpl:()=>Mt,setChartLayoutWithUndoImpl:()=>ai,setLayoutImpl:()=>Jt,syncCrosshairImpl:()=>ei,syncScrollImpl:()=>si,takeScreenshot:()=>kt,takeServerScreenshot:()=>Et,updateLayoutImpl:()=>Ut,updateLayoutPartialImpl:()=>Ht});var s=i(650151),r=i(86441),n=i(817808),o=i(509806),a=i(440097),l=i(601227),c=i(484727);function h(e){const t={};return{promise:new Promise(((i,s)=>{e.subscribe(t,i,!0)})),destroy:()=>{e.unsubscribeAll(t)}}}var d=i(705681),u=i(144070);class p extends u.UndoCommand{constructor(e,t){super(null),this._chartModel=e,this._targetIndex=t}redo(){const e=this._chartModel.createPane(this._targetIndex,void 0,this._paneId);this._paneId=e.id()}undo(){const e=(0,s.ensureDefined)(this._paneId),t=this._chartModel.panes().find((t=>t.id()===e));void 0!==t&&this._chartModel.removePane(t)}createdPaneId(){return this._paneId}}class _ extends u.UndoCommand{constructor(e,t,i,s){super(s),this._setter=e,this._oldValue=t,this._newValue=i}redo(){this._setter(this._newValue)}undo(){this._setter(this._oldValue)}}class m extends _{constructor(e,t,i,s){super((e=>this._vwState.setValue(e)),t,i,s),this._vwState=e}}var g=i(652945),f=i(37246),v=i(976052);const S=(0,n.getLogger)("Clipboard");class y{constructor(e){this._e=e}write(e){return(0,f.writeImpl)(this._toRaw(e),this._e)}_toRaw(e){const t={files:[]};t.text=e.text,void 0!==e.app?t.html=this._serializeAppData(e.app,e.text):e.html&&(t.html=e.html);for(const i of e.files||[])t.files.push(i);return t}_serializeAppData(e,t){return`<meta charset="utf-8"><span data-tradingview-clip="${(0,g.htmlEscape)(e)}">${t?(0,g.htmlEscape)(t.slice(0,256)):"&#128200;"}</span>`}}class b{constructor(e){this._e=e}async read(){this._e&&0===this._e.eventPhase&&(S.logWarn("Cannot use an already dispatched ClipboardEvent for reading"),this._e=null)
;const e=this._e?this._readUsingEvent(this._e):await this._readUsingApi();return this._fromRaw(e)}_readUsingEvent(e){const t=(0,s.ensure)(e.clipboardData);e.preventDefault();const i={files:[]};for(let e=0;e<t.files.length;e++)i.files.push(t.files[e]);for(let e=0;e<t.items.length;e++){const s=t.items[e];"string"===s.kind&&("text/plain"===s.type?i.text=t.getData(s.type):"text/html"===s.type?i.html=t.getData(s.type):i.files.push(new Blob([t.getData(s.type)],{type:s.type})))}return i}async _readUsingApi(){const e=(0,v.getClipboard)();if(!e||!e.read)throw new DOMException("ClipboardApi is not supported","NotSupportedError");let t,i;const s=[],r=await e.read();for(const e of r)for(const r of e.types)"text/html"===r?t=e.getType(r).then(this._readBlobAsText):"text/plain"===r?i=e.getType(r).then(this._readBlobAsText):s.push(e.getType(r));return{text:await i,html:await t,files:await Promise.all(s)}}_fromRaw(e){const t={};if(void 0!==e.text&&(t.text=e.text),void 0!==e.html){const i=this._parseAppData(e.html);i?t.app=i:t.html=e.html}return e.files.length>0&&(t.files=e.files),t}_parseAppData(e){if(-1===e.slice(0,1024).indexOf("data-tradingview-clip"))return;const t=(new DOMParser).parseFromString(e,"text/html").querySelector("[data-tradingview-clip]");return t?t.getAttribute("data-tradingview-clip")||"":void 0}_readBlobAsText(e){return new Promise(((t,i)=>{const s=new FileReader;s.onloadend=()=>{t(s.result)},s.onerror=()=>{i(s.error)},s.readAsText(e)}))}}var w=i(698043);function P(e){const t=e.target;return null!==t&&1===t.nodeType&&(0,w.isTextEditingField)(t)}function C(e){const t=e.target;if(null===t)return!1;const i=(t.ownerDocument||t).getSelection();return null!==i&&!i.isCollapsed}class T extends class{constructor(e){this._callbacks=Object.assign({},e),this._boundOnCopy=this._onCopyEv.bind(this),this._boundOnCut=this._onCutEv.bind(this),this._boundOnPaste=this._onPasteEv.bind(this)}listen(){document.addEventListener("copy",this._boundOnCopy),document.addEventListener("cut",this._boundOnCut),document.addEventListener("paste",this._boundOnPaste)}async peek(){if("granted"!==(await navigator.permissions.query({name:"clipboard-read"})).state)throw new Error("clipboard-read is not granted");return new b(null).read()}uiRequestCopy(e){this._callbacks.copyRequested&&this._callbacks.copyRequested(new y(null),e)}uiRequestCut(e){this._callbacks.cutRequested&&this._callbacks.cutRequested(new y(null),e)}uiRequestPaste(e){this._callbacks.pasteRequested&&this._callbacks.pasteRequested(new b(null),e)}destroy(){document.removeEventListener("copy",this._boundOnCopy),document.removeEventListener("cut",this._boundOnCut),document.removeEventListener("paste",this._boundOnPaste)}_onCopyEv(e){e.defaultPrevented||this._callbacks.copyRequested&&this._callbacks.copyRequested(new y(e))}_onCutEv(e){e.defaultPrevented||this._callbacks.cutRequested&&this._callbacks.cutRequested(new y(e))}_onPasteEv(e){e.defaultPrevented||this._callbacks.pasteRequested&&this._callbacks.pasteRequested(new b(e))}}{_onCopyEv(e){if(!P(e)&&!C(e))return super._onCopyEv(e)}
_onCutEv(e){if(!P(e)&&!C(e))return super._onCutEv(e)}_onPasteEv(e){if(!P(e))return super._onPasteEv(e)}}const x=()=>i.e(4389).then(i.bind(i,718609));function I(e,t={}){return x().then((i=>i.copyToClipboardImageOfChart(e,t)))}function M(e,t={}){return x().then((i=>i.getImageOfChartSilently(e,t)))}var L=i(180185),A=i(863697),k=i(210596),E=i.n(k),D=i(559410),B=i(69111),V=i(9316),R=i(497612),N=i(327714),O=i(724377),F=i(651049),W=i(624595),z=i(289763),H=i(574570),U=i(779292),j=i(110123),G=i(776351);const q=!c.enabled("widget_logo");function $(e,t=null,i=null){let s={};if("number"==typeof e)return{relativePositions:{[e]:{l:t,t:i}},nextElementLeft:e,nextElementTop:e};const[r,...n]=e;if("v"===r){let e=null;for(const r of n){const n=$(r,t,i);s={...s,...n.relativePositions},i=n.nextElementTop,e=n.nextElementLeft}t=e}if("h"===r){let e=null;for(const r of n){const n=$(r,t,i);s={...s,...n.relativePositions},t=n.nextElementLeft,e=n.nextElementTop}i=e}return{relativePositions:s,nextElementTop:i,nextElementLeft:t}}const Y=function(e){const t={};for(const i of Object.keys(e)){const s=$(e[i]).relativePositions;t[i]=s}return t}(j);function K(e,t,i,s){let r=Math.round(10*s),n=Math.round(10*s);const o=i[e];if(null!==o.l){const e=K(o.l,t,i,s);r=e.x+e.width+Math.round(5*s)}if(null!==o.t){const e=K(o.t,t,i,s);n=e.y+e.height+Math.round(5*s)}const a=t[e];return{x:r,y:n,width:a.width,height:a.height}}function Z(e,t,i){var s;const r=(new DOMParser).parseFromString(G,"image/svg+xml");null===(s=null==r?void 0:r.firstElementChild)||void 0===s||s.setAttribute("color",i);const n=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(r)],{type:"image/svg+xml"}));return new Promise((i=>{const s=new Image;s.width=e,s.height=t,s.onload=()=>{i({image:s,width:e,height:t})},s.src=n}))}function X(e,t,i,s,r){e.save(),e.drawImage(s.image,t,i,s.width,s.height),e.textBaseline="bottom";const n=(t+s.width)/r+3,o=(i+s.height)/r;(0,z.drawScaled)(e,r,(()=>{e.fillText("TradingView",n,o)})),e.restore()}function J(e,t,i,s){return(0,z.drawScaled)(e,s,(()=>{e.fillText(i,t.x/s,t.y/s)})),e.measureText(i).width*s}function Q(e,t,i,s,n,o){const a=n.map((e=>e.text)).join("");let l=i.x;const c=function(e,t,i,s){if(e.measureText(t).width*s<=i)return{text:t,elided:!1};const r=e.measureText("...").width*s,n=[];for(let e=0;e<t.length;++e)n.push(e);const o=(0,W.upperbound)(n,i,((n,o)=>e.measureText(t.slice(0,o+1)).width*s+r>i));return{text:(t=t.slice(0,o)).trim(),elided:!0}}(e,a,s-l,t);if(c.elided&&!o)return null;const h=[];let d=0;for(const e of n){if(d+e.text.length>c.text.length)break;h.push(e.text),d+=e.text.length}const u=h.join("").trim().length;d=0;for(const s of n){if(d+s.text.length>u)break;s.color&&(e.save(),e.fillStyle=s.color),l+=J(e,new r.Point(l,i.y),s.text,t),s.color&&e.restore(),d+=s.text.length}return c.elided&&(l+=J(e,new r.Point(l,i.y),"...",t)),l}function ee(e){return e.map((e=>({...e,title:""})))}function te(e,t){const i=[{text:e.trim()}];for(const e of t)e.visible&&(""!==i[i.length-1].text&&i.push({text:"  "}),e.title&&i.push({text:e.title}),
i.push({text:e.value,color:e.color}));return i}class ie{constructor(e,t){this._logoTextColor=null,this._snapshotData=e,t=t||{},this._options={backgroundColor:V.themes[e.theme].getThemedColor("color-bg-primary"),borderColor:V.themes[e.theme].getThemedColor("color-border"),font:H.CHART_FONT_FAMILY,fontSize:12,legendMode:"vertical",hideResolution:!1,showHeaderPublishedBy:!1,showHeaderMainSymbol:!1,...t};const i=Y[e.layout],s=e.charts.map((e=>function(e){const t=e.panes[0],i=t.canvas.width+t.leftAxis.canvas.width+t.rightAxis.canvas.width;let s=0;for(const t of e.panes)s+=t.canvas.height;return void 0!==e.timeAxis&&0!==e.timeAxis.contentHeight&&(s+=e.timeAxis.canvas.height),(0,N.size)({width:i,height:s})}(e)));if(this._pixelRatio=e.hidpiRatio,this._chartsGeometry=e.charts.map(((e,t)=>K(t,s,i,this._pixelRatio))),!q){let i=e.theme;void 0!==t.backgroundColor&&(i="black"===(0,O.rgbToBlackWhiteString)((0,O.parseRgb)(t.backgroundColor),150)?F.StdTheme.Dark:F.StdTheme.Light),this._logoTextColor=V.themes[i].getThemedColor("color-text-primary")}this._headerDefaultTextColor=V.themes[e.theme].getThemedColor("color-text-primary")}async getImage(){const e=this._pixelRatio;let t=0,i=0,s=0;const n=this._headerItems();if(n.length>0){s=Math.ceil(1.4*this._options.fontSize*e)*n.length}i+=s;let o=0,a=0;for(const e of this._chartsGeometry)o=Math.max(o,e.x+e.width),a=Math.max(a,e.y+e.height);const l=i;t+=o,i+=a,t+=Math.round(10*e);const c=q?Math.round(10*e):Math.round(35*e),h=i;i+=c;const d=(0,z.createDisconnectedCanvas)(document,(0,N.size)({width:t,height:i}),1),u=(0,z.getContext2D)(d);u.font=(0,U.makeFont)(this._options.fontSize,this._options.font),u.textBaseline="top",u.fillStyle=this._options.backgroundColor,u.fillRect(0,0,t,i),n.length>0&&this._drawHeader(u,n,t,new r.Point(Math.round(10*e),Math.round(10*e)));for(let e=0;e<this._snapshotData.charts.length;++e){const t=this._snapshotData.charts[e],i=this._chartsGeometry[e];this._drawChart(t,i,u,new r.Point(0,l))}if(null!==this._logoTextColor){const t=await Z(Math.round(20*e),Math.round(15*e),this._logoTextColor);u.fillStyle=this._logoTextColor,u.font=(0,U.makeFont)(13,H.CHART_FONT_FAMILY);const i=h+Math.round(c/2-t.height/2);X(u,Math.round(10*e),i,t,e)}return d}_drawChart(e,t,i,s){i.save(),i.translate(t.x+s.x,t.y+s.y);let n=0;for(const t of e.panes){let s=0;const o=t.leftAxis.canvas.width+Math.round(8*this._pixelRatio),a=n,l=n+Math.round(10*this._pixelRatio);t.leftAxis.contentWidth>0&&t.leftAxis.contentHeight>0&&(i.drawImage(t.leftAxis.canvas,s,n),s+=t.leftAxis.canvas.width),i.drawImage(t.canvas,s,n),s+=t.canvas.width,t.rightAxis.contentWidth>0&&t.rightAxis.contentHeight>0&&i.drawImage(t.rightAxis.canvas,s,n),"pane"===t.type&&(i.fillStyle=e.colors.text,this._drawLegend(t,i,new r.Point(o,l),a)),n+=t.canvas.height}if(void 0!==e.timeAxis&&0!==e.timeAxis.contentHeight){let t=0;e.timeAxis.lhsStub.contentWidth>0&&e.timeAxis.lhsStub.contentHeight>0&&(i.drawImage(e.timeAxis.lhsStub.canvas,t,n),t+=e.timeAxis.lhsStub.canvas.width),i.drawImage(e.timeAxis.canvas,t,n),t+=e.timeAxis.canvas.width,
e.timeAxis.rhsStub.contentWidth>0&&e.timeAxis.rhsStub.contentHeight>0&&i.drawImage(e.timeAxis.rhsStub.canvas,t,n)}i.strokeStyle=this._options.borderColor,i.strokeRect(0,0,t.width,t.height),i.restore()}_headerItems(){var e,t,i,s;const r=[];if(this._options.showHeaderPublishedBy&&this._snapshotData.publishedBy)for(const e of this._snapshotData.publishedBy)r.push([{text:e}]);if(this._options.showHeaderMainSymbol){const n=this._snapshotData.charts[0],o=`${null===(e=n.meta)||void 0===e?void 0:e.symbol}, ${null===(t=n.meta)||void 0===t?void 0:t.resolution}`;r.push(te(o,null!==(s=null===(i=n.meta)||void 0===i?void 0:i.values)&&void 0!==s?s:[]))}return r}_drawHeader(e,t,i,s){e.save(),e.fillStyle=this._headerDefaultTextColor;const n=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);t.forEach(((t,o)=>{Q(e,this._pixelRatio,new r.Point(s.x,s.y+n*o),i,t,!0)})),e.restore()}_drawLegend(e,t,i,n){let o=!0;const a=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);let l=i.x,c=i.y;if(e.mainSeriesText&&c+a<n+e.canvas.height){const i=Q(t,this._pixelRatio,new r.Point(l,c),e.contentWidth*this._pixelRatio,te(e.mainSeriesText,e.mainSeriesValues),!0);"horizontal"!==this._options.legendMode?c+=a:(l=(0,s.ensureNotNull)(i)+1.4*this._options.fontSize*this._pixelRatio,o=!1)}for(let s=0;s<e.studies.length;++s)if(c+a<n+e.canvas.height){const n=e.studies[s],h=e.studiesValues[s];let d=null;for(;null===d;)d=Q(t,this._pixelRatio,new r.Point(l,c),e.contentWidth*this._pixelRatio,te(n,ee(h)),o),"horizontal"!==this._options.legendMode?c+=a:null===d?(o=!0,l=i.x,c+=a):(l=d+1.4*this._options.fontSize*this._pixelRatio,o=!1)}}}var se=i(220863),re=i(852752),ne=i(495999),oe=i(425218),ae=i(872580),le=i(685023),ce=i(568822);const he=new a.TranslatedString("change chart layout to {title}",o.t(null,void 0,i(130501)));class de extends u.UndoCommand{constructor(e,t){super(he.format({title:R.layouts[t].title})),this._chartWidgetCollection=e,this._newLayoutType=t,this._oldLayoutType=e.layout.value()}redo(){this._chartWidgetCollection.setLayout(this._newLayoutType)}undo(){this._chartWidgetCollection.setLayout(this._oldLayoutType)}}var ue=i(486028),pe=i(358076),_e=i(676507),me=i(385824),ge=i(256776),fe=i(418562),ve=i(934026),Se=i(284269),ye=i(664114),be=i(918922);class we{constructor(e,t,i){this._data=e,this._hittest=t,this._textWidthCache=i}draw(e,t){const i=t.pixelRatio,s=this._data.centerPoint,n=Math.round(s.x*i),o=Math.round(s.y*i),a=Math.max(1,Math.floor(i))%2/2,l=new r.Point(n+a,o-a);this._drawLollipop(e,l,t),this._drawLabel(e,l,t.pixelRatio)}hitTest(e,t){const i=(0,be.interactionTolerance)().esd,s=this._data.centerPoint.y-this._data.style.lollipop.height/2-i,n=this._data.centerPoint.x-this._data.style.lollipop.width/2-i,o=(0,r.box)(new r.Point(n,s),new r.Point(n+this._data.style.lollipop.width+2*i,s+this._data.style.lollipop.height+2*i));return(0,ve.pointInBox)(e,o)?this._hittest:null}_drawLollipop(e,t,i){const s=this._data.style,r=i.pixelRatio,n=this._fillRadius(r)
;s.lollipop.fillCircle&&s.lollipop.backgroundColor&&this._drawFilledCircle(e,t,n,s.lollipop.backgroundColor);const o=Math.round(s.lollipop.lineWidth*r),a=n-Math.round(1*r+o/2);this._drawBorderLine(e,t,o,a),s.lollipop.fillCircle&&s.lollipop.fillStyle&&this._drawFilledCircle(e,t,a,s.lollipop.fillStyle)}_drawLabel(e,t,i){const s=this._data.style.lollipop.text,r=s.label;if(""===r)return;e.textAlign="center",e.textBaseline="middle",e.fillStyle=s.strokeStyle,e.font=s.font;const n=this._textWidthCache.yMidCorrection(e,r);e.translate(t.x,t.y+((s.deltaY||0)+n)*i),(0,z.drawScaled)(e,i,(()=>{e.fillText(r,0,0)}))}_fillRadius(e){const t=this._data.style,i=Math.max(1,Math.floor(e));let s=Math.round(t.lollipop.width*e);return s%2!=i%2&&(s+=1),s/2}_drawBorderLine(e,t,i,s){const r=this._data.style;e.strokeStyle=r.lollipop.strokeStyle,e.lineWidth=i,(0,ye.setLineStyle)(e,Se.LINESTYLE_SOLID),(0,ye.createCircle)(e,t.x,t.y,s),e.stroke()}_drawFilledCircle(e,t,i,s){e.fillStyle=s,(0,ye.createCircle)(e,t.x,t.y,i),e.fill()}}var Pe=i(777277);class Ce extends we{_drawLollipop(e,t,i){var s;if(!this._imageLoaded())return void super._drawLollipop(e,t,i);const r=this._data.style,n=i.pixelRatio,o=this._fillRadius(n);let a=Math.round(r.lollipop.lineWidth*n),l=o-Math.round(1*n+a/2);if(r.lollipop.fillCircle&&(r.lollipop.backgroundColor&&this._drawFilledCircle(e,t,o,r.lollipop.backgroundColor),r.lollipop.fillStyle&&this._drawFilledCircle(e,t,l,r.lollipop.fillStyle)),null===(s=this._data.style.lollipop.image)||void 0===s?void 0:s.imageElement){const i=o-Math.round(1*n+2*a),s=2*i;e.save(),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",(0,ye.createCircle)(e,t.x,t.y,i),e.clip(),e.drawImage(this._data.style.lollipop.image.imageElement,t.x-i,t.y-i,s,s),e.restore()}"active"===this._data.status&&(l-=a/2,a*=1.5),this._drawBorderLine(e,t,a,l)}_drawLabel(e,t,i){this._imageLoaded()&&!this._data.style.lollipop.text.showWhenImageLoaded||super._drawLabel(e,t,i)}_imageLoaded(){return Boolean(this._data.style.lollipop.image&&this._data.style.lollipop.image.imageElement&&this._data.style.lollipop.image.imageElement.complete&&this._data.style.lollipop.image.imageElement.naturalWidth)}}const Te={fillPath:new Path2D("M8.961.92a3 3 0 0 1 3.078 0l7.5 4.48A3 3 0 0 1 21 7.975V20a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V7.975A3 3 0 0 1 1.461 5.4l7.5-4.48z"),strokePath:new Path2D("M9.867 2.742c.39-.23.875-.23 1.266 0l7.5 4.406c.382.225.617.635.617 1.078V20c0 .69-.56 1.25-1.25 1.25H3c-.69 0-1.25-.56-1.25-1.25V8.226c0-.443.235-.853.617-1.078l7.5-4.406z")},xe={fillPath:new Path2D("M8.961 22.08a3 3 0 0 0 3.078 0l7.5-4.48A3 3 0 0 0 21 15.025V3a3 3 0 0 0-3-3H3a3 3 0 0 0-3 3v12.025A3 3 0 0 0 1.461 17.6l7.5 4.48z"),strokePath:new Path2D("M9.866 20.257c.391.23.877.23 1.268 0l7.5-4.414a1.25 1.25 0 0 0 .616-1.078V3c0-.69-.56-1.25-1.25-1.25H3c-.69 0-1.25.56-1.25 1.25v11.765c0 .443.234.853.616 1.078l7.5 4.414z")},Ie={fillPath:new Path2D("M3 0h15c1.662 0 3 1.338 3 3v15c0 1.662-1.338 3-3 3H3c-1.662 0-3-1.338-3-3V3c0-1.662 1.338-3 3-3z"),
strokePath:new Path2D("M3 1.75h15c.693 0 1.25.557 1.25 1.25v15c0 .693-.557 1.25-1.25 1.25H3c-.692 0-1.25-.558-1.25-1.25V3c0-.692.558-1.25 1.25-1.25z")};function Me(e,t,i,s,r){const n=i.pixelRatio;e.save(),e.translate(t.x-s.lollipop.width*n/2,t.y-s.lollipop.height*n/2),e.scale(n,n),s.lollipop.fillCircle&&s.lollipop.backgroundColor&&(e.fillStyle=s.lollipop.backgroundColor,e.fill(r.fillPath)),e.strokeStyle=s.lollipop.strokeStyle,e.lineWidth=Math.round(s.lollipop.lineWidth*n)/n,(0,ye.setLineStyle)(e,Se.LINESTYLE_SOLID),s.lollipop.fillCircle&&s.lollipop.fillStyle&&(e.fillStyle=s.lollipop.fillStyle,e.fill(r.strokePath)),e.stroke(r.strokePath),e.restore()}function Le(e,t,i,s){Me(e,t,i,s,Te)}function Ae(e,t,i,s){Me(e,t,i,s,xe)}function ke(e,t,i,s){Me(e,t,i,s,Ie)}class Ee extends we{_drawLollipop(e,t,i){const s=this._data.style;switch(s.shape){case"earningUp":Le(e,t,i,s);break;case"earningDown":Ae(e,t,i,s);break;case"earning":ke(e,t,i,s);break;default:super._drawLollipop(e,t,i)}}}const De={backgroundDark:(0,_e.getHexColorByName)("color-cold-gray-900"),backgroundLight:(0,_e.getHexColorByName)("color-white")};class Be extends class{constructor(e,t,i){this._invalidated=!1,this._renderer=new me.CompositeRenderer,this._textWidthCache=new ge.TextWidthCache,this._stylesCache=null,this._lollipops={},this._lollipopsCounter=0,this._lastClickedId=null,this.onPaneBgChange=()=>{this._recreateStyles(this._model)},this._lastClickedId=null,this._model=e,this._source=t,this._clickHandler=i,this._recreateStyles(e),e.backgroundColor().subscribe(this.onPaneBgChange),e.mainSeries().onSymbolIntervalChanged().subscribe(this,this._onSymbolOrIntervalChanged)}destroy(){this._model.backgroundColor().unsubscribe(this.onPaneBgChange),this._model.mainSeries().onSymbolIntervalChanged().unsubscribeAll(this)}processClickOutside(e){var t;if(null===this._lastClickedId||!e)return void this.clearLastClicked();let i=null;if(function(e){return void 0!==e.touches}(e)){if(1!==e.touches.length)return;{const t=(0,s.ensureNotNull)(e.target).getBoundingClientRect(),n=e.touches[0];i=new r.Point(n.clientX-t.left,n.clientY-t.top)}}else i=new r.Point(e.offsetX,e.offsetY);const n=this._renderer.hitTest(i,{physicalHeight:0,physicalWidth:0,pixelRatio:1,cssHeight:0,cssWidth:0});null!==n&&(null===(t=n.data())||void 0===t?void 0:t.activeItem)===(0,s.ensureDefined)(this._lollipops[this._lastClickedId]).itemIndex||this.clearLastClicked()}clearLastClicked(){const e=null!==this._lastClickedId&&this._lollipops[this._lastClickedId]||null;null!==e&&(e.active=!1),this._lastClickedId=null}getLastClickedLollipopId(){return this._lastClickedId}update(){this._invalidated=!0}afterUpdate(e,t,i,s){}getStyle(e,t){let i=t;if(e.stack&&(i+="_stack:"+e.stack),"active"===i)return this._activeStyle;if("hovered"===i)return this._hoveredStyle;if("default"===i)return this._defaultStyle;if(this._stylesCache||(this._stylesCache={}),!this._stylesCache[i]){const s=(0,ue.clone)("active"===t?this._activeStyle:"hovered"===t?this._hoveredStyle:this._defaultStyle);e.stack&&(s.lollipop.incHeight=25*e.stack),
this._stylesCache[i]=s}return this._stylesCache[i]}hasTooltip(e){return!0}_getY(){let e=0;const t=this._model.panes();for(let i=t.length;i--;){const s=t[i];s.containsMainSeries()&&(e+=s.height())}return e}_showBarLine(e){return this.hasTooltip(e)&&(e.hovered||e.active)}_createRenderers(e,t){this._renderer.clear();const i=(0,N.size)({width:e,height:t});for(const e in this._lollipops)if(this._lollipops.hasOwnProperty(e)){const t=(0,s.ensureDefined)(this._lollipops[e]);if(t.visible){const e=this._getLollipopStatus(t),s=this.getStyle(t,e),n={id:t.id,centerPoint:new r.Point(t.basePoint.x,t.basePoint.y-s.lollipop.bottom-s.lollipop.height/2-(s.lollipop.incHeight||0)),style:s,status:e},o={activeItem:t.itemIndex,hideCrosshairLinesOnHover:!0,clickHandler:this._lollipopMouseClickHandler.bind(this,n,i),tapHandler:this._lollipopMouseClickHandler.bind(this,n,i)};if(this._renderer.append(this._createRendererForLollipop(n,o)),this._showBarLine(t)){const{strokeStyle:e,lineStyle:i,lineWidth:r}=s.barLine,n={color:e,linestyle:i,linewidth:r,x:t.basePoint.x,top:0,bottom:t.basePoint.y-s.lollipop.bottom-s.lollipop.height},o=new fe.VerticalLineRenderer;o.setData(n),this._renderer.insert(o,0)}}}}_recreateStyles(e){this._stylesCache=null}_createRendererForLollipop(e,t){return new we(e,new Pe.HitTestResult(Pe.HitTestResult.CUSTOM,t),this._textWidthCache)}_onSymbolOrIntervalChanged(){this._lollipops={},this._lollipopsCounter=0,this._renderer.clear(),this.clearLastClicked()}_lollipopMouseClickHandler(e,t,i){i.preventDefault();const n=e.id;if(this._lastClickedId=this._lastClickedId===n?null:n,null===this._lastClickedId)return;const o={target:i.target,targetSize:t,point:new r.Point(e.centerPoint.x,e.centerPoint.y-e.style.lollipop.height/2-8),marginTop:15};this._clickHandler(o,(()=>{const e=(0,s.ensureDefined)(this._lollipops[n]);return this._createTooltipContent(e)}))}_getLollipopStatus(e){return e.active?"active":e.hovered?"hovered":"default"}}{constructor(e,t,i){super(e,t,i),this.stylesCache={},this.templatesCache={},this._itemIndexToId=new Map,this.source=t}clearCaches(){this.clearLastClicked(),this._lollipops={},this._lollipopsCounter=0}update(){this._invalidated=!0}renderer(e,t){return this._invalidated&&(this._createLollipops(t,e),this._invalidated=!1),this._renderer}getStyle(e){const t=e.active?"active":e.hovered?"hovered":"default";return this._generateStyle(t,e)}hasTooltip(e){return Boolean(e.items&&e.items.length)}_createTooltipContent(e){const t=e.items;return t?[{type:"common",subTitle:Array.isArray(t)?t.map((e=>({value:e}))):[{value:t}],style:{color:e.color}}]:null}_createRendererForLollipop(e,t){return new(e.style.lollipop.image?Ce:Ee)(e,new Pe.HitTestResult(Pe.HitTestResult.CUSTOM,t),this._textWidthCache)}_lollipopMouseClickHandler(e,t,i){super._lollipopMouseClickHandler(e,t,i),(0,D.emit)("onTimescaleMarkClick",e.id)}_createLollipops(e,t){const i=this._model.timeScale(),s=super._getY(),n=this._model.lastHittestData(),o=this._model.hoveredSource(),a=this.source.marks(),l=new Map;Object.keys(a).forEach((e=>{var t
;const c=a[e],h=c.id,d=c.index;if(null!=d){const e=h===this.getLastClickedLollipopId(),a=this._lollipops[h],u=void 0!==a?a.itemIndex:this._lollipopsCounter++;this._itemIndexToId.has(u)||this._itemIndexToId.set(u,h);const p=o===this.source&&null!==n&&n.activeItem===u,_=(null!==(t=l.get(d))&&void 0!==t?t:-1)+1;l.set(d,_),this._lollipops[h]={id:h,itemIndex:u,basePoint:new r.Point(i.indexToCoordinate(d)+1,s),hovered:p,active:e,label:c.label,color:c.color,items:c.tooltip,visible:!0,stack:_,shape:c.shape,image:this._getImageForUrl(c.imageUrl),showLabelWhenImageLoaded:c.showLabelWhenImageLoaded,textColor:c.labelFontColor}}})),super._createRenderers(e,t)}_getImageForUrl(e){if(e)return this.source.getImageElement(e)}_generateStyle(e,t){const{color:i,label:s,stack:r,shape:n,image:o,textColor:a}=t;let l=e+i+s;if(void 0!==r&&(l+="_stack"+r),!(l in this.stylesCache)){const c=this._model.isDark()?De.backgroundDark:De.backgroundLight;let h,d=i;if("active"===e)h=i,d="rgba(255, 255, 255, 0.92)";else if("hovered"===e){const e=(0,O.tryParseRgba)(i);if(null!==e){const t=e[3]*(1-.85);h=(0,O.rgbaToString)((0,O.rgba)(e[0],e[1],e[2],t))}}a&&(d=a);let u=23,p=23,_=1,m=0;"earning"===n?(p=21,u=21,_=2):"earningUp"===n?(u=21,m=1,_=2):"earningDown"===n&&(u=21,m=-.5,_=.5);const g={barLine:{lineStyle:Se.LINESTYLE_DASHED,lineWidth:1,strokeStyle:i},lollipop:{width:u,height:p,bottom:_,backgroundColor:c,lineWidth:1.5,fillStyle:h,strokeStyle:i,fillCircle:!0,text:{label:s,deltaY:m,strokeStyle:d,font:(0,U.makeFont)(12,H.CHART_FONT_FAMILY,"bold"),showWhenImageLoaded:t.showLabelWhenImageLoaded},image:o},shape:n};void 0!==r&&(g.lollipop.incHeight=25*r),this.stylesCache[l]=g}return this.stylesCache[l]}}var Ve=i(508547),Re=i(792268),Ne=i(667968),Oe=i(964892);const Fe=(0,n.getLogger)("Chart.UserDefinedImageMarks");class We extends Oe.BarsMarksContainer{constructor(){super(...arguments),this._imageItems=new Map,this._destroyed=!1}destroy(){this._destroyed=!0,super.destroy()}getImageElement(e){return this._imageItems.has(e)||this.addImageToStore(e),this._imageItems.get(e)}addImageToStore(e){this._imageItems.has(e)||this._loadNewImage(e)}_loadNewImage(e){const t={imageElement:null};(0,Ne.getImage)(e,e).then((e=>{this._destroyed||(t.imageElement=e,this.updateAllViewsAndRepaint(),this._model.updateSource(this))})).catch((()=>{Fe.logWarn(`An error ocurred while loading image ${e}`)})),this._imageItems.set(e,t)}}class ze extends We{constructor(e){super(e,new Ve.DefaultProperty("UserDefinedTimescaleMarks",{visible:!0})),this._requestedPointsets=new Set,(0,pe.hideMarksOnBars)().subscribe(this,(()=>this._properties.childs().visible.setValue(!(0,pe.hideMarksOnBars)().value()))),this._paneView=new Be(e,this,this._showTooltip.bind(this)),this._paneViews=[this._paneView]}destroy(){(0,pe.hideMarksOnBars)().unsubscribeAll(this),super.destroy()}zorder(){return Re.sortSourcesPreOrdered.TimeScaleMarks}userEditEnabled(){return!1}clearMarks(e=0){if(1===e)return;const t=this._model.chartApi();t.isConnected().value()&&Object.keys(this._marks).forEach((e=>{
const i=this._getPointsetId(e);t.removePointset(i)})),this._requestedPointsets.clear(),super.clearMarks(),this._paneView.clearCaches(),this.updateAllViewsAndRepaint()}hasContextMenu(){return!1}paneViews(){return this._properties.childs().visible.value()?this._paneViews:[]}updateAllViews(){this._paneView.update()}onClickOutside(){this._paneView.processClickOutside()}_initialize(){this._properties.childs().visible.setValue(!0)}_plateViewData(e){return{text:e.text}}_getData(e){const t=this._model.mainSeries().symbolInfo();if(!t)return;const i=this.roundRange(this._rangeDifference(e)),r=this._model.mainSeries(),n=r.seriesSource().symbolInstanceId(),o=r.properties().childs().interval.value();window.ChartApiInstance.getTimescaleMarks(t,i.start,i.end,(t=>{const i=this._model.chartApi();for(const e of t){e.index=null;const t=e.id,r=this._getPointsetId(t.toString()),a=this._marks[t];if(a&&null!==a.index&&(a.tickmark===e.tickmark?e.index=a.index:this._requestedPointsets.has(r)&&i.isConnected().value()&&(i.removePointset(r),this._requestedPointsets.delete(r))),e.imageUrl&&this.addImageToStore(e.imageUrl),this._marks[t]=e,null===e.index&&i.isConnected().value()){this._requestedPointsets.add(r);const t=[[e.tickmark,0]];i.createPointset(r,"turnaround",(0,s.ensureNotNull)(n),o,t,(e=>this._onPointsetData(e)))}}this._loadedRange=this._rangeUnion(e,this._loadedRange),this.updateAllViewsAndRepaint()}),o)}_getPointsetId(e){return"pointsetMark_"+e}_onPointsetData(e){if("data_update"===e.method){const t=e.params.customId.split("_")[1],i=this._marks[t],s=e.params.plots;i&&1===s.length&&(i.index=s[0].value[0])}this.updateAllViews()}async _showTooltip(e,t){const s=t();if(!s)return;const r=this._model.timeScale(),n=[r.onScroll(),r.barSpacingChanged(),this._model.mainSeries().onSymbolIntervalChanged()],o=this._paneView.processClickOutside.bind(this._paneView);(await Promise.all([i.e(7624),i.e(6092),i.e(240),i.e(962),i.e(8550),i.e(9039)]).then(i.bind(i,918170))).showLollipopTooltip({items:s,position:e,customCloseSubscriptions:n,onClickOutside:o})}}function He(e,t){const i=Math.max(1,Math.floor(t)),s=Math.round(e.x*t)+i%2/2;let r=Math.round(e.size*t);(s+r/2)%1!=0&&(r+=1);const n=Math.min(Math.max(1,Math.round(t*e.borderWidth)),r/2);let o;const a=("up"===e.direction?-1:1)*(e.yInverted?-1:1),l=a*(Math.round(e.size*t/2)+i%2);if(void 0!==e.fixedSpaceYPosition){const i=Math.round(e.fixedSpaceYPosition.itemSpacing*t),s=e.fixedSpaceYPosition.order,n=a*(r*s+i*(s+1));o=Math.round(e.fixedSpaceYPosition.basePosition*t)+n+l}else o=Math.round(e.y*t)+l;return{x:s,y:o,size:r,borderWidth:n,tickSize:i}}function Ue(e,t,i,s){var r,n,o;if(e.save(),i&&!s.highlightByAuthor&&(e.globalAlpha=.4),s.mine)!function(e,t,i){const{borderColor:s,backgroundColor:r,doNotFill:n,direction:o,yInverted:a}=i,{x:l,y:c,borderWidth:h,size:d,tickSize:u}=He(i,t.pixelRatio);e.strokeStyle=s,e.fillStyle=r,e.lineWidth=h;const p="up"===o!==a?-1:1;let _=Math.round(d/2/Math.tan(Math.PI/6))+u%2/2;(l+_/2)%1!=0&&(_-=1);e.translate(l,c+_/2*p),e.beginPath();const m=h/2;e.moveTo(0,-p*(_-m)),
e.lineTo(d/2-m,h/2),e.lineTo(-d/2+m,h/2),e.lineTo(0,-p*(_-h/2)),e.closePath(),n||e.fill();e.stroke()}(e,t,s);else{let i=!1;{const e=s.image&&(o=s.image,Boolean(o&&o.imageElement&&o.imageElement.complete&&o.imageElement.naturalWidth));i=Boolean(e&&!s.showLabelWhenImageLoaded)}!function(e,t,i,s,r){const{borderColor:n,backgroundColor:o,label:a}=i,l=t.pixelRatio,{x:c,y:h,borderWidth:d,size:u}=He(i,l);e.strokeStyle=n,e.fillStyle=o,e.lineWidth=d,e.beginPath();const p=u/2-d/2;e.arc(c,h,p,0,2*Math.PI,!0),e.closePath(),e.fill(),r&&function(e,t,i,s,r){if(t){const n=2*i;e.save(),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",(0,ye.createCircle)(e,s,r,i),e.clip(),e.drawImage(t,s-i,r-i,n,n),e.restore()}}(e,r,p,c,h);e.stroke(),!s&&a&&u/2>=7&&(e.textAlign="center",e.textBaseline="middle",e.font=a.font,e.fillStyle=a.fontColor,(0,z.drawScaled)(e,l,(()=>{e.fillText(a.text,c/l,h/l)})))}(e,t,s,i,null!==(n=null===(r=s.image)||void 0===r?void 0:r.imageElement)&&void 0!==n?n:void 0)}e.restore()}class je{constructor(e,t,i,s){this._canvas=null,this._clickHandler=e,this._enterHandler=t,this._leaveHandler=i,this._data=null!=s?s:null}setData(e){this._data=e}hitTest(e,t){if(null===this._data)return null;for(let i=this._data.items.length-1;i>=0;--i){const s=this._hitTestDot(this._data.items[i],e,t.pixelRatio);if(s)return s}return null}draw(e,t){this._canvas=e.canvas,null!==this._data&&this._data.items.forEach(Ue.bind(null,e,t,this._data.highlightByAuthor))}_hitTestDot(e,t,i){const s=new r.Point(e.x,He(e,i).y/i);if((0,ve.pointInCircle)(t,s,Math.max(e.size/2,8))){const t=this._canvas,i=null===t?void 0:{mouseEnterHandler:()=>this._enterHandler(e,s.y,t),mouseLeaveHandler:()=>this._leaveHandler(),clickHandler:i=>this._clickHandler(e,s.y,t,i),tapHandler:i=>this._clickHandler(e,s.y,t,i)};return new Pe.HitTestResult(Pe.HitTestResult.REGULAR,{activeItem:e.originalItem.id,...i})}return null}}const Ge={green:{border:(0,_e.getHexColorByName)("color-minty-green-700"),background:(0,_e.getHexColorByName)("color-minty-green-a700")},red:{border:(0,_e.getHexColorByName)("color-ripe-red-700"),background:(0,_e.getHexColorByName)("color-ripe-red-500")},neutral:{border:(0,_e.getHexColorByName)("color-tan-orange-700"),background:(0,_e.getHexColorByName)("color-tan-orange-500")},yellow:{border:"#EAC300",background:"#FFD400"},blue:{border:"#047ACE",background:"#0496FF"}};function qe(e){var t,i,s,r;return e.hovered||e.highlightByAuthor?null!==(i=null===(t=e.overrideBorderWidth)||void 0===t?void 0:t.hoveredWidth)&&void 0!==i?i:4:null!==(r=null===(s=e.overrideBorderWidth)||void 0===s?void 0:s.width)&&void 0!==r?r:2}class $e extends class{constructor(e,t){this._tooltip=null,this._hoveredBarsMarkData=null,this._destroyed=!1,this._invalidated=!0,this._originalData=[],this._source=e,this._model=t,this._renderer=new je(this._onItemClicked.bind(this),this._showItem.bind(this),this._hideItem.bind(this)),this._createTooltipRenderer().then((e=>{this._destroyed?null==e||e.destroy():this._tooltip=e})),e.properties().childs().visible.subscribe(null,(()=>{var e
;null===(e=this._tooltip)||void 0===e||e.hide(!0)}))}destroy(){var e;this._destroyed=!0,null===(e=this._tooltip)||void 0===e||e.destroy()}source(){return this._source}update(){this._invalidated=!0}renderer(e,t){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}onClickOutside(e){e.isTouch&&null!==this._tooltip&&!this._tooltip.contains(e.target)&&this._tooltip.hide(!0)}_extractBarMarksRendererItemData(e,t){var i,s;const r=null!==(i=t.overridedTheme)&&void 0!==i?i:Ge[t.theme],n=this._calculateSize(e,t),o=this._calculateY(e,n,t);return null===this._hoveredBarsMarkData||this._hoveredBarsMarkData.id!==t.id||this._hoveredBarsMarkData.x===t.x&&this._hoveredBarsMarkData.y===Math.round(o)||(null===(s=this._tooltip)||void 0===s||s.hide(!0),this._hoveredBarsMarkData=null),{x:t.x,y:this._calculateY(e,n,t),direction:t.direction,borderColor:r.border,borderWidth:qe(t),backgroundColor:r.background,size:n,doNotFill:!t.public,yInverted:t.yInverted,label:void 0===t.label?void 0:{text:t.label,fontColor:t.labelFontColor,font:(0,U.makeFont)(Math.ceil(Math.max(10,Math.min(n/2,20))),H.CHART_FONT_FAMILY,"bold")},originalItem:t}}_onItemClicked(e,t,i,s){s.isTouch&&this._showItem(e,t,i)}async _showItem(e,t,i){var r;const n=await this._tooltipProps(e);if(null===n)return;const o=this._model.timeScale().barSpacing(),a=this._calculateSize(o,e.originalItem);this._hoveredBarsMarkData={x:e.x,y:Math.round(this._calculateY(o,a,e.originalItem)),id:e.originalItem.id},null===(r=this._tooltip)||void 0===r||r.show({itemSize:a,container:(0,s.ensureNotNull)(i.parentElement),x:e.x,y:t,factoryProps:n,onClickOutside:()=>{var e;return null===(e=this._tooltip)||void 0===e?void 0:e.hide(!0)}})}_hideItem(){var e;null===(e=this._tooltip)||void 0===e||e.hide()}_calculateSize(e,t){return Math.min(553,Math.max(7,t.minSize,.8*e))}_updateImpl(){this._originalData=this._source.getPlatesViewData();const e=this._model.timeScale().barSpacing(),t=this._originalData.map(this._extractBarMarksRendererItemData.bind(this,e));this._renderer.setData({items:t,barSpacing:e,highlightByAuthor:!1})}}{async _createTooltipRenderer(){const[{TooltipRenderer:e},{UserDefinedBarsMarksTooltip:t}]=await Promise.all([Promise.all([i.e(2913),i.e(962),i.e(8020)]).then(i.bind(i,747755)),Promise.all([i.e(2913),i.e(962),i.e(8020)]).then(i.bind(i,45287))]);return new e(t)}_calculateY(e,t,i){const s=Math.max(1.4*i.minSize,e+4),r=("up"===i.direction?-1:1)*(i.yInverted?-1:1)*(s*(i.order+.6)+.25*s);return i.y+r}_onItemClicked(e,t,i,s){var r,n;super._onItemClicked(e,t,i,s),null===(n=(r=e.originalItem).onClicked)||void 0===n||n.call(r)}_tooltipProps(e){const t=e.originalItem.text;return t?Promise.resolve({text:t}):Promise.resolve(null)}_extractBarMarksRendererItemData(e,t){return{...super._extractBarMarksRendererItemData(e,t),showLabelWhenImageLoaded:t.showLabelWhenImageLoaded,image:t.image}}}class Ye extends We{constructor(e){super(e,new Ve.DefaultProperty("UserDefinedBarsMarks",{visible:!0})),this._paneView=new $e(this,e),this._paneViews=[this._paneView],(0,
pe.hideMarksOnBars)().subscribe(this,(()=>{this.properties().childs().visible.setValue(!(0,pe.hideMarksOnBars)().value())}))}destroy(){(0,pe.hideMarksOnBars)().unsubscribeAll(this),this._paneView.destroy(),super.destroy()}zorder(){return Re.sortSourcesPreOrdered.BarMarks}userEditEnabled(){return!1}clearMarks(e=0){2!==e&&(super.clearMarks(),this.updateAllViewsAndRepaint())}hasContextMenu(){return!1}paneViews(){return this._properties.childs().visible.value()?this._paneViews:[]}onClickOutside(e){this._paneView.onClickOutside(e)}_initialize(){this.properties().childs().visible.setValue(!0)}_plateViewData(e){const t={text:e.text,onClicked:e.onClicked};"object"==typeof e.color&&(t.theme="user_defined_theme",t.overridedTheme={},t.overridedTheme.border=e.color.border,t.overridedTheme.background=e.color.background);const i=(0,ue.isNumber)(e.borderWidth)?e.borderWidth:void 0,s=(0,ue.isNumber)(e.hoveredBorderWidth)?e.hoveredBorderWidth:void 0;if(void 0===i&&void 0===s||(t.overrideBorderWidth={width:i,hoveredWidth:s}),e.showLabelWhenImageLoaded&&(t.showLabelWhenImageLoaded=!0),e.imageUrl){const i=this.getImageElement(e.imageUrl);t.image=i}return t}_getData(e){const t=this._model.mainSeries().symbolInfo();if(!t)return;const i=this.roundRange(this._rangeDifference(e)),s=this._model.mainSeries().properties().childs().interval.value();window.ChartApiInstance.getMarks(t,i.start,i.end,(t=>{for(const e of t)this._marks[e.id]=e,e.imageUrl&&this.addImageToStore(e.imageUrl);this._loadedRange=this._rangeUnion(e,this._loadedRange),this.updateAllViewsAndRepaint()}),s)}}var Ke=i(702054);const Ze=new a.TranslatedString("apply toolbars theme",o.t(null,void 0,i(558570)));class Xe extends u.UndoCommand{constructor(e,t,i=!0){super(Ze),this._prevThemeName=e,this._themeName=t,this._syncState=i}undo(){(0,V.isStdThemeName)(this._prevThemeName)&&((0,Ke.setTheme)(this._prevThemeName),this._syncState&&(0,V.syncTheme)())}redo(){(0,V.isStdThemeName)(this._themeName.toLowerCase())&&((0,Ke.setTheme)(this._themeName.toLowerCase()),this._syncState&&(0,V.syncTheme)())}}i(951327),i(217203),i(997753);var Je=i(96401),Qe=i(979861),et=i(512882);const tt=!l.CheckMobile.any(),it=(0,n.getLogger)("ChartWidgetCollectionBase"),st=new a.TranslatedString("apply indicators to entire layout",o.t(null,void 0,i(744547))),rt=new a.TranslatedString("sync time",o.t(null,void 0,i(260635))),nt=new a.TranslatedString("resize layout",o.t(null,void 0,i(113034))),ot=new a.TranslatedString("reset layout sizes",o.t(null,void 0,i(830910))),at=new a.TranslatedString("apply chart theme",o.t(null,void 0,i(766568))),lt=new a.TranslatedString("symbol lock",o.t(null,void 0,i(292831))),ct=new a.TranslatedString("interval lock",o.t(null,void 0,i(128916))),ht=new a.TranslatedString("date range lock",o.t(null,void 0,i(390621))),dt=new a.TranslatedString("track time",o.t(null,void 0,i(247122))),ut=o.t(null,void 0,i(46669)),pt=o.t(null,void 0,i(398478)),_t=o.t(null,void 0,i(834004)),mt=o.t(null,void 0,i(796260));o.t(null,void 0,i(838641)),o.t(null,void 0,i(110160));function gt(e,t){
const i=t.model().model().studyTemplate();e.undoHistory.beginUndoMacro(st);for(let s=0;s<e.chartWidgetsDefs.length;s++){const r=e.chartWidgetsDefs[s].chartWidget;r!==t&&(r.hasModel()&&r.model().applyStudyTemplate(i,""))}e.undoHistory.endUndoMacro()}function ft(e,t,i,r,n){e.undoHistory.beginUndoMacro(n);for(let o=0;o<e.chartWidgetsDefs.length;o++){const a=e.chartWidgetsDefs[o].chartWidget;if(a!==t&&a&&a.hasModel()){const t=a.model();let o;if(r.isOnMainPane)o=(0,s.ensureNotNull)(t.model().paneForSource(a.model().model().mainSeries()));else{const i=new p(t.model(),r.paneIndex);e.undoHistory.pushUndoCommand(i);const n=(0,s.ensureDefined)(i.createdPaneId());o=(0,s.ensureDefined)(t.model().panes().find((e=>e.id()===n)))}const l=t.pasteSourceFromClip(o,i,!0);if(l&&1===l.length){const e=l[0];if(r.asCompare){const i=(0,s.ensureNotNull)(t.mainSeries().priceScale());t.moveToScale(e,(0,s.ensureDefined)(o),i,n),t.setPriceScaleMode({percentage:!0},i,null)}}t.model().lightUpdate()}}e.undoHistory.endUndoMacro()}function vt(e){let t=1;for(;e.has(""+t);)t++;return""+t}function St(e){const t=new Map,i=e.chartsCountToSave(),s=new Set;for(let r=0;r<i;r++)if(r<e.chartWidgetsDefs.length){const i=e.chartWidgetsDefs[r].chartWidget,n=i.id(),o=i.lineToolsAndGroupsDTO();t.set(n,o),s.add(n)}else{const i=e.savedChartWidgetOptions[r-e.chartWidgetsDefs.length].content;i.chartId||(i.chartId=vt(s));const n=new Map;n.set(0,extractLineToolsDTOFromChartState(i)),t.set(i.chartId,n),s.add(i.chartId)}return t}function yt(e,t,i,s,r,n){if(t<e.chartWidgetsDefs.length){const o=e.chartWidgetsDefs[t].chartWidget;return t<e.actualLayoutCount()||o.shouldBeSavedEvenIfHidden()?o.state(i,s,r,n):null}const o=e.savedChartWidgetOptions[t-e.chartWidgetsDefs.length].content;return o}function bt(e,t){return t<e.chartWidgetsDefs.length?e.chartWidgetsDefs[t].chartWidget.asyncState():Promise.resolve({})}function wt(e,t){return e.chartWidgetsDefs[0].chartWidget===t}function Pt(e){return e.savedChartWidgetOptions.map((e=>(0,s.ensureDefined)(e.content.chartId)))}function Ct(e,t,i){e.chartsCountToSave();i.forEach((i=>{const s=(r=i.chartId,null!==(o=null===(n=e.chartWidgetsDefs.find((e=>e.chartWidget.id()===r)))||void 0===n?void 0:n.chartWidget)&&void 0!==o?o:null);var r,n,o;null==s||s.resetLineToolsInvalidated(t,i.savedDto,i.sharingMode)}))}function Tt(e,t,i,s){const r=e.map((e=>e.chartWidget)).filter((e=>e.hasModel())).filter((e=>e.id()===t||0!==s));try{r.forEach((e=>e.startApplyingLineToolUpdateNotification())),r.forEach((e=>e.applyLineToolUpdateNotification(i,s)))}finally{r.forEach((e=>e.endApplyingLineToolUpdateNotification()))}}function xt(e){return e instanceof Error?e.message:null}function It(e){return new T({copyRequested:(t,i)=>{e.activeChartWidget.value().model().clipboardCopy(t,i).catch((t=>{var i;null===(i=e.toastsFactory)||void 0===i||i.getChartToasts().then((e=>{var i;(0,s.ensureNotNull)(e).showSimpleToast({title:pt,text:null!==(i=xt(t))&&void 0!==i?i:ut.format({keystroke:(0,L.humanReadableHash)(L.Modifiers.Mod+67)}),role:"alert",intent:A.ToastIntent.Warning})}))}))
},cutRequested:(t,i)=>{e.activeChartWidget.value().model().clipboardCut(t,i).catch((t=>{var i;null===(i=e.toastsFactory)||void 0===i||i.getChartToasts().then((e=>{var i;(0,s.ensureNotNull)(e).showSimpleToast({title:_t,text:null!==(i=xt(t))&&void 0!==i?i:ut.format({keystroke:(0,L.humanReadableHash)(L.Modifiers.Mod+88)}),role:"alert",intent:A.ToastIntent.Warning})}))}))},pasteRequested:(t,i)=>{(i?i.model().undoModel():e.activeChartWidget.value().model()).clipboardPaste(t,i).catch((t=>{var i;null===(i=e.toastsFactory)||void 0===i||i.getChartToasts().then((e=>{var i;(0,s.ensureNotNull)(e).showSimpleToast({title:mt,text:null!==(i=xt(t))&&void 0!==i?i:ut.format({keystroke:(0,L.humanReadableHash)(L.Modifiers.Mod+86)}),role:"alert",intent:A.ToastIntent.Warning})}))}))}})}function Mt(e,t){0}function Lt(e){const t={};return e.chartWidgetsDefs.map((e=>e.chartWidget)).forEach((e=>t[e.id()]=function(e){var t,i,r,n,o;const a={};if(!e.hasModel()){const n=e.options().content;if(!n)return a;const o=(0,s.ensureNotNull)(n.panes.reduce(((e,t)=>{var i;return null!==(i=null!=e?e:t.sources.find((e=>"MainSeries"===e.type)))&&void 0!==i?i:null}),null));return a.resolution=null===(t=o.state)||void 0===t?void 0:t.interval,a.symbol=null===(i=o.state)||void 0===i?void 0:i.symbol,a.short_name=null===(r=o.state)||void 0===r?void 0:r.shortName,a}const l=e.model().mainSeries(),c=l.properties().childs(),h=l.symbolInfo();a.resolution=c.interval.value(),a.symbol_type=null!==h&&h.type||"",a.exchange=null!==h&&h.exchange||"",a.listed_exchange=null!==h&&h.listed_exchange||"";const d=null!==(n=null==h?void 0:h.legs)&&void 0!==n?n:[];if(null!==h&&l.isSpread()){const e=d[0];let t=h.base_name[0];t=t.split(":")[1],a.symbol=e,a.short_name=t,a.expression=h.full_name}else a.symbol=null!==h&&h.ticker||c.symbol.value(),a.short_name=c.shortName.value();const u=null!==(o=null==h?void 0:h.base_name)&&void 0!==o?o:[];return a.legs=d.map(((e,t)=>({symbol:e,pro_symbol:u[t]}))),a}(e))),t}function At(e,t){0}function kt(e,t){return M(t,{snapshotUrl:e}).then((e=>((0,D.emit)("onScreenshotReady",e),e)))}function Et(e,t){const i={snapshotUrl:e};const s=(0,B.isOnMobileAppPage)("any");return(s?M:I)(t,i).then((e=>((0,D.emit)("onScreenshotReady",e),s||(0,D.emit)("onServerScreenshotCopiedToClipboard"),e)))}function Dt(e){return function(e){return x().then((t=>t.downloadClientScreenshot(e)))}(e)}function Bt(e){return function(e){return x().then((t=>t.copyToClipboardClientScreenshot(e)))}(e).then((()=>{(0,D.emit)("onClientScreenshotCopiedToClipboard")}))}const Vt={s:0,"2h":0,"2v":1,"2-1":1,"3s":0,"3h":0,"3v":2,4:1,6:1,8:1,"1-2":1,"3r":1,"4h":0,"4v":3,"4s":0,"5h":0,"6h":0,"7h":0,"8h":0,"1-3":1,"2-2":3,"2-3":2,"1-4":1,"5s":0,"6c":4,"8c":6};function Rt(e,t,i,s){let r=0;const n=(0,Qe.createWVFromGetterAndSubscriptions)((()=>++r),[i,s]);return(0,Je.combine)((t=>{var i;return null!==(i=e()[Vt[t]])&&void 0!==i?i:null}),t,n)}function Nt(e,t,i,s){const r=Math.max(1,window.devicePixelRatio||1),n=e.getAll();let o;const a=e.maximizedChartWidget().value();if(s&&s.onlyActiveChart||a)return{
layout:"s",hidpiRatio:r,theme:(0,V.getCurrentTheme)().name,charts:[e.activeChartWidget.value().images(s)],publishedBy:o};const l=[],c=R.layouts[e.layout.value()].count,h={showCollapsedStudies:(s=s||{}).showCollapsedStudies,status:s.status};for(let e=0;e<n.length&&e<c;e++)l.push(n[e].images(h));return{layout:e.layout.value(),hidpiRatio:r,theme:(0,V.getCurrentTheme)().name,charts:l,publishedBy:o}}function Ot(e,t,i,s){const r=s||{};return async function(e,t){return new ie(e,t).getImage()}(Nt(e,0,0,{showCollapsedStudies:!0,status:{hideResolution:Boolean(r.hideResolution)}}),r)}function Ft(e){var t,i,s,r,n,o;const a=(null!==(t=e.options.edge)&&void 0!==t?t:0)+(null!==(i=e.options.border)&&void 0!==i?i:0),l=null!==(r=null===(s=e.bottomToolbar.value())||void 0===s?void 0:s.offsetHeight)&&void 0!==r?r:0,c=null!==(o=null===(n=e.replayContainer)||void 0===n?void 0:n.offsetHeight)&&void 0!==o?o:0;return{width:e.widthWV.value()-2*a,height:e.heightWV.value()-l-c-a,top:0,left:a}}function Wt(e){return`chart-widget-collection-border-${e}`}class zt{constructor(e,t,i){this._onShiftPressed=e=>{const t=this._state.currentLayoutResizeAction.value();t&&this._applyMouseMove(t.delta,e)},this._state=e,this._splitterElement=t,this._splitter=i,(0,ce.shiftPressed)().subscribe(this._onShiftPressed)}destroy(){(0,ce.shiftPressed)().unsubscribe(this._onShiftPressed)}mouseDownEvent(e){this._mouseDownOrTouchStartEvent(e)}touchStartEvent(e){this._mouseDownOrTouchStartEvent(e)}pressedMouseMoveEvent(e){this._pressedMouseOrTouchMoveEvent(e)}touchMoveEvent(e){this._pressedMouseOrTouchMoveEvent(e)}mouseUpEvent(e){this._mouseUpOrTouchEndEvent(e)}touchEndEvent(e){this._mouseUpOrTouchEndEvent(e)}mouseEnterEvent(e){this._highlightSplitters(e.shiftKey)}mouseLeaveEvent(e){const t=Wt(this._splitter.className);Array.from(this._state.parent.getElementsByClassName(t)).forEach((e=>e.classList.remove(et.hovered)))}mouseDoubleClickEvent(e){const t=(0,oe.layoutInitialSizingState)(this._state.layoutTemplate.value().expression);this._state.undoHistory.beginUndoMacro(ot),this._state.undoHistory.pushUndoCommand(new m(this._state.sizingState.spawn(),this._state.sizingState.value(),t,ot));const i=this._state.layoutTemplate.value().layoutType;this._state.undoHistory.pushUndoCommand(new _((e=>e?this._state.allLayoutSizesState.set(i,e):this._state.allLayoutSizesState.delete(i)),this._state.allLayoutSizesState.get(this._state.layoutTemplate.value().layoutType),t,ot)),this._state.undoHistory.endUndoMacro()}_highlightSplitters(e){const t=Wt(this._splitter.className);Array.from(this._state.parent.getElementsByClassName(t)).forEach((e=>e.classList.remove(et.hovered)));(e?Array.from(this._state.parent.getElementsByClassName(t)):[this._splitterElement]).forEach((e=>e.classList.add(et.hovered)))}_mouseDownOrTouchStartEvent(e){const t=new r.Point(e.localX+this._splitterElement.offsetLeft,e.localY+this._splitterElement.offsetTop),i=(0,ae.deepCopy)(this._state.sizingState.value());this._state.currentLayoutResizeAction.setValue({point:t,splitter:this._splitter,initialState:i,
alignedState:this._state.layoutTemplate.value().syncSublayoutsBySplitter(this._splitter,(0,ae.deepCopy)(i)),shiftState:e.shiftKey,delta:0}),this._splitterElement.classList.add(et["i-active"]),this._highlightSplitters(e.shiftKey)}_pressedMouseOrTouchMoveEvent(e){const t=this._state.currentLayoutResizeAction.value();if(!t)return;t.shiftState!==e.shiftKey&&(this._highlightSplitters(e.shiftKey),t.shiftState=e.shiftKey);const i=new r.Point(e.localX+this._splitterElement.offsetLeft,e.localY+this._splitterElement.offsetTop);t.delta="v"===t.splitter.orientation?i.y-t.point.y:i.x-t.point.x,this._applyMouseMove(t.delta,e.shiftKey)}_mouseUpOrTouchEndEvent(e){const t=this._state.currentLayoutResizeAction.value();if(t&&(this._splitterElement.classList.remove(et["i-active"]),this._state.currentLayoutResizeAction.setValue(null),t.currentState)){this._state.undoHistory.beginUndoMacro(nt),this._state.undoHistory.pushUndoCommand(new m(this._state.sizingState.spawn(),t.initialState,t.currentState,nt));const e=this._state.layoutTemplate.value().layoutType;this._state.undoHistory.pushUndoCommand(new _((t=>t?this._state.allLayoutSizesState.set(e,t):this._state.allLayoutSizesState.delete(e)),this._state.allLayoutSizesState.get(this._state.layoutTemplate.value().layoutType),this._state.sizingState.value(),ot)),this._state.undoHistory.endUndoMacro(),this._state.layoutSizesChanged.setValue(!0)}}_applyMouseMove(e,t){var i;const r=(0,s.ensureNotNull)(this._state.currentLayoutResizeAction.value()),n=t?r.alignedState:r.initialState,o=null!==(i=this._state.options.padding)&&void 0!==i?i:2,a=Ft(this._state);r.currentState=this._state.layoutTemplate.value().resizeApplier(a,o,e,r.splitter,(0,ae.deepCopy)(n),t),this._state.sizingState.setValue(r.currentState)}}function Ht(e,t,i,s,r){var n,o;const a=null!==(n=e.options.padding)&&void 0!==n?n:2,l=null!==(o=e.options.border)&&void 0!==o?o:0;r=null!=r?r:e.layoutTemplate.value();const c=Ft(e),h=r.sizer(c,i,s,a+l,tt?e.sizingState.value():void 0);h.width=Math.max(Math.round(h.width),0),h.height=Math.max(Math.round(h.height),0),h.top=Math.round(h.top),h.left=Math.round(h.left),t.metrics=h;const d=t.container.value();if(d){d.style.width=h.width+"px",d.style.height=h.height+"px",d.style.top=h.top+"px",d.style.left=h.left+"px";const e=1===s;false;const t=Math.round(c.width),i=0===h.top&&0===h.left,r=0===h.top&&h.left+h.width===t,n=0===h.top&&h.width===t;d.classList.toggle("top-left-chart",!e&&!n&&i),d.classList.toggle("top-right-chart",!e&&!n&&r),d.classList.toggle("top-full-width-chart",e||n)}t.width.setValue(h.width),t.height.setValue(h.height)}function Ut(e){var t,i,s;let r;const n=e.layoutTemplate.value(),o=e.maximizedChartDef.value();if(r=o?[o]:e.chartWidgetsDefs.slice(0,n.count).filter((e=>!e.hiddenInLayout.value())),r.forEach(((t,i)=>Ht(e,t,i,r.length))),tt&&!e.maximizedChartDef.value()){const r=Ft(e),o=null!==(t=e.options.padding)&&void 0!==t?t:2,a=null!==(i=e.options.border)&&void 0!==i?i:0,l=n.splitters(r,o+a,e.sizingState.value()),c=null!==(s=e.splitters.value())&&void 0!==s?s:[];c.forEach(((e,t)=>{
t>=l.length&&(e.splitterElement.remove(),e.mouseHandler.destroy(),e.mouseListener.destroy())}));const h=l.map(((t,i)=>{const s=i<c.length?c[i].splitterElement:document.createElement("div");let r,n;i<c.length?(r=c[i].mouseListener,n=c[i].mouseHandler):(r=new zt(e,s,t),n=new le.MouseEventHandler(s,r));const o=t.metrics,a=s.classList.contains(et.hovered),l=s.classList.contains(et["i-active"]);return s.className="",s.classList.add(et.chartsSplitter),s.classList.add(Wt(t.className)),a&&s.classList.add(et.hovered),l&&s.classList.add(et["i-active"]),s.style.left=o.left+"px",s.style.top=o.top+"px",s.style.width=o.width+"px",s.style.height=o.height+"px","v"===t.orientation?s.style.cursor="ns-resize":s.style.cursor="ew-resize",e.parent.appendChild(s),{splitter:t,splitterElement:s,mouseHandler:n,mouseListener:r}}));e.splitters.setValue(h)}}function jt(e,t,i){const s=e.chartWidgetsDefs.slice(0,e.layoutTemplate.value().count).map(((t,i,s)=>({def:t,metrics:e.layoutTemplate.value().sizer({top:0,left:0,width:256,height:256},i,s.length,0)}))).sort(((e,t)=>e.metrics.top-t.metrics.top||e.metrics.left-t.metrics.left)).map((e=>e.def));if(s.length<2)return null;let r=s.indexOf(t);return-1===r?null:(r=(r+(i?s.length-1:1))%s.length,s[r])}function Gt(e,t){return e.chartWidgetsDefs.some((e=>{var i;return(null===(i=e.chartWidget)||void 0===i?void 0:i.id())===t}))}function qt(e){let t=1;for(;e(""+t);)t++;return""+t}function $t(e){const t=e.activeChartWidget.value();if(t){const i=t.state();return i.chartId=qt((t=>Gt(e,t))),i.shouldBeSavedEvenIfHidden=!1,{content:i}}}function Yt(e,t,i){const r=e.toastsFactory;let n={chartWidgetCollection:t,isActive:0===e.chartWidgetsDefs.length,barsMarksContainersFactory:t=>function(e,t,i){const s=[];{const t=new Ye(e);s.push(t);const i=new ze(e);s.push(i)}return s}(t,0,e.options),undoHistory:e.undoHistory,readOnly:e.readOnly,initialLoading:e.initialLoading,getToasts:r?()=>r.getChartToasts():void 0,...null!=i?i:{}};void 0!==e.customLegendWidgetsFactoriesMap&&(n.customLegendWidgetFactories=new Map(e.customLegendWidgetsFactoriesMap));const o=document.createElement("div");o.classList.add("chart-container"),o.style.position="absolute",o.style.overflow="hidden",e.parent.appendChild(o),l.isEdge&&(o.style.touchAction="none",o.style.msTouchAction="none"),n.className&&o.classList.add(n.className);const a={alive:new(E())(!0),container:new(E())(o),width:new(E()),height:new(E()),collapsed:new(E())(!1),hiddenInLayout:new(E())(!1),visible:new(E()),rdState:new re.ResizerDetacherState,requestFullscreen:()=>{e.globalDetachable.value()&&(e.setMaximized(a),e.activeChartWidget.setValue((0,s.ensureNotNull)(a.chartWidget)))},exitFullscreen:()=>{e.activeChartWidget.value()===a.chartWidget&&e.setMaximized(null)},detachable:e.globalDetachable,fullscreenable:e.globalDetachable,fullscreen:new(E()),chartWidget:null};a.rdState.pushOwner(a),e.chartWidgetsDefs.push(a);const c=()=>{a.visible.setValue(!a.hiddenInLayout.value()&&e.options.resizerBridge.visible.value())};a.hiddenInLayout.subscribe((()=>{(0,
s.ensureNotNull)(a.chartWidget).setVisible(!a.hiddenInLayout.value()),c()})),a.collapsed.subscribe((()=>(0,s.ensureNotNull)(a.chartWidget).setCollapsed(a.collapsed.value()))),e.options.resizerBridge.visible.subscribe(c),c(),function(e,t){let i=0,s=0;const r=t.layoutTemplate.value();for(let n=0;n<r.count;n++)t.chartWidgetsDefs[n]===e&&(s=i),i++;Ht(t,e,s,i,r)}(a,e),n={...n,...a.rdState.bridge()};const h=n.content?(0,s.ensureDefined)(n.content.chartId):qt((t=>Gt(e,t))),d=new ne.ChartWidget(n,h,t.metaInfo.uid.value());return a.chartWidget=d,e.saveChartService&&a.chartWidget.setSaveChartService(e.saveChartService),n.containsData?d.finishInitWithoutConnect():d.connect(),d.withModel(null,(()=>{const t=d.model().model();e.customSources.forEach(((e,i)=>{t.addCustomSource(i,e.factory,e.layer)}))})),e.updateWatchedValue(),e.updateActivityView(),e.chartWidgetCreatedDelegate.fire(d),a}function Kt(e,t,i,s){const r={...e.widgetOptions,...e.savedChartWidgetOptions.shift()||$t(e),...0===i||e.symbolLock.value()?void 0:{defSymbol:null}},n=Yt(e,t,r),o=n.chartWidget;return o.modelCreated().subscribe(null,(()=>{s?s():e.checkAllPendingModelsAlreadyCreated(),e.dateRangeLock.value()&&o===e.activeChartWidget.value()&&e.subscribeToCompletedEventForDateRangeSync(o,!0)}),!0),n}function Zt(e){e.hiddenInLayout.setValue(!0);const t=e.container.value();t.parentNode&&t.parentNode.removeChild(t),e.fullscreen.setValue(!1)}function Xt(e,t){e.chartWidgetsDefs.forEach((i=>{const r=(0,s.ensureNotNull)(i.chartWidget);r.onZoom().unsubscribeAll(t),r.onScroll().unsubscribeAll(t),r.withModel(null,(()=>{const t=r.lineToolsSynchronizer();null!==t&&(t.hasChanges().unsubscribe(e.recalcHasChanges),e.recalcHasChanges())}))}))}async function Jt(e,t,i){var r,n;try{const t=e.chartWidgetsDefs.map((e=>{var t,i,s;return null!==(s=null===(i=null===(t=e.chartWidget)||void 0===t?void 0:t.lineToolsSynchronizer())||void 0===i?void 0:i.flushPendingSavings())&&void 0!==s?s:null})).filter(ue.notNull);t.length&&await Promise.all(t)}catch(e){it.logError(`Error flushing line tools: ${e}`)}(t=e.checkProFeature(t))in R.layouts||(t="s"),Xt(e,i);const o=e.layoutType,a=R.layouts[t].count;(0,D.emit)("layout_about_to_be_changed",t),(null!==(r=e.splitters.value())&&void 0!==r?r:[]).forEach(((e,t)=>{e.splitterElement.remove(),e.mouseHandler.destroy()})),e.splitters.setValue([]);const l=R.layouts[t];e.layoutTemplate.setValue(l);const c=null!==(n=e.allLayoutSizesState.get(l.layoutType))&&void 0!==n?n:(0,oe.layoutInitialSizingState)(l.expression);e.allLayoutSizesState.set(l.layoutType,c),e.sizingState.setValue(c);const h=e.maximizedChartDef.value();if(e.isPhoneSize.value()&&e.viewMode.value()===d.CollectionViewMode.ForceFullscreen)if(h){const t=e.chartWidgetsDefs.indexOf(h);(t<0||t>=a)&&e.maximizedChartDef.setValue(e.chartWidgetsDefs[0])}else e.maximizedChartDef.setValue(e.chartWidgetsDefs[0]);else o!==t&&e.maximizedChartDef.value()&&e.maximizedChartDef.setValue(null);h&&e.activeChartWidget.setValue((0,s.ensureNotNull)(h.chartWidget));for(let t=0;t<a||t<e.chartWidgetsDefs.length;t++){
let r,n=e.chartWidgetsDefs[t];const o=t>=a;if(r=e.maximizedChartDef.value()?e.maximizedChartDef.value()===n:t<a,r){if(n){if(e.parent.appendChild(n.container.value()),n.hiddenInLayout.setValue(!1),e.loadingContent){const t=e.savedChartWidgetOptions.shift();t&&(e.setLoadingContent(!0),(0,s.ensureNotNull)(n.chartWidget).loadContent(t.content,e.initialLoading),e.setLoadingContent(!1))}}else Kt(e,i,t,void 0),n=e.chartWidgetsDefs[t];n.container.value().classList.toggle("multiple",a>1),n.fullscreen.setValue(e.maximizedChartDef.value()===n),n.collapsed.setValue(o)}else n?(Zt(n),n.collapsed.setValue(o)):e.isPhoneSize.value()&&e.viewMode.value()===d.CollectionViewMode.ForceFullscreen&&(Kt(e,i,t,void 0),Zt(e.chartWidgetsDefs[t]),e.chartWidgetsDefs[t].collapsed.setValue(o))}e.sizingState.setValue(c),Ut(e),e.layoutWV.setValue(t),e.setLayoutType(t),e.updateWatchedValue(),function(e){const t=e.layoutTemplate.value().count;e.inlineChartsCount.setValue(t),e.globalDetachable.setValue(t>1)}(e),e.checkAllPendingModelsAlreadyCreated(),function(e,t){e.chartWidgetsDefs.forEach((i=>{const r=(0,s.ensureNotNull)(i.chartWidget);r.onZoom().subscribe(t,(t=>e.onZoom.fire(t))),r.onScroll().subscribe(t,(()=>e.onScroll.fire())),r.withModel(null,(()=>{const t=r.lineToolsSynchronizer();null!==t&&(t.hasChanges().subscribe(e.recalcHasChanges),e.recalcHasChanges())}))}))}(e,i),e.initialLoading||e.updateViewMode(),e.inlineChartsCount.value()<1&&a>0&&e.chartWidgetsDefs[a-1].rdState.bridge().attach()}function Qt(e,t,i,s,r){if(!s&&!e.crosshairLockRaw)return!1;const n=e.actualLayoutCount();return e.chartWidgetsDefs.slice(0,n).filter((e=>e.rdState.bridge().visible.value())).map((e=>e.chartWidget)).filter((e=>e.id()!==i&&e.hasModel())).forEach((e=>e.model().model().setExternalPosition(t,r))),!0}function ei(e,t,i,s,r){if(Qt(e,t,i,s,r)){const i=e.crossHairSyncBroadcast;if(i){const e={type:"crosshair",payload:{point:t,envState:r,sourceUniqueId:i.uniqueId}};i.channel.postMessage(e)}}}function ti(e){const t=new BroadcastChannel("ChartWidgetsCollection");return t.onmessage=t=>{const i=t.data,s=e();if(s.crossHairSyncBroadcast&&"crosshair"===i.type)s.crossHairSyncBroadcast.uniqueId!==i.payload.sourceUniqueId&&Qt(s,i.payload.point,null,!1,i.payload.envState)},{channel:t,uniqueId:(0,se.randomHashN)(6)}}function ii(e){var t;null===(t=e.crossHairSyncBroadcast)||void 0===t||t.channel.close()}function si(e,t,i){if(!e.trackTimeLock.value()||e.dateRangeLock.value())return;const s=e.layoutTemplate.value().count;e.undoHistory.beginUndoMacro(rt),e.chartWidgetsDefs.slice(0,s).filter((e=>e.chartWidget.hasModel()&&e.chartWidget.model().model()!==i)).forEach((e=>{const i=e.chartWidget.model().model(),s=i.mainSeries().syncModel();s&&i.syncTimeWithModel(s.syncSourceTarget(),t)})),e.undoHistory.endUndoMacro()}function ri(e){return Promise.all(e.map((e=>{const t=e.model().mainSeries();return t.symbolResolvingActive().value()?h(t.dataEvents().symbolResolved()).promise:t.symbolInfo()})))}function ni(e){
return e.chartWidgetsDefs.every((e=>e.chartWidget.hasModel()))?Promise.resolve(e.chartWidgetsDefs.map((e=>e.chartWidget))):Promise.all(e.chartWidgetsDefs.map((e=>e.chartWidget.hasModel()||h(e.chartWidget.modelCreated()).promise))).then((()=>ni(e)))}function oi(e,t){var i;if((0,c.enabled)("charting_library_base"))return t;if("s"===t||e.widgetOptions.containsData||e.readOnly||isProductFeatureEnabled(ProductFeatures.MULTIPLE_CHARTS)&&(0,s.ensure)(null===(i=getProductFeatureConfig(ProductFeatures.MULTIPLE_CHARTS))||void 0===i?void 0:i.limit)>=R.layouts[t].count)return t;return"s"}async function ai(e,t,i){if(i=oi(e,i),e.layoutWV.value()===i)return!1;const s=e.chartWidgetsDefs.map((e=>{var t,i,s;return null!==(s=null===(i=null===(t=e.chartWidget)||void 0===t?void 0:t.lineToolsSynchronizer())||void 0===i?void 0:i.flushPendingSavings())&&void 0!==s?s:null})).filter(ue.notNull);if(s.length)try{await Promise.all(s)}catch(e){it.logError(`Error flushing line tools: ${e}`)}return e.undoHistory.pushUndoCommand(new de(t,i)),!0}async function li(e,t,i){const{theme:s,onlyActiveChart:r,restoreNonThemeDefaults:n,themeName:o,standardTheme:a,syncState:l=!0,noUndo:c}=i,h=(0,V.getCurrentTheme)().name;let d;r?d=[e.activeChartWidget.value()]:(await Promise.all(e.savedChartWidgetOptions.map(((i,s)=>new Promise((i=>{Zt(Kt(e,t,s,i))}))))),d=e.chartWidgetsDefs.map((e=>e.chartWidget))),c?(a&&new Xe(h,o,l).redo(),d.forEach((e=>{e.model().model().restoreTheme(s,n,c)}))):(e.undoHistory.beginUndoMacro(at),a&&e.undoHistory.pushUndoCommand(new Xe(h,o,l)),d.forEach((e=>{e.model().model().restoreTheme(s,n)})),e.undoHistory.endUndoMacro())}function ci(e,t){e.symbolLock.setValue(t)}function hi(e,t){const{internalSymbolLock:i,activeChartWidget:s,undoHistory:r,chartWidgetsDefs:n,dateRangeLock:o,loadingContent:a}=e;if(t!==i.value())if(a)i.setValue(t);else{if(e.undoHistory.beginUndoMacro(lt),t){const t=s.value(),i=t.getSymbol();for(let s=0;s<n.length;s++){const r=n[s].chartWidget;r!==t&&(r.getSymbol()!==i&&(r.setSymbol(i),o.value()&&e.subscribeToCompletedEventForDateRangeSync(r,!0)))}}r.setWatchedValue(i,t,lt),r.endUndoMacro()}}function di(e,t){e.intervalLock.setValue(t)}function ui(e,t){const{internalIntervalLock:i,activeChartWidget:s,undoHistory:r,chartWidgetsDefs:n,dateRangeLock:o,loadingContent:a}=e;if(t!==i.value())if(a)i.setValue(t);else{if(r.beginUndoMacro(ct),t){const t=s.value(),i=t.getResolution();for(let s=0;s<n.length;s++){const r=n[s].chartWidget;r!==t&&(r.getResolution()!==i&&(r.setResolution(i),o.value()&&e.subscribeToCompletedEventForDateRangeSync(r,!0)))}}r.setWatchedValue(i,t,ct),r.endUndoMacro()}}function pi(e,t){const i=e.activeChartWidget.value();if(i&&i.hasModel()){const s=i.model();t?(e.subscribeToEventsForDateRangeSync(s),e.syncChartsDateRangesWithActiveChartRange()):e.unsubscribeFromEventsForDateRangeSync(s)}e.dateRangeLock.setValue(t)}function _i(e,t){const{internalDateRangeLock:i,undoHistory:s,loadingContent:r}=e;r?i.setValue(t):s.setWatchedValue(i,t,ht)}function mi(e,t){e.trackTimeLock.setValue(t)}function gi(e,t){
const{internalTrackTimeLock:i,undoHistory:s,loadingContent:r}=e;r?i.setValue(t):s.setWatchedValue(i,t,dt)}function fi(e){0}function vi(e,t){}},574570:(e,t,i)=>{"use strict";i.r(t),i.d(t,{setChartFontFamily:()=>r,CHART_FONT_FAMILY:()=>n,CHART_MONOSPACE_FONT_FAMILY:()=>o});const s="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function r(e){n=e}let n=`-apple-system, BlinkMacSystemFont, ${s}`;const o="monospace"},196205:(e,t,i)=>{"use strict";i.d(t,{ensureSettings:()=>h,getUserSettings:()=>l,setUserSettings:()=>c});var s=i(130551);const r="chart.bottom-widgetbar";var n=i(870122),o=i.n(n);const a={activeWidget:"screener",height:320,mode:"minimized"};function l(){return o().getJSON(r)}function c(e){o().setJSON(r,e)}function h(e,t=a){if(!(0,s.isObject)(e))return t;let i=t.activeWidget;(0,s.hasProperty)(e,"activeWidget")&&function(e){if("string"!=typeof e)return!1;return["backtesting","screener","scripteditor","paper_trading"].includes(e)}(e.activeWidget)&&(i=e.activeWidget);let r=t.mode;(0,s.hasProperty)(e,"mode")&&function(e){if("string"!=typeof e)return!1;return["minimized","normal","maximized"].includes(e)}(e.mode)&&(r=e.mode);let n=t.height;return(0,s.hasProperty)(e,"height")&&function(e){return"number"==typeof e&&isFinite(e)}(e.height)&&(n=e.height),{activeWidget:i,mode:r,height:n}}},939654:(e,t,i)=>{"use strict";i.d(t,{BottomWidgetbarBootloader:()=>a});var s=i(939535),r=i(181370),n=i(299023),o=i(196205);class a extends r.ChunkLoader{constructor(e){super(),this._opts=e;const t=(0,o.ensureSettings)({activeWidget:e.defaultActiveWidget,mode:e.mode}),{mode:i,height:r}=this._userSettings=(0,o.ensureSettings)((0,o.getUserSettings)(),t),a=this._opts.resizerBridge,l=a.container.value();switch(i){case"maximized":a.negotiateHeight(a.availHeight.value());break;case"normal":a.negotiateHeight(r+n.footerWidgetHeight);break;case"minimized":a.negotiateHeight(n.footerWidgetHeight)}l.appendChild((0,s.createStubElem)())}_startLoading(){return Promise.all([this._loadBottomWidgetbar(),this._opts.configBootloader.load()]).then((([e,t])=>new e({resizerBridge:this._opts.resizerBridge,chartWidgetCollection:this._opts.chartWidgetCollection,backtestingStrategyDispatcher:this._opts.backtestingStrategyDispatcher,studyMarket:this._opts.studyMarket,widgets:this._opts.widgets,config:t},this._userSettings)))}_loadBottomWidgetbar(){return Promise.all([i.e(283),i.e(4193)]).then(i.bind(i,609379)).then((e=>e.Bottomwidgetbar))}}},845139:(e,t,i)=>{"use strict";i.d(t,{TerminalConfigSetBootloder:()=>r});var s=i(181370);class r extends s.ChunkLoader{_startLoading(){return Promise.all([i.e(5993),i.e(7666),i.e(962),i.e(3884),i.e(8179)]).then(i.bind(i,943349)).then((e=>e.getTerminalConfigSet()))}}},299023:(e,t,i)=>{"use strict";i.d(t,{footerWidgetHeight:()=>s});const s=39},758044:(e,t,i)=>{"use strict";i.d(t,{FooterWidgetBootloader:()=>r});var s=i(181370);class r extends s.ChunkLoader{constructor(e){super(),this._opts=e}_startLoading(){return Promise.all([this._opts.bottomWidgetbarBootloader.load(),this._loadFooterWidget()]).then((([e,t])=>{
const{resizerBridge:i}=this._opts;return new t(e.footerWidgetContainer(),i,e)}))}_loadFooterWidget(){return Promise.all([i.e(7624),i.e(8230),i.e(9333),i.e(8325),i.e(962),i.e(7707)]).then(i.bind(i,566841)).then((e=>e.FooterWidgetRenderer))}}},495999:(e,t,i)=>{"use strict";var s=i(922157);i(251226);var r=i(440097).TranslatedString,n=i(650151),o=n.assert,a=n.ensureDefined,l=i(793713).Series,c=i(484727),h=i(72588).ActionBinder,d=i(870122).setValue,u=i(577535).TabNames,p=i(280813).showGoToDateDialog,_=i(180185),m=i(411589),g=i(793159).Study,f=i(665851).StudyStub,v=i(663890).isStudy,S=i(365897).LineDataSource,y=i(232468),b=y.isLineTool,w=y.isStudyLineTool,P=i(444649).STUDYPLOTDISPLAYTARGET,C=i(710567).Action,T=i(890255).ACTION_ID,x=i(358076),I=i(638273).Interval,M=i(632054),L=M.getDefaultStyle,A=M.hasVolume,k=i(979322).showSymbolInfoDialog,E=i(706486).InvalidationMask,D=i(688401).linking,B=i(538774).showChangeIntervalDialogAsync,V=i(511196).WatchListAction,R=i(928870).showDialog,N=i(968381),O=N.availableTimezones,F=N.timezoneIsAvailable,W=i(812297).toggleHideMode,z=i(898005).StudyMetaInfo,H=i(32133).trackEvent,U=i(242786).lastMouseOrTouchEventInfo,j=i(658363);const{viewportChangeEvent:G}=i(744687),{SelectPointMode:q}=i(358076),{ReplayStatus:$}=i(241731);var Y=i(817808).getLogger("ChartWidget",{color:"#606"}),K=i(21218).appendEllipsis,Z=i(497612).isMultipleLayout,X=i(743180).addPerfMark,J=i(896778).combineProperty,Q=i(886694).ChartWidgetBase,ee=i(601227).CheckMobile.any(),te=i(820402).TIMEFRAMETYPE,ie=i(114122).createDeferredPromise,se=i(831809).addPlusButtonProperty;const re=c.enabled("show_average_close_price_line_and_label");var ne=new r("change timezone",i(509806).t(null,void 0,i(820505))),oe=new r("scale price chart only",i(509806).t(null,void 0,i(599042))),ae=new r("stay in drawing mode",i(509806).t(null,void 0,i(52010))),le=(new r("hide all drawing tools",i(509806).t(null,void 0,i(454781))),new r("hide marks on bars",i(509806).t(null,void 0,i(744974)))),ce=new r("change symbol last value visibility",i(509806).t(null,void 0,i(253150))),he=new r("change symbol previous close value visibility",i(509806).t(null,void 0,i(112707))),de=new r("change previous close price line visibility",i(509806).t(null,void 0,i(259883))),ue=new r("change symbol labels visibility",i(509806).t(null,void 0,i(109402))),pe=new r("change indicators name labels visibility",i(509806).t(null,void 0,i(387027))),_e=new r("change indicators value labels visibility",i(509806).t(null,void 0,i(114922))),me=new r("change bid and ask labels visibility",i(509806).t(null,void 0,i(805100))),ge=new r("change bid and ask lines visibility",i(509806).t(null,void 0,i(432311))),fe=(new r("change pre/post market price label visibility",i(509806).t(null,void 0,i(549889))),new r("change pre/post market price line visibility",i(509806).t(null,void 0,i(16750))),
new r("change high and low price lines visibility",i(509806).t(null,void 0,i(992556)))),ve=new r("change high and low price labels visibility",i(509806).t(null,void 0,i(466805))),Se=new r("change average close price line visibility",i(509806).t(null,void 0,i(498866))),ye=new r("change average close price label visibility",i(509806).t(null,void 0,i(739402))),be=new r("change countdown to bar close visibility",i(509806).t(null,void 0,i(58108))),we=new r("change plus button visibility",i(509806).t(null,void 0,i(450190))),Pe=new r("change price line visibility",i(509806).t(null,void 0,i(867761))),Ce=new r("unlock {title}",i(509806).t(null,void 0,i(192421))),Te=new r("lock {title}",i(509806).t(null,void 0,i(850193))),xe=new r("change session breaks visibility",i(509806).t(null,void 0,i(115403))),Ie=i(509806).t(null,void 0,i(615241)),Me=i(509806).t(null,void 0,i(529404)),Le=i(509806).t(null,void 0,i(844302)),Ae=i(509806).t(null,void 0,i(994338));e.exports.ChartWidget=class extends Q{constructor(e,t,i){super(e,t,i),this._options.timeScaleWidget&&(this._options.timeScaleWidget.pressedMouseMoveScale=this._options.handleScale.axisPressedMouseMove.time);var r=this,n=this._options.content,o=this._options.readOnly;this._removeMaximizeHotkey=null,r._hotkeys=m.createGroup({desc:"Chart actions",isDisabled:function(){return!r._isActive}});var a=this._options.containsData,l=this._options.onWidget,c=this._options.onCmeWidget;c&&Y.logWarn("[ChartWidget] 'onCmeWidget' option is depricated");var h=this._options.widgetCustomer,d=this._options.timezone,u=this._options.hideSymbolSearch,p=this._options.defSymbol,_=I.isValid(this._options.defInterval)?this._options.defInterval:void 0,g=parseInt(this._options.defStyle),f=M.isValidStyle(g)?g:void 0,v=this._options.defSessionId,S=void 0!==this._options.defTimeframe?"string"==typeof this._options.defTimeframe?{value:this._options.defTimeframe.toUpperCase(),type:te.PeriodBack}:{...this._options.defTimeframe,type:te.TimeRange}:void 0;this._content=n,this._initialLoading=this._options.initialLoading,this._readOnly=o,this._containsData=a,this._defSymbol=p,this._defInterval=_,this._defTimeframe=S,this._defStyle=f,this._onWidget=!!l,this._compareSymbols=this._options.compareSymbols,this._onWidget&&(c?this._widgetCustomer="cme":h&&(this._widgetCustomer=h)),this._hideSymbolSearch=u,this._frameTime=30,this._model=null,this._metaInfo={},this._drawRafId=0,this._compareDialog=this._chartWidgetCollection.getCompareDialogRenderer();var y=this._contentSeriesProperties();y&&(p=y.symbol,_=y.interval),void 0===this._options.useUserChartPreferences&&(this._options.useUserChartPreferences=!0);var b="chartproperties.mainSeriesProperties",w=this._options.useUserChartPreferences?j.defaults(b):j.factoryDefaults(b);this._properties.mainSeriesProperties.merge(w),this._properties.mainSeriesProperties.hasChild("esdBreaksStyle")&&this._properties.mainSeriesProperties.removeProperty("esdBreaksStyle"),_=_||w.interval||"D",M.isValidStyle(f)||(f=M.isValidStyle(w.style)?w.style:L(I.isRange(_))),
this._properties.mainSeriesProperties.merge({visible:!0,symbol:p||DEFAULT_SYMBOL,shortName:"",timeframe:"",onWidget:this._onWidget,interval:_,currencyId:null,unitId:null,style:f,sessionId:v,lineStyle:{styleType:j.factoryDefaults("chartproperties.mainSeriesProperties.lineStyle.styleType")}}),this._containsData&&this._properties.mainSeriesProperties.merge({showCountdown:!1}),d&&F(d)&&this._properties.timezone.setValue(d),this._tagsChanged=new s,this._timingsMeter=null,this._isActive=this._options.isActive,this._options.container.subscribe((function(e){r._setElement(e)}),{callWithLast:!0});var P=function(){r.resize()};this._options.width.subscribe(P),this._options.height.subscribe(P),this._options.visible.subscribe(this._updateTimingsMeterState.bind(this)),this._aboutToBeDestroyed=new s,this._actions=null,this._definitionsViewModel=null,this._backgroundTopColorSpawn=null,this._backgroundBottomColorSpawn=null,this._hintDefferedPromise=null,this._activeHint=null}isInitialized(){return Boolean(this._inited)}compareSymbols(){return this._compareSymbols}async _getChartPropertyDefinitionsViewModel(){if(null===this._definitionsViewModel){const{ChartPropertyDefinitionsViewModel:e}=await Promise.all([i.e(3623),i.e(8094),i.e(7214),i.e(7358),i.e(3596)]).then(i.bind(i,48278));if(this._isDestroyed)throw new Error("Chart widget already destroyed");await new Promise((e=>this.withModel(null,e))),null===this._definitionsViewModel&&(this._definitionsViewModel=new e(this.model(),this.properties(),this._options))}return this._definitionsViewModel}_initMaximizeHotkey(e){var t=this;function i(e){e.defaultPrevented||_.modifiersFromEvent(e)===_.Modifiers.Alt&&e.stopPropagation()}function s(e){e.defaultPrevented||_.modifiersFromEvent(e)===_.Modifiers.Alt&&(e.preventDefault(),e.stopPropagation(),t.toggleFullscreen())}return e.addEventListener("mousedown",i,!0),e.addEventListener("click",s,!0),function(){e.removeEventListener("mousedown",i,!0),e.removeEventListener("click",s,!0)}}toggleFullscreen(){var e=this.getResizerDetacher();e.fullscreenable.value()&&(e.fullscreen.value()?e.exitFullscreen():e.requestFullscreen())}_beginRequestActive(){var e=this._chartWidgetCollection.activeChartWidget.value()!==this;if(this._chartWidgetCollection.activeChartWidget.setValue(this),e){const e=U();e.isTouch&&!e.stylus&&this._isLineToolModeExceptBrush()&&this.updateCrossHairPositionIfNeeded(),this._justActivated=!0}}_endRequestActive(){var e=this;this._justActivated&&setTimeout((function(){e._justActivated=!1}),0)}_requestActive(){this._beginRequestActive(),this._endRequestActive()}justActivated(){return this._justActivated}setTimezone(e){e&&F(e)?this._properties.timezone.setValue(e):console.warn("Incorrect timezone: "+JSON.stringify(e))}getTimezone(){return this._properties.timezone.value()}refreshMarks(){this.model().barsMarksSources().forEach((function(e){e.refreshData()}))}clearMarks(e){this.model().barsMarksSources().forEach((function(t){t.clearMarks(e)}))}metaInfoRepository(){return this._metaInfoRepository}_initBackgroundColor(){
null===this._backgroundTopColorSpawn&&(this._backgroundTopColorSpawn=this._model.model().backgroundTopColor().spawn(),this._backgroundTopColorSpawn.subscribe(this._onBackgroundColorChanged.bind(this))),null===this._backgroundBottomColorSpawn&&(this._backgroundBottomColorSpawn=this._model.model().backgroundColor().spawn(),this._backgroundBottomColorSpawn.subscribe(this._onBackgroundColorChanged.bind(this)))}paneWidgets(){return this._paneWidgets}paneByCanvas(e){for(var t=0;t<this._paneWidgets.length;t++)if(this._paneWidgets[t].hasCanvas(e))return this._paneWidgets[t];return null}paneByState(e){for(var t=0;t<this._paneWidgets.length;t++)if(this._paneWidgets[t].state()===e)return this._paneWidgets[t];return null}timeAxisByCanvas(e){return this._timeAxisWidget.hasCanvas(e)?this._timeAxisWidget:null}properties(){return this._properties}readOnly(){return this._readOnly}onRedraw(){return this._redraw}modelCreated(){return this._modelCreated}updateActions(){for(var e=this.actions(),t=this._model.dataSources(),s=!1,r=!1,n=0,o=t.length;n<o;n++){var a=t[n];TradingView.isInherited(a.constructor,S)&&a.isUserDeletable()&&(s=!0),TradingView.isInherited(a.constructor,g)&&a.removeByRemoveAllStudies()&&(r=!0),TradingView.isInherited(a.constructor,f)&&(r=!0)}this._readOnly||(e.paneRemoveAllStudies&&e.paneRemoveAllStudies.update({disabled:!r}),e.paneRemoveAllDrawingTools&&e.paneRemoveAllDrawingTools.update({disabled:!s}),e.paneRemoveAllStudiesDrawingTools&&e.paneRemoveAllStudiesDrawingTools.update({disabled:!r&&!s}));var l=this,c=[],h=function(e){return e.id===l.model().model().properties().timezone.value()};O.forEach((function(e){if(!e.separator){var t=new C({actionId:T.ChartChangeTimeZone,label:e.title,checkable:!0,checked:h(e),statName:"SetTimeZone",onExecute:function(){l.model().setProperty(l.model().model().properties().timezone,e.id,ne)}});c.push(t)}}),this),e.applyTimeZone.update({subItems:c}),e.addToWatchlist&&(e.addToWatchlist.request(),e.addToWatchlist.updateLabel(this.getSymbol(!0))),e.addToTextNotes&&e.addToTextNotes.update({label:i(509806).t(null,void 0,i(134810)).format({symbol:this.getSymbol(!0)})}),e.moveChartAction&&e.moveChartAction.update({disabled:!this._chartWidgetCollection.activeChartCanBeMoved()})}actions(){return null===this._actions&&this._setActions(),this._actions}_setActions(){this._actions&&this._actions.addToWatchlist&&(this._actions.addToWatchlist.destroy(),delete this._actions.addToWatchlist);var e=this;this._hotkeys.add({desc:"Maximize",hotkey:m.Modifiers.Alt+13,handler:function(){e.toggleFullscreen()},isDisabled:function(){return!e._options.fullscreenable.value()}}),this._hotkeys.add({desc:"Cancel selection",hotkey:27,handler:function(){0===e.selectPointMode().value()?e._model.selectionMacro((function(t){e._cancelCreatingLine(),t.clearSelection()})):e.cancelRequestSelectPoint()},isDisabled:function(){var t=0===e._model.selection().allSources().length,i=null===e._model.crossHairSource().measurePane().value(),s=0===e.selectPointMode().value(),r=t&&i&&s;return!e._model||r}}),e.withModel(null,(function(){
var t=function(){e._hotkeys.promote()};e._model.onSelectedSourceChanged().subscribe(null,t),e._model.crossHairSource().measurePane().subscribe((e=>{null!==e&&t()}))}));var t=new C({actionId:T.ChartScalesReset,label:i(509806).t(null,void 0,i(834301)),icon:i(139267),statName:"ResetChart",onExecute:this.GUIResetScales.bind(this),hotkeyGroup:this._hotkeys,hotkeyHash:m.Modifiers.Alt+82}),s=new C({actionId:T.ChartSeriesPriceScaleToggleInvertPriceScale,label:i(509806).t(null,void 0,i(353239)),statName:"Invert Scale",checkable:!0,onExecute:function(){e._model.invertPriceScale(e._model.mainSeries().priceScale())},hotkeyGroup:this._hotkeys,hotkeyHash:m.Modifiers.Alt+73}),r=new C({actionId:T.ChartSeriesPriceScaleToggleAutoScale,label:i(509806).t(null,void 0,i(550834)),checkable:!0,onExecute:function(){var t=e._model.mainSeries().priceScale();e._model.togglePriceScaleAutoScaleMode(t),r.update({checked:t.isAutoScale()})}}),n=new C({actionId:T.ChartScalesToggleLockPriceToBarRatio,label:i(509806).t(null,void 0,i(518219)),checkable:!0,statName:"ToggleLockScale",onExecute:function(){e._model.togglePriceScaleLockScaleMode(e._model.mainSeries().priceScale())}}),o=new C({actionId:T.ChartSeriesPriceScaleToggleRegular,label:i(509806).t(null,{context:"scale_menu"},i(172116)),checkable:!0,statName:"ToggleRegularScale",onExecute:function(){var t=e._model.mainSeries().priceScale();e._model.setPriceScaleRegularScaleMode(t),o.update({checked:t.isRegular()})}}),a=new C({actionId:T.ChartSeriesPriceScaleTogglePercentage,label:i(509806).t(null,void 0,i(351102)),checkable:!0,statName:"TogglePercantage",onExecute:function(){e._model.togglePriceScalePercentageScaleMode(e._model.mainSeries().priceScale())},hotkeyGroup:this._hotkeys,hotkeyHash:m.Modifiers.Alt+80}),l=new C({actionId:T.ChartSeriesPriceScaleToggleIndexedTo100,label:i(509806).t(null,void 0,i(520062)),checkable:!0,statName:"ToggleIndexedTo100",onExecute:function(){e._model.togglePriceScaleIndexedTo100ScaleMode(e._model.mainSeries().priceScale())}}),g=new C({actionId:T.ChartSeriesPriceScaleToggleLogarithmic,label:i(509806).t(null,void 0,i(512285)),statName:"ToggleLogScale",checkable:!0,onExecute:function(){e._model.togglePriceScaleLogScaleMode(e._model.mainSeries().priceScale())},hotkeyGroup:this._hotkeys,hotkeyHash:m.Modifiers.Alt+76}),f=new C({actionId:T.ChartUndo,label:i(509806).t(null,void 0,i(881320)),onExecute:function(){H("GUI","Undo"),e._model.undoHistory().undo()},disabled:!0,hotkeyGroup:this._hotkeys,hotkeyHash:m.Modifiers.Mod+90}),v=new C({actionId:T.ChartRedo,label:i(509806).t(null,void 0,i(641615)),onExecute:function(){H("GUI","Redo"),e._model.undoHistory().redo()},disabled:!0,hotkeyGroup:this._hotkeys,hotkeyHash:m.Modifiers.Mod+89});e.withModel(null,(function(){e._model.undoHistory().undoStack().onChange().subscribe(e,e.updateUndoRedo),e._model.undoHistory().redoStack().onChange().subscribe(e,e.updateUndoRedo)}));var S=new C({actionId:T.ChartChangeTimeZone,label:i(509806).t(null,void 0,i(164375)),statName:"TimeZone"}),y=new C({actionId:T.ChartDialogsShowChangeSymbol,
label:K(i(509806).t(null,void 0,i(128089))),statName:"ChangeSymbol",onExecute:function(){R({defaultValue:""})}});d("symboledit.dialog_last_entry","");var b={actionId:T.ChartDialogsShowChangeInterval,label:K(i(509806).t(null,void 0,i(699374))),statName:"ChangeInterval",onExecute:function(){B({initVal:D.interval.value(),selectOnInit:!0})}};!c.enabled("show_interval_dialog_on_key_press")||this.readOnly()||this._hideSymbolSearch||(b.shortcutHint=",",b.hotkeyGroup=this._hotkeys,b.hotkeyHash=188);var w,P=new C(b);if(!TradingView.onWidget()){if(this._options.addToWatchlistEnabled){const e={hotkeyGroup:this._hotkeys};w=new V(this,e)}0}var I=new C({actionId:T.ChartTimeScaleReset,label:i(509806).t(null,void 0,i(825333)),icon:i(139267),statName:"ResetScale",onExecute:function(){e.model().resetTimeScale()},hotkeyGroup:this._hotkeys,hotkeyHash:m.Modifiers.Mod+m.Modifiers.Alt+81}),M=new C({actionId:T.ChartRemoveAllIndicators,label:i(509806).t(null,void 0,i(413951)),statName:"RemoveAllIndicators",onExecute:this.removeAllStudies.bind(this)}),L=new C({actionId:T.ChartRemoveAllLineTools,label:i(509806).t(null,void 0,i(801434)),statName:"RemoveAllDrawingTools",onExecute:this.removeAllDrawingTools.bind(this)}),A=new C({actionId:T.ChartRemoveAllIndicatorsAndLineTools,label:i(509806).t(null,void 0,i(897305)),statName:"RemoveAllIndicatorsAndDrawingTools",onExecute:this.removeAllStudiesDrawingTools.bind(this)}),N=this.chartWidgetCollection(),O=new C({actionId:T.ChartApplyIndicatorsToAllCharts,label:i(509806).t(null,void 0,i(295910)),statName:"ApplyIndicatorsToAllCharts",onExecute:function(){N.applyIndicatorsToAllCharts(e)}}),F={actionId:T.ChartDialogsShowInsertIndicators,label:K(i(509806).t(null,void 0,i(398767))),statName:"InsertIndicator",onExecute:function(){e.showIndicators()}};this._options.indicatorsDialogShortcutEnabled&&(F.hotkeyGroup=this._hotkeys,F.hotkeyHash=191,this._hotkeys.add({handler:function(){this.showIndicators()}.bind(this),desc:"Show insert indicator dialog",hotkey:111}));var z,U=new C(F),j=new C({actionId:T.ChartDialogsShowCompareOrAddSymbol,label:K(i(509806).t(null,void 0,i(220229))),statName:"CompareOrAddSymbol",onExecute:this.toggleCompareOrAdd.bind(this)}),q=new C({actionId:T.ChartObjectTreeShow,label:K(i(509806).t(null,void 0,i(500675))),statName:"ObjectsTree",onExecute:this.showObjectsTreePanelOrDialog.bind(this)}),$=new C({actionId:T.ChartDialogsShowGeneralSettings,label:K(i(509806).t(null,void 0,i(389517))),icon:i(951983),statName:"ChartProperties",onExecute:function(){e.showGeneralChartProperties()}}),Y=new C({actionId:T.ChartDialogsShowGeneralSettingsSymbolTab,label:K(i(509806).t(null,void 0,i(389517))),icon:i(951983),statName:"MainSeriesProperties",onExecute:function(){e.showGeneralChartProperties(u.symbol)}}),Z=new C({actionId:T.ChartSelectedObjectToggleLocked,label:i(509806).t(null,void 0,i(101441)),statName:"ToggleLockSelectedObject",onExecute:this.toggleLockSelectedObject.bind(this)}),X=new C({actionId:T.ChartSelectedObjectHide,label:i(509806).t(null,void 0,i(831971)),icon:i(484959),
statName:"HideSelectedObject",onExecute:this.hideSelectedObject.bind(this)});c.enabled("property_pages")&&(z=new C({actionId:T.ChartSelectedObjectShowSettingsDialog,label:K(i(509806).t(null,void 0,i(389517))),icon:i(951983),statName:"EditSelectedObject",onExecute:function(){e.showSelectedSourcesProperties()}})),this.withModel(null,(function(){var t=e.model().mainSeries(),i=t.properties();i.priceAxisProperties.subscribe(e,e._updateScalesActions),t.priceScaleAboutToBeChanged().subscribe(e,(function(){i.priceAxisProperties.unsubscribeAll(e)})),t.priceScaleChanged().subscribe(e,(function(){i.priceAxisProperties.subscribe(e,e._updateScalesActions),e._updateScalesActions()}))}));var Q=new C({actionId:T.ChartPriceScaleToggleAutoScaleSeriesOnly,label:i(509806).t(null,void 0,i(937207)),checkable:!0,statName:"ScalePriceChartOnly"});Q.binder=new h(Q,this._properties.scalesProperties.scaleSeriesOnly,this.model(),oe);var ee=this.model().model();this._properties.scalesProperties.scaleSeriesOnly.listeners().subscribe(null,(function(){ee.recalculateAllPanes(G()),ee.invalidate(E.full())}));var te=new C({actionId:T.ChartDrawingToolbarToggleVisibility,label:i(509806).t(null,void 0,i(222903)),checkable:!0,statName:"ToggleDrawingToolbar"}),ie=this._options.isDrawingToolbarVisible;ie&&(ie.subscribe((function(e){te.update({checked:e})}),{callWithLast:!0}),te.update({onExecute:function(){ie.setValue(!ie.value())}}));var ne=new C({actionId:"",label:i(509806).t(null,void 0,i(593161)),checkable:!0,statName:"ToggleStayInDrawingMode"});ne.binder=new h(ne,x.properties().stayInDrawingMode,this.model(),ae),this._hotkeys.add({handler:function(){W()},desc:"Hide all drawing tools",hotkey:m.Modifiers.Mod+m.Modifiers.Alt+72});var Ce=new C({actionId:T.ChartMarksToggleVisibility,label:i(509806).t(null,void 0,i(2441)),checkable:!0,statName:"ToggleHideMarksOnBars"});Ce.binder=new h(Ce,x.hideMarksOnBars(),this.model(),le,(function(){x.hideMarksOnBars().setValue(this.value())}));const Te=this.properties().scalesProperties;var xe=new C({actionId:T.ChartPriceScaleLabelsToggleSeriesLastValueVisibility,label:i(509806).t(null,void 0,i(752054)),checkable:!0,checked:!1,statName:"ToggleSymbolLastValue"});xe.binder=new h(xe,Te.showSeriesLastValue,this.model(),ce);var ke=new C({actionId:T.ChartPriceScaleLabelsToggleSymbolPrevCloseValueVisibility,label:i(509806).t(null,void 0,i(590537)),checkable:!0,checked:!1,statName:"ToggleSymbolPrevCloseValue"});ke.binder=new h(ke,Te.showSeriesPrevCloseValue,this.model(),he);var Ee=new C({actionId:T.ChartLinesToggleSeriesPrevCloseLineVisibility,label:i(509806).t(null,void 0,i(336857)),checkable:!0,checked:!1,statName:"ToggleSymbolPrevCloseLine"});Ee.binder=new h(Ee,this.model().mainSeries().properties().showPrevClosePriceLine,this.model(),de),this.model().mainSeries().onRestarted().subscribe(this,(function(){this.updateActionForIntradayOnly(ke),this.updateActionForIntradayOnly(Ee)}));var De=new C({actionId:T.ChartPriceScaleLabelsToggleSymbolNameLabelsVisibility,label:i(509806).t(null,void 0,i(390932)),checkable:!0,checked:!1,
statName:"ToggleSymbolLabels"});De.binding=new h(De,Te.showSymbolLabels,this.model(),ue);const Be=J(((e,t)=>e||!1),Te.showStudyLastValue,Te.showFundamentalLastValue);var Ve=new C({actionId:T.ChartPriceScaleLabelsToggleIndicatorsValueLabelsVisibility,label:i(509806).t(null,void 0,i(581584)),checkable:!0,checked:!1,statName:"ToggleStudiesAndFundamentalsPriceLabels"});Ve.binder=new h(Ve,Be,this.model(),null,(()=>{const e=!Be.value();this.model().beginUndoMacro(_e),this.model().setProperty(Te.showStudyLastValue,e,null),this.model().endUndoMacro()}));const Re=J(((e,t)=>e||!1),Te.showStudyPlotLabels,Te.showFundamentalNameLabel);var Ne=new C({actionId:T.ChartPriceScaleLabelsToggleIndicatorsNameLabelsVisibility,label:i(509806).t(null,void 0,i(531485)),checkable:!0,checked:!1,statName:"ToggleStudiesAndFundamentalsNameLabels"});Ne.binding=new h(Ne,Re,this.model(),null,(()=>{const e=!Re.value();this.model().beginUndoMacro(pe),this.model().setProperty(Te.showStudyPlotLabels,e,null),this.model().endUndoMacro()}));var Oe=new C({actionId:T.ChartPriceScaleLabelsToggleBidAskLabelsVisibility,label:i(509806).t(null,void 0,i(665287)),checkable:!0,checked:!1,statName:"ToggleBidAskLabels"});Oe.binding=new h(Oe,Te.showBidAskLabels,this.model(),me);var Fe=new C({actionId:T.ChartLinesToggleBidAskLinesVisibility,label:i(509806).t(null,void 0,i(240548)),checkable:!0,checked:!1,statName:"ToggleBidAskLines"});Fe.binding=new h(Fe,this.model().mainSeries().properties().bidAsk.visible,this.model(),ge);var We=this.model().mainSeries().properties().highLowAvgPrice,ze=new C({actionId:T.ChartPriceScaleLabelsToggleHighLowPriceLabelsVisibility,label:i(509806).t(null,void 0,i(953150)),checkable:!0,checked:!1,statName:"ToggleHighLowPriceLabels"});ze.binding=new h(ze,We.highLowPriceLabelsVisible,this.model(),ve);var He=new C({actionId:T.ChartLinesToggleHighLowLinesVisibility,label:i(509806).t(null,void 0,i(321803)),checkable:!0,checked:!1,statName:"ToggleHighLowPriceLine"});if(He.binding=new h(He,We.highLowPriceLinesVisible,this.model(),fe),re){var Ue=new C({actionId:T.ChartPriceScaleLabelsToggleAveragePriceLabelVisibility,label:i(509806).t(null,void 0,i(8975)),checkable:!0,checked:!1,statName:"ToggleAverageClosePriceLabel"});Ue.binding=new h(Ue,We.averageClosePriceLabelVisible,this.model(),ye);var je=new C({actionId:T.ChartLinesToggleAverageLineVisibility,label:i(509806).t(null,void 0,i(187899)),checkable:!0,checked:!1,statName:"ToggleAverageClosePriceLine"});je.binding=new h(je,We.averageClosePriceLineVisible,this.model(),Se)}var Ge=new C({actionId:T.ChartPriceScaleToggleCountdownToBarCloseVisibility,label:i(509806).t(null,void 0,i(894370)),checkable:!0,checked:!1,statName:"ToggleCountdown"});Ge.binder=new h(Ge,this.model().mainSeries().properties().showCountdown,this.model(),be);var qe=new C({actionId:T.ChartPriceScaleToggleAddOrderPlusButtonVisibility,label:i(509806).t(null,void 0,i(897378)),checkable:!0,checked:se.value(),statName:"ToggleAddOrderPlusButton"});qe.binder=new h(qe,se,this.model(),we);var $e=null;this._options.goToDateEnabled&&($e=new C({
actionId:T.ChartDialogsShowGoToDate,label:K(i(509806).t(null,void 0,i(475190))),statName:"GoToDate",onExecute:function(){var t=e._chartWidgetCollection.activeChartWidget.value();p(t)},hotkeyGroup:this._hotkeys,hotkeyHash:m.Modifiers.Alt+71}));var Ye,Ke=new C({actionId:T.ChartDialogsShowSymbolInfo,label:K(i(509806).t(null,void 0,i(665986))),icon:i(437924),checkable:!1,statName:"SymbolInfo",onExecute:function(){var t=e.model().model(),i=t.mainSeries().symbol(),s=t.mainSeries().symbolInfo(),r=t.availableUnits(),n={symbolInfo:s,showUnit:t.unitConversionEnabled(),unitDescription:e=>r.description(e),dateFormatter:t.dateFormatter()};k(i,n)}}),Ze=new C({actionId:T.ChartPriceScaleMergeAllScalesToLeft,label:Ie,statName:"MergeAllScalesToLeft",onExecute:function(){e.model().mergeAllScales("left")}}),Xe=new C({actionId:T.ChartPriceScaleMergeAllScalesToRight,label:Me,statName:"MergeAllScalesToRight",onExecute:function(){e.model().mergeAllScales("right")}}),Je=new C({actionId:T.ChartPriceScaleMoveToLeft,label:Le,statName:"MoveScaleToLeft",onExecute:function(){e.model().mergeAllScales("left")}}),Qe=new C({actionId:T.ChartPriceScaleMoveToRight,label:Ae,statName:"MoveScaleToRight",onExecute:function(){e.model().mergeAllScales("right")}});Ye=new C({actionId:T.ChartMoveChartInLayout,label:i(509806).t(null,void 0,i(456462)),subItems:[new C({actionId:T.ChartMoveChartInLayoutForward,label:i(509806).t(null,void 0,i(472781)),statName:"MoveChartRight",onExecute:function(){e._chartWidgetCollection.moveActiveChartWithUndo(!1)}}),new C({actionId:T.ChartMoveChartInLayoutBack,label:i(509806).t(null,void 0,i(762592)),statName:"MoveChartLeft",onExecute:function(){e._chartWidgetCollection.moveActiveChartWithUndo(!0)}})]});var et=c.enabled("show_object_tree");if(this._actions={chartProperties:$,mainSeriesPropertiesAction:Y,timeScaleReset:I,chartReset:t,invertSeriesScale:s,logSeriesScale:g,autoSeriesScale:r,lockSeriesScale:n,regularSeriesScale:o,percentSeriesScale:a,indexedTo100SeriesScale:l,compareOrAdd:j,paneObjectTree:et?q:void 0,insertIndicator:U,symbolSearch:y,showSymbolInfoDialog:Ke,changeInterval:P,seriesHide:X,studyHide:X,lineToggleLock:Z,lineHide:X,scaleSeriesOnly:Q,drawingToolbarAction:te,stayInDrawingModeAction:ne,hideAllMarks:Ce,applyTimeZone:S,showCountdown:Ge,addPlusButton:qe,showSeriesLastValue:xe,showSeriesPrevCloseValue:ke,showSeriesPrevCloseLine:Ee,showBidAskLabels:Oe,showBidAskLines:Fe,showHighLowPriceLabels:ze,showHighLowPriceLines:He,showAverageClosePriceLabel:Ue,showAverageClosePriceLine:je,showSymbolLabelsAction:De,showStudyLastValue:Ve,showStudyPlotNamesAction:Ne,undo:f,redo:v,mergeLeftScalesAction:Ze,mergeRightScalesAction:Xe,moveScaleToLeft:Je,moveScaleToRight:Qe,moveChartAction:Ye},w&&(this._actions.addToWatchlist=w),!TradingView.onWidget()&&c.enabled("text_notes")&&(this._actions.addToTextNotes=undefined),null!==$e&&(this._actions.gotoDate=$e),this.createSessionBreaksActions(),!this.readOnly()){var tt=new C({actionId:T.ChartSelectedObjectRemove,label:i(509806).t(null,void 0,i(734596)),icon:i(535149),
statName:"RemoveSelectedObject",onExecute:function(){var e=this._chartWidgetCollection.activeChartWidget.value();e||(e=this),e.removeSelectedSources()}.bind(this),hotkeyGroup:this._hotkeys,hotkeyHash:_.isMacKeyboard?8:46});this._hotkeys.add({handler:function(){this.removeSelectedSources()}.bind(this),desc:"Remove selected source",hotkey:_.isMacKeyboard?46:8}),this._actions.paneRemoveAllStudies=M,this._actions.paneRemoveAllDrawingTools=L,this._actions.paneRemoveAllStudiesDrawingTools=A,this._actions.applyStudiesToAllCharts=O,this._actions.studyRemove=tt,this._actions.lineRemove=tt,c.enabled("property_pages")&&(this._actions.format=z)}this._actions.showPriceLine=new C({actionId:T.ChartLinesToggleSeriesPriceLineVisibility,label:i(509806).t(null,void 0,i(491492)),checkable:!0,statName:"TogglePriceLine"}),this._actions.showPriceLine.binding=new h(this._actions.showPriceLine,this.model().mainSeries().properties().showPriceLine,this.model(),Pe),this.readOnly()||(this._hotkeys.add({desc:"Draw Horizontal Line here",hotkey:m.Modifiers.Alt+72,handler:function(){e.activePaneWidget&&e.activePaneWidget.drawRightThere("LineToolHorzLine")}}),this._hotkeys.add({desc:"Draw Horizontal Ray here",hotkey:m.Modifiers.Alt+74,handler:function(){e.activePaneWidget&&e.activePaneWidget.drawRightThere("LineToolHorzRay")}}),this._hotkeys.add({desc:"Draw Vertical Line here",hotkey:m.Modifiers.Alt+86,handler:function(){e.activePaneWidget&&e.activePaneWidget.drawRightThere("LineToolVertLine")}}),this._hotkeys.add({desc:"Draw Cross Line here",hotkey:m.Modifiers.Alt+67,handler:function(){e.activePaneWidget&&e.activePaneWidget.drawRightThere("LineToolCrossLine")}}),this._hotkeys.add({desc:"Draw Trend Line",hotkey:m.Modifiers.Alt+84,handler:function(){e.activePaneWidget&&x.tool.setValue("LineToolTrendLine")}}),this._hotkeys.add({desc:"Draw Fib Retracement",hotkey:m.Modifiers.Alt+70,handler:function(){e.activePaneWidget&&x.tool.setValue("LineToolFibRetracement")}})),this._updateScalesActions()}options(){return this._options}executeActionById(e){if("takeScreenshot"===e)return console.warn('Action "takeScreenshot" is deprecated. Use method "takeScreenshot" instead'),void this._chartWidgetCollection.takeScreenshot();e in this._actions?this._actions[e]instanceof C&&this._actions[e].execute():console.warn("Unknown action id: "+e)}getCheckableActionState(e){if(e in this._actions){var t=this._actions[e];if(t instanceof C&&t.isCheckable())return t.isChecked();console.warn("Action "+e+" has no state")}else console.warn("Unknown action id: "+e);return null}_updateScalesActions(){if(null!==this._actions){var e=this.model().mainSeries(),t=e.priceScale(),i=e.properties(),s=t.isLockScale(),r=i.style.value()===l.STYLE_PNF;this._actions.percentSeriesScale.update({disabled:s||r,checked:t.isPercentage()}),this._actions.logSeriesScale.update({disabled:s||r,checked:t.isLog()}),this._actions.regularSeriesScale.update({disabled:s||r,checked:t.isRegular()}),this._actions.indexedTo100SeriesScale.update({disabled:s||r,checked:t.isIndexedTo100()}),
this._actions.invertSeriesScale.update({checked:t.isInverted()}),this._actions.lockSeriesScale.update({checked:t.isLockScale()}),this._actions.autoSeriesScale.update({checked:t.isAutoScale(),disabled:t.properties().autoScaleDisabled.value()})}}removeAllStudies(){this._model.removeAllStudies()}removeAllDrawingTools(){this._model.removeAllDrawingTools()}removeAllStudiesDrawingTools(){this._model.removeAllStudiesAndDrawingTools()}defaultSymbol(){return this._defSymbol}widget(){return this._mainDiv}_onBackgroundColorChanged(){for(var e=0;e<this._paneWidgets.length;e++)this._paneWidgets[e].setCursorForTool();this.update(),this.model().model().fullUpdate()}setTimingsMeter(e){this._timingsMeter=e,this._updateTimingsMeterState()}ownerDocument(){return this._parent.ownerDocument}_updateTimingsMeterState(){var e=this._options.visible.value();null!==this._timingsMeter&&(e?this._timingsMeter.startCollect():this._timingsMeter.stopCollect())}_createVolumeIfNeeded(){var e=c.enabled("create_volume_indicator_by_default")&&this._options.addVolume,t=!this._content,i=c.enabled("charting_library_base"),s=c.enabled("create_volume_indicator_by_default_once"),r=this._content&&!this._content.loading;e&&(t||i&&r&&!s)&&this._model.mainSeries().dataEvents().symbolResolved().subscribe(this,(function(){var e=this;setTimeout((function(){var t=e._model.model().mainSeries().symbolInfo();if(t){var i=A(t);if(!e.containsVolume()&&i){var s=j.factoryDefaults("chartproperties.volumePaneSize"),r=e._model.model().createStudyInserter({type:"java",studyId:"Volume@tv-basicstudies"});r.setForceOverlay(c.enabled("volume_force_overlay")),r.setPaneSize(s),c.enabled("hide_volume_ma")&&r.setPropertiesState({styles:{vol_ma:{display:P.None}}}),r.insert()}else if(!i&&e.containsVolume()){var n=e.model().dataSources().filter((function(e){return e instanceof g&&"Volume"===e.metaInfo().shortId}))[0];e._model.model().removeSource(n)}}}),0)}),s)}_createSessions(e){var t=this.showGeneralChartProperties.bind(this,u.timezoneSessions);e.createSessions(t)}_createPrePostMarket(e){}_onChartStyleChanged(){H("Chart","Chart Style "+this._model.mainSeries().getStyleShortName().toUpperCase())}getSymbol(e){var t;return(t=this._model?this._model.mainSeries().properties():this._properties.mainSeriesProperties)?e&&t.shortName&&t.shortName.value()?t.shortName.value():t.symbol.value():""}_applyStudiesOverrides(){z.overrideDefaults(this._metaInfoRepository.getInternalMetaInfoArray())}studiesMetaData(){return this._model.studiesMetaData()}getTimeScale(){return this._timeAxisWidget}chartWidgetCollection(){return this._chartWidgetCollection}setSeriesStyle(e,t){this._model.setProperty(e.properties().style,t)}showObjectsTreePanelOrDialog(){var e=!1,t=window.widgetbar;t&&t.isVisible()&&(e="object_tree"===t.setPage("object_tree").name);e||this.showObjectsTreeDialog()}showChartPropertiesForSource(e,t,i,s){
return c.enabled("property_pages")&&e.userEditEnabled()?e===this._model.model().mainSeries()?this.showGeneralChartProperties(t):((i=i||{}).onResetToDefault=this._model.restorePropertiesForSource.bind(this._model,e),this._showChartProperties(e,t,i,s)):Promise.resolve(null)}generalPropertiesDefinitions(){return this._getChartPropertyDefinitionsViewModel().then((function(e){return e.propertyPages()}))}propertiesDefinitionsForSource(e){return b(e)||v(e)||w(e)?e.getPropertyDefinitionsViewModel().then((function(e){return null===e?null:e.propertyPages()})).catch((function(e){return Y.logWarn(e),null})):Promise.resolve(null)}toggleCompareOrAdd(){this._compareDialog.visible().value()?this._compareDialog.hide():this._compareDialog.show()}showFundamentals(e){if(window.fundamentalsDialog){if(!window.fundamentalsDialog.visible().value()){var t,i=void 0!==e?e.title(!0):void 0;if(void 0!==e){var s=e.symbolInfo();t=null===s?e.symbol():s.ticker||s.full_name}return window.fundamentalsDialog.show(t,i),window.fundamentalsDialog}window.fundamentalsDialog.hide()}}removeSelectedSources(){this.removeDataSources(this._model.selection().dataSources())}removeDataSources(e){var t=e.filter(function(e){return e!==this._model.mainSeries()&&e!==this._model.lineBeingCreated()&&e.isUserDeletable()}.bind(this));if(0!==t.length){var i=null;v(t[0])&&(o(1===t.length,"Cannot remove several studies (no multi select for studies)"),i=t[0]);t.find((function(e){return e.hasAlert.value()}));i&&i.hasChildren()?showDeleteStudyTreeConfirm(this._model.removeSelectedSources.bind(this._model)):this._model.removeSelectedSources()}}toggleLockSelectedObject(){var e=this._model;e.selection().lineDataSources().forEach((function(t){var i=t.properties().frozen.value();e.setProperty(t.properties().frozen,!i,(i?Ce:Te).format({title:new r(t.name(),t.title())}))}))}showSourceProperties(e,t=null){e===this._model.mainSeries()&&(t=u.symbol),this.showChartPropertiesForSource(e,t)}openSelectedObjectSource(e){}tags(){return this._model?this._model.calculateDefaultTags():[]}state(e,t,i,s){if(this._model){const r=this._model.state(e,t,i,s);return r.chartId=this.id(),r}return this._content?this._content:{}}metaInfo(){var e=this._metaInfo;return this._model&&(e.systemTags=this._model.calculateDefaultTags()),e}onTagsChanged(){return this._tagsChanged}onModelTagsChanged(){this._tagsChanged.fire()}onAboutToBeDestroyed(){return this._aboutToBeDestroyed}destroy(){this._aboutToBeDestroyed.fire(),null!==this._removeMaximizeHotkey&&(this._removeMaximizeHotkey(),this._removeMaximizeHotkey=null),0!==this._drawRafId&&this._parent.ownerDocument.defaultView.cancelAnimationFrame(this._drawRafId),null!==this._backgroundTopColorSpawn&&this._backgroundTopColorSpawn.destroy(),null!==this._backgroundBottomColorSpawn&&this._backgroundBottomColorSpawn.destroy(),null!==this._timingsMeter&&(this._timingsMeter.stopCollect(),this._timingsMeter=null);for(var e=0;e<this._paneWidgets.length;e++)this._paneWidgets[e].destroy();this._paneWidgets.length=0
;for(e=0;e<this._paneSeparators.length;e++)this._paneSeparators[e].destroy();for(var t in this._paneSeparators.length=0,this._hotkeysListener&&this._hotkeysListener.destroy(),this._barsButton&&this._barsButton.destroy(),this._controlBarNavigation&&(this._controlBarNavigation.destroy(),this._controlBarNavigation=void 0),this._mainDiv&&this._mainDiv.remove(),this._actions){var i=this._actions[t];i instanceof C&&(i.destroy(),i.binder&&i.binder.destroy())}null!==this._timeAxisWidget&&(this._timeAxisWidget.destroy(),this._timeAxisWidget=null),null!==this._definitionsViewModel&&this._definitionsViewModel.destroy(),this._hotkeys&&(this._hotkeys.destroy(),this._hotkeys=null),this._mainDiv.removeEventListener("wheel",this._onWheelBound),window.removeEventListener("keydown:chart_"+this._id,this._keydownEventListener),super.destroy()}title(){return i(509806).t(null,void 0,i(614412))}symbolProperty(){return this._model.mainSeries().properties().shortName?this._model.mainSeries().properties().shortName:this._model.mainSeries().properties().symbol}loadContent(e,t){this.screen.show();var i=this;this.isMaximizedPane()&&this.toggleMaximizePane(null);var s,r=i._model.model().dataSources(),n=i._model.mainSeries(),o=i._model.crossHairSource();o.clearMeasure();for(var a=0;a<r.length;a++){var l=r[a];l!==n&&l!==o&&i._model.model().removeSource(l,!0)}this._model.disconnect(),i.activePaneWidget=null,n.purgeSymbolInfo(),e.loading=!0,this._content=e,this._initialLoading=Boolean(t);for(a=0;a<e.panes.length;++a)for(var c=0;c<e.panes[a].sources.length;++c)if(e.panes[a].sources[c].state.symbol){s=e.panes[a].sources[c].state;break}if(!s)throw Error("An error occured while determining main series ion the chart");i._properties.mainSeriesProperties.mergeAndFire({visible:!0,symbol:s.symbol,timeframe:"",onWidget:i._onWidget,interval:s.interval||"D",style:s.style}),i._init(),i._model.undoHistory().clearStack()}_contentSeriesProperties(){if(this._content)for(var e=this._content.panes.length;e-- >0;)for(var t=this._content.panes[e].sources,i=t.length;i-- >0;)if("MainSeries"===t[i].type)return t[i].state}updateUndoRedo(){this._model&&(this.actions().undo.update({disabled:this._model.undoHistory().undoStack().isEmpty()}),this.actions().redo.update({disabled:this._model.undoHistory().redoStack().isEmpty()}))}createSessionBreaksActions(){var e=new C({actionId:T.ChartSessionBreaksToggleVisibility,label:i(509806).t(null,void 0,i(259827)),checkable:!0,statName:"ToggleSessionBreaks"});e.binder=new h(e,this._model.chartModel().sessions().properties().graphics.vertlines.sessBreaks.visible,this.model(),xe),this._actions.sessionBreaks=e}updateActionForIntradayOnly(e){e&&e instanceof C&&e.update({disabled:this.model().mainSeries().isDWM()})}containsVolume(){return this.model().dataSources().some((function(e){return e instanceof g&&"Volume"===e.metaInfo().shortId}))}containsStudyByPredicate(e){return!!this._model&&this._model.dataSources().some((function(t){if(!(t instanceof g))return!1;var i=t.metaInfo();return e(i)}))}containsStudy(e){
return this.containsStudyByPredicate((function(t){return t.id===e||t.fullId===e}))}isSmall(){return this._width()<550||this._height()<300}onWidget(){return this._onWidget}onCmeWidget(){return"cme"===this.widgetCustomer()}widgetCustomer(){return this._widgetCustomer}resize(){var e=this._height()+"px",t=this._width()+"px";this._mainDiv.style.height=e,this._mainDiv.style.width=t,this._elMainTable.style.height=e,this._elMainTable.style.width=t,this._resizeHandler&&this._mainDiv&&this._resizeHandler()}applyOverrides(e){var t={};for(var i in e)i.startsWith("mainSeriesProperties.priceAxisProperties")||(t[i]=e[i]);if(applyPropertiesOverrides(this.properties(),null,!1,t,null),this._model){applyPropertiesOverrides(this._model.model().properties(),null,!1,t),applyPropertiesOverrides(this._model.mainSeries().properties(),null,!1,t,"mainSeriesProperties"),this._model.model().sessions().applyOverrides(t);const e=this._model.chartModel().watermarkSource();null!==e&&e.applyOverrides(t)}}applyStudiesOverrides(e){z.mergeDefaultsOverrides(e),this._applyStudiesOverrides()}setActive(e){this._isActive=e,U().isTouch&&(e&&0!==this.selectPointMode().value()?this.startTrackingMode():this.exitTrackingMode()),this._paneWidgets.forEach((function(e){e.update()})),e||this.model().selectionMacro((function(e){e.clearSelection()}))}isActive(){return this._isActive}isMultipleLayout(){return Z(this._chartWidgetCollection.layout.value())}selectPointMode(){return this._model.model().selectPointMode()}cancelRequestSelectPoint(){this._model.model().cancelRequestSelectPoint(),this._model.model().setReplayStatus($.Undefined)}requestSelectPoint(e,t){var i=this;return e.selectPointMode===q.Replay&&this._model.model().setReplayStatus($.PointSelect),new Promise((function(s,r){if(a()){x.resetToCursor(!0),i._model.lineBeingCreated()&&i._model.cancelCreatingLine();var n=!1,o={};i._model.model().onPointSelected().subscribe(o,(function(e,t){n=!0,i._isVisible.unsubscribe(a),i._hideHint(),s({point:e,pane:t})}),!0),i._model.model().requestSelectPoint(e),i.startTrackingMode(),void 0!==t&&i._showHint(t),i._isVisible.subscribe(a),i.selectPointMode().subscribe((function(){setTimeout((function(){n||(0===i.selectPointMode().value()&&i._hideHint(),i._model.model().onPointSelected().unsubscribeAll(o),i._isVisible.unsubscribe(a),r("cancelled"))}))}),{once:!0})}function a(){return!!i.isVisible()||(r("Chartwidget must be visible"),i.cancelRequestSelectPoint(),!1)}}))}showReplayOrderConfirmationDialog(){if(!this.model().isInReplay())return Promise.resolve()}_addPerfMark(e){X("ChartWidget."+this._id+"."+e)}requestFullscreen(){this._options.requestFullscreen()}getResizerDetacher(){return this._options}_createHint(){if(null===this._hintDefferedPromise){var e=ie();this._hintDefferedPromise=e;var t=this;Promise.all([i.e(9908),i.e(962),i.e(6166)]).then(i.bind(i,215593)).then((function(i){e.resolve(new i.ChartEventHintRenderer(t._chartWidgetCollection.getContainer()))}))}return this._hintDefferedPromise?a(this._hintDefferedPromise).promise:null}_showHint(e){
if(c.enabled("popup_hints"))if(null!==this._activeHint)this._activeHint.show(e);else{var t=this,i=this._createHint();null!==i&&i.then((function(i){if(null!==i){if(t._activeHint=i,void 0===e)return;t._activeHint.show(e)}}))}}_hideHint(){null!==this._activeHint&&this._activeHint.hide()}}},349534:(e,t,i)=>{"use strict";var s=i(650151).ensureNotNull,r=i(897627),n=r.LineDataSourceApi,o=r.isLineToolRiskReward,a=i(535725).StudyApi,l=i(365622).SeriesApi,c=i(989348).SelectionApi,h=i(971111).PaneApi,d=i(85761).createDwmAligner,u=i(638273).Interval,p=i(546561).supportedLineTools,_=i(486028),m=_.isNumber,g=_.deepEquals,f=i(232468).createLineToolProperties,v=i(232468).prepareLineToolPropertiesByOwnerSource,S=i(620793).lineToolEntityInfo,y=i(302744).LineToolsGroupControllerApi,b=i(319139).RemoveSourcesCommand;const{isLineDrawnWithPressedButton:w,isLineToolFinishRequiredWhenCreatedByApi:P}=i(315264),C=i(98747).EnvironmentState;var T=i(248345).ChartWidgetApiBase,x=i(358076);i(32133).trackEvent;function I(e,t){return t.map((function(t){return e.dataSourceForId(t)}))}e.exports=class extends T{constructor(e,t){super(e,t),this._panes=new WeakMap,this._studies=new WeakMap,this._lineDataSources=new WeakMap,this._selectionApi=null,this._prevVisibleRange=null,this._chartWidget.onAboutToBeDestroyed().subscribe(this,this._destroy,!0),this._chartWidget.withModel(this,(function(){this._chartWidget.model().timeScale().logicalRangeChanged().subscribe(this,this._onLogicalRangeChanged)}))}id(){return this._chartWidget.id()}_getPaneApi(e){var t=this._panes.get(e);return void 0===t&&(t=new h(e,this._chartWidget),this._panes.set(e,t)),t}_getStudyApi(e){var t=this._studies.get(e);return void 0===t&&(t=new a(e,this._chartWidget),this._studies.set(e,t)),t}_getLineDataSourceApi(e){var t=this._lineDataSources.get(e);return void 0===t&&(t=new n(e,this._chartWidget.model(),{apiPointsToDataSource:this._convertUserPointsToDataSource.bind(this),dataSourcePointsToPriced:e=>{var t=this._chartWidget.model().mainSeries().syncModel(),i=this._chartWidget.model().timeScale();return e.map((e=>{var s=i.normalizeBarIndex(e.index);return{price:e.price,time:this._convertTimeToPublic(t.projectTime(s.time_t,s.offset))}}))}}),this._lineDataSources.set(e,t)),t}executeActionById(e){this._chartWidget.executeActionById(e)}getCheckableActionState(e){return this._chartWidget.getCheckableActionState(e)}setZoomEnabled(e){this._chartWidget.model().model().setZoomEnabled(e)}setScrollEnabled(e){this._chartWidget.model().model().setScrollEnabled(e)}refreshMarks(){this._chartWidget.refreshMarks()}clearMarks(e){this._chartWidget.clearMarks(e)}symbol(){return this._chartWidget.getSymbol()}resolution(){return this._chartWidget.model().mainSeries().properties().interval.value()}resetData(){this._chartWidget.model().mainSeries().rerequestData()}setEntityVisibility(e,t){console.warn("`setEntityVisibility` is deprecated. Use shape/study API instead");var i=this._chartWidget.model().model().dataSourceForId(e);if(i){var s=i.properties();s&&s.visible&&s.visible.setValue(t)}}
availableZOrderOperations(e){var t=I(this._chartWidget.model().model(),e);return this._chartWidget.model().availableZOrderOperations(t)}sendToBack(e){var t=I(this._chartWidget.model().model(),e);this._chartWidget.model().sendToBack(t)}bringToFront(e){var t=I(this._chartWidget.model().model(),e);this._chartWidget.model().bringToFront(t)}insertAfter(e,t){var i=this._chartWidget.model().model(),s=I(i,e),r=i.dataSourceForId(t);this._chartWidget.model().insertAfter(s,r)}insertBefore(e,t){var i=this._chartWidget.model().model(),s=I(i,e),r=i.dataSourceForId(t);this._chartWidget.model().insertBefore(s,r)}bringForward(e){var t=I(this._chartWidget.model().model(),e);this._chartWidget.model().bringForward(t)}sendBackward(e){var t=I(this._chartWidget.model().model(),e);this._chartWidget.model().sendBackward(t)}showPropertiesDialog(e){var t=this._chartWidget.model().model().dataSourceForId(e);if(null===t)throw new Error("Study or shape "+e+" does not exist");this._chartWidget.showChartPropertiesForSource(t)}getAllShapes(){return this._chartWidget.model().model().allLineTools().map(S).filter((function(e){return null!==e.name}))}removeAllShapes(){this._chartWidget.removeAllDrawingTools()}removeAllStudies(){this._chartWidget.removeAllStudies()}removeEntity(e,t){var i=this._chartWidget.model().chartModel().dataSourceForId(e);i?t&&t.disableUndo?new b(this._chartWidget.model().chartModel(),[i],"").redo():this._chartWidget.model().removeSource(i,!0,!0):console.warn("Can't find a source with id: "+e)}removeEntityWithUndo(e){var t=this._chartWidget.model().chartModel().dataSourceForId(e);this._chartWidget.model().removeSource(t,!1)}selection(){return null===this._selectionApi&&(this._selectionApi=new c(this._chartWidget.model().model())),this._selectionApi}createStudyTemplate(e){return this._chartWidget.model().model().studyTemplate(e.saveSymbol,e.saveInterval)}drawOnAllCharts(e){x.drawOnAllCharts.setValue(e)}applyStudyTemplate(e){this._chartWidget.model().applyStudyTemplate(e,""+1e3*Math.random())}setVisibleRange(e,t){return new Promise(function(i){this._chartWidget.setVisibleTimeRange(e.from,e.to,t,i)}.bind(this))}getVisiblePriceRange(){return console.warn("`getVisiblePriceRange` is deprecated. Use Price Scale API instead"),this._chartWidget.model().mainSeries()?this._chartWidget.model().mainSeries().priceScale().priceRangeInPrice():null}scrollPosition(){return console.warn("`scrollPosition` is deprecated. Use rightOffset from Time Scale API instead"),this._chartWidget.model().timeScale().rightOffset()}defaultScrollPosition(){return console.warn("`defaultScrollPosition` is deprecated. Use defaultRightOffset from Time Scale API instead"),this._chartWidget.model().timeScale().defaultRightOffset().value()}_createTradingPrimitive(e,t){var i,r=this._chartWidget.model(),n=r.model(),o=n.paneForSource(n.mainSeries());function a(){var e=TradingView.CLOSE_PLOT,t=s(r.mainSeries().bars().last());return{index:t.index,price:t.value[e]}}return(i=t?n.createLineTool(o,a(),e):r.createLineTool({pane:o,point:a(),linetool:e}))?i._adapter:void 0}
createOrderLine(e){e=e||{};return this._createTradingPrimitive("LineToolOrder",e.disableUndo)}createPositionLine(e){e=e||{};return this._createTradingPrimitive("LineToolPosition",e.disableUndo)}createExecutionShape(e){e=e||{};return this._createTradingPrimitive("LineToolExecution",e.disableUndo)}createShape(e,t){return this.createMultipointShape([e],t)}_alignPoints(e){var t=this._chartWidget.model().model(),i=t.mainSeries(),s=i.interval();if(t.timeScale().isEmpty()||!u.isDWM(s))return e;var r=d(s,i.symbolInfo());return null===r?e:e.map((function(e){return r.timeToSessionStart(1e3*e)/1e3}))}_convertUserPointsToDataSource(e){var t=this._chartWidget.model().model(),i=t.mainSeries(),s=t.timeScale().points(),r=i.data();if(t.timeScale().isEmpty())return null;var n=e.map((function(e){return e.time||0})),o=this._alignPoints(n);function a(e,t,n){var o=s.closestIndexLeft(e)||0,a={index:o},l=s.valueAt(o);const c=s.range().value();if(e>l&&o===c.lastIndex)(h=i.syncModel().distance(l,e)).success&&(a.index=a.index+h.result);else if(e<l&&o===c.firstIndex){var h;(h=i.syncModel().distance(e,l)).success&&(a.index=a.index-h.result)}if(m(t))a.price=t;else{var d=n?["open","high","low","close"].indexOf(n)+1:1;d<=0&&(d=1),a.price=r.valueAt(o)[d]}return a}for(var l=[],c=0;c<e.length;c++){var h=e[c];l.push(a(o[c],h.price,h.channel))}return l}createMultipointShape(e,t){const i=Object.assign({},this._getDefaultCreateMultipointShapeOptions(),t);var s=p[i.shape]||p.flag;var r=this._chartWidget.model().model(),n=r.mainSeries();if(!r.timeScale().isEmpty()){var a=r.dataSourceForId(i.ownerStudyId)||n,l=r.paneForSource(a),c=this._convertUserPointsToDataSource(e);if(s.onlySelectable)throw new Error('Cannot create "'+i.shape+'" shape');if("LineToolIcon"===s.name){if(i.icon=i.icon||i.overrides&&i.overrides.icon,!i.hasOwnProperty("icon"))throw new Error("icon must be specified in options");i.overrides=i.overrides||{},i.overrides.icon=i.icon}var h,d,u=f(s.name,void 0,this._chartWidget.model().model());if(v(u,a),i.overrides)for(var _ in i.overrides)u[_]?u[_].mergeAndFire(i.overrides[_]):o(s.name)&&-1!==["profitLevel","stopLevel"].indexOf(_)&&u.addProperty(_,i.overrides[_]);if(void 0!==u.text&&i.text&&u.text.setValue(i.text),u.hasChild("filled")&&i.filled&&u.filled.setValue(!0),null!==(d=i.disableUndo?(h=this._chartWidget.model().model()).createLineTool(l,c[0],s.name,u,void 0,a):(h=this._chartWidget.model()).createLineTool({pane:l,point:c[0],linetool:s.name,properties:u,ownerSource:a}))){if(o(s.name)){if(c.length>2)throw new Error("Wrong points count for "+i.shape+". Required 1 or 2");2===c.length&&(d.startChanging(1,c[1]),d.setPoint(1,c[1]),d.endChanging())}else{var m=d.pointsCount();if(m!==c.length&&-1!==m)throw new Error("Wrong points count for "+i.shape+". Required "+m);for(var g=new C(void 0,!0),S=w(s.name),y=1;y<c.length&&this._chartWidget.model().lineBeingCreated();y++)d.setLastPoint(c[y]),h.continueCreatingLine(c[y],g,y<c.length-1||S);P(s.name)&&(d.finish(),h.finishLineTool(d),h.continueCreatingLine(c[c.length-1],g,!1))}
if(i.lock&&d.setUserEditEnabled(!1),i.disableSelection&&d.setSelectionEnabled(!1),i.disableSave&&(d.customization.disableSave=!0),i.hasOwnProperty("showInObjectsTree")&&(d.customization.showInObjectsTree=i.showInObjectsTree),i.zOrder){var b=this._chartWidget.model().availableZOrderOperations([d]);"top"===i.zOrder&&b.bringToFrontEnabled?h.bringToFront([d]):"bottom"===i.zOrder&&b.sendToBackEnabled&&h.sendToBack([d])}return d.id()}}}getShapeById(e){var t=this._chartWidget.model().model().getLineToolById(e);if(null===t)throw new Error("There is no such shape");return this._getLineDataSourceApi(t)}getStudyById(e){var t=this._chartWidget.model().model().getStudyById(e);if(null===t)throw new Error("There is no such study");return this._getStudyApi(t)}getSeries(){var e=this._chartWidget.model(),t=e.mainSeries();return new l(t,e)}chartType(){return this._chartWidget.model().mainSeries().properties().style.value()}priceFormatter(){return this._chartWidget.model().mainSeries().priceScale().formatter()}dataReady(e){var t=!this._chartWidget.hasModel()||!this._chartWidget.model().mainSeries()||this._chartWidget.model().mainSeries().data().isEmpty();return e&&(t?this.onDataLoaded().subscribe(null,e,!0):e()),!t}_onLogicalRangeChanged(){var e=this._chartWidget.model().mainSeries(),t=e.data().isEmpty();if(null!==this._chartWidget.model().timeScale().visibleBarsStrictRange()&&t)e.dataEvents().completed().subscribe(this,this._onLogicalRangeChanged,!0);else{var i=this.getVisibleRange();null!==this._prevVisibleRange&&g(this._prevVisibleRange,i)[0]||(this._prevVisibleRange=i,this._visibleBarsChanged.fire(i))}}_destroy(){super._destroy(),this._chartWidget.hasModel()&&this._chartWidget.model().timeScale().logicalRangeChanged().unsubscribe(this,this._onLogicalRangeChanged)}setTimezone(e){this._chartWidget.setTimezone(e)}getTimezone(){return this._chartWidget.getTimezone()}getPanes(){return this._chartWidget.model().chartModel().panes().map((function(e){return this._getPaneApi(e)}),this)}canZoomOut(){return!this._chartWidget.model().zoomStack().isEmpty()}zoomOut(){this.canZoomOut()&&this._chartWidget.model().zoomFromViewport()}shapesGroupController(){return new y(this._chartWidget.model().lineToolsGroupController(),this._chartWidget.model())}requestSelectBar(){if(this.isSelectBarRequested())return Promise.reject("already requested");var e=this;return new Promise((function(t,i){e._chartWidget.requestSelectPoint({pointType:"time"}).then((function(i){t(e._convertTimeToPublic(i.point.time))})).catch((function(){i("cancelled")}))}))}cancelSelectBar(){this.isSelectBarRequested()&&this._chartWidget.cancelRequestSelectPoint()}}},529139:(e,t,i)=>{"use strict"
;var s=i(922157),r=i(650151).assert,n=i(114122).createDeferredPromise,o=i(440097).TranslatedString,a=i(497612).layouts,l=i(363030).createUndoHistory,c=i(358076),h=i(411589),d=i(180185),u=i(559410),p=i(484727),_=i(210596),m=i(817808).getLogger("Chart.ChartWidgetCollection"),g=i(260845).preventDefaultForContextMenu,f=i(667342),v=i(739477).GeneralChartPropertiesRenderer,S=i(382213).setLastUsedResolution,y=i(561371).CompareDialogRenderer,b=i(69111).isOnMobileAppPage,w=i(871555),P=i(632054);const{isSupportedLayout:C,tryGuessingTheMostSuitableLayout:T}=i(497612);var x=i(705681).CollectionViewMode,I=i(958198).mediaState,M=i(748454).SwapChartsUndoCommand,L=i(254572).ToastsFactory,A=i(876364),k=A.applyIndicatorsToAllChartsImpl,E=A.applyIndicatorToAllChartsImpl,D=A.lineToolsAndGroupsDTOsImpl,B=A.getStateForChartImpl,V=A.resetLineToolsInvalidatedImpl,R=A.applyLineToolUpdateNotificationImpl,N=A.createClipboardHandler,O=A.chartsSymbolsImpl,F=A.updateLayoutImpl,W=A.computeContentBoxImpl,z=A.getVisuallyAdjacentDefImpl,H=A.setLayoutImpl,U=A.removeChartWidgetSubscriptionsImpl,j=A.generateNewChartId,G=A.syncCrosshairImpl,q=A.createBroadcastChannel,$=A.destroyBroadcastChannel,Y=A.syncScrollImpl,K=A.allInitialModelsCreated,Z=A.allInitialSymbolsResolved,X=A.applyThemeImpl,J=A.isFirstChartInLayout,Q=A.deserializedChartIds,ee=A.handleDateRangeLockChange,te=A.handleInternalDateRangeLockChange,ie=A.handleTrackTimeLockChange,se=A.handleInternalTrackTimeLockChange,re=A.handleIntervalLockChange,ne=A.handleInternalIntervalLockChange,oe=A.handleSymbolLockChange,ae=A.handleInternalSymbolLockChange,le=(A.handleConnectionLimitReachedChanged,A.handleDeviceConnectionClosed,A.createLeftBottomChartWidgetWV),ce={saveChartEnabled:!0,takeScreenshotEnabled:!0,publishedChartsEnabled:!0},he=new o("change symbol",i(509806).t(null,void 0,i(600526))),de=new o("change resolution",i(509806).t(null,void 0,i(932303))),ue=new o("change series style",i(509806).t(null,void 0,i(53438)));i(509806).t(null,void 0,i(219149));e.exports=function(e){var t=this,o=Object.assign({},ce,e),pe=new _,_e=o.readOnly||!1,me=[],ge=0,fe=new _,ve=new _,Se=new _,ye="s",be=new _(null),we=new Map,Pe=new _([]),Ce=new _;Ce.setValue(x.ForceFullscreen);var Te=[],xe=!1,Ie=!1,Me=new _(!1),Le=new _(null),Ae=new _(!1),ke=new _(!1);ke.subscribe((e=>oe(vt(),e)));var Ee=new _(ke.value());Ee.subscribe((e=>ae(vt(),e)));var De=new _(!1);De.subscribe((e=>re(vt(),e)));var Be=new _(De.value());Be.subscribe((e=>ne(vt(),e)));var Ve=new _(!1);Ve.subscribe((e=>ie(vt(),e)));var Re=new _(Ve.value());Re.subscribe((e=>se(vt(),e)));var Ne=new _(!1);Ne.subscribe((e=>ee(vt(),e))),be.subscribe(Kt);var Oe=new _(Ne.value());Oe.subscribe((e=>te(vt(),e)));var Fe=new _(TVSettings.getBool("chart.syncCrosshair",!0)),We=h.createGroup({desc:"Layout"}),ze=null,He=null,Ue=null,je=null;if(window.TVD){var Ge=window.TVD.crosshairSyncEnabled;Ge?(Ge.value()&&(Ue=q(vt)),je=Ge.subscribe((e=>{e?Ue=q(vt):($(vt()),Ue=null)}))):Ue=q(vt)}var qe=Fe.value();Fe.subscribe((function(e){qe=e=!!e,TVSettings.setValue("chart.syncCrosshair",e)
;for(var t=0;t<me.length;++t){var i=me[t].chartWidget;i.hasModel()&&i.model().model().lightUpdate()}}));var $e=new _(ye),Ye=o.resizerBridge.width,Ke=o.resizerBridge.height,Ze=new _(null),Xe=new _(null);Ze.subscribe((e=>{Xe.setValue(null===e?null:e.chartWidget)}));var Je=o.widgetOptions||{},Qe=o.metaInfo||{},et={id:new _(Qe.id||null),name:new _(Qe.name),description:new _(Qe.description),username:new _(Qe.username),uid:new _(Qe.uid),lastModified:new _(Qe.lastModified)},tt=l();tt.onChange().subscribe(null,(function(e){u.emit("undo_redo_state_changed",e)}));var it=o.resizerBridge.container.value();it.addEventListener("contextmenu",g);var st,rt=n(),nt=new s,ot=new s,at=new s,lt=new _(!1),ct=new _(null),ht=null,dt=null;o.seriesControlBarEnabled&&(st="0px",ct.setValue(document.createElement("div")),ct.value().style.left=st,ct.value().style.right=st,ct.value().style.bottom=st,ct.value().classList.add("chart-toolbar","chart-controls-bar"),ct.value().setAttribute("data-is-chart-toolbar-component","true"),it.appendChild(ct.value()),Promise.all([i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(8825),i.e(1428),i.e(105),i.e(1140),i.e(3795),i.e(9415),i.e(7507),i.e(5639),i.e(7895),i.e(962),i.e(4104),i.e(4586),i.e(7260)]).then(i.bind(i,586186)).then((({BottomToolbarRenderer:e})=>{var i=o.resizerBridge,r=[i.container.spawn(),i.width.spawn(),i.height.spawn()],n=i.container.value(),a=function(){var e=n.getBoundingClientRect(),t=W(vt());return t.top=e.top+t.top,t.left=e.left+t.left,t},l=new s,c=function(){l.fire()};r.forEach((function(e){e.subscribe(c)}));var h=function(){r.forEach((function(e){e.destroy()})),l.destroy()};ht=new e(ct.value(),l,a,t,ChartApiInstance,Je,o.seriesControlBar),dt=function(){null!==ht&&(ht.destroy(),ht=null,ct.value().remove(),ct.setValue(null)),h()}})));var ut,pt=new v(t),_t=new y(t),mt=null;function gt(){lt.setValue(me.some((e=>{const t=e.chartWidget.lineToolsSynchronizer();return null!==t&&t.hasChanges().value()})))}function ft(e){return A.checkProFeatureImpl(vt(),e)}function vt(){return{undoHistory:tt,chartWidgetsDefs:me,chartsCountToSave:St,actualLayoutCount:yt,savedChartWidgetOptions:Te,activeChartWidget:pe,options:o,parent:it,toastsFactory:mt,crosshairLockRaw:qe,crossHairSyncBroadcast:Ue,setChartStorageNotificationSubscription:e=>{He=e},maximizedChartDef:Ze,setMaximized:Lt,layoutTemplate:Se,widthWV:Ye,heightWV:Ke,checkProFeature:ft,lineToolsSynchronizerHasChanges:lt,recalcHasChanges:gt,onZoom:ot,onScroll:at,layoutType:ye,layoutWV:$e,setLayoutType:e=>{ye=e},isPhoneSize:Me,viewMode:Ce,updateViewMode:kt,loadingContent:xe,setLoadingContent:e=>{xe=e},initialLoading:Ie,inlineChartsCount:ve,updateWatchedValue:Et,checkAllPendingModelsAlreadyCreated:At,readOnly:_e,symbolLock:ke,internalSymbolLock:Ee,intervalLock:De,internalIntervalLock:Be,dateRangeLock:Ne,internalDateRangeLock:Oe,trackTimeLock:Ve,internalTrackTimeLock:Re,crosshairLock:Fe,customLegendWidgetsFactoriesMap:hi,globalDetachable:fe,saveChartService:ze,customSources:li,updateActivityView:Dt,chartWidgetCreatedDelegate:nt,sizingState:Le,
currentLayoutResizeAction:be,allLayoutSizesState:we,splitters:Pe,widgetOptions:Je,bottomToolbar:ct,replayContainer:ci,layoutSizesChanged:Ae,subscribeToCompletedEventForDateRangeSync:qt,subscribeToEventsForDateRangeSync:$t,unsubscribeFromEventsForDateRangeSync:Yt,syncChartsDateRangesWithActiveChartRange:Xt}}function St(){return yt()}function yt(){return a[ye].count}function bt(e,t,i,s,r){return B(vt(),e,t,i,s,r)}function wt(e){return e.value()?1:0}function Pt(){F(vt())}mt=new L(o.resizerBridge,(function(){return ct.value()?ct.offsetHeight:0})),Le.subscribe((()=>Pt())),Ye.subscribe(Pt),Ke.subscribe(Pt),this.updateLayout=Pt,Me.setValue(!1);var Ct=["phone","phone-vertical"];function Tt(e,t){o.mobileForceChartMaximizeEnabled&&(!Ct.includes(I.device)||t&&Ct.includes(t)?Ct.includes(I.device)||t&&!Ct.includes(t)||Me.setValue(!1):Me.setValue(!0))}function xt(){window.is_authenticated&&(Me.value()?Ce.value()===x.ForceFullscreen&&(ut=Ze.value(),pe.value().requestFullscreen()):ut||(Lt(null),kt()))}function It(e){return e.rdState.owner.value()!==e}function Mt(e){return H(vt(),e,t)}function Lt(e){Ze.value()!==e&&(Ze.setValue(e),Mt(ye))}function At(){me.every((e=>e.chartWidget.hasModel()))&&(Et(),u.emit("layout_changed"))}function kt(){"s"===ye||Ze.value()?Ce.setValue(x.ForceFullscreen):Ce.setValue(x.Multichart)}function Et(){var e=Math.min(Se.value().count,me.length)-1;if(e<0)pe.deleteValue();else{var t=ge;t<0&&(t=0),t>e&&(t=e),pe.setValue(me[t].chartWidget)}}function Dt(){for(var e=me.length;e--;){var t=e===ge;me[e].container.value().classList.toggle("active",t),me[e].container.value().classList.toggle("inactive",!t)}}function Bt(e,t){return z(vt(),e,t)}function Vt(e){var t=Bt(me[ge],e);t&&(pe.setValue(t.chartWidget),Ze.value()&&Mt(ye))}const Rt=new s;function Nt(e,t){var i=me.findIndex((function(t){return t.chartWidget===e})),s=me.findIndex((function(e){return e.chartWidget===t}));if(-1===i||-1===s)throw new Error("chart is not in the layout");var r=me[i],n=me[s];me[i]=n,me[s]=r,ge===i?ge=s:ge===s&&(ge=i),Pt(),Rt.fire()}var Ot=new s,Ft=new _,Wt=new _([]),zt=null;function Ht(e){var t=e.mainSeries().properties();t.style.subscribe(null,Ut),Ut(t.style),e.model().onSelectedSourceChanged().subscribe(null,jt),Ne.value()&&($t(e),Xt()),jt(e.selection().allSources())}function Ut(e){Ft.setValue(e.value())}function jt(){var e=zt.model();Wt.setValue(e.selection().allSources())}pe.subscribe((function(e){if(e){for(var t,i=me.length;i--;)if(me[i].chartWidget===e){t=i;break}if(!isFinite(t))throw new Error("Cannot make detached ChartWidget active");if(ge!==t){Ze.value()&&(It(me[t])||Ze.setValue(me[t])),ge=t,Dt();for(i=me.length;i--;)me[i].chartWidget!==e&&me[i].chartWidget.setActive(!1);yi(),e.setActive(!0),c.activePointSelectionMode.setValue(e.selectPointMode().value())}!function(e){if(zt!==e){if(zt&&(zt.modelCreated().unsubscribe(null,Ht),zt.hasModel())){var t=zt.model();Ne.value()&&Yt(t),t.mainSeries().properties().style.unsubscribe(null,Ut),t.model().onSelectedSourceChanged().unsubscribe(null,jt),zt=null}e&&(zt=e,
e.hasModel()?Ht(e.model()):e.modelCreated().subscribe(null,Ht))}}(e)}}),{callWithLast:!0});var Gt=new Map;function qt(e,t){var i=e.id();if(!Gt.has(i)){var s=function(){const i=e.id();Gt.has(i)&&(Gt.delete(i),Xt(t?e:void 0))};e.model().mainSeries().dataEvents().completed().subscribe(null,s,!0),Gt.set(i,{cw:e,callback:s})}}function $t(e){e.timeScale().visibleBarsStrictRangeChanged().subscribe(null,Zt)}function Yt(e){e.timeScale().visibleBarsStrictRangeChanged().unsubscribe(null,Zt),Gt.forEach((function(e){var t=e.cw,i=e.callback;t.model().mainSeries().dataEvents().completed().unsubscribe(null,i)})),Gt.clear()}function Kt(e){Ne.value()&&null===e&&Xt()}function Zt(e,t){Xt()}function Xt(e){if(Ne.value()&&null===be.value()){var t=pe.value(),i=t.model().mainSeries();if(P.isTimeBasedStyle(i.style())){var s=t.model().timeScale(),r=s.visibleBarsStrictRange();if(null!==r){var n=s.points().range().value(),o=s.indexToTimePoint(r.firstBar());null===o&&i.endOfData()&&(o=s.indexToTimePoint(n.firstIndex));var a=s.indexToTimePoint(r.lastBar());if(null===a&&(a=s.indexToTimePoint(n.lastIndex)),null!==o&&null!==a){Gt.delete(t.id());var l=1e3*o,c=1e3*a;if(i.isDWM()){var h=new Date(l),d=new Date(c);w.set_hms(h,0,0,0,0),w.set_hms(d,0,0,0,0),l=h.getTime(),c=d.getTime()}for(var u=0;u<me.length;u++){var p=me[u].chartWidget;p.hasModel()&&p!==t&&(void 0===e||p===e)&&P.isTimeBasedStyle(p.model().mainSeries().style())&&setTimeout(Jt.bind(null,p,l,c))}}else qt(t,!1)}}}}function Jt(e,t,i){e.model().model().gotoTimeRange(t,i)}function Qt(e){for(var t=!1,i=0;i<me.length;i++){var s=me[i].chartWidget;if(s.hasModel())s.model().mainSeries().properties().symbol.value()!==e&&(t||(tt.beginUndoMacro(he),t=!0),s.setSymbol(e))}t&&tt.endUndoMacro()}var ei=!1,ti=!1,ii=new s;function si(){o.resizerBridge.requestFullscreen()}function ri(){o.resizerBridge.exitFullscreen()}function ni(){return o.resizerBridge.fullscreenable}function oi(){return o.resizerBridge.fullscreen}function ai(e){if(0!==me.length){for(var t=me.length;t--;)me[t].chartWidget.setActive(!1);me[ge].chartWidget.setActive(e)}}_e||(We.add({desc:"Switch active chart",hotkey:9,handler:function(){Vt(!1)}}),We.add({desc:"Switch active chart",hotkey:d.Modifiers.Shift+9,handler:function(){Vt(!0)}})),We.add({desc:"Fullscreen mode",hotkey:d.Modifiers.Shift+70,isDisabled:p.enabled("widget")||!ni().value(),handler:function(){oi().value()?ri():si()}}),o.takeScreenshotEnabled&&(We.add({desc:"Screenshot server",hotkey:d.Modifiers.Alt+83,handler:A.takeServerScreenshot.bind(this,o.snapshotUrl,t)}),b("any")||(We.add({desc:"Download client screenshot",hotkey:d.Modifiers.Mod+d.Modifiers.Alt+83,handler:A.downloadScreenshot.bind(this,t)}),We.add({desc:"Copy client screenshot",hotkey:d.Modifiers.Mod+d.Modifiers.Shift+83,handler:A.copyScreenshotToClipboard.bind(this,t)}))),o.saveChartEnabled&&We.add({desc:"Save Chart Layout",hotkey:d.Modifiers.Mod+83,handler:function(){Ot.fire()}});var li=new Map,ci=null,hi=new Map;const di=N(vt());o.globalEvents&&di.listen()
;const ui=ke.spawn(),pi=De.spawn(),_i=Ne.spawn(),mi=Ve.spawn(),gi=Fe.spawn(),fi=()=>me.map((e=>e.chartWidget)),vi=le(fi,$e.readonly(),Rt,nt);function Si(e,t){if(xe=!0,Ie=Boolean(t),Te.splice(0),e){if(e.charts||(e={layout:"s",charts:[e]}),e.layoutsSizes)for(const t of Object.keys(e.layoutsSizes))we.set(t,e.layoutsSizes[t]);var i=new Set;e.charts.forEach((function(e){e.chartId&&i.add(e.chartId)})),e.charts.forEach((function(e){if(!e.chartId){var t=j((function(e){return i.has(e)}));i.add(t),e.chartId=t}}));let t=e.layout;if(!C(t)){const e=T(t);m.logError(`Loading unsupported layout ${t}. Force migration to ${e}`),t=e}ye=ft(t||"s");for(var s=0;s<e.charts.length;s++){var r=e.charts[s];Te.push({content:r})}void 0!==e.symbolLock&&ke.setValue(Boolean(e.symbolLock)),void 0!==e.intervalLock&&De.setValue(Boolean(e.intervalLock)),void 0!==e.trackTimeLock&&Ve.setValue(Boolean(e.trackTimeLock)),void 0!==e.dateRangeLock&&Ne.setValue(Boolean(e.dateRangeLock)),void 0!==e.crosshairLock&&Fe.setValue(Boolean(e.crosshairLock))}Mt(ye),"s"===ye||o.mobileForceChartMaximizeEnabled||Ce.setValue(x.Multichart),c.init(),c.tool.subscribe(bi),c.tool.subscribe(yi),xe=!1,Ie=!1}function yi(){var e=pe.value();me.forEach((function(t){t.chartWidget!==e&&t.chartWidget.updateCrossHairPositionIfNeeded()})),e&&e.updateCrossHairPositionIfNeeded()}function bi(){me.forEach((function(e){e.chartWidget.onToolChanged()}))}Object.assign(this,{getAll:fi,maximizedChartWidget:()=>Xe.readonly(),leftBottomChartWidget:()=>vi,destroy:function(){if(ii.fire(),ai(!1),null!==dt&&(dt(),dt=null),U(vt()),ui.destroy(),pi.destroy(),mi.destroy(),_i.destroy(),gi.destroy(),be.unsubscribe(Kt),me.forEach((function(e){void 0!==e.timingsMeter&&e.timingsMeter.destroy(),e.chartWidget.destroy()})),o.resizerBridge.remove(),Pe.value().forEach((e=>{e.mouseHandler.destroy(),e.mouseListener.destroy()})),window.removeEventListener("resize",Pt),I.off("changeDevice",Tt),o.mobileForceChartMaximizeEnabled&&!o.handleMaximizedChartOnResizeDisabled&&I.off("changeDevice",xt),c.tool.unsubscribe(yi),c.tool.unsubscribe(bi),rt.resolve(),it.remove(),li.clear(),hi.clear(),We.destroy(),He&&He.destroy(),di&&di.destroy(),window.TVD){const e=window.TVD.crosshairSyncEnabled;e&&e.unsubscribe(je),$(vt())}},onAboutToBeDestroyed:ii,layout:$e.readonly(),setLayout:Mt,activeChartWidget:pe,viewMode:Ce,activeChartStyle:Ft.readonly(),setChartStyleToWidget:function(e,t){t||(t=pe.value()),t&&function(e,t){var i=e.model(),s=i.mainSeries().properties().style;i.setChartStyleProperty(s,t,ue)}(t,e)},selectedSources:Wt.readonly(),metaInfo:et,state:function(e,i,s,r){for(var n=[],o=St(),a=0;a<o;a++){var l=bt(a,e,i,s,r);l&&n.push(l)}var c={name:t.metaInfo.name.value(),layout:ye,charts:n};return c.symbolLock=wt(ke),c.intervalLock=wt(De),c.trackTimeLock=wt(Ve),c.dateRangeLock=wt(Ne),c.crosshairLock=wt(Fe),c.layoutsSizes={},we.forEach(((e,t)=>{c.layoutsSizes[t]=e})),c},lineToolsAndGroupsDTOs:function(){return D(vt())},resetLineToolsInvalidated:function(e,t){return V(vt(),e,t)},applyLineToolUpdateNotification:R.bind(null,me),
readOnly:function(){return _e},onZoom:function(){return ot},onScroll:function(){return at},resizerBridge:function(){return o.resizerBridge},lock:{symbol:ui,interval:pi,dateRange:_i,crosshair:gi,trackTime:mi},setSymbol:function(e){ke.value()?Qt(e):pe.value().setSymbol(e)},setResolution:function(e){ti||ei||function(e){if(S(e),ei=!0,De.value()){for(var t=!1,i=0;i<me.length;i++){var s=me[i].chartWidget;s.model().mainSeries().properties().interval.value()!==e&&(t||(tt.beginUndoMacro(de),t=!0),s.setResolution(e))}t&&tt.endUndoMacro()}else pe.value().setResolution(e);ei=!1}(e)},setTimeFrame:function(e){ti||(ti=!0,De.value()?me.forEach((function(t){t.chartWidget.loadRange(e)})):pe.value().loadRange(e),ti=!1)},updateLayout:Pt,setChartLayoutWithUndo:function(e){return A.setChartLayoutWithUndoImpl(vt(),this,e)},images:A.getSnapshot.bind(this,this,o.widgetOptions.customerReadableName,Je.onWidget),clientSnapshot:A.getClientSnapshot.bind(this,this,o.widgetOptions.customerReadableName,Je.onWidget),tags:function(){for(var e=[],t=0;t<me.length&&t<Se.value().count;t++)e=e.concat(me[t].chartWidget.tags());return e=(e=Array.from(new Set(e))).map((function(e){return e.toLowerCase().replace(/\W+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}))},syncCrosshair:(e,t,i,s)=>G(vt(),e,t,i,s),syncScroll:function(e,t){return Y(vt(),e,t)},setSymbolAll:Qt,clearChartMetaInfo:function(){et.id.setValue(null),et.uid.setValue(void 0),et.name.setValue(void 0)},takeScreenshot:A.takeScreenshot.bind(this,o.snapshotUrl,this),takeServerScreenshot:A.takeServerScreenshot.bind(this,o.snapshotUrl,this),loadContent:Si,purgeUnusedWidgets:function(){for(var e=a[ye].count;e<me.length;e++)me[e].chartWidget.destroy();me.splice(a[ye].count)},applyOverrides:function(e){for(var t=0;t<me.length;t++)me[t].chartWidget.applyOverrides(e)},applyStudiesOverrides:function(e){for(var t=0;t<me.length;t++)me[t].chartWidget.applyStudiesOverrides(e)},switchChart:Vt,startFullscreen:si,exitFullscreen:ri,fullscreen:oi,fullscreenable:ni,destroyPromise:function(){return rt.promise()},chartWidgetCreated:function(){return nt},saveKeysPressed:function(){return Ot},getContainer:function(){return it},onWidget:Je.onWidget,applyTheme:X.bind(null,vt(),t),applyIndicatorsToAllCharts:function(e){k(vt(),e)},applyIndicatorsToAllChartsAvailable:function(){return!_e&&yt()>1},applyIndicatorToAllCharts:function(e,t,i,s){E(vt(),e,t,i,s)},setActive:ai,inlineChartsCount:ve.readonly(),revertToInline:function(){if(!Me.value()||Ce.value()!==x.ForceFullscreen){Lt(null);for(var e=0;e<me.length;e++)me[e].rdState.bridge().attach()}},chartMarketStatuses:function(){return me.map((function(e){return"-"}))},chartSeriesStatuses:function(){return me.map((function(e){var t=e.chartWidget.hasModel()?e.chartWidget.model().mainSeries().status():null;return(null===t?"":f.SERIES_STATUS_TEXT[t])+" ("+t+")"}))},undoHistory:tt,lineToolsSynchronizerHasChanges:lt,applyPreferencesToAllCharts:function(e){var t=e.model().preferences();me.forEach((function(i){i.chartWidget._model!==e&&i.chartWidget._model.applyPreferences(t)}))},
getToasts:function(){return mt.getChartToasts()},addCustomSource:function(e,t,i){r(!li.has(e),"Cannot create the same custom source multiple times"),li.set(e,{factory:t,layer:i});for(var s=0;s<me.length;++s){var n=me[s].chartWidget;n.hasModel()&&n.model().model().addCustomSource(e,t,i)}},removeCustomSource:function(e){r(li.has(e),"Cannot remove not created custom source"),li.delete(e);for(var t=0;t<me.length;++t){var i=me[t].chartWidget;i.hasModel()&&i.model().model().removeCustomSource(e)}},addCustomWidgetToLegend:function(e,t){r(!hi.has(e),"Cannot create the same custom widget in legend multiple times"),hi.set(e,t);for(var i=0;i<me.length;++i)me[i].chartWidget.addCustomWidgetToLegend(e,t)},addReplayWidget:function(e){r(null===ci,"Cannot create replay container multiple times"),(ci=document.createElement("div")).style.position="absolute",ci.style["min-height"]="51px",ci.style.overflow="hidden",ci.style.left="0px",ci.style.right="0px";var t=null===ct.value()?0:ct.value().offsetHeight;ci.style.bottom=`${t}px`,ci.setAttribute("data-is-chart-toolbar-component","true"),it.prepend(ci),e(ci,(()=>Pt())),Pt()},destroyReplayWidget:function(){r(null!==ci,"Cannot remove replay container, container is not created"),ci.remove(),ci=null,Pt()},setViewMode:function(e){Ce.setValue(e)},moveActiveChartWithUndo:function(e){var t=me[ge],i=Bt(t,e);i&&tt.pushUndoCommand(new M(Nt,t.chartWidget,i.chartWidget))},activeChartCanBeMoved:function(){return!(_e||ve.value()<2||It(me[ge]))},generalPropertiesDefinitions:function(){return pe.value().generalPropertiesDefinitions()},reconnectChartApi:function(e){undefined(e)},setBroker:function(e){0},setSaveChartService:function(e){ze=e;for(var t=0;t<me.length;++t){me[t].chartWidget.setSaveChartService(e)}},getCompareDialogRenderer:function(){return _t},getChartPropertiesDialogRenderer:function(){return pt},clipboard:di,chartsSymbols:function(){return O(vt())},isFirstChartInLayout:J.bind(null,vt()),deserializedChartIds:Q.bind(null,vt()),layoutSizesChanged:()=>Ae}),Si(o.content,!0),$e.subscribe((function(){Dt()})),$e.hook=function(e){return e===this.value()?e:ft(e)},_e&&($e.writeLock=!0),window.addEventListener("resize",Pt),o.mobileForceChartMaximizeEnabled&&(I.on("changeDevice",Tt),o.handleMaximizedChartOnResizeDisabled||I.on("changeDevice",xt),Tt(),xt());var wi=0;function Pi(){0===--wi&&u.emitOnce("onChartReady")}me.forEach((function(e){if(e){wi++;var t=e.chartWidget;t.withModel(null,(function(){o.metaInfo&&t.model().model().setChartSaveTime(1e3*o.metaInfo.lastModified);var e=t.model().mainSeries();if(e.bars().size()>0||e.isStatusBad())Pi();else{var i=e.dataEvents(),s=function(){Pi(),i.barReceived().unsubscribe(null,s),i.completed().unsubscribe(null,s),i.error().unsubscribe(null,s)};i.barReceived().subscribe(null,s),i.completed().subscribe(null,s),i.error().subscribe(null,s)}}))}})),K(vt()).then(Z).then((function(){window.saver&&window.is_authenticated&&o.widgetOptions.justCloned&&window.saver.saveChartSilently()})).catch(m.logError.bind(m))}},282926:(e,t,i)=>{"use strict";i.d(t,{
ContextMenuManager:()=>s});var s,r=i(710567),n=i(370981);!function(e){let t=null,s=null;const o=[],a={createAction:e=>new r.Action({...e,actionId:"Chart.CustomActionId"}),createAsyncAction:e=>new r.ActionAsync("Chart.CustomActionId",e),createSeparator:()=>new r.Separator};async function l(e,r={},n={menuName:""},l){let h;null!==t&&(e=await t(e,a));const d=()=>{const e=o.indexOf(h);-1!==e&&o.splice(e,1),void 0!==l&&l()};if(null!==s)h=await s(e,n,d),c();else{const t=await Promise.all([i.e(7624),i.e(6092),i.e(5761),i.e(1140),i.e(8009),i.e(4412),i.e(5639),i.e(1528),i.e(962),i.e(412),i.e(8772),i.e(1584)]).then(i.bind(i,322528));h=new t.ContextMenuRenderer(e,r,d,c)}return o.push(h),h}function c(){(0,n.globalCloseMenu)()}e.createMenu=l,e.showMenu=function(e,t,i={},s,r){return l(e,i,s,r).then((e=>e.show(t)))},e.setCustomRendererFactory=function(e){s=e},e.setCustomItemsProcessor=function(e){t=e},e.hideAll=c,e.getShown=function(){for(let e=0;e<o.length;e++)if(o[e].isShown())return o[e];return null}}(s||(s={}))},231605:(e,t,i)=>{"use strict";i.d(t,{DialogRenderer:()=>n});var s=i(210596),r=i.n(s);class n{constructor(){this._container=document.createElement("div"),this._visibility=new(r())(!1)}visible(){return this._visibility.readonly()}_setVisibility(e){this._visibility.setValue(e)}}},577535:(e,t,i)=>{"use strict";var s;i.d(t,{TabNames:()=>s}),function(e){e.background="Background",e.coordinates="Coordinates",e.drawings="Drawings",e.events="Events",e.eventsAndAlerts="Events & Alerts",e.inputs="Inputs",e.properties="Properties",e.scales="Scales",e.legend="Legend",e.sourceCode="Source Code",e.style="Style",e.symbol="Symbol",e.timezoneSessions="Timezone/Sessions",e.trading="Trading",e.visibility="Visibility",e.text="Text"}(s||(s={}))},331980:(e,t,i)=>{"use strict";function s(e){return e.getAll().some((e=>e.isInitialized()))}function r(e,t){const i=e.getAll(),s=()=>{t(),i.forEach((e=>{e.chartWidgetInitialized().unsubscribe(null,s)}))};i.forEach((e=>{e.chartWidgetInitialized().subscribe(null,s,!0)}))}i.r(t),i.d(t,{isAnyChartWidgetInitialized:()=>s,waitAnyChartWidgetInitialized:()=>r})},236229:(e,t,i)=>{"use strict";i.d(t,{getFavoriteDrawingToolbarPromise:()=>o,createFavoriteDrawingToolbar:()=>a});var s=i(887905);let r=null,n=null;function o(){return n}function a(){null===n&&(n=Promise.all([i.e(269),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(8825),i.e(5761),i.e(8619),i.e(105),i.e(1140),i.e(8009),i.e(4412),i.e(8819),i.e(3562),i.e(5639),i.e(6879),i.e(1528),i.e(7263),i.e(962),i.e(1323),i.e(4104),i.e(412),i.e(1890),i.e(6181),i.e(8772),i.e(2306)]).then(i.bind(i,122392)).then((({FavoriteDrawingToolbar:e})=>(r=null!==r?r:new e({left:window.innerWidth/2,top:s.HEADER_TOOLBAR_HEIGHT_EXPANDED+61}),r))))}},16397:(e,t,i)=>{"use strict";i.d(t,{getPriceAxisNameInfo:()=>o});const s=["Z","Y","X","W","V","U","T","S"],r=["A","B","C","D","E","F","G","H"];class n{constructor(e){this.label=e}equals(e){return null!==e&&this.label===e.label}}function o(e,t){const i="left"===e?s:r;return new n(t<i.length?i[t]:"")}},705681:(e,t,i)=>{"use strict"
;i.d(t,{CHART_WIDGET_COLLECTION_SERVICE:()=>r,chartWidgetCollectionService:()=>n,CollectionViewMode:()=>o});var s=i(33290);const r={id:"ChartWidgetCollectionService"};function n(){return(0,s.hasService)(r)?(0,s.service)(r):null}var o;!function(e){e.Multichart="multichart",e.ForceFullscreen="force-fullscreen"}(o||(o={}))},706486:(e,t,i)=>{"use strict";i.d(t,{InvalidationLevel:()=>s,InvalidationMask:()=>a,defaultInvalidationLevel:()=>o});var s,r=i(650151);class n{constructor(e=o){this._paneInvalidationLevel=o,this._leftPriceScalesInvalidationMap=new Map,this._rightPriceScalesInvalidationMap=new Map,this._legendWidgetInvalidated=!1,this._invalidationLevel=e}fullInvalidation(){return this._invalidationLevel}invalidateAll(e){this._invalidationLevel=Math.max(this._invalidationLevel,e)}invalidatePane(e){this._paneInvalidationLevel=Math.max(this._invalidationLevel,e)}invalidateLegendWidgetLayout(){this._legendWidgetInvalidated=!0}invalidatePriceScale(e,t,i){const s="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap,r=s.get(t)||o;s.set(t,Math.max(r,i))}invalidationLevelForPane(){return Math.max(this._paneInvalidationLevel,this._invalidationLevel)}legendWidgetLayoutInvalidated(){return this._legendWidgetInvalidated||this._invalidationLevel===s.Full}getterForPriceScaleInvalidationLevelBySide(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;return e=>Math.max(t.get(e)||o,this._invalidationLevel)}priceScaleSideMaxLevel(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;let i=this._invalidationLevel;return t.size>0&&t.forEach((e=>{e>i&&(i=e)})),i}merge(e){this._invalidationLevel=Math.max(this._invalidationLevel,e._invalidationLevel),this._paneInvalidationLevel=Math.max(this._paneInvalidationLevel,e._paneInvalidationLevel),e._leftPriceScalesInvalidationMap.forEach(((e,t)=>{const i=this._leftPriceScalesInvalidationMap.get(t)||o;this._leftPriceScalesInvalidationMap.set(t,Math.max(i,e))})),e._rightPriceScalesInvalidationMap.forEach(((e,t)=>{const i=this._rightPriceScalesInvalidationMap.get(t)||o;this._rightPriceScalesInvalidationMap.set(t,Math.max(i,e))})),this._legendWidgetInvalidated=this._legendWidgetInvalidated||e._legendWidgetInvalidated}}!function(e){e[e.None=0]="None",e[e.Cursor=1]="Cursor",e[e.Light=2]="Light",e[e.Full=3]="Full"}(s||(s={}));const o=s.None;class a{constructor(e=o){this._panesOrderChanged=!1,this._keepVisibleTimeRangeOnResize=!1,this._timeAxisInvalidationLevel=o,this._invalidatedPanes=new Map,this._additionalActions=[],this._timeScaleInvalidations=[],this._invalidationLevel=e}invalidateAll(e){this._invalidationLevel!==e&&(this._invalidationLevel=Math.max(this._invalidationLevel,e),this._invalidatedPanes.forEach((e=>{e.invalidateAll(this._invalidationLevel)})))}invalidateAllPane(e,t){this._invalidatedPanes.has(e)||this._invalidatedPanes.set(e,new n(this._invalidationLevel)),(0,r.ensureDefined)(this._invalidatedPanes.get(e)).invalidateAll(t)}invalidatePriceScale(e,t,i,s){
this._invalidatedPanes.has(e)||this._invalidatedPanes.set(e,new n(this._invalidationLevel)),(0,r.ensureDefined)(this._invalidatedPanes.get(e)).invalidatePriceScale(t,i,s)}invalidateTimeScale(e){this._timeAxisInvalidationLevel=Math.max(this._timeAxisInvalidationLevel,e)}invalidatePanesOrder(){this._panesOrderChanged=!0}lockVisibleTimeRangeOnResize(){this._keepVisibleTimeRangeOnResize=!0}fullInvalidation(){return this._invalidationLevel}maxPaneInvalidation(){const e=[];return this._invalidatedPanes.forEach((t=>{e.push(t.fullInvalidation())})),Math.max(...e,this._invalidationLevel)}invalidateForPane(e){return this._invalidatedPanes.get(e)||new n(this._invalidationLevel)}invalidateForTimeScale(){return Math.max(this._timeAxisInvalidationLevel,this._invalidationLevel)}validationActions(){return this._additionalActions}addValidationAction(e){this._additionalActions.push(e)}merge(e){this._invalidationLevel=Math.max(this._invalidationLevel,e._invalidationLevel),this._panesOrderChanged=this._panesOrderChanged||e._panesOrderChanged,this._keepVisibleTimeRangeOnResize=this._keepVisibleTimeRangeOnResize||e._keepVisibleTimeRangeOnResize,this._invalidatedPanes.forEach((e=>{e.invalidateAll(this._invalidationLevel)})),e._invalidatedPanes.forEach(((e,t)=>{this._invalidatedPanes.has(t)||this._invalidatedPanes.set(t,new n(this._invalidationLevel)),(0,r.ensureDefined)(this._invalidatedPanes.get(t)).merge(e)})),this._timeAxisInvalidationLevel=Math.max(this._timeAxisInvalidationLevel,e._timeAxisInvalidationLevel);for(let t=0;t<e._additionalActions.length;t++)this._additionalActions.push(e._additionalActions[t]);for(const t of e._timeScaleInvalidations)this._applyTimeScaleInvalidation(t)}panesOrderInvalidated(){return this._panesOrderChanged}isVisibleTimeRangeLockedOnResize(){return this._keepVisibleTimeRangeOnResize}setTimeScaleAnimation(e){this._removeTimeScaleAnimation(),this._timeScaleInvalidations.push({type:0,value:e})}stopTimeScaleAnimation(){this._removeTimeScaleAnimation(),this._timeScaleInvalidations.push({type:1})}timeScaleInvalidations(){return this._timeScaleInvalidations}static cursor(){return new a(s.Cursor)}static light(){return new a(s.Light)}static full(){return new a(s.Full)}static panesOrder(){const e=a.full();return e.invalidatePanesOrder(),e}static invalidateLegendWidgetLayout(e){var t;const i=new a;return i._invalidatedPanes.set(e,new n),null===(t=i._invalidatedPanes.get(e))||void 0===t||t.invalidateLegendWidgetLayout(),i}static validateAction(e){const t=new a;return t._additionalActions.push(e),t}_applyTimeScaleInvalidation(e){switch(e.type){case 0:this.setTimeScaleAnimation(e.value);break;case 1:this._removeTimeScaleAnimation()}}_removeTimeScaleAnimation(){const e=this._timeScaleInvalidations.findIndex((e=>0===e.type));if(-1!==e){const[t]=this._timeScaleInvalidations.splice(e,1);t.value.terminate()}}}},242786:(e,t,i)=>{"use strict";i.d(t,{lastMouseOrTouchEventInfo:()=>r,setLastMouseOrTouchEventInfo:()=>n});let s=(0,i(601227).supportTouch)()?{isTouch:!0,stylus:!1}:{isTouch:!1};function r(){return s}function n(e){
s=e.isTouch?{isTouch:!0,stylus:e.stylus}:{isTouch:!1}}},425218:(e,t,i)=>{"use strict";i.d(t,{createLayout:()=>a,layoutInitialSizingState:()=>c});var s=i(203308),r=i(822914),n=i(650151);function o(e,t,i){const s=new Set;if("number"==typeof e)return s.add(e),{indices:s,smallestIndex:e,sizer:e=>e,splitters:()=>[],resizeApplier:(e,t,i,s,r)=>r,syncSublayoutsBySplitter:(e,t)=>t};const a=e[0],l=e.slice(1).map((e=>o(e,t)));let c=1/0;for(const e of l)for(const t of Array.from(e.indices))t<c&&(c=t),s.add(t);const h=(e,t,i,s,r,n,o,a)=>{const l="h"===o?e.width:e.height;let c,h,d;if(a){const e=t*i+s*l;c=Math.round(e),h=t===n-1?l-c-1:Math.round(e+r*l)-c}else{const e=(l-(n-1)*i)/n,s=t*(e+i);c=Math.round(s),h=Math.round(s+e)-c}return d="h"===o?{top:e.top,left:e.left+c,height:e.height,width:h}:{top:e.top+c,left:e.left,height:h,width:e.width},d},d=(e,t,i,s,r,n,o)=>{if("number"==typeof i)return[];const a=i[0],l=i.slice(1);return l.reduce(((i,c,u)=>{var p;const _=null==o?void 0:o[u],m=null!==(p=null==_?void 0:_.percent)&&void 0!==p?p:1/l.length,g=h(e,u,t,i.sumOfCoeffsBefore,m,l.length,a,o),f=i.sumOfCoeffsBefore+m;if(u<l.length-1){const e=`${n}-${s}-${u}-${a}`;let t;t="v"===a?{left:g.left,top:g.top+g.height-6+1,width:g.width,height:12}:{left:g.left+g.width-6+1,top:g.top,width:12,height:g.height};const o={level:s,orientation:a,indexes:[...r,u],metrics:t,className:e};i.splitters.push(o)}return Array.isArray(c)?{splitters:i.splitters.concat(d(g,t,c,s+1,[...r,u],n,null==_?void 0:_.substate)),sumOfCoeffsBefore:f}:{splitters:i.splitters,sumOfCoeffsBefore:f}}),{splitters:[],sumOfCoeffsBefore:0}).splitters};function u(e,t,i,s,r,o,l,c){if("number"==typeof s)return o;const d=s.slice(1),p=[0];for(let e=0;e<d.length;e++)p.push(p[p.length-1]+o[e].percent);if(l<r.level)return d.map(((s,_)=>{var m;const g=null==o?void 0:o[_];if("number"==typeof s)return g;if(!c&&_!==r.indexes[l])return g;const f=null!==(m=null==g?void 0:g.percent)&&void 0!==m?m:1/d.length,v=h(e,_,t,p[_],f,d.length,a,o);return{percent:g.percent,substate:u(v,t,i,s,r,(0,n.ensureDefined)(g.substate),l+1,c)}}));{const t=s[0];if(t!==r.orientation||o.length<2)return o;const n=Math.min(r.indexes[l],o.length-2),a="v"===t?e.height:e.width,c=i/a,h=o[n].percent+o[n+1].percent;return o[n].percent+=c,o[n].percent=Math.min(h-.05,Math.max(.05,o[n].percent)),o[n+1].percent-=c,o[n+1].percent=Math.min(h-.05,Math.max(.05,o[n+1].percent)),o}}function p(e,t){if(1===e.length)return t;{const i=(0,n.ensureDefined)(t[e[0]].substate);return p(e.slice(1),i)}}function _(e,t,i,s,o){if("number"==typeof e)return i;const a=e.slice(1);if(o<t.level)return a.map(((e,r)=>{const a=null==i?void 0:i[r];return"number"==typeof e?a:{percent:a.percent,substate:_(e,t,(0,n.ensureDefined)(a.substate),s,o+1)}}));{const e=t.indexes[o];if(s.length<i.length){const e=(0,r.default)(s),t=e[e.length-1].percent,n=i.length-e.length,o=t/(n+1);e[e.length-1].percent=o;for(let t=0;t<n;t++)e.push({percent:o});s=e}else if(s.length>i.length){const t=(0,r.default)(s);if(e>=i.length-1){const e=s.length-i.length
;for(let i=0;i<e;i++)t[e].percent+=t[i].percent;t.splice(0,e)}else{for(let e=i.length;e<s.length;e++)t[i.length-1].percent+=t[e].percent;t.splice(i.length)}s=t}return i.forEach(((e,t)=>e.percent=s[t].percent)),i}}return{indices:s,smallestIndex:c,sizer:(e,t,i,s,r)=>{let n,o,c,d=0,u=0,p=0;for(let e=0;e<l.length;e++){const s=l[e];s.smallestIndex>=i||(s.indices.has(t)&&(n=s,c=null==r?void 0:r[e].substate,r&&(p=r[e].percent),o=d),d++,r&&0===p&&(u+=r[e].percent))}const _=h(e,o,s,u,p,d,a,r);return n.sizer(_,t,i,s,c)},splitters:(t,i,s)=>d(t,i,e,0,[],"",s),resizeApplier:(t,i,s,r,n,o)=>u(t,i,s,e,r,n,0,o),syncSublayoutsBySplitter:function(t,i){const s=p(t.indexes,i);return _(e,t,i,s,0)}}}function a(e,t,i){const s=o(e,t);return{title:i,count:s.indices.size,sizer:s.sizer,splitters:s.splitters,resizeApplier:s.resizeApplier,syncSublayoutsBySplitter:s.syncSublayoutsBySplitter,expression:e,layoutType:t}}function l(e){return e.map((t=>{if((0,s.default)(t))return{percent:1/e.length};{const i=t.slice(1);return{percent:1/e.length,substate:l(i)}}}))}function c(e){return l(e.slice(1))}},497612:(e,t,i)=>{"use strict";i.r(t),i.d(t,{layouts:()=>a,isSingleLayout:()=>l,isMultipleLayout:()=>c,isSupportedLayout:()=>h,tryGuessingTheMostSuitableLayout:()=>d});var s=i(110123),r=i(425218);const n={s:{title:"1 chart",count:1,layoutType:"s",sizer:(e,t)=>{if(0!==t)throw new RangeError("invalid index");return e},splitters:()=>[],resizeApplier:(e,t,i,s,r)=>r,syncSublayoutsBySplitter:(e,t)=>t,expression:["h",0]}};let o;o={"2h":(0,r.createLayout)(s["2h"],"2h","2-up horizontal"),"2v":(0,r.createLayout)(s["2v"],"2v","2-up vertical"),"2-1":(0,r.createLayout)(s["2-1"],"2-1","2 at top and 1 at bottom"),"1-2":(0,r.createLayout)(s["1-2"],"1-2","1 at top and 2 at bottom"),"3s":(0,r.createLayout)(s["3s"],"3s","3-up stacked"),"3r":(0,r.createLayout)(s["3r"],"3r","3-up stacked left"),"3h":(0,r.createLayout)(s["3h"],"3h","3-up horizontal"),"3v":(0,r.createLayout)(s["3v"],"3v","3-up vertical"),4:(0,r.createLayout)(s[4],"4","4-up"),"4h":(0,r.createLayout)(s["4h"],"4h","4-up horizontal"),"4v":(0,r.createLayout)(s["4v"],"4v","4-up vertical"),"4s":(0,r.createLayout)(s["4s"],"4s","4-up stacked"),"5h":(0,r.createLayout)(s["5h"],"5h","5-up horizontal"),"6h":(0,r.createLayout)(s["6h"],"6h","6-up horizontal"),"7h":(0,r.createLayout)(s["7h"],"7h","7-up horizontal"),"8h":(0,r.createLayout)(s["8h"],"8h","8-up horizontal"),"2-2":(0,r.createLayout)(s["2-2"],"2-2","2 at top and 2 at bottom"),"2-3":(0,r.createLayout)(s["2-3"],"2-3","2 at top and 3 at bottom"),"1-3":(0,r.createLayout)(s["1-3"],"1-3","1 at top and 3 at bottom"),"1-4":(0,r.createLayout)(s["1-4"],"1-4","1 at top and 4 at bottom"),"5s":(0,r.createLayout)(s["5s"],"5s","5-up stacked"),6:(0,r.createLayout)(s[6],"6","6-up"),"6c":(0,r.createLayout)(s["6c"],"6c","6-up in two columns"),8:(0,r.createLayout)(s[8],"8","8-up"),"8c":(0,r.createLayout)(s["8c"],"8c","8-up in two columns")};const a={...n,...o};function l(e){return"s"===e}function c(e){return!l(e)}function h(e){return l(e)||o.hasOwnProperty(e)}function d(e){
const t=/(\d)-(\d)/.exec(e);let i=1;for(i=3===(null==t?void 0:t.length)?parseInt(t[1])+parseInt(t[2]):parseInt(e);i>1;){const e=Object.keys(o).find((e=>o[e].count===i));if(e)return e;i--}return"s"}},302744:(e,t,i)=>{"use strict";i.d(t,{LineToolsGroupControllerApi:()=>o});var s=i(792268),r=i(650151),n=i(232468);class o{constructor(e,t){this._controller=e,this._model=t}createGroupFromSelection(){return this._controller.createGroupFromSelection().id}removeGroup(e){const t=(0,r.ensureDefined)(this._groupById(e));this._controller.removeGroup(t)}groups(){return this._controller.groups().map((e=>e.id))}shapesInGroup(e){const t=(0,r.ensureDefined)(this._groupById(e));return(0,s.sortSources)(t.lineTools()).map((e=>e.id()))}excludeShapeFromGroup(e,t){const i=(0,r.ensureDefined)(this._groupById(e)),s=(0,r.ensureNotNull)(this._model.dataSourceForId(t));(0,r.assert)((0,n.isLineTool)(s),"Passed shapeId is not a line tool"),this._controller.excludeLineToolFromGroup(i,s)}addShapeToGroup(e,t){const i=(0,r.ensureDefined)(this._groupById(e)),s=(0,r.ensureNotNull)(this._model.dataSourceForId(t));(0,r.assert)((0,n.isLineTool)(s),"Passed shapeId is not a line tool"),this._controller.addLineToolToGroup(i,s)}availableZOrderOperations(e){const t=(0,r.ensureDefined)(this._groupById(e));return this._controller.availableZOrderOperations(t)}bringToFront(e){const t=(0,r.ensureDefined)(this._groupById(e));this._controller.bringToFront(t)}bringForward(e){const t=(0,r.ensureDefined)(this._groupById(e));this._controller.bringForward(t)}sendBackward(e){const t=(0,r.ensureDefined)(this._groupById(e));this._controller.sendBackward(t)}sendToBack(e){const t=(0,r.ensureDefined)(this._groupById(e));this._controller.sendToBack(t)}insertAfter(e,t){const i=(0,r.ensureDefined)(this._groupById(e)),s=(0,r.ensureNotNull)(this._groupById(t)||this._model.dataSourceForId(t));this._controller.insertAfter(i,s)}insertBefore(e,t){const i=(0,r.ensureDefined)(this._groupById(e)),s=(0,r.ensureNotNull)(this._groupById(t)||this._model.dataSourceForId(t));this._controller.insertBefore(i,s)}groupVisibility(e){return(0,r.ensureDefined)(this._groupById(e)).visibility()}setGroupVisibility(e,t){const i=(0,r.ensureDefined)(this._groupById(e));this._controller.setGroupVisibility(i,t)}groupLock(e){return(0,r.ensureDefined)(this._groupById(e)).locked()}setGroupLock(e,t){const i=(0,r.ensureDefined)(this._groupById(e));this._controller.setGroupLock(i,t)}getGroupName(e){return(0,r.ensureDefined)(this._groupById(e)).name()}setGroupName(e,t){const i=(0,r.ensureDefined)(this._groupById(e));this._controller.setGroupName(i,t)}canBeGroupped(e){const t=e.map((e=>(0,r.ensureNotNull)(this._model.dataSourceForId(e))));return!t.some((e=>!(0,n.isLineTool)(e)))&&this._controller.canBeGroupped(t)}_groupById(e){return this._controller.groups().find((t=>t.id===e))}}},685023:(e,t,i)=>{"use strict";i.d(t,{MouseEventHandler:()=>h});var s=i(601227),r=i(650151),n=i(486028),o=i(796966),a=i(242786);const l=s.isSafari?"click":"auxclick",c={treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!1}
;class h{constructor(e,t,i){this._clickCount=0,this._clickTimeoutId=null,this._clickPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._touchMoveStartPosition=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddlePoint=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!s.CheckMobile.iOS(),this._onFirefoxOutsideMouseUp=e=>{this._mouseUpHandler(e)},this._onMobileSafariDoubleClick=e=>{if(this._firesTouchEvents(e)){const t=this._makeCompatEvent(e);if(++this._tapCount,this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:i}=this._touchMouseMoveWithDownInfo(u(e),this._tapPosition);i<30&&!this._cancelTap&&this._processTouchEvent(t,this._handler.doubleTapEvent),this._resetTapTimeout()}}else{const t=this._makeCompatEvent(e);if(++this._clickCount,this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:i}=this._touchMouseMoveWithDownInfo(u(e),this._clickPosition);i<5&&!this._cancelClick&&this._processMouseEvent(t,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}}},this._target=e,this._handler=t,this._options=(0,n.merge)((0,n.clone)(c),i||{}),this._init()}destroy(){null!==this._unsubscribeOutsideMouseEvents&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),null!==this._unsubscribeOutsideTouchEvents&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),null!==this._unsubscribeMobileSafariEvents&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(e){this._unsubscribeMousemove&&this._unsubscribeMousemove();const t=this._mouseMoveHandler.bind(this);if(this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",t)},this._target.addEventListener("mousemove",t),this._firesTouchEvents(e))return;const i=this._makeCompatEvent(e);this._processMouseEvent(i,this._handler.mouseEnterEvent),this._acceptMouseLeave=!0}_resetClickTimeout(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickPosition={
x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){null!==this._tapTimeoutId&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(e){if(this._mousePressed||null!==this._touchMoveStartPosition)return;if(this._firesTouchEvents(e))return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handler.mouseMoveEvent),this._acceptMouseLeave=!0}_touchMoveHandler(e){const t=m(e.changedTouches,(0,r.ensureNotNull)(this._activeTouchId));if(null===t)return;if(this._lastTouchEventTimeStamp=_(e),null!==this._startPinchMiddlePoint)return;if(this._preventTouchDragProcess)return;this._pinchPrevented=!0;const i=this._touchMouseMoveWithDownInfo(u(t),(0,r.ensureNotNull)(this._touchMoveStartPosition)),{xOffset:s,yOffset:n,manhattanDistance:a}=i;if(this._touchMoveExceededManhattanDistance||!(a<5)){if(!this._touchMoveExceededManhattanDistance){const e=.5*s,t=n>=e&&!this._options.treatVertTouchDragAsPageScroll,i=e>n&&!this._options.treatHorzTouchDragAsPageScroll;t||i||(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}if(!this._preventTouchDragProcess){const i=this._makeCompatEvent(e,t);this._processTouchEvent(i,this._handler.touchMoveEvent),(0,o.preventDefault)(e)}}}_mouseMoveWithDownHandler(e){if(0!==e.button)return;const t=this._touchMouseMoveWithDownInfo(u(e),(0,r.ensureNotNull)(this._mouseMoveStartPosition)),{manhattanDistance:i}=t;if(i>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick){const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handler.pressedMouseMoveEvent)}}_touchMouseMoveWithDownInfo(e,t){const i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return{xOffset:i,yOffset:s,manhattanDistance:i+s}}_touchEndHandler(e){let t=m(e.changedTouches,(0,r.ensureNotNull)(this._activeTouchId));if(null===t&&0===e.touches.length&&(t=e.changedTouches[0]),null===t)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=_(e),this._clearLongTapTimeout(),this._touchMoveStartPosition=null,this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const i=this._makeCompatEvent(e,t);if(this._processTouchEvent(i,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:e}=this._touchMouseMoveWithDownInfo(u(t),this._tapPosition);e<30&&!this._cancelTap&&this._processTouchEvent(i,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processTouchEvent(i,this._handler.tapEvent),this._handler.tapEvent&&(0,o.preventDefault)(e));0===this._tapCount&&(0,o.preventDefault)(e),0===e.touches.length&&this._longTapActive&&(this._longTapActive=!1,(0,o.preventDefault)(e))}_mouseUpHandler(e){if(0!==e.button)return;const t=this._makeCompatEvent(e);if(this._mouseMoveStartPosition=null,this._mousePressed=!1,
this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),s.isFF){this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp)}if(!this._firesTouchEvents(e))if(this._processMouseEvent(t,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:i}=this._touchMouseMoveWithDownInfo(u(e),this._clickPosition);i<5&&!this._cancelClick&&this._processMouseEvent(t,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processMouseEvent(t,this._handler.mouseClickEvent)}_clearLongTapTimeout(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(e){if(null!==this._activeTouchId)return;const t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=_(e);const i=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartPosition=u(t),this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const t=this._touchMoveHandler.bind(this),s=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{i.removeEventListener("touchmove",t),i.removeEventListener("touchend",s)},i.addEventListener("touchmove",t,{passive:!1}),i.addEventListener("touchend",s,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),240)}const s=this._makeCompatEvent(e,t);this._processTouchEvent(s,this._handler.touchStartEvent),this._tapTimeoutId||(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapPosition=u(t))}_wheelClickHandler(e){if(1!==e.button)return;if(this._firesTouchEvents(e))return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handler.wheelClickEvent)}_mouseDownHandler(e){if(0!==e.button)return;const t=this._target.ownerDocument.documentElement;s.isFF&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartPosition=u(e),this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const e=this._mouseMoveWithDownHandler.bind(this),i=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{t.removeEventListener("mousemove",e),t.removeEventListener("mouseup",i)},t.addEventListener("mousemove",e),t.addEventListener("mouseup",i)}if(this._mousePressed=!0,this._firesTouchEvents(e))return;const i=this._makeCompatEvent(e);this._processMouseEvent(i,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickPosition=u(e))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{
const e=this._target.ownerDocument,t=e=>!e.target||!this._target.contains(e.target),i=e=>{if(!t(e))return;const i=e.changedTouches[0];this._lastTouchEventTimeStamp=_(e),this._processTouchEvent(this._makeCompatEvent(e,i),this._handler.touchStartOutsideEvent)},s=e=>{t(e)&&!this._firesTouchEvents(e)&&this._processMouseEvent(this._makeCompatEvent(e),this._handler.mouseDownOutsideEvent)};this._unsubscribeOutsideTouchEvents=()=>{e.removeEventListener("touchstart",i)},this._unsubscribeOutsideMouseEvents=()=>{e.removeEventListener("mousedown",s)},e.addEventListener("mousedown",s),e.addEventListener("touchstart",i,{passive:!0})}s.CheckMobile.iOS()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("contextmenu",this._contextMenuHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),(0,o.preventScrollByWheelClick)(this._target),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._target.addEventListener(l,this._wheelClickHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(()=>{}),{passive:!1})}_initPinch(){void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(e=>this._checkPinchState(e.touches)),{passive:!0}),this._target.addEventListener("touchmove",(e=>{if(2===e.touches.length&&null!==this._startPinchMiddlePoint&&void 0!==this._handler.pinchEvent){const t=e.touches[0],i=e.touches[1],s=p(t,i)/this._startPinchDistance,r=d(this._target);this._handler.pinchEvent(this._startPinchMiddlePoint,{x:t.clientX-r.left,y:t.clientY-r.top},{x:i.clientX-r.left,y:i.clientY-r.top},s),(0,o.preventDefault)(e)}}),{passive:!1}),this._target.addEventListener("touchend",(e=>{this._checkPinchState(e.touches)})))}_checkPinchState(e){1===e.length&&(this._pinchPrevented=!1),2!==e.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)}_startPinch(e){if(void 0!==this._handler.pinchStartEvent){const t=d(this._target),i=e[0],s=e[1],r={x:i.clientX-t.left,y:i.clientY-t.top},n={x:s.clientX-t.left,y:s.clientY-t.top};this._startPinchMiddlePoint={x:(r.x+n.x)/2,y:(r.y+n.y)/2},this._startPinchDistance=p(i,s),this._handler.pinchStartEvent(this._startPinchMiddlePoint,r,n)}this._clearLongTapTimeout()}_stopPinch(){null!==this._startPinchMiddlePoint&&(this._startPinchMiddlePoint=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())}_mouseLeaveHandler(e){if(this._unsubscribeMousemove&&this._unsubscribeMousemove(),this._firesTouchEvents(e))return;if(!this._acceptMouseLeave)return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handler.mouseLeaveEvent),this._acceptMouseLeave=!s.CheckMobile.iOS()}_longTapHandler(e){const t=m(e.touches,(0,
r.ensureNotNull)(this._activeTouchId));if(null===t)return;const i=this._makeCompatEvent(e,t);this._processTouchEvent(i,this._handler.longTapEvent),this._processTouchEvent(i,this._handler.touchContextMenuEvent),this._cancelTap=!0,this._longTapActive=!0}_contextMenuHandler(e){if((0,o.preventDefault)(e),null!==this._touchMoveStartPosition)return;if(this._firesTouchEvents(e))return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handler.contextMenuEvent),this._cancelClick=!0}_firesTouchEvents(e){return e.sourceCapabilities&&void 0!==e.sourceCapabilities.firesTouchEvents?e.sourceCapabilities.firesTouchEvents:_(e)<this._lastTouchEventTimeStamp+500}_processTouchEvent(e,t){(0,a.setLastMouseOrTouchEventInfo)(e),t&&t.call(this._handler,e)}_processMouseEvent(e,t){"mouseleave"!==e.srcType&&(0,a.setLastMouseOrTouchEventInfo)(e),t&&t.call(this._handler,e)}_makeCompatEvent(e,t){const i=t||e,s=this._target.getBoundingClientRect()||{left:0,top:0};return{clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,localX:i.clientX-s.left,localY:i.clientY-s.top,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey,isTouch:!e.type.startsWith("mouse")&&"contextmenu"!==e.type&&"click"!==e.type,stylus:"stylus"===(null==t?void 0:t.touchType),srcType:e.type,target:i.target,view:e.view,preventDefault:()=>{"touchstart"!==e.type&&(0,o.preventDefault)(e)}}}}function d(e){return e.getBoundingClientRect()||{left:0,top:0}}function u(e){return{x:e.pageX,y:e.pageY}}function p(e,t){const i=e.clientX-t.clientX,s=e.clientY-t.clientY;return Math.sqrt(i*i+s*s)}function _(e){return e.timeStamp||performance.now()}function m(e,t){for(let i=0;i<e.length;++i)if(e[i].identifier===t)return e[i];return null}},29161:(e,t,i)=>{"use strict";i.d(t,{navigationButtonsVisibilityKey:()=>r,property:()=>n,availableValues:()=>o,actualBehavior:()=>a});var s=i(734137);const r="NavigationButtons.visibility",{property:n,availableValues:o,actualBehavior:a}=(0,s.createVisibilityController)(r)},822962:(e,t,i)=>{"use strict";i.d(t,{NewsApi:()=>s});class s{constructor(e){this._widgetBarNews=e}refresh(){this._widgetBarNews.refresh()}}},633177:(e,t,i)=>{"use strict";i.d(t,{property:()=>n,availableValues:()=>o,actualBehavior:()=>a});var s=i(734137),r=i(29161);const{property:n,availableValues:o,actualBehavior:a}=(0,s.createVisibilityController)("PaneButtons.visibility",r.navigationButtonsVisibilityKey)},72588:(e,t,i)=>{"use strict";i.d(t,{ActionBinder:()=>s});class s{constructor(e,t,i,s,r=null){this._property=t,this._undoModel=i,this._undoText=s,this._action=e,this.setValue(t.value()),t.subscribe(this,this._propertyChanged),null!==r?e.update({onExecute:r.bind(this)}):e.update({onExecute:this._onActionCallback.bind(this)})}destroy(){this._property.unsubscribe(this,this._propertyChanged)}value(){return this._action.isChecked()}setValue(e){this._action.update({checked:Boolean(e)})}_onActionCallback(){this._undoModel.setProperty(this._property,this.value(),this._undoText)}_propertyChanged(e){this.setValue(e.value())}}
},742897:(e,t,i)=>{"use strict";i.d(t,{isCustomStudy:()=>r});const s={VbPFixed:!0,PivotPointsStandard:!0,VbPVisible:!0};function r(e){return e in s}},139352:(e,t,i)=>{"use strict";i.d(t,{MetaInfoHelper:()=>u});var s=i(650151),r=i(898005),n=i(444649),o=i(486028),a=i(817808),l=i(939291);function c(e){return!e.groupId&&!e.isHidden&&e.id!==l.RangeDependentStudyInputNames.FirstBar&&e.id!==l.RangeDependentStudyInputNames.LastBar}var h=i(742897);const d=(0,a.getLogger)("Platform.GUI.PropertyDialog.Indicators.MetaInfo");class u{constructor(e){this._metaInfo=e}hasUserEditableInputs(){return this._metaInfo.inputs.some(c)}getUserEditableInputs(){return this._metaInfo.inputs.filter(c)}hasUserEditableProperties(){return r.StudyMetaInfo.isScriptStrategy(this._metaInfo)}hasUserEditableStyles(){const e=this._metaInfo;return e.plots.length>0||void 0!==e.bands||void 0!==e.filledAreas||(0,h.isCustomStudy)(e.shortId)||r.StudyMetaInfo.isScriptStrategy(this._metaInfo)||Object.values(e.graphics).some((e=>void 0!==e))}getUserEditablePlots(){const e=new Set,t=this._metaInfo;return t.plots.filter((i=>{if((0,n.isColorerPlot)(i)||(0,n.isTextColorerPlot)(i)||(0,n.isDataOffsetPlot)(i)||(0,n.isOhlcColorerPlot)(i)||(0,n.isAlertConditionPlot)(i)||(0,n.isDataPlot)(i))return!1;if((0,n.isOhlcPlot)(i)){const r=i.target;if(e.has(r))return!1;e.add(r);const n=(0,s.ensureDefined)(t.ohlcPlots);return!(0,s.ensureDefined)(n[r]).isHidden}{const e=t.styles?t.styles[i.id]:void 0;return void 0===e||!e.isHidden}}))}hasUserEditableOptions(){return this.hasUserEditableInputs()||this.hasUserEditableProperties()||this.hasUserEditableStyles()}getStrategyProperties(){const e=this._metaInfo,t=e.inputs.filter(_),i={...p};for(const s of t){const t=s.internalID;i[t]=s,p.hasOwnProperty(t)||d.logWarn(`Unknown strategy input internal id ${t} in ${e.fullId}`)}return(0,o.clone)(i)}}const p={currency:void 0,backtest_fill_limits_assumption:void 0,calc_on_every_tick:void 0,calc_on_order_fills:void 0,commission_value:void 0,commission_type:void 0,initial_capital:void 0,pyramiding:void 0,slippage:void 0,default_qty_type:void 0,default_qty_value:void 0,margin_long:void 0,margin_short:void 0,use_bar_magnifier:void 0,process_orders_on_close:void 0};function _(e){return"strategy_props"===e.groupId}},60707:(e,t,i)=>{"use strict";i.d(t,{checkAuthBeforeSaveLoad:()=>r});var s=i(484727);function r(e,t){s.enabled("saveload_requires_authentication")?window.runOrSignIn(e,t):e()}},271552:(e,t,i)=>{"use strict";i.d(t,{AbstractJsonStoreService:()=>n,CommonJsonStoreService:()=>o});var s=i(922157),r=i.n(s);class n{constructor(e,t,i,s,n){this._onChange=new(r()),this._handleChange=()=>{this._onChange.fire(this.get())},this._crossTabEvents=e,this._jsonKeyValueStore=t,this.CROSSTAB_EVENT_NAME=i,this.JSON_STORE_KEY=s,this.defaultStoreValue=this._serialize(n),this._subscribe()}get(){const e=this._jsonKeyValueStore.getJSON(this.JSON_STORE_KEY,this.defaultStoreValue);return this._deserialize(e)}set(e,t){const i=this._serialize(e);this._jsonKeyValueStore.setJSON(this.JSON_STORE_KEY,i,t),
this._crossTabEvents.emit(this.CROSSTAB_EVENT_NAME),this._onChange.fire(e)}getOnChange(){return this._onChange}destroy(){this._unsubscribe(),this._onChange.destroy(),delete this._onChange}_subscribe(){this._crossTabEvents.on(this.CROSSTAB_EVENT_NAME,this._handleChange),this._jsonKeyValueStore.onSync.subscribe(this,this._handleChange)}_unsubscribe(){this._crossTabEvents.off(this.CROSSTAB_EVENT_NAME,this._handleChange),this._jsonKeyValueStore.onSync.unsubscribe(this,this._handleChange)}}class o extends n{_serialize(e){return e}_deserialize(e){return e}}},922236:(e,t,i)=>{"use strict";i.d(t,{LoadChartService:()=>d});var s=i(484727),r=i(646846),n=i(60707),o=i(231605),a=i(717866),l=i(870122),c=i(271552);class h extends c.CommonJsonStoreService{constructor(e,t){super(e,t,"FAVORITE_CHARTS_CHANGED","loadChartDialog.favorites",{})}}class d extends o.DialogRenderer{constructor(e=null){super(),this._chartWidgetCollection=null,this._promise=null,this._dialog=null,this._subscribe=e=>{this._setVisibility(e)},this._getChartEntry=e=>({id:e.id,url:e.url,title:e.name,symbol:e.short_symbol,interval:e.interval,toolsCount:0,modified:e.modified_iso,favorite:void 0,active:()=>this._isActiveChart(e.id),openAction:()=>r.backend.loadChart(e),deleteAction:()=>r.backend.removeChart(e.image_url).then((()=>this._deleteChart(e.id))),favoriteAction:e=>Promise.resolve(this._updateFavorites(e))}),this._updateFavorites=e=>{var t;null===(t=this._favoriteChartsService)||void 0===t||t.set(e)},this._isActiveChart=e=>null!==this._chartWidgetCollection&&e===this._chartWidgetCollection.metaInfo.id.value(),this._deleteChart=e=>{this._isActiveChart(e)&&(s.enabled("saveload_storage_customization")?null!==this._chartWidgetCollection&&this._chartWidgetCollection.clearChartMetaInfo():location.href="/chart/"+location.search)},this._chartWidgetCollection=e,this._favoriteChartsService=new h(a.TVXWindowEvents,l)}showLoadDialog(){(0,n.checkAuthBeforeSaveLoad)(this._showLoadDialog.bind(this),{source:"Load chart",sourceMeta:"Chart"})}show(){this.showLoadDialog()}hide(){var e,t;null===(e=this._dialog)||void 0===e||e.hide(),null===(t=this._dialog)||void 0===t||t.visible().unsubscribe(this._subscribe)}_showLoadDialog(){(s.enabled("saveload_requires_authentication")&&!window.is_authenticated?Promise.resolve([]):r.backend.getCharts()).then((e=>e.map(this._getChartEntry))).then((e=>{const t=this._promise=Promise.all([i.e(7624),i.e(8230),i.e(9333),i.e(9602),i.e(1901),i.e(1428),i.e(1685),i.e(8009),i.e(8271),i.e(4412),i.e(8484),i.e(784),i.e(1830),i.e(962),i.e(9255),i.e(37),i.e(766),i.e(4104),i.e(412),i.e(5009)]).then(i.bind(i,219114)).then((i=>{if(this._promise===t){this._dialog&&(this._dialog.hide(),this._dialog.visible().unsubscribe(this._subscribe));const t={charts:e,favoriteChartsService:this._favoriteChartsService,chartWidgetCollection:this._chartWidgetCollection};this._dialog=new i.LoadChartDialogRenderer(t),this._dialog.visible().subscribe(this._subscribe),this._dialog.show()}}))}))}async _changeFavoriteState(e,t,i){return Promise.resolve()}}},413752:(e,t,i)=>{"use strict"
;i.d(t,{SaveChartService:()=>v});var s=i(484727),r=i(210596),n=i.n(r),o=i(559410),a=i(525668),l=i(60707);i(603605);s.enabled("atsv2s");var c=i(509806),h=i(646846);async function d(){return!0}var u=i(153055);const p=s.enabled("confirm_overwrite_if_chart_layout_with_name_exists");class _{constructor(e,t,i){this._visibility=new(n())(!1),this._chartWidgetCollection=e,this._doSave=t,this._doLoad=i}hide(){var e;null===(e=this._hide)||void 0===e||e.call(this),this._visibility.setValue(!1)}visible(){return this._visibility.readonly()}_showRenameDialog(e,t,s,r){return(0,u.showRename)({title:this._renameDialogTitle(),text:this._renameDialogText(),maxLength:64,initValue:e,onRename:async e=>{if(!p)return void this._renameActionHandler(e,t,s,r);const{newValue:n,dialogClose:o}=e,a=(await this._doLoad()).find((e=>e.name===n));o(),void 0!==a?this._hide=await(0,u.showConfirm)({title:c.t(null,void 0,i(356996)),text:c.t(null,void 0,i(330192)),onConfirm:({dialogClose:e})=>{e(),this._doOverwriteExistingLayout(a.id,n,t,s,r)},onCancel:({dialogClose:e})=>{e(),this._showRenameDialog(n,t,s,r)}}):this._renameActionHandler({newValue:n,dialogClose:o},t,s,r)},onClose:()=>this._visibility.setValue(!1)})}_doSaveCurrentLayout(e,t,i,s){const r=this._chartWidgetCollection.metaInfo.name.value();this._chartWidgetCollection.metaInfo.name.setValue(e),this._doSave(t,i,(()=>{this._chartWidgetCollection.metaInfo.name.setValue(r),null==s||s()}))}_doOverwriteExistingLayout(e,t,i,s,r){const n=this._chartWidgetCollection.metaInfo.name.value();this._chartWidgetCollection.metaInfo.id.setValue(e),this._chartWidgetCollection.metaInfo.name.setValue(t),this._doSave(i,s,(()=>{this._chartWidgetCollection.metaInfo.name.setValue(n),null==r||r()}))}}class m extends _{cloneChart(){this._cloneChart().then((()=>this._visibility.setValue(!0)))}show(){(0,l.checkAuthBeforeSaveLoad)((()=>this.cloneChart()),{source:"Clone chart"})}_renameDialogTitle(){return c.t(null,void 0,i(287898))}_renameDialogText(){return c.t(null,void 0,i(724435))+":"}_renameActionHandler({newValue:e,dialogClose:t}){s.enabled("saveload_storage_customization")&&this._doCloneCurrentLayout(e),t()}async _cloneChart(){const e=await d();e&&(this._hide=await this._showRenameDialog(this._getInitialRenameDialogInput()))}_doCloneCurrentLayout(e){const t=this._chartWidgetCollection.metaInfo.name.value();this._chartWidgetCollection.metaInfo.uid.deleteValue(),this._chartWidgetCollection.metaInfo.id.deleteValue(),this._chartWidgetCollection.metaInfo.name.setValue(e),this._doSave(void 0,void 0,(()=>{this._chartWidgetCollection.metaInfo.name.setValue(t)}))}_getInitialRenameDialogInput(){return c.t(null,{context:"ex: AAPL chart copy"},i(416493)).format({title:this._chartWidgetCollection.metaInfo.name.value()})}}class g extends _{show(e,t,i){this._saveNewChart(e,t,i).then((()=>this._visibility.setValue(!0)))}_renameDialogTitle(){return c.t(null,void 0,i(110520))}_renameDialogText(){return c.t(null,void 0,i(724435))+":"}_renameActionHandler({newValue:e,dialogClose:t},i,s,r){this._doSaveCurrentLayout(e,i,s,r),t()}
async _saveNewChart(e,t,i){await d();const s=this._chartWidgetCollection.metaInfo.name.value();this._hide=await this._showRenameDialog(s,e,t,i)}}class f extends _{show(){(0,l.checkAuthBeforeSaveLoad)((()=>this._show()),{source:"Rename chart"})}_renameDialogTitle(){return c.t(null,void 0,i(204142))}_renameDialogText(){return c.t(null,void 0,i(724435))+":"}_renameActionHandler({newValue:e,dialogClose:t}){this._doSaveCurrentLayout(e),t()}async _show(){await this._renameChart(),this._visibility.setValue(!0)}async _renameChart(){const e=this._chartWidgetCollection.metaInfo.name.value();this._hide=await this._showRenameDialog(e)}}class v{constructor(e,t){this._autosaveTimer=null,this._watchedAutoSaveEnabled=new(n()),this._toggleAutoSaveEnabledHandler=this._toggleAutoSaveEnabled.bind(this),this._doSave=(e,t,i,s)=>{const r=this._chartWidgetCollection;void 0!==e&&e();const n=this._chartChangesWatcher.changes();this._chartSaver.saveChartSilently((e=>{var i;i=r.metaInfo.uid.value(),"/chart/"===location.pathname&&(location.href="/chart/"+i),void 0!==t&&t(e)}),(()=>{void 0!==i&&i()}),{autoSave:Boolean(s),changes:n})},this._doLoad=()=>h.backend.getCharts(),this._chartWidgetCollection=e,this._chartSaver=t,this._createController=new g(e,this._doSave,this._doLoad),this._renameController=new f(e,this._doSave,this._doLoad),this._saveAsController=new m(e,this._doSave,this._doLoad),this._chartChangesWatcher=new a.ChartChangesWatcher(e,t,o),e.saveKeysPressed().subscribe(this,this.saveChartOrShowTitleDialog),this._chartChangesWatcher.getOnChange().subscribe(this,this._onStateChanged)}autoSaveEnabled(){return this._watchedAutoSaveEnabled}destroy(){0}getCreateController(){return this._createController}getRenameController(){return this._renameController}getSaveAsController(){return this._saveAsController}cloneChart(){this._saveAsController.cloneChart()}saveChartAs(){this._saveAsController.show()}renameChart(){this._renameController.show()}saveNewChart(e,t,i){this._createController.show(e,t,i)}saveExistentChart(e,t,i){this._doSave(e,t,i)}changes(){return this._chartChangesWatcher.changes()}hasChanges(){return 0!==this._chartChangesWatcher.changes()}saveChartOrShowTitleDialog(e,t,i){const s=window.saver.isSaveInProcess(),r=this._chartChangesWatcher.hasChanges(),n=!!this._chartWidgetCollection.metaInfo.id.value();window.is_authenticated&&(s||!r&&n)||(0,l.checkAuthBeforeSaveLoad)((()=>{null!=this._chartWidgetCollection.metaInfo.id.value()?this.saveExistentChart(e,t,i):this.saveNewChart(e,t,i)}),{source:"Save chart",sourceMeta:"Chart"})}saveToJSON(){return this._chartSaver.saveToJSON()}saveChartSilently(e,t,i){this._chartSaver.saveChartSilently(e,t,i)}setAutoSaveEnabled(e){window.is_authenticated&&window.saver.isSaveInProcess()||(0,l.checkAuthBeforeSaveLoad)((()=>{this._watchedAutoSaveEnabled.setValue(e)}),{source:"AutoSave chart"})}saveChartLineTools(e,t,i,s){return this._chartSaver.saveChartLineTools(e,t,i,s)}_autoSaveEnabledSettingHandler(e){0}_toggleAutoSaveEnabled(e){0}_enableAutoSave(){0}_disableAutoSave(){0}_onStateChanged(e){
e?this._startAutosave():this._stopAutosave()}_startAutosave(){s.enabled("charts_auto_save")&&null===this._autosaveTimer&&(this._autosaveTimer=setTimeout((()=>{this._autosaveTimer=null,this._chartWidgetCollection.metaInfo.id.value()&&this._doSave(void 0,void 0,void 0,!0)}),6e4))}_stopAutosave(){null!==this._autosaveTimer&&(clearInterval(this._autosaveTimer),this._autosaveTimer=null)}}},857192:(e,t,i)=>{"use strict";i.d(t,{showMarketOpenStatusProperty:()=>a,restoreShowMarketOpenStatusProperty:()=>l});var s=i(149926),r=i(870122);const n="Chart.ShowMarketOpenStatus";function o(){return r.getBool(n,true)}const a=(0,s.createPrimitiveProperty)(o());function l(){a.setValue(true),r.remove(n)}r.onSync.subscribe(null,(()=>a.setValue(o()))),a.subscribe(null,(()=>r.setValue(n,a.value())))},982129:(e,t,i)=>{"use strict";i.d(t,{firstReplacedByBatsExchange:()=>a,isEod:()=>l,isYield:()=>c,isDelay:()=>h,witoutRealtime:()=>d,getExchange:()=>u});i(650151);var s=i(373728),r=i.n(s);i(632054);const n=["DJ","CBOE","JSE"],o=["NZX"];function a(e){return null}function l(e,t){return r().hasEodSymbols(e.full_name)||6===t}function c(e){var t;return Boolean(null===(t=e.typespecs)||void 0===t?void 0:t.includes("yield"))}function h(e){return void 0!==e&&e>0}function d(e){return"index"===e.type&&n.includes(e.listed_exchange)||"futures"===e.type&&o.includes(e.listed_exchange)}async function u(e){return null}},769914:(e,t,i)=>{"use strict";i.d(t,{StudyTemplates:()=>p});var s=i(509806),r=i(646846),n=i(32133),o=i(922157),a=i.n(o),l=i(210596),c=i.n(l),h=i(153055);const d=(0,i(817808).getLogger)("Platform.StudyTemplates"),u=s.t(null,void 0,i(897065));class p{constructor(e){this._chartWidgetCollection=e.chartWidgetCollection,this._favoriteStudyTemplatesService=e.favoriteStudyTemplatesService,window.loginStateChange.subscribe(null,r.backend.invalidateStudyTemplatesList),this._list=new(c())([]),this._onChange=new(a()),this._list.subscribe((()=>this._onChange.fire()))}findRecordByName(e){return this._list.value().find((t=>t.name===e))||null}showSaveAsDialog(){const e=this._chartWidgetCollection.activeChartWidget.value().model();Promise.all([i.e(8230),i.e(4819),i.e(346),i.e(9602),i.e(1901),i.e(5761),i.e(1428),i.e(8619),i.e(1685),i.e(4884),i.e(1140),i.e(7177),i.e(6812),i.e(4147),i.e(962),i.e(766),i.e(1309),i.e(6631)]).then(i.bind(i,359091)).then((t=>{new t.StudyTemplateSaver({controller:e,onSave:e=>{this._list.setValue(e)}}).show()}))}applyTemplate(e){const t=this.findRecordByName(e);null!==t?window.runOrSignIn((()=>{const e=this._chartWidgetCollection.activeChartWidget.value(),i=i=>{(0,n.trackEvent)("GUI","Load Study Template"),e.model().applyStudyTemplate(JSON.parse(i.content),t.name)};void 0!==t.id?t.is_default?r.backend.getStandardStudyTemplateContentById(t.id,i):r.backend.getStudyTemplateContentById(t.id,i):r.backend.getStudyTemplateContent(t.name).then(i)}),{source:"Study templates apply"}):d.logNormal(`Template ${e} not found in cache`)}deleteStudyTemplate(e){const t=this.findRecordByName(e)
;null!==t?this._removeTemplate(t):d.logNormal(`Template ${e} not found in cache`)}list(){return this._list.value()}getOnChange(){return this._onChange}refreshStudyTemplateList(e){r.backend.getStudyTemplatesList().then((t=>{this._list.setValue(t),void 0!==e&&e()}))}invalidate(){r.backend.invalidateStudyTemplatesList()}_removeTemplate(e){window.runOrSignIn((()=>{(0,h.showConfirm)({text:u.format({name:e.name}),onConfirm:({dialogClose:t})=>new Promise((i=>{const s=()=>{this.refreshStudyTemplateList((()=>{const s=this.list();this._list.setValue(s.filter((t=>t!==e))),this._favoriteStudyTemplatesService&&this._favoriteStudyTemplatesService.remove(e.name),i(),t()}))};r.backend.invalidateStudyTemplatesList(),void 0!==e.id?r.backend.removeStudyTemplateById(e.id,s):r.backend.removeStudyTemplate(e.name).then(s)}))})}),{source:"Study templates delete"})}}},282898:(e,t,i)=>{"use strict";i.d(t,{canShowSpreadActions:()=>r,globalKeypressMatches:()=>n});var s=i(484727);i(382213),i(688401);new RegExp("^quandl","i");function r(){let e=!1;return s.enabled("show_spread_operators")&&(e=!0),e}function n(e){if(e.ctrlKey)return!1;if(e.metaKey)return!1;if(!e.charCode)return!1;if(!e.which||e.which<=32)return!1;const t=e.target;return!t||!/^(input|textarea)$/i.test(t.tagName)&&"listbox"!==t.getAttribute("role")}},230356:(e,t,i)=>{"use strict";function s(){return Promise.all([i.e(8230),i.e(4819),i.e(9602),i.e(1901),i.e(8825),i.e(1428),i.e(1685),i.e(8707),i.e(8271),i.e(3261),i.e(2196),i.e(175),i.e(962),i.e(9255),i.e(37),i.e(766),i.e(1534),i.e(1754)]).then(i.bind(i,723698))}i.d(t,{loadNewSymbolSearch:()=>s})},254572:(e,t,i)=>{"use strict";i.d(t,{ToastsFactory:()=>s});class s{constructor(e,t){this._chartToastsPromise=null,this._resizerBridge=e,this._bottomToolbarOffsetHeightProvider=t}async getChartToasts(){return null!==this._chartToastsPromise||(this._chartToastsPromise=async function(){return Promise.all([Promise.all([i.e(1217),i.e(6851),i.e(962),i.e(8244),i.e(3088)]).then(i.bind(i,642761)),Promise.all([i.e(1217),i.e(7742),i.e(962),i.e(8244),i.e(4291)]).then(i.bind(i,355485))]).then((e=>[e[0].ChartToasts,e[1].globalToasts]))}().then((e=>{const t=e[0],i=e[1];return new t(this._resizerBridge,this._resizerBridge.container.value(),i,this._bottomToolbarOffsetHeightProvider())}))),this._chartToastsPromise}}},808510:(e,t,i)=>{"use strict";i.d(t,{createTradeContext:()=>r});var s=i(650151);async function r(e,t){let i=NaN,r=NaN,n="";const o=e.proSymbol(),a=(e.symbolInfo()||{name:null}).name||o,l=e.priceScale();if(t){const s=e.firstValue();i=null!==s?l.coordinateToPrice(t,s):null,n=null!==i?e.formatter().format(i):""}const c=e.bars().last();null!==c&&(r=(0,s.ensure)(c.value[TradingView.CLOSE_PLOT]));return{symbol:o,displaySymbol:a,value:i,formattedValue:n,last:r,symbolInfoTradable:!!(e.symbolInfo()||{is_tradable:!1}).is_tradable}}},122621:(e,t,i)=>{"use strict";var s,r,n,o,a,l,c,h,d,u,p,_,m,g,f;i.r(t),i.d(t,{CONNECTSTATUSES:()=>s,ORDERTYPE:()=>r,SIDE:()=>n,ORDERSTATUS:()=>o,ORDERSTATUSFILTER:()=>a,TradingEntityType:()=>l,PARENTTYPE:()=>c,BracketType:()=>h,
TICKETFOCUS:()=>d,NOTIFICATION:()=>u,OrderOrPositionMessageType:()=>p,AccountType:()=>_,DisconnectType:()=>m,PipValueType:()=>g,RestrictionType:()=>f}),function(e){e[e.CONNECTED=1]="CONNECTED",e[e.CONNECTING=2]="CONNECTING",e[e.DISCONNECTED=3]="DISCONNECTED",e[e.ERROR=4]="ERROR"}(s||(s={})),function(e){e[e.LIMIT=1]="LIMIT",e[e.MARKET=2]="MARKET",e[e.STOP=3]="STOP",e[e.STOPLIMIT=4]="STOPLIMIT"}(r||(r={})),function(e){e[e.BUY=1]="BUY",e[e.SELL=-1]="SELL"}(n||(n={})),function(e){e[e.CANCELED=1]="CANCELED",e[e.FILLED=2]="FILLED",e[e.INACTIVE=3]="INACTIVE",e[e.PLACING=4]="PLACING",e[e.REJECTED=5]="REJECTED",e[e.WORKING=6]="WORKING"}(o||(o={})),function(e){e[e.ALL=0]="ALL",e[e.CANCELED=1]="CANCELED",e[e.FILLED=2]="FILLED",e[e.INACTIVE=3]="INACTIVE",e[e.REJECTED=5]="REJECTED",e[e.WORKING=6]="WORKING"}(a||(a={})),function(e){e[e.Order=1]="Order",e[e.Position=2]="Position"}(l||(l={})),function(e){e[e.ORDER=1]="ORDER",e[e.POSITION=2]="POSITION"}(c||(c={})),function(e){e[e.StopLoss=0]="StopLoss",e[e.TakeProfit=1]="TakeProfit",e[e.TrailingStop=2]="TrailingStop"}(h||(h={})),function(e){e[e.LIMITPRICE=1]="LIMITPRICE",e[e.STOPPRICE=2]="STOPPRICE",e[e.TAKEPROFIT=3]="TAKEPROFIT",e[e.STOPLOSS=4]="STOPLOSS"}(d||(d={})),function(e){e[e.ERROR=0]="ERROR",e[e.SUCCESS=1]="SUCCESS"}(u||(u={})),function(e){e.Information="information",e.Warning="warning",e.Error="error"}(p||(p={})),function(e){e.Demo="demo",e.Live="live"}(_||(_={})),function(e){e[e.LogOut=0]="LogOut",e[e.FailedRestoring=1]="FailedRestoring",e[e.Offline=2]="Offline",e[e.APIError=3]="APIError",e[e.TwoFactorRequired=4]="TwoFactorRequired",e[e.CancelAuthorization=5]="CancelAuthorization",e[e.TimeOutForAuthorization=6]="TimeOutForAuthorization",e[e.OauthError=7]="OauthError",e[e.BrokenConnection=8]="BrokenConnection"}(m||(m={})),function(e){e[e.None=0]="None",e[e.Pips=1]="Pips",e[e.Ticks=2]="Ticks"}(g||(g={})),function(e){e.Halted="HALTED",e.NotShortable="NOT-SHORTABLE",e.HardToBorrow="HARD-TO-BORROW"}(f||(f={}))},900298:(e,t,i)=>{"use strict";i.r(t),i.d(t,{addRealtimeToBroker:()=>a,addDomeToBroker:()=>l,addConnectionStatusToBroker:()=>c});var s=i(698320),r=i(643770),n=i.n(r);let o=0;function a(e,t){const i=e;if(void 0===i.subscribeRealtime||void 0===i.unsubscribeRealtime){const e={},r=new s.BrokerRealtimeAdapter("bwr_"+o++);i.subscribeRealtime=i=>{e[i]=t.realtimeUpdate.bind(t),r.subscribeRealtime(i,e[i])},i.unsubscribeRealtime=t=>{r.unsubscribeRealtime(t,e[t]),delete e[t]}}return i}function l(e,t,i){if(void 0===e.subscribeDOME&&void 0===e.unsubscribeDOME){const s={};e.subscribeDOME=e=>{s[e]=new(n())(i,0,0);s[e].connect((i=>{function s(e){return e.map((e=>({price:e.p,volume:e.v})))}if("dd"!==i.method&&"dpu"!==i.method)return;const r="dd"===i.method,n=i.params[0];t.domeUpdate(e,{snapshot:r,asks:s(n.asks),bids:s(n.bids)})})),s[e].depthSetSymbol(e)},e.unsubscribeDOME=e=>{s[e]&&(s[e].stopSession(),delete s[e])}}return e}function c(e){e.connectionStatus=()=>1}},698320:(e,t,i)=>{"use strict";i.d(t,{BrokerRealtimeAdapter:()=>o});var s=i(821737),r=i(588163),n=i(778389);class o{
constructor(e){this._realtimeSubscriptions={},this._domeSubscriptions={},this._lastQuoteValues={},this._realtimeSubscriptions={},this._lastQuoteValues={},this._connectionId=e}isTradable(e){return Promise.resolve({tradable:!1})}connectionStatus(){return 3}formatter(e){return(0,r.getQuoteSessionInstance)("simple").formatter(e,!0)}spreadFormatter(e){const t=(0,r.getQuoteSessionInstance)("simple");return Promise.all([t.snapshot(e),t.formatter(e)]).then((([e,t])=>{const i=t.state();return"forex"!==e.type&&"cfd"!==e.type||!i.minMove2?t:new s.PriceFormatter(i.minMove2)}))}quantityFormatter(e){return Promise.resolve(new n.QuantityFormatter)}symbolInfo(e){return(0,r.getQuoteSessionInstance)("simple").snapshot(e).then((e=>({minTick:e.minmov/e.pricescale,qty:{min:1,max:1e10,step:1},description:e.description,pipValue:NaN,pipSize:NaN})))}subscribeRealtime(e,t){let i=!1;this._realtimeSubscriptions[e]||(this._realtimeSubscriptions[e]=[],i=!0);const s=this._realtimeSubscriptions[e];function n(e){let t;const i=e.values,s=i.ask||i.last_price,r=i.bid||i.last_price;i.spread?t=i.spread:("forex"===i.type||"cfd"===i.type)&&void 0!==r&&void 0!==s&&i.minmove2&&i.pricescale&&(t=(s-r)*i.pricescale/i.minmove2);const n="delayed"===e.values.update_mode||"delayed_streaming"===e.values.update_mode;return{ask:s,ask_size:i.ask_size,bid:r,bid_size:i.bid_size,size:i.volume,spread:t,trade:i.last_price,type:i.type,originalName:i.original_name,isDelayed:n}}if(s.push(t),i)(0,r.getQuoteSessionInstance)("full").subscribe(this._connectionId,e,((t,i)=>{if(t.error||!t.values||!t.values.pricescale)return;this._lastQuoteValues[e]=t;const r=n(t);"is_tradable"in t.values&&(r.is_tradable=t.values.is_tradable);for(let t=0;t<s.length;t++)s[t](e,r)}));else if(this._lastQuoteValues[e]){const i=n(this._lastQuoteValues[e]);t(e,i)}}unsubscribeRealtime(e,t){var i;const s=this._realtimeSubscriptions[e];if(!s)return;const n=s.indexOf(t);-1!==n&&(s.splice(n,1),s.length||(delete this._realtimeSubscriptions[e],null===(i=(0,r.getQuoteSessionNoEnsure)("full"))||void 0===i||i.unsubscribe(this._connectionId,e)))}subscribeDOME(e,t){const i=["bitcoin","crypto","index"];let s=!1;this._domeSubscriptions[e]||(this._domeSubscriptions[e]=[],s=!0);const n=this._domeSubscriptions[e];function o(e){const t=e.values.ask||e.values.last_price,s=e.values.bid||e.values.last_price,r=i.includes(e.values.type)?0:e.values.ask_size||1/0,n=i.includes(e.values.type)?0:e.values.bid_size||1/0;return{snapshot:!0,asks:t?[{price:t,volume:r}]:[],bids:s?[{price:s,volume:n}]:[]}}if(n.push(t),s)(0,r.getQuoteSessionInstance)("full").subscribe(this._connectionId+"dom",e,((t,i)=>{if(t.error||!t.values||!t.values.pricescale)return;this._lastQuoteValues[e]=t;const s=o(t);for(let t=0;t<n.length;t++)n[t](e,s)}));else if(this._lastQuoteValues[e]){const i=o(this._lastQuoteValues[e]);t(e,i)}}unsubscribeDOME(e,t){const i=this._domeSubscriptions[e];if(!i)return;const s=i.indexOf(t);-1!==s&&(i.splice(s,1),i.length||(delete this._domeSubscriptions[e],(0,
r.getQuoteSessionInstance)("full").unsubscribe(this._connectionId+"dom",e)))}quotesSnapshot(e){return new Promise((t=>{const i=(e,s)=>{this.unsubscribeRealtime(e,i),t(s)};this.subscribeRealtime(e,i)}))}}},991429:(e,t,i)=>{"use strict";var s;i.d(t,{TradingPage:()=>s,maxPanelWidth:()=>r,panelWidth:()=>n,panelHeight:()=>o}),function(e){e.DomPanel="domPanel",e.OrderPanel="orderPanel"}(s||(s={}));const r=400,n=315,o=451},140641:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TRADING_SERVICE:()=>r,tradingService:()=>n,waitTradingService:()=>o});var s=i(33290);const r={id:"TradingService"};function n(){return(0,s.hasService)(r)?(0,s.service)(r):null}function o(){return(0,s.waitServiceRegistered)(r)}},129917:(e,t,i)=>{"use strict";i.d(t,{migrateConfigFlags:()=>r});const s=(0,i(817808).getLogger)("Trading.Migrations");function r(e){!e.hasOwnProperty("supportBrackets")||e.hasOwnProperty("supportOrderBrackets")||e.hasOwnProperty("supportPositionBrackets")||(s.logWarn("supportBrackets is deprecated. Use supportOrderBrackets and supportPositionBrackets instead."),e.supportOrderBrackets=e.supportBrackets,e.supportPositionBrackets=e.supportBrackets),e.hasOwnProperty("supportModifyOrder")&&(s.logWarn("supportModifyOrder is deprecated. Use supportModifyOrderPrice, supportEditAmount and supportModifyBrackets instead."),e.supportModifyOrderPrice=e.supportModifyOrder,e.supportEditAmount=e.supportModifyOrder,e.supportModifyBrackets=e.supportModifyOrder)}},128943:(e,t,i)=>{"use strict";i.d(t,{settingsKeys:()=>s});const s={ACTIVE_BROKER:"trading.active_broker",PROPERTIES:"trading.chart.proterty",PROFIT_VIEW_TYPE:"trading.dom.profitViewType",ORDER_WIDGET_MODE:"trading.orderWidgetMode.",DOM_DURATION:"trading.domDuration.",TRADING_PANEL_OPENED:"trading.tradingPanelOpened",TRADING_PANEL_ACTIVE_PAGE:"trading.tradingPanelActivePage",PANEL_WIDTH:"trading.panelWidth",PANEL_HEIGHT:"trading.panelHeight",ORDER_PANEL_SETTINGS:"trading.orderPanelSettings",FAVORITE_BROKERS:"trading.panelFavorite",SHOW_TOOLTIP_FOR_SELECT_BROKER:"trading.showTooltipForSelectBroker",LOGIN_COUNTER:"trading.brokerLogInCounter",LOGOUT_COUNTER:"trading.brokerLogOutCounter",DISABLED_CONFIRMATIONS:"trading.disabledConfirmations",MOVE_TRADED_SOURCE_WITH_SHIFT:"trading.chart.moveWithShift",REALTIME_DATA_ACCEPTED:"trading.realTimeDataAccepted"}},536110:(e,t,i)=>{"use strict";i.d(t,{TradingViewApiBase:()=>b});var s=i(650151),r=i(688401),n=i(484727),o=i(421721),a=i(32133),l=i(9316),c=i(702054),h=i(922157),d=i.n(h);class u{constructor(e){this._toolbarThemeChanged=new(d()),this._onWatchedThemeChanged=e=>{this._toolbarThemeChanged.fire(e)},this._opts=e,c.watchedTheme.subscribe(this._onWatchedThemeChanged)}destroy(){c.watchedTheme.unsubscribe(this._onWatchedThemeChanged)}isStdTheme(){const e=this._opts.chartWidgetCollection.getAll().every((e=>(0,l.isStdTheme)((0,l.extractThemeFromModel)(e.model()))));return Promise.resolve(e)}async setStdTheme(e,t=!0,i){await(0,l.loadTheme)(this._opts.chartWidgetCollection,{themeName:e,standardTheme:!0,syncState:t,noUndo:i})}setStdThemeForLayout(e,t=!0){(0,
c.setTheme)(e),t&&(0,l.syncTheme)()}getCurrentThemeName(){return(0,l.getCurrentTheme)().name}toolbarThemeChanged(){return this._toolbarThemeChanged}}var p=i(546561),_=i(358076),m=i(114122),g=i(210596),f=i.n(g),v=i(508547);const S=new(d());function y(){throw new Error("not implemented")}class b{constructor(e){this._studyTemplatesDrawer=null,this._fontIconsSettingsDrawer=null,this._favoriteDrawingsToolbar=null,this._themesApi=null,this._newsApiDeferredPromise=null,this._newsApiRejectionReason=null,this._watchlistApiDeferredPromise=null,this._watchlistApiRejectionReason=null,this._widgetbarApiDeferredPromise=null,this._widgetbarApiRejectionReason=null,this._isDestroyed=!1,this._widgebarApi=null,this._magnetEnabledWatchedValue=null,this._magnetModeWatchedValue=null;const{chartApiInstance:t,chartWidgetCollection:i,studyMarket:s,financialsDialog:n,saveChartService:o,loadChartService:a,sharingChartService:l=null}=e;this._chartWidgetCollection=i,this._studyMarket=s,this._financialsDialog=n,this._saveChartService=o,this._sharingChartService=l,this._loadChartLayoutDialog=a,this._intervalsService=null,this._alertsWidgetDialog=null,this._detailsDialogController=null,this._supportedChartStylesSpawn=r.linking.supportedChartStyles.spawn(),this._chartWidgetCollection.onAboutToBeDestroyed.subscribe(null,(()=>this.destroy()),!0),this._newsApiDeferredPromise=(0,m.createDeferredPromise)(),this._newsApiRejectionReason=null,this._watchlistApiDeferredPromise=(0,m.createDeferredPromise)(),this._watchlistApiRejectionReason=null,this._widgetbarApiDeferredPromise=(0,m.createDeferredPromise)(),this._widgetbarApiRejectionReason=null;const c=i.lock;this._symbolSync=c.symbol.spawn(),this._intervalSync=c.interval.spawn(),this._dateRangeSync=c.dateRange.spawn(),this._crosshairSync=c.crosshair.spawn(),this._timeSync=c.trackTime.spawn()}destroy(){var e,t,i;this._supportedChartStylesSpawn.destroy(),null===(e=this._intervalsService)||void 0===e||e.destroy(),null===(t=this._themesApi)||void 0===t||t.destroy(),null===(i=this._widgebarApi)||void 0===i||i.destroy(),this._widgetbarApiRejectionReason="This ITradingViewApi instance has been destroyed",this._symbolSync.destroy(),this._intervalSync.destroy(),this._dateRangeSync.destroy(),this._crosshairSync.destroy(),this._timeSync.destroy(),this._isDestroyed=!0,(0,_.properties)().childs().magnet.unsubscribeAll(this),(0,_.properties)().childs().magnetMode.unsubscribeAll(this)}themes(){return null===this._themesApi&&(this._themesApi=new u({chartWidgetCollection:this._chartWidgetCollection})),this._themesApi}dialogs(){var e,t,i,s,r,n;return{Indicators:this._studyMarket,Financials:this._financialsDialog,Compare:this._chartWidgetCollection.getCompareDialogRenderer(),ObjectsTree:o.ObjectTreeDialogController.getInstance(),ChartProperties:this._chartWidgetCollection.getChartPropertiesDialogRenderer(),ChartLayoutSaveAs:null!==(t=null===(e=this._saveChartService)||void 0===e?void 0:e.getSaveAsController())&&void 0!==t?t:null,
ChartLayoutRename:null!==(s=null===(i=this._saveChartService)||void 0===i?void 0:i.getRenameController())&&void 0!==s?s:null,ChartLayoutCreate:null!==(n=null===(r=this._saveChartService)||void 0===r?void 0:r.getCreateController())&&void 0!==n?n:null,ChartLayoutLoad:this._loadChartLayoutDialog,Alerts:this._alertsWidgetDialog,Details:this._detailsDialogController,FinancialsCharts:null,Technicals:null,Forecast:null}}studyTemplatesDrawerApi(){y()}fontIconsSettingsDrawer(){y()}intervalsService(){y()}supportedChartTypes(){return this._supportedChartStylesSpawn}setBrokerName(e){this._chartWidgetCollection.setBroker(e)}drawOnAllChartsMode(e){(0,_.drawOnAllChartsMode)().setValue(e)}disableTrackingEvents(){(0,a.disableTrackingEvents)()}getSaveChartService(){return this._saveChartService}symbolSync(){return this._symbolSync}intervalSync(){return this._intervalSync}dateRangeSync(){return this._dateRangeSync}crosshairSync(){return this._crosshairSync}timeSync(){return this._timeSync}setSymbolSearchUI(e){y()}setLayout(e,t){(null==t?void 0:t.withUndo)?this._chartWidgetCollection.setChartLayoutWithUndo(e):this._chartWidgetCollection.setLayout(e)}selectLineTool(e,t){if(!p.supportedLineTools[e])return;const i=p.supportedLineTools[e].name;if("icon"===e){const e=null==t?void 0:t.icon;void 0!==e&&_.iconTool.setValue(e)}if("emoji"===e){const e=null==t?void 0:t.emoji;void 0!==e&&_.emojiTool.setValue(e)}_.tool.setValue(i)}favoriteDrawingsToolbar(){return i.e(5551).then(i.bind(i,590133)).then((e=>(this._favoriteDrawingsToolbar||(this._favoriteDrawingsToolbar=new e.FavoriteDrawingsApi),this._favoriteDrawingsToolbar)))}sharingChart(){return this._sharingChartService}watchlist(){return null!==this._watchlistApiRejectionReason&&((0,s.ensureNotNull)(this._watchlistApiDeferredPromise).reject(this._watchlistApiRejectionReason),this._watchlistApiRejectionReason=null),(0,s.ensureNotNull)(this._watchlistApiDeferredPromise).promise}setWatchlistApiPromise(e){e.then((e=>{(0,s.ensureNotNull)(this._watchlistApiDeferredPromise).resolve(e)})).catch((e=>{this._watchlistApiRejectionReason=e}))}news(){return this._isDestroyed&&(0,s.ensureNotNull)(this._newsApiDeferredPromise).reject("This ITradingViewApi instance has been destroyed"),null!==this._newsApiRejectionReason&&((0,s.ensureNotNull)(this._newsApiDeferredPromise).reject(this._newsApiRejectionReason),this._newsApiRejectionReason=null),(0,s.ensureNotNull)(this._newsApiDeferredPromise).promise}setNewsApiPromise(e){e.then((e=>{(0,s.ensureNotNull)(this._newsApiDeferredPromise).resolve(e)})).catch((e=>{this._newsApiRejectionReason=e}))}widgetbar(){return this._isDestroyed&&(0,s.ensureNotNull)(this._widgetbarApiDeferredPromise).reject("This ITradingViewApi instance has been destroyed"),null!==this._widgetbarApiRejectionReason&&((0,s.ensureNotNull)(this._widgetbarApiDeferredPromise).reject(this._widgetbarApiRejectionReason),this._widgetbarApiRejectionReason=null),(0,s.ensureNotNull)(this._widgetbarApiDeferredPromise).promise}setWidgetbarApiPromise(e){e.then((e=>{this._isDestroyed||(this._widgebarApi=e,(0,
s.ensureNotNull)(this._widgetbarApiDeferredPromise).resolve(e))})).catch((e=>{this._widgetbarApiRejectionReason=e}))}getChartStorage(){return getChartStorage()}setDebugMode(e){n.setEnabled("charting_library_debug_mode",e)}setFeatureEnabled(e,t){n.setEnabled(e,t)}magnetEnabled(){return null===this._magnetEnabledWatchedValue&&(this._magnetEnabledWatchedValue=new(f())((0,_.properties)().childs().magnet.value()),this._magnetEnabledWatchedValue.subscribe((e=>{(0,v.saveDefaultProperties)(!0),(0,_.properties)().childs().magnet.setValue(e),(0,v.saveDefaultProperties)(!1)})),(0,_.properties)().childs().magnet.subscribe(this,(()=>{(0,s.ensureNotNull)(this._magnetEnabledWatchedValue).setValue((0,_.properties)().childs().magnet.value())}))),this._magnetEnabledWatchedValue}magnetMode(){return null===this._magnetModeWatchedValue&&(this._magnetModeWatchedValue=new(f())((0,_.properties)().childs().magnetMode.value()),this._magnetModeWatchedValue.subscribe((e=>{(0,v.saveDefaultProperties)(!0),(0,_.properties)().childs().magnetMode.setValue(e),(0,v.saveDefaultProperties)(!1)})),(0,_.properties)().childs().magnetMode.subscribe(this,(()=>{(0,s.ensureNotNull)(this._magnetModeWatchedValue).setValue((0,_.properties)().childs().magnetMode.value())}))),this._magnetModeWatchedValue}flushBufferedData(){S.fire()}}},739385:(e,t,i)=>{"use strict";var s=i(922157),r=i(210596),n=i(688401).linking,o=i(114122).createDeferredPromise,a=i(349534),l=i(497612).layouts,c=i(559410),h=i(282926).ContextMenuManager,d=i(358076),u=i(382213),p=i(646846).backend,_=i(817808),m=i(153055).showWarning,g=i(153055).showConfirm,f=i(546561),v=i(206594).CLOSE_POPUPS_AND_DIALOGS_COMMAND,S=i(638273).Interval,y=i(525668).ChartChangesWatcher,b=i(536110).TradingViewApiBase,w=i(898005).StudyMetaInfo,P=i(849102).getStudyInputsInfo,C=i(657376).getStudyStylesInfo;e.exports=class extends b{constructor(e){const{chartWidgetCollection:t,saveChartService:i,loadChartService:r,sharingChartService:a,alertsDispatcher:l,supportTicketData:c,favoriteServices:h,chartApiInstance:d=null,studyMarket:u=null,financialsDialog:p=null}=e;super({chartApiInstance:d,chartWidgetCollection:t,studyMarket:u,financialsDialog:p,saveChartService:i,loadChartService:r,sharingChartService:a}),this._chartApiInstance=d,this._loadChartService=r,this._alertsDispatcher=l,this._supportTicketData=c,this._favoriteServices=h,this._proxyWatchListChangedDelegate=null,this._lockDrawingsWatchedValue=null,this._hideDrawingsWatchedValue=null,this._hideIndicatorsWatchedValue=null,this._replayApi=null,this._chartChangesWatcher=null,this._hasChartChangesWatchedValue=null,this._newsApiDeferredPromise=o(),this._newsApiRejectionReason=null,this._watchlistApiDeferredPromise=o(),this._watchlistApiRejectionReason=null,this._widgetbarApiDeferredPromise=o(),this._widgetbarApiRejectionReason=null,this._getDataSourceHub=function(){return t.activeChartWidget.value().model().model()},this._chartWidgetCollection.getResizerDetacher=function(){return t.activeChartWidget.value().getResizerDetacher()},
this._alertService=this._alertsDispatcher?new undefined(this._alertsDispatcher,this._getDataSourceHub):null,this._activeChangedChangedDelegate=new s,this._chartWidgetCollection.activeChartWidget.subscribe(function(){this._activeChangedChangedDelegate.fire()}.bind(this)),this._chartWidgets=new WeakMap,this._activateChart=function(e){t.activeChartWidget.setValue(e)},this.linking=n}subscribe(e,t){c.subscribe(e,t)}unsubscribe(e,t){c.unsubscribe(e,t)}onContextMenu(e){c.subscribe("onContextMenu",(function(t){t.callback(e(t.unixtime,t.price))}))}onGrayedObjectClicked(e){c.subscribe("onGrayedObjectClicked",e)}activeChart(){return this._getChartWidgetApi(this._chartWidgetCollection.activeChartWidget.value())}_getChartWidgetApi(e){var t=this._chartWidgets.get(e);return void 0===t&&(t=new a(e,this._activateChart.bind(null,e)),this._chartWidgets.set(e,t)),t}onActiveChartChanged(){return this._activeChangedChangedDelegate}changeSymbol(e,t,i){n.interval.setValue(S.normalize(t)),n.symbol.setValue(e),i&&this.activeChart().onDataLoaded().subscribe(null,i,!0)}layout(){return this._chartWidgetCollection.layout.value()}layoutName(){return this._chartWidgetCollection.metaInfo.name.value()}layoutNameWatchedValue(){return this._chartWidgetCollection.metaInfo.name.readonly()}layoutSettingsDrawer(){throw new Error("not implemented")}chartsCount(){return l[this.layout()].count}viewMode(){throw new Error("not implemented")}viewModeWatchedValue(){throw new Error("not implemented")}setForceFullscreenMode(){throw new Error("not implemented")}setMultichartMode(){throw new Error("not implemented")}setActiveChart(e){throw new Error("not implemented")}chart(e){if(void 0===e&&(e=0),e<0||e>=this.chartsCount())throw Error("Incorrect index: "+e);return this._getChartWidgetApi(this._chartWidgetCollection.getAll()[e])}getSymbolInterval(e){var t={symbol:n.symbol.value(),interval:n.interval.value()};return e&&e(t),t}saveChart(e){if(this._saveChartService){var t=this._saveChartService.saveToJSON();return e&&e(JSON.parse(t.content))}}loadChart(e){this._chartApiInstance.disconnect(),this._chartWidgetCollection.loadContent(e.json),this._chartWidgetCollection.purgeUnusedWidgets(),e.extendedData&&(this._chartWidgetCollection.metaInfo.id.setValue(e.extendedData.uid),this._chartWidgetCollection.metaInfo.uid.setValue(e.extendedData.uid),this._chartWidgetCollection.metaInfo.name.setValue(e.extendedData.name)),this._chartApiInstance.connect(),n.symbol.setValue(this.activeChart().symbol()),c.emit("chart_loaded")}getStudiesList(){return this._chartApiInstance.allStudiesMetadata().filter((function(e){return!e.is_hidden_study})).map((function(e){return e.description}))}getStudyInputs(e){{const t=w.findStudyMetaInfoByDescription(this._chartApiInstance.allStudiesMetadata(),e);return P(t)}}getStudyStyles(e){{const t=w.findStudyMetaInfoByDescription(this._chartApiInstance.allStudiesMetadata(),e);return C(t)}}getSavedCharts(e){p.getCharts().then(e)}loadChartFromServer(e){p.loadChart(e)}saveChartToServer(e,t,i){
this._saveChartService&&this._saveChartService.saveChartSilently(e,t,i)}setAutosave(e){this._saveChartService&&this._saveChartService.autoSaveEnabled().setValue(e)}removeChartFromServer(e,t){p.removeChart(e).then(t)}getIntervals(){var e=[],t=u.getCustomResolutions();return null!==this._chartApiInstance&&(e=this._chartApiInstance.defaultResolutions()),u.mergeResolutions(e,t)}closePopupsAndDialogs(){h.hideAll(),c.emit(v)}selectedLineTool(){for(var e=Object.keys(f.supportedLineTools),t=d.tool.value(),i=0;i<e.length;++i)if(f.supportedLineTools[e[i]].name===t)return e[i];return""}lockAllDrawingTools(){return null===this._lockDrawingsWatchedValue&&(this._lockDrawingsWatchedValue=new r(d.lockDrawings().value()),this._lockDrawingsWatchedValue.subscribe((function(e){d.lockDrawings().setValue(e)})),d.lockDrawings().subscribe(this,(function(){this._lockDrawingsWatchedValue.setValue(d.lockDrawings().value())}))),this._lockDrawingsWatchedValue}hideAllDrawingTools(){return null===this._hideDrawingsWatchedValue&&(this._hideDrawingsWatchedValue=new r(d.hideAllDrawings().value()),this._hideDrawingsWatchedValue.subscribe((function(e){d.hideAllDrawings().setValue(e)})),d.hideAllDrawings().subscribe(this,(function(){this._hideDrawingsWatchedValue.setValue(d.hideAllDrawings().value())}))),this._hideDrawingsWatchedValue}hideAllIndicators(){return null===this._hideIndicatorsWatchedValue&&(this._hideIndicatorsWatchedValue=new r(d.hideAllIndicators().value()),this._hideIndicatorsWatchedValue.subscribe((function(e){d.hideAllIndicators().setValue(e)})),d.hideAllIndicators().subscribe(this,(function(){this._hideIndicatorsWatchedValue.setValue(d.hideAllIndicators().value())}))),this._hideIndicatorsWatchedValue}mainSeriesPriceFormatter(){return this._chartWidgetCollection.activeChartWidget.value().model().mainSeries().priceScale().formatter()}showNoticeDialog(e){m({title:(e=e||{}).title,text:e.body||"",onClose:e.callback})}showConfirmDialog(e){if(!(e=e||{}).callback)throw Error("callback must be exist");var t=e.callback;function i(e){t&&(t(e),t=null)}g({title:e.title,text:e.body||"",onClose:function(){i(!1)},onConfirm:function(e){i(!0),e.dialogClose()}})}logs(){return{getLogHistory:_.getLogHistory,enable:_.loggingOn,disable:_.loggingOff}}showLoadChartDialog(){var e=this._loadChartService;e&&e.showLoadDialog()}showSaveAsChartDialog(){var e=this._saveChartService;e&&window.runOrSignIn((function(){e.saveChartAs()}),{source:"Save as chart dialogue"})}drawOnAllCharts(e){return d.drawOnAllCharts().setValue(e)}undoRedoState(){return this._chartWidgetCollection.undoHistory.state()}clearUndoHistory(){return this._chartWidgetCollection.undoHistory.clearStack()}undo(){return this._chartWidgetCollection.undoHistory.undo()}redo(){return this._chartWidgetCollection.undoHistory.redo()}trading(){throw new Error("Not implemented")}waitTrading(){throw new Error("Not implemented")}symbolSearch(){throw new Error("Not implemented")}saveChartOrShowTitleDialog(e,t,i){throw new Error("Not implemented")}showRenameChartDialog(){throw new Error("Not implemented")}
setUserInfo(e){throw new Error("Not implemented")}connect(){throw new Error("Not implemented")}disconnect(){throw new Error("Not implemented")}loginRequired(){throw new Error("Not implemented")}onConnectionStatusChanged(e){throw new Error("Not implemented")}isConnected(){throw new Error("Not implemented")}showCreateAlertDialog(){throw new Error("Not implemented")}alertService(){throw new Error("Not implemented")}publishChart(e){throw new Error("Not implemented")}setPublishChartOptions(e){throw new Error("Not implemented")}showSupportDialog(){throw new Error("Not implemented")}openMobileChartPicker(){throw new Error("Not implemented")}closeMobileChartPicker(){throw new Error("Not implemented")}replayApi(){throw new Error("Not implemented")}takeScreenshot(){return this._chartWidgetCollection.takeScreenshot()}setIntervalLinkingEnabled(e){this._chartWidgetCollection.lock.interval.setValue(e)}setTimeFrame(e){this._chartWidgetCollection.setTimeFrame(e)}startFullscreen(){return this._chartWidgetCollection.startFullscreen()}exitFullscreen(){return this._chartWidgetCollection.exitFullscreen()}takeClientScreenshot(e){return this._chartWidgetCollection.clientSnapshot(e)}getFavoriteIntervalsService(){throw new Error("not implemented")}getFavoriteChartStylesService(){throw new Error("not implemented")}getLinetoolsFavoritesStore(){throw new Error("not implemented")}supportTicketData(){return this._supportTicketData}hasChartChanges(){return null===this._chartChangesWatcher&&null===this._hasChartChangesWatchedValue&&(this._chartChangesWatcher=new y(this._chartWidgetCollection,window.saver,c),this._hasChartChangesWatchedValue=new r(this._chartChangesWatcher.hasChanges()),this._chartChangesWatcher.getOnChange().subscribe(this,(function(){this._hasChartChangesWatchedValue.setValue(this._chartChangesWatcher.hasChanges())}))),this._hasChartChangesWatchedValue}createGoProDialog(e){throw new Error("Not implemented")}onGoProDialog(e,t){throw new Error("Not implemented")}}},511196:(e,t,i)=>{"use strict";i.d(t,{WatchListAction:()=>l});var s=i(509806),r=i(710567),n=i(650151),o=i(180185),a=i(845437);class l extends r.Action{constructor(e,t){super(function(e,t){return{...t,actionId:"Chart.AddSymbolToWatchList",icon:a,statName:"AddToWatchlist",hotkeyHash:o.Modifiers.Alt+87,onExecute:()=>{window.runOrSignIn((()=>{var t;if(window.widgetbar){const i=null===(t=(0,n.ensureNotNull)(window.widgetbar.setPage("base")).widget("watchlist"))||void 0===t?void 0:t.widgetObject;if(!i)return;i.addSymbols([e.getSymbol()])}}),{source:"add symbol to watchlist"})}}}(e,t))}updateLabel(e){this.update({label:s.t(null,void 0,i(655980)).format({symbol:e})})}request(){}}},639542:(e,t,i)=>{"use strict";i.d(t,{WidgetbarApi:()=>r});var s=i(484727);class r{constructor(e){this._widgetbar=null,this._widgetbar=e}showPage(e){var t,i,r;if(null===this._widgetbar)return;const n=this.isPageVisible(e),o=this._getInternalPageName(e)
;void 0!==(null===(i=null===(t=this._widgetbar)||void 0===t?void 0:t.layout)||void 0===i?void 0:i.pages.find((e=>e.name===o)))?n||(this._widgetbar.setPage(this._getInternalPageName(e)),null===(r=this._widgetbar.layout)||void 0===r||r.setMinimizedState(!1),this.changeWidgetBarVisibility(!0)):s.enabled("right_toolbar")?console.warn(`${e} is not a valid page name or does not exist!`):console.warn("You must enable right_toolbar featureset first to interact with widgetbar pages")}hidePage(e){var t,i,r;if(null===this._widgetbar)return;const n=this.isPageVisible(e),o=this._getInternalPageName(e);void 0!==(null===(i=null===(t=this._widgetbar)||void 0===t?void 0:t.layout)||void 0===i?void 0:i.pages.find((e=>e.name===o)))?n&&(null===(r=this._widgetbar.layout)||void 0===r||r.setMinimizedState(!0)):s.enabled("right_toolbar")?console.warn(`${e} is not a valid page name or does not exist!`):console.warn("You must enable right_toolbar featureset first to interact with widgetbar pages")}isPageVisible(e){var t,i;return null!==this._widgetbar&&(null===(i=null===(t=this._widgetbar.layout)||void 0===t?void 0:t.getActivePage())||void 0===i?void 0:i.name)===this._getInternalPageName(e)}destroy(){this._widgetbar=null}openOrderPanel(){var e;s.enabled("right_toolbar")&&s.enabled("order_panel")&&(null===(e=this._widgetbar)||void 0===e?void 0:e.tradingPanelAccessor)?this._widgetbar.tradingPanelAccessor.setOrderPanelVisibility(!0):console.warn("You must enable right_toolbar & order_panel featuresets first to interact with this widget")}closeOrderPanel(){var e,t;null===(t=null===(e=this._widgetbar)||void 0===e?void 0:e.tradingPanelAccessor)||void 0===t||t.setOrderPanelVisibility(!1)}changeWidgetBarVisibility(e){var t,i,s,r;null===(i=null===(t=this._widgetbar)||void 0===t?void 0:t.layout)||void 0===i||i.changeWidgetBarVisibility(e),null===(r=null===(s=this._widgetbar)||void 0===s?void 0:s.layout)||void 0===r||r.requestOptimalWidth()}_getInternalPageName(e){switch(e){case"watchlist_details_news":return"base";case"data_window":return"data-window";case"object_tree":return"object_tree"}}}},831809:(e,t,i)=>{"use strict";i.d(t,{addPlusButtonProperty:()=>a,restoreAddPlusButtonSettingsValue:()=>l});var s=i(870122),r=i(149926);const n="add_plus_button";function o(){return s.getBool(n,!0)}const a=(0,r.createPrimitiveProperty)(o());function l(){a.setValue(!0),s.remove(n)}s.onSync.subscribe(null,(()=>a.setValue(o()))),a.subscribe(null,(()=>s.setValue(n,a.value())))},125361:(e,t,i)=>{"use strict";i.d(t,{alignToStep:()=>n});var s=i(960521),r=i.n(s);function n(e,t){return r()(e).div(t).round(0,r().roundHalfUp).mul(t).toNumber()}},671126:(e,t,i)=>{"use strict";i.d(t,{AppliedTimeFrame:()=>r});var s=i(812813);class r{constructor(e){this._appliedTimeFrame=new s.WatchedObject(null),this._appliedTimeFrameInfo=null,this._appliedTimeFrameChangedBound=this._appliedTimeFrameChanged.bind(this),this._model=e,e.mainSeries().dataEvents().seriesTimeFrame().subscribe(this,this._onSeriesTimeFrame),this._appliedTimeFrame.subscribe(this._appliedTimeFrameChangedBound)}destroy(){
this._appliedTimeFrame.unsubscribe(this._appliedTimeFrameChangedBound),this._model.timeScale().logicalRangeChanged().unsubscribeAll(this),this._model.mainSeries().dataEvents().seriesTimeFrame().unsubscribeAll(this)}appliedTimeFrame(){return this._appliedTimeFrame}_appliedTimeFrameChanged(){this._model.timeScale().logicalRangeChanged().unsubscribe(this,this._invalidateAppliedTimeFrame)}_onSeriesTimeFrame(e,t,i,s){if(s){const e=this._model.timeScale();this._appliedTimeFrameInfo={logicalRange:e.logicalRange(),baseIndex:e.baseIndex()},e.logicalRangeChanged().subscribe(this,this._invalidateAppliedTimeFrame)}}_invalidateAppliedTimeFrame(){if(null===this._appliedTimeFrameInfo)return;const e=this._model.timeScale(),t=e.logicalRange(),i=e.baseIndex(),s=this._appliedTimeFrameInfo.logicalRange,r=this._appliedTimeFrameInfo.baseIndex;(null===t||null===s||Math.abs(i-t.left()-(r-s.left()))>=.01||Math.abs(i-t.right()-(r-s.right()))>=.01)&&this._appliedTimeFrame.setValue(null)}}},392987:(e,t,i)=>{"use strict";i.d(t,{defaultsPreferencesByWhiteList:()=>x,preferencesByWhiteList:()=>T});var s=i(486028),r=i(927079);var n=i(817808),o=i(341537),a=i(658363),l=i(548193),c=i(606615),h=i(992223),d=i(676507);const u={visible:!1,lineStyle:i(284269).LINESTYLE_DOTTED,lineWidth:1,bidLineColor:d.colorsPalette["color-tv-blue-500"],askLineColor:d.colorsPalette["color-ripe-red-400"]},p=(0,n.getLogger)("Chart.ApplyPreferencesToAllCharts"),_={color:"",style:0},m={autoScale:!1,autoScaleDisabled:!1,lockScale:!1,percentage:!1,percentageDisabled:!1,log:!1,logDisabled:!1,alignLabels:!1,isInverted:!1,indexedTo100:!1},g={backgroundType:h.ColorType.Solid,background:"",backgroundGradientStartColor:"",backgroundGradientEndColor:"",topMargin:0,bottomMargin:0,rightOffset:0,horzGridProperties:(0,c.deepExtend)({},_),vertGridProperties:(0,c.deepExtend)({},_),crossHairProperties:(0,c.deepExtend)({},{color:"",style:0,transparency:0,width:0}),legendProperties:(0,c.deepExtend)({},{showStudyArguments:!1,showStudyTitles:!1,showStudyValues:!1,showSeriesTitle:!1,showSeriesOHLC:!1,showLegend:!1,showBarChange:!0,showVolume:!1,showPriceSource:!1,showBackground:!0,backgroundTransparency:0}),axisProperties:(0,c.deepExtend)({},m),separatorColor:""},f={lineColor:"",textColor:"",fontSize:0,scaleSeriesOnly:!1,showSeriesLastValue:!1,seriesLastValueMode:o.PriceAxisLastValueMode.LastValueAccordingToScale,showSeriesPrevCloseValue:!1,showStudyLastValue:!1,showSymbolLabels:!1,showStudyPlotLabels:!1,showBidAskLabels:!1,showPrePostMarketPriceLabel:!0,showFundamentalLastValue:!1,showFundamentalNameLabel:!1,showPriceScaleCrosshairLabel:!0,showTimeScaleCrosshairLabel:!0},v={...f},S={visible:!1,futureOnly:!1,breaks:(0,c.deepExtend)({},{color:"",visible:!1,style:0,width:0})},y={style:0,minTick:"",showPriceLine:!1,priceLineWidth:0,priceLineColor:"",baseLineColor:"",showPrevClosePriceLine:!1,showCountdown:!0,prevClosePriceLineWidth:0,sessionId:"regular",prevClosePriceLineColor:"",esdShowDividends:!1,esdShowSplits:!1,esdShowEarnings:!1,esdShowBreaks:!1,showContinuousContractSwitches:!1,
showContinuousContractSwitchesBreaks:!1,showFuturesContractExpiration:!1,showLastNews:!1,dividendsAdjustment:!1,backAdjustment:!1,settlementAsClose:!0,statusViewStyle:(0,c.deepExtend)({},{fontSize:16,showExchange:!0,showInterval:!0,symbolTextSource:"description"}),priceAxisProperties:(0,c.deepExtend)({},m),bidAsk:(0,c.deepExtend)({},u),highLowAvgPrice:(0,c.deepExtend)({},{highLowPriceLinesVisible:!1,highLowPriceLabelsVisible:!1,averageClosePriceLabelVisible:!1,averageClosePriceLineVisible:!1,highLowPriceLinesColor:"",highLowPriceLinesWidth:0,averagePriceLineColor:"",averagePriceLineWidth:0}),candleStyle:(0,c.deepExtend)({},{upColor:"",downColor:"",drawWick:!1,drawBorder:!1,drawBody:!0,borderColor:"",borderUpColor:"",borderDownColor:"",wickColor:"",wickUpColor:"",wickDownColor:"",barColorsOnPrevClose:!1}),hollowCandleStyle:(0,c.deepExtend)({},{upColor:"",downColor:"",drawWick:!1,drawBorder:!1,drawBody:!0,borderColor:"",borderUpColor:"",borderDownColor:"",wickColor:"",wickUpColor:"",wickDownColor:""}),barStyle:(0,c.deepExtend)({},{upColor:"",downColor:"",barColorsOnPrevClose:!1,dontDrawOpen:!1,thinBars:!0}),lineStyle:(0,c.deepExtend)({},{color:"",linestyle:0,linewidth:0,styleType:0}),areaStyle:(0,c.deepExtend)({},{color1:"",color2:"",linecolor:"",linestyle:0,linewidth:0,transparency:0}),baselineStyle:(0,c.deepExtend)({},{topFillColor1:"",topFillColor2:"",bottomFillColor1:"",bottomFillColor2:"",topLineColor:"",bottomLineColor:"",baselineColor:"",topLineWidth:0,bottomLineWidth:0,transparency:0,baseLevelPercentage:0}),hiloStyle:(0,c.deepExtend)({},{color:"",showBorders:!1,borderColor:"",showLabels:!1,labelColor:"",drawBody:!0}),haStyle:(0,c.deepExtend)({},{upColor:"",downColor:"",drawWick:!1,drawBorder:!1,drawBody:!0,borderColor:"",borderUpColor:"",borderDownColor:"",wickColor:"",wickUpColor:"",wickDownColor:"",showRealLastPrice:!1,barColorsOnPrevClose:!1,inputs:{}}),renkoStyle:(0,c.deepExtend)({},{upColor:"",downColor:"",borderUpColor:"",borderDownColor:"",upColorProjection:"",downColorProjection:"",borderUpColorProjection:"",borderDownColorProjection:"",wickUpColor:"",wickDownColor:"",inputs:{boxSize:0,style:"",atrLength:0,wicks:!1,sources:"",source:""}}),pbStyle:(0,c.deepExtend)({},{upColor:"",downColor:"",borderUpColor:"",borderDownColor:"",upColorProjection:"",downColorProjection:"",borderUpColorProjection:"",borderDownColorProjection:"",inputs:{source:"",lb:0}}),kagiStyle:(0,c.deepExtend)({},{upColor:"",downColor:"",upColorProjection:"",downColorProjection:"",inputs:{style:"",atrLength:0,reversalAmount:0}}),pnfStyle:(0,c.deepExtend)({},{upColor:"",downColor:"",upColorProjection:"",downColorProjection:"",inputs:{reversalAmount:0,boxSize:0,style:"",atrLength:0}}),rangeStyle:(0,c.deepExtend)({},{upColor:"",downColor:"",upColorProjection:"",downColorProjection:"",thinBars:!1,inputs:{range:0,phantomBars:!1}}),columnStyle:(0,c.deepExtend)({},{upColor:"",downColor:"",barColorsOnPrevClose:!1})},b={priceScaleSelectionStrategyName:"auto",timeScale:(0,c.deepExtend)({},{defaultRightOffset:0,defaultRightOffsetPercentage:5,
usePercentageRightOffset:!1}),mainSeries:(0,c.deepExtend)({},y),sessions:(0,c.deepExtend)({},l.sessionsPreferencesDefault),paneProperties:(0,c.deepExtend)({},g),chartEventsSourceProperties:(0,c.deepExtend)({},S),tradingProperties:(0,c.deepExtend)({},r.tradingPreferencesDefault)},w={timezone:"",scalesProperties:(0,c.deepExtend)({},v),...b},P={scalesProperties:(0,c.deepExtend)({},f),...b};function C(e,t,i,r,n=!0){if(void 0===t[e])return p.logDebug(`We haven't had this property ${r}.${e} yet, please, remove it from whiteList`),null;if((0,s.isObject)(i[e])){const s=Object.keys(i[e]);let o="";return s.map((s=>({[s]:C(s,t[e],i[e],`${r}.${e}`,n)}))).reduce(((e,t)=>(o=Object.keys(t)[0],e[o]=t[o],e)),{})}return n?t[e].value():t[e]}function T(e,t,i=w){const s={timezone:"",priceScaleSelectionStrategyName:"auto",timeScale:{defaultRightOffset:e.timeScale().defaultRightOffset().value(),defaultRightOffsetPercentage:e.timeScale().defaultRightOffsetPercentage().value(),usePercentageRightOffset:e.timeScale().usePercentageRightOffset().value()},mainSeries:{},sessions:{},paneProperties:{},scalesProperties:{},chartEventsSourceProperties:{},tradingProperties:{}},r=["timeScale","mainSeries","sessions"],n=i.mainSeries,o=Object.keys(i),a=Object.keys(n),l=t.properties(),c=e.properties(),h=i.sessions,d=Object.keys(h),u=e.sessions().properties();return a.forEach((e=>{s.mainSeries[e]=C(e,l,n,"mainSeries")})),d.forEach((e=>{s.sessions[e]=C(e,u,h,"sessions")})),o.forEach((e=>{r.includes(e)||(s[e]=C(e,c,i,"preferences"))})),s}function x(e,t,i=P,s=!0){const r={timeScale:{defaultRightOffset:e.timeScale().rightOffsetDefaultValue(),defaultRightOffsetPercentage:e.timeScale().defaultRightOffsetPercentage().value(),usePercentageRightOffset:e.timeScale().usePercentageRightOffset().value()},mainSeries:{},sessions:(0,c.deepExtend)({},l.sessionsPreferencesDefault),paneProperties:{},scalesProperties:{},chartEventsSourceProperties:{},tradingProperties:{},priceScaleSelectionStrategyName:"auto"},n=["timeScale","mainSeries","sessions"],o=i.mainSeries,h=Object.keys(i),d=Object.keys(o),u=(0,a.factoryDefaults)("chartproperties.mainSeriesProperties"),p=(0,a.factoryDefaults)("chartproperties");return d.forEach((e=>{s&&"style"===e||(r.mainSeries[e]=C(e,u,o,"mainSeries",!1))})),h.forEach((e=>{n.includes(e)||(r[e]=C(e,p,i,"preferences",!1))})),r}},413802:(e,t,i)=>{"use strict";i.d(t,{axisLabelBackgroundColor:()=>r});var s=i(676507);const r={common:s.colorsPalette["color-tv-blue-500"],active:s.colorsPalette["color-tv-blue-800"]}},85761:(e,t,i)=>{"use strict";i.d(t,{createDwmAligner:()=>c,isAlignmentEnabled:()=>h,createTimeToBarTimeAligner:()=>d});var s=i(871555),r=i(484727),n=i(638273),o=i(89596),a=i(290728);const l=new o.SessionInfo("Etc/UTC","0000-0000:1234567");function c(e,t){if(!h()||!n.Interval.isDWM(e))return null;const i=new o.SessionInfo(t.timezone,t.session,t.session_holidays,t.corrections),r=(0,a.newBarBuilder)(e,i,l);return{timeToSessionStart:e=>r.tradingDayToSessionStart(e),timeToExchangeTradingDay:e=>{
const t=s.utc_to_cal(i.timezone,e),r=i.spec.correctTradingDay(t);return s.set_hms(r,0,0,0,0,s.get_timezone("Etc/UTC")),r.getTime()}}}function h(){return!r.enabled("disable_resolution_rebuild")}function d(e,t){if(!h())return e=>e;const i=new o.SessionInfo(t.timezone,t.session,t.session_holidays,t.corrections),s=(0,a.newBarBuilder)(e,i,i,!1);return e=>s.alignTimeIfPossible(e)}},89596:(e,t,i)=>{"use strict";i.d(t,{SessionInfo:()=>o,BarBuilderBase:()=>a});var s=i(871555),r=i(467978),n=i(435818);class o{constructor(e,t,i,s){this.init(e,t,i,s),this._state={timezone:e,spec:t,holidays:i,corrections:s}}init(e,t,i,r){this.timezone=s.get_timezone(e),this.spec=new n.SessionSpec(e,t,i,r)}state(){return this._state}static fromState(e){return new o(e.timezone,e.spec,e.holidays,e.corrections)}}class a{alignTime(e){if(isNaN(e))return NaN;let t=this.indexOfBar(e);return t===r.SessionStage.POST_SESSION&&(this.moveTo(e),t=this.indexOfBar(e)),t<0?NaN:this.startOfBar(t)}}},290728:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SessionInfo:()=>o.SessionInfo,alignExchangeTimeToSessionStartAndReturnUTC:()=>C,alignPeriodsBackForDataRequest:()=>y,alignPeriodsBackForVisibleRange:()=>b,getPeriodsBetweenDates:()=>P,isTradingNow:()=>T,newBarBuilder:()=>S});var s=i(871555),r=i(638273),n=i(218954),o=i(89596),a=i(467978);class l extends o.BarBuilderBase{constructor(e,t){super(),this._sessionStartMs=-Number.MAX_VALUE,this._sessionEndMs=-Number.MAX_VALUE,this._periodSec=e,this._session=t}alignTimeIfPossible(e){const t=this.alignTime(e);return isNaN(t)?e:t}indexOfBar(e){return e<this._sessionStartMs?a.SessionStage.PRE_SESSION:e>=this._sessionEndMs?a.SessionStage.POST_SESSION:(0,n.toInt)(s.time_seconds_diff(e,this._sessionStartMs)/this._periodSec)}startOfBar(e){if(e===a.SessionStage.PRE_SESSION){const e=s.get_cal_from_unix_timestamp_ms(this._session.timezone,this._sessionStartMs-1),t=this._session.spec.alignToNearestSessionEnd(e,-1);return s.cal_to_utc(this._session.timezone,t)}if(e===a.SessionStage.POST_SESSION)return this._sessionEndMs;if(e<0)throw new Error("Negative offset is not supported");return this._sessionStartMs+s.time_seconds(this._periodSec*e)}endOfBar(e){if(e<0)throw new Error("Index cannot be negative");const t=this.startOfBar(e)+1e3*this._periodSec;return t>this._sessionEndMs?this._sessionEndMs:t}isLastBar(e,t){return t>=this._sessionStartMs+s.time_seconds(this._periodSec*(e+1)-1)}moveTo(e){const t=this._session.timezone,i=s.utc_to_cal(t,e),r=this._session.spec.alignToSessionStart(i);this._sessionStartMs=s.cal_to_utc(t,i),s.add_minutes(i,r),this._sessionEndMs=s.cal_to_utc(t,i)}indexOfLastBarInSession(){return(0,n.toInt)((this._sessionEndMs-1-this._sessionStartMs)/1e3/this._periodSec)}moveNext(){this.moveTo(this._sessionEndMs)}}var c=i(632163);function h(e,t){const i=s.clone(t),r=e.businessDaysToCalendarDays(i,1);r>1&&s.add_date(i,r-1);const n=e.leftBorderOfDailyBar(i);if(null===n)throw new Error("Cannot calculate left border of daily bar");return s.cal_to_utc(s.get_timezone(e.timezone()),n)}class d extends o.BarBuilderBase{constructor(e,t,i,s,r=!1){
super(),this._periodStart=-Number.MAX_VALUE,this._periodEnd=-Number.MAX_VALUE,this._periodLastBarStart=-Number.MAX_VALUE,this._periodStartDay=new c.BusinessDay(0,0,0),this._periodEndDay=new c.BusinessDay(0,0,0),this._period=i,this._sessionTgt=e,this._builder=s,this._useBusinessDays=r,this._sessionSrc=r?new o.SessionInfo("Etc/UTC","24x7"):t||e}builder(){return this._builder}alignTimeIfPossible(e){return this.tradingDayToSessionStart(e)}tradingDayToSessionStart(e){return this.moveTo(e),this.startOfBar(0)}indexOfBar(e){if(this._useBusinessDays){const t=c.BusinessDay.fromCalendar(s.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,e));return t.before(this._periodStartDay)?a.SessionStage.PRE_SESSION:this._periodEndDay.before(t)?a.SessionStage.POST_SESSION:0}return e<this._periodStart?a.SessionStage.PRE_SESSION:e>=this._periodEnd?a.SessionStage.POST_SESSION:0}startOfBar(e){if(e===a.SessionStage.PRE_SESSION){const e=s.get_cal_from_unix_timestamp_ms(this._sessionTgt.timezone,this._periodStart-1),t=this._sessionTgt.spec.alignToNearestSessionEnd(e,-1);return s.cal_to_utc(this._sessionTgt.timezone,t)-1}return e===a.SessionStage.POST_SESSION||e>0?this._periodEnd:e===a.SessionStage.LASTBAR_SESSION?this._periodLastBarStart:this._periodStart}moveTo(e){const t=s.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,e);this._sessionSrc.spec.correctTradingDay(t);const i=s.get_year(t),r=this._indexOfPeriodInYear(t),n=r+this._period,o=this._sessionTgt.spec,a=this._sessionTgt.timezone,l=this._builder.startOfPeriod(a,r,i);this._periodStart=h(o,l);const d=s.clone(l),u=o.businessDaysToCalendarDays(d,1);u>1&&s.add_date(d,u-1),this._periodStartDay=c.BusinessDay.fromCalendar(d);const p=this._builder.startOfPeriod(a,n,i);this._periodEnd=h(o,p);const _=s.clone(p);for(s.add_date(_,-1);o.isCalWeekEnd(_);)s.add_date(_,-1);this._periodEndDay=c.BusinessDay.fromCalendar(_),s.add_date(p,-1),function(e,t){for(;e.isCalWeekEnd(t);)s.add_date(t,-1)}(this._sessionTgt.spec,p),this._periodLastBarStart=h(o,p),(this._periodLastBarStart<this._periodStart||this._periodLastBarStart===this._periodEnd)&&(this._periodLastBarStart=this._periodStart)}endOfBar(e){if(0!==e)throw new Error("index should be 0");return this._periodEnd}isLastBar(e,t){if(0!==e)throw new Error("index should be 0");return t>=this._periodLastBarStart}currentRange(){return{from:this._periodStartDay,to:this._periodEndDay}}indexOfBarInYear(e){const t=s.get_cal_from_unix_timestamp_ms(this._sessionSrc.timezone,e),i=s.get_year(t),r=this._builder.indexOfPeriod(t),o=this._sessionTgt.timezone;let a=this._builder.startOfPeriod(o,r,i),l=h(this._sessionTgt.spec,a);return a=s.get_cal_from_unix_timestamp_ms(s.get_timezone("Etc/UTC"),l),i<s.get_year(a)?(a=this._builder.startOfPeriod(o,r-1,i),l=h(this._sessionTgt.spec,a),{index:(r-1)/this._period,time:l}):{index:(0,n.toInt)(r/this._period),time:l}}sessionSrc(){return this._sessionSrc}_indexOfPeriodInYear(e){const t=this._builder.indexOfPeriod(e);let i=(0,n.toInt)(t/this._period)*this._period;return-1===t&&(i=-this._period),i}}function u(e,t){
const i=s.get_day_of_week(t)-e.firstDayOfWeek();return i<0?i+7:i}function p(e,t){const i=s.get_day_of_year(t)-1;let r=u(e,t)-i%7;return 0===r?(0,n.toInt)(i/7):(r>=0&&(r-=7),(0,n.toInt)((r+i)/7))}class _{indexOfPeriod(e){return s.get_day_of_year(e)-1}startOfPeriod(e,t,i){const r=s.days_per_year(i);return s.get_cal(s.get_timezone("Etc/UTC"),i,s.JANUARY,1+Math.min(t,r))}}class m extends _{constructor(e){super(),this._sessionsSpec=e}indexOfPeriod(e){return super.indexOfPeriod(e)-function(e,t){const i=p(e,t),r=s.get_cal(s.get_timezone("Etc/UTC"),s.get_year(t),s.JANUARY,1);s.add_date(r,7*i);const n=i*e.weekEndsCount()+e.holidaysFromYearStart(r),o=s.get_day_of_year(t)-s.get_day_of_year(r);return n+o-e.calendarDaysToBusinessDays(r,o)}(this._sessionsSpec,e)}startOfPeriod(e,t,i){const r=7-this._sessionsSpec.weekEndsCount(),o=Math.max(0,(0,n.toInt)(t/r)-1),a=s.get_cal(s.get_timezone("Etc/UTC"),i,s.JANUARY,1),l=s.get_days_per_year(a);if(s.add_date(a,7*o),(t-=r*o-this._sessionsSpec.holidaysFromYearStart(a))>0){const e=this._sessionsSpec.businessDaysToCalendarDays(a,t);s.add_date(a,e)}let c=s.get_day_of_year(a)-1;return i<s.get_year(a)&&(c+=l),super.startOfPeriod(e,c,i)}}class g{constructor(e){this._builder=null,this._initialized=!1,this._session=e}indexOfPeriod(e){return this._getBuilder().indexOfPeriod(e)}startOfPeriod(e,t,i){return this._getBuilder().startOfPeriod(e,t,i)}_getBuilder(){return null!==this._builder&&this._initialized||(this._builder=this._session.spec.hasWeekEnds()?new m(this._session.spec):new _,this._initialized=!0),this._builder}}class f{constructor(e){this._session=e}indexOfPeriod(e){let t=p(this._session.spec,e);if(0===t){const i=s.get_timezone(this._session.spec.timezone());e<this.startOfPeriod(i,0,s.get_year(e))&&(t=-1)}return t}startOfPeriod(e,t,i){if(t<0){i--;const r=s.get_cal(s.get_timezone("Etc/UTC"),i,s.DECEMBER,31,23,59,59),o=this.indexOfPeriod(r),a=-1*t,l=(0,n.toInt)(o/a)*a;return this.startOfPeriod(e,l,i)}const r=s.get_cal(s.get_timezone("Etc/UTC"),i,s.JANUARY,1),o=u(this._session.spec,r),a=0===o?7*t:7*(t+1)-o;return a>s.get_days_per_year(r)?this.startOfPeriod(e,0,i+1):(s.add_date(r,a),r)}}class v{indexOfPeriod(e){return s.get_month(e)}startOfPeriod(e,t,i){if(t<0){const e=(0,n.toInt)((11-t)/12);i-=e,t+=12*e}else t>s.DECEMBER&&(i++,t=s.JANUARY);return s.get_cal(s.get_timezone("Etc/UTC"),i,t,1)}}function S(e,t,i,s=!1){const n=r.Interval.parse(e),o=n.multiplier();return n.isMinutes()?new l(60*o,t):n.isSeconds()?new l(o,t):n.isTicks()?new l(1,t):n.isRange()?new l(60*o,t):new d(t,i,o,function(e,t){switch(e){case r.ResolutionKind.Days:return new g(t);case r.ResolutionKind.Weeks:return new f(t);case r.ResolutionKind.Months:return new v}throw new Error(`Unknown dwm resolution: ${e}`)}(n.kind(),t),s)}function y(e,t,i,s,r,n,o){return w(e,t,i,s,r,n,o,0)}function b(e,t,i,s,r,n,o){return w(e,t,i,s,r,n,o,1)}function w(e,t,i,s,n,a,l,c){const h=r.Interval.parse(n+s);if(h.isMonths()){const e=new Date(l);return 0===c&&e.setUTCDate(1),function(e,t){x(e,Math.floor(t/12));let i=e.getUTCMonth()-t%12;i<0&&(x(e,1),i+=12)
;e.setUTCMonth(i);for(;e.getUTCMonth()!==i;)I(e,1)}(e,a*h.multiplier()),e.getTime()}const d=new o.SessionInfo("Etc/UTC",e,t,i),u=h.inMilliseconds(),p=h.isDWM();let _;_=p?864e5:60*d.spec.maxTradingDayLength()*1e3;let m=0;m=h.isWeeks()?7:7-d.spec.weekEndsCount();const g=_/u,f=m*g;let v;if(a<f)v=a/g;else{v=7*(a/f)}return p&&(v=Math.floor(v)),l-864e5*v}function P(e,t,i,s,n,a,l){const c=r.Interval.parse(n+s);if(c.isMonths()){const e=new Date(a),t=new Date(l);let i=12*(t.getUTCFullYear()-e.getUTCFullYear());return i+=t.getUTCMonth()-e.getUTCMonth(),Math.ceil(i/c.multiplier())}const h=new o.SessionInfo("Etc/UTC",e,t,i),d=c.inMilliseconds();let u;u=c.isDWM()?864e5:60*h.spec.maxTradingDayLength()*1e3;let p=0;p=c.isWeeks()?7:7-h.spec.weekEndsCount();const _=l-a,m=u/d,g=p*m;let f=_/864e5*m;return f>=g&&(f=_/6048e5*g),Math.ceil(f)}function C(e,t){const i=s.clone(t);return e.alignToSessionStart(i),s.cal_to_utc(s.get_timezone(e.timezone()),i)}function T(e,t){const i=s.utc_to_cal(t.timezone,+e);let r=s.get_day_of_week(i),n=s.get_minutes_from_midnight(i);const o=t.spec.findSession(t.spec.getWeekIndex(i),r,n).getEntry();return o.isOvernight()&&n>o.startOffset()+o.length()&&r===o.dayOfWeek()-1&&(r++,n-=1440),r===o.dayOfWeek()&&n>=o.startOffset()&&n<o.startOffset()+o.length()}function x(e,t){const i=e.getUTCMonth();e.setUTCFullYear(e.getUTCFullYear()-t),e.getUTCMonth()!==i&&I(e,1)}function I(e,t){e.setTime(e.getTime()-864e5*t)}},632163:(e,t,i)=>{"use strict";i.d(t,{BusinessDay:()=>r});var s=i(871555);class r{constructor(e,t,i){this.year=e,this.month=t,this.day=i}toString(){return`${this.year}-${this.month}-${this.day}`}compareTo(e){return this.year>e.year||this.year===e.year&&this.month>e.month||this.year===e.year&&this.month===e.month&&this.day>e.day?1:this.year===e.year&&this.month===e.month&&this.day===e.day?0:-1}before(e){return-1===this.compareTo(e)}toCalendar(e){return s.get_cal(s.get_timezone("Etc/UTC"),this.year,this.month-1,this.day)}addDays(e){const t=this.toCalendar(s.get_timezone("Etc/UTC"));return s.add_date(t,e),r.fromCalendar(t)}static fromCalendar(e){return new r(s.get_year(e),s.get_month(e)+1,s.get_day_of_month(e))}}},467978:(e,t,i)=>{"use strict";var s;i.d(t,{SessionStage:()=>s}),function(e){e[e.PRE_SESSION=-1]="PRE_SESSION",e[e.POST_SESSION=-2]="POST_SESSION",e[e.LASTBAR_SESSION=-3]="LASTBAR_SESSION"}(s||(s={}))},831551:(e,t,i)=>{"use strict";i.d(t,{extrapolateBarsFrontToTime:()=>r,extrapolateBarsFrontByCount:()=>n});var s=i(467978);function r(e,t,i,s,n=!1){if(t>i){const o=r(e,i,t,s,n);return o.count=-o.count,o}return o(e,t,1,((e,t)=>t>i||0!==s&&e>s),n)}function n(e,t,i,s=!1){const r=i<0?-1:1;return o(e,t,r,((e,t)=>e>=i*r),s)}function o(e,t,i,r,n){let o=0,a=t;e.moveTo(a);let l=0,c=Number.MAX_VALUE,h=!1,d=t;const u=[];for(;!r(o,a);){if(l>15)throw new Error("Internal error 0x10 while extrapolating.");const r=e.indexOfBar(a);if(r===s.SessionStage.PRE_SESSION&&1===i)a=e.startOfBar(0),e.moveTo(a);else if(r===s.SessionStage.PRE_SESSION&&-1===i)a=e.startOfBar(s.SessionStage.PRE_SESSION),
e.moveTo(a);else if(r===s.SessionStage.POST_SESSION&&1===i)a=e.startOfBar(s.SessionStage.POST_SESSION),e.moveTo(a);else{if(r===s.SessionStage.POST_SESSION&&-1===i)throw new Error("Internal error 0x12 while extrapolating.");{const p=e.startOfBar(r);if(p>t&&i>0||t>p&&i<0){if(h&&c===p)throw new Error("Internal error 0x11 while extrapolating.");h=!0,c=p,l=0,o++,d=p,n&&u.push(d)}if(0===r&&-1===i)a=p-1;else{a=e.startOfBar(r+i);const t=e.startOfBar(s.SessionStage.POST_SESSION);a>t&&(e.moveTo(t),a=e.startOfBar(0))}}}l++}return{time:d,times:u,count:o}}},443054:(e,t,i)=>{"use strict";i.d(t,{PrePostMarketBarIdentifier:()=>n});var s=i(871555);function r(e,t){return null!==t&&t.to>e&&e>=t.from}class n{constructor(e,t,i){this._timezone=e,this._preMarketSessionSpec=t,this._postMarketSessionSpec=i}getPreAndPostMarketTimes(e){if(0===e.length)return{preMarket:[],postMarket:[]};const t=[],i=[];let r=null,n=null,o=e[0],a=(0,s.utc_to_cal)(this._timezone,o);this._isInPreMarketSession(a)&&(n=o),this._isInPostMarketSession(a)&&(r=o);for(let l=1;l<e.length;l++){const c=e[l],h=(0,s.utc_to_cal)(this._timezone,c);null!==r&&this._isInPostMarketSession(a)&&!this._isInPostMarketSession(h)&&(i.push({start:r,stop:o}),r=null),null===n&&this._isInPreMarketSession(h)&&(n=c),null===r&&this._isInPostMarketSession(h)&&(r=c),null!==n&&this._isInPreMarketSession(a)&&!this._isInPreMarketSession(h)&&(t.push({start:n,stop:o}),n=null),o=c,a=h}return null!==n&&t.push({start:n,stop:e[e.length-1]}),null!==r&&i.push({start:r,stop:e[e.length-1]}),{preMarket:t,postMarket:i}}_isInPreMarketSession(e){return r(e,this._preMarketSessionSpec.bordersOfDailyBar(e))}_isInPostMarketSession(e){return r(e,this._postMarketSessionSpec.bordersOfDailyBar(e))}}},435818:(e,t,i)=>{"use strict";i.d(t,{SessionSpec:()=>v});var s=i(871555),r=i(624595),n=i(632163);function o(e,t){return e.compareTo(t)}class a{constructor(e,t,i){this._dayOfWeek=e,this._start=t,this._length=i}start(){return this._start+s.minutesPerDay*this.sessionStartDaysOffset()}startOffset(){return this._start}sessionStartDaysOffset(){return this._start>=0?0:this._start%s.minutesPerDay==0?-Math.ceil(this._start/s.minutesPerDay):-Math.floor(this._start/s.minutesPerDay)}sessionEndDaysOffset(){const e=this._start+this._length;return e>=0?0:e%s.minutesPerDay==0?-Math.ceil(e/s.minutesPerDay):-Math.floor(e/s.minutesPerDay)}isOvernight(){return this._start<0}dayOfWeek(){return this._dayOfWeek}sessionStartDayOfWeek(){let e=this._dayOfWeek-this.sessionStartDaysOffset();return e<s.SUNDAY&&(e+=7),e}sessionEndDayOfWeek(){let e=this.sessionStartDayOfWeek()+this.sessionEndDaysOffset();return e>s.SATURDAY&&(e=1),e}length(){return this._length}weight(){return this._dayOfWeek*s.minutesPerDay+this._start}compareTo(e){const t=this.weight(),i=t+this._length,s=e.weight(),r=s+e._length;return t<=s&&s<i||s<=t&&t<r?0:t>s?1:-1}contains(e){const t=60*s.get_hours(e)+s.get_minutes(e);let i=s.get_day_of_week(e)-this._dayOfWeek;i>0&&(i-=7);const r=i*s.minutesPerDay+t;return r>=this._start&&r<this._start+this._length}}class l{constructor(e,t,i){
this.weekIndex=e,this.entryIndex=t,this.entries=i}getEntry(){return this.entries[this.entryIndex]}}var c=i(817808);const h=[s.MONDAY,s.TUESDAY,s.WEDNESDAY,s.THURSDAY,s.FRIDAY],d=[s.SUNDAY,s.MONDAY,s.TUESDAY,s.WEDNESDAY,s.THURSDAY,s.FRIDAY,s.SATURDAY],u=(0,c.getLogger)("Chart.Model.SessionSpec");function p(e){return e>=48&&e<=57}class _{constructor(){this.entries=[],this.firstDayOfWeek=s.MONDAY,this.weekEndsCount=-1,this.maxTradingDayLength=0}parseSessions(e,t){var i;let s=!1;this._clear(),this.timezone=e;const{hasErrors:r,spec:n}=this._parseFirstDayOfWeek(t);if("24x7"===n.toLowerCase())for(const e of d)this.entries.push(_._createSessionEntry(e,0,0,0,0));else{let e=!1;const t=new Map;for(const i of n.split("|")){const r=i.split(":");if(1!==r.length&&2!==r.length){s=!0,u.logError(`Bad session section: ${i}`);continue}const n=1===r.length;if(n){if(e){s=!0,u.logError(`Duplicated default section: ${i}`);continue}e=!0}const o=n?h:_._parseWorkingDays(r[1]);for(const e of o)n&&t.has(e)||t.set(e,r[0])}for(const e of d){const i=t.get(e);if(void 0!==i)for(const t of i.split(",")){const{hasErrors:i,sessionEntry:r}=_._parseSessionEntry(e,t);i&&(s=i),this.entries.push(r)}}}this.entries.sort(o);const a=new Map;for(const e of this.entries){const t=e.dayOfWeek();a.set(t,e.length()+(null!==(i=a.get(t))&&void 0!==i?i:0))}return this.maxTradingDayLength=0,a.forEach((e=>{this.maxTradingDayLength=Math.max(this.maxTradingDayLength,e)})),this.weekEndsCount=7-a.size,s||r}static parseHolidaysAndCorrections(e,t,i){const r=new Map,n=new Map,o=e=>{const t=this._parseDay(e),i=t.toString(),s=n.get(i);return void 0!==s?s:(n.set(i,t),t)};if(""!==t){const e=[];for(const i of t.split(",")){if(8!==i.length)throw new Error(`bad holiday date: ${i}`);const t=o(i);r.set(t,e)}}if(""===i)return r;const l=s.get_timezone("Etc/UTC");for(const e of i.split(";")){const t=e.split(":");if(2!==t.length)throw new Error(`bad correction section: ${e}`);const i=[];if("dayoff"!==t[0])for(const e of t[0].split(","))i.push(this._parseSessionEntry(1,e).sessionEntry);for(const e of t[1].split(",")){if(8!==e.length)throw new Error(`bad correction date: ${e}`);const t=o(e),n=s.get_day_of_week(s.get_cal(l,t.year,t.month-1,t.day)),c=[];for(const e of i)c.push(new a(n,e.startOffset(),e.length()));r.set(t,c)}}return r}_clear(){this.entries=[],this.timezone="",this.firstDayOfWeek=s.MONDAY,this.weekEndsCount=-1}_parseFirstDayOfWeek(e){const t=e.split(";");if(t.length>2)return u.logError(`Only one \`first day\` specification expected @ session ${e}`),{hasErrors:!0,spec:e};if(1===t.length)return{hasErrors:!1,spec:e};let i=1;let r=t[0].indexOf("-")>=0?NaN:parseInt(t[0]);return isNaN(r)&&(i=0,r=parseInt(t[1])),r<s.SUNDAY||r>s.SATURDAY?(u.logError(`Unexpected day index @ session: ${e}; day index ${r}`),{hasErrors:!0,spec:e}):(this.firstDayOfWeek=r,{hasErrors:!1,spec:t[i]})}static _parseDay(e){const t=parseInt(e.substring(0,4)),i=parseInt(e.substring(4,6)),s=parseInt(e.substring(6,8));return new n.BusinessDay(t,i,s)}static _parseSessionEntry(e,t){let i=!1,s=t.split("-")
;2!==s.length&&(i=!0,u.logError(`Bad sessions entry: ${t}`),s=["0000","0000"]);let r=0,n=s[0];if(n.includes("F")){const e=n.split("F");n=e[0],r=""!==e[1]?parseInt(e[1]):1}let o=0,a=s[1];if(a.includes("F")){const e=a.split("F");a=e[0],o=""!==e[1]?parseInt(e[1]):1}if(!this._isCorrectSession(n)||!this._isCorrectSession(a))throw new Error(`Incorrect entry syntax: ${t}`);const l=n,c=a;return{hasErrors:i,sessionEntry:this._createSessionEntry(e,_._minutesFromHHMM(l),_._minutesFromHHMM(c),r,o)}}static _isCorrectSession(e){return 4===e.length&&p(e.charCodeAt(0))&&p(e.charCodeAt(1))&&p(e.charCodeAt(2))&&p(e.charCodeAt(3))}static _parseWorkingDays(e){const t=[];for(let i=0;i<e.length;i++){const s=+e[i];-1===t.indexOf(s)&&t.push(s)}return t}static _minutesFromHHMM(e){return s.get_minutes_from_hhmm(e)}static _createSessionEntry(e,t,i,r,n){0===i&&(i=s.minutesPerDay),r===n&&i<=t&&(r+=1),r>0&&(t-=r*s.minutesPerDay),n>0&&(i-=n*s.minutesPerDay);return new a(e,t,i-t)}}function m(e,t){return e.compareTo(t)<0}function g(e,t){const i=(0,r.lowerbound)(e,t,((e,t)=>-1===e.day.compareTo(t)));return i===e.length?null:e[i]}const f=621672192e5;class v{constructor(e="Etc/UTC",t="0000-0000",i="",r=""){this._entries=[],this._firstDayOfWeek=s.MONDAY,this._entriesHash=new Map,this._holidayAndCorrectionMap=new Map,this._holidaySessions=[];const n=new _;n.parseSessions(e,t),this._entries=n.entries,this._timezone=n.timezone,this._spec=t,this._firstDayOfWeek=n.firstDayOfWeek,this._weekEndsCount=n.weekEndsCount,this._maxTradingDayLength=n.maxTradingDayLength;const o=_.parseHolidaysAndCorrections(e,i,r),a=s.get_timezone(e);this._isThereCorrections=""!==i||""!==r,o.forEach(((e,t)=>{this._holidayAndCorrectionMap.set(t.toString(),e),this._holidaySessions.push({day:t,sessions:e});const i=this.getWeekIndex(t.toCalendar(a));this._entriesHash.set(i,null)})),this._holidaySessions.sort(((e,t)=>e.day.compareTo(t.day)))}entries(){return this._entries}timezone(){return this._timezone}spec(){return this._spec}firstDayOfWeek(){return this._firstDayOfWeek}addSessionEntry(e,t,i,r,n){0===i&&(i=s.minutesPerDay),r===n&&i<=t&&(r+=1),r>0&&(t-=r*s.minutesPerDay),n>0&&(i-=n*s.minutesPerDay);const o=i-t;this._entries.push(new a(e,t,o))}longestSessionLength(){let e=0,t=0;for(const t of this._holidaySessions)t.sessions.forEach((t=>{e=Math.max(e,t.length())}));return this._entries.forEach((e=>{t=Math.max(t,e.length())})),Math.max(e,t)}isWeekEnd(e){const t=(0,r.lowerbound)(this._entries,new a(e,0,0),((e,t)=>e.dayOfWeek()<t.dayOfWeek()));return t>this._entries.length-1||this._entries[t].dayOfWeek()!==e}isCalWeekEnd(e){const t=s.get_day_of_week(e);if(!this._isThereCorrections)return this.isWeekEnd(t);const i=n.BusinessDay.fromCalendar(e),r=this._holidayAndCorrectionMap.get(i.toString());return void 0===r?this.isWeekEnd(t):0===r.length}hasWeekEnds(){return this.weekEndsCount()>0}weekEndsCount(){return this._weekEndsCount}maxTradingDayLength(){return this._maxTradingDayLength}holidaysFromYearStart(e){if(!this._isThereCorrections)return 0
;const t=s.get_timezone(this._timezone),i=new n.BusinessDay(s.get_year(e),s.JANUARY,1),r=n.BusinessDay.fromCalendar(e);let o=0;const a=this._selectHolidays(i,r);for(let e=0;e<a.length;e++){const i=a[e].day.toCalendar(t);this.isWeekEnd(s.get_day_of_week(i))?o+=0===a[e].sessions.length?0:-1:o+=0===a[e].sessions.length?1:0}return o}intradayCanBeBuiltFrom24x7(e){return this._entries.every((t=>t.start()%e==0&&t.length()%e==0))}indexOfSession(e,t,i){const n=this._getEntriesForWeek(e);let o=(0,r.lowerbound)(n,new a(t,i,0),m);if(o!==n.length)return new l(e,o,n);let c=e;const h=7-t+this._firstDayOfWeek-1;for(i=-(s.minutesPerDay-i+h*s.minutesPerDay);;){c++;const e=this._getEntriesForWeek(c);if(0!==e.length)return o=(0,r.lowerbound)(e,new a(this._firstDayOfWeek,i,0),m),new l(c,o,e)}}findSession(e,t,i,s=0){const r=this.indexOfSession(e,t,i),n=r.entries;let o=r.entryIndex;if(0!==s){const e=n[o].dayOfWeek(),t=s>0?1:-1;for(;;){const i=o+t;if(i<0||i>=n.length||n[i].dayOfWeek()!==e)break;o=i}}return new l(r.weekIndex,o,n)}getWeekIndex(e){if(!this._isThereCorrections)return 0;const t=s.get_day_of_week(e)-s.SUNDAY,i=s.get_timezone("Etc/UTC"),r=s.get_cal(i,s.get_year(e),s.get_month(e),s.get_day_of_month(e)-t);return Math.floor((r.getTime()+f)/1e3/86400/7)}correctTradingDay(e){const t=s.get_day_of_week(e),i=60*s.get_hours(e)+s.get_minutes(e),r=this.getWeekIndex(e),n=this.findSession(r,t,i,0),o=n.getEntry().dayOfWeek()-t+7*(n.weekIndex-r);return 0!==o&&s.add_date(e,o),e}alignToSessionStart(e,t=0){const i=s.get_day_of_week(e),r=60*s.get_hours(e)+s.get_minutes(e),n=this.getWeekIndex(e),o=this.findSession(n,i,r,t),a=o.getEntry(),l=a.dayOfWeek()-i+7*(o.weekIndex-n);0!==l&&s.add_date(e,l);const c=a.startOffset();return s.set_hms(e,c/60,c%60,0,0,s.get_timezone(this._timezone)),a.length()}businessDaysToCalendarDays(e,t){let i=this.getWeekIndex(e),r=s.get_day_of_week(e),n=0,o=0;for(;o<t;){const e=this._getEntriesForWeek(i);let a=0;for(let i=r;i<=s.SATURDAY;i++){n++;let s=!0;for(;a<e.length&&!(e[a].dayOfWeek()>i);)e[a].dayOfWeek()<i||s&&(s=!1,o++),a++;if(o>=t)return n}i++,r=s.SUNDAY}return n}calendarDaysToBusinessDays(e,t){let i=this.getWeekIndex(e),r=s.get_day_of_week(e),n=0,o=0;for(;n<t;){const e=this._getEntriesForWeek(i);let a=0;for(let i=r;i<=s.SATURDAY;i++){n++;let s=!0;for(;a<e.length&&!(e[a].dayOfWeek()>i);)e[a].dayOfWeek()<i||s&&(s=!1,o++),a++;if(n>=t)return o}i++,r=s.SUNDAY}return o}alignToNearestSessionStart(e,t){return this._alignToNearestSessionValue(e,t,this._entrySessionStart.bind(this))}alignToNearestSessionEnd(e,t){return this._alignToNearestSessionValue(e,t,this._entrySessionEnd.bind(this))}leftBorderOfDailyBar(e){const t=this._getEntriesForDay(e);return 0===t.length?null:(t.sort(o),this._getLeftEntryBorder(e,t[0]))}bordersOfDailyBar(e){const t=this._getEntriesForDay(e);if(0===t.length)return null;t.sort(o);const i=this._getLeftEntryBorder(e,t[0]),r=t[t.length-1],n=s.clone(e);let a=60*(r.startOffset()+r.length())-1;const l=Math.floor(a/3600);return a-=3600*l,s.set_hms(n,l,a/60,a%60,0,s.get_timezone(this._timezone)),{from:i,to:n}}
getEntriesForWeekByCalendar(e){const t=this.getWeekIndex(e);return this._getEntriesForWeek(t)}_getEntriesForWeek(e){let t=this._entriesHash.get(e);if(void 0===t)return this._entries;if(null!==t)return t;const i=s.get_timezone(this._timezone);t=this._entries.slice();const r=this._weekIndexToCalendar(e),a=this._weekIndexToCalendar(e+1),l=n.BusinessDay.fromCalendar(r),c=n.BusinessDay.fromCalendar(a),h=this._selectHolidays(l,c);for(const e of h){const r=e.day.toCalendar(i),n=s.get_day_of_week(r);t=t.filter((e=>e.dayOfWeek()!==n)),t=t.concat(e.sessions)}return t.sort(o),this._entriesHash.set(e,t),t}_selectHolidays(e,t){const i=[];let s=e;for(;;){const e=g(this._holidaySessions,s);if(null===e)return i;if(!e.day.before(t))return i;i.push(e),s=e.day.addDays(1)}}_weekIndexToCalendar(e){const t=1e3*(86400*e*7+86400)-f,i=s.get_cal_from_unix_timestamp_ms(s.get_timezone("Etc/UTC"),t),r=s.get_timezone("Etc/UTC");return s.get_cal(r,s.get_year(i),s.get_month(i),s.get_day_of_month(i))}_alignToNearestSessionValue(e,t,i){const r=s.get_day_of_week(e),n=60*s.get_hours(e)+s.get_minutes(e),o=this.getWeekIndex(e);let a=this.findSession(o,r,n);if(a.getEntry().contains(e)&&o===a.weekIndex||1===t)return i(a,s.clone(e),t);const c=a.getEntry(),h=c.contains(e),d=o===a.weekIndex,u=c.sessionStartDaysOffset()-c.dayOfWeek()>=0;if(h&&(d||u))return i(a,s.clone(e),t);let p=a.entryIndex-1;if(p<0){let e=a.weekIndex,t=a.entries;for(;p<0;)e--,t=this._getEntriesForWeek(e),p+=t.length;a=new l(e,p,t)}else a=new l(a.weekIndex,p,a.entries);return i(a,s.clone(e),t)}_entrySessionStart(e,t,i){return this._entrySessionValue(e,t,i,(e=>60*e.start()))}_entrySessionEnd(e,t,i){return this._entrySessionValue(e,t,i,(e=>60*(e.start()+e.length())-1))}_entrySessionValue(e,t,i,r){let n=s.get_day_of_week(t);const o=e.getEntry();let a=o.dayOfWeek()-o.sessionStartDaysOffset();const l=this.getWeekIndex(t);let c=e.weekIndex-l,h=!1;if(a<s.SUNDAY&&(c<=0?h=!0:c--,a+=7),(c>0&&i>=0||c<0&&i<0)&&s.add_date(t,7*c),!o.contains(t)){let e=a-n;h&&i<0&&(e=-(7-a+n)),s.add_date(t,e),n=s.get_day_of_week(t)}o.isOvernight()&&n===o.dayOfWeek()&&s.add_date(t,-o.sessionStartDaysOffset());let d=r(o);const u=Math.floor(d/3600);return d-=3600*u,s.set_hms(t,u,d/60,d%60,0,s.get_timezone(this._timezone)),t}_getEntriesForDay(e){const t=s.get_day_of_week(e);return this._getEntriesForWeek(this.getWeekIndex(e)).filter((e=>e.dayOfWeek()===t))}_getLeftEntryBorder(e,t){const i=s.clone(e),r=t.startOffset();return s.set_hms(i,r/60,r%60,0,0,s.get_timezone(this._timezone)),i}}},307007:(e,t,i)=>{"use strict";i.d(t,{barFunctionByStyle:()=>r});var s=i(510656);function r(e,t){switch(e){case 12:return(0,s.barFunction)("low","low","close");case 2:case 3:case 10:case 13:return(0,s.barFunction)(null!=t?t:"close");default:return(0,s.barFunction)("close","open")}}},964892:(e,t,i)=>{"use strict";i.d(t,{BarsMarksContainer:()=>m});var s=i(650151),r=i(817808),n=i(870122),o=i.n(n),a=i(484727),l=i(638273),c=i(486028),h=i(632054),d=i(881517),u=i(744687);const p=(0,
r.getLogger)("Chart.BarsMarksContainer"),_=Math.round(new Date(2037,0,1).getTime()/1e3);class m extends d.DataSource{constructor(e,t,i){const r=e.onWidget();let n;n=r?!e.hideIdeas():!!a.enabled("bars_marks")&&o().getBool("BarsMarksContainer.visibile",!1),t.merge({visible:n}),t.childs().visible.subscribe(null,(t=>{r||e.isSnapshot()||!a.enabled("bars_marks")||o().setValue("BarsMarksContainer.visibile",!!t.value())})),super(i),this._paneViews=[],this._model=e,this._properties=t,this._requests=[],this._marks={},this._loadedRange=null,this._getDataTimeout=null,this._collectedRange=null,this._lastRange=null;const l=this._model.mainSeries();l.onSymbolIntervalChanged().subscribe(this,this.clearMarks),l.dataEvents().symbolResolved().subscribe(this,this.clearMarks),l.dataEvents().completed().subscribe(this,(()=>{var e,t;const i=l.data();if(0===i.size())return;const r=(0,s.ensureNotNull)(i.first()).index,n=(0,s.ensureNotNull)(i.last()).index,o=this.timeScale();this.getData({start:null!==(e=o.indexToTimePoint(r))&&void 0!==e?e:1/0,end:null!==(t=o.indexToTimePoint(n))&&void 0!==t?t:-1/0})})),this._initialize(),this._pinnedTooltips={}}destroy(){const e=this._model.mainSeries();e.onSymbolIntervalChanged().unsubscribeAll(this),e.dataEvents().symbolResolved().unsubscribeAll(this),e.dataEvents().completed().unsubscribeAll(this)}properties(){return this._properties}marks(){return this._marks}pinTooltip(e,t){this._pinnedTooltips[e]=t}timeScale(){return this._model.timeScale()}getIntervalInTicks(){const e=this._model.mainSeries().properties().childs().interval.value(),t=l.Interval.parse(e);if(!t.isValid())throw new TypeError("Unexpected interval");return t.isRange()?60:t.inMilliseconds()/1e3}getVisibleTickMarksRange(){var e,t;if(this.timeScale().isEmpty())return{start:0,end:0};const i=(0,s.ensureNotNull)(this.timeScale().visibleBarsStrictRange()),{firstIndex:r,lastIndex:n}=(0,s.ensureNotNull)(this.timeScale().points().range().value());if(!(i.lastBar()>r&&i.firstBar()<n))return{start:0,end:0};let o;o=i.lastBar()<n?this.timeScale().indexToTimePoint(i.lastBar()):_;const a={start:this.timeScale().indexToTimePoint(Math.max(i.firstBar(),r)),end:o};return{start:null!==(e=a.start)&&void 0!==e?e:1/0,end:null!==(t=a.end)&&void 0!==t?t:-1/0}}getVisibleRangePlates(){const e=[],t=this.getVisibleTickMarksRange(),i=this.getIntervalInTicks();return Object.keys(this._marks).forEach((s=>{var r,n;const o=this._marks[s],a=o.tickmark;a>=(null!==(r=t.start)&&void 0!==r?r:1/0)&&a<=(null!==(n=t.end)&&void 0!==n?n:-1/0)+i&&e.push(o)})),e}getPublishedPlates(){const e={};return window.is_authenticated?(this.getVisibleRangePlates().forEach((t=>{t.is_public&&(this._pinnedTooltips[t.id]||t.user__id===window.user.id)&&(e[t.id]=t)})),e):e}filterDisplayedPlates(e){const t=e.reduce(((e,t)=>{const i=this._getIndex(t.tickmark);return null!==i&&(e[i]=e[i]||[],e[i].push(t)),e}),{});return Object.keys(t).reduce(((e,i)=>{let s=t[i];return s=s.sort(((e,t)=>t.views_count-e.views_count)),s=s.slice(0,10),e.concat(s)}),[])}getPlatesViewData(){var e,t,i
;const r=this._model.mainSeries();if(r.data().isEmpty())return[];const n=(0,h.isPriceSourceStyle)(r.style())?r.barFunction():null,o=this.filterDisplayedPlates(this.getVisibleRangePlates()),a={},l=null!==(e=this._model.lastHittestData())&&void 0!==e?e:this._model.lastSelectedHittestData();let c=null;null!==l&&this._model.hoveredSource()===this&&(c=null!==(t=l.activeItem)&&void 0!==t?t:null);const d=[];for(const e of o){const t=(0,s.ensureNotNull)(this._getIndex(e.tickmark)),i=this._getBar(t);if(null===i)continue;const r=this._layout(e.direction),o=this._theme(e.direction),l=c===e.id,h=this.timeScale().indexToCoordinate(t),u=this._offset(r,i,n),p=(0,s.ensureNotNull)(this.priceScale()).isInverted();let _=0;t in a||(a[t]={up:0,down:0}),_=a[t][r]++,d.push({id:e.id,x:h,y:u,yInverted:p,order:_,direction:r,theme:o,hovered:l,pinned:!0===this._pinnedTooltips[e.id],user__id:e.user__id,label:e.label,labelFontColor:e.labelFontColor||"#444",minSize:e.minSize||5,...this._plateViewData(e)})}const u=d.filter((e=>!0===e.hovered));for(let e=0;e<o.length;e++)o[e].user__id===(null===(i=u[0])||void 0===i?void 0:i.user__id)&&(o[e].highlightByAuthor=!0);return d.sort(((e,t)=>e.hovered&&!t.hovered?1:0)),d}priceAxisViews(){return null}updateAllViews(e){for(const t of this._paneViews)t.update(e)}updateAllViewsAndRepaint(){this.updateAllViews((0,u.sourceChangeEvent)(this.id())),this._model.updateSource(this)}roundRange(e){return{start:Math.round(e.start),end:Math.round(e.end)}}refreshData(){null!==this._lastRange&&this.getData(this._lastRange)}getData(e){(0,c.isNumber)(e.start)&&(0,c.isNumber)(e.end)?(this._lastRange=e,e.end=_,this._pushGetDataStack(Object.assign({},e))):p.logError("Wrong range")}clearMarks(){this._abortAllRequests(),this._marks={},this._loadedRange=null}isUserDeletable(){return!1}isSavedInChart(e){return!1}isSpeciallyZOrderedSource(){return!0}showInObjectTree(){return!1}_plateViewData(e){return{}}_layout(e){switch(e){default:case 0:case 2:case 3:case 4:case 5:case 6:return"up";case 1:return"down"}}_theme(e){switch(e){default:case 0:return"neutral";case 1:case 5:return"green";case 2:case 6:return"red";case 3:return"yellow";case 4:return"blue"}}_offset(e,t,i){let r;switch(e){default:case"up":r=null===i?t[2]:i(t);break;case"down":r=null===i?t[3]:i(t)}return(0,s.ensureNotNull)(this.priceScale()).priceToCoordinate(r,(0,s.ensureNotNull)((0,s.ensureNotNull)(this.ownerSource()).firstValue()))}_getIndex(e){return this.timeScale().timePointToIndex(e)}_getBar(e){return this._model.mainSeries().data().valueAt(e)}_rangeDifference(e){return e=Object.assign({start:1/0,end:-1/0},e),this._loadedRange&&(e.start<this._loadedRange.start?e.end=this._loadedRange.start:e.end>this._loadedRange.end&&(e.start=this._loadedRange.end)),e}_rangeUnion(e,t){return e=Object.assign({start:1/0,end:-1/0},e),t&&(e.start=Math.min(t.start,e.start),e.end=Math.max(t.end,e.end)),e}_pushGetDataStack(e){(0,c.isNumber)(e.start)&&(0,c.isNumber)(e.end)?(this._getDataTimeout&&clearTimeout(this._getDataTimeout),this._collectedRange=this._rangeUnion(e,this._collectedRange),
this._getDataTimeout=setTimeout((()=>{this._getData(this._collectedRange),this._getDataTimeout=this._collectedRange=null}),300)):p.logError("Wrong tickmark range")}_abortAllRequests(){this._requests.forEach((e=>{e.cancel()})),this._requests=[],this._getDataTimeout&&clearTimeout(this._getDataTimeout),this._getDataTimeout=this._collectedRange=null}}},254303:(e,t,i)=>{"use strict";var s=i(153026).PlotRowSearchMode,r=i(444649).STUDYPLOTDISPLAYTARGET,n=i(602564).rgbaFromInteger;function o(){this.backColorers=[]}function a(e){o.call(this),this._series=e}function l(e,t){o.call(this),this._study=e,this._plotIndex=t}o.prototype.barStyle=function(e,t,i){for(var s={},r=this.backColorers.length-1;r>=0;r--)this.backColorers[r].applyBarStyle(e,t,s,i);return this.applyBarStyle(e,t,s,i),s},o.prototype.pushBackBarColorer=function(e){this.backColorers.push(e)},o.prototype.applyBarStyle=function(e,t,i){throw new Error("This function is supposed to be reimplemented in a subclass")},inherit(a,o),a.upColor=function(e,t){var i=e.style.value();switch(i){case TradingView.Series.STYLE_LINE:return e.lineStyle.color.value();case TradingView.Series.STYLE_AREA:return e.areaStyle.linecolor.value();case TradingView.Series.STYLE_BARS:return e.barStyle.upColor.value();case TradingView.Series.STYLE_CANDLES:return e.candleStyle.upColor.value();case TradingView.Series.STYLE_HOLLOW_CANDLES:return e.hollowCandleStyle.upColor.value();case TradingView.Series.STYLE_HEIKEN_ASHI:return e.haStyle.upColor.value();case TradingView.Series.STYLE_BASELINE:return e.baselineStyle.topLineColor.value();case TradingView.Series.STYLE_HILO:return e.hiloStyle.color.value();case TradingView.Series.STYLE_COLUMNS:return e.columnStyle.upColor.value()}switch(i){case TradingView.Series.STYLE_RENKO:return t?e.renkoStyle.upColorProjection.value():e.renkoStyle.upColor.value();case TradingView.Series.STYLE_PB:return t?e.pbStyle.upColorProjection.value():e.pbStyle.upColor.value();case TradingView.Series.STYLE_KAGI:return t?e.kagiStyle.upColorProjection.value():e.kagiStyle.upColor.value();case TradingView.Series.STYLE_PNF:return t?e.pnfStyle.upColorProjection.value():e.pnfStyle.upColor.value()}throw new Error("Unknown series style")},a.downColor=function(e,t){var i=e.style.value();switch(i){case TradingView.Series.STYLE_LINE:return e.lineStyle.color.value();case TradingView.Series.STYLE_AREA:return e.areaStyle.linecolor.value();case TradingView.Series.STYLE_BARS:return e.barStyle.downColor.value();case TradingView.Series.STYLE_CANDLES:return e.candleStyle.downColor.value();case TradingView.Series.STYLE_HOLLOW_CANDLES:return e.hollowCandleStyle.downColor.value();case TradingView.Series.STYLE_HEIKEN_ASHI:return e.haStyle.downColor.value();case TradingView.Series.STYLE_BASELINE:return e.baselineStyle.bottomLineColor.value();case TradingView.Series.STYLE_HILO:return e.hiloStyle.color.value();case TradingView.Series.STYLE_COLUMNS:return e.columnStyle.downColor.value()}switch(i){case TradingView.Series.STYLE_RENKO:
return t?e.renkoStyle.downColorProjection.value():e.renkoStyle.downColor.value();case TradingView.Series.STYLE_PB:return t?e.pbStyle.downColorProjection.value():e.pbStyle.downColor.value();case TradingView.Series.STYLE_KAGI:return t?e.kagiStyle.downColorProjection.value():e.kagiStyle.downColor.value();case TradingView.Series.STYLE_PNF:return t?e.pnfStyle.downColorProjection.value():e.pnfStyle.downColor.value()}throw new Error("Unknown series style")},a.prototype._applyLineStyle=function(e,t,i,s,r){i.barColor=a.upColor(r)},a.prototype._applyAreaStyle=function(e,t,i,s,r){i.barColor=a.upColor(r)},a.prototype._applyBarStyle=function(e,t,i,s,r){var n=a.upColor(r),o=a.downColor(r),l=this.findBar(e,!1,s);if(r.barStyle.barColorsOnPrevClose.value()){var c=this.findPrevBar(e,!1,s);i.barColor=c[TradingView.CLOSE_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o,i.barBorderColor=c[TradingView.CLOSE_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o}else i.barColor=l[TradingView.OPEN_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o,i.barBorderColor=l[TradingView.OPEN_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o},a.prototype._applyCandleStyle=function(e,t,i,s,r){var n,o=a.upColor(r,t),l=a.downColor(r,t),c=r.candleStyle.borderUpColor?r.candleStyle.borderUpColor.value():r.candleStyle.borderColor.value(),h=r.candleStyle.borderDownColor?r.candleStyle.borderDownColor.value():r.candleStyle.borderColor.value(),d=r.candleStyle.wickUpColor?r.candleStyle.wickUpColor.value():r.candleStyle.wickColor.value(),u=r.candleStyle.wickDownColor?r.candleStyle.wickDownColor.value():r.candleStyle.wickColor.value(),p=this.findBar(e,!1,s);r.candleStyle.barColorsOnPrevClose.value()&&this._series.data().first().index!==e?n=this.findPrevBar(e,!1,s)[TradingView.CLOSE_PLOT]<=p[TradingView.CLOSE_PLOT]:n=p[TradingView.OPEN_PLOT]<=p[TradingView.CLOSE_PLOT];i.barColor=n?o:l,i.barBorderColor=n?c:h,i.barWickColor=n?d:u},a.prototype._applyHollowCandleStyle=function(e,t,i,s,r){var n,o=a.upColor(r,t),l=a.downColor(r,t),c=r.hollowCandleStyle.borderUpColor?r.hollowCandleStyle.borderUpColor.value():r.hollowCandleStyle.borderColor.value(),h=r.hollowCandleStyle.borderDownColor?r.hollowCandleStyle.borderDownColor.value():r.hollowCandleStyle.borderColor.value(),d=r.hollowCandleStyle.wickUpColor?r.hollowCandleStyle.wickUpColor.value():r.hollowCandleStyle.wickColor.value(),u=r.hollowCandleStyle.wickDownColor?r.hollowCandleStyle.wickDownColor.value():r.hollowCandleStyle.wickColor.value(),p=this.findBar(e,!1,s),_=this.findPrevBar(e,!1,s);n=this._series.data().first().index!==e?_[TradingView.CLOSE_PLOT]<=p[TradingView.CLOSE_PLOT]:p[TradingView.OPEN_PLOT]<=p[TradingView.CLOSE_PLOT],i.barColor=n?o:l,i.barBorderColor=n?c:h,i.barWickColor=n?d:u,i.isBarHollow=p[TradingView.OPEN_PLOT]<=p[TradingView.CLOSE_PLOT]},a.prototype._applyHAStyle=function(e,t,i,s,r){var n,o=a.upColor(r,t),l=a.downColor(r,t),c=r.haStyle.borderUpColor.value(),h=r.haStyle.borderDownColor.value(),d=r.haStyle.wickUpColor.value(),u=r.haStyle.wickDownColor.value(),p=this.findBar(e,t,s)
;r.haStyle.barColorsOnPrevClose.value()?n=this.findPrevBar(e,t,s)[TradingView.CLOSE_PLOT]<=p[TradingView.CLOSE_PLOT]:n=p[TradingView.OPEN_PLOT]<=p[TradingView.CLOSE_PLOT];i.barColor=n?o:l,i.barBorderColor=n?c:h,i.barWickColor=n?d:u},a.prototype._applyRenkoStyle=function(e,t,i,s,r){var n=this.findBar(e,t,s),o=n[TradingView.OPEN_PLOT]<=n[TradingView.CLOSE_PLOT],l=a.upColor(r,t),c=a.downColor(r,t),h=t?r.renkoStyle.borderUpColorProjection.value():r.renkoStyle.borderUpColor.value(),d=t?r.renkoStyle.borderDownColorProjection.value():r.renkoStyle.borderDownColor.value(),u=r.renkoStyle.wickUpColor.value(),p=r.renkoStyle.wickDownColor.value();i.barColor=o?l:c,i.barBorderColor=o?h:d,i.barWickColor=o?u:p,i.isBarUp=o},a.prototype._applyPBStyle=function(e,t,i,s,r){i.barColor=a.upColor(r);var n=this.findBar(e,t,s),o=n[TradingView.OPEN_PLOT]<=n[TradingView.CLOSE_PLOT],l=a.upColor(r,t),c=a.downColor(r,t),h=t?r.pbStyle.borderUpColorProjection.value():r.pbStyle.borderUpColor.value(),d=t?r.pbStyle.borderDownColorProjection.value():r.pbStyle.borderDownColor.value();i.barColor=o?l:c,i.barBorderColor=o?h:d,i.isBarUp=o},a.prototype._applyKagiStyle=function(e,t,i,s,r){i.upColor=a.upColor(r,t),i.downColor=a.downColor(r,t);var n=null,o=this.findBar(e,t,s);o[TradingView.LOW_PLOT]<o[TradingView.ADT_PLOT]&&o[TradingView.ADT_PLOT]<o[TradingView.HIGH_PLOT]?(n=o[TradingView.OPEN_PLOT]<=o[TradingView.CLOSE_PLOT],i.isTwoColorBar=!0):(n=o[TradingView.OPEN_PLOT]<=o[TradingView.CLOSE_PLOT]?o[TradingView.OPEN_PLOT]===o[TradingView.ADT_PLOT]:o[TradingView.OPEN_PLOT]!==o[TradingView.ADT_PLOT],i.isTwoColorBar=!1),i.barColor=n?i.upColor:i.downColor,i.isBarUp=o[TradingView.OPEN_PLOT]<=o[TradingView.CLOSE_PLOT]},a.prototype._applyPnfStyle=function(e,t,i,s,r){var n=this.findBar(e,t,s)[TradingView.ADT_PLOT],o=n>0,l=a.upColor(r,t),c=a.downColor(r,t);i.isBarUp=o,i.isMergedBar=2===Math.abs(n),i.upColor=l,i.downColor=c,i.barColor=o?l:c},a.prototype._applyBaseLineStyle=function(e,t,i,s,r){var n=this.findBar(e,t,s),o=r.baselineStyle,l=this._series.priceScale(),c=Math.round(l.height()*(Math.abs(100-o.baseLevelPercentage.value())/100)),h=this._series.firstValue(),d=l.coordinateToPrice(c,h);n[TradingView.CLOSE_PLOT]>d?i.barColor=a.upColor(r,t):i.barColor=a.downColor(r,t)},a.prototype._applyHiLoStyle=function(e,t,i,s,r){i.barColor=a.upColor(r,t),i.barBorderColor=r.hiloStyle.borderColor.value()},a.prototype._applyColumnStyle=function(e,t,i,s,r){var n=a.upColor(r),o=a.downColor(r),l=this.findBar(e,!1,s);if(r.columnStyle.barColorsOnPrevClose.value()){var c=this.findPrevBar(e,!1,s);i.color=c[TradingView.CLOSE_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o}else i.color=l[TradingView.OPEN_PLOT]<=l[TradingView.CLOSE_PLOT]?n:o;i.barColor=i.color},a.prototype.applyBarStyle=function(e,t,i,s){i||(i={}),i.barColor=null,i.barBorderColor=null,i.barWickColor=null,i.isBarHollow=null,i.isBarUp=null,i.upColor=null,i.downColor=null,i.isTwoColorBar=null,i.isMergedBar=null;var r=this._series.properties(),n=r.style.value();switch(n){case TradingView.Series.STYLE_LINE:this._applyLineStyle(e,t,i,s,r)
;break;case TradingView.Series.STYLE_AREA:this._applyAreaStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_BARS:this._applyBarStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_CANDLES:this._applyCandleStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_HOLLOW_CANDLES:this._applyHollowCandleStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_HEIKEN_ASHI:this._applyHAStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_BASELINE:this._applyBaseLineStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_HILO:this._applyHiLoStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_COLUMNS:this._applyColumnStyle(e,t,i,s,r)}switch(n){case TradingView.Series.STYLE_RENKO:this._applyRenkoStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_PB:this._applyPBStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_KAGI:this._applyKagiStyle(e,t,i,s,r);break;case TradingView.Series.STYLE_PNF:this._applyPnfStyle(e,t,i,s,r)}return i},a.prototype.getSeriesBars=function(e){return e?this._series.nsBars():this._series.bars()},a.prototype._findBarFieldValue=function(e,t,i){var s=this.getSeriesBars(i).valueAt(e);if(null!==s)return s[t]},a.prototype.findBar=function(e,t,i){return i?i.value:this.getSeriesBars(t).valueAt(e)||[]},a.prototype.findPrevBar=function(e,t,i){if(i&&i.previousValue)return i.previousValue;var r=this._series.bars().search(e-1,s.NearestLeft,TradingView.CLOSE_PLOT);return null!==r?r.value:[]},inherit(l,o),l.prototype.getBars=function(){return this._study.series().bars()},l.prototype.firstColoredBar=function(e){for(var t=e,i=0;i<this.backColorers.length;i++)t=Math.min(t,this.backColorers[i].firstColoredBar(e));var s=this.getOffset(this._plotIndex);t=Math.min(t,e+s);var r=this.getBars().firstIndex();return Math.max(t,r)},l.prototype.getOffset=function(){var e=this._study.metaInfo().plots[this._plotIndex];return this._study.offset(e.id)},l.prototype.applyBarStyle=function(e,t,i){if(i||(i={}),t)return i;var s=this._study.properties();if(!s.visible.value())return i;var o=this._study.metaInfo(),a=this._study.data();if(!a||0===a.size())return i;var l=o.plots[this._plotIndex],c=this.getOffset();if(this._study.getMinFirstBarIndexForPlot(l.id)>e+c)return i;if(s.styles[l.id].display.value()===r.None)return i;var h=a.valueAt(e-c);if(null===h)return i;var d=h[this._plotIndex+1];if(null==d)return i;if(d=Math.round(d),o.isRGB)i.barColor=n(d),i.upColor=i.barColor,i.downColor=i.barColor;else{var u=o.plots[this._plotIndex].palette,p=s.palettes[u],_=o.palettes[u].valToIndex?o.palettes[u].valToIndex[d]:d,m=p.colors[_].color.value();i.barColor=m,i.upColor=m.color,i.downColor=m.color}return i},t.SeriesBarColorer=a,t.StudyBarColorer=l},621833:(e,t,i)=>{"use strict";i.d(t,{BarsRange:()=>r});var s=i(650151);class r{constructor(e,t){(0,s.assert)(e<=t,"The last bar in the bars range should be greater than or equal to the first bar"),this._firstBar=e,this._lastBar=t}firstBar(){return this._firstBar}lastBar(){return this._lastBar}count(){return this._lastBar-this._firstBar+1}contains(e){return this._firstBar<=e&&e<=this._lastBar}equals(e){
return this._firstBar===e.firstBar()&&this._lastBar===e.lastBar()}static compare(e,t){return null===e||null===t?e===t:e.equals(t)}}},929357:(e,t,i)=>{"use strict";i.d(t,{ChartModelBase:()=>Ji});var s=i(304889),r=i(822914),n=i(650151),o=i(86441),a=i(724377),l=i(676507),c=i(509806),h=i(702054),d=i(9316),u=i(32133),p=i(114122),_=i(559410),m=i(131595),g=i(927079),f=i(622200),v=i(624595),S=i(232468);function y(e){return(0,S.isLineTool)(e)&&e.boundToSymbol()||!1}class b{constructor(){this._items=[],this._set=new Set,this._dataSourcesCache=null,this._customSourcesCache=null,this._lineSourcesCache=null}isEmpty(){return 0===this._items.length}add(e){if(this._items.length>0&&!y(this._items[0])&&this.clear(),y(e)){const t=(0,v.lowerbound)(this._items,e,((e,t)=>e.zorder()<t.zorder()));this._items.splice(t,0,e)}else this.clear(),this._items=[e];this._set.add(e),this._invalidateCache()}canBeAddedToSelection(e){return 0===this._items.length||y(this._items[0])&&y(e)}isSelected(e){return this._set.has(e)}allSources(){return this._items.slice(0)}dataSources(){return null===this._dataSourcesCache&&(this._dataSourcesCache=this._items.filter(f.isDataSource)),this._dataSourcesCache}lineDataSources(){return null===this._lineSourcesCache&&(this._lineSourcesCache=this._items.filter(S.isLineTool)),this._lineSourcesCache}customSources(){return null===this._customSourcesCache&&(this._customSourcesCache=this._items.filter((e=>!(0,f.isDataSource)(e)))),this._customSourcesCache}checkLineToolSelection(){this._items.forEach((e=>(0,S.isLineTool)(e)&&e.calcIsActualSymbol())),this._items=this._items.filter((e=>!(0,S.isLineTool)(e)||e.isActualSymbol())),this._invalidateCache()}remove(e){this._items=this._items.filter((t=>t!==e)),this._set.delete(e),this._invalidateCache()}clear(){this._items=[],this._set.clear(),this._invalidateCache()}_invalidateCache(){this._customSourcesCache=null,this._dataSourcesCache=null,this._lineSourcesCache=null}}var w=i(198459),P=i(665851),C=i(278787),T=i(638273),x=i(508547),I=i(976704),M=i.n(I),L=i(779292),A=i(574570);class k{constructor(e){this._rendererOptions={borderSize:1,offsetSize:5,fontSize:NaN,font:"",color:"",paneBackgroundColor:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,lineSpacing:0},this._chartModel=e}options(){const e=this._rendererOptions,t=this._chartModel.properties().childs(),i=t.scalesProperties.childs().fontSize.value();return e.fontSize!==i&&(e.fontSize=i,e.font=(0,L.makeFont)(i,A.CHART_FONT_FAMILY,""),e.paddingTop=2.5/12*i,e.paddingBottom=e.paddingTop,e.paddingInner=i/12*e.offsetSize,e.paddingOuter=i/12*e.offsetSize,e.lineSpacing=2/12*i),e.color=t.scalesProperties.childs().textColor.value(),e.paneBackgroundColor=t.paneProperties.childs().background.value(),this._rendererOptions}}var E=i(152244),D=i(135834),B=i(821737),V=i(658363),R=i(404493),N=i(484727),O=i(632054),F=i(548193),W=i(744687);const z=new B.PriceFormatter,H="sessions";class U extends R.CustomSourceBase{constructor(e,t,i){super(e,t),this._studySource=null,this._paneViews=[],this._metaInfo=null,this._destroyed=!1,
this._isStarted=!1,this._loadedGraphics=null,this._doubleClickHandler=i;const s=t.mainSeries();this._properties=new x.DefaultProperty("sessions"),(0,V.applyDefaultsOverrides)(this._properties.childs().graphics,void 0,!1,H),this._removeDuplicateProperties(),this._properties.subscribe(this,this._onPropertiesChanged),t.studyMetaInfoRepository().findById({type:"java",studyId:"Sessions@tv-basicstudies"}).then((i=>{this._destroyed||null===this._loadedGraphics&&(this._setMetaInfo(i),null!==this._metaInfo&&(this._studySource=new E.StudyDataSource(t.chartApi(),s.seriesSource(),"sessions_",this._metaInfo),this._createPaneViews(),this._studySource.dataCleared().subscribe(this,this.updateAllViews.bind(this,(0,W.sourceChangeEvent)(e))),this._studySource.dataUpdated().subscribe(this,this.updateAllViews.bind(this,(0,W.sourceChangeEvent)(e))),this._studySource.setInputs({}),this._processHibernate()))})),t.timeScale().onReset().subscribe(this,this._clearData),t.timeScale().logicalRangeChanged().subscribe(this,this.updateAllViews.bind(this,(0,W.viewportChangeEvent)())),t.mainSeries().sessionIdProxyProperty().subscribe(this,this._updateVisibleOfPreAndPostMarketBackground),t.mainSeries().properties().childs().interval.subscribe(this,this._processHibernate),this._updateVisibleOfPreAndPostMarketBackground(t.mainSeries().properties().childs().sessionId)}applyOverrides(e){(0,V.applyPropertiesOverrides)(this._properties.childs().graphics,void 0,!1,e,H),this._model.updateSource(this)}start(){this._isStarted=!0,this._processHibernate()}restart(){this._clearData(),N.enabled("stop_study_on_restart")&&this.stop(),this.start()}isStarted(){return this._isStarted}stop(){this._isStarted=!1,null!==this._studySource&&this._studySource.stop()}isHoveredEnabled(){return!1}paneViews(e){return this._paneViews}updateAllViews(e){this._paneViews.forEach((t=>t.update(e)))}updateViewsForPane(e,t){this.updateAllViews(t)}destroy(){this._destroyed=!0,null!==this._studySource&&(this._studySource.dataCleared().unsubscribeAll(this),this._studySource.dataUpdated().unsubscribeAll(this),this._studySource.destroy(),this._studySource=null),this._model.timeScale().logicalRangeChanged().unsubscribeAll(this),this._model.timeScale().onReset().unsubscribeAll(this),this._model.mainSeries().sessionIdProxyProperty().unsubscribeAll(this),this._model.mainSeries().properties().childs().interval.unsubscribeAll(this),this._properties.unsubscribeAll(this)}series(){return this._model.mainSeries()}priceScale(){return this.series().priceScale()}graphics(){return this._loadedGraphics||(0,n.ensureNotNull)(this._studySource).graphics()}properties(){return this._properties}graphicsInfo(){return(0,n.ensureNotNull)(this._metaInfo).graphics}firstValue(e){return this._model.mainSeries().firstValue()}formatter(){return z}state(e){const t={properties:this._properties.state()};return e&&null!==this._metaInfo&&(t.data={graphics:(0,D.saveStudyGraphics)(this.graphics(),this._model.timeScale().visibleBarsStrictRange()),metaInfo:this._metaInfo}),t}restoreState(e,t){const i=e.properties
;this._migrateOutOfSessionProperty(i),this._properties.mergeAndFire(i),this._removeDuplicateProperties(),this._updateVisibleOfPreAndPostMarketBackground(this._model.mainSeries().properties().childs().sessionId),void 0!==e.data&&t&&(this._loadStudyGraphics(e.data.graphics),this._setMetaInfo(e.data.metaInfo),this._createPaneViews())}restoreOldState(e,t){const i={properties:{graphics:e.state.graphics}};void 0!==e.data&&void 0!==e.metaInfo&&t&&(i.data={metaInfo:e.metaInfo,graphics:e.data.graphics}),this.restoreState(i,t)}applyPreferences(e){this._properties.mergePreferences(e)}metaInfo(){return(0,n.ensureNotNull)(this._metaInfo)}_loadStudyGraphics(e){const t=e.backgrounds;if(void 0!==t){const e=t.findIndex((e=>"inSession"===e.styleId));-1!==e&&t.splice(e,1)}this._loadedGraphics=(0,D.loadStudyGraphics)(e)}_setMetaInfo(e){const t=e.graphics.backgrounds;void 0!==t&&void 0!==t.inSession&&delete t.inSession,this._metaInfo=e}_updateVisibleOfPreAndPostMarketBackground(e){const t=!(0,O.isRegularSessionId)(e.value());this._outOfSessionVisibilityProperty().setValue(t),this._preMarketVisibilityProperty().setValue(t),this._postMarketVisibilityProperty().setValue(t)}_clearData(){null!==this._studySource&&this._studySource.clearData()}_createPaneViews(){const e={doubleClickHandler:this._doubleClickHandler};(0,D.createGraphicsPaneViews)(this,this._model,e).then((e=>{this._paneViews=e,this._model.lightUpdate()}))}_onPropertiesChanged(){this._processHibernate(),this.updateAllViews((0,W.sourceChangeEvent)(this.id()))}_processHibernate(){if(null!==this._studySource){const e=this._canBeHibernated(),t=this._isHibernated(),i=this._studySource.isStarted();!t&&e&&i?this._studySource.stop():!t||e||i||this._studySource.start()}}_canBeHibernated(){const e=this._model.mainSeries(),t=this._preMarketVisibilityProperty().value()&&this._postMarketVisibilityProperty().value()&&this._outOfSessionVisibilityProperty().value();return e.isDWM()||!t&&!this._vertLinesVisibleProperty().value()}_isHibernated(){return this._isStarted&&(null===this._studySource||!this._studySource.isStarted())}_outOfSessionVisibilityProperty(){return this._properties.childs().graphics.childs().backgrounds.childs().outOfSession.childs().visible}_preMarketVisibilityProperty(){return this._properties.childs().graphics.childs().backgrounds.childs().preMarket.childs().visible}_postMarketVisibilityProperty(){return this._properties.childs().graphics.childs().backgrounds.childs().postMarket.childs().visible}_vertLinesVisibleProperty(){return this._properties.childs().graphics.childs().vertlines.childs().sessBreaks.childs().visible}_removeDuplicateProperties(){this._properties.hasChild("properties")&&(this._properties.removeProperty("properties"),(0,x.saveDefaultProperties)(!0),this._properties.childChanged(null),(0,x.saveDefaultProperties)(!1))}_migrateOutOfSessionProperty(e){const t=e.graphics.backgrounds;if(void 0!==t){const i=t.outOfSession;i.color===(0,n.ensureDefined)(F.sessionsPreferencesDefault.graphics.backgrounds).outOfSession.color||"postMarket"in t||(e.graphics.backgrounds={
...t,postMarket:{color:i.color,transparency:i.transparency,visible:i.visible},preMarket:{color:i.color,transparency:i.transparency,visible:i.visible}})}}}var j=i(663890),G=i(922157),q=i.n(G),$=i(210596),Y=i.n($),K=i(706486),Z=i(588535),X=i(817808),J=i(220863),Q=i(618851),ee=i(440097),te=i(898005),ie=i(486028),se=i(231593),re=i(539301),ne=i(792268);const oe=new Map([["price",e=>(0,re.isPriceDataSource)(e)],["trading",e=>(0,S.isTrading)(e)],["drawing",e=>(0,S.isLineTool)(e)&&!(0,S.isTrading)(e)&&!e.isPhantom()],["drawingsForAllSymbols",e=>(0,S.isLineTool)(e)&&!(0,S.isTrading)(e)&&!e.isPhantom()],["phantom",e=>(0,S.isLineTool)(e)&&e.isPhantom()],["restRowSources",e=>!(0,S.isLineTool)(e)&&!(0,S.isTrading)(e)],["legendViewSources",e=>(0,re.isPriceDataSource)(e)||(0,S.isStudyLineTool)(e)],["leftPriceScale",(e,t)=>"left"===le(e,t)],["rightPriceScale",(e,t)=>"right"===le(e,t)],["overlayPriceScale",(e,t)=>"overlay"===le(e,t)]]),ae=new Map([["price","visibleSorted"],["trading","visibleSorted"],["drawing","visibleSorted"],["drawingsForAllSymbols","allSorted"],["phantom","visibleSorted"],["restRowSources","visibleSorted"],["legendViewSources","visibleSorted"],["leftPriceScale","visibleSorted"],["rightPriceScale","visibleSorted"],["overlayPriceScale","visibleSorted"]]);function le(e,t){const i=e.priceScale();return null===i?"overlay":t.priceScalePosition(i)}class ce{constructor(e){this._groupedSources=new Map,this._sources=null,this._pane=e}clear(){this._groupedSources.clear(),this._sources=null}destroy(){this.clear()}all(){return this._groupedSources.has("visibleSorted")||this._sortSources(),(0,n.ensureDefined)(this._groupedSources.get("visibleSorted"))}allIncludingHidden(){return this._groupedSources.has("allSorted")||this._sortSources(),(0,n.ensureDefined)(this._groupedSources.get("allSorted"))}allExceptSpecialSources(){if(!this._groupedSources.has("exceptSpecial")){const e=this.allIncludingHidden().filter((e=>!e.isSpeciallyZOrderedSource()));this._groupedSources.set("exceptSpecial",e)}return(0,n.ensureDefined)(this._groupedSources.get("exceptSpecial"))}tradingSources(){return this._getSourcesByGroupType("trading")}priceSources(){return this._getSourcesByGroupType("price")}lineSources(){return this._getSourcesByGroupType("drawing")}lineSourcesForAllSymbols(){return this._getSourcesByGroupType("drawingsForAllSymbols")}phantomSources(){return this._getSourcesByGroupType("phantom")}allExceptLineAndTradingSources(){return this._getSourcesByGroupType("restRowSources")}hitTestSources(){if(!this._groupedSources.has("hitTest")){const e=this.allExceptLineAndTradingSources().concat(this.lineSources());this._groupedSources.set("hitTest",e)}return(0,n.ensureDefined)(this._groupedSources.get("hitTest"))}generalSources(){if(!this._groupedSources.has("general")){const e=this.allExceptLineAndTradingSources().concat(this.lineSources());this._groupedSources.set("general",(0,ne.sortSources)(e))}return(0,n.ensureDefined)(this._groupedSources.get("general"))}leftPriceScalesSources(){return this._getSourcesByGroupType("leftPriceScale")}
rightPriceScalesSources(){return this._getSourcesByGroupType("rightPriceScale")}overlayPriceScaleSources(){return this._getSourcesByGroupType("overlayPriceScale")}legendViewSources(){return this._getSourcesByGroupType("legendViewSources")}_getSourcesByGroupType(e){const t=(0,n.ensureDefined)(ae.get(e));return this._groupedSources.has(t)?this._groupedSources.has(e)||this._groupSources(e):(this._sortSources(),this._groupSources(e)),(0,n.ensureDefined)(this._groupedSources.get(e))}_sortSources(){null===this._sources&&(this._sources=this._pane.dataSources());const e=(0,ne.sortSources)(this._sources),t=e.filter((e=>!(0,S.isLineTool)(e)||e.isActualSymbol()&&e.isActualCurrency()&&e.isActualUnit()));this._groupedSources.set("allSorted",e),this._groupedSources.set("visibleSorted",t)}_groupSources(e){const t=(0,n.ensureDefined)(ae.get(e)),i=oe.get(e);if(void 0!==i){const s=(0,n.ensureDefined)(this._groupedSources.get(t)).filter((e=>i(e,this._pane)));this._groupedSources.set(e,s)}}}var he=i(455562),de=i(10145),ue=i(786432),pe=i(296055),_e=i(793698),me=i(879987),ge=i(667342),fe=i(981820);const ve=[],Se=[];class ye{constructor(e){this._studies={},this._deferreds={},this._container=e,ve.push(e),Se.push(this)}add(e,t){this._deferreds[e]&&(this._deferreds[e].resolve(t),delete this._deferreds[e]),this._studies[e]=t}get(e){return this._studies[e]?Promise.resolve(this._studies[e]):(this._deferreds[e]||(this._deferreds[e]=(0,p.createDeferredPromise)()),this._deferreds[e].promise)}reset(){const e=ve.indexOf(this._container);~e&&(ve.splice(e,1),Se.splice(e,1))}static instance(e){const t=ve.indexOf(e);return~t?Se[t]:new ye(e)}}var be=i(360246);var we=i(224778),Pe=i(120040),Ce=i(90783),Te=i(999570),xe=i(653436),Ie=i(82639);new ee.TranslatedString("update {title} script",c.t(null,void 0,i(450728)));const Me=(0,X.getLogger)("Chart.Pane");function Le(e,t,i){e.setMargins({top:t,bottom:i})}class Ae{constructor(e,t,i,s){this.m_dataSources=[],this._sourceWatchedValuesSubscriptions=new Map,this.m_mainDataSource=null,this._cachedOrderedSources=new ce(this),this._sourcesById=new Map,this._priceSourcesById=new Map,this._sourcePropertiesChanged=new(q()),this._sourcesZOrderChanged=new(q()),this._tagsChanged=new(q()),this._stretchFactor=1e3,this._isInInsertManyDataSourcesState=!1,this._lastLineDataSourceZOrder=null,this._rightPriceScales=[],this._leftPriceScales=[],this._lockedPriceScale=null,this._currentPriceScaleRatio=null,this._onPriceScalesChanged=new(q()),this._isRecalculatingScales=!1,this._priceDataSources=[],this._symbolSources=[],this._lollipopDataSources=[],this._symbolSourceResolved=new(q()),this._symbolSourceResolvingActive=new(Y())(!1),this._bulkActions={activeCounter:0},this._height=0,this._width=0,this._dataSourcesCollectionChanged=new(q()),this._symbolSourceCollectionChanged=new(q()),this._maximized=new(Y())(!1),this._collapsed=new(Y())(!1),this._destroyed=new(q()),this._executionsPositionController=null,this._recalcSymbolSourceResolvingActive=()=>{
for(const e of this._symbolSources)if(e.symbolResolvingActive().value())return void this._symbolSourceResolvingActive.setValue(!0);this._symbolSourceResolvingActive.setValue(!1)},this._onSymbolSourceCollectionChanged=()=>{0===this._bulkActions.activeCounter?this._symbolSourceCollectionChanged.fire():this._bulkActions.symbolSourceCollectionChanged=!0},this._priceScaleSelectionStrategy=(0,Q.createPriceScaleSelectionStrategy)(i.properties().childs().priceScaleSelectionStrategyName.value()),this._id=null!=s?s:(0,J.randomHashN)(6),this._timeScale=e,this.m_mainDataSource=null,this._properties=t,this._model=i,i.properties().childs().priceScaleSelectionStrategyName.subscribe(null,(e=>{this._priceScaleSelectionStrategy=(0,Q.createPriceScaleSelectionStrategy)(e.value()),this._priceScaleSelectionStrategy.apply(this)})),this._timeScale.barSpacingChanged().subscribe(this,(()=>{this.m_mainDataSource===this._model.mainSeries()&&this._recalculatePriceScaleByScaleRatio(this.m_mainDataSource.priceScale())})),t.childs().topMargin.subscribe(this,this._updateMargins),t.childs().bottomMargin.subscribe(this,this._updateMargins),this._updateMargins()}destroy(){this._properties.childs().topMargin.unsubscribeAll(this),this._properties.childs().bottomMargin.unsubscribeAll(this),this._model.properties().childs().priceScaleSelectionStrategyName.unsubscribeAll(this),this._timeScale.barSpacingChanged().unsubscribeAll(this),this._leftPriceScales.concat(this._rightPriceScales).forEach((e=>{e.modeChanged().unsubscribeAll(this),e.priceRangeChanged().unsubscribeAll(this),e.internalHeightChanged().unsubscribeAll(this)}));for(const e of this.m_dataSources)this.removeSourceFromPriceScale(e),e.destroy&&e.destroy();this._destroyed.fire()}id(){return this._id}bulkActionMacro(e){const t=this._bulkActions;t.activeCounter+=1,e(),t.activeCounter-=1,0===t.activeCounter&&(this._dataSourcesCollectionChanged.fire(),t.symbolSourceCollectionChanged&&this._symbolSourceCollectionChanged.fire(),t.symbolSourceCollectionChanged=!1)}defaultPriceScale(){var e,t;const i=null!==(t=null===(e=this.m_mainDataSource)||void 0===e?void 0:e.priceScale())&&void 0!==t?t:null;if(null!==i)return i;const s=this.properties().childs().axisProperties.state();return s.autoScale=!0,new he.PriceScale(this._model.properties().childs().scalesProperties,s)}leftPriceScales(){return this._leftPriceScales}rightPriceScales(){return this._rightPriceScales}visibleLeftPriceScales(){var e;const t=this._model.priceScaleSlotsCount();if(this._leftPriceScales.length>t.left){const i=(0,v.moveToHead)(this._leftPriceScales,null===(e=this.mainDataSource())||void 0===e?void 0:e.priceScale());return i.splice(t.left),i}return this._leftPriceScales}visibleRightPriceScales(){var e;const t=this._model.priceScaleSlotsCount();if(this._rightPriceScales.length>t.right){const i=(0,v.moveToHead)(this._rightPriceScales,null===(e=this.mainDataSource())||void 0===e?void 0:e.priceScale());return i.splice(t.right),i}return this._rightPriceScales}clearSeries(e){const t=this._model.mainSeries()
;for(let i=this.m_dataSources.length-1;i>=0;i--)this.m_dataSources[i]===t&&this._removeSourceFromCollections(i,e)}sourcesByGroup(){return this._cachedOrderedSources}dataSourceForId(e){return this._sourcesById.get(e)||null}changeSourceId(e,t){(0,n.assert)(this.hasDataSource(e));const i=e.id();e.setId(t),this._sourcesById.delete(i),this._sourcesById.set(t,e),(0,re.isPriceDataSource)(e)&&(this._priceSourcesById.delete(i),this._priceSourcesById.set(t,e))}movePriceScale(e,t,i){const s=this.priceScalePosition(e);if(s!==t)this.removePriceScale(e),this._placePriceScale(e,t,i),e.invalidateMargins(),this._invalidateSourcesCache();else if(void 0!==i&&"overlay"!==s){const t="left"===s?this._leftPriceScales:this._rightPriceScales,r=t.indexOf(e);t.splice(r,1),t.splice(i,0,e)}}mainDataSource(){return this.m_mainDataSource}isEmpty(){return null===this.m_mainDataSource}recalculatePriceScale(e,t){if(!e)return;const i=e.sourcesForAutoscale();if((e.isAutoScale()||e.priceRangeShouldBeRecalculatedOnce())&&i&&i.length>0&&!this.timeScale().isEmpty()){const t=this.timeScale().visibleBarsStrictRange();e.recalculatePriceRange(t)}e.updateAllViews(t)}onSourceTagsChanged(){this._tagsChanged.fire()}insertDataSource(e,t,i){e.setZorder(i),t||(t=this.findSuitableScale(e)),this._addSourceToCollections(e);let s=!1;e===this.model().mainSeries()?(this.m_mainDataSource=this.model().mainSeries(),s=!0):null===this.m_mainDataSource&&(0,re.isPriceDataSource)(e)&&(this.m_mainDataSource=e,s=!0),t.addDataSource(e,this._isInInsertManyDataSourcesState),e.setPriceScale(t),t.invalidateMargins(),e.onTagsChanged&&e.onTagsChanged().subscribe(this,this.onSourceTagsChanged),s&&this._processMainSourceChange(),this._tagsChanged.fire(),(0,re.isPriceDataSource)(e)&&this.recalculatePriceScale(t,(0,W.sourceChangeEvent)(e.id())),this._invalidateSourcesCache()}addDataSource(e,t,i){let s=e.zorder();i||((0,S.isLineTool)(e)&&!e.isSpeciallyZOrderedSource()?(s=null!==this._lastLineDataSourceZOrder?this._lastLineDataSourceZOrder+1:this.newLineToolZOrder(),this._isInInsertManyDataSourcesState&&(this._lastLineDataSourceZOrder=s)):(0,j.isStudy)(e)&&!e.isSpeciallyZOrderedSource()&&(s=this.newStudyZOrder())),this.insertDataSource(e,t,s)}removeDataSource(e,t,i){const s=this.m_dataSources.indexOf(e);if(-1===s)return void Me.logDebug("removeDataSource: invalid data source");this._removeSourceFromCollections(s,!!i),e!==this.m_mainDataSource||t||(this.m_mainDataSource=null);const r=e.priceScale();this.removeSourceFromPriceScale(e),e.onTagsChanged&&e.onTagsChanged().unsubscribe(this,this.onSourceTagsChanged),(0,re.isPriceDataSource)(e)&&!t&&this._processMainSourceChange(),this._tagsChanged.fire(),r&&(0,re.isPriceDataSource)(e)&&this.recalculatePriceScale(r,(0,W.sourceChangeEvent)(e.id())),this._invalidateSourcesCache()}hasDataSource(e){return this._sourcesById.has(e.id())}hasPriceDataSource(e){return this._priceSourcesById.has(e.id())}dataSources(){return this.m_dataSources}priceDataSources(){return this._priceDataSources}lollipopDataSources(){return this._lollipopDataSources}symbolSources(){
return this._symbolSources}replaceSource(e,t,i){const s=this.m_mainDataSource===e,r=e.zorder();this.insertDataSource(t,i,r),this.removeDataSource(e,s),this._sourcesById.set(t.id(),t),(0,re.isPriceDataSource)(t)&&this._priceSourcesById.set(t.id(),t),s&&(this.m_mainDataSource=t,this._processMainSourceChange())}findSuitableScale(e,t,i){return this._priceScaleSelectionStrategy.findSuitableScale(this,e,t,i)}createNewPriceScaleIfPossible(){return this._priceScaleSelectionStrategy.createNewPriceScaleIfPossible(this)}canCreateNewPriceScale(){return this._priceScaleSelectionStrategy.canCreateNewPriceScale(this)}isOverlay(e){const t=e.priceScale();return null===t||"overlay"===this.priceScalePosition(t)}recalculate(e){this._leftPriceScales.forEach((t=>this.recalculatePriceScale(t,e))),this._rightPriceScales.forEach((t=>this.recalculatePriceScale(t,e)));for(const t of this.m_dataSources)this.isOverlay(t)&&!(0,S.isLineTool)(t)&&this.recalculatePriceScale(t.priceScale(),e);this.updateAllViews(e),this._model.updatePane(this)}updateAllViews(e){for(const t of this.m_dataSources)t.updateAllViews(e);for(const t of this.model().customSources())t.updateViewsForPane(this,e)}updateLollipopViews(e){}priceScalePosition(e){return this._leftPriceScales.includes(e)?"left":this._rightPriceScales.includes(e)?"right":"overlay"}createPriceScaleAtPosition(e,t){const i=this.properties().childs().axisProperties.state();i.autoScale=!0;const s=new he.PriceScale(this.model().properties().childs().scalesProperties,i);return s.setHeight(this.height()),Le(s,this._defaultTopMargin(),this._defaultBottomMargin()),this._placePriceScale(s,e,t),s}removePriceScale(e){e.modeChanged().unsubscribeAll(this),e.priceRangeChanged().unsubscribeAll(this),e.internalHeightChanged().unsubscribeAll(this),e===this._lockedPriceScale&&(this._lockedPriceScale=null,this._currentPriceScaleRatio=null);const t=this._leftPriceScales.indexOf(e);-1!==t&&(this._leftPriceScales[t].invalidateMargins(),this._leftPriceScales.splice(t,1));const i=this._rightPriceScales.indexOf(e);if(-1!==i&&(this._rightPriceScales[i].invalidateMargins(),this._rightPriceScales.splice(i,1)),null===e.mainSource()){const t=e.dataSources().length;0!==t&&Me.logError("Invalid priceScale state: empty mainSource but non-empty data sources="+t)}this._onPriceScalesChanged.fire()}priceScaleIndex(e,t){switch(t){case"left":return this.leftPriceScales().indexOf(e);case"right":return this.rightPriceScales().indexOf(e)}}move(e,t,i){const s=e.priceScale();this.removeSourceFromPriceScale(e),t.addDataSource(e),e.setPriceScale(t),t.invalidateMargins(),this._processMainSourceChange(),this._invalidateSourcesCache(),e.isIncludedInAutoScale()&&(null!==s&&this.recalculatePriceScale(s,(0,W.sourceChangeEvent)(e.id())),this.recalculatePriceScale(t,(0,W.sourceChangeEvent)(e.id()))),this._onPriceScalesChanged.fire()}setZOrders(e){e.forEach(((e,t)=>{t.setZorder(e)})),this._invalidateSourcesCache(),0===this._bulkActions.activeCounter&&this._dataSourcesCollectionChanged.fire(),this.model().lightUpdate()}isMainPane(){
return this.hasDataSource(this.model().mainSeries())}isLast(){const e=this.model().panes();return e[e.length-1]===this}newStudyZOrder(){return(0,_e.newStudyZOrder)(this._priceDataSources)}newLineToolZOrder(e){return(0,_e.newLineToolZOrder)(this.m_dataSources,e)}model(){return this._model}containsMainSeries(){return this._sourcesById.has(this.model().mainSeries().id())}applyPriceScaleRatio(e,t){var i;null!==this._lockedPriceScale&&this._lockedPriceScale!==e||this._currentPriceScaleRatio===t||!this.isMainPane()||null===this._lockedPriceScale&&e!==(null===(i=this.mainDataSource())||void 0===i?void 0:i.priceScale())||(this._setNewPriceRangeByScaleRatio(e,t,this._mainSourceVisiblePriceRange(e),!0,!0),null!==this._lockedPriceScale?this._tryToApplyNewPriceScaleRatio():e.isLog()||this.model().mainSeriesScaleRatioPropertyOnChanged())}sendToBack(e){const t=this.sourcesByGroup().allExceptSpecialSources();this._batchReorder(e,t[0],_e.moveBeforeSource)}bringToFront(e){const t=this.sourcesByGroup().allExceptSpecialSources();this._batchReorder(e,t[t.length-1],_e.moveAfterSource)}sendBackward(e){const t=this.sourcesByGroup().allIncludingHidden(),i=t.indexOf(e[0]);if(0===i)this.bringToFront(e);else{const s=t[i-1];this.insertBefore(e,s)}}bringForward(e){const t=this.sourcesByGroup().allExceptSpecialSources(),i=t.indexOf(e[e.length-1]);if(i===t.length-1)this.sendToBack(e);else{const s=t[i+1];this.insertAfter(e,s)}}insertAfter(e,t){this._batchReorder(e,t,_e.moveAfterSource)}insertBefore(e,t){this._batchReorder(e,t,_e.moveBeforeSource)}maximized(){return this._maximized}collapsed(){return this._collapsed}getPriceScaleById(e){const t=this.m_dataSources.find((t=>{var i;return(null===(i=t.priceScale())||void 0===i?void 0:i.id())===e}));return void 0===t?null:t.priceScale()}priceScaleSelectionStrategy(){return this._priceScaleSelectionStrategy}setPriceScaleSelectionStrategy(e){this._priceScaleSelectionStrategy=e,e.apply(this)}findTargetPriceAxisViews(e,t,i,s){if((0,f.isDataSource)(e)&&this.model().paneForSource(e)!==this)return[];const r=e.priceScale();if(t===r)return i;if(null===r)return[];if("overlay"===this.priceScalePosition(r))return t===this.defaultPriceScale()?i:[];const n=this.priceScalePosition(t);if(n!==this.priceScalePosition(r))return[];const o="left"===n?this.leftPriceScales():this.rightPriceScales();return o.indexOf(t)<o.indexOf(r)?s:[]}actionNoScaleIsEnabled(e){return!(!this.isOverlay(e)&&(0,re.isPriceDataSource)(e))||this._nonOverlayPricesSourcesCount()>1}properties(){return this._properties}setPriceAutoScale(e,t){e.setMode({autoScale:t}),this.timeScale().isEmpty()||this.recalculatePriceScale(e,(0,W.viewportChangeEvent)())}state(e,t,i,s,r,n){var o,a;const l={sources:[],mainSourceId:null===(o=this.m_mainDataSource)||void 0===o?void 0:o.id(),stretchFactor:this._stretchFactor,leftAxisesState:[],rightAxisesState:[],overlayPriceScales:{},priceScaleRatio:this._currentPriceScaleRatio},c=new Map,h=e=>{if(c.has(e))return c.get(e);let o=null;const a=i&&!e.isSavedInStudyTemplates()||!e.state||(0,
S.isLineTool)(e)&&n||!e.isSavedInChart(Boolean(t))||!(o=e.state(t,r))||s&&(0,S.isLineTool)(e)&&e.isActualSymbol&&!e.isActualSymbol()||e.isPhantom()?null:o;return c.set(e,a),a};if(e){l.sources=[];for(let e=0;e<this.m_dataSources.length;e++){const t=h(this.m_dataSources[e]);null!==t&&l.sources.push(t)}}const d=e=>null!==c.get(e),u=e=>!n||!(0,S.isLineTool)(e);l.leftAxisesState=this._leftPriceScales.map((e=>({state:e.state(),sources:e.dataSources().filter(d).filter(u).map((e=>e.id()))}))),l.rightAxisesState=this._rightPriceScales.map((e=>({state:e.state(),sources:e.dataSources().filter(d).filter(u).map((e=>e.id()))}))),l.overlayPriceScales={};for(const e of this.m_dataSources)if(this.isOverlay(e)&&e.isSavedInChart(Boolean(t))){const t=e.priceScale();l.overlayPriceScales[e.id()]=null!==(a=null==t?void 0:t.state())&&void 0!==a?a:null}return l}restoreState(e,t,i,s,r,o,a){r=r||{},e.stretchFactor&&(this._stretchFactor=e.stretchFactor),s=null!=s?s:this._model.mainSeries().id();const l={};if(e.sources){const n=e.sources.filter((e=>{var t;return!!e&&("MainSeries"===e.type||(!(null===(t=e.points)||void 0===t?void 0:t.some((e=>null===e.time_t||!isFinite(e.time_t))))||(Me.logNormal("Dropped invalid "+e.type+". Reason: non-numeric point time"),!1)))})),c=n.findIndex(me.isMainSeriesState);-1!==c&&this.model().mainSeries().setObsoleteZOrder(n[c].zorder),i<3&&(0,_e.reorderDataSourcesStateZOrder)(n);const h=-1!==this.m_dataSources.indexOf(this._model.mainSeries());this.clearSeries(Boolean(a)),this.m_mainDataSource=null,h&&this._addSourceToCollections(this._model.mainSeries(),a),(()=>{const t=n.find((t=>t.id===e.mainSourceId));if(void 0===t)return void Me.logWarn("There is no main source with id "+e.mainSourceId+", total sources="+n.length);if(!window.TradingView[t.type]||!(0,S.isLineToolName)(t.type))return void Me.logNormal("The type of main source is not line tool - fix is unnecessary");let i=null;for(const e of n)if(!window.TradingView[t.type]||!(0,S.isLineToolName)(e.type)){if(null!==i)return void Me.logWarn("Pane contains more than 1 possibly main sources - auto fix cannot be applied");i=e}if(null===i)return void Me.logWarn("Pane contains only line tools - possible we need to remove this pane?");const s=e.mainSourceId;let r=0;e.mainSourceId=i.id,n.forEach((e=>{e.ownerSource===s&&(e.ownerSource=null==i?void 0:i.id,r+=1)})),Me.logNormal("Auto fix broken pane is applied, changed line tools="+r+", changed from="+s+" to="+i.id)})();for(const e of n)if("study_Sessions"===e.type){this.model().sessions().restoreOldState(e,t);break}for(const e of n)"study_Sessions"!==e.type&&(null===this._model.dataSourceForId(e.id)||"MainSeries"===e.type?(l[e.id]=e.ownerSource,(0,me.isMainSeriesState)(e)?this._restoreMainSeries(e,t,h,r,o,a):(0,me.isStudyState)(e)?this.restoreStudy(e,t,s,r,a,!0):(0,me.isLineToolState)(e)?(e.state&&(e.state.zOrderVersion=2),this.restoreLineTool(e,t,void 0,a)):"ChartEventsSource"===e.type&&this._restoreSpecialSource(e,t,a)):Me.logError("Duplicate id while restoring pane: "+e.type+","+e.id))}const c=new Set,h=(e,t)=>{
e.priceScale()!==t&&(this.removeSourceFromPriceScale(e),e.setPriceScale(t),t.addDataSource(e))},d=(e,t,i)=>{if(c.has(e))return;c.add(e);const s=i.m_showSymbolLabels;void 0!==s&&e===this.model().mainSeries()&&this.model().properties().childs().scalesProperties.childs().showSymbolLabels.setValue(s),this._model.children(e,!0).forEach((e=>d(e,t,i))),h(e,t)},u=e=>{const t=(0,V.defaults)("chartproperties").paneProperties.axisProperties,i=new he.PriceScale(this.model().properties().childs().scalesProperties,t);return i.restoreState(e.state),e.sources.forEach((e=>{const s=this.dataSourceForId(e);s&&d(s,i,t)})),0===i.dataSources().length?null:i},p=e=>e.map(u).filter((e=>null!==e));let _;if(e.leftAxisesState)_=p(e.leftAxisesState);else{const t=u({state:e.leftAxisState,sources:e.leftAxisSources});_=null!==t?[t]:[]}let m;if(this._leftPriceScales.slice().forEach((e=>this.removePriceScale(e))),this._leftPriceScales=[],_.forEach((e=>this._placePriceScale(e,"left"))),e.rightAxisesState)m=p(e.rightAxisesState);else{const t=u({state:e.rightAxisState,sources:e.rightAxisSources});m=null!==t?[t]:[]}this._rightPriceScales.slice().forEach((e=>this.removePriceScale(e))),this._rightPriceScales=[],m.forEach((e=>this._placePriceScale(e,"right"))),this._currentPriceScaleRatio=e.priceScaleRatio||e.leftPriceScaleRatio||e.rightPriceScaleRatio||null;const g=new Map;for(const t of this.m_dataSources){if(c.has(t))continue;let i;if(e.overlayPriceScales&&e.overlayPriceScales[t.id()]){let s=e.overlayPriceScales[t.id()];g.has(null==s?void 0:s.id)?i=g.get(null==s?void 0:s.id):(s=(0,n.ensure)(s),i=new he.PriceScale(this._model.properties().childs().scalesProperties),i.setHeight(this._height),s.m_isAutoScale=!0,s.m_isLog=!1,s.m_isPercentage=!1,s.m_isLockScale=!1,i.restoreState(s),g.set(s.id,i))}else i=new he.PriceScale(this._model.properties().childs().scalesProperties),i.setHeight(this._height);h(t,i)}for(const e of Object.keys(l)){const t=l[e],i=this.dataSourceForId(e);t&&i&&null===i.ownerSource()&&i.setOwnerSource(this.dataSourceForId(t))}if(e.mainSourceId&&!this.containsMainSeries()&&(this.m_mainDataSource=this.dataSourceForId(e.mainSourceId)),!this.m_mainDataSource)for(const e of this.m_dataSources)if((0,re.isPriceDataSource)(e)){this.m_mainDataSource=e;break}for(const e of this.m_dataSources)if((0,S.isLineTool)(e))e.ownerSource()||e.setOwnerSource(this.mainDataSource()),e.isFixed()&&e.restoreFixedPoint();else if((0,j.isStudy)(e)){const t=e.properties().childs();!e.ownerSource()&&t.linkedToSeries&&t.linkedToSeries.value()&&e.setOwnerSource(this.model().mainSeries())}this._updateMargins(),this._cachedOrderedSources.clear()}onPriceScalesChanged(){return this._onPriceScalesChanged}setPaneSize(e){let t;switch(e){case"large":t=1;break;case"medium":t=.6;break;case"small":t=.3;break;case"tiny":t=.15;break;default:throw new Error("Unknown size enum value: "+e)}this._stretchFactor=1e3*t}stretchFactor(){return this._stretchFactor}setStretchFactor(e){this._stretchFactor=e}customSources(e){return this.model().customSources(e)}createDrawingsCaches(){
se.ExecutionsPositionController.recreateOrderedByBarsSourcesCache(this)}clearDrawingCaches(){se.ExecutionsPositionController.clearOrderedByBarsSourcesCache()}executionsPositionController(){return this._executionsPositionController||(this._executionsPositionController=new se.ExecutionsPositionController(this)),this._executionsPositionController}width(){return this._width}height(){return this._height}setHeight(e){this._height=e,this._leftPriceScales.forEach((t=>t.setHeight(e))),this._rightPriceScales.forEach((t=>t.setHeight(e)));for(let t=0;t<this.m_dataSources.length;t++){const i=this.m_dataSources[t];this.isOverlay(i)&&i.priceScale()&&(0,n.ensureNotNull)(i.priceScale()).setHeight(e)}this.updateAllViews((0,W.viewportChangeEvent)())}setWidth(e){this._width=e,this.updateAllViews((0,W.viewportChangeEvent)())}onTagsChanged(){return this._tagsChanged}onDestroyed(){return this._destroyed}dataSourcesCollectionChanged(){return this._dataSourcesCollectionChanged}symbolSourceCollectionChanged(){return this._symbolSourceCollectionChanged}symbolSourceResolved(){return this._symbolSourceResolved}symbolSourceResolvingActive(){return this._symbolSourceResolvingActive}sourcePropertiesChanged(){return this._sourcePropertiesChanged}sourceZOrderChanged(){return this._sourcesZOrderChanged}lineToolsForArea(e){const t=this.height(),i=this.width(),s=this.logicalRectToPixels(e);return[...this.m_dataSources,...this.model().multiPaneSources(this)].filter(S.isLineTool).filter((e=>(e.paneViews(this)||[]).some((e=>{const r=e.renderer(t,i);return r&&r.doesIntersectWithBox&&r.doesIntersectWithBox(s)}))))}logicalRectToPixels(e){const t=this.defaultPriceScale(),i=this.timeScale(),s=(0,n.ensureNotNull)((0,n.ensureNotNull)(t.mainSource()).firstValue()),r=t.priceToCoordinate(e.p1.price,s),a=i.indexToCoordinate(e.p1.index),l=t.priceToCoordinate(e.p2.price,s),c=i.indexToCoordinate(e.p2.index),h=new o.Point(Math.min(a,c),Math.min(r,l)),d=new o.Point(Math.max(a,c),Math.max(r,l));return(0,o.box)(h,d)}timeScale(){return this._timeScale}restoreLineTool(e,t,i,s,r){var o,a,l,c,h,d,u,p,_,m,g;delete e.state.lastUpdateTime,e.state.intervalsVisibilities=(0,we.mergeIntervalVisibilitiesDefaults)(e.state.intervalsVisibilities),i=void 0===i||i,be.LineToolElliott.migrateState(e),"LineToolGannComplex"!==(g=e).type||void 0!==g.version&&1!==g.version||(g.type="LineToolGannFixed"),Array.isArray(e.positionPercents)&&(e.positionPercents=e.positionPercents[0]);const f=e.type,v=e.id,y=e.state,b=i?e.zorder:this.newLineToolZOrder();(0,n.assert)((0,S.isLineToolName)(f),"invalid data source type:"+f+" (expected to be a Line Tool)");let w,P,C=null;if((0,me.isStudyLineToolState)(e)){C=this._model.studyVersioning();const t=C.patchPointsBasedStudyState(e);e=t;const i=t.metaInfo;Object.assign(i,te.StudyMetaInfo.parseIdString(null==i?void 0:i.fullId));const s=C.updateMetaInfo(i)||i;P=(0,S.createStudyLineToolProperties)(f,i,s,y,C),w=(0,S.createLineTool)(f,this._model,P,s,!0)}else P=(0,S.createLineToolProperties)(f,y,this._model),
t?null===(o=P.child("fixedSize"))||void 0===o||o.setValue(!1):null===(a=P.child("fixedSize"))||void 0===a||a.setValue(!0),w=(0,S.createLineTool)(f,this._model,P,null,!0);w.setId(v),w.linkKey().setValue(e.linkKey||null);const T=e.alertId;T&&w.canHasAlert()&&N.enabled("alerts")&&!this._model.readOnly()&&!this._model.isJustClonedChart()&&w.setAlert(T);let x=null!==(l=e.indexes)&&void 0!==l?l:[];if(x=x.slice(0,null!==(h=null===(c=e.points)||void 0===c?void 0:c.length)&&void 0!==h?h:x.length),w.isFixed()?void 0!==e.positionPercents?w.restorePositionPercents(e.positionPercents):w.restorePositionPercents({x:.5,y:.5}):e.points&&w.restorePoints(e.points,x,t),w instanceof Pe.LineToolBarsPattern||w instanceof Ce.LineToolCallout||w instanceof Te.LineToolTrendAngle||w instanceof xe.LineToolGhostFeed||w instanceof Ie.LineToolParallelChannel)null===(u=(d=w).restoreData)||void 0===u||u.call(d,e);else if(t&&(0,me.isStudyLineToolState)(e)&&w.restoreData){const t=e;C&&(t.graphics=C.patchPointsBasedStudyData(t.metaInfo,t.graphics)),null===(p=w.restoreData)||void 0===p||p.call(w,t)}const I=null==e.version?1:e.version,M=null==w.version?1:w.version;if(I!==M&&(null===(m=(_=w).migrateVersion)||void 0===m||m.call(_,I,M,{pane:this,model:this._model,properties:P})),void 0!==b&&w.setZorder(b),r)(0,S.prepareLineToolPropertiesByOwnerSource)(w.properties(),r),w.setOwnerSource(r);else{const t=e.ownerSource?this.dataSourceForId(e.ownerSource):null;w.setOwnerSource(t)}return this._addSourceToCollections(w,s),this._cachedOrderedSources.clear(),w}restoreStudy(e,t,i,s,r,n){var o;if(t&&void 0===e.data&&void 0===e.nonSeriesData&&void 0===e.indexes)return Me.logError("Cannot restore (skipping) study without data "+e.id+", "+e.metaInfo.id),null;const a=e.id,l=e.state,c=e.zorder;i=null!=i?i:this._model.mainSeries().id();const h=(null!==(o=e.parentSources)&&void 0!==o?o:e.ownerSource?[e.ownerSource]:[]).filter((e=>e!==i));let d=(0,ie.clone)(e.metaInfo);if(Object.assign(d,te.StudyMetaInfo.parseIdString(d.id)),function(e){return"Script$TV_EARNINGS@tv-scripting"===e||"Script$TV_DIVIDENDS@tv-scripting"===e||"Script$TV_SPLITS@tv-scripting"===e||"ESD$TV_EARNINGS@tv-scripting"===e||"ESD$TV_DIVIDENDS@tv-scripting"===e||"ESD$TV_SPLITS@tv-scripting"===e||"Earnings@tv-basicstudies"===e||"Dividends@tv-basicstudies"===e||"Splits@tv-basicstudies"===e||"BarSetContinuousRollDates@tv-corestudies"===e}(d.id)&&!t)return Me.logNormal("Skipping study "+d.id),null;let u=l;const p=this._model.studyVersioning(),_=p.patchPropsStateAndMetaInfo(u,d,{oldShowStudyLastValueProperty:t&&!(null==s?void 0:s.showStudyLastValueProperty)});u=_.propsState,d=_.metaInfo;const m=new P.StudyStub(this._model,e,d.shortDescription);let g;m.setId(a),m.setZorder(c);const f=i=>{m.setStatus({type:fe.StudyStatusType.Undefined});const s=i||new te.StudyMetaInfo(d),r=ye.instance(this._model),n=n=>{var o;const l=(0,C.prepareStudyPropertiesForLoadChart)(d,i,u,p),c=(0,j.createStudy)(this._model,l,n,s);if(c.setId(a),c.setOwnFirstValue(null!==(o=e.ownFirstValue)&&void 0!==o?o:null),t){
const t=e,{data:i,nsData:s,indexes:r}=p.patchStudyData(d,t.data,t.nonSeriesData,t.indexes);c.restoreData(i,s,r)}this._model.replaceStudyStub(m,c)||(g=c),r.add(a,c)};if(h.length>0){const e=h.map((e=>r.get(e)));Promise.all(e).then(n)}else n([])};if(t)f(null);else{const e=p.updateMetaInfoAsync(d);e.sync?f(e.result):e.result.then(f).catch((e=>m.setFailed("error: "+e)))}const v=null!=g?g:m;if(v){v.setZorder(c);const t=e.metaInfo.linkedToSeries?this._model.mainSeries():h.length?this.dataSourceForId(h[0]):null;v.setOwnerSource(t),this._addSourceToCollections(v,r),this._processMainSourceChange()}return this._cachedOrderedSources.clear(),v}clipboardLineToolOwnerSource(e){const t=this.dataSourceForId(e);if(null!==t){const e=t.ownerSource();if(null!==e&&null!==e.firstValue())return e}const i=this.mainDataSource();if(null!==i&&null!==i.firstValue())return i;for(const e of this.dataSources())if((0,re.isPriceDataSource)(e)&&null!==e.firstValue())return e;return null}realignLineTools(e){var t;let i=!1;for(const s of this.m_dataSources)!(0,S.isLineTool)(s)||void 0!==e&&(null===(t=null==s?void 0:s.ownerSource())||void 0===t?void 0:t.symbolSource())!==e&&(0,pe.isActingAsSymbolSource)(e)||(s.realign(),s.updateAllViews((0,W.sourceChangeEvent)(s.id())),i=!0);return i&&this._invalidateSourcesCache(),i}startScalePrice(e,t){e.startScale(t)}scalePriceTo(e,t){e.scaleTo(t),this.updateAllViews((0,W.viewportChangeEvent)())}endScalePrice(e){e.endScale()}startScrollPrice(e,t){e.startScroll(t)}scrollPriceTo(e,t){e.scrollTo(t),this.updateAllViews((0,W.viewportChangeEvent)())}endScrollPrice(e){e.endScroll()}resetPriceScale(e){const t=this.timeScale().visibleBarsStrictRange();e.isLockScale()||e.setMode({autoScale:!0}),e.recalculatePriceRange(t),this.updateAllViews((0,W.viewportChangeEvent)())}restorePriceScaleState(e,t){e.restoreState(t),this.updateAllViews((0,W.viewportChangeEvent)())}beginInsertManyLineDataSources(){this._isInInsertManyDataSourcesState=!0,this._lastLineDataSourceZOrder=null}endInsertManyLineDataSources(){this._isInInsertManyDataSourcesState=!1,this._lastLineDataSourceZOrder=null}removeSourceFromPriceScale(e){const t=e.priceScale();if(null!==t){const i=t.dataSources();i.indexOf(e)>=0&&t.removeDataSource(e),0===i.length&&this.removePriceScale(t)}}_invalidateSourcesCache(){this._cachedOrderedSources.clear(),this._leftPriceScales.forEach((e=>e.invalidateSourcesCache())),this._rightPriceScales.forEach((e=>e.invalidateSourcesCache()))}_processMainSourceChange(){let e=!1;if(null===this.m_mainDataSource)for(const t of this.m_dataSources)if((0,re.isPriceDataSource)(t)&&!this.isOverlay(t)&&(!t.properties().linkedToSeries||!t.properties().linkedToSeries.value())){this.m_mainDataSource=t,e=!0;break}if(this.m_mainDataSource&&e){let e=this.m_dataSources.filter(S.isLineTool);e=(0,ne.sortSources)(e);for(const t of e)this.move(t,(0,n.ensureNotNull)(this.m_mainDataSource.priceScale()),!0)}else if(!this.m_mainDataSource||this.isOverlay(this.m_mainDataSource)&&0===this._nonOverlayPricesSourcesCount()){let e=null
;if(this.m_dataSources.includes(this._model.mainSeries()))e=this._model.mainSeries();else for(const t of this.m_dataSources)if((0,re.isPriceDataSource)(t)&&this.isOverlay(t)&&t.showInObjectTree()){e=t;break}if(null!==e){const t=this.m_mainDataSource===e;this.m_mainDataSource=e;const i=this.createNewPriceScaleIfPossible();if(t&&e===this._model.mainSeries()){const t=(0,n.ensureNotNull)(e.priceScale());this._model.children(e,!0).forEach((e=>{this.removeSourceFromPriceScale(e),i.addDataSource(e),e.setPriceScale(i)})),this.removePriceScale(t)}this.move(e,i,!0),this.recalculatePriceScale(e.priceScale(),(0,W.globalChangeEvent)())}}}_addSourceToCollections(e,t){this.m_dataSources.push(e),this._sourcesById.set(e.id(),e),this._invalidateSourcesCache();const i=()=>{this._sourcePropertiesChanged.fire(e)};e.properties().subscribe(this,i),e.zOrderChanged().subscribe(this,(t=>this._sourcesZOrderChanged.fire(e,t))),(0,S.isLineTool)(e)&&(e.normalizedPointsChanged().subscribe(this,i),e.fixedPointChanged().subscribe(this,i),e.hasAlert.subscribe(i),e.sharingMode().subscribe(i),e.linkKey().subscribe(i),this._sourceWatchedValuesSubscriptions.set(e.id(),i));const s=(0,pe.isSymbolSource)(e)?e:null;(0,re.isPriceDataSource)(e)&&(this._priceSourcesById.set(e.id(),e),e.currencyChanged().subscribe(this,(()=>this._invalidateSourcesCache())),e.unitChanged().subscribe(this,(()=>this._invalidateSourcesCache())),this._priceDataSources.push(e),null!==s&&(this._symbolSources.push(s),s.symbolResolved().subscribe(this,(()=>this._symbolSourceResolved.fire(e))),s.symbolResolvingActive().subscribe(this._recalcSymbolSourceResolvingActive),s.symbolHibernated().subscribe(this._onSymbolSourceCollectionChanged),this._recalcSymbolSourceResolvingActive(),this._onSymbolSourceCollectionChanged())),e.isMultiPaneAvailable()&&this.model().addMultiPaneSource(e),t||0!==this._bulkActions.activeCounter||this._dataSourcesCollectionChanged.fire()}_removeSourceFromCollections(e,t){const i=this.m_dataSources[e];i.properties().unsubscribeAll(this),i.zOrderChanged().unsubscribeAll(this),this.m_dataSources.splice(e,1),this._sourcesById.delete(i.id());const s=i.id();if((0,S.isLineTool)(i)&&(i.normalizedPointsChanged().unsubscribeAll(this),i.fixedPointChanged().unsubscribeAll(this),this._sourceWatchedValuesSubscriptions.has(s))){const e=this._sourceWatchedValuesSubscriptions.get(s);i.hasAlert.unsubscribe(e),i.linkKey().unsubscribe(e)}this._invalidateSourcesCache();const r=(0,pe.isSymbolSource)(i)?i:null;(0,re.isPriceDataSource)(i)&&(this._priceSourcesById.delete(i.id()),i.currencyChanged().unsubscribeAll(this),i.unitChanged().unsubscribeAll(this),(0,v.removeItemFromArray)(this._priceDataSources,i),null!==r&&((0,v.removeItemFromArray)(this._symbolSources,r),r.symbolResolved().unsubscribeAll(this),r.symbolResolvingActive().unsubscribe(this._recalcSymbolSourceResolvingActive),r.symbolHibernated().unsubscribe(this._onSymbolSourceCollectionChanged),this._recalcSymbolSourceResolvingActive(),this._onSymbolSourceCollectionChanged())),
i.isMultiPaneAvailable()&&this.model().removeMultiPaneSource(i),t||0!==this._bulkActions.activeCounter||this._dataSourcesCollectionChanged.fire()}_recalculatePriceScaleByScaleRatio(e){this.isMainPane()&&e===this._lockedPriceScale&&(null!==this._currentPriceScaleRatio?this._applyOldScaleRatioToPriceScale():this._tryToApplyNewPriceScaleRatio())}_defaultBottomMargin(){return.01*this.properties().childs().bottomMargin.value()}_defaultTopMargin(){return.01*this.properties().childs().topMargin.value()}_updateMargins(){const e=this._defaultTopMargin(),t=this._defaultBottomMargin();for(const i of this._leftPriceScales)Le(i,e,t);for(const i of this._rightPriceScales)Le(i,e,t);for(const i of this.m_dataSources)if(this.isOverlay(i)){const s=i.priceScale();null!==s&&(Le(s,e,t),this.recalculatePriceScale(s,(0,W.viewportChangeEvent)()))}for(const e of this._leftPriceScales)this.recalculatePriceScale(e,(0,W.viewportChangeEvent)());for(const e of this._rightPriceScales)this.recalculatePriceScale(e,(0,W.viewportChangeEvent)());this.updateAllViews((0,W.viewportChangeEvent)())}_batchReorder(e,t,i){i(this.sourcesByGroup().allExceptSpecialSources(),e,t),this._invalidateSourcesCache(),this._dataSourcesCollectionChanged.fire(),this.model().fullUpdate()}_placePriceScale(e,t,i){if("overlay"===t)return void e.invalidateMargins();const s="left"===t?this._leftPriceScales:this._rightPriceScales,r=void 0===i?s.length:i;s.splice(r,0,e),e.modeChanged().subscribe(this,this._onPriceScaleModeChanged.bind(this,e)),e.internalHeightChanged().subscribe(this,this._recalculatePriceScaleByScaleRatio.bind(this,e)),e.priceRangeChanged().subscribe(this,this._recalculateTimeScaleByScaleRatio.bind(this,e)),e.priceRangeChanged().subscribe(this,this._onPriceScaleSetMinMaxPriceRange.bind(this,e)),e.isLockScale()&&((0,n.assert)(null===this._lockedPriceScale),this._lockedPriceScale=e,this._currentPriceScaleRatio=null),e.invalidateMargins(),this._onPriceScalesChanged.fire()}_onPriceScaleModeChanged(e,t,i){if(i.lockScale&&(this._lockedPriceScale!==e&&null!==this._lockedPriceScale&&this._lockedPriceScale.setMode({lockScale:!1}),this._lockedPriceScale=e,this._currentPriceScaleRatio=(0,de.scaleRatio)(this.timeScale(),e)),t.lockScale&&!i.lockScale&&(this._lockedPriceScale=null,this._currentPriceScaleRatio=null),t.percentage===i.percentage&&t.indexedTo100===i.indexedTo100)return;const s=this.timeScale().visibleBarsStrictRange();null!==s&&(e.recalculatePriceRange(s),e.updateAllViews((0,W.viewportChangeEvent)()))}_applyOldScaleRatioToPriceScale(){this._isRecalculatingScales||null===this._currentPriceScaleRatio||null===this._lockedPriceScale||(this._isRecalculatingScales=!0,this._setNewPriceRangeByScaleRatio(this._lockedPriceScale,this._currentPriceScaleRatio,this._mainSourceVisiblePriceRange(this._lockedPriceScale)),this._isRecalculatingScales=!1)}_setNewPriceRangeByScaleRatio(e,t,i,s,r){const n=(0,de.priceRangeByScaleRatio)(e,this.timeScale().barSpacing(),t);e.setPriceRange(null!==n?n:i,s,r)}_applyOldScaleRatioToTimeScale(){
this._isRecalculatingScales||null===this._currentPriceScaleRatio||(this._isRecalculatingScales=!0,this._setNewBarSpacingByScaleRatio(),this._isRecalculatingScales=!1)}_tryToApplyNewPriceScaleRatio(){const e=(0,n.ensureNotNull)(this._lockedPriceScale),t=(0,de.scaleRatio)(this.timeScale(),e);this._currentPriceScaleRatio===t||e.isLog()||(this._currentPriceScaleRatio=t,this.model().mainSeriesScaleRatioPropertyOnChanged())}_recalculateTimeScaleByScaleRatio(e){e===this._lockedPriceScale&&(null!==this._currentPriceScaleRatio?this._applyOldScaleRatioToTimeScale():this._tryToApplyNewPriceScaleRatio())}_setNewBarSpacingByScaleRatio(){const e=this.timeScale().getValidBarSpacing((0,de.barSpacingByScaleRatio)((0,n.ensureNotNull)(this._lockedPriceScale),this._currentPriceScaleRatio));this.timeScale().isValidBarSpacing(e)&&this.timeScale().setBarSpacing(e)}_mainSourceVisiblePriceRange(e){const t=this.timeScale().visibleBarsStrictRange();return null!==t?(0,n.ensureNotNull)((0,n.ensureNotNull)(e.mainSource()).priceRange(t.firstBar(),t.lastBar())):new ue.PriceRange(-.5,.5)}_setMinMaxPriceRange(){const e=(0,n.ensureNotNull)(this._lockedPriceScale),t=(0,de.priceRangeByScaleRatio)(e,this.timeScale().maxBarSpacing(),this._currentPriceScaleRatio),i=(0,de.priceRangeByScaleRatio)(e,this.timeScale().minBarSpacing(),this._currentPriceScaleRatio);null!==t&&e.setMaxPriceRange(t),null!==i&&e.setMinPriceRange(i)}_onPriceScaleSetMinMaxPriceRange(e){e===this._lockedPriceScale&&this._setMinMaxPriceRange()}_nonOverlayPricesSourcesCount(){return this.m_dataSources.filter((e=>(!e.properties().linkedToSeries||!e.properties().linkedToSeries.value())&&((0,re.isPriceDataSource)(e)&&e.showInObjectTree()&&!this.isOverlay(e)))).length}_restoreMainSeries(e,t,i,s,r,n){const o=e.id,a=e.state;if(a&&r&&(a.style=r.style||a.style,a.interval=r.interval||a.interval,r.symbol&&r.symbol!==a.symbol&&(a.symbol=r.symbol,delete a.currencyId,delete a.unitId)),a&&["candleStyle","hollowCandleStyle","haStyle"].forEach((e=>{a[e]&&(a[e].wickUpColor=a[e].wickUpColor||a[e].wickColor,a[e].wickDownColor=a[e].wickDownColor||a[e].wickColor)})),a&&(a.statusViewStyle=a.statusViewStyle||{},!a.statusViewStyle.symbolTextSource)){const e=!!a.statusViewStyle.showSymbolAsDescription;a.statusViewStyle.symbolTextSource=e?"ticker":"description"}if(a&&(a.extendedHours?a.sessionId="extended":a.sessionId||(a.sessionId="regular"),delete a.extendedHours),!i){const e=this._model.mainSeries();this._model.mainPane().removeDataSource(e,!1,n),this._addSourceToCollections(e,n)}const l=this.model().mainSeries(),c=l.properties().childs();this.m_mainDataSource=l;const h=a&&a.style?a.style:void 0;if(6===h&&"ATR"===c.pnfStyle.childs().inputs.childs().style.value()?c.pnfStyle.childs().inputs.childs().style.setValueSilently("Traditional"):4===h&&"ATR"===c.renkoStyle.childs().inputs.childs().style.value()&&c.renkoStyle.childs().inputs.childs().style.setValueSilently("Traditional"),a&&!a.hasOwnProperty("showSessions")&&(a.showSessions=!1),a&&void 0===a.settlementAsClose&&(a.settlementAsClose=!1),
a&&t&&(a.showCountdown=!1),a&&(t&&!("showSeriesLastValueProperty"in s)&&"showLastValue"in a&&this._model.properties().childs().scalesProperties.childs().showSeriesLastValue.setValue(a.showLastValue),delete a.showLastValue),a){const t={haStyle:(0,O.chartStyleStudyId)(8,!0),renkoStyle:(0,O.chartStyleStudyId)(4,!0),pbStyle:(0,O.chartStyleStudyId)(7,!0),kagiStyle:(0,O.chartStyleStudyId)(5,!0),pnfStyle:(0,O.chartStyleStudyId)(6,!0),rangeStyle:(0,O.chartStyleStudyId)(11,!0)},i=this._model.studyVersioning(),s=l.styleStudyInfos(),r=Object.keys(ge.SYMBOL_STRING_DATA);for(let n=0;n<r.length;n++){const o=ge.STYLE_SHORT_NAMES[r[n]]+"Style",l=o in e?e[o].studyId:t[o],c=a[o];if(null==c)continue;const h=c.inputs,d=te.StudyMetaInfo.parseIdString(l),u=s[o].studyId,p=te.StudyMetaInfo.parseIdString(u),_=i.updateStudyInputs(d.id,d.version,p.version,h,null);c.inputs=_}}const d=l.sessionId();l.restoreState(e,t),this.changeSourceId(l,o),l.sessionId()!==d&&c.sessionId.listeners().fire(c.sessionId)}_restoreSpecialSource(e,t,i){}}var ke=i(635991),Ee=i(218954),De=i(606615),Be=i(621833);class Ve{constructor(e,t){(0,n.assert)(e<=t,"The left value should be greater than or equal to the right value"),this._left=e,this._right=t}left(){return this._left}right(){return this._right}length(){return this._right-this._left+1}contains(e,t){return e<this._left-.5?!0===t&&1:e>this._right+.5?!0===t&&2:!0!==t||0}before(e){return e<this._left-.5}after(e){return e>this._right+.5}equals(e){return this._left===e.left()&&this._right===e.right()}static compare(e,t){return null===e||null===t?e===t:e.equals(t)}}var Re=i(812813);const Ne=(0,X.getLogger)("Chart.TimePoints");function Oe(e,t){return null===e||null===t?e===t:e.firstIndex===t.firstIndex&&e.lastIndex===t.lastIndex}class Fe{constructor(){this._zoffset=0,this._items=[],this._range=new Re.WatchedObject(null,Oe)}clear(){this._zoffset=0,this._items=[],this._range.setValue(null)}size(){return this._items.length}range(){return this._range.readonly()}merge(e,t,i){const s=this._mergeImpl(e,t,i);return this._updateFirstAndLastIndex(),s}addTail(e,t){for(let i=t?1:0;i<e.length;i++)this._items.push(e[i]);this._updateFirstAndLastIndex()}remove(e){const t=this._indexToOffset(e);if(null===t)return[];const i=this._items.splice(t),s=[];for(let t=0;t<i.length;t++)s.push({change:"remove",index:e+t,value:i[t]});return this._updateFirstAndLastIndex(),s}valueAt(e){const t=this._indexToOffset(e);return null!==t?this._items[t]:null}indexOf(e,t){if(this._items.length<1)return null;if(e>this._items[this._items.length-1])return t?this._validOffsetToIndex(this._items.length-1):null;for(let i=0;i<this._items.length;++i){if(e===this._items[i])return this._validOffsetToIndex(i);if(e<this._items[i])return t?this._validOffsetToIndex(i):null}return null}state(e){var t,i;let s=0,r=this._items.length;return null!==e&&(s=null!==(t=this._indexToOffset(e.firstBar()))&&void 0!==t?t:0,r=(null!==(i=this._indexToOffset(e.lastBar()))&&void 0!==i?i:r-1)+1),{items:this._items.slice(s,r),zoffset:this._zoffset-s}}restoreState(e){
null!==e&&(this._items=e.items,this._zoffset=e.zoffset,this._updateFirstAndLastIndex())}roughTime(e,t=null){const i=this.valueAt(e);if(null!==i)return i;const s=this._items;if(!s.length||s.length<2)return null;const r=s.length-1,n=this._validOffsetToIndex(0),o=this._validOffsetToIndex(r),a=s[0],l=s[r],c=(l-a)/(o-n);if(e<n){return a-(n-e)*c}if(e>o){const i=e-o;if(i<500&&null!=t)return t(l,i);return l+i*c}return null}roughIndex(e,t=null){const i=this._items;if(!i.length||i.length<2)return null;const s=i.length-1,r=this._validOffsetToIndex(0),n=this._validOffsetToIndex(s),o=i[0],a=i[s];if(e>=o&&e<=a)return this.closestIndexLeft(e);const l=(a-o)/(n-r);if(e<o){const t=o-e;return r-Math.round(t/l)}if(e>a){const i=e-a;let s=Math.trunc(i/l);if(s<500&&null!==t){const i=t(a,e);i.success&&(s=i.result)}return n+s}return null}closestIndexLeft(e){const t=this._items;if(!t.length)return null;if(Number.isNaN(e))return null;let i=t.length-1;if(e>=t[i])return this._validOffsetToIndex(i);let s=0;const r=t[s];if(e<r)return null;if(e===r)return this._validOffsetToIndex(s);for(;i>s+1;){const r=s+i>>1,n=t[r];if(n>e)i=r;else{if(!(n<e))return n===e?this._validOffsetToIndex(r):null;s=r}}return this._validOffsetToIndex(s)}_mergeImpl(e,t,i){if(0===i.length)return Ne.logError("merge: 'values' does not contain any time points"),[];if(t>this._zoffset&&e+t>0)return Ne.logError("merge: when the first time point index is updated, we should fill the time points starting from the first one"),[];if(0===this._items.length)return this._items=i.slice(),this._zoffset=t,[{change:"rebuild",index:this._validOffsetToIndex(0)}];const s=e+this._zoffset;if(s<0){const r=Math.abs(s);if(i.length<r)return Ne.logError("merge: 'values' does not contain enough time points to fill in the new items. 'index': "+e.toString()+", previous 'zoffset': "+this._zoffset.toString()+", new 'zoffset': "+t.toString()+", 'values.length': "+i.length),[];this._items=new Array(r).concat(this._items),this._zoffset=t;for(let s=0;s<i.length;++s)this._items[e+s+t]=i[s];return[{change:"rebuild",index:this._validOffsetToIndex(0)}]}const r=[];let n=s;for(;n<this._items.length&&n-s<i.length;++n)this._items[n]=i[n-s],r.push({change:"update",index:this._validOffsetToIndex(n),value:i[n-s]});const o=s+i.length;if(o>this._items.length){const e=o-this._items.length;for(let t=n;t<n+e;++t){const e=this._items.length;this._items.push(i[t-s]),r.push({change:"append",index:this._validOffsetToIndex(e),value:i[t-s]})}}else{for(let e=o;e<this._items.length;++e)r.push({change:"remove",index:this._validOffsetToIndex(e),value:this._items[e]});this._items.length=o}return this._zoffset=t,r}_updateFirstAndLastIndex(){const e=this._offsetToIndex(0),t=this._offsetToIndex(this._items.length-1);this._range.setValue(null===e||null===t?null:{firstIndex:e,lastIndex:t})}_validOffsetToIndex(e){return e-this._zoffset}_offsetToIndex(e){return 0<=e&&e<this.size()?this._validOffsetToIndex(e):null}_indexToOffset(e){const t=e+this._zoffset;return 0<=t&&t<this.size()?t:null}}var We=i(724912)
;const ze=new Map([[0,.1],[11,.1],[1,.35],[9,.35],[12,.35],[8,.35]]);class He{constructor(e,t){this._styleSpecificRanges=new Map,this._logicalRange=e,this._defaultStyle=t}strictRange(e){if(null===this._logicalRange)return null;void 0===e&&(e=this._defaultStyle);let t=this._styleSpecificRanges.get(e);if(void 0===t){const i=(ze.get(e)||0)/2;t=new Be.BarsRange(Math.floor(this._logicalRange.left()+i),Math.ceil(this._logicalRange.right()-i)),this._styleSpecificRanges.set(e,t)}return t}logicalRange(){return this._logicalRange}isValid(){return null!==this._logicalRange}static invalid(){return new He(null,1)}}var Ue=i(576213),je=i(451144);class Ge{constructor(e,t=50){this._actualSize=0,this._usageTick=1,this._oldestTick=1,this._cache=new Map,this._tick2Labels=new Map,this._format=e,this._maxSize=t}format(e){const t=this._cache.get(e.valueOf());if(void 0!==t)return t.string;if(this._actualSize===this._maxSize){const e=this._tick2Labels.get(this._oldestTick);this._tick2Labels.delete(this._oldestTick),this._cache.delete((0,n.ensureDefined)(e)),this._oldestTick++,this._actualSize--}const i=this._format(e);return this._cache.set(e.valueOf(),{string:i,tick:this._usageTick}),this._tick2Labels.set(this._usageTick,e.valueOf()),this._actualSize++,this._usageTick++,i}}var qe=i(563068);let $e;var Ye=i(997753),Ke=i(951327),Ze=i(217203),Xe=i(131227),Je=i(153026);const Qe={preserveBarSpacing:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!0,minBarSpacing:.5},et=N.enabled("low_density_bars"),tt=et?1:2,it=(0,X.getLogger)("Chart.TimeScale");class st{constructor(e,t){this._width=0,this._widthChanged=new(q()),this._rightOffset=10,this._rightOffsetChanged=new(q()),this._maxRightOffsetChanged=new(q()),this._defaultRightOffset=new(Y())(10),this._defaultRightOffsetPercentage=new(Y())(5),this._usePercentageRightOffset=new(Y())(!1),this._baseIndex=null,this._leftEdgeIndex=null,this._barSpacingChanged=new(q()),this._barSpacing=6,this._visibleBars=He.invalid(),this._visibleBarsInvalidated=!0,this._visibleBarsChanged=new(q()),this._logicalRangeChanged=new(q()),this._points=new Fe,this._tickMarks=new Ue.Tickmarks,this._onScroll=new(q()),this._resetDelegate=new(q()),this._scrollStartPoint=null,this._scaleStartPoint=null,this._commonTransitionStartState=null,this._formattedBySpan=new Map,this._requestingMoreData=!1,this._requestedTickmarksCount=0,this._endOfData=!1,this._lockBarsAndLogicalRangeEvents=!1,this._options=(0,De.deepExtend)({},Qe,t),this._model=e,this._scalesProperties=e.properties().childs().scalesProperties,this._defaultRightOffset.subscribe((()=>{this._usePercentageRightOffset.setValue(!1),this._defaultRightOffsetOptionsUpdated()})),this._defaultRightOffsetPercentage.subscribe((e=>{if(e>=100||e<0){const t=Math.max(0,Math.min(e,99));this._defaultRightOffsetPercentage.setValue(t)}else this._usePercentageRightOffset.setValue(!0),this._defaultRightOffsetOptionsUpdated()})),this._usePercentageRightOffset.subscribe((()=>{this._defaultRightOffsetOptionsUpdated()})),
this._options.preserveBarSpacing&&(this._barSpacing=this._scalesProperties.childs().barSpacing.value()||6),this._barSpacingChanged.subscribe(this,this._maxRightOffsetOnChanged),this._widthChanged.subscribe(this,this._maxRightOffsetOnChanged)}destroy(){this._barSpacingChanged.unsubscribeAll(this),this._barSpacingChanged.destroy(),this._widthChanged.unsubscribeAll(this),this._widthChanged.destroy()}isEmpty(){return 0===this._width||!this.canNormalize()}canNormalize(){return this._points.size()>0}update(e,t,i,s){this._visibleBarsInvalidated=!0,i.length>0&&this._points.merge(e,t,i),this._tickMarks.merge(s),this.correctOffset()}addTail(e,t,i){this._tickMarks.removeTail(t);const s=e.params,r=(0,n.ensureDefined)(this._tickMarks.maxIndex)+(i?0:1);for(let e=0;e<s.marks.length;e++)s.marks[e].index=r+e;this._tickMarks.addTail(s.marks),this._points.addTail(s.changes,i);const o=this._rightOffset-s.changes.length;this._updateRightOffset(o)}state(e){const t={m_barSpacing:this.barSpacing(),m_rightOffset:this._defaultRightOffset.value(),rightOffsetPercentage:this._defaultRightOffsetPercentage.value(),usePercentageRightOffset:this._usePercentageRightOffset.value()};if(e){t.m_rightOffset=Math.max(0,this._rightOffset);const e=this.visibleExtendedDataRange(this._model.mainSeries().data(),0);t.points=this._points.state(e),t.tickmarks=this._tickMarks.state(e),t.width=this._width}return t}restoreState(e,t){if(void 0===e.m_barSpacing)return void it.logDebug("restoreState: invalid state");if(void 0===e.m_rightOffset)return void it.logDebug("restoreState: invalid state");let i=e.m_barSpacing;const s=e.m_rightOffset<0&&!t?this.rightOffsetDefaultValue():e.m_rightOffset,r=s<0?this.rightOffsetDefaultValue():Math.round(s);this._defaultRightOffset.setValue(r),void 0!==e.rightOffsetPercentage&&Number.isFinite(e.rightOffsetPercentage)&&this._defaultRightOffsetPercentage.setValue(e.rightOffsetPercentage),this._usePercentageRightOffset.setValue(Boolean(e.usePercentageRightOffset)),this._rightOffset=s,t&&(this._requestedTickmarksCount=1/0,this._endOfData=!0,this._points.restoreState(e.points||null),this._tickMarks.restoreState(e.tickmarks||null),e.width&&this._width>0&&(i*=this._width/e.width)),this._tryToUpdateBarSpacing(this._barSpacing,i),this.correctOffset(),this._usePercentageRightOffset.value()&&(this._rightOffset=this.percentsToBarIndexLength(this._defaultRightOffsetPercentage.value())),this._rightOffsetChanged.fire(this._rightOffset)}marks(){if(this.isEmpty())return null;const e=this._barSpacing,t=5*((this._scalesProperties.childs().fontSize.value()||0)+4),i=Math.round(t/e),s=(0,n.ensureNotNull)(this.visibleBarsStrictRange()),r=Math.max(s.firstBar(),s.firstBar()-i),o=Math.max(s.lastBar(),s.lastBar()-i),a=this._tickMarks.build(e,t),l=[];for(const e of a){if(!(r<=e.index&&e.index<=o))continue;const t=this._tickMarks.indexToTime(e.index);null!==t&&l.push({coord:this.indexToCoordinate(e.index),label:this.formatLabel(t,e.span),span:e.span,major:e.label>=je.DAY_SPAN})}return l}visibleBarsStrictRange(){
return this._visibleBarsInvalidated&&(this._visibleBarsInvalidated=!1,this._updateVisibleBars()),this._visibleBars.strictRange()}visibleBarsStrictRangeChanged(){return this._visibleBarsChanged}visibleStrictDataRange(e){const t=this.visibleBarsStrictRange();if(null===t)return null;const i=e.search(t.firstBar(),Je.PlotRowSearchMode.NearestRight),s=e.search(t.lastBar(),Je.PlotRowSearchMode.NearestLeft);return null===i||null===s?null:new Be.BarsRange(i.index,s.index)}visibleExtendedDataRange(e,t){const i=this.visibleBarsStrictRange();if(null===i)return null;let s=1===t?null:e.search(i.firstBar()-1,Je.PlotRowSearchMode.NearestLeft),r=0===t?null:e.search(i.lastBar()+1,Je.PlotRowSearchMode.NearestRight);return null===s&&(s=e.search(i.firstBar(),Je.PlotRowSearchMode.NearestRight)),null===r&&(r=e.search(i.lastBar(),Je.PlotRowSearchMode.NearestLeft)),null===s||null===r?null:new Be.BarsRange(s.index,r.index)}logicalRangeChanged(){return this._logicalRangeChanged}tickMarks(){return this._tickMarks}points(){return this._points}width(){return this._width}setWidth(e,t){if(!Number.isFinite(e)||e<=0)return void it.logWarn(`setWidth: invalid argument: ${e}`);if(this._width===e)return;if(this._visibleBarsInvalidated=!0,(t||this._options.lockVisibleTimeRangeOnResize)&&this._width){const t=this._barSpacing*e/this._width;this._tryToUpdateBarSpacing(this._barSpacing,t)}else this._width&&this.setBarSpacing(this._barSpacing);if(null!==this._leftEdgeIndex){if((0,n.ensureNotNull)(this.visibleBarsStrictRange()).firstBar()<=this._leftEdgeIndex){const t=this._width-e;this._rightOffset-=Math.round(t/this._barSpacing)+1}}const i=this._usePercentageRightOffset.value()&&this._rightOffset>0?this.barIndexLengthToPercents(this._rightOffset):-1;this._width=e,this._widthChanged.fire(e);const s=this._rightOffset;i>0?this._rightOffset=this.percentsToBarIndexLength(i):this.correctOffset(),this._rightOffset!==s&&this._rightOffsetChanged.fire(this._rightOffset),this._requestMoreData()}setLeftEdgeFix(e){this._leftEdgeIndex=e;const t=this.visibleBarsStrictRange();if(null===t)return;const i=t.firstBar()-e;if(i<0){const e=this._rightOffset-i-1;this.scrollToOffsetAnimated(e,500)}}indexToCoordinate(e){if(this.isEmpty())return 0;if(!(0,ie.isInteger)(e))return 0;const t=this.baseIndex()+this._rightOffset-e;return this._width-(t+.5)*this._barSpacing-1}indexToUserTime(e){return this._tickMarks.indexToTime(e)}timePointToIndex(e,t){switch(t){case 0:return this._points.indexOf(e,!1);case 1:return this._points.closestIndexLeft(e);default:return this._points.indexOf(e,!0)}}indexToTimePoint(e){return this._points.valueAt(e)}timeToCoordinate(e){const t=this._points.closestIndexLeft(e);if(null===t)return null;const i=(0,n.ensureNotNull)(this._points.valueAt(t)),s=this.indexToCoordinate(t);if(s<=0||s>=this._width)return null;const r=this.barSpacing(),o=this.baseIndex(),a=s+(e-i)/((0,n.ensureNotNull)(this._points.valueAt(o))-(0,n.ensureNotNull)(this._points.valueAt(o-1)))*r+1;return a<=0||a>=this._width?null:a}barIndexesToCoordinates(e){const t=this.baseIndex();for(const i of e){
const e=i.time,s=t+this._rightOffset-e,r=this._width-(s+.5)*this._barSpacing-1;i.time=r}}timedValuesToCoordinates(e,t,i){var s,r;const n=this.baseIndex()+this._rightOffset,o=this._width-n*this._barSpacing-.5*this._barSpacing-1,a=null!==(s=null==t?void 0:t.startItemIndex)&&void 0!==s?s:0;let l=a;const c=null!==(r=null==t?void 0:t.endItemIndex)&&void 0!==r?r:e.length;!0===i&&(l=(0,v.upperbound)(e,We.UNPLOTTABLE_TIME_POINT_INDEX,((e,t)=>e<t.x),a,c));for(let t=l;t<c;++t){const i=e[t];i.x=o+i.x*this._barSpacing}for(let t=a;t<l;++t)e[t].x=-500}indexesToCoordinates(e,t){if(this.isEmpty())return;void 0===t&&(t=e.length);const i=this.baseIndex()+this._rightOffset,s=this._width-i*this._barSpacing-.5*this._barSpacing-1,r=this._barSpacing,n=e;for(let i=0;i<t;++i)(0,ie.isInteger)(e[i])?n[i]=s+e[i]*r:n[i]=0}rightOffsetForTimePoint(e){const t=this.timeToCoordinate(e);return null===t?null:this._rightOffsetForCoordinate(t)}scrollToRealtime(e,t){let i=this.targetDefaultRightOffset();i<0&&(i=this.rightOffsetDefaultValue());const s=()=>{void 0!==t&&t(),this._requestMoreData()};if(e){const e=this._rightOffset,t=this.maxRightOffset();t>0&&i>t&&(i=t);const r=this._model;(0,Xe.doAnimate)({from:e,to:i,duration:1e3,easing:ke.easingFunc.easeInOutQuint,onComplete:s,onStep:(e,t)=>{this._visibleBarsInvalidated=!0,this._updateRightOffset(t),this._onScroll.fire(),r.recalculateAllPanes((0,W.viewportChangeEvent)()),r.lightUpdate(),r.recalcVisibleRangeStudies()}})}else this._visibleBarsInvalidated=!0,this._updateRightOffset(i),this._onScroll.fire(),s()}scrollToFirstBar(){this._model.gotoTime(new Date("1800-01-01").getTime()),this._onScroll.fire()}scrollToOffsetAnimated(e,t){if(!isFinite(e))throw new RangeError("offset is required and must be finite number");const i=void 0===t?400:t;if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this._rightOffset,r=Date.now(),n=()=>{this._visibleBarsInvalidated=!0;const t=(Date.now()-r)/i;if(t>=1)return this._updateRightOffset(e),this._visibleBarsInvalidated=!0,this._model.recalculateAllPanes((0,W.viewportChangeEvent)()),void this._model.lightUpdate();const o=s+(e-s)*t;this._updateRightOffset(o),this._model.recalculateAllPanes((0,W.viewportChangeEvent)()),setTimeout(n,20)};n()}defaultRightOffset(){return this._defaultRightOffset}rightOffsetDefaultValue(){return 10}defaultRightOffsetPercentage(){return this._defaultRightOffsetPercentage}usePercentageRightOffset(){return this._usePercentageRightOffset}barSpacing(){return this._barSpacing}setBarSpacing(e){Number.isFinite(e)?(e=this.getValidBarSpacing(e),this._tryToUpdateBarSpacing(this._barSpacing,e)&&(this.correctOffset(),this._options.preserveBarSpacing&&((0,x.saveDefaultProperties)(!0),this._scalesProperties.childs().barSpacing.setValue(this._barSpacing),(0,x.saveDefaultProperties)(!1)),this._model.recalculateAllPanes((0,W.viewportChangeEvent)()),this._model.lightUpdate())):it.logWarn(`setBarSpacing: invalid argument: ${e}`)}barSpacingChanged(){return this._barSpacingChanged}getValidBarSpacing(e){
return null==e&&(e=this.barSpacing()),e<this.minBarSpacing()?this.minBarSpacing():e>this.maxBarSpacing()?this.maxBarSpacing():e}isValidBarSpacing(e){return e>=this.minBarSpacing()&&e<=this.maxBarSpacing()}preserveBarSpacing(){return this._options.preserveBarSpacing}normalizeBarIndex(e){let t=0,i=0;const s=this.baseIndex(),r=(0,n.ensureNotNull)(this._points.range().value()).firstIndex;return e<r?(t=(0,n.ensureNotNull)(this._points.valueAt(r)),i=e-r):e>s?(t=(0,n.ensureNotNull)(this._points.valueAt(s)),i=e-s):(t=(0,n.ensureNotNull)(this._points.valueAt(e)),i=0),{time_t:t,offset:i}}denormalizeTimePoint(e){const t=this._points.indexOf(e.time_t,!1);if(null!==t)return t+e.offset}rightOffset(){return this._rightOffset}rightOffsetChanged(){return this._rightOffsetChanged}minRightOffset(){var e;const t=null===(e=this.points().range().value())||void 0===e?void 0:e.firstIndex,i=this._baseIndex;if(void 0===t||null===i)return null;if(null!==this._leftEdgeIndex){const e=this.width()/this._barSpacing;return this._leftEdgeIndex-i+e-1}return t-i-1+tt}maxRightOffset(){return this.width()/this._barSpacing-tt}maxRightOffsetChanged(){return this._maxRightOffsetChanged}onReset(){return this._resetDelegate}scrollStartPoint(){return this._scrollStartPoint}baseIndex(){return this._baseIndex||0}zoom(e,t,i){if(!Number.isFinite(e)||!Number.isFinite(t))return void it.logWarn(`zoom: invalid arguments: ${e}, ${t}, ${i}`);const s=this.rightOffset(),r=void 0!==i?!i:this._options.rightBarStaysOnScroll,n=r&&this.usePercentageRightOffset().value()&&s>=0,o=n?this.barIndexLengthToPercents(s):void 0,a=this.coordinateToIndex(e),l=this.barSpacing(),c=l+t*(l/10);this.setBarSpacing(c),r||this.setRightOffset(s-.5+(a-this._coordinateToFloatIndex(e))),n&&void 0!==o&&this.setRightOffset(this.percentsToBarIndexLength(o)),this._requestMoreData()}zoomToBarsRange(e,t){if(null!==this._leftEdgeIndex&&(e=Math.max(e,this._leftEdgeIndex)),t<=e)return;const i=this.baseIndex(),s=this._rightOffset;this._rightOffset=t-i;const r=Math.max(t-e+1,tt);this.setBarSpacing(this.width()/r),this._visibleBarsInvalidated=!0,this.correctOffset(),this._rightOffset!==s&&this._rightOffsetChanged.fire(this._rightOffset),this._requestMoreData()}coordinateToIndex(e){return Math.ceil(this._coordinateToFloatIndex(e))}coordinateToVisibleIndex(e){let t;if(0===e){const e=this._coordinateToFloatIndex(-1);t=Math.floor(e)+1}else t=this.coordinateToIndex(e);const i=this.visibleBarsStrictRange();return null===i||i.contains(t)||(t=Math.min(Math.max(i.firstBar(),t),i.lastBar())),t}canZoomIn(){return this.barSpacing()<this.maxBarSpacing()}canZoomOut(){return this.barSpacing()>this._options.minBarSpacing}minBarSpacing(){return this._options.minBarSpacing}maxBarSpacing(){const e=this.width();return et?e:e/tt}minVisibleBarCount(){return tt}resetRightOffset(){this.setRightOffset(this.targetDefaultRightOffset())}reset(){this._visibleBarsInvalidated=!0,this._points.clear(),this._scrollStartPoint=null,this._scaleStartPoint=null,this._clearCommonTransitionsStartState(),this._tickMarks.reset(),
this._leftEdgeIndex=null,this._resetDelegate.fire(),this.disconnect()}disconnect(){this._requestingMoreData=!1,this._requestedTickmarksCount=0,this._endOfData=!1}setBaseIndex(e){Number.isFinite(e)?(this._visibleBarsInvalidated=!0,this._baseIndex=e,this.correctOffset()):it.logDebug(`setBaseIndex: invalid argument: ${e}`)}resetBaseIndex(){this._visibleBarsInvalidated=!0,this._baseIndex=null}setRightOffset(e){Number.isFinite(e)?(this._visibleBarsInvalidated=!0,this._updateRightOffset(e)):it.logWarn(`setRightOffset: invalid argument: ${e}`)}correctBarSpacing(){this.isEmpty()||this.points().size()<this.width()/this.barSpacing()&&(this.setRightOffset(this.targetDefaultRightOffset()),this.setBarSpacing(this.width()/(this.points().size()+this.rightOffset())))}correctOffset(){const e=this.maxRightOffset();this._rightOffset>e&&(this._rightOffset=e,this._visibleBarsInvalidated=!0);const t=this.minRightOffset();null!==t&&this._rightOffset<t&&(this._rightOffset=t,this._visibleBarsInvalidated=!0)}logicalRange(){return this._visibleBarsInvalidated&&(this._visibleBarsInvalidated=!1,this._updateVisibleBars()),this._visibleBars.logicalRange()}restoreDefault(){this._visibleBarsInvalidated=!0,this._lockBarsAndLogicalRangeEvents=!0;const e=this._visibleBars;this.setBarSpacing(6),this.resetRightOffset(),this._lockBarsAndLogicalRangeEvents=!1,this._fireVisibleBarsChangedIfRequired(e,this._visibleBars),this._requestMoreData()}startScale(e){this._scrollStartPoint&&this.endScroll(),null===this._scaleStartPoint&&null===this._commonTransitionStartState&&(this.isEmpty()||(this._scaleStartPoint=e,this._saveCommonTransitionsStartState()))}scaleTo(e){if(null===this._commonTransitionStartState)return;const t=(0,Ee.clamp)(this._width-e,0,this._width),i=(0,Ee.clamp)(this._width-(0,n.ensureNotNull)(this._scaleStartPoint),0,this._width);if(0===t||0===i)return;const s=this.barIndexLengthToPercents(this.rightOffset());this.setBarSpacing(this._commonTransitionStartState.barSpacing*t/i),this.usePercentageRightOffset().value()&&this.setRightOffset(this.percentsToBarIndexLength(s))}endScale(){null!==this._scaleStartPoint&&(this._scaleStartPoint=null,this._clearCommonTransitionsStartState(),this._requestMoreData())}startScroll(e){null===this._scrollStartPoint&&null===this._commonTransitionStartState&&(this.isEmpty()||(this._scrollStartPoint=e,this._saveCommonTransitionsStartState()))}scrollTo(e){if(this._visibleBarsInvalidated=!0,null===this._scrollStartPoint)return;const t=(this._scrollStartPoint-e)/this.barSpacing(),i=(0,n.ensureNotNull)(this._commonTransitionStartState).rightOffset+t;this._updateRightOffset(i),this._onScroll.fire()}endScroll(){null!==this._scrollStartPoint&&(this._scrollStartPoint=null,this._clearCommonTransitionsStartState(),this._requestMoreData())}formatLabel(e,t){const i="24-hours"===Ye.timeHoursFormatProperty.value()?t.toString():`${t}_ampm`;let s=this._formattedBySpan.get(i);return void 0===s&&(s=new Ge((e=>this.formatLabelImpl(e,t))),this._formattedBySpan.set(i,s)),s.format(new Date(e))}formatLabelImpl(e,t){
if(!(e&&e instanceof Date))return"incorrect time";const s=function(e,t){if(e<je.MINUTE_SPAN&&t)return"TimeWithSeconds";if(e<je.DAY_SPAN&&t)return"Time";if(e<je.WEEK_SPAN)return"DayOfMonth";if(e<je.MONTH_SPAN)return"DayOfMonth";if(e<je.YEAR_SPAN)return"Month";return"Year"}(t,!this._model.mainSeries().isDWM());return null!==qe.customFormatters.tickMarkFormatter?qe.customFormatters.tickMarkFormatter(e,s):function(e,t){switch(t){case"TimeWithSeconds":case"Time":const s="TimeWithSeconds"===t?(0,Ze.getHourMinuteSecondFormat)(Ye.timeHoursFormatProperty.value()):(0,Ze.getHourMinuteFormat)(Ye.timeHoursFormatProperty.value());return new Ke.TimeFormatter(s).format(e);case"DayOfMonth":return e.getUTCDate().toString();case"Month":return(void 0===$e&&($e=[c.t(null,void 0,i(795425)),c.t(null,void 0,i(835050)),c.t(null,void 0,i(651369)),c.t(null,void 0,i(442762)),c.t(null,{context:"short"},i(227991)),c.t(null,void 0,i(715224)),c.t(null,void 0,i(6215)),c.t(null,void 0,i(38465)),c.t(null,void 0,i(757902)),c.t(null,void 0,i(73546)),c.t(null,void 0,i(671230)),c.t(null,void 0,i(92203))]),$e)[e.getUTCMonth()];case"Year":return e.getUTCFullYear().toString()}}(e,s)}onScroll(){return this._onScroll}invalidateVisibleBars(){this._visibleBarsInvalidated=!0}onTimeScaleCompleted(e){var t;if(this._requestingMoreData=!1,this._endOfData=e,N.enabled("fix_left_edge")&&this._endOfData){const e=null===(t=this._points.range().value())||void 0===t?void 0:t.firstIndex;void 0!==e&&this.setLeftEdgeFix(e)}this._requestMoreData()}requestMoreHistoryPoints(e){this._requestHistoryPoints(e)}targetDefaultRightOffset(){return this.usePercentageRightOffset().value()?this.percentsToBarIndexLength(this._defaultRightOffsetPercentage.value()):this._defaultRightOffset.value()}percentsToBarIndexLength(e){return.01*e*this._width/this._barSpacing}barIndexLengthToPercents(e){return 100*e*this._barSpacing/this._width}_requestMoreData(){this._requestFutureTickmarksIfNeeded(),this._requestHistoryPointsIfNeeded()}_requestFutureTickmarksIfNeeded(){if(this.isEmpty()||!this._model.chartApi().isConnected().value())return;const e=this.visibleBarsStrictRange();if(null===e)return;const t=e.lastBar()-(0,n.ensureNotNull)(this._points.range().value()).lastIndex;if(t<=this._requestedTickmarksCount)return;const i=t-this._requestedTickmarksCount;this._requestedTickmarksCount=t,this._model.chartApi().requestMoreTickmarks(i)}_requestHistoryPointsIfNeeded(){if(this.isEmpty())return;if(this._endOfData)return void it.logNormal("Skipping loading more data due end of data state");const e=this.visibleBarsStrictRange();if(null===e)return;const t=(0,n.ensureNotNull)(this._points.range().value()).firstIndex-e.firstBar();t<=0||this._requestHistoryPoints(t)}_requestHistoryPoints(e){this._model.chartApi().isConnected().value()&&(this._requestingMoreData?it.logNormal("Skipping loading more data due active loading"):(this._requestingMoreData=!0,this._model.chartApi().requestMoreData(e)))}_updateVisibleBars(){const e=this._visibleBars
;if(this.isEmpty())return void(this._visibleBars.isValid()&&(this._visibleBars=He.invalid(),this._visibleBarsChanged.fire(null,e.strictRange()),this._logicalRangeChanged.fire(null,e.logicalRange())));const t=this.baseIndex(),i=this.width()/this._barSpacing,s=this._rightOffset+t,r=s-i+1;Number.isFinite(r)&&Number.isFinite(s)?(this._visibleBars=new He(new Ve(r,s),this._model.mainSeries().style()),this._lockBarsAndLogicalRangeEvents||this._fireVisibleBarsChangedIfRequired(e,this._visibleBars)):it.logWarn(`updateVisibleBars error: baseIndex: ${t}, barSpacing: ${this._barSpacing}, rightOffset: ${this._rightOffset}`)}_fireVisibleBarsChangedIfRequired(e,t){Be.BarsRange.compare(e.strictRange(),t.strictRange())||this._visibleBarsChanged.fire(t.strictRange(),e.strictRange()),Ve.compare(e.logicalRange(),t.logicalRange())||this._logicalRangeChanged.fire(t.logicalRange(),e.logicalRange())}_rightOffsetForCoordinate(e){return(this._width-1-e)/this._barSpacing}_tryToUpdateBarSpacing(e,t){return e!==t&&(this._visibleBarsInvalidated=!0,this._barSpacing=t,this._barSpacingChanged.fire(t),!0)}_coordinateToFloatIndex(e){const t=this._rightOffsetForCoordinate(e),i=this.baseIndex()+this.rightOffset()-t;return Math.round(1e6*i)/1e6}_saveCommonTransitionsStartState(){this._commonTransitionStartState={barSpacing:this.barSpacing(),rightOffset:this.rightOffset()}}_clearCommonTransitionsStartState(){this._commonTransitionStartState=null}_maxRightOffsetOnChanged(){this._maxRightOffsetChanged.fire(this.maxRightOffset())}_updateRightOffset(e){const t=this._rightOffset;this._rightOffset=e,this.correctOffset(),this._rightOffset!==t&&this._rightOffsetChanged.fire(this._rightOffset),this._model.recalculateAllPanes((0,W.viewportChangeEvent)()),this._model.lightUpdate()}_defaultRightOffsetOptionsUpdated(){this.setRightOffset(this.targetDefaultRightOffset())}}var rt=i(499445),nt=i(943624),ot=i(599015),at=i(720687);class lt{constructor(e){this._onChanged=new(q()),this._groups=[],this._groups=e||[],this._groups.forEach((e=>{e.onChanged().subscribe(null,(t=>this._onChanged.fire(e.id,t)))}))}groups(){return this._groups.filter((e=>e.isActualSymbol()))}groupsForAllSymbols(){return this._groups}createGroup(e,t,i){t=t||this._generateNextName();const s=new at.LineToolsGroup(e,t,i);this._groups.push(s),s.onChanged().subscribe(null,(e=>this._onChanged.fire(s.id,e)));const r={visibilityChanged:!1,lockedChanged:!1,titleChanged:!1,isActualIntervalChanged:!1,affectedLineTools:e.map((e=>e.id()))};return this._onChanged.fire(s.id,r),s}addGroup(e){this._groups.push(e),e.onChanged().subscribe(null,(t=>this._onChanged.fire(e.id,t))),this._onChanged.fire(e.id)}removeGroup(e){const t=this._groups.findIndex((t=>t.id===e.id));this._groups.splice(t,1),this._onChanged.fire(e.id)}groupForId(e){return this._groups.find((t=>t.id===e))||null}groupForLineTool(e){return this._groups.find((t=>t.containsLineTool(e)))||null}removeLineTools(e){const t=new Set;this._groups.forEach((i=>{const s=e.filter(i.containsLineTool.bind(i));s.length&&(i.excludeLineTools(s),t.add(i.id))}))
;return this._groups.filter((e=>0===e.lineTools().length)).forEach((e=>this.removeGroup(e))),Array.from(t)}state(e){return{groups:(e?this._groups.filter((e=>e.isActualSymbol())):this._groups).map((e=>e.state()))}}onChanged(){return this._onChanged}fireChangedAll(){this._groups.forEach((e=>{this._onChanged.fire(e.id)}))}static fromState(e,t){const i=[];for(const s of t.groups){const t=at.LineToolsGroup.fromState(e,s);null!==t&&i.push(t)}return new lt(i)}_generateNextName(){const e=new Set(this.groups().map((e=>e.name())));for(let t=1;;t++){const i=`Group ${t}`,s=`Group_${t}`;if(!e.has(i)&&!e.has(s))return i}}}var ct=i(241731),ht=i(871555),dt=i.n(ht),ut=i(290728);let pt=null;function _t(e){return Boolean(e.symbolInfo.timezone)&&Boolean(e.symbolInfo.session)}class mt{constructor(e,t){var i,s;this._sourceTargetBarBuilder=null,this._cache=new Map,this._source=e,this._sourceSession=ut.SessionInfo.fromState(e.session),this._target=t,this._targetSession=ut.SessionInfo.fromState(t.session),this._isResolutionTheSame=T.Interval.isEqual(e.resolution,t.resolution),this._isSessionTheSame=(i=e.symbolInfo,s=t.symbolInfo,i.timezone===s.timezone&&i.session===s.session&&i.session_holidays===s.session_holidays&&i.corrections===s.corrections),this._shouldCorrectTradingDay=T.Interval.isDWM(e.resolution)&&!this._isSessionTheSame}sourceTimeToTargetTime(e){if(this._isSessionTheSame&&this._isResolutionTheSame)return e;if(!_t(this._source)||!_t(this._target))return e;let t=this._cache.get(e);if(void 0===t){let i=1e3*e;if(this._shouldCorrectTradingDay){let e=dt().utc_to_cal(this._sourceSession.timezone,i);e=this._sourceSession.spec.correctTradingDay(e);const t=new Date(e);dt().set_hms(t,0,0,0,0,this._sourceSession.timezone),i=t.valueOf()}const s=this._sourceTargetBuilder();s.moveTo(i);const r=s.indexOfBar(i);t=s.startOfBar(Math.max(0,r))/1e3,this._cache.set(e,t)}return t}_sourceTargetBuilder(){if(null===this._sourceTargetBarBuilder){const e=this._isSessionTheSame?this._targetSession:(null===pt&&(pt=new ut.SessionInfo("Etc/UTC","24x7")),pt);this._sourceTargetBarBuilder=(0,ut.newBarBuilder)(this._target.resolution,this._targetSession,e)}return this._sourceTargetBarBuilder}}var gt=i(358076),ft=i(602564),vt=i(964892),St=i(992223);function yt(e,t){return e.code<t.code?-1:e.code>t.code?1:0}class bt{constructor(e){this._convertibleItems=e,this._idsToItems=new Map;for(const t of e)this._idsToItems.set(t.id,t)}convertible(e){return void 0!==this._idsToItems.get(e)}item(e){var t;return null!==(t=this._idsToItems.get(e))&&void 0!==t?t:null}size(){return this._convertibleItems.length}filterConvertible(e,t){const i=this._convertibleItems.filter(function(e,t){return i=>!e.has(i.id)&&t(i.id)}(e,t));return i.sort(yt),i}}class wt{constructor(e){this._allGroups=new Set,this._idToName=new Map,this._idToDescription=new Map,this._groupedUnitIds=new Map,this._groupedUnits=new Map,this._groupById=new Map,this._size=0,this._units=e;for(const t in e)if(e.hasOwnProperty(t)){this._allGroups.add(t),this._groupedUnitIds.set(t,new Set(e[t].map((e=>e.id)))),
this._groupedUnits.set(t,e[t]);for(const i of e[t])this._size++,this._idToName.set(i.id,i.name),this._idToDescription.set(i.id,i.description),this._groupById.set(i.id,t)}}unitsChanged(e){return this._units!==e}size(){return this._size}name(e){return this._idToName.get(e)||e}description(e){return this._idToDescription.get(e)||e}unitGroupById(e){return this._groupById.get(e)||null}allGroups(){return new Set(this._allGroups)}unitsByGroups(e){const t=[];return e.forEach((e=>{const i=this._groupedUnits.get(e);void 0!==i&&t.push({name:e,units:i})})),t}convertible(e,t){for(const i of t){const t=this._groupedUnitIds.get(i);if(void 0!==t&&t.has(e))return!0}return!1}}var Pt=i(150335);class Ct{constructor(e){this._source=null,this._sourcePane=null,this._currentToolSupportsPhantomMode=!1,this._model=e}destroy(){this._source=null,this._sourcePane=null}source(){return this._source}onToolChanged(){this._removeSource();const e=this._model.currentTool();this._currentToolSupportsPhantomMode=(0,S.isLineToolName)(e)&&(0,S.supportsPhantomMode)(e)}onCursorPositionUpdated(){if(!this._currentToolSupportsPhantomMode)return;const e=this._model.crossHairSource();if(this._sourcePane!==e.pane&&this._removeSource(),null===e.pane||!(0,Pt.isNumber)(e.index)||!(0,Pt.isNumber)(e.price))return void this._removeSource();const t={index:e.index,price:e.price};null!==this._source?this._source.setPoint(0,t):(this._source=this._model.createLineTool(e.pane,t,this._model.currentTool(),void 0,null),this._sourcePane=e.pane)}_removeSource(){null!==this._source&&(this._model.removeSource(this._source),this._source=null,this._sourcePane=null)}}var Tt=i(820402),xt=i(501182),It=i(592884);class Mt{constructor(){this._lastValue=null}align(e,t,i){this._lastValue=null;let s=e;if(!(0,It.magnetEnabled)().value())return s;const r=i.mainDataSource();if(null===r)return s;const o=r.model().mainSeries();if(r!==o)return s;const a=o.priceScale();if(a.isEmpty())return s;const l=function(e,t){const i=e.bars().valueAt(t);if(null===i)return;let s;s=null!==e.priceSource()?[e.barFunction()(i)]:12===e.style()?[i[2],i[3]]:[i[1],i[2],i[3],i[4]];return s}(o,t);if(!l)return s;const c=(0,n.ensure)(o.firstValue()),h=l.map((e=>({y:a.priceToCoordinate(e,c),price:e}))),d=a.priceToCoordinate(e,c);h.sort(((e,t)=>Math.abs(e.y-d)-Math.abs(t.y-d)));const u=h[0];return((0,It.magnetMode)().value()===xt.MagnetMode.StrongMagnet||Math.abs(u.y-d)<50)&&(s=u.price,this._lastValue=s),s}lastValue(){return this._lastValue}resetLastValue(){this._lastValue=null}}var Lt=i(85761),At=i(881517),kt=i(664114);class Et{constructor(){this._data=null}setData(e){this._data=e}draw(e,t){if(null===this._data)return;const i=t.pixelRatio,s=Math.max(1,Math.floor(i));e.lineWidth=s;const r=Math.ceil(this._data.h*i),n=Math.ceil(this._data.w*i);if(e.save(),e.lineCap="butt",this._data.vertLinesVisible){e.strokeStyle=this._data.vertLinesColor,(0,kt.setLineStyle)(e,this._data.vertLineStyle);for(const t of this._data.timeMarks){const s=Math.round(t.coord*i);(0,kt.drawVerticalLine)(e,s,0,r)}}if(this._data.horzLinesVisible){
e.strokeStyle=this._data.horzLinesColor,(0,kt.setLineStyle)(e,this._data.horzLineStyle);for(const t of this._data.priceMarks){const s=Math.round(t.coord*i);(0,kt.drawHorizontalLine)(e,s,0,n)}}e.restore()}hitTest(e){return null}}var Dt=i(284269);class Bt{constructor(e){this._renderer=new Et,this._pane=e}update(){}renderer(){const e=this._pane.defaultPriceScale(),t=this._pane.model().timeScale();if(e.isEmpty()||t.isEmpty())return null;const i=this._pane.model().properties().childs().paneProperties.childs(),s=t.marks(),r={horzLinesVisible:!0,vertLinesVisible:!0,horzLinesColor:i.horzGridProperties.childs().color.value(),vertLinesColor:i.vertGridProperties.childs().color.value(),horzLineStyle:Dt.LINESTYLE_SOLID,vertLineStyle:Dt.LINESTYLE_SOLID,priceMarks:e.marks(),timeMarks:null!==s?s:[],w:this._pane.width(),h:this._pane.height()};return this._renderer.setData(r),this._renderer}}class Vt extends At.DataSource{id(){return"grid"}paneViews(e){return[new Bt(e)]}}var Rt=i(672428);class Nt extends Rt.PriceAxisView{constructor(e,t,i){super(),this._source=e,this._priceScale=t,this._priceProvider=i,this._properties=e.model().properties().childs().scalesProperties}setHitTestData(e){this._hitTestData=e}additionalPadding(e){return 0}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const s=this._priceScale,r=s.mainSource(),n=null!==r?r.firstValue():null;if(!this._isVisible()||s.isEmpty()||null===n)return;const o=this._priceProvider(s);if(null===o)return;i.background=(0,ft.resetTransparency)(this._bgColor()),i.textColor=this.generateTextColor(i.background);const a=this.additionalPadding(s.fontSize());i.additionalPaddingTop=a,i.additionalPaddingBottom=a,i.coordinate=s.priceToCoordinate(o,n),e.text=s.formatPrice(o,n),e.visible=!0,t.visible=!0,t.hitTestData=this._hitTestData}}class Ot extends Nt{additionalPadding(e){return 2/12*e}_isVisible(){return this._properties.childs().showPriceScaleCrosshairLabel.value()&&this._source.visible&&null!==this._source.pane}_bgColor(){const e=this._properties.childs();return this._source.model().isDark()?e.crosshairLabelBgColorDark.value():e.crosshairLabelBgColorLight.value()}_updateRendererData(e,t,i){const s=t.visible;super._updateRendererData(e,t,i),this._source.isHovered()?t.backgroung=this._source.model().isDark()?l.colorsPalette["color-cold-gray-600"]:l.colorsPalette["color-cold-gray-650"]:t.backgroung=void 0,s||(t.visible=s)}}class Ft extends Nt{_isVisible(){return null!==this._source.measurePane().value()}_bgColor(){return this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}}var Wt=i(70362),zt=i(140641),Ht=i(808510),Ut=i(593379),jt=i(710567),Gt=i(282926);function qt(e){const t=e.priceScale();return null===t?0:t.isPercentage()||t.isIndexedTo100()?2:1}const $t=N.enabled("show_context_menu_in_crosshair_if_only_one_item");class Yt extends Wt.PanePriceAxisView{constructor(e,t,i,s,r){super(e,t,s),this._crossHairMenuCachedState=null,this._hasActions=!1,this._tooltipText=null,this._gaOrigin="CH menu",this._crosshairPriceAxisView=e,e.setPaneRendererLabelIcon(0),this._crosshair=t,
this._scale=i,this._options=r,(0,zt.waitTradingService)().then((()=>{this._crossHairMenuCachedState=null}))}_updateImpl(e,t){super._updateImpl(e,t);const i=this._crosshair.y,s=this._chartModel.properties().childs().scalesProperties.childs().fontSize.value(),r=this._chartModel.timeScale().width(),n=this._crosshair.model().priceAxisRendererOptions(),o=s+2*this._crosshairPriceAxisView.additionalPadding(s)+n.paddingTop+n.paddingBottom,a=o,l=i-o/2,c=r-a,h=this._crosshair.pane,d=this._mainDataSourceOnPane(),u=d&&d.symbolSource(),p=!!u&&(u.isConvertedToOtherCurrency()||u.isConvertedToOtherUnit());if(null!==d){const e=qt(d),t=d.idForAlert(),i=this._chartModel.isInReplay(),s=this._crossHairMenuCachedState;null!==s&&s.id===t&&s.priceScale===e&&s.isCurrencyOrUnitConverted===p&&s.isInReplay===i||(this._updateTooltipAndActionsAvaliability(d,e,p),this._crossHairMenuCachedState={id:t,priceScale:e,isCurrencyOrUnitConverted:p,isInReplay:i})}null!==d&&(0,pe.isActingAsSymbolSource)(d)&&d.symbol();const _=null!==h&&(h.maximized().value()||!h.collapsed().value())&&this._hasActions;this._crosshairPriceAxisView.setPaneLabelVisible(_);const m=null!==h&&0!==h.leftPriceScales().length&&_,g=null!==h&&0!==h.rightPriceScales().length&&_,f=r-a/2,v=this._tooltipText?{text:this._tooltipText,rect:{x:f,y:l,w:0,h:0}}:void 0;this._data={left:m,right:g,xl:0,xr:c,y:l,containerWidth:a,containerHeight:o,clickHandler:this._handleClick.bind(this),tooltip:v},this._crosshairPriceAxisView.setHitTestData(this._data)}_priceScale(){return this._scale}_updateTooltipAndActionsAvaliability(e,t,s){this._tooltipText=null,this._hasActions=!1;if(!(1===t))return;const r=!this._chartModel.isInReplay(),n=!this._options.disableDrawHorizLineMenuAction,o=!s&&e===this._chartModel.mainSeries()&&Boolean((0,zt.tradingService)())&&r;let a=0;o&&a++,n&&a++;let l=0;1!==a||$t||(this._tooltipText=o?c.t(null,void 0,i(750493)):n?c.t(null,void 0,i(63597)):""),this._crosshairPriceAxisView.setPaneRendererLabelIcon(l),this._hasActions=0!==a}_handleClick(e,t,i){(0,u.trackEvent)(this._gaOrigin,"click");const s=this._mainDataSourceOnPane(),r=null!==s&&(0,pe.isActingAsSymbolSource)(s)?s.symbol():null,n={pageX:i.pageX,pageY:i.pageY,clientX:i.clientX,clientY:i.clientY,screenX:i.screenX,screenY:i.screenY,price:this._crosshair.price,symbol:r};_.emit("onPlusClick",n),this._getMenuItems(t).then((s=>{if($t&&s.length>0||s.length>1)return void this._showContextMenu(s,e,i,t);const r=s[0];1!==s.length||r.isDisabled()||r.execute()}))}_getMenuItems(e){const t=this._options.disableTradingMenuActions?null:(0,zt.tradingService)(),i=(0,n.ensureNotNull)(this._crosshair.pane).mainDataSource(),s=!this._chartModel.isInReplay(),r=i===this._chartModel.mainSeries()&&Boolean(t)&&s,o=Promise.resolve([]),a=r?this._createTradingMenuItems():Promise.resolve([]);return Promise.all([o,a]).then((([e,i])=>{i.length>0&&(0,n.ensureNotNull)(t).trackEvent(this._gaOrigin,"click");const s=this._createAddHorizontalLineMenuItem();return[...e,null,...i,(e.length>0||i.length>0)&&s.length>0?new jt.Separator:null,...s].filter((e=>null!==e))
}))}_createAlertMenuItems(e){return Promise.resolve([])}_createTradingMenuItems(){const e=this._crosshair.y,t=(0,zt.tradingService)();if(null===t||null===this._crosshair.pane)return Promise.resolve([]);const i=this._crosshair.pane.mainDataSource();if(null===i)return Promise.resolve([]);const s=i.symbolSource(),r=!!s&&(s.isConvertedToOtherCurrency()||s.isConvertedToOtherUnit()),n=qt(i);return r||1!==n?Promise.resolve([]):(0,Ht.createTradeContext)(i,e).then((e=>t.chartContextMenuActions(e,{onlyMainActions:!0,gaOrigin:this._gaOrigin})))}_createAddHorizontalLineMenuItem(){if(null===this._crosshair.pane)return[];const e=this._crosshair.pane.mainDataSource();if(null===e)return[];const t=this._crosshair.y,i=this._getActionAddHorizontalLine({source:e,y:t,pane:this._crosshair.pane});return null===i?[]:[i]}_getActionAddAlert(e){return null}_getActionAddHorizontalLine(e){if(this._options.disableDrawHorizLineMenuAction)return null;const{source:t,y:s,pane:r}=e,n=this._getValue(t,s);if(null===n)return null;const o=this._formatValue(n,t),a={actionId:"Chart.Crosshair.PlusButton.DrawHorizontalLine",label:c.t(null,void 0,i(895995))+` ${o}`,icon:Ut};return a.onExecute=()=>this._addHorizontalLineTool(r,n),new jt.Action(a)}_getValue(e,t){const i=e.priceScale(),s=e.firstValue();if(null===i||null===s)return null;return i.isPercentage()||i.isIndexedTo100()?null:i.coordinateToPrice(t,s)}_formatValue(e,t){return t.formatter().format(e)}_addAlert(e,t){}_addHorizontalLineTool(e,t){this._chartModel.undoModel().createLineTool({pane:e,point:{price:t,index:0},linetool:"LineToolHorzLine"})}_showContextMenu(e,t,i,s){const r="left"===s;setTimeout((()=>{const t=(0,n.ensureDefined)(this._data),s=r?t.xl:t.xr,o=i.localX-s,a=i.clientX-o,l=i.clientX-o+t.containerWidth;Gt.ContextMenuManager.showMenu(e,{clientX:r?a:l,clientY:i.clientY-t.containerHeight/2,boxHeight:t.containerHeight,attachToXBy:r?"left":"right",attachToYBy:"auto-strict"},void 0,{menuName:"CrosshairMenuView"})}))}_mainDataSourceOnPane(){const e=this._crosshair.pane;return null!==e?e.mainDataSource():null}}var Kt=i(242786),Zt=i(777277);class Xt{constructor(e){this._data=e}hitTest(e){return void 0===this._data.clickHandler?null:new Zt.HitTestResult(Zt.HitTestResult.CUSTOM,{clickHandler:this._data.clickHandler,tapHandler:this._data.clickHandler})}draw(e,t){const i=t.pixelRatio,s=this._data.vertLinesVisible,r=this._data.horzLinesVisible;if(!s&&!r)return;e.save(),e.lineWidth=Math.max(1,Math.floor(this._data.lineWidth*i)),e.strokeStyle=this._data.color,e.fillStyle=this._data.color,e.lineCap="butt",(0,kt.setLineStyle)(e,this._data.lineStyle);const n=Math.round(this._data.x*i),o=Math.round(this._data.y*i),a=Math.ceil(this._data.w*i),l=Math.ceil(this._data.h*i);s&&n>=0&&(0,kt.drawVerticalLine)(e,n,0,l),r&&o>=0&&(0,kt.drawHorizontalLine)(e,o,0,a),this._data.drawCenter&&(e.beginPath(),e.arc(n,o,Math.round(3*i),0,2*Math.PI,!0),e.fillStyle=this._data.color,e.fill()),this._data.scissors&&function(e,t,i,s){const{pixelRatio:r,physicalHeight:n}=t,o=24*r,a=e.lineWidth%2?.5:0,l=i-Math.round(o/2)+a/r
;let c=Math.round(s-o/2);if(c<0)c=0;else{const e=n-o;c>e&&(c=e)}e.translate(l,c),e.scale(r,r),e.fillStyle="#131722",e.fill(Jt),e.strokeStyle="#fff",e.lineWidth=1,e.stroke(Jt)}(e,t,n,o),e.restore()}}const Jt=new Path2D("m15.68 3.72-3.82 5.52-3.83-5.52-.28-.42-.42.3a2.84 2.84 0 0 0-.68 3.92l3.27 4.73-1.16 1.68a3.34 3.34 0 0 0-4.26 3.22 3.34 3.34 0 0 0 3.32 3.35 3.34 3.34 0 0 0 3.08-4.6l1-1.44 1.13 1.62a3.34 3.34 0 0 0 3.15 4.42c1.84 0 3.32-1.5 3.32-3.35a3.34 3.34 0 0 0-4.42-3.17l-1.23-1.78 3.22-4.65a2.86 2.86 0 0 0-.69-3.96l-.41-.29-.29.42ZM7.82 16.27c.47 0 .86.39.86.88 0 .48-.39.87-.86.87a.87.87 0 0 1-.86-.87c0-.5.4-.88.86-.88Zm8.36 0c.47 0 .86.39.86.88 0 .48-.4.87-.86.87a.87.87 0 0 1-.86-.87c0-.5.39-.88.86-.88Z");const Qt=l.colorsPalette["color-tv-blue-500"];class ei{constructor(e,t){this._rendererData={},this._renderer=new Xt(this._rendererData),this._source=e,this._pane=t}update(){}renderer(e,t){const i=this._source.selectPointMode().value()!==gt.SelectPointMode.None,s=this._source.visible&&(this._source.areLinesVisible||i)&&!this._source.linesShouldBeHidden(),r=this._rendererData;if(!s||null===this._pane)return null;const o=this._source.paneForPointSelect(),a=this._source.isReplaySelection(),l=this._pane===this._source.pane,c=a||(null!==o?this._source.pane===o&&this._pane===o:l);if(r.scissors=!1,i&&this._source.isOnHoveredChartWidget()&&c){const e=(0,n.ensureNotNull)(this._source.pointToSelect());r.color=this._source.lineColor()||Qt,a?(r.lineWidth=2,r.scissors=l):r.lineWidth=1,r.lineStyle=Dt.LINESTYLE_SOLID,r.horzLinesVisible=!0,r.vertLinesVisible=!0,r.drawCenter=!1,"time"===e?r.horzLinesVisible=!1:"price"===e&&(r.vertLinesVisible=!1)}else{const e=this._source.properties(),t=this._source.model().currentTool(),i=(0,Kt.lastMouseOrTouchEventInfo)(),s=i.isTouch&&!i.stylus&&((0,S.isLineToolName)(t)||(0,gt.toolIsMeasure)(t));let n;n=s?Qt:e.childs().color.value();const o=e.childs().transparency.value();!s&&o>0&&(n=(0,ft.generateColor)(n,o)),r.color=n,r.horzLinesVisible=this._pane===this._source.pane&&(this._pane.maximized().value()||!this._pane.collapsed().value()),r.vertLinesVisible=!0,r.lineWidth=e.childs().width.value(),r.lineStyle=e.childs().style.value(),r.drawCenter=s&&this._pane===this._source.pane}return r.w=this._pane.width(),r.h=this._pane.height(),r.x=void 0!==this._source.lockedX&&isFinite(this._source.lockedX)?this._source.lockedX:this._source.x,r.y=this._source.y,this._renderer}}var ti=i(827175);const ii={backgroundColor:(0,ft.generateColor)(l.colorsPalette["color-tv-blue-500"],70),borderColor:(0,ft.generateColor)(l.colorsPalette["color-tv-blue-500"],20)};class si{constructor(e){this._renderer=new ti.RectangleRenderer,this._rectangle=null,this._crosshair=e}update(){const e=this._crosshair.selection();null!==e&&null!==this._crosshair.pane?this._rectangle=this._crosshair.pane.logicalRectToPixels(e):this._rectangle=null}renderer(e,t){if(!this._rectangle)return null;const i={backcolor:ii.backgroundColor,color:ii.borderColor,fillBackground:!0,linewidth:1,points:[this._rectangle.min,this._rectangle.max],
extendLeft:!1,extendRight:!1};return this._renderer.setData(i),this._renderer}}var ri=i(561626),ni=i(58594),oi=i(716590),ai=i(551040),li=i(609781),ci=i(804747),hi=i(861812),di=i(385824),ui=i(409353);const pi=c.t(null,void 0,i(33355)),_i=c.t(null,{context:"study"},i(32819)),mi=new ni.PercentageFormatter,gi=new ai.TimeSpanFormatter,fi=new li.VolumeFormatter,vi=(0,l.getHexColorByName)("color-tv-blue-500"),Si=(0,l.getHexColorByName)("color-ripe-red-400"),yi={bgColorPositive:(0,ft.generateColor)(vi,80),bgColorNegative:(0,ft.generateColor)(Si,80),colorPositive:(0,l.getHexColorByName)("color-tv-blue-600"),colorNegative:(0,l.getHexColorByName)("color-ripe-red-400"),labelBgColorPositive:vi,labelBgColorNegative:Si};class bi{constructor(e,t){this._pipFormatter=null,this._lastSymbolInfo=null,this._horzTrenRenderer=new ci.TrendLineRenderer,this._vertTrenRenderer=new ci.TrendLineRenderer,this._bgRenderer=new ti.RectangleRenderer,this._labelRenderer=new hi.TextRenderer,this._p1=null,this._p2=null,this._label=null,this._source=e,this._pane=t}update(e){const[t,i]=this._source.measurePoints();if(void 0===i)return this._p1=null,void(this._p2=null);const s=(0,n.ensureNotNull)(this._source.measurePane().value()),r=t.price,a=i.price,l=i.price-r,c=i.index-t.index,h=(0,ri.forceLTRStr)(""+c),d=(0,n.ensureNotNull)(s.mainDataSource());let u=(0,n.ensureNotNull)(d.formatter()).format(l);if(Math.abs(r)>1e-8){const e=l/Math.abs(r);u+=" ("+mi.format(100*e)+")"}const p=(0,ri.forceLTRStr)(u);this._label=p+"\n"+pi.format({count:h});const _=(0,n.ensureNotNull)(d.firstValue()),m=this._source.model().timeScale().indexToCoordinate(t.index),g=this._source.model().timeScale().indexToCoordinate(i.index),f=s.defaultPriceScale().priceToCoordinate(r,_),v=s.defaultPriceScale().priceToCoordinate(a,_);this._p1=new o.Point(m,f),this._p2=new o.Point(g,v);const S=this._source.model().timeScale().indexToUserTime(t.index),y=this._source.model().timeScale().indexToUserTime(i.index);let b=null;if(null!==S&&null!==y){const e=this._pane.model().mainSeries().symbolInfo();null!==e&&e!==this._lastSymbolInfo&&(this._pipFormatter=new oi.PipFormatter(e.pricescale,e.minmov,e.type,e.minmove2),this._lastSymbolInfo=e),b=(y.valueOf()-S.valueOf())/1e3}const w=this._pipFormatter?this._pipFormatter.format(l):null,P=null!==w?" , "+w:"",C=null!==b?gi.format(b):null,T=null!==C?", "+(0,ri.startWithLTR)(C):"";this._label=(0,ri.forceLTRStr)(p+P)+"\n"+pi.format({count:h})+T;const x=this._source.measureVolume();Number.isNaN(x)||(this._label+=`\n${_i} ${fi.format(x)}`);const I=a<r?yi.bgColorNegative:yi.bgColorPositive,M=a<r?yi.colorNegative:yi.colorPositive,L=a<r?yi.labelBgColorNegative:yi.labelBgColorPositive,k={points:[this._p1,this._p2],linewidth:0,fillBackground:!0,color:I,backcolor:I,extendLeft:!1,extendRight:!1};this._bgRenderer.setData(k);const E=this._p1.add(this._p2).scaled(.5);{const e=Math.round(E.y),t=new o.Point(this._p1.x,e),i=new o.Point(this._p2.x,e),s={points:[t,i],color:M,linewidth:1,linestyle:Dt.LINESTYLE_SOLID,extendleft:!1,extendright:!1,leftend:ui.LineEnd.Normal,
rightend:Math.abs(t.x-i.x)>=50?ui.LineEnd.Arrow:ui.LineEnd.Normal};this._horzTrenRenderer.setData(s)}{const e=Math.round(E.x),t=new o.Point(e,this._p1.y),i=new o.Point(e,this._p2.y),s={points:[t,i],color:M,linewidth:1,linestyle:Dt.LINESTYLE_SOLID,extendleft:!1,extendright:!1,leftend:ui.LineEnd.Normal,rightend:Math.abs(t.y-i.y)>=50?ui.LineEnd.Arrow:ui.LineEnd.Normal};this._vertTrenRenderer.setData(s)}const D={x:0,y:10},B=.5*(this._p1.x+this._p2.x),V=this._p2.y,R=new o.Point(B,V),N=(O=(0,n.ensureNotNull)(this._label),{points:[R],text:O,color:"#FFFFFF",horzAlign:"center",vertAlign:"middle",font:A.CHART_FONT_FAMILY,offsetX:D.x,offsetY:D.y,bold:!1,italic:!1,fontsize:12,padding:8,highlightBorder:!1,backgroundColor:L,backgroundTransparency:10,backgroundVertInflate:5,backgroundHorzInflate:5,backgroundRoundRect:4});var O;this._labelRenderer.setData(N);const F=this._labelRenderer.measure(),W=(0,hi.calculateLabelPosition)(F,this._p1,this._p2,D,this._pane.height());this._labelRenderer.setPoints([W])}renderer(){if(null===this._p1||null===this._p2)return null;const e=new di.CompositeRenderer;return e.append(this._bgRenderer),e.append(this._horzTrenRenderer),e.append(this._vertTrenRenderer),e.append(this._labelRenderer),e}}var wi=i(716384);class Pi extends wi.MediaCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){return null}_drawImpl(e){const t=e.context;t.translate(this._data.x-this._data.width/2,this._data.y-this._data.height/2),t.strokeStyle="rgba(153,153,153,.3)",t.lineWidth=2,t.beginPath(),this._drawShackle(t),t.stroke(),t.closePath(),t.strokeStyle="rgba(153,153,153,.7)",t.lineWidth=1,t.beginPath(),t.rect(0,this._data.height-this._data.bodyHeight+.5,this._data.width,this._data.bodyHeight),t.closePath(),t.stroke(),t.translate(0,-1),t.strokeStyle="#777",t.beginPath(),this._drawShackle(t),t.stroke(),t.closePath(),t.fillStyle="rgba(255,255,255,.7)",t.beginPath(),t.rect(1,this._data.height-this._data.bodyHeight+1.5,this._data.width-2,this._data.bodyHeight-2),t.fill(),t.beginPath(),t.rect(.5,this._data.height-this._data.bodyHeight+1,this._data.width-1,this._data.bodyHeight-1),t.stroke(),t.closePath(),t.fillStyle="#777",t.fillRect(this._data.width/2-.5,this._data.height-this._data.bodyHeight/2,1,2)}_drawShackle(e){const t=(this._data.width-3)/2,i=this._data.height-this._data.bodyHeight;e.moveTo(1.5,t),e.arc(this._data.width/2,t,t,Math.PI,2*Math.PI),i>t&&(e.moveTo(1.5,t),e.lineTo(1.5,i),e.moveTo(this._data.width-1.5,t),e.lineTo(this._data.width-1.5,i))}}class Ci{constructor(e,t,i){this._horzVisible=!1,this._source=e,this._pane=t,this._axis=i||"x"}update(){}renderer(e,t){const i=this._source.visible&&this._source.areLinesVisible,s=(0,gt.lockTimeAxis)().value(),r=i&&this._horzVisible,o=i||s;if("y"===this._axis&&!r||!o)return null;const a="y"===this._axis?this._pane.width()-4.5:(0,n.ensureDefined)(this._source.lockedX)+1,l="y"===this._axis?this._source.y:this._pane.height()-5.5-1;return new Pi({x:a,y:l,width:9,height:11,bodyHeight:7})}}var Ti=i(601227),xi=i(831809),Ii=i(43657),Mi=i(58216)
;class Li extends Ii.DataWindowView{constructor(e){super(),this._invalidated=!0,this._dateItem=new Ii.DataWindowItem("",c.t(null,void 0,i(676912)),""),this._timeItem=new Ii.DataWindowItem("",c.t(null,void 0,i(631976)),""),this._model=e,this._items.push(this._dateItem),this._items.push(this._timeItem)}update(){this._invalidated=!0}items(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items}_updateImpl(){const e=this._model.mainSeries().isDWM();if(this._timeItem.setVisible(!e),this._timeItem.setValue(Mi.notAvailable),this._dateItem.setValue(Mi.notAvailable),this._model.timeScale().isEmpty())return;let t=this._model.crossHairSource().appliedIndex();if(!(0,Pt.isNumber)(t)){const e=this._model.mainSeries().data().last();if(null===e)return;t=e.index}const i=this._model.timeScale().indexToUserTime(t);null!==i&&(this._dateItem.setValue(this._model.dateFormatter().format(i)),e||this._timeItem.setValue(this._model.timeFormatter().format(i)))}}var Ai=i(51545);const ki=l.colorsPalette["color-tv-blue-500"],Ei=c.t(null,{context:"Replay"},i(420747));class Di extends Ai.TimeAxisView{constructor(e,t,i,s=!1){super(e),this._indexProvider=i,this._highlighted=s,this._source=t,this._properties=e.properties().childs().scalesProperties}_getText(e){if(this._source.isReplaySelection()){const t=this._model.timeScale().indexToUserTime(e);return null!==t?`${Ei}: ${this._model.dateTimeFormatter().format(t)}`:""}return super._getText(e)}_getBgColor(){if(this._source.isReplaySelection())return ki;const e=this._properties.childs();return this._highlighted?e.axisLineToolLabelBackgroundColorCommon.value():this._model.isDark()?e.crosshairLabelBgColorDark.value():e.crosshairLabelBgColorLight.value()}_getIndex(){return this._model.crossHairSource().visible?this._indexProvider():null}_isVisible(){return this._properties.childs().showTimeScaleCrosshairLabel.value()}}var Bi=i(299845);const Vi={menuEnabled:!1,menuForMainSourceOnly:!1,disableTradingMenuActions:!1,disableDrawHorizLineMenuAction:!1};class Ri extends At.DataSource{constructor(e,t,i){super(),this.pane=null,this.price=NaN,this.index=NaN,this.visible=!0,this.areLinesVisible=!0,this.x=NaN,this.y=NaN,this._measurePane=new(Y())(null),this._measurePaneViewCache=new WeakMap,this._startMeasurePoint=null,this._endMeasurePoint=null,this._lastValidMeasurePoint=null,this._isOnHoveredChartWidget=!1,this._crossHairSelectPointMode=new(Y())(gt.SelectPointMode.None),this._selectionPane=null,this._selectionView=new si(this),this._selectionStartPoint=null,this._timeLockPaneView=null,this._crosshairPaneViewCache=new WeakMap,this._pointSelectionPaneViewCache=new WeakMap,this._priceAxisViews=new Map,this._panePriceAxisViews=new Map,this._startMeasurePriceAxisViews=new Map,this._endMeasurePriceAxisViews=new Map,this._originX=NaN,this._originY=NaN,this._subscribed=!1,this._movedDelegate=new(q()),this._pointSelectedDelegate=new(q()),this._requestedPoint=null,this._paneForRequestedPoint=null,this._selectLineColor=null,this._volumeCalculator=null,this._model=e,
this._options=Object.assign({},Vi,i||{}),this._linesShouldBeHidden=this._model.readOnly(),this._dataWindowView=new Li(e),this.setSelectionEnabled(!1);const s=e=>t=>t===(0,n.ensureNotNull)(this._measurePane.value()).defaultPriceScale()?e():null;this._currentPosPriceProvider=e=>{const t=(0,n.ensureNotNull)(this.pane);if(e===t.defaultPriceScale())return this.price;const i=(0,n.ensureNotNull)(t.defaultPriceScale().mainSource()).firstValue();if(null===i)return null;const s=t.defaultPriceScale().priceToCoordinate(this.price,i),r=(0,n.ensureNotNull)(e.mainSource()).firstValue();return null===r?null:e.coordinateToPrice(s,r)},this._startMeasurePriceProvider=s((()=>(0,n.ensureNotNull)(this._startMeasurePoint).price)),this._endMeasurePriceProvider=s((()=>(0,n.ensureNotNull)(this._lastMeasurePoint()).price)),this._properties=t;this._timeAxisView=new Di(e,this,(()=>this.appliedIndex()),!1),this._startMeasureTimeAxisView=new Di(e,this,(()=>(0,n.ensureNotNull)(this._startMeasurePoint).index),!0),this._endMeasureTimeAxisView=new Di(e,this,(()=>(0,n.ensureNotNull)(this._lastMeasurePoint()).index),!0),e.readOnly()||gt.cursorTool.subscribe((e=>this.areLinesVisible="arrow"!==e),{callWithLast:!0})}destroy(){null!==this._volumeCalculator&&this._volumeCalculator.destroy(),this._measurePane.setValue(null)}moved(){return this._movedDelegate}originX(){return this._originX}originY(){return this._originY}saveOriginCoords(e,t){this._originX=e,this._originY=t}clearOriginCoords(){this._originX=NaN,this._originY=NaN}currentPoint(){return new o.Point(this.x,this.y)}model(){return this._model}appliedIndex(){return Number.isFinite(this.lockedIndex)?this.lockedIndex:this.index}startMeasurePoint(){return this._startMeasurePoint||null}endMeasurePoint(){return this._endMeasurePoint||null}measureVolume(){if(null===this._volumeCalculator)return NaN;const[e,t]=this.measurePoints();return void 0===t?NaN:this._volumeCalculator.volume(e.index,t.index)}measurePane(){return this._measurePane.readonly()}startMeasuring(e,t){this._startMeasurePoint=e,this._measurePane.setValue(t),t.containsMainSeries()&&((0,n.assert)(null===this._volumeCalculator),this._volumeCalculator=new Bi.SeriesTimeRangeVolumeCalculator(this.model().mainSeries())),this._model.updatePane(t)}finishMeasure(e){this._endMeasurePoint=e}clearMeasure(){this._measurePane.setValue(null),delete this._startMeasurePoint,delete this._endMeasurePoint,delete this._lastValidMeasurePoint,this._model.lightUpdate(),null!==this._volumeCalculator&&(this._volumeCalculator.destroy(),this._volumeCalculator=null)}measurePoints(){const e=[(0,n.ensureNotNull)(this._startMeasurePoint)],t=this._lastMeasurePoint();return null!==t&&e.push(t),e}startSelection(e){this._selectionStartPoint=this.currentLogicalPoint(),this._selectionPane=e}clearSelection(){this._selectionStartPoint=null,this._selectionPane=null}selection(){return this._selectionStartPoint?{p1:this._selectionStartPoint,p2:this.currentLogicalPoint()}:null}currentLogicalPoint(){return{index:this.appliedIndex(),price:this.price}}selectPointMode(){
return this._crossHairSelectPointMode}lineColor(){return this._selectLineColor}cancelRequestSelectPoint(){this._crossHairSelectPointMode.value()!==gt.SelectPointMode.None&&this._setSelectPointModeState(gt.SelectPointMode.None)}requestSelectPoint(e){(0,n.assert)(this._crossHairSelectPointMode.value()===gt.SelectPointMode.None,"Point already requested");const{pointType:t,pane:i,lineColor:s=null,selectPointMode:r=gt.SelectPointMode.Study}=e;i&&((0,n.assert)(-1!==this._model.panes().indexOf(i),"Chartmodel doesn't contains specified pane"),this._paneForRequestedPoint=i,this._model.panesCollectionChanged().subscribe(this,this._paneCollectionChanged)),this._selectLineColor=s,this._requestedPoint=t,this._setSelectPointModeState(r)}onPointSelected(){return this._pointSelectedDelegate}trySelectCurrentPoint(){const e=(0,n.ensureNotNull)(this._requestedPoint);if(!this._model.mainSeries().bars().contains(this.index)&&"price"!==e)return;const t=(0,n.ensureNotNull)(this.pane);if(this._paneForRequestedPoint&&this._paneForRequestedPoint!==t)return;let i,s;if("price"===e||(i=this._model.timeScale().indexToTimePoint(this.index),null!==i)){if("time"!==e){const e=t.mainDataSource();if(null===e)return;const i=e.firstValue(),r=e.priceScale();if(null===i||null===r)return;s=r.coordinateToPrice(this.y,i)}this._setSelectPointModeState(gt.SelectPointMode.None),this._pointSelectedDelegate.fire({time:i,price:s},t)}}isOnHoveredChartWidget(){return this._isOnHoveredChartWidget}setOnHoveredChartWidget(e){this._isOnHoveredChartWidget=e}isReplaySelection(){return!1}clearPosition(){this.visible=!1,this.index=NaN,this.price=NaN,this.x=NaN,this.y=NaN,this.pane=null,this.clearOriginCoords(),this._updateVisibilityDependentPaneViews()}setPosition(e,t,i){return this._subscribed||(this._model.mainSeries().onRestarted().subscribe(this,this.clearMeasure),this._subscribed=!0),this.setLockedPosition(i),this.visible=!0,this._tryToUpdateViews(e,t,i)}setLinesShouldBeHidden(e){this._linesShouldBeHidden=e}linesShouldBeHidden(){return this._linesShouldBeHidden}handleContextMenuEvent(e){this._crossHairSelectPointMode.value()!==gt.SelectPointMode.None&&this._setSelectPointModeState(gt.SelectPointMode.None)}properties(){return this._properties}priceAxisViews(e,t){const i=null===this._requestedPoint||"time"!==this._requestedPoint||!this._isOnHoveredChartWidget,s=[];return this.pane===e&&i&&s.push(this._createPriceAxisViewOnDemand(this._priceAxisViews,this._panePriceAxisViews,e,t,this._currentPosPriceProvider,Ot,!0)[0]),this._startMeasurePoint&&s.push(this._createPriceAxisViewOnDemand(this._startMeasurePriceAxisViews,null,e,t,this._startMeasurePriceProvider,Ft)[0]),this._lastMeasurePoint()&&s.push(this._createPriceAxisViewOnDemand(this._endMeasurePriceAxisViews,null,e,t,this._endMeasurePriceProvider,Ft)[0]),s}timeAxisViews(){const e=[],t=null===this._requestedPoint||"price"!==this._requestedPoint||!this._isOnHoveredChartWidget;return!this._linesShouldBeHidden&&(this.visible||(0,gt.lockTimeAxis)().value())&&t&&e.push(this._timeAxisView),
this._startMeasurePoint&&e.push(this._startMeasureTimeAxisView),this._lastMeasurePoint()&&e.push(this._endMeasureTimeAxisView),e}paneViews(e){if(void 0===e)return null;const t=[];if(this.isReplaySelection()){let i=this._pointSelectionPaneViewCache.get(e);i||(i=new CrosshairPointSelectionPaneView(this,e,this._model),this._pointSelectionPaneViewCache.set(e,i)),t.push(i)}let i=this._crosshairPaneViewCache.get(e);if(i||(i=new ei(this,e),this._crosshairPaneViewCache.set(e,i)),t.push(i),e===this._selectionPane&&t.push(this._selectionView),e===this._measurePane.value()){let i=this._measurePaneViewCache.get(e);i||(i=new bi(this,e),this._measurePaneViewCache.set(e,i)),i.update((0,W.sourceChangeEvent)(this.id())),t.push(i)}if(xi.addPlusButtonProperty.value()){const i=e===this.pane,s=!Ti.CheckMobile.any()||window.screen.width>=320,r=gt.tool.value(),n=(0,S.isLineToolName)(r),o=null!==this._model.lineBeingEdited()||null!==this._model.lineBeingCreated()||this._model.sourcesBeingMoved().length>0||null!==this._model.customSourceBeingMoved()||(0,gt.toolIsMeasure)(r);if(i&&this._isOnHoveredChartWidget&&this._crossHairSelectPointMode.value()===gt.SelectPointMode.None&&s&&!n&&!o){const i=e.mainDataSource();if(null!==i){const s=i.priceScale();if(null!==s){const i=this._createPriceAxisViewOnDemand(this._priceAxisViews,this._panePriceAxisViews,e,s,this._currentPosPriceProvider,Ot,!0)[1];null!==i&&t.push(i)}}}}return(0,gt.lockTimeAxis)().value()&&(null===this._timeLockPaneView&&(this._timeLockPaneView=new Ci(this,e)),t.push(this._timeLockPaneView)),t}dataWindowView(){return this._dataWindowView}updateAllViews(e){this._priceAxisViews.forEach((t=>{t.forEach((t=>t.update(e)))})),this._panePriceAxisViews.forEach((t=>{t.forEach((t=>t.update(e)))})),this._startMeasurePoint&&(this._startMeasurePriceAxisViews.forEach((t=>{t.forEach((t=>t.update(e)))})),this._startMeasureTimeAxisView.update(e)),this._lastMeasurePoint()&&(this._endMeasurePriceAxisViews.forEach((t=>{t.forEach((t=>t.update(e)))})),this._endMeasureTimeAxisView.update(e)),this._timeAxisView.update(e),this._selectionView.update(),this._dataWindowView.update(),this._updateVisibilityDependentPaneViews()}setLockedPosition(e){delete this.lockedIndex,delete this.lockedX,e!==this._measurePane.value()&&(0,gt.lockTimeAxis)().value()&&(this.lockedIndex=this._model.timeScale().points().roughIndex(gt.lockTimeAxisTime.value()),null!==this.lockedIndex&&(this.lockedX=this._model.timeScale().indexToCoordinate(this.lockedIndex)))}isMenuEnabled(){return this._options.menuEnabled}isHoveredEnabled(){return xi.addPlusButtonProperty.value()}isHovered(){return this._model.hoveredSource()===this}pointToSelect(){return this._requestedPoint}paneForPointSelect(){return this._paneForRequestedPoint}_lastMeasurePoint(){return this._endMeasurePoint?this._endMeasurePoint:(null!==this.pane&&this._measurePane.value()===this.pane&&(this._lastValidMeasurePoint={price:this._model.magnet().align(this.price,this.index,this.pane),index:this.index}),this._lastValidMeasurePoint||null)}
_createPriceAxisViewOnDemand(e,t,i,s,r,o,a=!1){let l=e.get(i),c=null!==t?t.get(i):void 0;void 0===l&&(l=new Map,e.set(i,l),this._options.menuEnabled&&null!==t&&(c=new Map,t.set(i,c)),a&&i.onDestroyed().subscribe(this,(()=>this._onPaneDestroyed(i))));let h=l.get(s);if(void 0===h){if(h=new o(this,s,r),l.set(s,h),void 0!==c){const e=new Yt(h,this,s,this._model,this._options);c.set(s,e)}a&&s.lastSourceRemoved().subscribe(this,(()=>this._onPriceScaleCleared(s)))}let d=null;return void 0!==c&&(d=(0,n.ensureDefined)(c.get(s))),[h,d]}_onPaneDestroyed(e){e.onDestroyed().unsubscribeAll(this),this._priceAxisViews.delete(e),this._panePriceAxisViews.delete(e),this._startMeasurePriceAxisViews.delete(e),this._endMeasurePriceAxisViews.delete(e)}_onPriceScaleCleared(e){e.lastSourceRemoved().unsubscribeAll(this),this._priceAxisViews.forEach((t=>t.delete(e))),this._panePriceAxisViews.forEach((t=>t.delete(e))),this._startMeasurePriceAxisViews.forEach((t=>t.delete(e))),this._endMeasurePriceAxisViews.forEach((t=>t.delete(e)))}_tryToUpdateViews(e,t,i){return!!this._tryToUpdateData(e,t,i)&&(this.updateAllViews((0,W.sourceChangeEvent)(this.id())),this._movedDelegate.fire({index:this.index,price:this.price}),!0)}_tryToUpdateData(e,t,i){const s=this.x,r=this.y,o=this.price,a=this.index,l=this.pane,c=this._priceScaleByPane(i);if(this.index=e,this.x=isNaN(e)?NaN:this._model.timeScale().indexToCoordinate(e),null!==c&&null!==i){this.pane=i,this.price=t;const e=(0,n.ensureNotNull)(i.mainDataSource()).firstValue();this.y=null===e?NaN:c.priceToCoordinate(t,e)}else this.pane=null,this.price=NaN,this.y=NaN;return s!==this.x||r!==this.y||a!==this.index||o!==this.price||l!==this.pane}_priceScaleByPane(e){return e&&!e.defaultPriceScale().isEmpty()?e.defaultPriceScale():null}_setSelectPointModeState(e){e===gt.SelectPointMode.None&&(this._requestedPoint=null,this._selectLineColor=null,this._paneForRequestedPoint&&(this._paneForRequestedPoint=null,this._model.panesCollectionChanged().unsubscribe(this,this._paneCollectionChanged))),gt.activePointSelectionMode.setValue(e),this._crossHairSelectPointMode.setValue(e),this._model.lightUpdate()}_paneCollectionChanged(e){const t=this._paneForRequestedPoint;null!==t&&-1===e.indexOf(t)&&this.cancelRequestSelectPoint()}_updateVisibilityDependentPaneViews(){var e;for(const t of this.model().panes())null===(e=this._pointSelectionPaneViewCache.get(t))||void 0===e||e.update()}}var Ni=i(793713),Oi=i(188035),Fi=i(392987),Wi=i(785359),zi=i(658358),Hi=i(478265),Ui=i(554511),ji=i(870122);class Gi{constructor(e){this._priceSourceNamesById=new Map,e.forEach((e=>this._priceSourceNamesById.set(e.id,e.name)))}name(e){var t;return null!==(t=this._priceSourceNamesById.get(e))&&void 0!==t?t:null}priceSourcesChanged(e){return e.length!==this._priceSourceNamesById.size}}const qi=new ee.TranslatedString("remove deselected empty line tools",c.t(null,void 0,i(59211))),$i=N.enabled("auto_enable_symbol_labels"),Yi=(0,X.getLogger)("Chart.ChartModel");function Ki(e,t){const i=e.indexOf(t);return-1!==i&&(e.splice(i,1),!0)}function Zi(e){var t,i
;for(let s=e.length;s--;){const r=e[s].dataSources();for(let e=r.length;e--;)null===(t=r[e].dataWindowView())||void 0===t||t.update();const n=e[s].priceDataSources();for(let e=n.length;e--;)null===(i=n[e].legendView())||void 0===i||i.update()}}const Xi={isSnapshot:!1,readOnly:!1,watermarkEnabled:!0,shiftVisibleRangeOnNewBar:!0,currencyConversionEnabled:!1,unitConversionEnabled:!1,countdownEnabled:!0,lastPriceAnimationEnabled:!0,onWidget:!1,hideIdeas:!1};class Ji{constructor(e,t,i,r,n,o,a,l,c,d){this._onRearrangePanes=new(q()),this._lineToolsGroupModel=new lt,this._sourcesBeingMoved=[],this._activeItemBeingMoved=null,this._lineBeingEdited=null,this._linePointBeingEdited=null,this._linePointBeingChanged=null,this._customSourceBeingMovedHitTestData=null,this._customSourceBeingMoved=null,this._dataSourceCollectionChanged=new(q()),this._sourceProperitesChanged=new(q()),this._sourceZOrderChanged=new(q()),this._symbolSourceResolved=new(q()),this._symbolSourceResolvingActive=new(Y())(!1),this._adjustForDividendsAvailability=new(Y())(0),this._adjustForDividendsEnabled=new(Y())(!1),this._sessions=null,this._currentTool="",this._lineBeingCreated=null,this._paneBeingCreatedLineOn=null,this._lineCancelled=new(q()),this._phantomSourceContainer=new Ct(this),this._destroyed=!1,this._isSettingsExternalPosition=!1,this._isTimeScrolling=!1,this._magnet=new Mt,this._scrollingState=null,this._modelIntervals=[],this._rendererOptionsProvider=new k(this),this._studyInserted=new(q()),this._cachedStudiesMaxOffset=0,this._replayStatus=new(Y())(ct.ReplayStatus.Undefined),this._panes=[],this._tagsChanged=new(q()),this._strategySources=[],this._strategySourcesChange=new(q()),this._activeStrategySource=new(Y())(null),this._paneCollapsingAvailable=new(Y())(!1),this._panesCollectionChanged=new(q()),this._scrollEnabled=N.enabled("chart_scroll"),this._zoomEnabled=N.enabled("chart_zoom"),this._isScalesResetAvailableChanged=new(q()),this._isScalesResetAvailable=!1,this._lollipopSourcesWatcher=null,this._alertsWatcher=null,this._hoveredSource=null,this._hoveredSourceChanged=new(q()),this._lastHoveredHittestData=null,this._lastSelectedHittestData=null,this._topmostCustomSources=[],this._fgCustomSources=[],this._bgCustomSources=[],this._allCustomSources=[],this._customSourcesMap=new Map,this._multiPaneSources=[],this._showLegendProperty=new(M()),this._id=(0,J.guid)(),this._chartSaveTime=null,this._availableCurrenciesList=null,this._availableCurrencies=new bt([]),this._availablePriceSources=new Gi([]),this._availableUnitsObject=null,this._availableUnits=new wt({}),this._availablePriceSourcesList=null,this._shouldBeSavedEvenIfHidden=!1,this._watchedThemeSpawn=h.watchedTheme.spawn(),this._gradientColorsCache=null,this._recalcVRStudiesParams={},this._recalcColorStudiesParams={},this._recalcVisibleRangeStudiesImplDebounced=(0,s.default)(this._recalcVisibleRangeStudiesImpl.bind(this,this._recalcVRStudiesParams),500),this._recalcColorStudiesImplDebounced=(0,s.default)(this._recalcColorStudiesImpl.bind(this,this._recalcColorStudiesParams),250),this._width=0,
this._resetScales=new(q()),this._chartThemeLoaded=new(q()),this._selection=new b,this._selectedSourceChanged=new(q()),this._symbolSourceCollectionChanged=new(q()),this._gridSource=new Vt,this._syncPointCache=new Map,this._lastAppliedGotoTimeRange=null,this._lastGotoTimeRange=null,this._clearSelection=()=>{this._lastSelectedHittestData=null,this._selection.clear()},this._removeSourceFromSelection=e=>{this._selection.remove(e)},this._addSourceToSelection=(e,t)=>{const i=this._selection.isSelected(e);i&&this._lastSelectedHittestData===t||e&&!e.isSelectionEnabled()||(this._lastSelectedHittestData=t||null,i||this._selection.add(e))},this._recalcSymbolResolvingActive=()=>{for(const e of this._panes)if(e.symbolSourceResolvingActive().value())return void this._symbolSourceResolvingActive.setValue(!0);this._symbolSourceResolvingActive.setValue(!1)},this._recalcAdjustForDividendsAvailibility=()=>{var e,t,i,s;if(this._symbolSourceResolvingActive.value())return void this._adjustForDividendsAvailability.setValue(0);const r=this.mainSeries();switch(null!==(t=null===(e=r.symbolInfo())||void 0===e?void 0:e.allowed_adjustment)&&void 0!==t?t:"none"){case"dividends":return void this._adjustForDividendsAvailability.setValue(2);case"splits":return void this._adjustForDividendsAvailability.setValue(1);case"any":return void this._adjustForDividendsAvailability.setValue(3)}for(const e of this.symbolSources().filter(pe.isActingAsSymbolSource)){if(e.symbolHibernated().value()||e===r)continue;if("any"===(null!==(s=null===(i=e.symbolInfo())||void 0===i?void 0:i.allowed_adjustment)&&void 0!==s?s:"none"))return void this._adjustForDividendsAvailability.setValue(3)}this._adjustForDividendsAvailability.setValue(0)},this._recalcAdjustForDividendsEnabled=()=>{switch(this._adjustForDividendsAvailability.value()){case 2:return void this._adjustForDividendsEnabled.setValue(!0);case 0:case 1:return void this._adjustForDividendsEnabled.setValue(!1)}this._adjustForDividendsEnabled.setValue(this.mainSeries().properties().childs().dividendsAdjustment.value())},this._recalcPaneCollapsingAvailable=e=>{let t=this._panes.filter((e=>!e.collapsed().value())).length;0===t&&e&&this._panes.length>0&&(this._panes[0].collapsed().setValue(!1),t=1),this._paneCollapsingAvailable.setValue(t>1)},this._chartApi=e,this._invalidateHandler=t,this._undoModel=o,this._properties=i,this._options=(0,ie.merge)((0,ie.clone)(Xi),l),this._collapsedWV=c,this._isAutoSaveEnabled=d,this._studiesMetaInfoRepository=n,this._readOnly=this._options.readOnly,this._isSnapshot=this._options.isSnapshot,this._chartSaveTime=(new Date).valueOf(),this._backgroundColor=new(Y())(this._getBackgroundColor()),this._backgroundTopColor=new(Y())(this._getBackgroundColor(!0)),this._properties.childs().paneProperties.childs().background.subscribe(this,this._updateBackgroundColor),this._properties.childs().paneProperties.childs().backgroundType.subscribe(this,this._updateBackgroundColor),this._properties.childs().paneProperties.childs().backgroundGradientStartColor.subscribe(this,this._updateBackgroundColor),
this._properties.childs().paneProperties.childs().backgroundGradientEndColor.subscribe(this,this._updateBackgroundColor),this._backgroundColor.subscribe(this.recalcColorStudies.bind(this,!1)),this._backgroundTopColor.subscribe(this.recalcColorStudies.bind(this,!1)),this._watchedThemeSpawn.subscribe(this._updateBackgroundColor.bind(this)),this._symbolSourceResolvingActive.subscribe(this._recalcAdjustForDividendsAvailibility),this.setStudiesMetaData(this._studiesMetaInfoRepository.getInternalMetaInfoArray(),this._studiesMetaInfoRepository.getMigrations()),(0,gt.init)();const u=this._readOnly?new(M())((0,V.defaults)("chartproperties.paneProperties.crossHairProperties")):this._properties.childs().paneProperties.childs().crossHairProperties;this.m_crossHairSource=new Ri(this,u,this._options.crossHair),this._crossHairSelectPointMode=this.m_crossHairSource.selectPointMode().spawn(),this._crossHairSelectPointMode.subscribe((e=>{if(e!==gt.SelectPointMode.None&&this.lineBeingCreated()){const e=gt.tool.value();this.cancelCreatingLine(),gt.tool.setValue(e)}})),this._tagsChanged=new(q());const p=new x.DefaultProperty("chartproperties.mainSeriesProperties");p.addExclusion("minTick"),p.addExclusion("priceAxisProperties.lockScale"),p.addExclusion("priceAxisProperties.percentage"),p.addExclusion("priceAxisProperties.indexedTo100"),p.addExclusion("priceAxisProperties.isInverted"),p.addExclusion("priceAxisProperties.log"),p.addExclusion("priceAxisProperties.logDisabled"),p.addExclusion("priceAxisProperties.percentageDisabled"),p.addExclusion("priceAxisProperties.autoScaleDisabled"),p.merge(i.childs().mainSeriesProperties.state()),this._timeScale=new st(this,this._options.timeScale);const _={countdownEnabled:this._options.countdownEnabled,lastPriceAnimationEnabled:this._options.lastPriceAnimationEnabled};this.m_mainSeries=new Ni.Series(this,p,_,r),this.m_mainSeries.onStyleChanged().subscribe(this._timeScale,this._timeScale.invalidateVisibleBars);const m=()=>this.fullUpdate();this.m_mainSeries.properties().childs().showCountdown.subscribe(this,(()=>{this.m_mainSeries.updateAllViews((0,W.sourceChangeEvent)(this.m_mainSeries.id())),m()})),(0,Z.currencyUnitVisibilityProperty)().subscribe(this,m),this._timeScale.visibleBarsStrictRangeChanged().subscribe(this.m_mainSeries,this.m_mainSeries.clearHighLowPriceCache),this._timeScale.visibleBarsStrictRangeChanged().subscribe(this.m_mainSeries,this.m_mainSeries.clearAveragePriceCache),this.createPane(void 0,{axisProperties:p.childs().priceAxisProperties.state(["autoScale"])}),this._adjustForDividendsAvailability.subscribe(this._recalcAdjustForDividendsEnabled),this.mainSeries().properties().childs().dividendsAdjustment.subscribe(this,this._recalcAdjustForDividendsEnabled),this._recalcAdjustForDividendsEnabled(),this._boundUpdateStudiesMaxOffset=this._updateStudiesMaxOffset.bind(this),this.mainSeries().dataEvents().seriesTimeFrame().subscribe(this,((e,t,i,s)=>{if(null!==this._lastAppliedGotoTimeRange&&null!==i&&s&&(0,Tt.areEqualTimeFrames)(this._lastAppliedGotoTimeRange.range,i)){
const e=this.appliedTimeFrame().value();null!==e&&!this._lastAppliedGotoTimeRange.actual&&(0,Tt.areEqualTimeFrames)(this._lastAppliedGotoTimeRange.range,e.val)&&this.appliedTimeFrame().setValue(null),this._lastAppliedGotoTimeRange=null}})),this.mainSeries().dataEvents().completed().subscribe(this,(e=>{null===this._lastAppliedGotoTimeRange&&null!==this._lastGotoTimeRange&&(this.gotoTimeRange(this._lastGotoTimeRange.from,this._lastGotoTimeRange.to),this._lastGotoTimeRange=null)}));const g=this._panes[0];g.setStretchFactor(2*g.stretchFactor()),this._properties.listeners().subscribe(this,this.lightUpdate),this._properties.childs().timezone.subscribe(null,(()=>{this._chartApi&&this._chartApi.isConnected().value()&&this._chartApi.switchTimezone(this.timezone())})),g.addDataSource(this.m_mainSeries,g.findSuitableScale(this.m_mainSeries),!1),this._barsMarksSources=a(this);for(const e of this._barsMarksSources)e.setOwnerSource(this.m_mainSeries),g.addDataSource(e,this.m_mainSeries.priceScale(),!0)}setStudiesMetaData(e,t){this._studiesMetaData=e,this._studyVersioning=new w.StudyVersioning(this._studiesMetaData,t)}restart(){this._chartApi.switchTimezone(this.timezone()),this._timeScale.reset(),this.m_mainSeries.restart();for(const e of this.dataSources())e.restart&&e!==this.m_mainSeries&&e.restart();this.sessions().restart()}version(){return 3}collapsed(){return this._collapsedWV}chartSaveTime(){return this._chartSaveTime}setChartSaveTime(e){this._chartSaveTime=e}destroy(){this._phantomSourceContainer.destroy(),this._hoveredSourceChanged.destroy(),null!==this._watermarkSource&&(this._watermarkSource.destroy(),this._watermarkSource=null),Array.from(this._customSourcesMap.keys()).forEach(this._removeCustomSource,this),(0,n.assert)(0===this._topmostCustomSources.length),(0,n.assert)(0===this._fgCustomSources.length),(0,n.assert)(0===this._bgCustomSources.length),(0,n.assert)(0===this._allCustomSources.length),(0,n.assert)(0===this._customSourcesMap.size),null!==this._lollipopSourcesWatcher&&(this._lollipopSourcesWatcher.destroy(),this._lollipopSourcesWatcher=null),null!==this._alertsWatcher&&this._alertsWatcher.destroy(),this._properties.childs().paneProperties.childs().background.unsubscribeAll(this),this._properties.childs().paneProperties.childs().backgroundType.unsubscribeAll(this),this._properties.childs().paneProperties.childs().backgroundGradientEndColor.unsubscribeAll(this),this._properties.childs().paneProperties.childs().backgroundGradientStartColor.unsubscribeAll(this),this._watchedThemeSpawn.destroy(),this._lastHoveredHittestData=null,this._lastSelectedHittestData=null,(0,Z.currencyUnitVisibilityProperty)().unsubscribeAll(this),this._crossHairSelectPointMode.destroy(),this._destroyed=!0}undoModel(){return this._undoModel}onData(e){switch(e.method){case"timescale_update":{const t=e.params;this._updateTimeScale({index:t.index,zoffset:t.zoffset,values:t.changes,indexDiffs:t.index_diff,baseIndex:t.baseIndex,marks:t.marks,clearFlag:t.clear});break}case"timescale_completed":{const t=Boolean(e.params[0])
;this._timeScale.onTimeScaleCompleted(t);break}}}addStrategySource(e,t){1!==t&&-1===this._strategySources.indexOf(e)&&(this._strategySources.push(e),this._strategySourcesChange.fire(t),this.setActiveStrategySource(e))}removeStrategySource(e,t){if(1===t)return;const i=this._strategySources.indexOf(e);if(-1!==i){if(this._strategySources.splice(i,1)[0]===this._activeStrategySource.value()&&this.unsetActiveStrategySource(),this._strategySources.length>0){const e=this._strategySources[this._strategySources.length-1];this.setActiveStrategySource(e)}this._strategySourcesChange.fire(t)}}setActiveStrategySource(e){-1!==this._strategySources.indexOf(e)&&this._activeStrategySource.setValue(e)}unsetActiveStrategySource(){this._activeStrategySource.setValue(null)}activeStrategySource(){return this._activeStrategySource}strategySources(){return this._strategySources}strategySourcesChange(){return this._strategySourcesChange}setScrollEnabled(e){this._scrollEnabled=e}scrollEnabled(){return this._scrollEnabled}setZoomEnabled(e){this._zoomEnabled=e}zoomEnabled(){return this._zoomEnabled}zoomToViewport(e,t,i,s,r){this.setTimeViewport(e,t);let n=Math.min(i,s),o=Math.max(i,s);const a=r.defaultPriceScale();a.isPercentage()||a.setMode({autoScale:!1}),a.isLog()&&(n=a.priceToLogical(n),o=a.priceToLogical(o)),a.setPriceRange(new ue.PriceRange(n,o)),this.recalculateAllPanes((0,W.viewportChangeEvent)()),this.invalidate(this._paneInvalidationMask(r,K.InvalidationLevel.Light)),this._setScalesResetAvailable(!0)}setTimeViewport(e,t){const i=this.appliedTimeFrame().value();null!==this._lastAppliedGotoTimeRange&&null!==i&&(0,Tt.areEqualTimeFrames)(this._lastAppliedGotoTimeRange.range,i.val)&&!this._lastAppliedGotoTimeRange.actual||(this.timeScale().zoomToBarsRange(e,t),this.recalculateAllPanes((0,W.viewportChangeEvent)()),this.recalcVisibleRangeStudies(),this.lightUpdate())}onTagsChanged(){return this._tagsChanged}canZoomIn(){return this._timeScale.canZoomIn()&&this._zoomEnabled}canZoomOut(){return this._timeScale.canZoomOut()&&this._zoomEnabled}onPaneTagsChanged(){this._tagsChanged.fire()}panesCollectionChanged(){return this._panesCollectionChanged}dataSourceCollectionChanged(){return this._dataSourceCollectionChanged}symbolSourceCollectionChanged(){return this._symbolSourceCollectionChanged}symbolSourceResolved(){return this._symbolSourceResolved}symbolSourceResolvingActive(){return this._symbolSourceResolvingActive}adjustForDividendsAvailability(){return this._adjustForDividendsAvailability}adjustForDividendsEnabled(){return this._adjustForDividendsEnabled}paneCollapsingAvailable(){return this._paneCollapsingAvailable}sourcePropertiesChanged(){return this._sourceProperitesChanged}sourceZOrderChanged(){return this._sourceZOrderChanged}zoomTime(e,t,i){if(!this._zoomEnabled)return;const s=this.timeScale();if(s.isEmpty()||0===t)return;const r=s.width();e=Math.max(1,Math.min(e,r-2)),s.zoom(e,t,i),this.recalculateAllPanes((0,W.viewportChangeEvent)()),this.lightUpdate(),this.recalcVisibleRangeStudies(),this._setScalesResetAvailable(!0)}
linePointBeingEdited(){return this._linePointBeingEdited}activeItemBeingMoved(){return this._activeItemBeingMoved}linePointBeingChanged(){return this._linePointBeingChanged}updateAllPaneViews(e){for(const t of this._panes)t.updateAllViews(e)}dataSources(){const e=[this.crossHairSource()];for(const t of this._panes)for(const i of t.dataSources())e.push(i);return e}priceDataSources(){const e=[];for(const t of this._panes)for(const i of t.priceDataSources())e.push(i);return e}symbolSources(){const e=[];for(const t of this._panes)for(const i of t.symbolSources())e.push(i);return e}selection(){return this._selection}selectionMacro(e,t=!1){const i=this.selection().allSources();e({removeSourceFromSelection:this._removeSourceFromSelection,addSourceToSelection:this._addSourceToSelection,clearSelection:this._clearSelection,selection:this.selection.bind(this)});const s=(0,v.subtract)(i,this.selection().allSources()),r=(0,v.subtract)(this.selection().allSources(),i);r.concat(i).forEach((e=>e.updateAllViews((0,W.selectionChangeEvent)())));let n=[];s.forEach((e=>{if((0,S.isLineTool)(e)){const i=e.hasAlert.value()&&e.getAlertSync();i&&i.setSelected(!1),!t&&e.shouldBeRemovedOnDeselect()&&n.push(e)}})),r.forEach((e=>{const t=(0,S.isLineTool)(e)&&e.hasAlert&&e.hasAlert.value()&&e.getAlertSync();t&&t.setSelected(!0)})),n=n.filter((e=>null!==this.dataSourceForId(e.id()))),n.length>0&&this._undoModel.removeSources(n,!1,qi),this.lightUpdate(),(s.length>0||r.length>0)&&this._selectedSourceChanged.fire()}onSelectedSourceChanged(){return this._selectedSourceChanged}checkLineToolSelection(){const e=this.selection().allSources();this._selection.checkLineToolSelection(),e.length!==this.selection().allSources().length&&this._selectedSourceChanged.fire()}lineToolsGroupModel(){return this._lineToolsGroupModel}restoreLineToolsGroups(e){this._lineToolsGroupModel=lt.fromState(this,e)}realignLineTools(e){for(const t of this._panes)(void 0===e||t.hasDataSource(e))&&t.realignLineTools(e)&&this._dataSourceCollectionChanged.fire(t)}isSnapshot(){return this._isSnapshot}onWidget(){return this._options.onWidget}hideIdeas(){return this._options.hideIdeas}updateSource(e){const t=this._invalidationMaskForSource(e);null!==t&&this.invalidate(t)}updateSourcePriceScale(e){const t=this._invalidationMaskForSourcePriceScale(e);null!==t&&this.invalidate(t)}updatePane(e){this.invalidate(this._paneInvalidationMask(e))}insertStudyWithParams(e,t,i,s,o,a,l,c,h,d,u){var p,_;let m=null;if(!o&&void 0!==e.groupingKey){const t=this.findNonOverlayStudyWithGroupingKey(e.groupingKey);null!==t&&(m=t.pane)}null===m&&(o||e.is_price_study?m=(0,n.ensureNotNull)(this.paneForSource(null!==(p=null==a?void 0:a[0])&&void 0!==p?p:this.m_mainSeries)):(m=this.createPane(),void 0!==d&&m.setPaneSize(d))),"Compare@tv-basicstudies"===e.id&&this.m_mainSeries.priceScale().setMode({log:!1,percentage:!0});const g=(0,ie.merge)((0,r.default)(null!=s?s:{}),{inputs:t,parentSources:[]}),f=null!=a?a:[],v=(0,C.prepareStudyProperties)(e,g,m,this.studyVersioning(),f),S=(0,j.createStudy)(this,v,f,e,u)
;this._recalcVisibleRangeStudiesImpl({studies:[S],oldEndVisibleIndex:-1,oldStartVisibleIndex:-1,force:!0,timerId:null});const y=m.findSuitableScale(S,null!==(_=null==a?void 0:a[0])&&void 0!==_?_:this.mainSeries(),l);if(y===this.mainSeries().priceScale()&&(0,pe.isSymbolSource)(S)){const e=c?(0,zi.sourceNewCurrencyOnPinningToPriceScale)(S,y,this,!0):null,t=h?(0,Hi.sourceNewUnitOnPinningToPriceScale)(S,y,this,!0):null;null===e&&null===t||S.setSymbolParams({currency:e||void 0,unit:t||void 0})}return(0,pe.isSymbolSource)(S)&&(0,n.ensureNotNull)(m).hasDataSource(this.mainSeries())&&$i&&!ji.getBool("enable_symbol_labels_on_inserting_compare_once",!1)&&((0,x.saveDefaultProperties)(!0),this.properties().childs().scalesProperties.childs().showSymbolLabels.setValue(!0),(0,x.saveDefaultProperties)(!1),ji.setValue("enable_symbol_labels_on_inserting_compare_once",!0)),S.start(),i&&m.id()===i.paneId?m.insertDataSource(S,y,i.zorder):m.addDataSource(S,y,!1),S.properties().childs().linkedToSeries&&S.properties().childs().linkedToSeries.value()&&S.setOwnerSource(this.mainSeries()),this.recalculatePane(m,(0,W.sourceChangeEvent)(S.id())),this.fullUpdate(),this._invalidateBarColorerCaches(),this._recalcVisibleRangeStudiesImpl({studies:[S],force:!0}),this._recalcColorStudiesImpl({studies:[S],force:!0}),this._studyInserted.fire(S),S.maxOffset().subscribe(this._boundUpdateStudiesMaxOffset,{callWithLast:!0}),S}replaceStudyStub(e,t){const i=this.paneForSource(e);if(null===i)return!1;const s=e.priceScale(),r=e.zorder(),n=e.ownerSource();return this.paneForSource(e)===i?i.replaceSource(e,t,s):(i.insertDataSource(t,s,r),this.removeSource(e)),t.setOwnerSource(n),this.dataSources().forEach((i=>{i.ownerSource()===e&&i.setOwnerSource(t)})),t.start(),this.recalculatePane(i,(0,W.sourceChangeEvent)(t.id())),this.fullUpdate(),!0}insertStudyStub(e){const t=this.mainSeries(),i=(0,n.ensureNotNull)(this.paneForSource(t)),s=new P.StudyStub(this,null,e),r=i.createPriceScaleAtPosition("overlay");return i.addDataSource(s,r,!1),this.recalculatePane(i,(0,W.sourceChangeEvent)(s.id())),this.fullUpdate(),s}removeStudyStub(e){const t=this.dataSourceForId(e);return null===t?(Yi.logNormal("StudyStub id="+e+" is not found in chart model"),!1):(this.removeSource(t),!0)}setHoveredSource(e,t=null){const i=this._hoveredSource!==e;if(!i&&this._lastHoveredHittestData===t)return;this._lastHoveredHittestData=t;let s=null;if(this._hoveredSource){this._hoveredSource.updateAllViews((0,W.selectionChangeEvent)()),s=new K.InvalidationMask(K.InvalidationLevel.Cursor);const e=this._invalidationMaskForSource(this._hoveredSource,K.InvalidationLevel.Light);null!==e&&s.merge(e)}if(this._hoveredSource=e,e){e.updateAllViews((0,W.selectionChangeEvent)()),s||(s=new K.InvalidationMask(K.InvalidationLevel.Cursor));const t=this._invalidationMaskForSource(e,K.InvalidationLevel.Light);null!==t&&s.merge(t)}s&&this.invalidate(s),i&&this._hoveredSourceChanged.fire(e)}properties(){return this._properties}chartApi(){return this._chartApi}disconnect(){this.sessions().stop()
;for(const e of this.dataSources())e.disconnect&&e.disconnect();this._timeScale.disconnect()}crossHairSource(){return this.m_crossHairSource}gridSource(){return this._gridSource}publishedChartsTimelineSource(){return null}hoveredSource(){return this._hoveredSource}hoveredSourceChanged(){return this._hoveredSourceChanged}lastHittestData(){return this._lastHoveredHittestData}lastSelectedHittestData(){return this._lastSelectedHittestData}syncTimeWithModel(e,t){const i=this.mainSeries().syncModel();if(null===i)return;const s=1e3*this.createSyncPoint(e,i.syncSourceTarget()).sourceTimeToTargetTime(t/1e3),r=(0,ht.get_timezone)(this.timezone());let n=(0,ht.utc_to_cal)(r,s);this.mainSeries().isDWM()&&(n=i.getSession().spec.correctTradingDay(n),(0,ht.set_hms)(n,0,0,0,0,(0,ht.get_timezone)("Etc/UTC"))),this._gotoTimeImpl(n.getTime(),{centerIfVisible:!1})}gotoTime(e){return this._gotoTimeImpl(e,{centerIfVisible:!0})}recalculatePane(e,t){null==e||e.recalculate(t)}recalculateAllPanes(e){this._panes.forEach((t=>t.recalculate(e))),this.updateAllPaneViews(e),this.crossHairSource().updateAllViews(e)}gotoTimeRange(e,t){const i=this.timeScale(),s=i.tickMarks(),r=this.mainSeries();if(void 0===s.minIndex)return void(this._lastGotoTimeRange={from:e,to:t});let o=e,a=t;const l=r.symbolInfo();if(null!==l){let i=this.properties().childs().timezone.value();"exchange"===i&&(i=l.timezone);const s=(0,ht.get_timezone)(i),n=(0,ht.utc_to_cal)(s,e),c=(0,ht.utc_to_cal)(s,t);if(r.isDWM()){const e=(0,ht.get_timezone)("Etc/UTC");(0,ht.set_hms)(n,0,0,0,0,e),(0,ht.set_hms)(c,0,0,0,0,e)}o=n.getTime(),a=c.getTime()}const c=(0,n.ensureDefined)(s.maxIndex),h=(0,n.ensureDefined)(s.minIndex);if(o>=(0,n.ensureNotNull)(s.indexToTime(h)).valueOf()||r.endOfData()){const e=(e,t)=>e<t,t=e=>(0,n.ensureNotNull)(s.indexToTime(e)).valueOf(),l=(0,v.lowerboundExt)(t,o,e,s.nearestIndex(o),c);let d=o===a?l:(0,v.lowerboundExt)(t,a,e,s.nearestIndex(a),c);this._lastGotoTimeRange=null,null!==this._lastAppliedGotoTimeRange&&(this._lastAppliedGotoTimeRange.actual=!1);const u=i.baseIndex();if(l+Math.max(d-l+1,i.minVisibleBarCount())>u){const e=i.targetDefaultRightOffset();d-u<e&&(d=u+e)}if(l!==d)i.zoomToBarsRange(l,d),this.lightUpdate();else if(l===h&&r.endOfData())i.zoomToBarsRange(l-1,d),this.lightUpdate();else{const e=((0,n.ensureNotNull)(i.logicalRange()).left()-l+1)*i.barSpacing();this.startScrollTime(0),this.scrollTimeTo(e),this.endScrollTime()}}else{const i={type:"time-range",from:e/1e3,to:t/1e3};null===this._lastAppliedGotoTimeRange?(this._lastAppliedGotoTimeRange={range:i,actual:!0},r.loadDataTo(i)):(0,Tt.areEqualTimeFrames)(this._lastAppliedGotoTimeRange.range,i)||(this._lastGotoTimeRange={from:e,to:t})}}paneForSource(e){if(!(0,f.isDataSource)(e))return Array.from(this._customSourcesMap.values()).includes(e)?this.paneForSource(this.mainSeries()):null;for(let t=this._panes.length-1;t>=0;t--)if(this._panes[t].hasDataSource(e))return this._panes[t];return e instanceof vt.BarsMarksContainer?this.paneForSource(this.mainSeries()):null}mainPane(){
for(const e of this._panes)if(e.isMainPane())return e;throw new Error("Main pane is not found")}lastPane(){return this._panes[this._panes.length-1]}removeSource(e,t){this.selectionMacro((t=>t.removeSourceFromSelection(e)),!0),this._hoveredSource===e&&(this._hoveredSource=null,this._lastHoveredHittestData=null),this._sourcesBeingMoved.includes(e)&&(this._sourcesBeingMoved=this._sourcesBeingMoved.filter((t=>t!==e)),this._sourcesBeingMoved.length||(this._activeItemBeingMoved=null)),e===this._lineBeingEdited&&(this._lineBeingEdited=null,gt.isToolEditingNow.setValue(!1)),e===this._lineBeingCreated&&(this._lineBeingCreated=null,gt.isToolCreatingNow.setValue(!1)),!t&&e.stop&&e.stop();const i=this.detachSource(e),s=this.mainSeries().priceScale();return(0,j.isStudy)(e)&&(0,pe.isActingAsSymbolSource)(e)&&e.priceScale()===s&&s.isPercentage()&&1===s.seriesLikeSources().filter(pe.isActingAsSymbolSource).length&&s.setMode({percentage:!1}),this.fullUpdate(),this._invalidateBarColorerCaches(),(0,j.isStudy)(e)&&((0,_.emit)("study_event",e.id(),"remove"),e.isChildStudy()&&e.parentSources().forEach((t=>t.unsetChild(e))),e.maxOffset().unsubscribe(this._boundUpdateStudiesMaxOffset)),!t&&e.destroy&&e.destroy(),(0,S.isLineTool)(e)&&(e.removeAlert(),(0,_.emit)("drawing_event",e.id(),"remove")),i}allStudies(e){const t=e?e=>(0,j.isStudy)(e)&&!0:j.isStudy;return this._getAllSources(t)}findNonOverlayStudyWithGroupingKey(e,t){const i=void 0!==t?[t]:this._panes;for(const t of i){const i=t.dataSources().find((i=>(0,j.isStudy)(i)&&i.metaInfo().groupingKey===e&&!t.isOverlay(i)));if(void 0!==i)return{pane:t,study:i}}return null}movePaneUp(e){this.movePane(e,e-1)}movePaneDown(e){this.movePane(e,e+1)}movePane(e,t){const i=this._panes[e];this._panes.splice(e,1),this._panes.splice(t,0,i),this._panesCollectionChanged.fire(this._panes),this._onRearrangePanes.fire(),this.invalidate(K.InvalidationMask.panesOrder())}backgroundColor(){return this._backgroundColor}backgroundTopColor(){return this._backgroundTopColor}backgroundColorAtYPercentFromTop(e){const t=this.backgroundColor().value(),i=this.backgroundTopColor().value();if(t===i)return t;if(e=Math.max(0,Math.min(100,Math.round(100*e))),null===this._gradientColorsCache||this._gradientColorsCache.topColor!==i||this._gradientColorsCache.bottomColor!==t)this._gradientColorsCache={topColor:i,bottomColor:t,colors:new Map};else{const t=this._gradientColorsCache.colors.get(e);if(void 0!==t)return t}const s=(0,ft.gradientColorAtPercent)(i,t,e/100);return this._gradientColorsCache.colors.set(e,s),s}backgroundCounterColor(){const e=this.backgroundColor().value();if(void 0===this._lastBackgroundColor||void 0===this._lastOriginalColor||e!==this._lastBackgroundColor){const t=(0,a.rgbToBlackWhiteString)((0,a.parseRgb)(e),150);this._lastBackgroundColor=e,this._lastOriginalColor="black"===t?"white":"black"}return this._lastOriginalColor}isDark(){return"white"===this.backgroundCounterColor()}defaultResolutions(){return this.chartApi().defaultResolutions()}availableCurrencies(){const e=this._getAvailableCurrencies()
;return e.length!==this._availableCurrencies.size()&&(this._availableCurrencies=new bt(e)),this._availableCurrencies}currencyConversionEnabled(){return this._options.currencyConversionEnabled}availableUnits(){const e=this._getAvailableUnits();return this._availableUnits.unitsChanged(e)&&(this._availableUnits=new wt(e)),this._availableUnits}unitConversionEnabled(){return this._options.unitConversionEnabled}availablePriceSources(){const e=this._getAvailablePriceSources();return null!==e&&this._availablePriceSources.priceSourcesChanged(e)&&(this._availablePriceSources=new Gi(e)),this._availablePriceSources}resetDeferredStudies(){ye.instance(this).reset()}isJustClonedChart(){return this._undoModel.isJustClonedChart()}studyTemplate(e,t,i){const s={panes:[],version:this.version()};for(const e of this.panes())s.panes.push(e.state(!0,!1,!0));const r=this.mainSeries();return e&&(s.symbol=r.symbol(),this.currencyConversionEnabled()&&i&&(s.currency=r.currency()),this.unitConversionEnabled()&&i&&(s.unit=r.unit())),t&&(s.interval=r.interval()),s}restoreLineToolState(e,t,i){e.restorePoints(t.points,t.indexes||[]),e.properties().merge(t.state),e.restoreData&&e.restoreData(t),e.linkKey().setValue(t.linkKey||null),e.createServerPoints(),this.fullUpdate();const s=e.linkKey().value();null!==s&&i&&(0,gt.restoreLineToolState)({model:this,linkKey:s,state:t})}preferences(){return(0,Fi.preferencesByWhiteList)(this,this.mainSeries())}restoreTheme(e,t,i){e.mainSourceProperties.hollowCandleStyle||(e.mainSourceProperties.hollowCandleStyle=e.mainSourceProperties.candleStyle),this._undoModel.chartLoadTheme(e,t,i)}onResetScales(){return this._resetScales}startMovingSources(e,t,i,s,r,o){this._sourcesBeingMoved=e,this._activeItemBeingMoved=i;let a=!1;if(this._sourcesBeingMoved.forEach((e=>{!a&&(0,j.isStudy)(e)&&(a=!0);const l=(0,n.ensureNotNull)(this.paneForSource(e)),c=(0,S.isLineTool)(e),h=c&&e.linkKey().value();if(!1!==h&&null!==h&&s.has(h)&&c&&e.isFixed()){const t=(0,n.ensureDefined)(s.get(h)),a={screen:this._percentPositionToPoint(t,l)};e.startMoving(a,i,r,o)}else e.startMoving(t,i,r,o);const d=this._paneInvalidationMask(l,K.InvalidationLevel.Light);this.invalidate(d)})),!o){const s=e.filter(S.isLineTool).filter((e=>e.linkKey().value()&&e.isSynchronizable())).map((e=>e.linkKey().value()));if(s.length&&t.logical){const o=this.externalTimeStamp(t.logical.index),a={linkKeys:s,model:this,symbol:this.mainSeries().symbol(),point:{price:t.logical.price,timeStamp:o},activeItem:null!==i?i:void 0,envState:r,pointPositionPercents:new Map};e.forEach((e=>{if((0,S.isLineTool)(e)){const i=e.linkKey().value();if(i&&e.isSynchronizable()&&e.isFixed()){const s=(0,n.ensureNotNull)(this.paneForSource(e));a.pointPositionPercents.set(i,this._pointToPercentPosition((0,n.ensureDefined)(t.screen),s))}}})),(0,gt.startMovingLineTool)(a)}}gt.isToolMovingNow.setValue(!0),a&&gt.isStudyEditingNow.setValue(!0)}moveSources(e,t,i,s){if(this._sourcesBeingMoved.filter((e=>!e.isLocked||!e.isLocked())).forEach((r=>{const o=(0,S.isLineTool)(r)?r.linkKey().value():null
;if(null!==o&&t.has(o)){const e=(0,n.ensureNotNull)(this.paneForSource(r)),a=(0,n.ensureDefined)(t.get(o)),l={screen:this._percentPositionToPoint(a,e)};r.move(l,this._activeItemBeingMoved,i,s)}else r.move(e,this._activeItemBeingMoved,i,s)})),this.lightUpdate(),!s&&e.logical){const t=this._sourcesBeingMoved.filter(S.isLineTool).filter((e=>e.isSynchronizable()&&!!e.linkKey().value())).map((e=>e.linkKey().value())),s=this.externalTimeStamp(e.logical.index),r={linkKeys:t,model:this,point:{price:e.logical.price,timeStamp:s},envState:i,pointPositionPercents:new Map};this._sourcesBeingMoved.filter(S.isLineTool).forEach((t=>{if(t.linkKey().value()&&t.isSynchronizable()&&t.isFixed()){const i=(0,n.ensureNotNull)(this.paneForSource(t));r.pointPositionPercents.set(t.linkKey().value(),this._pointToPercentPosition((0,n.ensureDefined)(e.screen),i))}})),(0,gt.moveLineTool)(r)}}endMovingSources(e,t,i){const s=this._sourcesBeingMoved.map((s=>{const r=(0,n.ensureNotNull)(this.paneForSource(s)),o=s.endMoving(e,t,i),a=this._paneInvalidationMask(r,K.InvalidationLevel.Light);return a.invalidateAll(K.InvalidationLevel.Light),this.invalidate(a),o})),r=this._sourcesBeingMoved.filter(S.isLineTool).filter((e=>e.isSynchronizable()&&!!e.linkKey().value())).map((e=>e.linkKey().value())),o=this._sourcesBeingMoved.filter(S.isLineTool).filter((e=>e.isSynchronizable()&&!!e.linkKey)).map((e=>{const t={points:e.normalizedPoints(),interval:this.mainSeries().interval()};return e.isFixed()&&(t.pointPositionPercents=e.calcPositionPercents()),t}));r.length&&(0,gt.finishMovingLineTool)({linkKeys:r,model:this,finalStates:o,changes:s}),this._sourcesBeingMoved=[],this._activeItemBeingMoved=null,gt.isToolMovingNow.setValue(!1),gt.isStudyEditingNow.setValue(!1)}sourcesBeingMoved(){return this._sourcesBeingMoved}setMovingCustomSource(e,t){this._customSourceBeingMoved=e,this._customSourceBeingMovedHitTestData=null!==t?{beingMoved:!1,...t}:null}processingCustomSourceMove(){null!==this._customSourceBeingMovedHitTestData&&(this._customSourceBeingMovedHitTestData.beingMoved=!0)}customSourceMovingHitTestData(){return this._customSourceBeingMovedHitTestData}customSourceBeingMoved(){return null!==this._customSourceBeingMovedHitTestData&&this._customSourceBeingMovedHitTestData.beingMoved?this._customSourceBeingMoved:null}width(){return this._width}setWidth(e,t){this._width=e,this._timeScale.setWidth(e,t);for(const t of this._panes)t.setWidth(e);this.recalculateAllPanes((0,W.viewportChangeEvent)()),this.recalcVisibleRangeStudies()}setPaneHeight(e,t){e.setHeight(t),this.recalculateAllPanes((0,W.viewportChangeEvent)()),this.lightUpdate()}isScalesResetAvailableChanged(){return this._isScalesResetAvailableChanged}isScalesResetAvailable(){return this._isScalesResetAvailable}panes(){return this._panes}paneForId(e){return this._panes.find((t=>t.id()===e))||null}createPane(e,t,i){const s=this._undoModel.chartWidget();s.isMaximizedPane()&&s.toggleMaximizePane(null);const r=this._properties.childs().paneProperties;t&&r.merge(t);const n=new Ae(this._timeScale,r,this,i)
;return void 0!==e?this._panes.splice(e,0,n):this._panes.push(n),n.onTagsChanged().subscribe(this,Ji.prototype.onPaneTagsChanged),n.dataSourcesCollectionChanged().subscribe(this,(()=>this._dataSourceCollectionChanged.fire(n))),n.symbolSourceCollectionChanged().subscribe(this,(()=>this._onSymbolSourceCollectionChanged(n))),n.sourcePropertiesChanged().subscribe(this,(e=>this._sourceProperitesChanged.fire(n,e))),n.sourceZOrderChanged().subscribe(this,(e=>this._sourceZOrderChanged.fire(n,e))),n.symbolSourceResolved().subscribe(this,(e=>this._symbolSourceResolved.fire(n,e))),n.symbolSourceResolvingActive().subscribe(this._recalcSymbolResolvingActive),n.collapsed().subscribe(this._recalcPaneCollapsingAvailable),this._recalcPaneCollapsingAvailable(),this._panesCollectionChanged.fire(this._panes),this.invalidate(K.InvalidationMask.panesOrder()),n}removePane(e){const t=this._undoModel.chartWidget();t.isMaximizedPane()&&t.toggleMaximizePane(null);const i=e;i.destroy();const s=this._panes.indexOf(i);-1!==s&&(this._panes.splice(s,1),e.dataSourcesCollectionChanged().unsubscribeAll(this),e.symbolSourceCollectionChanged().unsubscribeAll(this),e.sourcePropertiesChanged().unsubscribeAll(this),e.onTagsChanged().unsubscribeAll(this),e.symbolSourceResolved().unsubscribeAll(this),i.symbolSourceResolvingActive().unsubscribe(this._recalcSymbolResolvingActive),e.collapsed().unsubscribe(this._recalcPaneCollapsingAvailable),this._recalcPaneCollapsingAvailable(!0));this.crossHairSource().pane===e&&this.clearCurrentPosition(),this._panesCollectionChanged.fire(this._panes),this.invalidate(K.InvalidationMask.panesOrder())}changePanesHeight(e,t){if(this._panes.length<2)return;(0,n.assert)(e>=0&&e<this._panes.length,"Invalid pane index");const i=this._panes[e],s=this._panes.reduce(((e,t)=>e+t.stretchFactor()),0),r=this._panes.reduce(((e,t)=>e+t.height()),0),o=r-30*(this._panes.length-1);t=Math.min(o,Math.max(30,t));const a=s/r,l=i.height();i.setStretchFactor(t*a);let c=t-l,h=this._panes.length-1;for(const e of this._panes)if(e!==i){const t=Math.min(o,Math.max(30,e.height()-c/h));c-=e.height()-t,h-=1;const i=t*a;e.setStretchFactor(i)}this.fullUpdate()}clearCurrentPosition(){const e=this.crossHairSource();e.clearPosition(),(0,n.ensureNotNull)(e.dataWindowView()).update(),Zi(this._panes),this.invalidate(K.InvalidationMask.cursor());const t=this._undoModel.chartWidget();t.chartWidgetCollection().syncCrosshair(null,t.id()),this._phantomSourceContainer.onCursorPositionUpdated()}setAndSaveCurrentPosition(e,t,i,s){this.crossHairSource().saveOriginCoords(e,t),this.setCurrentPosition(e,t,i,s)}setCurrentPosition(e,t,i,s){var r,o,a;let l=NaN;const c=this._timeScale.coordinateToVisibleIndex(e),h=null!==(a=null===(o=null!==(r=this._lineBeingEdited)&&void 0!==r?r:this._lineBeingCreated)||void 0===o?void 0:o.priceScale())&&void 0!==a?a:i.defaultPriceScale();let d=null;!h.isEmpty()&&Number.isFinite(t)&&(d=(0,n.ensureNotNull)(i.mainDataSource()).firstValue(),null!==d&&(l=h.coordinateToPrice(t,d)))
;const u=this._crossHairSelectPointMode.value()!==gt.SelectPointMode.None,p=this.currentTool(),_=this.mainSeries(),m=this.crossHairSource(),g=m.index,f=m.price,v=u||gt.isStudyEditingNow.value(),y=h===this.m_mainSeries.priceScale()&&(this._lineBeingCreated||this._lineBeingEdited||(0,S.isLineToolName)(p)||(0,gt.toolIsMeasure)(p)||v);!this._isSettingsExternalPosition&&y?(l=this._magnet.align(l,c,i),null!==d&&this._setCorrectedPositionToCrosshair(c,l,i)):this._magnet.resetLastValue();let b=null;if(isNaN(l)||(b=i),this._isTimeScrolling){if(!this._isSettingsExternalPosition&&u){const e=_.bars().firstIndex(),t=_.bars().lastIndex();if(null!==e&&null!==t){const s=Math.min(Math.max(c,e),t);s!==c&&this._setCorrectedPositionToCrosshair(s,l,i)}}else m.setPosition(m.index,l,b);return}m.setOnHoveredChartWidget(!0),m.setPosition(c,l,b),(0,n.ensureNotNull)(m.dataWindowView()).update(),Zi(this._panes);const w=_.syncModel();if(this.crossHairSource().startMeasurePoint()||this._lineBeingCreated?this.lightUpdate():this.invalidate(K.InvalidationMask.cursor()),this._lineBeingCreated){const e=this._lineBeingCreated.linkKey().value();if(!this._isSettingsExternalPosition){const t=this._lineBeingCreated.setLastPoint({index:c,price:l},s);if(this._lineBeingCreated.updateAllViews((0,W.sourceChangeEvent)(this._lineBeingCreated.id())),t.price===l&&t.index===c||this._setCorrectedPositionToCrosshair(t.index,t.price,i),w&&e){const i=this._timeScale.points().roughTime(t.index,w.projectTime.bind(w));(0,gt.setLineToolLastPoint)({model:this,linkKey:e,point:{timeStamp:(0,n.ensureNotNull)(i),price:t.price}})}}}if(!this._isSettingsExternalPosition&&null!==this._lineBeingEdited&&null!==this._linePointBeingEdited){const e={index:c,price:l};this.changeLinePoint(e,s);const t=this._lineBeingEdited.alignCrossHairToAnchor(this._linePointBeingEdited)?this._lineBeingEdited.getPoint(this._linePointBeingEdited):e;null!==t&&this._setCorrectedPositionToCrosshair(t.index,t.price,i)}if(!this._isSettingsExternalPosition&&v){const e=_.bars().firstIndex(),t=_.bars().lastIndex();if(null!==e&&null!==t){const s=Math.min(Math.max(c,e),t);s!==c&&this._setCorrectedPositionToCrosshair(s,l,i)}}(g!==c||f!==l)&&this._syncCrosshair(s)}setExternalPosition(e,t){let i;const s=this.crossHairSource();if(s.setOnHoveredChartWidget(!1),null!==e&&(0,ie.isNumber)(e.timeStamp)){const t=this.mainSeries().syncModel();if(t){const s=this.createSyncPoint(e.syncSourceTarget,t.syncSourceTarget()).sourceTimeToTargetTime(e.timeStamp);i=this._timeScale.points().roughIndex(s,t.distance.bind(t))}}if(null!==e&&null!=i&&Number.isFinite(i)){this._isSettingsExternalPosition=!0;const r=(0,n.ensureNotNull)(this.paneForSource(this.mainSeries())),o=this._timeScale.indexToCoordinate(i),a=(0,n.ensureNotNull)(r.mainDataSource()).firstValue();if(null!==a){let i=NaN;void 0!==e.price&&Number.isFinite(e.price)&&(i=this.mainSeries().priceScale().priceToCoordinate(e.price,a)),s.clearOriginCoords(),this.setCurrentPosition(o,i,r,t)}return s.setOnHoveredChartWidget(!1),void(this._isSettingsExternalPosition=!1)}s.clearPosition(),
(0,n.ensureNotNull)(s.dataWindowView()).update(),Zi(this._panes),this.invalidate(K.InvalidationMask.cursor())}startScaleTime(e){this._timeScale.startScale(e)}scaleTimeTo(e){this._timeScale.scaleTo(e),this.recalculateAllPanes((0,W.viewportChangeEvent)()),this.lightUpdate(),this._setScalesResetAvailable(!0)}endScaleTime(){this._timeScale.endScale(),this.lightUpdate(),this.recalcVisibleRangeStudies()}resetTimeScale(){this._timeScale.restoreDefault(),this.recalculateAllPanes((0,W.viewportChangeEvent)()),this.recalcVisibleRangeStudies(),this.lightUpdate(),this._resetScales.fire(),this._setScalesResetAvailable(!1)}startScalePrice(e,t,i){e.startScalePrice(t,i)}scalePriceTo(e,t,i){e.scalePriceTo(t,i),this.mainSeries().priceScale().isLockScale()?this.lightUpdate():this.invalidate(this._paneInvalidationMask(e,K.InvalidationLevel.Light)),this._setScalesResetAvailable(!0)}endScalePrice(e,t){e.endScalePrice(t),this.invalidate(this._paneInvalidationMask(e,K.InvalidationLevel.Light))}startTwoPointsScalePrice(e,t,i,s){t.startTwoPointsScale(i,s)}twoPointsScalePriceTo(e,t,i,s){t.twoPointsScale(i,s),this.invalidate(this._paneInvalidationMask(e)),this._setScalesResetAvailable(!0)}endTwoPointsScalePrice(e,t){t.endTwoPointsScale(),this.invalidate(this._paneInvalidationMask(e))}resetPriceScale(e,t){this._setScalesResetAvailable(!1),e.resetPriceScale(t),this.invalidate(this._paneInvalidationMask(e,K.InvalidationLevel.Light))}restorePriceScaleState(e,t,i){e.restorePriceScaleState(t,i),this.invalidate(this._paneInvalidationMask(e,K.InvalidationLevel.Light))}currentTool(){return this._currentTool}setCurrentTool(e){this._currentTool!==e&&((0,S.isLineToolName)(e)&&this.selectionMacro((e=>{e.clearSelection()})),this._currentTool=e,this._phantomSourceContainer.onToolChanged())}detachSource(e){const t=this.paneForSource(e);return!!t&&(t.removeDataSource(e),t.isEmpty()?(this._lineBeingCreated&&t===this._paneBeingCreatedLineOn&&this.cancelCreatingLine(),this.removePane(t),!0):(this.fullUpdate(),!1))}children(e,t){return this.dataSources().filter((i=>(0,j.isStudy)(i)?!t&&i.parentSources().includes(e):i.ownerSource()===e))}onRearrangePanes(){return this._onRearrangePanes}finishLineTool(e){const t=e.linkKey().value();(0,gt.drawOnAllCharts)().value()&&null!==t&&e.isSynchronizable()&&(0,gt.finishLineTool)({linkKey:t,model:this})}startChangingLinetool(e,t,i,s,r){this._lineBeingEdited=e,this._linePointBeingChanged=t||null,this._linePointBeingEdited=void 0===i?null:i,this._lineBeingEdited.startChanging(i,t,r),gt.isToolEditingNow.setValue(!0);const o=(0,n.ensureNotNull)(this.paneForSource(e));this._lineBeingEdited.startDragPoint&&void 0!==i&&void 0!==t&&this._lineBeingEdited.startDragPoint(i,t),r||void 0===i||void 0===t||this._lineBeingEdited.setPoint(i,t,s,r),this._lineBeingEdited.updateAllViews((0,W.sourceChangeEvent)(this._lineBeingEdited.id()));const a=this._paneInvalidationMask(o,K.InvalidationLevel.Light);this.invalidate(a);const l=e.linkKey().value();if(l&&e.isSynchronizable()&&void 0!==i&&void 0!==t){const e=(0,
n.ensureNotNull)(this.externalTimeStamp(t.index));(0,gt.startChangingLineTool)({linkKey:l,model:this,symbol:this.mainSeries().symbol(),point:{price:t.price,timeStamp:e},pointIndex:i,envState:s||null})}}createLineTool(e,t,i,s,r,a,l){if((0,n.assert)((0,S.isLineToolName)(i),`Cannot create unknown line tool: ${i}`),s){const e={...Wi.intervalsVisibilitiesDefaults},t=s.childs().intervalsVisibilities.state();(0,ie.merge)(e,null!=t?t:{});const r=s.state();r.intervalsVisibilities=e,s=(0,S.createLineToolProperties)(i,r,this)}const c=(0,S.createLineTool)(i,this,s,null,void 0,l);if("LineToolExecution"!==i){let e;switch(i){case"LineToolIcon":e=c.properties().childs().icon.value().toString(16).toUpperCase();break;case"LineToolEmoji":e=c.properties().childs().emoji.value()}(0,u.trackEvent)("drawings","Study_Drawing_"+i,e)}const h=!c.linkKey().value()&&!r;a=(0,n.ensureDefined)(a||(0,n.ensureNotNull)(e.mainDataSource())),s||(0,S.prepareLineToolPropertiesByOwnerSource)(c.properties(),a),c.setOwnerSource(a);const d=a.priceScale();if(e.addDataSource(c,d,!1),(0,gt.drawOnAllCharts)().value()){const e=c.isSynchronizable()?r||(0,J.randomHash)():null;c.linkKey().setValue(e)}else c.linkKey().setValue(r);let p;if(c.isFixed()){const i=(0,n.ensureNotNull)((0,n.ensureNotNull)(e.mainDataSource()).firstValue()),s=this._timeScale.indexToCoordinate(t.index),r=(0,n.ensureNotNull)(d).priceToCoordinate(t.price,i);p=c.addFixedPoint(new o.Point(s,r))}else p=c.addPoint(t);return p||(this._lineBeingCreated=c,this._paneBeingCreatedLineOn=e,gt.isToolCreatingNow.setValue(!0)),h&&c.enableCurrentIntervalVisibility(),this.fullUpdate(),c}endChangingLinetool(e,t){const i=(0,n.ensureNotNull)(this._lineBeingEdited),s=i.endChanging(!1,e,t);this._lineBeingEdited=null,gt.isToolEditingNow.setValue(!1),this._linePointBeingEdited=null,this._linePointBeingChanged=null,this.lightUpdate();const r={points:i.normalizedPoints(),interval:this.mainSeries().interval()},o=i.linkKey().value();null!==o&&i.isSynchronizable()&&!t&&(0,gt.finishChangingLineTool)({model:this,linkKey:o,symbol:this.mainSeries().symbol(),finalState:r,changes:s})}continueCreatingLine(e,t,i,s){const r=(0,n.ensureNotNull)(this._lineBeingCreated),o=r.addPoint(e,t,i);r.updateAllViews((0,W.sourceChangeEvent)(r.id()));const a=new K.InvalidationMask(K.InvalidationLevel.Light);return o&&(this._paneBeingCreatedLineOn=null,this._lineBeingCreated=null,gt.isToolCreatingNow.setValue(!1)),this.invalidate(a),o}cancelCreatingLine(){if(!this._lineBeingCreated)return;const e=this._lineBeingCreated;this.removeSource(this._lineBeingCreated),this._lineBeingCreated=null,this._lineCancelled.fire(),gt.isToolCreatingNow.setValue(!1),(0,gt.drawOnAllCharts)().value()&&e.isSynchronizable()&&(0,gt.cancelLineTool)({model:this})}lineBeingCreated(){return this._lineBeingCreated}paneBeingCreatedLineOn(){return this._paneBeingCreatedLineOn}lineCancelled(){return this._lineCancelled}isPhantomLine(e){return this._phantomSourceContainer.source()===e}changeLinePoint(e,t,i){const s=(0,n.ensureNotNull)(this._lineBeingEdited),r=(0,
n.ensureNotNull)(this._linePointBeingEdited);let o=e.price,a=e.index;if(s.setPoint(r,e,t,i),!i){const t=s.alignCrossHairToAnchor(r)?s.getPoint(r):e;null!==t&&(a=t.index,o=t.price)}s.updateAllViews((0,W.sourceChangeEvent)(s.id())),this.lightUpdate();const l=s.linkKey().value();if(!i&&null!==l&&s.isSynchronizable()){const e=(0,n.ensureNotNull)(this._linePointBeingChanged),i={indexesChanged:a!==e.index,pricesChanged:o!==e.price},c=s.getChangePointForSync(r);if(null!==c){const e=this.externalTimeStamp(a);null!==e&&(o=c.price,(0,gt.changeLineTool)({linkKey:l,model:this,symbol:this.mainSeries().symbol(),point:{price:o,timeStamp:e},envState:t,changes:i}))}}}changeLinePoints(e,t,i){const s=e.points(),r=e.linkKey().value();!i&&r&&e.isSynchronizable()&&t.forEach(((t,i)=>{const o=s[i],a=o.price!==t.price,l=o.index!==t.index;if(e.getChangePointForSync(i)){const e=(0,n.ensureNotNull)(this.externalTimeStamp(t.index));(0,gt.changeLineTool)({linkKey:r,model:this,symbol:this.mainSeries().symbol(),point:{price:t.price,timeStamp:e},changes:{pricesChanged:a,indexesChanged:l}})}})),e.setPoints(t),e.updateAllViews((0,W.sourceChangeEvent)(e.id())),this.lightUpdate()}startScrollTime(e){this._timeScale.startScroll(e),this._isTimeScrolling=!0,this.mainSeries().clearGotoDateResult()}scrollTimeTo(e){this._timeScale.scrollTo(e),this.recalculateAllPanes((0,W.viewportChangeEvent)()),this.lightUpdate(),this._setScalesResetAvailable(!0)}endScrollTime(){this._timeScale.endScroll(),this.lightUpdate(),this.recalcVisibleRangeStudies(),this._isTimeScrolling=!1}startScrollPrice(e,t,i){e.startScrollPrice(t,i)}scrollPriceTo(e,t,i){e.scrollPriceTo(t,i),this.invalidate(this._paneInvalidationMask(e,K.InvalidationLevel.Light))}endScrollPrice(e,t){e.endScrollPrice(t),this.invalidate(this._paneInvalidationMask(e,K.InvalidationLevel.Light))}addCustomSource(e,t,i=g.CustomSourceLayer.Foreground){this._customSourcesMap.has(e)&&Yi.logWarn(`Attempt to add the same custom source multiple time "${e}"`),Yi.logNormal(`Adding custom source "${e}"`);const s=t(e,this);switch(i){case g.CustomSourceLayer.Background:this._bgCustomSources.push(s);break;case g.CustomSourceLayer.Foreground:this._fgCustomSources.push(s);break;case g.CustomSourceLayer.Topmost:this._topmostCustomSources.push(s);break;default:throw new Error(`Unknown custom sources layer ${i}`)}this._allCustomSources.push(s),this._customSourcesMap.set(e,s),this.lightUpdate()}removeCustomSource(e){this._removeCustomSource(e),this.lightUpdate()}hasCustomSource(e){return this._customSourcesMap.has(e)}customSourceForName(e){return this._customSourcesMap.get(e)||null}customSourceName(e){let t=null;return this._customSourcesMap.forEach(((i,s)=>{i===e&&(t=s)})),t}customSources(e){switch(e){case g.CustomSourceLayer.Background:return this._bgCustomSources;case g.CustomSourceLayer.Foreground:return this._fgCustomSources;case g.CustomSourceLayer.Topmost:return this._topmostCustomSources;default:return this._allCustomSources}}addMultiPaneSource(e){this._multiPaneSources.push(e),this.lightUpdate()}removeMultiPaneSource(e){
const t=this._multiPaneSources.indexOf(e);-1===t?Yi.logWarn("Attempt to remove multi-pane source which does not exist in the model"):this._multiPaneSources.splice(t,1),this.lightUpdate()}multiPaneSources(e){return this._multiPaneSources.filter((t=>!e.hasDataSource(t)))}magnet(){return this._magnet}dateTimeFormatter(){return this._dateTimeFormatter}dateFormatter(){return this._dateFormatter}timeFormatter(){return this._timeFormatter}isUnmergeAvailableForSource(e){if(!this._unmergeAvailable(e))return!1;return(0,n.ensureNotNull)(this.paneForSource(e)).dataSources().filter(this._unmergeAvailable,this).length>1}isMergeDownAvailableForSource(e){if(!this._unmergeAvailable(e))return!1;const t=this.paneForSource(e),i=this.panes();return t!==i[i.length-1]}isMergeUpAvailableForSource(e){if(!this._unmergeAvailable(e))return!1;return this.paneForSource(e)!==this.panes()[0]}sessions(){return(0,n.ensureNotNull)(this._sessions)}createSessions(e){(0,n.assert)(null===this._sessions,"Sessions are already created"),this.addCustomSource("sessions",((t,i)=>(this._sessions=new U(t,i,e),this._sessions.start(),this._sessions)),g.CustomSourceLayer.Background)}createPrePostMarket(e){this.addCustomSource("prePostMarket",((t,i)=>new PrePostMarket(t,i,e)))}replayStatus(){return this._replayStatus}setReplayStatus(e){this._replayStatus.setValue(e)}theme(){const e=this.properties().childs().paneProperties.state();delete e.topMargin,delete e.bottomMargin;const t=this.mainSeries().state().state;t&&(delete t.symbol,delete t.interval,delete t.currencyId,delete t.unitId);const i={mainSourceProperties:t,sessions:this.sessions().properties().state(),chartProperties:{paneProperties:e,scalesProperties:this.properties().childs().scalesProperties.state()},version:this.version()};return i.version=this.version(),i}onChartThemeLoaded(){return this._chartThemeLoaded}chartThemeLoaded(){this._chartThemeLoaded.fire()}state(e,t,i,s){var r;const n=this.publishedChartsTimelineSource(),o=this.properties().childs(),a=o.tradingProperties.state(),l={panes:this._panes.map((r=>r.state(!0,e,!1,t,i,s))),timeScale:this._timeScale.state(e),chartProperties:{paneProperties:o.paneProperties.state(),scalesProperties:o.scalesProperties.state(),publishedChartsTimelineProperties:n?n.state(e):void 0,chartEventsSourceProperties:null===(r=o.chartEventsSourceProperties)||void 0===r?void 0:r.state(),tradingProperties:a,priceScaleSelectionStrategyName:o.priceScaleSelectionStrategyName.value()},sessions:this.sessions().state(e),version:this.version(),timezone:this.timezone(),shouldBeSavedEvenIfHidden:this._shouldBeSavedEvenIfHidden};return s||(l.lineToolsGroups=this.lineToolsGroupModel().state(t)),l}restoreState(e,t,i){ye.instance(this).reset();const s={};if(!e.panes)return void Yi.logDebug("ChartModel.restoreState: invalid state");if(!Array.isArray(e.panes))return void Yi.logDebug("ChartModel.restoreState: invalid state");if(e.panes.length<1)return void Yi.logDebug("ChartModel.restoreState: invalid state");for(const e of this._barsMarksSources)this.detachSource(e)
;if(this._shouldBeSavedEvenIfHidden=void 0===e.shouldBeSavedEvenIfHidden||e.shouldBeSavedEvenIfHidden,e.chartProperties&&!e.chartProperties.timezone&&(e.chartProperties.timezone=e.timezone),e.chartProperties){const i=(0,V.factoryDefaults)("chartproperties").scalesProperties;(0,ie.merge)(i,e.chartProperties.scalesProperties),!("showLastValue"in i)||"showSeriesLastValue"in i||"showStudyLastValue"in i||(i.showSeriesLastValueProperty=i.showLastValue,i.showStudyLastValueProperty=i.showLastValue),"showSeriesLastValue"in i&&(s.showSeriesLastValueProperty=!0),"showStudyLastValue"in i&&(s.showStudyLastValueProperty=!0),(!this.isSnapshot()&&!this.readOnly()&&"showCurrency"in i||"showUnit"in i)&&((0,Z.migrateShowCurrencyAndShowUnitProperties)(i.showCurrency,i.showUnit),delete i.showCurrency,delete i.showUnit),e.chartProperties.paneProperties.vertGridProperties=e.chartProperties.paneProperties.vertGridProperties||(0,ie.clone)(e.chartProperties.paneProperties.gridProperties),e.chartProperties.paneProperties.horzGridProperties=e.chartProperties.paneProperties.horzGridProperties||(0,ie.clone)(e.chartProperties.paneProperties.gridProperties),"backgroundType"in e.chartProperties.paneProperties||(e.chartProperties.paneProperties.backgroundType=St.ColorType.Solid),"separatorColor"in e.chartProperties.paneProperties||(e.chartProperties.paneProperties.separatorColor=(0,d.getThemedColor)("color-chart-page-bg")),this._properties.childs().paneProperties.mergeAndFire(e.chartProperties.paneProperties),this._properties.childs().scalesProperties.mergeAndFire(i),e.chartProperties.timezone&&this._properties.childs().timezone.setValue(e.chartProperties.timezone),e.chartProperties.chartEventsSourceProperties&&this._properties.hasChild("chartEventsSourceProperties")&&this._properties.childs().chartEventsSourceProperties.mergeAndFire(e.chartProperties.chartEventsSourceProperties),e.chartProperties.tradingProperties&&this._properties.hasChild("tradingProperties")&&(void 0===e.chartProperties.tradingProperties.horizontalAlignment&&(e.chartProperties.tradingProperties.horizontalAlignment=(r=e.chartProperties.tradingProperties.lineLength)<=40?g.TradedGroupHorizontalAlignment.Right:r>=60?g.TradedGroupHorizontalAlignment.Left:g.TradedGroupHorizontalAlignment.Center),this._properties.childs().tradingProperties.mergeAndFire(e.chartProperties.tradingProperties)),this._timeScale.restoreState(e.timeScale,t),this._updateDateTimeFormatter()}var r;if(e.timeScale&&this._timeScale.restoreState(e.timeScale,t),!this.readOnly()){const t=this._getExceedingChildStudies(e.panes);if(t.length){for(let i=e.panes.length-1;i>=0;--i){const s=e.panes[i];for(let e=s.sources.length-1;e>=0;--e){const i=s.sources[e];~t.indexOf(i)&&s.sources.splice(e,1)}s.sources.length||e.panes.splice(i,1)}0}}const n=e.version||0,o=e.panes;let a="_seriesId";for(const e of o){const t=e.sources.find((e=>"MainSeries"===e.type));if(t){a=t.id;break}}this.panes()[0].restoreState(o[0],t,n,a,s,i,!0);let l=1;for(let r=1;r<e.panes.length;r++){const o=e.panes[r];if(0===o.sources.length){
Yi.logWarn("Empty pane detected - restoring is skipped. idx="+r+", state="+JSON.stringify(o));continue}const c=this.panes()[l]||this.createPane();c.restoreState(o,t,n,a,s,i,!0),c.mainDataSource()?l+=1:this.removePane(c)}this._invalidateBarColorerCaches();const c=this.dataSources();let h=0;for(let e=0;e<c.length;e++){const t=c[e];(0,S.isLineTool)(t)&&(h++,t.calcIsActualSymbol())}this.updateTimeScaleBaseIndex(),this.recalculateAllPanes((0,W.globalChangeEvent)()),this.fullUpdate(),this.syncLollipopSources();const u=this.mainPane();for(const e of this._barsMarksSources)this.detachSource(e),u.addDataSource(e,this.m_mainSeries.priceScale(),!0);let p=m.TVLocalStorage.getItem("linetools_limit")||1e3;return window.is_authenticated&&window.user&&window.user.settings&&(p=window.user.settings.linetools_limit||p),e.sessions&&this.sessions().restoreState(e.sessions,t),e.lineToolsGroups&&(this._lineToolsGroupModel=lt.fromState(this,e.lineToolsGroups)),h>p&&h%100==0?{lines_limit_exceeded:!0,line_tools_count:h}:(this.panes().forEach((e=>this._dataSourceCollectionChanged.fire(e))),this._lineToolsGroupModel.fireChangedAll(),{})}shouldBeSavedEvenIfHidden(){return this._shouldBeSavedEvenIfHidden}setShouldBeSavedEvenIfHidden(e){this._shouldBeSavedEvenIfHidden=e}externalTimeStamp(e){const t=this.mainSeries().syncModel();return this.timeScale().points().roughTime(e,t&&t.projectTime.bind(t))}syncLollipopSources(){null!==this._lollipopSourcesWatcher&&this._lollipopSourcesWatcher.syncSources()}restoreChartEvents(e){null!==this._lollipopSourcesWatcher&&this._options.chartEventsEnabled&&this._lollipopSourcesWatcher.restoreChartEvents(e)}recalcVisibleRangeStudies(e){this._recalcVRStudiesParams.force=this._recalcVRStudiesParams.force||Boolean(e),this._recalcVisibleRangeStudiesImplDebounced()}recalcColorStudies(e){this._recalcColorStudiesParams.force=this._recalcColorStudiesParams.force||Boolean(e),this._recalcColorStudiesImplDebounced()}recalcStudyBasedLineTools(){this.dataSources().forEach((e=>{(0,S.isStudyLineTool)(e)&&e.recalcStudyIfNeeded()}))}alertsWatcher(){return this._alertsWatcher}showLegend(){return this._showLegendProperty}id(){return this._id}selectPointMode(){return this._crossHairSelectPointMode}recalculatePriceRangeOnce(){const e=this.mainSeries();for(const t of this._panes)for(const i of t.priceDataSources())i.symbolSource()===e&&i.disablePriceRangeReady()}invalidate(e){var t;null===(t=this._invalidateHandler)||void 0===t||t.call(this,e)}appliedTimeFrame(){return this._appliedTimeFrame.appliedTimeFrame()}barsMarksSources(){return this._barsMarksSources}createSyncPoint(e,t){return(0,Oi.getDefault2Lazy)(this._syncPointCache,e.uniqueId,t.uniqueId,(()=>new mt(e,t)))}isAutoSaveEnabled(){return this._isAutoSaveEnabled}studyAwareDefaultRightOffset(){return this._timeScale.usePercentageRightOffset().value()?this._timeScale.percentsToBarIndexLength(this.studyAwareDefaultRightOffsetPercentage()):Math.max(this._timeScale.defaultRightOffset().value(),this._cachedStudiesMaxOffset)}studyAwareDefaultRightOffsetPercentage(){
return this._timeScale.usePercentageRightOffset().value()?Math.max(this._timeScale.defaultRightOffsetPercentage().value(),this._timeScale.barIndexLengthToPercents(this._cachedStudiesMaxOffset)):this._timeScale.barIndexLengthToPercents(this.studyAwareDefaultRightOffset())}clearAllStudies(){this.dataSources().forEach((e=>{var t;return null===(t=e.clearData)||void 0===t?void 0:t.call(e)}))}setTimeScaleAnimation(e){const t=K.InvalidationMask.light();t.setTimeScaleAnimation(e),this.invalidate(t)}stopTimeScaleAnimation(){const e=K.InvalidationMask.light();e.stopTimeScaleAnimation(),this.invalidate(e)}lollipopSourcesOptions(){const e=this._options;return{chartEventsEnabled:!this._options.isSnapshot&&this._options.chartEventsEnabled,esdEnabled:e.esdEnabled,continuousContractSwitchesEnabled:e.continuousContractSwitchesEnabled,futuresContractExpirationEnabled:e.futuresContractExpirationEnabled,newsEnabled:e.newsEnabled}}_initAlertsList(){throw new Error("Not implemented")}_updateStudiesMaxOffset(){const e=Math.max(...this.allStudies().map((e=>e.maxOffset().value())));this._cachedStudiesMaxOffset=e;const t=this._timeScale.rightOffset();t<0||this._timeScale.setRightOffset(Math.max(t,e))}_updateBaseIndex(e,t){const i=this._timeScale,s=i.baseIndex(),r=i.visibleBarsStrictRange(),n=i.logicalRange();if(null!==n&&t){const t=n.contains(s),o=e-s;let a=t?null:i.rightOffset()-o;if(!this._options.shiftVisibleRangeOnNewBar&&t){const e=i.indexToCoordinate(s)+i.barSpacing()/2+1,t=s-n.left()+o,l=e/t;if(l>=i.minBarSpacing()){i.setBarSpacing(l);a=i.width()/l-t}else(null==r?void 0:r.lastBar())!==s&&(a=i.rightOffset()-o)}null!==a&&i.setRightOffset(a)}i.setBaseIndex(e)}_createLollipopSourcesWatcher(){}_updateDateTimeFormatter(){const e=ot.dateFormatProperty.value(),t=void 0;if(this._dateFormatter=new nt.DateFormatter(e,t),this.mainSeries().isDWM())this._dateTimeFormatter=new nt.DateFormatter(e,t),this._timeFormatter=new Ke.TimeFormatter((0,Ze.getHourMinuteFormat)(Ye.timeHoursFormatProperty.value()));else{const i=T.Interval.parse(this.mainSeries().interval()),s=(0,Ze.getTimeFormatForInterval)(i,Ye.timeHoursFormatProperty.value());this._dateTimeFormatter=new rt.DateTimeFormatter({dateFormat:e,withWeekday:t,timeFormat:s,dateTimeSeparator:"   "}),this._timeFormatter=new Ke.TimeFormatter(s)}}_setScalesResetAvailable(e){this._isScalesResetAvailable!==e&&(this._isScalesResetAvailable=e,this._isScalesResetAvailableChanged.fire())}_invalidationMaskForSource(e,t=K.InvalidationLevel.Light){if(e===this.crossHairSource())return K.InvalidationMask.cursor();if(this._watermarkSource===e)return this._paneInvalidationMask((0,n.ensureNotNull)(this.paneForSource(this.mainSeries())),t);if(-1!==this._allCustomSources.indexOf(e)){const e=new K.InvalidationMask;return e.invalidateAll(t),e}if(!(0,f.isDataSource)(e))return null;if(e.isMultiPaneEnabled())return new K.InvalidationMask(t);const i=this.paneForSource(e);return null!==i?this._paneInvalidationMask(i,t):null}_paneInvalidationMask(e,t=K.InvalidationLevel.Light){const i=new K.InvalidationMask,s=this._panes.indexOf(e)
;return i.invalidateAllPane(s,t),i}_invalidationMaskForSourcePriceScale(e,t=K.InvalidationLevel.Light){if(!(0,f.isDataSource)(e))return new K.InvalidationMask(t);const i=this.paneForSource(e);if(null===i)return null;let s=e.priceScale();if(null===s)return null;const r=this._panes.indexOf(i);let n=i.priceScalePosition(s);if("overlay"===n){const e=this._panes[r].defaultPriceScale();s=e,n=i.priceScalePosition(e)}const o=i.priceScaleIndex(s,n);if(void 0===o)return null;const a=new K.InvalidationMask;return a.invalidatePriceScale(r,n,o,t),a}_removeCustomSource(e){const t=this._customSourcesMap.get(e);if(void 0===t)return void Yi.logWarn(`Attempt to remove custom source which does not exist in the model - "${e}"`);Yi.logNormal(`Removing custom source "${e}"`),this.selectionMacro((e=>{e.removeSourceFromSelection(t)})),this._hoveredSource===t&&this.setHoveredSource(null),this._customSourceBeingMoved===t&&this.setMovingCustomSource(null,null);const i=Ki(this._bgCustomSources,t),s=Ki(this._fgCustomSources,t),r=Ki(this._topmostCustomSources,t),o=Ki(this._allCustomSources,t);(0,n.assert)(i||s||r,"Source should be presented in one of the layers"),(0,n.assert)(o,"Source should be presented in the array"),this._customSourcesMap.delete(e),t.destroy()}_updateShowLegendProperty(){const e=this._properties.childs().paneProperties.childs().legendProperties.childs().showLegend,t=this._showLegendProperty;if(e.value())t.setValue(!0);else{for(const e of this._panes){let i=0;for(const s of e.priceDataSources())if(s!==this.mainSeries()&&null!==s.statusView()&&(i++,i>1))return void t.setValue(!1)}t.setValue(!0)}}_pointToPercentPosition(e,t){return{x:e.x/this._timeScale.width(),y:e.y/(0,n.ensureNotNull)((0,n.ensureNotNull)(t.mainDataSource()).priceScale()).height()}}_percentPositionToPoint(e,t){const i=e.x*this._timeScale.width(),s=e.y*(0,n.ensureNotNull)((0,n.ensureNotNull)(t.mainDataSource()).priceScale()).height();return new o.Point(i,s)}_recalcVisibleRangeStudiesImpl(e){var t,i,s;if(e.timerId=null,this.timeScale().isEmpty())return;const r=this.timeScale().visibleBarsStrictRange();if(null===r)return;const n=this.mainSeries().bars(),o=n.search(r.firstBar(),Je.PlotRowSearchMode.NearestRight),a=n.search(r.lastBar(),Je.PlotRowSearchMode.NearestLeft),l=n.lastIndex(),c=o?o.index:void 0,h=a?a.index:void 0,d=c===e.oldStartVisibleIndex,u=h===e.oldEndVisibleIndex;if(d&&u&&!e.force)return;e.force=!1,e.oldStartVisibleIndex=void 0!==c?c:NaN,e.oldEndVisibleIndex=void 0!==h?h:NaN;const p={first_visible_bar_time:1e3*(null!==(t=null==o?void 0:o.value[0])&&void 0!==t?t:0),last_visible_bar_time:1e3*(null!==(i=null==a?void 0:a.value[0])&&void 0!==i?i:0),subscribeRealtime:(null==a?void 0:a.index)===l},_=null!==(s=e.studies)&&void 0!==s?s:this.priceDataSources();e.studies=void 0;for(const e of _)if((0,j.isStudy)(e)){const t=e.metaInfo().inputs,i=[];for(const e of t)p.hasOwnProperty(e.id)&&i.push(e.id);const s=e.properties().childs().inputs;for(const e of i)s.childs()[e].setValueSilently(p[e]);i.length>0&&s.listeners().fire(s)}}_recalcColorStudiesImpl(e){var t
;e.timerId=null;const i=this.backgroundColorAtYPercentFromTop(.5),s=this.isDark()?l.colorsPalette["color-cold-gray-200"]:l.colorsPalette["color-cold-gray-900"],r=i===e.oldBgColor,n=s===e.oldFgColor;if(r&&n&&!e.force)return;e.force=!1,e.oldBgColor=i,e.oldFgColor=s;const o={__chart_bgcolor:i,__chart_fgcolor:s},a=null!==(t=e.studies)&&void 0!==t?t:this.priceDataSources();e.studies=void 0;for(const e of a)if((0,j.isStudy)(e)){const t=e.metaInfo().inputs,i=[];for(const e of t)o.hasOwnProperty(e.id)&&i.push(e.id);const s=e.properties().childs().inputs;for(const e of i)s.childs()[e].setValueSilently(o[e]);i.length>0&&s.listeners().fire(s)}}_getAllSources(e){const t=[];for(const i of this._panes){const s=i.sourcesByGroup().all();for(const i of s)e(i)&&t.push(i)}return t}_invalidateBarColorerCaches(){this.mainSeries().invalidateBarColorerCache()}_addAlertLabelToChart(e){throw new Error("Not implemented")}_removeAlertLabelFromChart(e){throw new Error("Not implemented")}_removeAllAlertLabelsFromChart(){throw new Error("Not implemented")}_updateTimeScale(e){var t,i,s,r;const{index:n,zoffset:o,values:a,indexDiffs:l,baseIndex:c,marks:h,clearFlag:d}=e;if(d){this._timeScale.reset();for(const e of this.dataSources())null===(t=e.clearData)||void 0===t||t.call(e)}if(l.length>0)for(const e of this.dataSources())null===(i=e.moveData)||void 0===i||i.call(e,l);const u=this._timeScale.indexToTimePoint(this._timeScale.baseIndex()),p=this._timeScale.canNormalize();this._timeScale.update(n,o,a,h);const _=this._timeScale.points().range().value();let m="ChartModel.prototype._updateTimeScale("+n+","+o+","+a.length+","+l.length+","+h.length+","+d+")";if(m+="TimeScale: {first:"+(null!==(s=null==_?void 0:_.firstIndex)&&void 0!==s?s:null)+",last:"+(null!==(r=null==_?void 0:_.lastIndex)&&void 0!==r?r:null)+"}",null===c){this._timeScale.resetBaseIndex();const e=this._timeScale.rightOffset();e<0?this._timeScale.setRightOffset(this.studyAwareDefaultRightOffset()):this._timeScale.setRightOffset(Math.max(e,this._cachedStudiesMaxOffset))}else if(void 0!==c){const e=this._timeScale.indexToTimePoint(c),t=null!==u&&null!==e&&e>u;this._updateBaseIndex(c,t)}if(Yi.logDebug(m),!p&&p!==this._timeScale.canNormalize())for(const e of this.dataSources())!(0,S.isLineTool)(e)||e.isFixed()||e.isSourceHidden()||e.processHibernate();this.recalculateAllPanes((0,W.globalChangeEvent)()),this.lightUpdate()}_getAvailableCurrencies(){return!this.currencyConversionEnabled()||this.isSnapshot()?[]:(0,ie.isArray)(this._availableCurrenciesList)?this._availableCurrenciesList:(null!==this._availableCurrenciesList||(this._availableCurrenciesList=this.chartApi().availableCurrencies(),this._availableCurrenciesList.then((e=>{this._destroyed||(this._availableCurrenciesList=e,this.fullUpdate())})).catch((e=>{Yi.logWarn(`An error occurred while getting currencies config: ${e}`)}))),[])}_getAvailableUnits(){
return!this.unitConversionEnabled()||this.isSnapshot()?{}:this._availableUnitsObject instanceof Promise||null===this._availableUnitsObject?(null!==this._availableUnitsObject||(this._availableUnitsObject=this.chartApi().availableUnits(),this._availableUnitsObject.then((e=>{this._destroyed||(this._availableUnitsObject=e,this.fullUpdate())})).catch((e=>{Yi.logWarn(`An error occurred while getting units config: ${e}`)}))),{}):this._availableUnitsObject}_getAvailablePriceSources(){return Array.isArray(this._availablePriceSourcesList)?this._availablePriceSourcesList:(this._availablePriceSourcesList=this.chartApi().availablePriceSources(),this._availablePriceSourcesList.then((e=>{this._destroyed||(this._availablePriceSourcesList=e,this.fullUpdate())})).catch((e=>{Yi.logWarn(`An error occurred while getting price sources config: ${e}`)})),[])}_getBackgroundColor(e){const t=this._properties.childs().paneProperties.childs();if(t.backgroundType.value()===St.ColorType.Gradient){const i=t.backgroundGradientStartColor.value(),s=t.backgroundGradientEndColor.value();return e?i:s}return t.background.value()}_updateBackgroundColor(){this._backgroundColor.setValue(this._getBackgroundColor()),this._backgroundTopColor.setValue(this._getBackgroundColor(!0))}_syncCrosshair(e){if(!this._isSettingsExternalPosition){const t=this._undoModel.chartWidget(),i=this._undoModel.mainSeries(),s=i.syncModel(),r=this._undoModel.crossHairSource(),n=r.pane;if(null!==s&&null!==n){const o={timeStamp:this._timeScale.points().roughTime(r.index,s.projectTime.bind(s)),syncSourceTarget:s.syncSourceTarget()};n.mainDataSource()===i&&(o.price=r.price,o.symbol=i.symbol());let a=this._lineBeingCreated||null!==this._linePointBeingEdited||Boolean(this._sourcesBeingMoved.length);a=a&&(0,gt.drawOnAllCharts)().value(),t.chartWidgetCollection().syncCrosshair(o,t.id(),a,e)}this._phantomSourceContainer.onCursorPositionUpdated()}}_gotoTimeImpl(e,t){const i=this.timeScale(),s=this.mainSeries();let r;if(void 0!==e){if(this._scrollingState&&this._scrollingState.deferred.reject(),r=(0,p.createDeferredPromise)(),!s.isDWM()){const t=s.symbolInfo();if(null!==t){let i=this.properties().childs().timezone.value();"exchange"===i&&(i=t.timezone);const r=(0,ht.cal_to_utc)((0,ht.get_timezone)(i),new Date(e)),n=(0,Lt.createTimeToBarTimeAligner)(s.interval(),t)(r);e=(0,ht.utc_to_cal)((0,ht.get_timezone)(i),n).getTime()}}this._scrollingState={targetDate:e,deferred:r,centerIfVisible:t.centerIfVisible}}else{if(!this._scrollingState)return Yi.logError("scrollTo called without an argument"),Promise.reject();e=this._scrollingState.targetDate,r=this._scrollingState.deferred}if(void 0===i.tickMarks().minIndex)return r.resolve(void 0),r.promise;this.stopTimeScaleAnimation();let o=((e,t)=>{if((e=>(0,n.ensureNotNull)(i.tickMarks().indexToTime((0,n.ensureDefined)(i.tickMarks().minIndex))).valueOf()-e)(t)<0){let r=i.tickMarks().nearestIndex(t);const o=s.bars().lastIndex();if(null===o)return null;r=Math.min(r,o);let a=(0,n.ensureNotNull)(i.tickMarks().indexToTime(r)).valueOf();for(;a<t&&r<o;)r++,a=(0,
n.ensureNotNull)(i.tickMarks().indexToTime(r)).valueOf();const l=(0,n.ensureNotNull)(i.visibleBarsStrictRange()),c=l.lastBar()-l.firstBar();return!e&&l.contains(r)||i.zoomToBarsRange(r-c/2,r+c/2),{timestamp:(0,n.ensureNotNull)(i.indexToTimePoint(r))}}return null})(this._scrollingState.centerIfVisible,this._scrollingState.targetDate);if(!o){const t=(0,n.ensureDefined)(i.tickMarks().minIndex),r=(0,n.ensureNotNull)(i.visibleBarsStrictRange()),a=r.lastBar()-r.firstBar();if(s.requestMoreDataAvailable()){const t=i.tickMarks().estimateLeft(e);i.requestMoreHistoryPoints(Math.ceil(t+a/2))}else i.zoomToBarsRange(t-a/2,t+a/2),o={timestamp:(0,n.ensureNotNull)(i.indexToTimePoint(t)),eod:!0}}return o&&(this.fullUpdate(),this._scrollingState=null,r.resolve(o)),r.promise}_setCorrectedPositionToCrosshair(e,t,i){this.crossHairSource().setPosition(e,t,i)}_onSymbolSourceCollectionChanged(e){this._recalcAdjustForDividendsAvailibility(),this._symbolSourceCollectionChanged.fire(e)}_unmergeAvailable(e){return e===this.m_mainSeries||(0,j.isStudy)(e)&&!e.isLinkedToSeries()&&!(0,Ui.isNonSeriesStudy)(e)&&e.showInObjectTree()}_getExceedingChildStudies(e){let t=[];for(let i=0;i<e.length;++i)t=t.concat(e[i].sources||[]);let i=0;const s=[],r={};let n=0,o=1e6;for(;t.length&&--o;){const e=t[n];(e.ownerSource&&r[e.ownerSource]||!e.ownerSource)&&(r[e.id]=e,t.splice(t.indexOf(e),1),e.ownerSource&&(0,me.isStudyState)(e)&&e.state&&e.state.isChildStudy&&++i>1&&s.push(e)),n=(n+1)%t.length}return s}}},782505:(e,t,i)=>{"use strict";i.d(t,{japaneseChartStyles:()=>r,commonChartStyles:()=>n,allChartStyles:()=>o});var s=i(484727);function r(){const e=[8];return s.enabled("japanese_chart_styles")&&e.push(4,7,5,6),e}function n(){const e=[0,1,9,13,2,3,10];return s.enabled("chart_style_hilo")&&e.push(12),e}function o(){return n().concat(r())}},202529:(e,t,i)=>{"use strict";i.d(t,{ChartUndoModelBase:()=>ji});var s=i(685459),r=i.n(s),n=i(316230),o=i(650151),a=i(86441),l=i(509806),c=i(635991),h=i(324745),d=i(898005),u=i(820402),p=i(638273);function _(e,t){return!!p.Interval.isEqual(e.res,t.res)&&(0,u.areEqualTimeFrames)(e.val,t.val)}var m=i(849268),g=i(127958),f=i(232468),v=i(131227),S=i(220863),y=i(32133),b=i(658358),w=i(484727),P=i(708123),C=i(817808),T=i(663890),x=i(440097),I=i(486028);const M=new x.TranslatedString("move all scales to left",l.t(null,void 0,i(581898))),L=new x.TranslatedString("move all scales to right",l.t(null,void 0,i(622863))),A=(0,C.getLogger)("Chart.MergeAllScales");var k=i(144070);class E extends k.UndoCommand{constructor(e,t,i,s,r,n){super(n),this._model=e,this._paneIndex=e.panes().indexOf(t),this._targetPosition=s,this._targetIndex=r,this._scaleId=i.id(),this._sourcePosition=t.priceScalePosition(i),"overlay"!==this._sourcePosition&&(this._sourceIndex=t.priceScaleIndex(i,this._sourcePosition))}redo(){const e=this._model.panes()[this._paneIndex],t=(0,o.ensureNotNull)(e.getPriceScaleById(this._scaleId));e.movePriceScale(t,this._targetPosition,this._targetIndex),this._model.fullUpdate()}undo(){const e=this._model.panes()[this._paneIndex],t=(0,
o.ensureNotNull)(e.getPriceScaleById(this._scaleId));e.movePriceScale(t,this._sourcePosition,this._sourceIndex),this._model.fullUpdate()}}class D extends k.UndoCommand{constructor(e,t,i,s){super(s),this._createdIds=[],this._model=e,this._withoutShift=i,this._origStates=t.map((e=>e.state(!0)));const r=e.lineToolsGroupModel();this._origGroups=t.map((e=>{const t=r.groupForLineTool(e);return t&&t.id}))}redo(){const e=this._model.lineToolsGroupModel(),t=this._origStates.map(((t,i)=>{const s=(0,o.ensureNotNull)(this._model.dataSourceForId(t.id)),r=0===this._createdIds.length?void 0:(0,o.ensureDefined)(this._createdIds[i]),n=(0,f.cloneLineTool)(this._model,s,!this._withoutShift,r),a=(0,o.ensureNotNull)(s.priceScale());(0,o.ensureNotNull)(this._model.paneForSource(s)).addDataSource(n,a,!1);const l=this._origGroups[i];if(null!==l){const t=e.groupForId(l);t&&t.addLineTools([n])}return this._model.updateSource(n),n}));0===this._createdIds.length&&(this._createdIds=t.map((e=>e.id()))),this._model.selectionMacro((e=>{e.clearSelection(),t.forEach((t=>{e.addSourceToSelection(t)}))})),this._model.setShouldBeSavedEvenIfHidden(!0)}undo(){const e=this._model.lineToolsGroupModel();this._createdIds.forEach((t=>{const i=(0,o.ensureNotNull)(this._model.dataSourceForId(t)),s=e.groupForLineTool(i);null!==s&&s.excludeLineTool(i),this._model.removeSource(i)}))}newIds(){return this._createdIds}}var B=i(319139),V=i(959709);class R extends k.UndoCommand{constructor(e,t,i,s=!0){super(i,s),this._newStates=[],this._model=e,this._savedStates=t.map((e=>e.state(!1)))}redo(){this._applyState(this._newStates)}undo(){0===this._newStates.length&&this.saveNewState(),this._applyState(this._savedStates)}saveNewState(){const e=this._savedStates.filter(I.notNull).map((e=>(0,o.ensureNotNull)(this._model.dataSourceForId(e.id))));this._newStates=e.map((e=>e.state(!1)))}_applyState(e){for(const t of e)if(null!==t){const e=this._model.dataSourceForId(t.id);if(null!==e)if((0,T.isStudy)(e)){const i=t.state.inputs,s=e.properties().childs().inputs.childs();for(const e in i)s[e]&&s[e].setValue(i[e])}else this._model.restoreLineToolState(e,t,!0)}}}var N=i(677698),O=i(214474),F=i(792268),W=i(584739);const z=new x.TranslatedString("create {tool}",l.t(null,void 0,i(581791)));class H extends k.UndoCommand{constructor(e,t,i,s,r=0,n){super(z.format({tool:new x.TranslatedString(i,W.lineToolsLocalizedNames[i])}),!1),this._lineId=null,this._lineState=null,this._model=e,this._paneIndex=e.panes().indexOf(t),this._lineTool=i,this._ownerSourceId=s.id(),this._lineId=null!=n?n:null,this._drawOnAllChartsMode=r}startCreatingLine(e,t,i){var s;const r=this._model.panes()[this._paneIndex],n=this._model.dataSourceForId(this._ownerSourceId),o=this._model.createLineTool(r,e,this._lineTool,t,i,n,null!==(s=this._lineId)&&void 0!==s?s:void 0);return this._lineId=o.id(),!this._model.lineBeingCreated()}continueCreatingLine(e,t,i,s){const r=this._model.continueCreatingLine(e,t,i,s);return r&&this._model.setShouldBeSavedEvenIfHidden(!0),r}line(){
return null===this._lineId?null:this._model.dataSourceForId(this._lineId)}undo(){const e=this.line();null!==e&&(this._lineState=e.state(!1),this._model.removeSource(e),this._lineId=null)}redo(){if(null===this._lineState)return;const e=this._model.restoreSource(!1,this._paneIndex,null,(0,o.ensureNotNull)(this._lineState),null);null!==e&&(this._lineId=e.id(),this._lineState=null,e.share(this._drawOnAllChartsMode))}drawOnAllCharts(){return 0!==this._drawOnAllChartsMode}}const U=new x.TranslatedString("bring {title} to front",l.t(null,void 0,i(178246))),j=new x.TranslatedString("send {title} to back",l.t(null,void 0,i(166781))),G=new x.TranslatedString("insert {title} after {targetTitle}",l.t(null,void 0,i(53146))),q=new x.TranslatedString("insert {title} before {targetTitle}",l.t(null,void 0,i(667176))),$=new x.TranslatedString("send {title} backward",l.t(null,void 0,i(216259))),Y=new x.TranslatedString("bring {title} forward",l.t(null,void 0,i(356763))),K=new x.TranslatedString("send group {title} backward",l.t(null,void 0,i(404998))),Z=new x.TranslatedString("bring group {title} forward",l.t(null,void 0,i(27195)));function X(e){return new x.TranslatedString(e.name(),e.title())}class J extends k.UndoCommand{constructor(e,t,i){super(i),this._sourcesByPanes=new Map,this._originalState=new Map,this._model=e,t.forEach((t=>{const i=(0,o.ensureNotNull)(e.paneForSource(t)),s=e.panes().indexOf(i),r=this._sourcesByPanes.get(s)||[];r.push(t.id()),this._sourcesByPanes.set(s,r)})),Array.from(this._sourcesByPanes.keys()).forEach((t=>{const i=e.panes()[t],s=new Map;i.sourcesByGroup().allIncludingHidden().forEach((e=>{s.set(e.id(),e.zorder())})),this._originalState.set(t,s)}))}undo(){this._originalState.forEach(((e,t)=>{const i=this._model.panes()[t],s=new Map;e.forEach(((e,t)=>{const r=(0,o.ensureNotNull)(i.dataSourceForId(t));s.set(r,e)})),i.setZOrders(s)}))}redo(){this._sourcesByPanes.forEach(((e,t)=>{const i=this._model.panes()[t],s=e.map((e=>(0,o.ensureNotNull)(i.dataSourceForId(e))));this._paneOperation(i,s)}))}}class Q extends J{constructor(e,t){super(e,t,U.format({title:X(t[0])}))}_paneOperation(e,t){e.bringToFront(t)}}class ee extends J{constructor(e,t){super(e,t,j.format({title:X(t[0])}))}_paneOperation(e,t){e.sendToBack(t)}}class te extends J{constructor(e,t,i,s){super(e,t,s),this._targetSource=i}_paneOperation(e,t){e.insertAfter(t,this._targetSource)}}class ie extends te{constructor(e,t,i){super(e,t,i,G.format({title:X(t[0]),targetTitle:X(i)}))}}class se extends J{constructor(e,t,i,s){super(e,t,s),this._targetSource=i}_paneOperation(e,t){e.insertBefore(t,this._targetSource)}}class re extends se{constructor(e,t,i){super(e,t,i,q.format({title:X(t[0]),targetTitle:X(i)}))}}function ne(e,t){const i=t[0],s=e.sourcesByGroup().all().filter((e=>e.zorder()<i.zorder()));if(0===s.length)throw new Error("Cannot move backward source that alreadt on back");let r=s[s.length-1];if((0,f.isLineTool)(r)){const t=e.model().lineToolsGroupModel().groupForLineTool(r);null!==t&&(r=t.lineTools()[0])}return r}class oe extends se{constructor(e,t,i){
super(e,i,ne(t,i),$.format({title:X(i[0])}))}}function ae(e,t){const i=t[t.length-1],s=e.sourcesByGroup().allExceptSpecialSources().filter((e=>e.zorder()>i.zorder()));if(0===s.length)throw new Error("Cannot bring forward source that alreadt on back");let r=s[0];if((0,f.isLineTool)(r)){const t=e.model().lineToolsGroupModel().groupForLineTool(r);if(null!==t){const e=t.lineTools();r=e[e.length-1]}}return r}class le extends te{constructor(e,t,i){super(e,i,ae(t,i),Y.format({title:X(i[0])}))}}function ce(e,t){return(0,o.ensureNotNull)(e.paneForSource(t.lineTools()[0]))}class he extends se{constructor(e,t){super(e,t.lineTools(),ne(ce(e,t),t.lineTools()),K.format({title:t.name()}))}}class de extends te{constructor(e,t){super(e,t.lineTools(),ae(ce(e,t),t.lineTools()),Z.format({title:t.name()}))}}const ue=new x.TranslatedString("rearrange panes",l.t(null,void 0,i(233348)));class pe extends k.UndoCommand{constructor(e,t,i){super(ue),this._chartModel=e,this._index=t,(0,I.isNumber)(i)?this._dstIndex=i:this._dstIndex="up"===i?t-1:t+1}redo(){this._checkIndices()&&this._chartModel.movePane(this._index,this._dstIndex)}undo(){this._checkIndices()&&this._chartModel.movePane(this._dstIndex,this._index)}_checkIndices(){const e=this._chartModel.panes().length;return this._index>=0&&this._index<e&&this._dstIndex>=0&&this._dstIndex<e}}var _e=i(779602),me=i(873402),ge=i(508547),fe=i(632054),ve=i(688401),Se=i(382213),ye=i(744687);class be extends k.UndoCommand{constructor(e,t,i,s,r,n){super(s),this._prevPriceAxisProps={},this._property=e,this._mainSeries=i,this._value=t,this._model=r,this._chartWidget=n}redo(){const e=this._mainSeries,t=e.properties().childs();this._prevResolution=t.interval.value(),this._prevValue=this._property.value(),this._storePriceAxisProps(),(0,ge.saveDefaultProperties)(!0);const i=t.interval.value(),s=this._model.defaultResolutions(),r=(0,Se.getResolutionByChartStyle)(this._value,i,s);ve.linking.interval.setValue(r),e.setChartStyleWithIntervalIfNeeded(this._value,r),(0,fe.setLastUsedStyle)(this._value,e.symbolInfo()),(0,fe.preparePriceAxisProperties)(t),(0,ge.saveDefaultProperties)(!1),this._invalidateModel(),this._chartWidget.screen.show(!0)}undo(){const e=this._mainSeries;(0,ge.saveDefaultProperties)(!0),e.setChartStyleWithIntervalIfNeeded(this._prevValue,this._prevResolution),this._restorePriceAxisProps(),ve.linking.interval.setValue(this._prevResolution),(0,ge.saveDefaultProperties)(!1),this._invalidateModel(),this._chartWidget.screen.show(!0)}_storePriceAxisProps(){const e=this._mainSeries.priceScale();this._prevPriceAxisProps=e.mode()}_restorePriceAxisProps(){this._mainSeries.priceScale().setMode(this._prevPriceAxisProps)}_invalidateModel(){this._model&&(this._model.recalculateAllPanes((0,ye.sourceChangeEvent)(this._model.mainSeries().id())),this._model.lightUpdate())}}const we=new x.TranslatedString("change date range",l.t(null,void 0,i(207151)));class Pe extends k.UndoCommand{constructor(e,t){super(we),this._modelsData=[],this._rangeOptions=t,this._modelsData.push({model:e,
prevResolution:e.mainSeries().properties().childs().interval.value(),barSpacing:e.timeScale().barSpacing(),rightOffset:e.timeScale().rightOffset(),rangeOptions:e.appliedTimeFrame().value()})}redo(){for(const e of this._modelsData){const t=e.model.mainSeries(),i=t.properties().childs().interval;p.Interval.isEqual(this._rangeOptions.res,i.value())?t.loadDataTo(this._rangeOptions.val):(t.setDefaultTimeframe(this._rangeOptions.val),t.setSymbolParams({interval:this._rangeOptions.res}))}}undo(){for(const e of this._modelsData){const t=e.model.mainSeries(),i=t.properties().childs().interval;e.prevResolution!==i.value()?(null!==e.rangeOptions&&t.setDefaultTimeframe(e.rangeOptions.val),t.setSymbolParams({interval:e.prevResolution})):null!==e.rangeOptions&&t.loadDataTo(e.rangeOptions.val);const s=e.model.timeScale();s.setBarSpacing(e.barSpacing),s.setRightOffset(e.rightOffset)}}canMerge(e){return e instanceof Pe&&_(e._rangeOptions,this._rangeOptions)}merge(e){if(!(e instanceof Pe))throw new Error("Invalid command to merge");this._modelsData=this._modelsData.concat(e._modelsData)}}var Ce=i(720687);i(603605);class Te extends k.UndoCommand{constructor(e,t,i){super(i),this._model=e,this._groupId=t.id,this._groupName=t.name(),this._lineToolsIds=t.lineTools().map((e=>e.id()))}redo(){const e=(0,o.ensureNotNull)(this._model.lineToolsGroupModel().groupForId(this._groupId));this._model.lineToolsGroupModel().removeGroup(e)}undo(){const e=this._lineToolsIds.map((e=>this._model.dataSourceForId(e))),t=new Ce.LineToolsGroup(e,this._groupName,this._groupId);this._model.lineToolsGroupModel().addGroup(t)}}const xe=new x.TranslatedString("create line tools group",l.t(null,void 0,i(3195)));class Ie extends k.UndoCommand{constructor(e,t){super(xe),this._groupId=null,this._model=e,this._sourcesIds=t.map((e=>e.id()))}redo(){const e=this._sourcesIds.map((e=>this._model.dataSourceForId(e))),t=null===this._groupId?void 0:this._groupId;this._groupId=this._model.lineToolsGroupModel().createGroup(e,this._title,t).id}undo(){const e=(0,o.ensureNotNull)(this._model.lineToolsGroupModel().groupForId((0,o.ensureNotNull)(this._groupId)));this._model.lineToolsGroupModel().removeGroup(e)}createdGroupId(){return this._groupId}}const Me=new x.TranslatedString("add line tool(s) to group {group}",l.t(null,void 0,i(240242)));class Le extends k.UndoCommand{constructor(e,t,i){super(Me.format({group:t.name()})),this._model=e,this._groupId=t.id,this._lineToolsIds=i.map((e=>e.id()))}redo(){const e=(0,o.ensureNotNull)(this._model.lineToolsGroupModel().groupForId(this._groupId)),t=this._lineToolsIds.map((e=>this._model.dataSourceForId(e)));e.addLineTools(t)}undo(){const e=this._lineToolsIds.map((e=>this._model.dataSourceForId(e)));(0,o.ensureNotNull)(this._model.lineToolsGroupModel().groupForId(this._groupId)).excludeLineTools(e)}}class Ae extends k.UndoCommand{constructor(e,t,i,s,r){super(i),this._targetObj=e,this._newValue=t,this._oldValue=this._targetObj.value(),this._model=s,r&&this.setCustomFlag("doesnt_affect_save",!0)}redo(){(0,ge.saveDefaultProperties)(!0),
this._targetObj.setValue(this._newValue),(0,ge.saveDefaultProperties)(!1),this._model.recalculateAllPanes((0,ye.globalChangeEvent)()),this._model.lightUpdate()}undo(){(0,ge.saveDefaultProperties)(!0),this._targetObj.setValue(this._oldValue),(0,ge.saveDefaultProperties)(!1),this._model.recalculateAllPanes((0,ye.globalChangeEvent)()),this._model.lightUpdate()}}class ke extends k.UndoCommand{constructor(e,t,i,s){super(s),this._chartModel=e,this._groupId=t.id,this._oldName=t.name(),this._newName=i}redo(){(0,o.ensureNotNull)(this._chartModel.lineToolsGroupModel().groupForId(this._groupId)).setName(this._newName)}undo(){(0,o.ensureNotNull)(this._chartModel.lineToolsGroupModel().groupForId(this._groupId)).setName(this._oldName)}}var Ee=i(358076);const De=new x.TranslatedString("create line tools group from selection",l.t(null,void 0,i(192659))),Be=new x.TranslatedString("removing line tools group {name}",l.t(null,void 0,i(578811))),Ve=new x.TranslatedString("add line tool {lineTool} to group {name}",l.t(null,void 0,i(799113))),Re=new x.TranslatedString("make group {group} visible",l.t(null,void 0,i(587927))),Ne=new x.TranslatedString("make group {group} invisible",l.t(null,void 0,i(445223))),Oe=new x.TranslatedString("lock group {group}",l.t(null,void 0,i(304963))),Fe=new x.TranslatedString("unlock group {group}",l.t(null,void 0,i(551114))),We=new x.TranslatedString("rename group {group} to {newName}",l.t(null,void 0,i(916338)));class ze{constructor(e){this._lineToolsAffectChartInvalidation=new P.FeatureToggleWatchedValue("do_not_invalidate_chart_on_changing_line_tools",!1),this._environment=e}createGroupFromSelection(){const e=this._environment.model();(0,o.assert)(!e.selection().isEmpty(),"Cannot create group from empty selection");const t=(0,F.sortSources)(e.selection().lineDataSources());(0,o.assert)(t.length===e.selection().allSources().length,"A group could contain line tools only");const i=t.length>1||null!==this._environment.model().lineToolsGroupModel().groupForLineTool(t[0]),s=t.reduce(((e,t)=>e.zorder()>t.zorder()?e:t),t[0]);let r=s;const n=e.lineToolsGroupModel().groupForLineTool(s);if(null!==n){const e=n.lineTools();r=e[e.length-1]}this._environment.beginUndoMacro(De,this._lineToolsAffectChartInvalidation.value());const a=new Map,l=new Set;t.forEach((t=>{const i=this._groupForLineTool(t);if(null===i)return;const s=a.get(i)||[];s.push(t),a.set(i,s);const r=(0,o.ensureNotNull)(e.paneForSource(t));l.add(r)})),(0,o.assert)(l.size<=1,"All selected sources should be on the same pane"),a.forEach(((t,i)=>{const s=new V.ExcludeLineToolsFromGroupUndoCommand(e,i,t);this._environment.pushUndoCommand(s)}));const c=new Ie(e,(0,F.sortSources)(t));if(this._environment.pushUndoCommand(c),i){const i=new ie(e,t,r);this._environment.pushUndoCommand(i)}this._environment.endUndoMacro();const h=(0,o.ensureNotNull)(c.createdGroupId());return(0,o.ensureNotNull)(e.lineToolsGroupModel().groupForId(h))}removeGroup(e){const t=this._environment.model(),i=e.lineTools();this._environment.beginUndoMacro(Be.format({name:e.name()
}),this._lineToolsAffectChartInvalidation.value());const s=new Te(t,e,null);this._environment.pushUndoCommand(s);const r=new B.RemoveSourcesCommand(t,i,null);this._environment.pushUndoCommand(r);const n=t.mainSeries().symbol();i.forEach((e=>{null!==e.linkKey().value()&&(0,Ee.removeLineTool)({withUndo:!0,model:t,symbol:n,sourceTitle:new x.TranslatedString(e.name(),e.title()),lineToolState:e.state(!1),linkKey:(0,o.ensureNotNull)(e.linkKey().value())})})),this._environment.endUndoMacro()}groups(){return this._environment.model().lineToolsGroupModel().groups()}excludeLineToolFromGroup(e,t){const i=this._environment.model(),s=new V.ExcludeLineToolsFromGroupUndoCommand(i,e,[t]);s.setCustomFlag("doesnt_affect_save",this._lineToolsAffectChartInvalidation.value()),this._environment.pushUndoCommand(s)}addLineToolToGroup(e,t){const i=this._environment.model(),s=i.lineToolsGroupModel().groupForLineTool(t);if(s===e)return;const r=Ve.format({lineTool:new x.TranslatedString(t.name(),t.title()),name:e.name()});this._environment.beginUndoMacro(r,this._lineToolsAffectChartInvalidation.value()),null!==s&&this._environment.pushUndoCommand(new V.ExcludeLineToolsFromGroupUndoCommand(i,s,[t])),this._environment.pushUndoCommand(new Le(i,e,[t])),this._environment.endUndoMacro()}bringToFront(e){const t=this._environment.model(),i=new Q(t,e.lineTools());i.setCustomFlag("doesnt_affect_save",this._lineToolsAffectChartInvalidation.value()),this._environment.pushUndoCommand(i),this._environment.emitEvent("changeZOrder",[e.lineTools()])}sendToBack(e){const t=this._environment.model(),i=new ee(t,e.lineTools());i.setCustomFlag("doesnt_affect_save",this._lineToolsAffectChartInvalidation.value()),this._environment.pushUndoCommand(i),this._environment.emitEvent("changeZOrder",[e.lineTools()])}bringForward(e){const t=this._environment.model(),i=new de(t,e);i.setCustomFlag("doesnt_affect_save",this._lineToolsAffectChartInvalidation.value()),this._environment.pushUndoCommand(i),this._environment.emitEvent("changeZOrder",[e.lineTools()])}sendBackward(e){const t=this._environment.model(),i=new he(t,e);i.setCustomFlag("doesnt_affect_save",this._lineToolsAffectChartInvalidation.value()),this._environment.pushUndoCommand(i),this._environment.emitEvent("changeZOrder",[e.lineTools()])}insertAfter(e,t){const i=this._environment.model();let s;if(t instanceof Ce.LineToolsGroup){const e=t.lineTools();s=e[e.length-1]}else s=t;const r=new ie(i,e.lineTools(),s);this._environment.pushUndoCommand(r),this._environment.emitEvent("changeZOrder",[e.lineTools()])}insertBefore(e,t){const i=this._environment.model();let s;if(t instanceof Ce.LineToolsGroup){s=t.lineTools()[0]}else s=t;const r=new re(i,e.lineTools(),s);this._environment.pushUndoCommand(r),this._environment.emitEvent("changeZOrder",[e.lineTools()])}availableZOrderOperations(e){const t=this._environment.model(),i=e.lineTools(),s=i[0],r=i[i.length-1],n=(0,o.ensureNotNull)(t.paneForSource(i[0])).sourcesByGroup().allExceptSpecialSources(),a=n[0],l=n[n.length-1];return{bringForwardEnabled:r!==l,
bringToFrontEnabled:r!==l,sendBackwardEnabled:s!==a,sendToBackEnabled:s!==a}}setGroupVisibility(e,t){const i=(t?Re:Ne).format({group:e.name()}),s=this._environment.model();this._environment.beginUndoMacro(i,this._lineToolsAffectChartInvalidation.value()),e.lineTools().forEach((e=>{const i=e.properties().visible,r=new Ae(i,t,null,s);this._environment.pushUndoCommand(r)})),this._environment.endUndoMacro()}setGroupLock(e,t){const i=(t?Oe:Fe).format({group:e.name()}),s=this._environment.model();this._environment.beginUndoMacro(i,this._lineToolsAffectChartInvalidation.value()),e.lineTools().forEach((e=>{const i=e.properties().frozen,r=new Ae(i,t,null,s);this._environment.pushUndoCommand(r)})),this._environment.endUndoMacro()}setGroupName(e,t){const i=this._environment.model(),s=We.format({group:e.name(),newName:t}),r=new ke(i,e,t,s);r.setCustomFlag("doesnt_affect_save",this._lineToolsAffectChartInvalidation.value()),this._environment.pushUndoCommand(r)}canBeGroupped(e){const t=this._environment.model();return new Set(e.map((e=>t.paneForSource(e)))).size<=1}_groupForLineTool(e){return this._environment.model().lineToolsGroupModel().groups().find((t=>t.containsLineTool(e)))||null}}var He=i(58121),Ue=i(495736),je=i(879987),Ge=i(793698);const qe=new x.TranslatedString("apply study template {template}",l.t(null,void 0,i(526065)));function $e(e){for(const t of e.panes)for(const e of t.sources)if((0,je.isMainSeriesState)(e))return e.id;return null}class Ye extends k.UndoCommand{constructor(e,t,i){var s,r;super(qe.format({template:i})),this._newSymbolParams={},this._model=e,this._templateContent=function(e,t){const i=(0,He.default)({},e),s=(0,o.ensureNotNull)($e(i));for(const e of i.panes){e.mainSourceId===s&&(e.mainSourceId=t);for(const i of e.sources)if(i.id===s){i.id=t;const r=e=>{const i=e.indexOf(s);-1!==i&&e.splice(i,1,t)};if(e.leftAxisesState&&e.rightAxisesState?(e.leftAxisesState.forEach((e=>r(e.sources))),e.rightAxisesState.forEach((e=>r(e.sources)))):(r(e.leftAxisSources),r(e.rightAxisSources)),e.overlayPriceScales){const i=e.overlayPriceScales[s];i&&(delete e.overlayPriceScales[s],e.overlayPriceScales[t]=i)}}else i.ownerSource===s&&(i.ownerSource=t)}return i}(t,e.mainSeries().id()),this._initialState=e.studyTemplate(!0,!0,!0);const n=e.mainSeries();t.symbol&&(this._newSymbolParams={symbol:t.symbol,currency:null!==(s=t.currency)&&void 0!==s?s:null,unit:null!==(r=t.unit)&&void 0!==r?r:null}),t.interval&&(this._newSymbolParams.interval=t.interval,this._newSymbolParams.style=(0,fe.getChartStyleByResolution)(t.interval,n.style())),this._initialSymbolParams={symbol:n.symbol(),currency:n.currency(),unit:n.unit(),interval:n.interval(),style:n.style()},this._initialState=e.studyTemplate(),this._initialGroupsState=e.lineToolsGroupModel().state()}redo(){this._model.mainSeries().setSymbolParams(this._newSymbolParams);const e=this._merge(this._templateContent).filter(f.isLineTool);this._model.lineToolsGroupModel().removeLineTools(e);const t=this._model.mainSeries().properties();(0,fe.preparePriceAxisProperties)(t),
this._model.recalcVisibleRangeStudies(!0),this._model.setShouldBeSavedEvenIfHidden(!0)}undo(){this._model.mainSeries().setSymbolParams(this._initialSymbolParams),this._merge(this._initialState)}_merge(e){const t=e.version||0,i=this._model,s=i.mainSeries();(0,o.assert)(s.id()===$e(e)),s.priceScale().properties().childs().lockScale.setValue(!1);const r=i.panes(),n=[];for(let e=r.length;e--;){const t=r[e],i=t.containsMainSeries(),s=t.dataSources();for(let e=s.length;e--;){const t=s[e];(!i||(0,T.isStudy)(t)&&t.isRemovedByStudyTemplates())&&n.push(t)}}i.resetDeferredStudies();const a=(0,Ue.closeSourcesSet)(i,n);for(let e=0;e<a.length;++e)i.removeSource(a[e]);const l=e.panes;for(let e=0;e<l.length;e++){let s=-1;const n=(0,I.clone)(l[e]);n.sources.sort(((e,t)=>e.zorder-t.zorder));for(let e=0;e<n.sources.length;e++){const t=n.sources[e];if((0,je.isMainSeriesState)(t)){delete t.state,s=e;break}}const o=s>-1,a=o?r[e]:i.createPane(e);o&&t<3&&(0,Ge.reorderDataSourcesStateZOrder)(n.sources),a.restoreState(n,!1,t),null!==a.mainDataSource()||i.removePane(a)}return i.syncLollipopSources(),s.priceScale().setMode({autoScale:!0}),i.startNotStartedStudies(),i.recalculateAllPanes((0,ye.globalChangeEvent)()),i.fullUpdate(),a}}var Ke=i(296055);const Ze=(0,C.getLogger)("Chart.ChartUndoModel"),Xe=new x.TranslatedString("paste drawing",l.t(null,void 0,i(896916)));class Je extends k.UndoCommand{constructor(e,t,i,s,r){super(Xe),this._needCopyToOtherCharts=!1,this._sourceState=null,this._model=e,this._clipboardData=t,this._paneIndex=this._model.panes().indexOf(i||(0,o.ensureNotNull)(this._model.paneForSource(this._model.mainSeries()))),this._pasteWithData=!!s,this._keepZIndex=!!r}redo(){const e=this._model.panes()[this._paneIndex],t=(0,o.ensureNotNull)(e.clipboardLineToolOwnerSource(this._clipboardData.source.id));null===this._sourceState&&(this._sourceState=this._getSourceState(t));const i=(0,o.ensureNotNull)(e.restoreLineTool(this._sourceState,this._pasteWithData,this._keepZIndex,void 0,t));(0,o.ensureNotNull)(t.priceScale()).addDataSource(i),this._clipboardData.centeredOnChart&&i.centerPosition&&i.centerPosition(),i.restoreFixedPoint(),i.createServerPoints();const s=(0,Ke.isActingAsSymbolSource)(t)||t.metaInfo().is_price_study;this._needCopyToOtherCharts=Boolean(s&&((0,Ee.drawOnAllCharts)().value()||i.linkKey().value()&&i.isSynchronizable())),this._model.setShouldBeSavedEvenIfHidden(!0)}undo(){if(!this._sourceState)return void Ze.logError("This command was never executed - nothing to undo");const e=this.source();this._clipboardData.centeredOnChart&&(this._clipboardData.centeredOnChart=!1,this._sourceState.points=e.normalizedPoints()),this._model.removeSource(e)}source(){return(0,o.ensureNotNull)(this._model.dataSourceForId((0,o.ensureNotNull)(this._sourceState).id))}needCopyToOtherCharts(){return this._needCopyToOtherCharts}_getSourceState(e){const t=(0,I.clone)(this._clipboardData.source);delete t.state.symbol,null!=t.linkKey&&(t.linkKey=(0,S.randomHash)());const i=(0,
o.ensureNotNull)(e.priceScale()),s=this._model,{symbol:r,currencyId:n,unitId:l}=this._clipboardData.source.state,c=(0,o.ensureNotNull)(e.symbolSource());let h=!1;!c.symbolSameAsCurrent(r)||(null!==n?n!==(0,fe.symbolCurrency)(c.symbolInfo(),void 0,!0):c.isConvertedToOtherCurrency())||(null!==l?l!==(0,fe.symbolUnit)(c.symbolInfo(),this._model.unitConversionEnabled()):c.isConvertedToOtherUnit())||((0,Ke.isActingAsSymbolSource)(e)?h=!0:(0,T.isStudy)(e)&&(h=Boolean(e.metaInfo().is_price_study)));const d=e=>{const t=e.x*s.timeScale().width(),r=e.y*i.height()-40;return new a.Point(t,r)},u=(0,o.ensureNotNull)(e.firstValue());if(this._model.id()===this._clipboardData.modelId||!h)for(let e=0;e<this._clipboardData.geometry.length;++e){const r=d(this._clipboardData.geometry[e]),n=s.timeScale().coordinateToIndex(r.x),o=s.timeScale().normalizeBarIndex(n);if(h){const s=i.priceToCoordinate(t.points[e].price,u)+-40;o.price=i.coordinateToPrice(s,u)}else o.price=i.coordinateToPrice(r.y,u);t.points[e]=o}return t.id=(0,S.randomHashN)(6),t}}var Qe=i(431491),et=i(437334),tt=i(705145);const it=new x.TranslatedString("change symbol",l.t(null,void 0,i(600526)));class st extends k.UndoCommand{constructor(e,t,i){super(it),this._sourceId=e.id(),this._newSymbolParams={symbol:t,currency:null,unit:null},this._prevSymbolParams={symbol:e.symbol(),currency:e.currency(),unit:e.unit(),interval:e.interval(),style:e.style()},this._chartWidget=i,this._showFade=e===i.model().mainSeries()}redo(){this._symbolSource().setSymbolParams(this._newSymbolParams),this._showFade&&this._chartWidget.screen.show(!0)}undo(){this._symbolSource().setSymbolParams(this._prevSymbolParams),this._showFade&&this._chartWidget.screen.show(!0)}_symbolSource(){return(0,o.ensureNotNull)(this._chartWidget.model().model().dataSourceForId(this._sourceId))}}const rt=(0,C.getLogger)("Chart.ChartUndoModel"),nt=new x.TranslatedString("paste indicator",l.t(null,void 0,i(780611)));class ot extends k.UndoCommand{constructor(e,t,i){super(nt),this._sourceState=null,this._model=e,this._clipboardData=t,this._paneId=i}redo(){if(!this._sourceState){const e=(0,I.clone)(this._clipboardData.source);e.id=(0,S.randomHashN)(6),this._sourceState=e}let e,t;e=this._paneId?(0,o.ensureNotNull)(this._model.paneForId(this._paneId)):this._sourceState.metaInfo.is_price_study?(0,o.ensureNotNull)(this._model.paneForSource(this._model.mainSeries())):this._model.createPane();const i=!e.mainDataSource();this._sourceState.zorder=e.newStudyZOrder();const s=(0,o.ensureNotNull)(e.restoreStudy(this._sourceState,!1));i||(t=this._sourceState.metaInfo.is_price_study?t=this._model.mainSeries().priceScale():this._paneId?e.findSuitableScale(s):e.defaultPriceScale(),t!==s.priceScale()&&e.move(s,t)),(0,T.isStudy)(s)&&s.start()}undo(){if(null===this._sourceState)return void rt.logError("This command was never executed - nothing to undo");const e=(0,o.ensureNotNull)(this._model.dataSourceForId(this._sourceState.id));this._model.removeSource(e)}state(){return this._sourceState}}class at extends k.UndoCommand{constructor(e,t,i,s,r){
super(null,!1),this._model=e,this._paneA=t,this._paneB=i,this._prevStretchA=s,this._currStretchA=r}redo(){const e=this._paneA.stretchFactor()+this._paneB.stretchFactor();this._paneA.setStretchFactor(this._currStretchA),this._paneB.setStretchFactor(e-this._currStretchA),this._model.fullUpdate()}undo(){const e=this._paneA.stretchFactor()+this._paneB.stretchFactor();this._paneA.setStretchFactor(this._prevStretchA),this._paneB.setStretchFactor(e-this._prevStretchA),this._model.fullUpdate()}}var lt=i(98747);const ct=new x.TranslatedString("move",l.t(null,void 0,i(647107)));class ht extends k.UndoCommand{constructor(e,t,i,s){super(ct,!1),this._endEvent=null,this._model=e,this._sourceId=t.id(),this._itemIndex=i,this._startEvent=s}move(e){this._endEvent=e,this._move(e)}hasChanges(){return null!==this._endEvent}undo(){this._move(this._startEvent)}redo(){this._move((0,o.ensureNotNull)(this._endEvent))}_move(e){const t=(0,o.ensureNotNull)(this._model.dataSourceForId(this._sourceId));(0,o.assert)(void 0!==t.moveItem,'The method "moveItem" is not defined'),t.moveItem&&t.moveItem(new a.Point(e.localX,e.localY),this._itemIndex,new lt.EnvironmentState(e))}}class dt extends k.UndoCommand{constructor(e,t,i,s,r,n,o,a,l,c,h,d){super(d),this._studyId=null,this._paneState=null,this._chartModel=e,this._studyMetaInfo=t,this._props=s,this._addAsOverlay=r,this._parentIds=n.map((e=>e.id())),this._inputs=i,this._targetZOrder=h,this._preferredPriceScale=o,this._allowChangeCurrency=a,this._allowChangeUnit=l,this._paneSize=c}redo(){const e=this._parentIds.map((e=>this._chartModel.dataSourceForId(e))),t=this._chartModel.insertStudyWithParams(this._studyMetaInfo,this._inputs,this._targetZOrder,this._props,this._addAsOverlay,e,this._preferredPriceScale,this._allowChangeCurrency,this._allowChangeUnit,this._paneSize,null===this._studyId?void 0:this._studyId);if(this._studyId=t.id(),t.childStudyByRebind().subscribe(null,(()=>(0,y.trackEvent)("SOS","Apply SOS","Rebind SOS"))),this._chartModel.setShouldBeSavedEvenIfHidden(!0),null!==this._paneState){(0,o.ensureNotNull)(this._chartModel.paneForSource(t)).restoreState(this._paneState,!1,this._chartModel.version()),this._paneState=null}}undo(){const e=(0,o.ensureNotNull)(this._chartModel.dataSourceForId((0,o.ensureNotNull)(this._studyId))),t=(0,o.ensureNotNull)(this._chartModel.paneForSource(e)).state();this._chartModel.removeSource(e)&&(this._paneState=t)}insertedStudy(){return this._chartModel.dataSourceForId((0,o.ensureNotNull)(this._studyId))}}var ut=i(974350),pt=i(314088),_t=i.n(pt),mt=i(478265),gt=i(340116);const ft=new x.TranslatedString("zoom",l.t(null,void 0,i(659833)));class vt extends k.UndoCommand{constructor(e,t,i,s,r,n){super(ft),this._barSpacing=null,this._rightBarsOffset=null,this._leftBarsOffset=null,this._priceMode=null,this._model=e,this._startBar=t,this._endBar=i,this._startPrice=s,this._endPrice=r,this._pane=n}redo(){const e=(0,o.ensureNotNull)(this._model.timeScale().visibleBarsStrictRange());this._leftBarsOffset=e.firstBar()-this._startBar,
this._rightBarsOffset=e.lastBar()-this._endBar,this._barSpacing=this._model.timeScale().barSpacing(),this._priceMode=this._pane.defaultPriceScale().mode(),this._model.zoomToViewport(this._startBar,this._endBar,this._startPrice,this._endPrice,this._pane)}undo(){const e=this._model.timeScale(),t=this._pane.defaultPriceScale(),i=(0,o.ensureNotNull)(e.visibleBarsStrictRange());e.setBarSpacing((0,o.ensureNotNull)(this._barSpacing)),e.zoomToBarsRange(i.firstBar()+(0,o.ensureNotNull)(this._leftBarsOffset),i.lastBar()+(0,o.ensureNotNull)(this._rightBarsOffset)),t.setMode((0,o.ensureNotNull)(this._priceMode)),t.recalculatePriceRange((0,o.ensureNotNull)(e.visibleBarsStrictRange())),this._model.recalculateAllPanes((0,ye.viewportChangeEvent)()),this._model.lightUpdate()}}const St=(0,C.getLogger)("Chart.ChartUndoModel"),yt=new x.TranslatedString("zoom",l.t(null,void 0,i(659833)));class bt extends k.UndoCommand{constructor(e,t,i){super(yt),this._baseCmd=e,this._zoomStack=t,this._inOut=i}undo(){if(this._inOut){if(this._baseCmd!==this._zoomStack.head())return void St.logDebug("zoom stack inconsistency");this._baseCmd.undo(),this._zoomStack.pop()}else this._baseCmd.redo(),this._zoomStack.push(this._baseCmd)}redo(){if(this._inOut)this._baseCmd.redo(),this._zoomStack.push(this._baseCmd);else{if(this._baseCmd!==this._zoomStack.head())return void St.logDebug("zoom stack inconsistency");this._baseCmd.undo(),this._zoomStack.pop()}}}const wt=new x.TranslatedString("stop syncing drawing",l.t(null,void 0,i(598784)));class Pt extends k.UndoCommand{constructor(e,t){super(wt),this._model=e,this._sourceId=t.id(),this._linkKey=t.linkKey().value()}redo(){(0,o.ensureNotNull)(this._model.dataSourceForId(this._sourceId)).linkKey().setValue(null)}undo(){(0,o.ensureNotNull)(this._model.dataSourceForId(this._sourceId)).linkKey().setValue(this._linkKey)}}const Ct=new x.TranslatedString("restore defaults",l.t(null,void 0,i(209608)));class Tt extends k.UndoCommand{constructor(e,t,i=Ct){super(i),this._chartModel=e,this._defaultProperty=t,this._state=t.state()}redo(){this._chartModel.restoreFactoryDefaults(this._defaultProperty)}undo(){this._defaultProperty.mergeAndFire(this._state),this._chartModel.mainSeries().onChartStyleChanged()}}var xt=i(785359);class It extends Tt{redo(){this._defaultProperty.hasChild("intervalsVisibilities")&&this._defaultProperty.childs().intervalsVisibilities.mergeAndFire(xt.intervalsVisibilitiesDefaults),super.redo()}}class Mt extends It{redo(){super.redo(),this._chartModel.recalcColorStudies(!0)}undo(){super.undo(),this._chartModel.recalcColorStudies(!0)}}var Lt=i(224778),At=i(606615),kt=i(658363);function Et(e){const{visible:t,...i}=e;return i}function Dt(e){const{visible:t,...i}=e;return i}function Bt(e){const{drawWick:t,drawBorder:i,drawBody:s,barColorsOnPrevClose:r,...n}=e;return n}function Vt(e){const{drawWick:t,drawBorder:i,drawBody:s,...r}=e;return r}function Rt(e){const{drawWick:t,drawBorder:i,drawBody:s,showRealLastPrice:r,inputs:n,...o}=e;return o}function Nt(e){
const{barColorsOnPrevClose:t,dontDrawOpen:i,thinBars:s,...r}=e;return r}function Ot(e){const{showBorders:t,showLabels:i,drawBody:s,...r}=e;return r}function Ft(e){const{linestyle:t,linewidth:i,styleType:s,priceSource:r,...n}=e;return n}function Wt(e){const{linestyle:t,linewidth:i,priceSource:s,...r}=e;return r}function zt(e){const{inputs:t,...i}=e;return i}function Ht(e){const{inputs:t,...i}=e;return i}function Ut(e){const{inputs:t,...i}=e;return i}function jt(e){const{inputs:t,...i}=e;return i}function Gt(e){const{topLineWidth:t,bottomLineWidth:i,baseLevelPercentage:s,priceSource:r,...n}=e;return n}function qt(e){const{thinBars:t,inputs:i,...s}=e;return s}function $t(e){const{visible:t,style:i,symbol:s,interval:r,sessionId:n,highLowAvgPrice:o,showCountdown:a,bidAsk:l,prePostMarket:c,priceAxisProperties:h,candleStyle:d,hollowCandleStyle:u,haStyle:p,barStyle:_,hiloStyle:m,lineStyle:g,areaStyle:f,renkoStyle:v,pbStyle:S,kagiStyle:y,pnfStyle:b,baselineStyle:w,rangeStyle:P,esdShowDividends:C,esdShowSplits:T,esdShowEarnings:x,esdShowBreaks:I,showContinuousContractSwitches:M,showContinuousContractSwitchesBreaks:L,showFuturesContractExpiration:A,showLastNews:k,...E}=e;return{bidAsk:Et(l),prePostMarket:Dt(c),candleStyle:Bt(d),hollowCandleStyle:Vt(u),haStyle:Rt(p),barStyle:Nt(_),hiloStyle:Ot(m),lineStyle:Ft(g),areaStyle:Wt(f),renkoStyle:zt(v),pbStyle:Ht(S),kagiStyle:Ut(y),pnfStyle:jt(b),baselineStyle:Gt(w),rangeStyle:qt(P),...E}}function Yt(e){const{scaleSeriesOnly:t,showSeriesLastValue:i,showStudyLastValue:s,showSymbolLabels:r,showBidAskLabels:n,showPrePostMarketPriceLabel:o,showStudyPlotLabels:a,showFundamentalNameLabel:l,showFundamentalLastValue:c,seriesLastValueMode:h,...d}=e;return d}function Kt(e){const{topMargin:t,bottomMargin:i,...s}=e;return s}const Zt=new x.TranslatedString("apply chart theme",l.t(null,void 0,i(766568)));class Xt extends k.UndoCommand{constructor(e,t,i){var s,r,n;super(Zt),this._model=e,this._newSessionProps=t.sessions||(0,kt.factoryDefaults)("sessions"),["candleStyle","hollowCandleStyle","haStyle"].forEach((e=>{t.mainSourceProperties[e].wickUpColor=t.mainSourceProperties[e].wickUpColor||t.mainSourceProperties[e].wickColor,t.mainSourceProperties[e].wickDownColor=t.mainSourceProperties[e].wickDownColor||t.mainSourceProperties[e].wickColor})),t.chartProperties=null!==(s=t.chartProperties)&&void 0!==s?s:{paneProperties:void 0,scalesProperties:void 0},t.chartProperties.paneProperties.vertGridProperties=null!==(r=t.chartProperties.paneProperties.vertGridProperties)&&void 0!==r?r:t.chartProperties.paneProperties.gridProperties,t.chartProperties.paneProperties.horzGridProperties=null!==(n=t.chartProperties.paneProperties.horzGridProperties)&&void 0!==n?n:t.chartProperties.paneProperties.gridProperties;const o=this._model.properties().state().paneProperties.legendProperties;delete o.backgroundTransparency,t.chartProperties.paneProperties.legendProperties={...t.chartProperties.paneProperties.legendProperties,...o};const a=(0,kt.factoryDefaults)("chartproperties"),l=(0,At.deepExtend)({},a,t.chartProperties)
;this._newChartProps={paneProperties:Kt(l.paneProperties),scalesProperties:Yt(l.scalesProperties)},e.timeScale().preserveBarSpacing()&&delete this._newChartProps.scalesProperties.barSpacing;const c=(0,kt.factoryDefaults)("chartproperties.mainSeriesProperties"),h=(0,At.deepExtend)({},c,t.mainSourceProperties);this._newSeriesProps=i?h:$t(h);const d=e.properties().state();this._oldChartProps={paneProperties:Kt(d.paneProperties),scalesProperties:Yt(d.scalesProperties)};const u=e.mainSeries().properties().state();this._oldSeriesProps=i?u:$t(u),this._oldSessionProps=this._model.sessions().properties().state()}undo(){this._merge(this._oldChartProps,this._oldSeriesProps,this._oldSessionProps),this._model.mainSeries().onChartStyleChanged(),this._model.updateScales(),this._model.chartThemeLoaded()}redo(){this._merge(this._newChartProps,this._newSeriesProps,this._newSessionProps),this._model.mainSeries().onChartStyleChanged(),this._model.updateScales(),this._model.chartThemeLoaded()}_merge(e,t,i){var s,r,n,o;const a=this._model;(0,ge.saveDefaultProperties)(!0),e&&(a.properties().childs().paneProperties.mergeAndFire(e.paneProperties),a.properties().childs().scalesProperties.mergeAndFire(e.scalesProperties)),"priceAxisProperties"in t&&a.mainSeries().priceScale().setMode({autoScale:null===(s=t.priceAxisProperties)||void 0===s?void 0:s.autoScale,percentage:null===(r=t.priceAxisProperties)||void 0===r?void 0:r.percentage,log:null===(n=t.priceAxisProperties)||void 0===n?void 0:n.log,lockScale:null===(o=t.priceAxisProperties)||void 0===o?void 0:o.lockScale}),a.mainSeries().properties().mergeAndFire(t),a.mainSeries().properties().saveDefaults(),a.mainSeries().createPaneView(),a.mainSeries().invalidateBarStylesCache(),a.recalculateAllPanes((0,ye.globalChangeEvent)()),a.fullUpdate(),a.properties().saveDefaults(),a.sessions().restoreState({properties:i},!1),(0,ge.saveDefaultProperties)(!1)}}const Jt=new x.TranslatedString("change resolution",l.t(null,void 0,i(932303)));class Qt extends k.UndoCommand{constructor(e,t,i){let s;super(Jt),this._sourceId=e.id();const r=(0,fe.isRangeStyle)(e.style()),n=p.Interval.isRange(t);!r&&n?s=11:r&&!n&&(s=(0,fe.getLastUsedStyle)()),this._newSymbolParams={interval:t,style:s},this._prevSymbolParams={symbol:e.symbol(),currency:e.currency(),unit:e.unit(),interval:e.interval(),style:e.style()},this._chartWidget=i}redo(){this._symbolSource().setSymbolParams(this._newSymbolParams),this._chartWidget.screen.show(!0)}undo(){this._symbolSource().setSymbolParams(this._prevSymbolParams),this._chartWidget.screen.show(!0)}_symbolSource(){return(0,o.ensureNotNull)(this._chartWidget.model().model().dataSourceForId(this._sourceId))}}var ei=i(24565),ti=i(559410)
;const ii=new x.TranslatedString("send {title} backward",l.t(null,void 0,i(216259))),si=new x.TranslatedString("bring {title} forward",l.t(null,void 0,i(356763))),ri=new x.TranslatedString("insert {title} after {target}",l.t(null,void 0,i(974055))),ni=new x.TranslatedString("insert {title} before {target}",l.t(null,void 0,i(411231))),oi=new x.TranslatedString("cut {title}",l.t(null,void 0,i(78755))),ai=new x.TranslatedString("cut sources",l.t(null,void 0,i(63649))),li=new x.TranslatedString("remove {title}",l.t(null,void 0,i(839859))),ci=new x.TranslatedString("remove drawings group",l.t(null,void 0,i(570653))),hi=new x.TranslatedString("move scale",l.t(null,void 0,i(804184))),di=new x.TranslatedString("stop syncing line tool(s)",l.t(null,void 0,i(157011))),ui=new x.TranslatedString("zoom out",l.t(null,void 0,i(809645))),pi=new x.TranslatedString("zoom in",l.t(null,void 0,i(119813))),_i=new x.TranslatedString("move drawing(s)",l.t(null,void 0,i(145356))),mi=new x.TranslatedString("load default drawing template",l.t(null,void 0,i(354597))),gi=new x.TranslatedString("apply factory defaults to selected sources",l.t(null,void 0,i(796996))),fi=new x.TranslatedString("change currency",l.t(null,void 0,i(222641))),vi=new x.TranslatedString("change unit",l.t(null,void 0,i(239028))),Si=new x.TranslatedString("clone line tools",l.t(null,void 0,i(205179))),yi=new x.TranslatedString("merge up",l.t(null,void 0,i(266143))),bi=new x.TranslatedString("merge down",l.t(null,void 0,i(162153))),wi=new x.TranslatedString("merge to pane",l.t(null,void 0,i(170746))),Pi=new x.TranslatedString("unmerge up",l.t(null,void 0,i(52540))),Ci=new x.TranslatedString("unmerge down",l.t(null,void 0,i(786949))),Ti=new x.TranslatedString("unmerge to new bottom pane",l.t(null,void 0,i(220057))),xi=new x.TranslatedString("move {title} to new right scale",l.t(null,void 0,i(545544))),Ii=new x.TranslatedString("move {title} to new left scale",l.t(null,void 0,i(411303))),Mi=new x.TranslatedString("make {title} no scale (Full screen)",l.t(null,void 0,i(774642))),Li=new x.TranslatedString("scroll time",l.t(null,void 0,i(170009))),Ai=new x.TranslatedString("scale time",l.t(null,void 0,i(235962))),ki=new x.TranslatedString("reset time scale",l.t(null,void 0,i(855064))),Ei=new x.TranslatedString("reset scales",l.t(null,void 0,i(721948))),Di=new x.TranslatedString("create {tool}",l.t(null,void 0,i(581791))),Bi=new x.TranslatedString("change {pointIndex} point",l.t(null,void 0,i(572032))),Vi=new x.TranslatedString("paste {title}",l.t(null,void 0,i(441601))),Ri=new x.TranslatedString("insert {title}",l.t(null,void 0,i(90743))),Ni=new x.TranslatedString("remove all studies",l.t(null,void 0,i(415516))),Oi=new x.TranslatedString("remove drawings",l.t(null,void 0,i(644656))),Fi=new x.TranslatedString("remove all studies and drawing tools",l.t(null,void 0,i(580171))),Wi=(new x.TranslatedString("turn line tools sharing off",l.t(null,void 0,i(128068))),new x.TranslatedString("share line tools in layout",l.t(null,void 0,i(977554))),
new x.TranslatedString("share line tools globally",l.t(null,void 0,i(64704))),l.t(null,void 0,i(875139)),(0,C.getLogger)("Chart.ChartUndoModel"));function zi(e,t){return{bringForwardEnabled:e.bringForwardEnabled||t.bringForwardEnabled,bringToFrontEnabled:e.bringToFrontEnabled||t.bringToFrontEnabled,sendBackwardEnabled:e.sendBackwardEnabled||t.sendBackwardEnabled,sendToBackEnabled:e.sendToBackEnabled||t.sendToBackEnabled}}function Hi(e){return new x.TranslatedString(e.name(),e.title())}function Ui(){return(0,Ee.drawOnAllCharts)().value()?1:0}class ji extends(r()){constructor(e,t,i,s,r,n,o,a,l,c,h){super(),this._createLineCommand=null,this._initialTimeScrollState=null,this._initialTimeScrollPos=null,this._scalePriceInfo=null,this._currentSourceMoveCommand=null,this._currentLineChangeCommand=null,this._currentCustomMoveCommand=null,this._zoomStack=new m.UndoStack,this._lineToolsDoNotAffectChartInvalidation=new P.FeatureToggleWatchedValue("do_not_invalidate_chart_on_changing_line_tools",!1),this._chartWidget=n,this.m_model=new(_t())(e,t,i,s,r,this,a,l,c,h),this._undoHistory=o,this._lineToolsGroupController=new ze({model:this._model.bind(this),pushUndoCommand:this._pushUndoCommand.bind(this),beginUndoMacro:(e,t)=>{this._undoHistory.beginUndoMacro(e).setCustomFlag("doesnt_affect_save",!!t)},endUndoMacro:this._undoHistory.endUndoMacro.bind(this._undoHistory),emitEvent:this.emitEvent.bind(this)})}undoHistory(){return this._undoHistory}setWatchedValue(e,t,i){this._undoHistory.setWatchedValue(e,t,i)}lineToolsGroupController(){return this._lineToolsGroupController}mergeAllScales(e){!function(e,t){e.beginUndoMacro("left"===t?M:L),e.model().panes().forEach((i=>{const s="left"===t?i.rightPriceScales():i.leftPriceScales(),r=("left"===t?i.leftPriceScales():i.rightPriceScales()).concat(s),n="overlay"===i.priceScalePosition(i.defaultPriceScale())?r[0]:i.defaultPriceScale();e.movePriceScale(i,n,t,0),r.forEach((t=>{if(t===n)return;let s=t.mainSource();for(;null!==s;){e.moveToScale(s,i,n,null,!0);const r=t.mainSource();if(r===s){A.logError("Loop detected while trying to merge scales");break}s=r}}))})),e.endUndoMacro(),e.model().fullUpdate()}(this,e)}movePriceScale(e,t,i,s){const r=new E(this._model(),e,t,i,s,hi);this._pushUndoCommand(r)}createLineTool({pane:e,point:t,linetool:i,properties:s,linkKey:r,ownerSource:n,disableSynchronization:a,sharingMode:l=Ui(),id:c}){if(("LineToolRegressionTrend"===i||"LineToolAnchoredVWAP"===i)&&!this.canCreateStudy())return(0,h.showTooManyStudiesNotice)(),null;const d=Di.format({tool:new x.TranslatedString(i,W.lineToolsLocalizedNames[i])});this.beginUndoMacro(d,this._lineToolsDoNotAffectChartInvalidation.value());const u=!a;this._createLineCommand=new H(this._model(),e,i,n||(0,o.ensureNotNull)(e.mainDataSource()),l,c);const p=this._createLineCommand.startCreatingLine(t,s,r||null),_=(0,o.ensureNotNull)(this._createLineCommand.line());let m=null;if(p&&(u&&this.finishLineTool(_),this._pushUndoCommand(this._createLineCommand),this._createLineCommand=null,m={points:_.normalizedPoints(),
interval:this.mainSeries().interval()}),u&&void 0===r&&(0,Ee.drawOnAllCharts)().value()&&_.isSynchronizable()){const e=(0,o.ensureNotNull)(this.model().externalTimeStamp(t.index)),s={point:{price:t.price,timeStamp:e},linetool:i,properties:_.properties(),symbol:this.mainSeries().symbol(),model:this.model(),linkKey:(0,o.ensureNotNull)(_.linkKey().value()),finalState:m,id:_.id()};_.isFixed()&&(s.pointPositionPercents=_.calcPositionPercents()),(0,Ee.createLineTool)(s)}return this.endUndoMacro(),_}continueCreatingLine(e,t,i,s){const r=(0,o.ensureNotNull)(this._createLineCommand);this.beginUndoMacro(r.text(),this._lineToolsDoNotAffectChartInvalidation.value());const n=(0,o.ensureNotNull)(this._model().lineBeingCreated()),a=r.continueCreatingLine(e,t,i,s);let l=null;if(a&&(this.finishLineTool(n),this._pushUndoCommand(r),this._createLineCommand=null,l={points:n.normalizedPoints(),interval:this.mainSeries().interval()}),r.drawOnAllCharts()&&n.isSynchronizable()){const i=(0,o.ensureNotNull)(this._model().externalTimeStamp(e.index));(0,Ee.continueLineTool)({point:{price:e.price,timeStamp:i},envState:t,finalState:l,model:this._model()})}return this.endUndoMacro(),a}continueExternalLine(e,t,i){const s=(0,o.ensureNotNull)(this._createLineCommand),r=s.continueCreatingLine(e,t,i);return r&&(this._pushUndoCommand(s),this._createLineCommand=null),r}finishLineTool(e){this._model().finishLineTool(e)}pasteImageAsLineTool(e,t,i,s){return null}loadRange(e){const t=this._model(),i=t.mainSeries().getSupportedResolution(e.res),s={val:e.val,res:i},r=t.appliedTimeFrame().value();return(null===r||!_(r,s))&&(this._pushUndoCommand(new Pe(t,s)),!0)}unlinkLines(e){const t=this.model();this.beginUndoMacro(di,this._lineToolsDoNotAffectChartInvalidation.value());for(const i of e)null!==i.linkKey().value()&&(0,Ee.removeLineTool)({withUndo:!0,model:this.model(),symbol:i.symbol(),linkKey:(0,o.ensureNotNull)(i.linkKey().value()),sourceTitle:Hi(i),lineToolState:i.state(!1),unlink:!0}),this._pushUndoCommand(new Pt(t,i));this.endUndoMacro()}zoomFromViewport(){const e=new bt((0,o.ensureDefined)(this._zoomStack.head()),this._zoomStack,!1);this._pushUndoCommand(e)}zoomToViewport(e,t,i,s,r){const n=new vt(this.m_model,e,t,i,s,r),o=new bt(n,this._zoomStack,!0);this._pushUndoCommand(o)}zoomStack(){return this._zoomStack}hoveredSource(){return this.m_model.hoveredSource()}setProperty(e,t,i,s){if(e&&e.value()!==t){const r=new Ae(e,t,i,this.m_model,s);this._pushUndoCommand(r),this.emitEvent("setProperty")}}withMacro(e,t,i){const s=this.beginUndoMacro(e,i);try{t()}finally{this.endUndoMacro()}return s}barsMarksSources(){return this.m_model.barsMarksSources()}removeAllDrawingTools(){this.beginUndoMacro(Oi,!0),this._removeAllDrawingToolsImpl(),this.endUndoMacro()}removeAllStudiesAndDrawingTools(){this.beginUndoMacro(Fi),this._removeAllDrawingToolsImpl(),this._removeAllStudiesImpl(),this.endUndoMacro()}removeAllStudies(){this.beginUndoMacro(Ni),this._removeAllStudiesImpl(),this.endUndoMacro()}canZoomIn(){return this.model().canZoomIn()}canZoomOut(){
return this.model().canZoomOut()}zoomOut(){const e=this.timeScale().width();if(this.canZoomOut()){try{this.beginUndoMacro(ui)}catch(e){return}(0,v.doAnimate)({to:e/5,onStep:e=>{this.startScaleTime(0),this.scaleTimeTo(e),this.endScaleTime()},onComplete:()=>this.endUndoMacro()})}}zoomIn(){const e=this.timeScale().width();if(this.canZoomIn()){try{this.beginUndoMacro(pi)}catch(e){return}(0,v.doAnimate)({to:e/5,onStep:e=>{this.startScaleTime(e),this.scaleTimeTo(0),this.endScaleTime()},onComplete:()=>this.endUndoMacro()})}}startMovingSources(e,t,i,s){e.filter((e=>e.doesMovingAffectsUndo())).length&&(this._currentSourceMoveCommand=new R(this.model(),e,_i,!1),e.every(f.isLineTool)&&this._currentSourceMoveCommand.setCustomFlag("doesnt_affect_save",this._lineToolsDoNotAffectChartInvalidation.value())),this.model().startMovingSources(e,t,i,new Map,s)}moveSources(e,t){this.model().moveSources(e,new Map,t)}endMovingSource(e,t){this.model().endMovingSources(e,void 0,t),null!==this._currentSourceMoveCommand&&(this._currentSourceMoveCommand.saveNewState(),this._pushUndoCommand(this._currentSourceMoveCommand)),this._currentSourceMoveCommand=null}startChangingLinetool(e,t,i,s,r){this._currentLineChangeCommand=new R(this.model(),[e],Bi.format({pointIndex:i}),!1),this._currentLineChangeCommand.setCustomFlag("doesnt_affect_save",this._lineToolsDoNotAffectChartInvalidation.value()),this.model().startChangingLinetool(e,t,i,s,r)}changeLinePoint(e,t){this.model().changeLinePoint(e,t)}endChangingLinetool(e){this.model().endChangingLinetool(e),null!==this._currentLineChangeCommand&&(this._currentLineChangeCommand.saveNewState(),this._pushUndoCommand(this._currentLineChangeCommand)),this._currentLineChangeCommand=null}setChartStyleProperty(e,t,i){if(e.value()!==t){const s=new be(e,t,this.mainSeries(),i,this.model(),this.chartWidget());this._pushUndoCommand(s),this.emitEvent("setChartStyleProperty"),(0,me.trackChartStyleChanged)(e.value())}}restorePropertiesForSource(e){(0,f.isLineTool)(e)?this._restoreLineToolFactoryDefaults(e):this._restoreStudyFactoryDefaults(e)}restoreLineToolsFactoryDefaults(e){1===e.length?this._restoreLineToolFactoryDefaults(e[0]):(this.beginUndoMacro(gi),e.forEach((e=>this._restoreLineToolFactoryDefaults(e))),this.endUndoMacro())}restoreState(e,t,i){return this.m_model.restoreState(e,t,i)}async clipboardCopy(e,t=this.selection().dataSources()){if(!(0,w.enabled)("datasource_copypaste"))return;const i=t.filter((e=>e.copiable()));if(0===i.length)return;for(const e of i)if((0,T.isStudy)(e)&&e.isChildStudy())throw new Error("Can not copy child study");const s=(0,g.clipboardDataForSources)(this._model().id(),i);return null!==s?e.write({app:JSON.stringify(s),text:s.title}):void 0}async clipboardCut(e,t=this.selection().dataSources()){if(!(0,w.enabled)("datasource_copypaste"))return;const i=t.filter((e=>e.copiable()));if(0===i.length)return;await this.clipboardCopy(e,i);const s=i.filter((e=>e.isUserDeletable()));if(0===s.length)return;const r=(1===s.length?oi:ai).format({title:Hi(s[0])});this.beginUndoMacro(r),
this.m_model.selectionMacro((()=>this.removeSources(s,!1,r)),!0),this.endUndoMacro()}async clipboardPaste(e,t){let i=null;if((0,w.enabled)("datasource_copypaste")&&(i=i||await e.read(),i.app)){const e=JSON.parse(i.app);if(null!==this.pasteSourceFromClip(t,e))return}await this._processSpecialLineToolsContents(e,i,t)}applyStudyTemplate(e,t){const i=new Ye(this._model(),e,t);this._pushUndoCommand(i),(0,ti.emit)("load_study_template")}createStudyInserter(e,t,i){const s={createStudy:(e,t,i,s,r,n,o,a,l,c,h)=>this.checkIfFeatureAvailable(e,n)?((0,y.trackEvent)("studies","Study_"+e.id),"Compare@tv-basicstudies"===e.id&&(0,y.trackEvent)("compare","symbol:"+t.symbol),this._insertStudy(e,t,s,r,n,o,a,l,c,null,h)):(Wi.logNormal("Cannot insert study "+e.id),null)};void 0!==i&&(s.createStub=()=>this.m_model.insertStudyStub(i).id(),s.removeStub=e=>this.m_model.removeStudyStub(e));const r=new ei.StudyInserter(e,this.m_model.studyMetaInfoRepository(),s);return r.setParentSources(t),r}replayStatus(){return this.m_model.replayStatus()}setReplayStatus(e){return this.m_model.setReplayStatus(e)}startCustomMoving(e,t,i){this._currentCustomMoveCommand=new ht(this.model(),e,t,i)}customMoveBeingProcessed(){return null!==this._currentCustomMoveCommand}processCustomMove(e){(0,o.ensureNotNull)(this._currentCustomMoveCommand).move(e)}endCustomMoving(){null!==this._currentCustomMoveCommand&&this._currentCustomMoveCommand.hasChanges()&&(this._pushUndoCommand(this._currentCustomMoveCommand),this._currentCustomMoveCommand=null)}panes(){return this.m_model.panes()}cloneLineTools(e,t){for(let t=0;t<Math.min(5,e.length);++t)(0,me.trackDrawingCloned)(e[t]);this.beginUndoMacro(Si,this._lineToolsDoNotAffectChartInvalidation.value());const i=new D(this._model(),e,t,Si);if(this._pushUndoCommand(i),(0,Ee.drawOnAllCharts)().value()){const e=i.newIds().map((e=>(0,o.ensureNotNull)(this.model().dataSourceForId(e))));this.copyToOtherCharts(e)}return this.endUndoMacro(),this.emitEvent("cloneLineTools"),i.newIds()}removeSource(e,t,i){this.lineBeingCreated()!==e?this.removeSources([e],t,li.format({title:Hi(e)}),i):this.cancelCreatingLine()}removeSelectedSources(){const e=this._model().selection().dataSources();if(!e.length)return;const t=(e.length>1?ci:li).format({title:Hi(e[0])});this.removeSources(e,!1,t)}removeSources(e,t,i,s){s||(e=e.filter((e=>e.isUserDeletable())));const r=this._model(),n=r.lineToolsGroupModel(),a=e.every(f.isLineTool)&&this._lineToolsDoNotAffectChartInvalidation.value();this.beginUndoMacro(i,a),r.selectionMacro((s=>{const a=new Map;e.forEach((e=>{if((0,f.isLineTool)(e)){const t=n.groupForLineTool(e);if(null!==t){const i=a.get(t)||[];i.push(e),a.set(t,i)}null!==e.linkKey().value()&&(0,Ee.removeLineTool)({withUndo:!0,model:this.model(),linkKey:(0,o.ensureNotNull)(e.linkKey().value()),symbol:this.model().mainSeries().symbol(),lineToolState:e.state(!1),sourceTitle:Hi(e)})}})),a.forEach(((e,t)=>{const i=new V.ExcludeLineToolsFromGroupUndoCommand(r,t,e);this._pushUndoCommand(i)}));const l=new B.RemoveSourcesCommand(r,e,i),c=l.removedIds()
;this._pushUndoCommand(l),!t&&c.length>0&&(1===c.length?this.emitEvent("removeSource",[c[0]]):this.emitEvent("removeSources",[c]))}),!0),this.endUndoMacro()}removeUnloadedLineTool({lineToolsSynchronizer:e,sourceTitle:t,linkKey:i,symbol:s,state:r,withUndo:n,unlink:o}){}async scrollToLineTool(e){const t=this.timeScale().logicalRange();if(null===t)return;const i=this.timeScale().barSpacing();let s=t.left();const r=e.points().map((e=>e.index)),n=this.timeScale().points().range().value();if(null===n)return;let a=n.firstIndex;const l=n.lastIndex,h=t.length()/2;if(0===r.length||r.some((e=>t.contains(e))))return;const d=()=>{const t=e.points().map((e=>e.index)),i=t.filter((e=>e<=l)).reduce(((e,t)=>null===e?t:Math.max(e,t)),null);return null!==i?i:t.reduce(((e,t)=>Math.min(e,t)))};let u,p=d();if(a-h>p){const t=e.points().map((e=>e.time)).filter(I.notUndefined).map((e=>e.valueOf()));if(0===t.length)return;const i=t.reduce(((e,t)=>Math.min(e,t)),t[0]);await this.model().gotoTime(i),p=d();const r=(0,o.ensureNotNull)(this.timeScale().logicalRange());if(r.contains(p))return;s=r.left(),a=(0,o.ensureNotNull)(this.timeScale().points().range().value()).firstIndex}a-h>p?(u=(s-a+h)*i,this.mainSeries().setGotoDateResult({timestamp:(0,o.ensureNotNull)(this.timeScale().points().valueAt(a)),eod:!0})):u=(s-p+1+h)*i,this.startScrollTime(0),(0,v.doAnimate)({onStep:(e,t)=>this.scrollTimeTo(t),from:0,to:Math.round(u),easing:c.easingFunc.easeInOutCubic,duration:c.dur,onComplete:()=>this.endScrollTime()})}mergeSourceUp(e){const t=new O.MergeUpUndoCommand(this._model(),e,yi);this._mergeUnmergeSource(e,t)}mergeSourceDown(e){const t=new O.MergeDownUndoCommand(this._model(),e,bi);this._mergeUnmergeSource(e,t)}mergeToPane(e,t,i){const s=this._model().panes().indexOf(t),r=new O.MergeToTargetPane(this._model(),e,s,wi,i);this._mergeUnmergeSource(e,r)}unmergeSourceUp(e){const t=new N.UnmergeUpUndoCommand(this._model(),e,Pi);this._mergeUnmergeSource(e,t)}unmergeSourceDown(e){const t=new N.UnmergeDownUndoCommand(this._model(),e,Ci);this._mergeUnmergeSource(e,t)}unmergeToNewBottomPane(e){const t=new N.UnmergeToNewBottomPane(this._model(),e,Ti);this._mergeUnmergeSource(e,t)}availableZOrderOperations(e){const t=this._model().lineToolsGroupModel(),i=e.filter(f.isLineTool),s=i.map((e=>t.groupForLineTool(e)));(0,o.assert)(new Set(s).size<=1,"Cannot move line tools from different group");const r=0===s.length?null:s[0];let n={bringForwardEnabled:!1,bringToFrontEnabled:!1,sendBackwardEnabled:!1,sendToBackEnabled:!1};const a=new Set(i);for(const t of(0,F.sortSources)(e)){if((0,f.isLineTool)(t)&&null!==r){const e=(0,F.sortSources)(r.lineTools().filter((e=>!a.has(e)||e===t)));n=zi(n,{bringForwardEnabled:t!==e[e.length-1],bringToFrontEnabled:t!==e[e.length-1],sendBackwardEnabled:t!==e[0],sendToBackEnabled:t!==e[0]});continue}const e=(0,o.ensureNotNull)(this._model().paneForSource(t)).sourcesByGroup().allExceptSpecialSources();if(0===e.length)continue;const i=t.zorder(),s=e[0].zorder(),l=e[e.length-1].zorder();n=zi(n,{bringForwardEnabled:i!==l,bringToFrontEnabled:i!==l,
sendBackwardEnabled:i!==s,sendToBackEnabled:i!==s})}return n}sendToBack(e){if(!this.availableZOrderOperations(e).sendToBackEnabled)throw new Error("Send to back operation is unavailable");let t=null;const i=e[0];if((0,f.isLineTool)(i)){const s=this._model().lineToolsGroupModel().groupForLineTool(i);if(null!==s){const i=s.lineTools();t=new re(this.model(),(0,F.sortSources)(e),i[0])}}null===t&&(t=new ee(this.model(),(0,F.sortSources)(e))),this._pushUndoCommand(t),this.emitEvent("changeZOrder",[e])}bringToFront(e){if(!this.availableZOrderOperations(e).bringToFrontEnabled)throw new Error("Bring to front operation is unavailable");let t=null;const i=e[0];if((0,f.isLineTool)(i)){const s=this._model().lineToolsGroupModel().groupForLineTool(i);if(null!==s){const i=s.lineTools();t=new ie(this.model(),(0,F.sortSources)(e),i[i.length-1])}}null===t&&(t=new Q(this.model(),(0,F.sortSources)(e))),this._pushUndoCommand(t),this.emitEvent("changeZOrder",[e])}sendBackward(e){if(!this.availableZOrderOperations(e).sendBackwardEnabled)throw new Error("Send backward operation is unavailable");const t=ii.format({title:Hi(e[0])});this._sendBackOrBringForward(t,(0,F.sortSources)(e),((e,t)=>new oe(this.model(),e,t)))}bringForward(e){if(!this.availableZOrderOperations(e).bringForwardEnabled)throw new Error("Bring forward operation is unavailable");const t=si.format({title:Hi(e[0])});this._sendBackOrBringForward(t,(0,F.sortSources)(e),((e,t)=>new le(this.model(),e,t)))}insertAfter(e,t){e=(0,F.sortSources)(e);const i=ri.format({title:Hi(e[0]),target:Hi(t)});this._insertAfterOrBefore(i,e,t,(()=>new ie(this.model(),e,t)))}insertBefore(e,t){e=(0,F.sortSources)(e);const i=ni.format({title:Hi(e[0]),target:Hi(t)});this._insertAfterOrBefore(i,e,t,(()=>new re(this.model(),e,t)))}detachToRight(e,t){(0,y.trackEvent)("Chart","Move to new right scale");const i=xi.format({title:Hi(e)}),s=new tt.MoveToNewPriceScaleUndoCommand(this.model(),e,t,"right",i);this._pushUndoCommand(s),this.emitEvent("moveSource",[e])}detachToLeft(e,t){(0,y.trackEvent)("Chart","Move to new left scale");const i=Ii.format({title:Hi(e)}),s=new tt.MoveToNewPriceScaleUndoCommand(this.model(),e,t,"left",i);this._pushUndoCommand(s),this.emitEvent("moveSource",[e])}detachNoScale(e,t){(0,y.trackEvent)("Chart","Make source no scale");const i=Mi.format({title:Hi(e)}),s=new tt.MoveToNewPriceScaleUndoCommand(this.model(),e,t,"overlay",i);this._pushUndoCommand(s),this.emitEvent("moveSource",[e])}moveToScale(e,t,i,s,r){(0,y.trackEvent)("Chart","Move source to target scale"),this.beginUndoMacro(s);const n=new tt.MoveToExistingPriceScaleUndoCommand(this.model(),e,t,i,s),o=r?null:(0,b.sourceNewCurrencyOnPinningToPriceScale)(e,i,this._model()),a=r?null:(0,mt.sourceNewUnitOnPinningToPriceScale)(e,i,this._model());this._pushUndoCommand(n),null!==o&&this.setPriceScaleCurrency(i,o),null!==a&&this.setPriceScaleUnit(i,a),this.endUndoMacro(),this.emitEvent("moveSource",[e])}startScrollTime(e){const t=this.timeScale();this._initialTimeScrollState={rightOffset:t.rightOffset(),barSpacing:t.barSpacing()},
this._initialTimeScrollPos=e,this.model().startScrollTime(e)}scrollTimeTo(e){null!==this._initialTimeScrollPos&&null!==this._initialTimeScrollState&&Math.abs(e-this._initialTimeScrollPos)>20&&(this._pushUndoCommand(new _e.TimeScaleChangeUndoCommand(this.model(),this._initialTimeScrollState,Li)),this._initialTimeScrollPos=null,this._initialTimeScrollState=null),this.model().scrollTimeTo(e)}endScrollTime(){this.model().endScrollTime(),this._initialTimeScrollPos=null,this._initialTimeScrollState=null}startScaleTime(e){const t=this.timeScale(),i={rightOffset:t.rightOffset(),barSpacing:t.barSpacing()};this._pushUndoCommand(new _e.TimeScaleChangeUndoCommand(this.model(),i,Ai)),this.model().startScaleTime(e)}scaleTimeTo(e){this.model().scaleTimeTo(e)}endScaleTime(){this.model().endScaleTime()}resetTimeScale(){const e=this.timeScale(),t={rightOffset:e.rightOffset(),barSpacing:e.barSpacing()};this._pushUndoCommand(new _e.TimeScaleChangeUndoCommand(this.model(),t,ki)),this.model().resetTimeScale()}startScalePrice(e,t,i,s){this._scalePriceInfo={priceScaleState:t.state(),tryMergeConsecutiveScales:s},this.model().startScalePrice(e,t,i)}scalePriceTo(e,t,i){this.model().scalePriceTo(e,t,i)}endScalePrice(e,t){this.model().endScalePrice(e,t);const i=(0,o.ensureNotNull)(this._scalePriceInfo);(0,n.default)(i.priceScaleState,t.state())||this._pushUndoCommand(new gt.PriceScaleChangeUndoCommand(this.model(),e,t,i.priceScaleState,i.tryMergeConsecutiveScales)),this._scalePriceInfo=null}startTwoPointsScalePrice(e,t,i,s,r){this._scalePriceInfo={priceScaleState:t.state(),tryMergeConsecutiveScales:r},this.model().startTwoPointsScalePrice(e,t,i,s)}twoPointsScalePriceTo(e,t,i,s){this.model().twoPointsScalePriceTo(e,t,i,s)}endTwoPointsScalePrice(e,t){this.model().endTwoPointsScalePrice(e,t);const i=(0,o.ensureNotNull)(this._scalePriceInfo);(0,n.default)(i.priceScaleState,t.state())||this._pushUndoCommand(new gt.PriceScaleChangeUndoCommand(this.model(),e,t,i.priceScaleState,i.tryMergeConsecutiveScales)),this._scalePriceInfo=null}resetPriceScale(e,t){const i=t.state();this.model().resetPriceScale(e,t),(0,n.default)(i,t.state())||this._pushUndoCommand(new gt.PriceScaleChangeUndoCommand(this.m_model,e,t,i))}rearrangePanes(e,t){const i=new pe(this._model(),e,t);this._pushUndoCommand(i)}movePane(e,t){const i=new pe(this._model(),e,t);this._pushUndoCommand(i)}readOnly(){return this.m_model.readOnly()}checkIfFeatureAvailable(e,t){let i=this.canCreateStudy();const s=t.length>0;return!this.readOnly()&&s&&(i=this.canCreateStudy(!0)),!!i||(s||(0,h.showTooManyStudiesNotice)(),!1)}pasteSourceFromClip(e,t,i){const s=t;if(!s||0===s.sources.length)return null;const r=e||(0,o.ensureNotNull)(this.model().paneForSource(this.mainSeries()));if(!s.sources.some((e=>"drawing"!==e.type||null!==r.clipboardLineToolOwnerSource(e.source.id))))return null;this.beginUndoMacro(Vi.format({title:s.title}));let n=0;const a=[],l=[];for(const t of s.sources)if("drawing"===t.type&&null!==r.clipboardLineToolOwnerSource(t.source.id)){const e=this.pasteLineTool(r,t);n<5&&((0,
me.trackDrawingPasted)(e),n+=1),l.push(e),a.push(e)}else"study"===t.type&&t.source&&t.source.metaInfo&&this.checkIfFeatureAvailable(new d.StudyMetaInfo(t.source.metaInfo),[])&&a.push(this.pasteStudy(t,i?e:void 0));return l.length&&this.selectionMacro((e=>{e.clearSelection(),l.forEach((t=>{e.addSourceToSelection(t,null)}))})),this.endUndoMacro(),a}pasteLineTool(e,t,i,s){t.source.state.intervalsVisibilities=(0,Lt.mergeIntervalVisibilitiesDefaults)(t.source.state.intervalsVisibilities),(0,Lt.makeIntervalsVisibilitiesVisibleAtInterval)(t.source.state.intervalsVisibilities,p.Interval.parse(this.model().mainSeries().interval()));const r=new Je(this.model(),t,e,i,s);this._pushUndoCommand(r);const n=r.source();return r.needCopyToOtherCharts()&&this.copyToOtherCharts([n]),this.selectionMacro((e=>{e.clearSelection(),e.addSourceToSelection(n,null)})),n}pasteStudy(e,t){const i=new ot(this.model(),e,null==t?void 0:t.id());this._pushUndoCommand(i);const s=(0,o.ensureNotNull)(i.state()).id;return(0,ti.emit)("study_event",s,"paste_study"),(0,o.ensureNotNull)(this._model().dataSourceForId(s))}setPriceScaleCurrency(e,t){const i=new Qe.SetPriceScaleCurrencyUndoCommand(e,t,this.chartWidget(),fi);this._pushUndoCommand(i)}setPriceScaleUnit(e,t){const i=new et.SetPriceScaleUnitUndoCommand(e,t,this.chartWidget(),vi);this._pushUndoCommand(i)}setSymbol(e,t){e.symbol()!==t&&this._pushUndoCommand(new st(e,t,this.chartWidget()))}setResolution(e,t){e===this.mainSeries()&&(t=e.getSupportedResolution(t)),p.Interval.isEqual(e.interval(),t)||this._pushUndoCommand(new Qt(e,t,this.chartWidget()))}chartLoadTheme(e,t,i){const s=new Xt(this.model(),e,t);i?s.redo():this._pushUndoCommand(s)}isJustClonedChart(){return this._chartWidget.isJustClonedChart()}copyToOtherCharts(e){const t=this.mainSeries(),i=t.syncModel(),s=this.timeScale();if(i)for(const r of e){if(!r.isSynchronizable())continue;const e=r.linkKey().value()||(0,S.randomHash)();r.linkKey().setValue(e);const n=r.state(!1),a=r.normalizedPoints(),l=r.properties().interval.value(),c=t.interval();let h;if(p.Interval.isEqual(l,c))h=a.map((e=>{const t=(0,o.ensureNotNull)(s.timePointToIndex(e.time_t))+e.offset;return{price:e.price,timeStamp:(0,o.ensureNotNull)(this.model().externalTimeStamp(t))}}));else{const e=i.createNewModelWithResolution(l);h=a.map((t=>({price:t.price,timeStamp:0===t.offset?t.time_t:e.projectTime(t.time_t,t.offset)})))}const d={...n,id:r.id(),linkKey:e,points:h,linetool:r.toolname,model:this.model(),symbol:t.symbol(),finalState:{points:a,interval:l},pointPositionPercents:r.isFixed()?r.calcPositionPercents():void 0,sharingMode:r.sharingMode().value()};(0,Ee.copyLineTool)(d)}}addPaneStretchFactorUndoCommand(e,t,i,s){const r=new at(this.model(),e,t,i,s);this._pushUndoCommand(r)}paneForSource(e){return this.m_model.paneForSource(e)}destroy(){this._lineToolsDoNotAffectChartInvalidation.destroy(),this.m_model.destroy()}moveSelectedToolsLeft(){return this._moveSelectedTools(2)}moveSelectedToolsUp(){return this._moveSelectedTools(0)}moveSelectedToolsRight(){return this._moveSelectedTools(3)}
moveSelectedToolsDown(){return this._moveSelectedTools(1)}insertStudyWithoutCheck(e,t,i){return this._insertStudy(e,t,{},!1,[],void 0,void 0,void 0,void 0,null!=i?i:null,void 0)}saveLineToolState(e,t){this._pushUndoCommand(new R(this.m_model,[e],t))}resetScales(){this.beginUndoMacro(Ei),this.resetTimeScale();for(const e of this.m_model.panes()){for(const t of e.leftPriceScales())this.resetPriceScale(e,t);for(const t of e.rightPriceScales())this.resetPriceScale(e,t)}this.endUndoMacro(),this.m_model.recalculateAllPanes((0,ye.viewportChangeEvent)())}shareLineTools(e,t){}canCreateStudy(e){return this.model().chartApi().canCreateStudy(e)}studiesMetaData(){return this.m_model.studiesMetaData()}_isCountedStudy(e){throw new Error("Not implemented")}_mergeUnmergeSource(e,t){this.beginUndoMacro(t.text());const i=(0,o.ensureNotNull)(this._model().paneForSource(e)),s=new Set(i.sourcesByGroup().lineSources().filter((t=>t.ownerSource()===e)));this._model().lineToolsGroupModel().groups().filter((e=>{const t=e.lineTools().some((e=>s.has(e))),i=e.lineTools().some((e=>!s.has(e)));return t&&i})).forEach((e=>{this._pushUndoCommand(new V.ExcludeLineToolsFromGroupUndoCommand(this._model(),e,e.lineTools()))})),this._pushUndoCommand(t),this.endUndoMacro()}_insertStudy(e,t,i,s,r,n,a,l,c,h,d){const u=Ri.format({title:e.description});this.beginUndoMacro(u);const p=new dt(this.model(),e,t,i,s,r,n,a,l,c,h||null,u);this._pushUndoCommand(p);const _=p.insertedStudy();if(void 0!==d){const e=new ut.SetPriceScaleModeCommand(d,(0,o.ensureNotNull)(_.priceScale()),null,this.model());this._pushUndoCommand(e)}return this.endUndoMacro(),_}async _processSpecialLineToolsContents(e,t,i){0}_insertAfterOrBefore(e,t,i,s){const r=(0,o.ensureNotNull)(this._model().paneForSource(i));if(t.some((e=>(0,f.isLineTool)(e)&&this._model().paneForSource(e)!==r)))throw new Error("Cannot insert line tool after target on another pane");this.beginUndoMacro(e),t.forEach((e=>{(0,o.ensureNotNull)(this.model().paneForSource(e))!==r&&this.mergeToPane(e,r)}));const n=s();this._pushUndoCommand(n),this.emitEvent("changeZOrder",[t]),this.endUndoMacro()}_sendBackOrBringForward(e,t,i){const s=new Map;t.forEach((e=>{const t=(0,o.ensureNotNull)(this._model().paneForSource(e)),i=s.get(t)||[];i.push(e),s.set(t,i)})),this.beginUndoMacro(e),s.forEach(((e,t)=>{this._pushUndoCommand(i(t,e))})),this.endUndoMacro(),this.emitEvent("changeZOrder",[t])}_moveSelectedTools(e){const t=this.model().selection().lineDataSources();if(0===t.length)return!1;if((0,Ee.lockDrawings)().value())return!0;const i=this.timeScale().visibleBarsStrictRange();if(null===i)return!1;const s=function(e){const t=new Map;for(const i of e){const e=i.ownerSource();if(null===e)continue;let s=t.get(e);if(void 0===s){const r=e.priceScale(),n=e.priceStep(),o=e.firstValue();if(null===r||null===n||null===o)continue;if(null===r.priceRange())continue;s={sources:[],priceScale:r,priceStep:n,startPrice:i.points()[0].price,firstValue:o},t.set(e,s)}s.sources.push(i)}return t}(t);if(0===s.size)return!1
;this.beginUndoMacro(_i,this._lineToolsDoNotAffectChartInvalidation.value());const r=i.firstBar(),n=this.timeScale().indexToCoordinate(r),o=r+(3===e?1:2===e?-1:0),l=this.timeScale().indexToCoordinate(o);return Ee.isDirectionalMovementActive.setValue(!0),s.forEach((t=>{const{startPrice:i,priceStep:s,priceScale:c,firstValue:h}=t,d=i+(0===e?s:1===e?-s:0),u=c.priceToCoordinate(i,h),p=c.priceToCoordinate(d,h),_={logical:{index:r,price:i},screen:new a.Point(n,u)},m={logical:{index:o,price:d},screen:new a.Point(l,p)};this.startMovingSources(t.sources,_,null),this.moveSources(m),this.endMovingSource(!1,!0)})),Ee.isDirectionalMovementActive.setValue(!1),this.endUndoMacro(),!0}_restoreStudyFactoryDefaults(e){const t=new Mt(this.m_model,e.properties());this._pushUndoCommand(t)}_restoreLineToolFactoryDefaults(e){this.beginUndoMacro(mi,this._lineToolsDoNotAffectChartInvalidation.value()),this.saveLineToolState(e,mi);const t=new It(this.m_model,e.properties(),mi);this._pushUndoCommand(t),this.saveLineToolState(e,mi),this.endUndoMacro(),this.model().updateSource(e)}_removeAllDrawingToolsImpl(e){this.selectionMacro((()=>{this.lineBeingCreated()&&this.cancelCreatingLine();this.dataSources().filter(f.isLineTool).filter((e=>e.isActualSymbol()&&e.isUserDeletable())).filter((t=>!e||e===t.toolname)).forEach((e=>this.removeSource(e,!1)))}),!0)}_removeAllStudiesImpl(){const e=this.dataSources(),t=e.filter(T.isStudy).filter((e=>!e.isChildStudy()&&e.removeByRemoveAllStudies())),i=e.filter(T.isStudyStub);t.concat(i).forEach((e=>this.removeSource(e,!1)))}}},314088:(e,t,i)=>{"use strict";var s=i(922157),r=i(650151).ensureNotNull,n=i(650151).assert,o=i(929357).ChartModelBase,a=i(232468).isLineTool,l=i(512666).Watermark,c=i(601227).CheckMobile,h=i(706486).InvalidationMask,d=i(706486).InvalidationLevel;const{globalChangeEvent:u,sourceChangeEvent:p}=i(744687);var _=i(663890),m=_.isStudy,g=_.isFundamentalStudy,f=i(358076),v=i(783204).MainSeriesScaleRatioProperty,S=i(10145).scaleRatio,y=i(24565).StudyInserter,b=i(599015).dateFormatProperty,w=i(997753).timeHoursFormatProperty,P=i(559410),C=i(380760).StudyColorRotatorFactory,T=i(484727),x=i(671126).AppliedTimeFrame;i(241731).ReplayStatus,T.enabled("fix_left_edge");class I extends o{constructor(e,t,i,s,r,n,o,a,c,h){super(e,t,i,s,r,n,o,a,c,h);var d=this;this._mainSeriesScaleRatioProperty=new v(this),this.m_mainSeries.dataEvents().completed().subscribe(this,function(){this._scrollingState&&this.gotoTime()}.bind(this)),this.m_mainSeries.onIntervalChanged().subscribe(this,(function(){this._recalcVRStudiesParams.oldStartVisibleIndex=NaN,this._recalcVRStudiesParams.oldEndVisibleIndex=NaN})),this._readOnly||(this.m_mainSeries.properties().addChild("priceAxisProperties",this.m_mainSeries.m_priceScale.properties()),this._properties.paneProperties.legendProperties.showStudyTitles.listeners().subscribe(this,(function(e){e.value()||d._properties.paneProperties.legendProperties.showStudyArguments.setValue(!1)}))),this._watermarkSource=this._options.watermarkEnabled?new l(this,this.m_mainSeries):null,
f.hideAllDrawings().subscribe(this,this._onDrawingsVisibilityChanged),f.hideAllIndicators().subscribe(this,this._onIndicatorsVisibilityChanged),this._properties.scalesProperties.listeners().subscribe(this,I.prototype.fullUpdate),this._studyShiftColorStartOffset=void 0,this._linePointBeingEdited=null,this._lineBeingEdited=null,b.subscribe(this,this._updateDateTimeFormatter),w.subscribe(this,this._updateDateTimeFormatter),this.mainSeries().properties().interval.subscribe(this,this._updateDateTimeFormatter),this._updateDateTimeFormatter(),this._studyColorRotatorFactory=new C(this),this._dataSourceCollectionChanged.subscribe(this,this._updateShowLegendProperty.bind(this)),this._properties.paneProperties.legendProperties.showLegend.subscribe(this,this._updateShowLegendProperty),this._appliedTimeFrame=new x(this),this.mainSeries().onTimeFrameApplied().subscribe(this,(function(e){var t=null!==e?{res:this.mainSeries().interval(),val:e}:null;this.appliedTimeFrame().setValue(t)}))}applyPreferences(e){for(var t in e)void 0!==this._properties[t]&&"m_mainSeries"!==this._properties[t]&&this._properties[t].mergeAndFire(e[t]);void 0!==e.timeScale&&(this._timeScale.defaultRightOffset().setValue(e.timeScale.defaultRightOffset),this._timeScale.defaultRightOffsetPercentage().setValue(e.timeScale.defaultRightOffsetPercentage),this._timeScale.usePercentageRightOffset().setValue(e.timeScale.usePercentageRightOffset)),this._properties.saveDefaults(),this.m_mainSeries.applyPreferences(e.mainSeries),this.sessions().applyPreferences(e.sessions),this.recalculateAllPanes(u()),this.fullUpdate()}timezone(){return this._properties.timezone.value()}initConnection(){this._chartApi.switchTimezone(this.timezone())}updatePane(e){var t=this._paneInvalidationMask(e);this.invalidate(t)}fullUpdate(){this.invalidate(h.full())}lightUpdate(){this.invalidate(h.light())}studiesMetaData(){return this._studiesMetaData}studyVersioning(){return this._studyVersioning}startNotStartedStudies(){if(!this.m_mainSeries.isStarted())throw new Error("Cannot start studies: main series is not started");for(var e=this.dataSources(),t=0;t<e.length;t++)m(e[t])&&!e[t].isStarted()&&e[t].restart&&e[t]!==this.m_mainSeries&&e[t].restart()}readOnly(){return this._readOnly}_onDrawingsVisibilityChanged(e){for(var t=!1===e.value(),i=this.dataSources(),s=0;s<i.length;s++){var r=i[s],n=a(r)&&r.properties().visible.value();t&&n?P.emit("drawing_event",r.id(),"show"):!t&&n&&P.emit("drawing_event",r.id(),"hide")}this.selectionMacro((function(e){e.clearSelection()}))}_onIndicatorsVisibilityChanged(){var e=this.allStudies().filter((function(e){return e.properties().visible.value()&&e.canBeHiddenByGlobalFlag()}));if(0!==e.length){for(var t=!1,i=0;i<e.length;i++)if(this.selection().isSelected(e[i])){t=!0;break}t?this.selectionMacro((function(e){e.clearSelection()})):this.lightUpdate()}}mainSeries(){return this.m_mainSeries}timeScale(){return this._timeScale}watermarkSource(){return this._watermarkSource}priceScaleSlotsCount(){var e=0,t=0;this._panes.forEach((function(i){
e=Math.max(i.leftPriceScales().length,e),t=Math.max(i.rightPriceScales().length,t)}));var i=e+t;if(c.any()){var s=this.paneForSource(this.mainSeries()),r=s.priceScalePosition(this.mainSeries().priceScale()),n="right"===r;return"overlay"===r&&(n=s.rightPriceScales().length>0),n?{left:0,right:1,totallySlots:i}:{left:1,right:0,totallySlots:i}}return{left:e,right:t,totallySlots:e+t}}setPriceAutoScale(e,t,i){e.setPriceAutoScale(t,i),this.invalidate(this._paneInvalidationMask(e,d.Light))}updateScales(e,t){this._undoModel._chartWidget._updateScalesActions()}mainSeriesScaleRatioProperty(){return this._mainSeriesScaleRatioProperty}mainSeriesScaleRatioPropertyOnChanged(){this._mainSeriesScaleRatioProperty.listeners().fire(this._mainSeriesScaleRatioProperty)}mainSeriesScaleRatio(){return S(this._timeScale,this.m_mainSeries.priceScale())}setMainSeriesScaleRatio(e){this.paneForSource(this.m_mainSeries).applyPriceScaleRatio(this.m_mainSeries.priceScale(),e)}restoreFactoryDefaults(e){e.restoreFactoryDefaults(),this.recalcVisibleRangeStudies(!0)}orderedDataSources(e){var t=[];t.push(this.m_crossHairSource);for(var i=0;i<this._panes.length;i++){var s=this._panes[i].sourcesByGroup().all().slice();e&&s.reverse(),t=t.concat(s)}return t}dataSourceForId(e){for(var t,i=0;i<this._panes.length;++i)if(t=this._panes[i].dataSourceForId(e))return t;return null}onSyncScrollNeeded(e){var t=this._undoModel._chartWidget;if(t._chartWidgetCollection){var i=this.mainSeries().syncModel();if(i){var s=1e3*this._timeScale.points().roughTime(e,i.projectTime.bind(i));t._chartWidgetCollection.syncScroll(s,this)}}}updateTimeScaleBaseIndex(e){var t=this.mainSeries().bars();t.isEmpty()||this._updateBaseIndex(r(t.lastIndex()),e&&e.index>0)}createStudyInserter(e){return new y(e,this._studiesMetaInfoRepository,{createStudy:this.insertStudyWithParams.bind(this)})}studyInserted(){return this._studyInserted}lineBeingEdited(){return this._lineBeingEdited}linePointBeingEdited(){return this._linePointBeingEdited}calculateDefaultTags(){for(var e=[],t=this.dataSources(),i=0;i<t.length;i++){var s=t[i];s.tags&&(e=e.concat(s.tags()))}return e}_sendTo(e,t){var i={},s=this;for(var r in e.forEach((function(e){var t=s.paneForSource(e),r=s._panes.indexOf(t);i[r]||(i[r]=[]),i[r].push(e)})),i){t(s._panes[r],i[r])}this.fullUpdate()}sendToBack(e){this._sendTo(e,(function(e,t){e.sendToBack(t)}))}bringToFront(e){this._sendTo(e,(function(e,t){e.bringToFront(t)}))}allLineTools(){return this._getAllSources(a)}getStudyById(e){var t=this.dataSourceForId(e);return null!==t&&m(t)?t:null}getLineToolById(e){var t=this.dataSourceForId(e);return null!==t&&a(t)?t:null}setInterval(e,t){var i=setInterval(e,t);return this._modelIntervals.push(i),i}clearInterval(e){clearInterval(e);var t=this._modelIntervals.indexOf(e);t>-1&&this._modelIntervals.splice(t,1)}clearIntervals(){for(var e=0;e<this._modelIntervals.length;e++)clearInterval(this._modelIntervals[e]);this._modelIntervals=[]}destroy(){this.mainSeries().properties().childs().showCountdown.unsubscribeAll(this),
this.mainSeries().onTimeFrameApplied().unsubscribeAll(this),this.mainSeries().onIntervalChanged().unsubscribeAll(this),this._appliedTimeFrame.destroy(),this.clearIntervals(),f.hideAllDrawings().unsubscribe(this,this._onDrawingsVisibilityChanged),f.hideAllIndicators().unsubscribe(this,this._onIndicatorsVisibilityChanged),this.resetDeferredStudies(),this.allStudies().forEach((e=>this.removeSource(e))),Array.from(this._customSourcesMap.keys()).forEach(this._removeCustomSource,this),n(0===this._topmostCustomSources.length),n(0===this._fgCustomSources.length),n(0===this._bgCustomSources.length),n(0===this._allCustomSources.length),n(0===this._customSourcesMap.size);for(var e=0;e<this._panes.length;e++)this._panes[e].destroy();this._panes.length=0,this._sessions=null,this.m_mainSeries.onStyleChanged().unsubscribe(this._timeScale,this._timeScale.invalidateVisibleBars),this._timeScale.visibleBarsStrictRangeChanged().unsubscribe(this.m_mainSeries,this.m_mainSeries.clearHighLowPriceCache),this._timeScale.visibleBarsStrictRangeChanged().unsubscribe(this.m_mainSeries,this.m_mainSeries.clearAveragePriceCache),this._timeScale.barSpacingChanged().unsubscribeAll(this),this._timeScale.onScroll().unsubscribeAll(this),this._timeScale.destroy(),b.unsubscribe(this,this._updateDateTimeFormatter),w.unsubscribe(this,this._updateDateTimeFormatter),this.mainSeries().properties().interval.unsubscribe(this,this._updateDateTimeFormatter),this._trendLineStatsCache&&this._trendLineStatsCache.destroy(),this._fibRetracementLabelsCache&&this._fibRetracementLabelsCache.destroy(),this._properties.paneProperties.legendProperties.showLegend.unsubscribeAll(this),this._dataSourceCollectionChanged.unsubscribeAll(this),this.m_crossHairSource.destroy(),super.destroy()}listUserStudies(e){var t=[];e=e||{};for(var i=0;i<this._panes.length;i++)for(var s=this._panes[i].dataSources(),r=0;r<s.length;r++){var n=s[r];if(m(n)&&!g(n)&&n.showInObjectTree()){var o=n.metaInfo&&n.metaInfo();if(o){var a=o.id;if(e.dontCountVolume&&"Volume@tv-basicstudies"===a)continue;if(e.dontCountCompare&&"Compare@tv-basicstudies"===a)continue;if(e.dontCountOverlay&&"Overlay@tv-basicstudies"===a)continue}t.push(o.shortDescription)}}return t}restoreSource(e,t,i,s,r){var n,o;n=e?this.createPane(t):this.panes()[t];var a=s.type.toLowerCase().startsWith("study");if(!(o=a?n.restoreStudy(s):n.restoreLineTool(s)))return null;var l=null;if(r?l=n.getPriceScaleById(r.id):o.ownerSource()&&(l=o.ownerSource().priceScale()),l)o.setPriceScale(l),l.addDataSource(o);else{l=n.createPriceScaleAtPosition(r.position,r.priceScaleIndex);r&&r.id&&l.setId(r.id),o.setPriceScale(l),l.addDataSource(o)}if(!e&&i&&i.overlayPriceScales){var c=this.dataSources().filter((function(e){return void 0!==i.overlayPriceScales[e.id()]}));c.forEach(n.removeSourceFromPriceScale.bind(n));var h=new Map;c.forEach((function(e){var t,s=i.overlayPriceScales[e.id()];h.has(s.id)?t=h.get(s.id):((t=n.createPriceScaleAtPosition("overlay")).restoreState(s),h.set(s.id,t)),t.addDataSource(e),e.setPriceScale(t)}))}return o.start(),
o.restore&&o.restore(),e&&n.restoreState(i,!1,this.version()),a&&(this.recalculateAllPanes(p(o.id())),this.mainSeries().invalidateBarColorerCache(),this.fullUpdate()),o}cancelRequestSelectPoint(){this.m_crossHairSource.cancelRequestSelectPoint()}requestSelectPoint(e){return this.m_crossHairSource.requestSelectPoint(e)}onPointSelected(){return this.m_crossHairSource.onPointSelected()}isSeriesStyleSupported(e){return this.m_mainSeries.isStyleSupported(e)}getStudyShiftColorStartOffset(){return this._studyShiftColorStartOffset}setStudyShiftColorStartOffset(e){this._studyShiftColorStartOffset=e}isInReplay(){return this.m_mainSeries.isInReplay()}onInReplayStateChanged(){return new s}switchToReplay(e,t){0}switchToRealtime(){0}rendererOptionsProvider(){return this._rendererOptionsProvider}priceAxisRendererOptions(){return this._rendererOptionsProvider.options()}isPriceScaleVisible(e){var t=this.paneForSource(e.mainSource()),i=t.priceScalePosition(e);if("overlay"===i)return!0;var s=this.priceScaleSlotsCount();return t.priceScaleIndex(e,i)<s[i]}studyMetaInfoRepository(){return this._studiesMetaInfoRepository}studiesColorRotatorFactory(){return this._studyColorRotatorFactory}}e.exports=I},458013:(e,t,i)=>{"use strict";var s=i(779292).makeFont,r=i(779292).parseFont,n=i(817808).getLogger;const{drawPoly:o}=i(664114);var a=n("Model.ChartTradingUtils"),l={_fontHeightCache:{},_parsedColorCache:{},_parseColor:function(e){if(this._parsedColorCache[e])return this._parsedColorCache[e];var t=document.createElement("div");t.style.color=e;var i=t.style.color.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i)||t.style.color.match(/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*\.?\d+)\s*\)$/i),s={r:i[1],g:i[2],b:i[3],a:i[4]||"1"};return this._parsedColorCache[e]=s,s},getColorFromProperties:function(e,t){var i=1-t.value()/100,s=this._parseColor(e.value());return"rgba("+s.r+","+s.g+","+s.b+","+i+")"},setColorToProperties:function(e,t,i){var s=this._parseColor(e);t.setValue("rgb("+s.r+","+s.g+","+s.b+")");var r=100*(1-s.a);i.setValue(Math.max(0,Math.min(r,100)))},getFontFromProperties:function(e,t,i,r){return s(t.value(),e.value(),r.value()?"italic":"",i.value()?"bold":"")},setFontToProperties:function(e,t,i,s,n){var o=r(e);null!==o?(o.family.length>0&&t.setValue(o.family),i.setValue(o.size),s.setValue(o.bold),n.setValue(o.italic)):a.logError("Invalid font: "+e)},fontHeight:function(e){if(!this._fontHeightCache[e]){var t=document.createElement("span");t.appendChild(document.createTextNode("height")),document.body.appendChild(t),t.style.cssText="font: "+e+"; white-space: nowrap; display: inline;";var i=t.offsetHeight;document.body.removeChild(t),this._fontHeightCache[e]=Math.ceil(i)}return this._fontHeightCache[e]},drawPolyHoverOrPress:function(e,t,i,s){s?(e.save(),e.fillStyle="rgba(0, 0, 0, 0.15)",o(e,t,!0),e.restore()):i&&(e.save(),e.fillStyle="rgba(0, 0, 0, 0.1)",o(e,t,!0),e.restore())},repaint:function(e){e.lightUpdate()},roundToMinTick:function(e,t){var i=1/e.mainSource().base();return i*Math.round(t/i)}};e.exports=l},
902864:(e,t,i)=>{"use strict";var s=i(440097).TranslatedString,r=i(131227).doAnimate,n=i(202529).ChartUndoModelBase,o=i(508547).saveDefaultProperties,a=i(144070).UndoCommand,l=i(706028).ApplyLineToolTemplateUndoCommand,c=i(264368).SetPriceScaleSelectionStrategyCommand,h=i(172687).SetScaleRatioPropertiesCommand,d=i(32133).trackEvent,u=i(210914).RestoreDefaultsPreferencesUndoCommand,p=i(974350).SetPriceScaleModeCommand,_=i(340116).PriceScaleChangeUndoCommand,m=i(392987).preferencesByWhiteList,g=new s("move left",i(509806).t(null,void 0,i(415086))),f=new s("move right",i(509806).t(null,void 0,i(461711))),v=new s("toggle auto scale",i(509806).t(null,void 0,i(863060))),S=new s("toggle lock scale",i(509806).t(null,void 0,i(121203))),y=new s("toggle regular scale",i(509806).t(null,void 0,i(733714))),b=new s("toggle indexed to 100 scale",i(509806).t(null,void 0,i(98860))),w=new s("toggle percentage scale",i(509806).t(null,void 0,i(568642))),P=new s("toggle log scale",i(509806).t(null,void 0,i(160166))),C=new s("invert scale",i(509806).t(null,void 0,i(794245))),T=new s("remove pane",i(509806).t(null,void 0,i(847637))),x=new s("apply all chart properties",i(509806).t(null,void 0,i(64034))),I=new s("set price scale selection strategy to {title}",i(509806).t(null,void 0,i(669485)));class M extends a{constructor(e,t){super(x),this._model=e,this._undoModel=e.undoModel(),this._newProperties=t,function(e,t){var i={hollowCandle:{related:"candle"}};for(var s in["candleStyle","hollowCandleStyle","haStyle"].forEach((function(t){e[t].wickUpColor=e[t].wickUpColor||e[t].wickColor,e[t].wickDownColor=e[t].wickDownColor||e[t].wickColor})),t.vertGridProperties=t.vertGridProperties||t.gridProperties,t.horzGridProperties=t.horzGridProperties||t.gridProperties,i)if(!e[s+"Style"]){var r=e[i[s].related+"Style"];e[s+"Style"]=TradingView.clone(r)}}(this._newProperties.mainSeries,this._newProperties.paneProperties),this._oldProperties=m(e,e.mainSeries())}_merge(e){o(!0),this._model.applyPreferences(e),o(!1)}redo(){this._merge(this._newProperties),this._model.mainSeries().onChartStyleChanged(),this._model.updateScales()}undo(){this._merge(this._oldProperties),this._model.mainSeries().onChartStyleChanged(),this._model.updateScales()}}t.ChartUndoModel=class extends n{constructor(e,t,i,s,r,n,o,a,l,c,h){super(e,t,i,s,r,n,o,a,l,c,h),this.beginUndoMacro=(e,t)=>{var i=o.beginUndoMacro(e);return i.setCustomFlag("doesnt_affect_save",t),i},this.endUndoMacro=o.endUndoMacro.bind(o),this.createUndoCheckpoint=o.createUndoCheckpoint.bind(o),this.undoToCheckpoint=o.undoToCheckpoint.bind(o)}version(){return this.m_model.version()}createPane(e){return this.m_model.createPane(e)}restart(){this.m_model.restart()}disconnect(){this.m_model.disconnect()}studyVersioning(){return this.m_model.studyVersioning()}chartModel(){return this._model()}_model(){return this.m_model}pushUndoCommand(e){this._pushUndoCommand(e)}_pushUndoCommand(e){this._undoHistory.pushUndoCommand(e)}startScrollPrice(e,t,i){t.isAutoScale()||(this._initialPriceScrollState=t.state(),
this._initialPriceScrollPos=i,this.chartModel().startScrollPrice(e,t,i))}scrollPriceTo(e,t,i){t.isAutoScale()||(this._initialPriceScrollPos&&Math.abs(this._initialPriceScrollPos-i)>20&&(this.pushUndoCommand(new _(this.m_model,e,t,this._initialPriceScrollState)),delete this._initialPriceScrollState,delete this._initialPriceScrollPos),this.chartModel().scrollPriceTo(e,t,i))}endScrollPrice(e,t){t.isAutoScale()||(delete this._initialPriceScrollState,delete this._initialPriceScrollPos,this.chartModel().endScrollPrice(e,t))}setPriceAutoScale(e,t,i){this.pushUndoCommand(new _(this.m_model,e,t,t.state())),this.chartModel().setPriceAutoScale(e,t,i)}setWidth(e){this.m_model.setWidth(e)}setPaneHeight(e,t){this.m_model.setPaneHeight(e,t)}gridSource(){return this.m_model.gridSource()}watermarkSource(){return this.m_model.watermarkSource()}publishedChartsTimelineSource(){return this.m_model.publishedChartsTimelineSource()}crossHairSource(){return this.m_model.crossHairSource()}model(){return this.m_model}chartWidget(){return this._chartWidget}mainSeries(){return this.m_model.m_mainSeries}mainSeriesScaleRatioProperty(){return this.m_model.mainSeriesScaleRatioProperty()}timeScale(){return this.m_model.timeScale()}selectionMacro(e,t){return this.m_model.selectionMacro(e,t)}setHoveredSource(e,t){this.m_model.setHoveredSource(e,t)}selection(){return this.m_model.selection()}onSelectedSourceChanged(){return this.m_model.onSelectedSourceChanged()}activeStrategySource(){return this.m_model.activeStrategySource()}invalidate(e){this.m_model.invalidate(e)}setCurrentPosition(e,t,i,s){this.m_model.setCurrentPosition(e,t,i,s)}setAndSaveCurrentPosition(e,t,i,s){this.m_model.setAndSaveCurrentPosition(e,t,i,s)}setProperties(e,t,i){var s=this;this.beginUndoMacro(i),this.m_model.selectionMacro((function(){for(var r=0;r<e.length;r++)s.setProperty(e[r],t[r],i)})),this.endUndoMacro()}setPriceScaleMode(e,t,i){for(var s=Object.keys(e),r=t.mode(),n=!1,o=0;o<s.length;o++)if(r[s[o]]!==e[s[o]]){n=!0;break}if(n){var a=new p(e,t,i,this.m_model);this.pushUndoCommand(a)}}setPriceScaleSelectionStrategy(e){if(this.m_model.properties().priceScaleSelectionStrategyName.value()!==e){d("Chart","Change PriceScale Selection Strategy");var t=I.format({title:e});this.beginUndoMacro(t),this.setProperty(this.m_model.properties().priceScaleSelectionStrategyName,e,t);var i=new c(this.m_model,e,t);this.pushUndoCommand(i),this.endUndoMacro()}}setScaleRatioProperty(e,t,i){if(e.value()!==t){var s=new h(e,t,i,this.m_model);this.pushUndoCommand(s)}}lineBeingCreated(){return this.m_model.lineBeingCreated()}paneBeingCreatedLineOn(){return this.m_model.paneBeingCreatedLineOn()}cancelCreatingLine(){this.m_model.cancelCreatingLine()}lineCancelled(){return this.m_model.lineCancelled()}lineBeingEdited(){return this.m_model.lineBeingEdited()}sourcesBeingMoved(){return this.m_model.sourcesBeingMoved()}dataSources(){return this.m_model.dataSources()}orderedDataSources(e){return this.m_model.orderedDataSources(e)}dataSourceForId(e){return this.m_model.dataSourceForId(e)}state(e,t,i,s){
return this.m_model.state(e,t,i,s)}calculateDefaultTags(){return this.m_model.calculateDefaultTags()}onTagsChanged(){return this.m_model.onTagsChanged()}moveLeft(){try{this.beginUndoMacro(g)}catch(e){return}var e=this.m_model.timeScale().width(),t=this;r({to:e/5,onStep:function(e){t.startScrollTime(e),t.scrollTimeTo(0),t.endScrollTime()},onComplete:function(){t.endUndoMacro()}})}moveRight(){try{this.beginUndoMacro(f)}catch(e){return}var e=this.m_model.timeScale().width(),t=this;r({to:e/5,onStep:function(e){t.startScrollTime(0),t.scrollTimeTo(e),t.endScrollTime()},onComplete:function(){t.endUndoMacro()}})}scrollChart(e){this.m_model.scrollEnabled()&&(this.startScrollTime(0),this.scrollTimeTo(e),this.endScrollTime())}scrollChartByBar(e){if(this.m_model.scrollEnabled()){var t=e*this.m_model.timeScale().barSpacing();this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()}}restorePreferences(){var e=new u(this.model());this.pushUndoCommand(e)}applyPreferences(e){var t=new M(this.model(),e);this.pushUndoCommand(t)}applyLineToolTemplate(e,t,i){this.beginUndoMacro(i),this.saveLineToolState(e,i);var s=new l(e,t,i);this.pushUndoCommand(s),this.saveLineToolState(e,i),this.endUndoMacro(),this.model().updateSource(e)}isInReplay(){return this.m_model.isInReplay()}switchToReplay(e,t){}switchToRealtime(){}togglePriceScaleAutoScaleMode(e){var t={autoScale:!e.isAutoScale()};this.setPriceScaleMode(t,e,v)}togglePriceScaleLockScaleMode(e){var t={lockScale:!e.isLockScale()};this.setPriceScaleMode(t,e,S)}setPriceScaleRegularScaleMode(e){this.setPriceScaleMode({log:!1,percentage:!1,indexedTo100:!1},e,y)}togglePriceScaleIndexedTo100ScaleMode(e){var t={indexedTo100:!e.isIndexedTo100()};this.setPriceScaleMode(t,e,b)}togglePriceScalePercentageScaleMode(e){var t={percentage:!e.isPercentage()};this.setPriceScaleMode(t,e,w)}togglePriceScaleLogScaleMode(e){var t={log:!e.isLog()};this.setPriceScaleMode(t,e,P)}invertPriceScale(e){var t=e.properties().isInverted;this.setProperty(t,!t.value(),C)}removePane(e){var t=this.m_model.panes()[e].dataSources().slice();this.removeSources(t,!1,T)}}},992223:(e,t,i)=>{"use strict";var s;i.d(t,{ColorType:()=>s}),function(e){e.Solid="solid",e.Gradient="gradient"}(s||(s={}))},588535:(e,t,i)=>{"use strict";i.d(t,{currencyUnitVisibilityProperty:()=>o,currencyUnitVisibilityOptions:()=>a,migrateShowCurrencyAndShowUnitProperties:()=>c,restoreCurrencyUnitVisibilitySettingsValue:()=>h});var s=i(734137),r=i(870122),n=i.n(r);const{property:o,availableValues:a}=(0,s.createVisibilityController)("PriceAxisCurrencyAndUnit.visibility");let l=!1;function c(e,t){l||(l=!0,void 0===n().getValue("PriceAxisCurrencyAndUnit.visibility")&&o().setValue(e||t?"alwaysOn":"alwaysOff"))}function h(){o().setValue("visibleOnMouseOver"),n().remove("PriceAxisCurrencyAndUnit.visibility")}},658358:(e,t,i)=>{"use strict";i.d(t,{sourceNewCurrencyOnPinningToPriceScale:()=>r});var s=i(296055);function r(e,t,i,r){let n=null;if(i.currencyConversionEnabled()&&(0,s.isActingAsSymbolSource)(e)){
const s=i.availableCurrencies(),o=t.currency(s),a=e.currency();null!==o&&null!==o.selectedCurrency&&!o.allCurrenciesAreOriginal&&o.selectedCurrency!==a&&(r&&null===a||null!==a&&s.convertible(a))&&(n=o.selectedCurrency)}return n}},404493:(e,t,i)=>{"use strict";i.d(t,{CustomSourceBase:()=>s});class s{constructor(e,t){this._id=e,this._model=t}id(){return this._id}isHoveredEnabled(){return!0}isSelectionEnabled(){return!1}priceScale(){return null}paneViews(e){return[]}labelPaneViews(e){return[]}priceAxisViews(e,t){return[]}updateViewsForPane(e,t){e.containsMainSeries()&&this.updateAllViews(t)}}},303160:(e,t,i)=>{"use strict";i.d(t,{CustomTimezones:()=>_});var s=i(650151),r=i(871555),n=i(968381),o=i(498856);const a=/^Etc\/GMT([+-])(\d{1,2}):?(\d\d)?$/,l=new Map;function c(e){if(l.has(e))return l.get(e);const t=a.test(e);return l.set(e,t),t}const h=new Map;function d(e){if(h.has(e))return h.get(e);const t=function(e){const t=e.match(a);if(!t)return 0;const i="+"===t[1]?-1:1;return 60*(60*parseInt(t[2],10)+parseInt(t[3]||"0",10))*i}(e),i={time:[1924992e3+t],offset:[t]};return h.set(e,i),i}let u=null;const p=new Map;class _{constructor(){this._customTimezones=new Map}addTimezones(e){e.forEach((e=>{const{id:t,...i}=e;this._addTimezone(t,i)})),this.updateChartTimezones()}listTimezoneIds(){return[...this._customTimezones.keys()]}listTimezones(){return[...this._customTimezones.entries()].map((([e,t])=>({id:e,...t})))}getTimezoneInfo(e){if(!this.timezoneIsAvailable(e))throw new Error("Provided timezone alias is not within the list of supported timezones.");return(0,s.ensure)(this._customTimezones.get(e))}getAllTimezoneInfo(){return this.listTimezones()}getAliasTimezone(e){return this.getTimezoneInfo(e).alias}timezoneIsAvailable(e){return this._customTimezones.has(e)}updateChartTimezones(){(0,n.updateAvailableTimezones)(this.getAllTimezoneInfo())}getTimezoneData(e){if(p.has(e))return p.get(e);let t=null;if(c(e))t=d(e);else if(this.timezoneIsAvailable(e)){const i=this.getAliasTimezone(e);o.tzData[i]&&(t=o.tzData[i]),!t&&c(i)&&(t=d(i))}return t&&p.set(e,t),t}static instance(){return null===u&&(u=new _),u}_addTimezone(e,t){try{if((0,s.ensure)(e,"Custom timezone ID"),(0,s.ensure)(t.alias,"Custom timezone alias"),(0,s.ensure)(t.title,"Custom timezone title"),(0,n.timezoneIsAvailable)(e)&&!this.timezoneIsAvailable(e))throw new Error("Custom timezone id already exists.");if(!(0,n.timezoneIsSupported)(t.alias)&&!c(t.alias))throw new Error("Custom timezone alias is not a supported timezone.");if(e.length<1)throw new Error("Custom timezone id is empty");if(t.title.length<1)throw new Error("Custom timezone title is empty");this._customTimezones.set(e,t)}catch(e){console.warn(`Unable to add custom timezone. ${e}`)}}}(0,r.setCustomTimezones)(_)},879987:(e,t,i)=>{"use strict";i.d(t,{isMainSeriesState:()=>r,isStudyState:()=>n,isLineToolState:()=>o,isStudyLineToolState:()=>a});var s=i(232468);function r(e){return"MainSeries"===e.type}function n(e){return Boolean(e.type)&&e.type.toLowerCase().startsWith("study")}function o(e){
return Boolean(e.type)&&(0,s.isLineToolName)(e.type)}function a(e){return Boolean(e.type)&&(0,s.isStudyLineToolName)(e.type)}},881517:(e,t,i)=>{"use strict";i.d(t,{DataSource:()=>l});i(484727);var s=i(210596),r=i.n(s),n=i(220863),o=i(922157),a=i.n(o);class l{constructor(e){this.hasAlert=new(r())(!1),this._zorder=0,this.m_priceScale=null,this._ownerSource=null,this._userEditEnabled=!0,this._onPriceScaleChanged=new(a()),this._isSelectionEnabled=!0,this._instanceId=(0,n.randomHashN)(6),this._ownerSourceChanged=new(a()),this._zOrderChanged=new(a()),this._id=null!=e?e:(0,n.randomHashN)(6)}id(){return this._id}instanceId(){return this._instanceId}preferNoScale(){return!1}setId(e){this._id=e}zorder(){return this._zorder}setZorder(e){"number"==typeof e&&this._zorder!==e&&(this._zorder=e,this._zOrderChanged.fire(e))}isSpeciallyZOrderedSource(){return!1}title(){throw new Error("Implement this fun in a subclass")}name(){throw new Error("Implement this fun in a subclass")}priceScale(){return this.m_priceScale}setPriceScale(e){this.m_priceScale=e,this._onPriceScaleChanged.fire()}ownerSource(){return this._ownerSource}setOwnerSource(e){const t=this._ownerSource;this._ownerSource=e,this._ownerSourceChanged.fire(t,e)}ownerSourceChanged(){return this._ownerSourceChanged}zOrderChanged(){return this._zOrderChanged}isSavedInChart(e){return!0}isSavedInStudyTemplates(){return!0}isRemovedByStudyTemplates(){return!0}hasContextMenu(){return!0}showInObjectTree(){return!0}setUserEditEnabled(e){this._userEditEnabled=e}userEditEnabled(){return this._userEditEnabled}canBeHidden(){return this.userEditEnabled()}isUserDeletable(){return this.userEditEnabled()}properties(){throw new Error("Implement this fun in a subclass")}isVisible(){return this.properties().visible.value()}dataWindowView(){return null}priceAxisViews(e,t){return null}timeAxisViews(){return null}updateAllViews(e){}paneViews(e){return null}labelPaneViews(){return null}isFailed(){return!1}isLoading(){return!1}isPhantom(){return!1}isChildStudy(){return!1}hasChildren(){return!1}canHaveChildren(){return!1}onClickOutside(e){}getSourceIcon(){return null}state(e){throw new Error("Implement this fun in a subclass")}onPriceScaleChanged(){return this._onPriceScaleChanged}doesMovingAffectsUndo(){return!0}isMultiPaneAvailable(){return!1}isMultiPaneEnabled(){return!1}copiable(){return!1}cloneable(){return!1}movable(){return!1}isIncludedInAutoScale(){return!1}isHoveredEnabled(){return this.isSelectionEnabled()}showOnTopOnHovering(){return!0}isSelectionEnabled(){return this._isSelectionEnabled}setSelectionEnabled(e){this._isSelectionEnabled=e}firstValue(){return null}priceRange(e,t){return null}autoScaleInfo(e,t){return{range:this.priceRange(e,t)}}stateForAlert(){return null}canHasAlert(){return!1}alertCreationAvailable(){return new(r())(this.hasStateForAlert()).readonly()}hasStateForAlert(){return!1}idForAlert(){return this._id}}},43657:(e,t,i)=>{"use strict";i.d(t,{DataWindowItem:()=>s,DataWindowView:()=>r});class s{constructor(e,t,i,s=!1){this._visible=!0,this._id=e,this._title=t,this._value=i,
this._unimportant=s}id(){return this._id}title(){return this._title}setTitle(e){this._title=e}text(){return this._value}value(){return this._value}setValue(e){this._value=e}visible(){return this._visible}setVisible(e){this._visible=e}color(){return this._color}setColor(e){this._color=e}unimportant(){return this._unimportant}}class r{constructor(){this._items=[],this._header="",this._title=""}header(){return this._header}title(){return this._title}items(){return this._items}update(){}}},599015:(e,t,i)=>{"use strict";i.d(t,{dateFormatProperty:()=>l,restoreDateFormatSettingsValue:()=>c});var s=i(870122),r=i(149926),n=i(54266);const o="date_format";function a(){return s.getValue(o,(0,n.defaultDateFormat)())}const l=(0,r.createPrimitiveProperty)(a());function c(){l.setValue((0,n.defaultDateFormat)()),s.remove(o)}s.onSync.subscribe(null,(()=>l.setValue(a()))),l.subscribe(null,(()=>s.setValue(o,l.value())))},508547:(e,t,i)=>{"use strict";i.r(t),i.d(t,{createDefaultsState:()=>u,saveDefaultProperties:()=>_,DefaultProperty:()=>m});var s=i(822914),r=i(58121),n=i(915736),o=i(658363),a=i(976704),l=i.n(a),c=i(922157),h=i.n(c);function d(e,t){const i=(0,s.default)(e);return t.forEach((e=>(0,n.default)(i,e.split(".")))),i}function u(e,t,i,n){const a=e?o.defaults:o.factoryDefaults,l=t.startsWith("study_")?(0,s.default)(a("study")):{};let c=(0,s.default)(a(t,n));return t.startsWith("study_")&&c.inputs&&delete c.inputs.symbol,"linetoolicon"===t&&e&&(c.icon=(0,o.defaults)(t).icon),"linetooemoji"===t&&e&&(c.emoji=(0,o.defaults)(t).emoji),c=d(c,i),(0,r.default)(l,c),l}let p=!1;function _(e){p=e}class m extends(l()){constructor(e,t,i,s){super(function(e,t,i,s){let n;return void 0===s&&(s=!0),i?n=t:(n=u(s,e,[],null),t&&(0,r.default)(n,t)),n}(e,t,i,s)),this._exclusions=[],this._restoreFactoryDefaultsEvent=new(h()),this._defaultName=e,this._useUserPreferences=null==s||s,this.listeners().subscribe(this,m.prototype.onPropertyChanged),this._restoreFactoryDefaultsEvent=new(h())}preferences(){return this.state(this._exclusions)}mergePreferences(e){this.mergeAndFire(d(e,this._exclusions))}addExclusion(e){this._exclusions.indexOf(e)<0&&this._exclusions.push(e)}removeExclusion(e){const t=this._exclusions.indexOf(e);-1!==t&&this._exclusions.splice(t,1)}restoreFactoryDefaults(){const e=u(!1,this._defaultName,this._exclusions,null);this.mergeAndFire(e),this._defaultName.startsWith("study_")&&!this._defaultName.startsWith("study_VbPFixed")||(0,o.saveDefaults)(this._defaultName,void 0),this._restoreFactoryDefaultsEvent.fire()}onRestoreFactoryDefaults(){return this._restoreFactoryDefaultsEvent}onPropertyChanged(){!p||this._defaultName.startsWith("study_")&&!this._defaultName.startsWith("study_VbPFixed")||this.saveDefaults()}saveDefaults(){this._useUserPreferences&&(0,o.saveDefaults)(this._defaultName,this.preferences())}clone(e){const t=new m(this._defaultName,this.state(),null==e?void 0:e.replaceByState,this._useUserPreferences);for(let e=0;e<this._exclusions.length;++e)t.addExclusion(this._exclusions[e]);return t}}},658363:(e,t,i)=>{"use strict"
;var s=i(927079).PlDisplay;const{getHexColorByName:r}=i(676507),{generateColor:n}=i(602564);var o=i(927079).TradedGroupHorizontalAlignment,a=i(667342),l=i(487337).LineToolPitchforkStyle,c=i(521905).LineToolBarsPatternMode,h=i(444649),d=h.LineStudyPlotStyle,u=h.STUDYPLOTDISPLAYTARGET,p=i(451144),_=i(341537).PriceAxisLastValueMode,m=i(974991).StoriesTimeLineItemType,g=i(501182).MagnetMode,f=i(409353).LineEnd,v=i(992223).ColorType,S=i(125348).StatsPosition,y=i(548193).sessionsPreferencesDefault,b=i(413802).axisLabelBackgroundColor;const{LINESTYLE_SOLID:w,LINESTYLE_DOTTED:P,LINESTYLE_DASHED:C}=i(284269);var T=i(817808).getLogger("Chart.Defaults");const x=r("color-black"),I=r("color-white"),M=n(I,75),L=r("color-tv-blue-50"),A=r("color-tv-blue-500"),k=n(A,30),E=n(A,70),D=n(A,72),B=n(A,75),V=n(A,80),R=r("color-tv-blue-600"),N=r("color-deep-blue-200"),O=r("color-deep-blue-300"),F=r("color-deep-blue-500"),W=n(F,80),z=r("color-sky-blue-500"),H=n(z,80),U=r("color-sky-blue-700"),j=n(U,30),G=r("color-youtube"),q=r("color-ripe-red-200"),$=r("color-ripe-red-300"),Y=r("color-ripe-red-400"),K=r("color-ripe-red-500"),Z=n(K,70),X=n(K,80),J=n(K,72),Q=n(K,95),ee=r("color-ripe-red-600"),te=r("color-grapes-purple-500"),ie=n(te,100),se=n(te,80),re=n(te,30),ne=r("color-berry-pink-500"),oe=n(ne,80),ae=r("color-minty-green-100"),le=r("color-minty-green-500"),ce=n(le,80),he=n(le,72),de=n(le,95),ue=r("color-iguana-green-300"),pe=r("color-iguana-green-500"),_e=n(pe,80),me=r("color-tan-orange-300"),ge=r("color-tan-orange-500"),fe=n(ge,80),ve=r("color-tan-orange-600"),Se=r("color-tan-orange-700"),ye=r("color-cold-gray-150"),be=r("color-cold-gray-300"),we=r("color-cold-gray-400"),Pe=r("color-cold-gray-500"),Ce=r("color-cold-gray-800"),Te=n(Ce,94),xe=n(Ce,100),Ie=r("color-cold-gray-900"),Me=r("color-cold-gray-750"),Le=r("color-slate-gray"),Ae=r("color-silver-tree"),ke=n(Ae,95),Ee=r("color-mandy"),De=n(Ee,95);var Be=function(e){var t=function(e,t){return{color:e,visible:t}},i=function(e,t,i){return{coeff:e,color:t,visible:i}},r=function(e,t,i,s,r){return{coeff:e,color:t,visible:i,linestyle:void 0===s?w:s,linewidth:void 0===r?1:r}},h=function(e,t,i){return{color:e,width:i,visible:t}},T=function(e,t,i,s,r){return{color:e,visible:t,width:i,x:s,y:r}},Ce=function(e,t,i,s,r,n){return{coeff1:e,coeff2:t,color:i,visible:s,linestyle:void 0===r?w:r,linewidth:void 0===n?1:n}};if(void 0===TradingView.defaultProperties){var Be;switch(window.locale){case"ar_AE":Be="Asia/Dubai";break;case"au":Be="Australia/Sydney";break;case"br":Be="America/Sao_Paulo";break;case"ca":Be="America/Toronto";break;case"de_DE":case"it":Be="Europe/Berlin";break;case"es":Be="Europe/Madrid";break;case"fa_IR":Be="Asia/Tehran";break;case"fr":case"sv_SE":Be="Europe/Paris";break;case"he_IL":case"tr":Be="Europe/Athens";break;case"hu_HU":case"pl":Be="Europe/Warsaw";break;case"id":case"th_TH":case"vi_VN":Be="Asia/Bangkok";break;case"in":Be="Asia/Kolkata";break;case"ja":case"kr":Be="Asia/Tokyo";break;case"ms_MY":Be="Asia/Singapore";break;case"ru":Be="Europe/Moscow";break;case"uk":Be="Europe/London"
;break;case"zh_CN":case"zh_TW":Be="Asia/Shanghai";break;default:Be="Etc/UTC"}TradingView.defaultProperties={chartproperties:{timezone:Be,priceScaleSelectionStrategyName:"auto",paneProperties:{backgroundType:v.Solid,background:I,backgroundGradientStartColor:I,backgroundGradientEndColor:I,vertGridProperties:{color:Te,style:w},horzGridProperties:{color:Te,style:w},crossHairProperties:{color:we,style:C,transparency:0,width:1},topMargin:10,bottomMargin:8,axisProperties:{autoScale:!0,autoScaleDisabled:!1,lockScale:!1,percentage:!1,percentageDisabled:!1,indexedTo100:!1,log:!1,logDisabled:!1,alignLabels:!0,isInverted:!1},legendProperties:{showStudyArguments:!0,showStudyTitles:!0,showStudyValues:!0,showSeriesTitle:!0,showSeriesOHLC:!0,showLegend:!0,showBarChange:!0,showVolume:!1,showBackground:!0,showPriceSource:!0,backgroundTransparency:50},separatorColor:ye},scalesProperties:{backgroundColor:I,lineColor:xe,textColor:Ie,fontSize:12,scaleSeriesOnly:!1,showSeriesLastValue:!0,seriesLastValueMode:_.LastValueAccordingToScale,showSeriesPrevCloseValue:!1,showStudyLastValue:!0,showSymbolLabels:!1,showStudyPlotLabels:!1,showBidAskLabels:!1,showPrePostMarketPriceLabel:!0,showFundamentalNameLabel:!1,showFundamentalLastValue:!0,barSpacing:p.DEFAULT_BAR_SPACING,axisHighlightColor:B,axisLineToolLabelBackgroundColorCommon:b.common,axisLineToolLabelBackgroundColorActive:b.active,showPriceScaleCrosshairLabel:!0,showTimeScaleCrosshairLabel:!0,crosshairLabelBgColorLight:Ie,crosshairLabelBgColorDark:Me},mainSeriesProperties:{style:a.STYLE_CANDLES,esdShowDividends:!0,esdShowSplits:!0,esdShowEarnings:!0,esdShowBreaks:!1,esdFlagSize:2,showContinuousContractSwitches:!0,showContinuousContractSwitchesBreaks:!1,showFuturesContractExpiration:!0,showLastNews:!0,showCountdown:!0,bidAsk:{visible:!1,lineStyle:P,lineWidth:1,bidLineColor:A,askLineColor:Y},prePostMarket:{visible:!0,lineStyle:P,lineWidth:1,preMarketColor:ve,postMarketColor:A},highLowAvgPrice:{highLowPriceLinesVisible:!1,highLowPriceLabelsVisible:!1,averageClosePriceLineVisible:!1,averageClosePriceLabelVisible:!1,highLowPriceLinesColor:"",highLowPriceLinesWidth:1,averagePriceLineColor:"",averagePriceLineWidth:1},visible:!0,showPriceLine:!0,priceLineWidth:1,priceLineColor:"",baseLineColor:be,showPrevClosePriceLine:!1,prevClosePriceLineWidth:1,prevClosePriceLineColor:"#555555",minTick:"default",dividendsAdjustment:void 0,backAdjustment:!1,settlementAsClose:!0,sessionId:"regular",sessVis:!1,statusViewStyle:{fontSize:16,showExchange:!0,showInterval:!0,symbolTextSource:"description"},candleStyle:{upColor:le,downColor:K,drawWick:!0,drawBorder:!0,borderColor:"#378658",borderUpColor:le,borderDownColor:K,wickColor:"#737375",wickUpColor:le,wickDownColor:K,barColorsOnPrevClose:!1,drawBody:!0},hollowCandleStyle:{upColor:le,downColor:K,drawWick:!0,drawBorder:!0,borderColor:"#378658",borderUpColor:le,borderDownColor:K,wickColor:"#737375",wickUpColor:le,wickDownColor:K,drawBody:!0},haStyle:{upColor:le,downColor:K,drawWick:!0,drawBorder:!0,borderColor:"#378658",borderUpColor:le,borderDownColor:K,
wickColor:"#737375",wickUpColor:le,wickDownColor:K,showRealLastPrice:!1,barColorsOnPrevClose:!1,inputs:{},inputInfo:{},drawBody:!0},barStyle:{upColor:le,downColor:K,barColorsOnPrevClose:!1,dontDrawOpen:!1,thinBars:!0},hiloStyle:{color:A,showBorders:!0,borderColor:A,showLabels:!0,labelColor:A,drawBody:!0},columnStyle:{upColor:n(le,50),downColor:n(K,50),barColorsOnPrevClose:!0,priceSource:"close"},lineStyle:{color:A,linestyle:w,linewidth:2,priceSource:"close",styleType:a.STYLE_LINE_TYPE_SIMPLE},areaStyle:{color1:D,color2:A,linecolor:A,linestyle:w,linewidth:2,priceSource:"close",transparency:100},priceAxisProperties:{autoScale:!0,autoScaleDisabled:!1,lockScale:!1,percentage:!1,percentageDisabled:!1,indexedTo100:!1,log:!1,logDisabled:!1,isInverted:!1,alignLabels:!0},renkoStyle:{upColor:le,downColor:K,borderUpColor:le,borderDownColor:K,upColorProjection:"#a9dcc3",downColorProjection:"#f5a6ae",borderUpColorProjection:"#a9dcc3",borderDownColorProjection:"#f5a6ae",wickUpColor:le,wickDownColor:K,inputs:{source:"close",sources:"Close",boxSize:3,style:"ATR",atrLength:14,wicks:!0},inputInfo:{source:{name:"Source"},sources:{name:"Source"},boxSize:{name:"Box size"},style:{name:"Style"},atrLength:{name:"ATR length"},wicks:{name:"Wicks"}}},pbStyle:{upColor:le,downColor:K,borderUpColor:le,borderDownColor:K,upColorProjection:"#a9dcc3",downColorProjection:"#f5a6ae",borderUpColorProjection:"#a9dcc3",borderDownColorProjection:"#f5a6ae",inputs:{source:"close",lb:3},inputInfo:{source:{name:"Source"},lb:{name:"Number of line"}}},kagiStyle:{upColor:le,downColor:K,upColorProjection:"#a9dcc3",downColorProjection:"#f5a6ae",inputs:{source:"close",style:"ATR",atrLength:14,reversalAmount:1},inputInfo:{source:{name:"Source"},style:{name:"Style"},atrLength:{name:"ATR length"},reversalAmount:{name:"Reversal amount"}}},pnfStyle:{upColor:le,downColor:K,upColorProjection:"#a9dcc3",downColorProjection:"#f5a6ae",inputs:{sources:"Close",reversalAmount:3,boxSize:1,style:"ATR",atrLength:14,oneStepBackBuilding:!1},inputInfo:{sources:{name:"Source"},boxSize:{name:"Box size"},reversalAmount:{name:"Reversal amount"},style:{name:"Style"},atrLength:{name:"ATR length"},oneStepBackBuilding:{name:"One step back building"}}},baselineStyle:{baselineColor:Le,topFillColor1:he,topFillColor2:de,bottomFillColor1:Q,bottomFillColor2:J,topLineColor:le,bottomLineColor:K,topLineWidth:2,bottomLineWidth:2,priceSource:"close",transparency:50,baseLevelPercentage:50},rangeStyle:{upColor:le,downColor:K,thinBars:!0,upColorProjection:"#a9dcc3",downColorProjection:"#f5a6ae",inputs:{range:10,phantomBars:!1},inputInfo:{range:{name:"Range"},phantomBars:{name:"Phantom bars"}}}},chartEventsSourceProperties:{visible:!0,futureOnly:!0,breaks:{color:"#555555",visible:!1,style:C,width:1}},tradingProperties:{showPositions:!0,positionPL:{visibility:!0,display:s.Money},bracketsPL:{visibility:!0,display:s.Money},showOrders:!0,showExecutions:!0,showExecutionsLabels:!1,showReverse:!0,horizontalAlignment:o.Right,extendLeft:!0,lineLength:5,lineWidth:1,lineStyle:w},
editorFontsList:["Verdana","Courier New","Times New Roman","Arial"],volumePaneSize:"large"},sessions:y,drawings:{magnet:!1,magnetMode:g.WeakMagnet,stayInDrawingMode:!1,drawOnAllCharts:!0,drawOnAllChartsMode:1},linetoolorder:{extendLeft:"inherit",lineLength:"inherit",lineColor:G,lineActiveBuyColor:"#4094e8",lineInactiveBuyColor:"rgba(64, 148, 232, 0.5)",lineActiveSellColor:"#e75656",lineInactiveSellColor:"rgba(231, 86, 86, 0.5)",lineStyle:"inherit",lineWidth:"inherit",bodyBorderActiveBuyColor:"#4094e8",bodyBorderInactiveBuyColor:"rgba(64, 148, 232, 0.5)",bodyBorderActiveSellColor:"#e75656",bodyBorderInactiveSellColor:"rgba(231, 86, 86, 0.5)",bodyBackgroundColor:M,bodyBackgroundTransparency:25,bodyTextInactiveLimitColor:"rgba(38, 140, 2, 0.5)",bodyTextActiveLimitColor:"#268c02",bodyTextInactiveStopColor:"rgba(231, 86, 86, 0.5)",bodyTextActiveStopColor:"#e75656",bodyTextInactiveBuyColor:"rgba(64, 148, 232, 0.5)",bodyTextActiveBuyColor:"#4094e8",bodyTextInactiveSellColor:"rgba(231, 86, 86, 0.5)",bodyTextActiveSellColor:"#e75656",bodyFontFamily:"Verdana",bodyFontSize:9,bodyFontBold:!0,bodyFontItalic:!1,quantityBorderActiveBuyColor:"#4094e8",quantityBorderInactiveBuyColor:"rgba(64, 148, 232, 0.5)",quantityBorderActiveSellColor:"#e75656",quantityBorderInactiveSellColor:"rgba(231, 86, 86, 0.5)",quantityBackgroundInactiveBuyColor:"rgba(64, 148, 232, 0.5)",quantityBackgroundActiveBuyColor:"#4094e8",quantityBackgroundInactiveSellColor:"rgba(231, 86, 86, 0.5)",quantityBackgroundActiveSellColor:"#e75656",quantityTextColor:I,quantityTextTransparency:0,quantityFontFamily:"Verdana",quantityFontSize:9,quantityFontBold:!0,quantityFontItalic:!1,cancelButtonBorderActiveBuyColor:"#4094e8",cancelButtonBorderInactiveBuyColor:"rgba(64, 148, 232, 0.5)",cancelButtonBorderActiveSellColor:"#e75656",cancelButtonBorderInactiveSellColor:"rgba(231, 86, 86, 0.5)",cancelButtonBackgroundColor:M,cancelButtonBackgroundTransparency:25,cancelButtonIconActiveBuyColor:"#4094e8",cancelButtonIconInactiveBuyColor:"rgba(64, 148, 232, 0.5)",cancelButtonIconActiveSellColor:"#e75656",cancelButtonIconInactiveSellColor:"rgba(231, 86, 86, 0.5)",tooltip:"",modifyTooltip:"",cancelTooltip:""},linetoolposition:{extendLeft:"inherit",lineLength:"inherit",lineBuyColor:"#4094e8",lineSellColor:"#e75656",lineStyle:"inherit",lineWidth:"inherit",bodyBorderBuyColor:"#4094e8",bodyBorderSellColor:"#e75656",bodyBackgroundColor:M,bodyBackgroundTransparency:25,bodyTextPositiveColor:"#268c02",bodyTextNeutralColor:"#646464",bodyTextNegativeColor:"#e75656",bodyFontFamily:"Verdana",bodyFontSize:9,bodyFontBold:!0,bodyFontItalic:!1,quantityBorderBuyColor:"#4094e8",quantityBorderSellColor:"#e75656",quantityBackgroundBuyColor:"#4094e8",quantityBackgroundSellColor:"#e75656",quantityTextColor:I,quantityTextTransparency:0,quantityFontFamily:"Verdana",quantityFontSize:9,quantityFontBold:!0,quantityFontItalic:!1,reverseButtonBorderBuyColor:"#4094e8",reverseButtonBorderSellColor:"#e75656",reverseButtonBackgroundColor:M,reverseButtonBackgroundTransparency:25,reverseButtonIconBuyColor:"#4094e8",
reverseButtonIconSellColor:"#e75656",closeButtonBorderBuyColor:"#4094e8",closeButtonBorderSellColor:"#e75656",closeButtonBackgroundColor:M,closeButtonBackgroundTransparency:25,closeButtonIconBuyColor:"#4094e8",closeButtonIconSellColor:"#e75656",tooltip:"",protectTooltip:"",closeTooltip:"",reverseTooltip:""},linetoolexecution:{direction:"buy",arrowHeight:8,arrowSpacing:1,arrowBuyColor:"#4094e8",arrowSellColor:"#e75656",text:"",textColor:x,textTransparency:0,fontFamily:"Verdana",fontSize:10,fontBold:!1,fontItalic:!1,tooltip:""},linetoolicon:{color:A,size:40,icon:61720,angle:.5*Math.PI},linetoolemoji:{size:40,emoji:"😀",angle:.5*Math.PI},linetoolimage:{transparency:0,cssWidth:0,cssHeight:0,angle:0},linetoolbezierquadro:{linecolor:A,linewidth:1,fillBackground:!1,backgroundColor:V,transparency:50,linestyle:w,extendLeft:!1,extendRight:!1,leftEnd:f.Normal,rightEnd:f.Normal},linetoolbeziercubic:{linecolor:F,linewidth:1,fillBackground:!1,backgroundColor:W,transparency:80,linestyle:w,extendLeft:!1,extendRight:!1,leftEnd:f.Normal,rightEnd:f.Normal},linetooltrendline:{linecolor:A,linewidth:2,linestyle:w,extendLeft:!1,extendRight:!1,leftEnd:f.Normal,rightEnd:f.Normal,showLabel:!1,horzLabelsAlign:"center",vertLabelsAlign:"bottom",textcolor:A,fontsize:14,bold:!1,italic:!1,alwaysShowStats:!1,showMiddlePoint:!1,showPriceLabels:!1,showPriceRange:!1,showBarsRange:!1,showDateTimeRange:!1,showDistance:!1,showAngle:!1,statsPosition:S.Right},linetoolinfoline:{linecolor:A,linewidth:2,linestyle:w,extendLeft:!1,extendRight:!1,leftEnd:f.Normal,rightEnd:f.Normal,showLabel:!1,horzLabelsAlign:"center",vertLabelsAlign:"bottom",textcolor:A,fontsize:14,bold:!1,italic:!1,alwaysShowStats:!0,showMiddlePoint:!1,showPriceLabels:!1,showPriceRange:!0,showBarsRange:!0,showDateTimeRange:!0,showDistance:!0,showAngle:!0,statsPosition:S.Center},linetooltimecycles:{linecolor:"#159980",linewidth:1,fillBackground:!0,backgroundColor:"rgba(106, 168, 79, 0.5)",transparency:50,linestyle:w},linetoolsineline:{linecolor:"#159980",linewidth:1,linestyle:w},linetooltrendangle:{linecolor:A,linewidth:2,linestyle:w,textcolor:A,fontsize:12,bold:!1,italic:!1,alwaysShowStats:!1,showMiddlePoint:!1,showPriceLabels:!1,showPriceRange:!1,showBarsRange:!1,extendRight:!1,extendLeft:!1,statsPosition:S.Right},linetooldisjointangle:{linecolor:le,linewidth:2,linestyle:w,fillBackground:!0,backgroundColor:ce,transparency:20,extendLeft:!1,extendRight:!1,leftEnd:f.Normal,rightEnd:f.Normal,textcolor:le,fontsize:12,bold:!1,italic:!1,showPrices:!1,showPriceRange:!1,showDateTimeRange:!1,showBarsRange:!1},linetoolflatbottom:{linecolor:ge,linewidth:2,linestyle:w,fillBackground:!0,backgroundColor:fe,transparency:20,extendLeft:!1,extendRight:!1,leftEnd:f.Normal,rightEnd:f.Normal,textcolor:ge,fontsize:12,bold:!1,italic:!1,showPrices:!1,showPriceRange:!1,showDateTimeRange:!1,showBarsRange:!1},linetoolfibspiral:{counterclockwise:!1,linecolor:z,linewidth:1,linestyle:w},linetoolriskrewardshort:{linecolor:Pe,linewidth:1,textcolor:I,fontsize:12,fillLabelBackground:!0,labelBackgroundColor:"#585858",
fillBackground:!0,stopBackground:X,profitBackground:ce,stopBackgroundTransparency:80,profitBackgroundTransparency:80,drawBorder:!1,borderColor:"#667b8b",compact:!1,riskDisplayMode:"percents",accountSize:1e3,lotSize:1,risk:25,alwaysShowStats:!1,showPriceLabels:!0},linetoolriskrewardlong:{linecolor:Pe,linewidth:1,textcolor:I,fontsize:12,fillLabelBackground:!0,labelBackgroundColor:"#585858",fillBackground:!0,stopBackground:X,profitBackground:ce,stopBackgroundTransparency:80,profitBackgroundTransparency:80,drawBorder:!1,borderColor:"#667b8b",compact:!1,riskDisplayMode:"percents",accountSize:1e3,lotSize:1,risk:25,alwaysShowStats:!1,showPriceLabels:!0},linetoolarrow:{linecolor:A,linewidth:2,linestyle:w,extendLeft:!1,extendRight:!1,leftEnd:f.Normal,rightEnd:f.Arrow,showLabel:!1,horzLabelsAlign:"center",vertLabelsAlign:"bottom",textcolor:A,fontsize:14,bold:!1,italic:!1,alwaysShowStats:!1,showMiddlePoint:!1,showPriceLabels:!1,showPriceRange:!1,showBarsRange:!1,showDateTimeRange:!1,showDistance:!1,showAngle:!1,statsPosition:S.Right},linetoolray:{linecolor:A,linewidth:2,linestyle:w,extendLeft:!1,extendRight:!0,leftEnd:f.Normal,rightEnd:f.Normal,showLabel:!1,horzLabelsAlign:"center",vertLabelsAlign:"bottom",textcolor:A,fontsize:14,bold:!1,italic:!1,alwaysShowStats:!1,showMiddlePoint:!1,showPriceLabels:!1,showPriceRange:!1,showBarsRange:!1,showDateTimeRange:!1,showDistance:!1,showAngle:!1,statsPosition:S.Right},linetoolextended:{linecolor:A,linewidth:2,linestyle:w,extendLeft:!0,extendRight:!0,leftEnd:f.Normal,rightEnd:f.Normal,showLabel:!1,horzLabelsAlign:"center",vertLabelsAlign:"bottom",textcolor:A,fontsize:14,bold:!1,italic:!1,alwaysShowStats:!1,showMiddlePoint:!1,showPriceLabels:!1,showPriceRange:!1,showBarsRange:!1,showDateTimeRange:!1,showDistance:!1,showAngle:!1,statsPosition:S.Right},linetoolhorzline:{linecolor:A,linewidth:2,linestyle:w,showPrice:!0,showLabel:!1,textcolor:A,fontsize:12,bold:!1,italic:!1,horzLabelsAlign:"center",vertLabelsAlign:"top"},linetoolhorzray:{linecolor:A,linewidth:2,linestyle:w,showPrice:!0,showLabel:!1,textcolor:A,fontsize:12,bold:!1,italic:!1,horzLabelsAlign:"center",vertLabelsAlign:"top"},linetoolvertline:{linecolor:A,linewidth:2,linestyle:w,extendLine:!0,showTime:!0,showLabel:!1,horzLabelsAlign:"right",vertLabelsAlign:"top",textcolor:A,textOrientation:"vertical",fontsize:14,bold:!1,italic:!1},linetoolcrossline:{linecolor:A,linewidth:2,linestyle:w,showPrice:!0,showTime:!0},linetoolcirclelines:{trendline:{visible:!0,color:"#808080",linewidth:1,linestyle:C},linecolor:"#80ccdb",linewidth:1,linestyle:w},linetoolfibtimezone:{horzLabelsAlign:"right",vertLabelsAlign:"bottom",baselinecolor:"#808080",linecolor:"#0055db",linewidth:1,linestyle:w,showLabels:!0,fillBackground:!1,transparency:80,trendline:{visible:!0,color:"#808080",linewidth:1,linestyle:C},level1:r(0,Pe,!0),level2:r(1,A,!0),level3:r(2,A,!0),level4:r(3,A,!0),level5:r(5,A,!0),level6:r(8,A,!0),level7:r(13,A,!0),level8:r(21,A,!0),level9:r(34,A,!0),level10:r(55,A,!0),level11:r(89,A,!0)},linetooltext:{color:A,fontsize:14,fillBackground:!1,
backgroundColor:"rgba(91, 133, 191, 0.3)",backgroundTransparency:70,drawBorder:!1,borderColor:"#667b8b",bold:!1,italic:!1,fixedSize:!0,wordWrap:!1,wordWrapWidth:200},linetooltextabsolute:{color:A,fontsize:14,fillBackground:!1,backgroundColor:"rgba(155, 190, 213, 0.3)",backgroundTransparency:70,drawBorder:!1,borderColor:"#667b8b",bold:!1,italic:!1,fixedSize:!1,wordWrap:!1,wordWrapWidth:200},linetoolballoon:{color:I,backgroundColor:re,borderColor:ie,fontsize:14,transparency:30},linetoolcomment:{color:I,backgroundColor:A,borderColor:A,fontsize:16,transparency:0},linetoolbrush:{linecolor:z,linewidth:1,linestyle:w,smooth:5,fillBackground:!1,backgroundColor:z,transparency:50,leftEnd:f.Normal,rightEnd:f.Normal},linetoolhighlighter:{linecolor:X,smooth:5,transparency:80},linetoolpolyline:{linecolor:z,linewidth:1,linestyle:w,fillBackground:!0,backgroundColor:H,transparency:80,filled:!1},linetoolsignpost:{itemType:m.Emoji,emoji:"🙂",showImage:!1,plateColor:A,fontSize:12,bold:!1,italic:!1},linetoolpath:{lineColor:A,lineWidth:2,lineStyle:w,leftEnd:f.Normal,rightEnd:f.Arrow},linetoolarrowmarkleft:{color:A,arrowColor:A,fontsize:14,bold:!1,italic:!1,showLabel:!0},linetoolarrowmarkup:{color:le,arrowColor:le,fontsize:14,bold:!1,italic:!1,showLabel:!0},linetoolarrowmarkright:{color:A,arrowColor:A,fontsize:14,bold:!1,italic:!1,showLabel:!0},linetoolarrowmarkdown:{color:ee,arrowColor:ee,fontsize:14,bold:!1,italic:!1,showLabel:!0},linetoolflagmark:{flagColor:A},linetoolnote:{markerColor:A,textColor:I,backgroundColor:k,backgroundTransparency:0,borderColor:A,fontSize:14,bold:!1,italic:!1,fixedSize:!0},linetoolnoteabsolute:{markerColor:A,textColor:I,backgroundColor:k,backgroundTransparency:0,borderColor:A,fontSize:14,bold:!1,italic:!1,fixedSize:!0},linetoolpricelabel:{color:I,backgroundColor:A,borderColor:A,fontWeight:"bold",fontsize:14,transparency:0},linetoolpricenote:{showLabel:!1,horzLabelsAlign:"center",vertLabelsAlign:"bottom",textColor:A,fontSize:14,bold:!1,italic:!1,lineColor:A,priceLabelBackgroundColor:A,priceLabelBorderColor:A,priceLabelTextColor:I,priceLabelFontSize:12,priceLabelBold:!1,priceLabelItalic:!1},linetoolarrowmarker:{backgroundColor:R,textColor:R,bold:!0,italic:!1,fontsize:16,showLabel:!0},linetoolrectangle:{color:te,fillBackground:!0,backgroundColor:se,linewidth:1,transparency:50,showLabel:!1,horzLabelsAlign:"left",vertLabelsAlign:"bottom",textColor:te,fontSize:14,bold:!1,italic:!1,extendLeft:!1,extendRight:!1},linetoolrotatedrectangle:{color:pe,fillBackground:!0,backgroundColor:_e,transparency:50,linewidth:1},linetoolcircle:{color:ge,backgroundColor:fe,fillBackground:!0,linewidth:1,showLabel:!1,textColor:ge,fontSize:14,bold:!1,italic:!1},linetoolellipse:{color:K,fillBackground:!0,backgroundColor:X,transparency:50,linewidth:1,showLabel:!1,textColor:K,fontSize:14,bold:!1,italic:!1},linetoolarc:{color:ne,fillBackground:!0,backgroundColor:oe,transparency:80,linewidth:1},linetoolprediction:{linecolor:A,linewidth:1,sourceBackColor:A,sourceTextColor:I,sourceStrokeColor:A,targetStrokeColor:A,targetBackColor:A,
targetTextColor:I,successBackground:pe,successTextColor:I,failureBackground:K,failureTextColor:I,intermediateBackColor:"#ead289",intermediateTextColor:"#6d4d22",transparency:10,centersColor:"#202020"},linetooltriangle:{color:le,fillBackground:!0,backgroundColor:ce,transparency:80,linewidth:1},linetoolcallout:{color:I,backgroundColor:j,transparency:50,linewidth:1,fontsize:14,bordercolor:U,bold:!1,italic:!1,wordWrap:!1,wordWrapWidth:200},linetoolparallelchannel:{linecolor:A,linewidth:2,linestyle:w,extendLeft:!1,extendRight:!1,fillBackground:!0,backgroundColor:V,transparency:20,showMidline:!0,midlinecolor:A,midlinewidth:1,midlinestyle:C},linetoolelliottimpulse:{degree:7,showWave:!0,color:"#3d85c6",linewidth:1},linetoolelliotttriangle:{degree:7,showWave:!0,color:ge,linewidth:1},linetoolelliotttriplecombo:{degree:7,showWave:!0,color:"#6aa84f",linewidth:1},linetoolelliottcorrection:{degree:7,showWave:!0,color:"#3d85c6",linewidth:1},linetoolelliottdoublecombo:{degree:7,showWave:!0,color:"#6aa84f",linewidth:1},linetoolbarspattern:{color:A,mode:c.Bars,mirrored:!1,flipped:!1},linetoolghostfeed:{averageHL:20,variance:50,candleStyle:{upColor:ae,downColor:q,drawWick:!0,drawBorder:!0,borderColor:"#378658",borderUpColor:le,borderDownColor:K,wickColor:Pe},transparency:50},study:{inputs:{},styles:{},palettes:{},bands:{},area:{},graphics:{},plots:{},ohlcPlots:{},filledAreasStyle:{},filledAreas:{},visible:!0,showLegendValues:!0,showLabelsOnPriceScale:!0,precision:"default"},linetoolpitchfork:{fillBackground:!0,transparency:80,style:l.Original,median:{visible:!0,color:K,linewidth:1,linestyle:w},extendLines:!1,level0:r(.25,me,!1),level1:r(.382,ue,!1),level2:r(.5,le,!0),level3:r(.618,le,!1),level4:r(.75,z,!1),level5:r(1,A,!0),level6:r(1.5,te,!1),level7:r(1.75,ne,!1),level8:r(2,$,!1)},linetoolpitchfan:{fillBackground:!0,transparency:80,median:{visible:!0,color:K,linewidth:1,linestyle:w},level0:r(.25,me,!1),level1:r(.382,ue,!1),level2:r(.5,z,!0),level3:r(.618,le,!1),level4:r(.75,z,!1),level5:r(1,A,!0),level6:r(1.5,te,!1),level7:r(1.75,ne,!1),level8:r(2,$,!1)},linetoolgannfan:{showLabels:!0,fillBackground:!0,transparency:80,level1:Ce(1,8,ge,!0),level2:Ce(1,4,le,!0),level3:Ce(1,3,pe,!0),level4:Ce(1,2,le,!0),level5:Ce(1,1,z,!0),level6:Ce(2,1,A,!0),level7:Ce(3,1,te,!0),level8:Ce(4,1,ne,!0),level9:Ce(8,1,K,!0)},linetoolganncomplex:{fillBackground:!1,arcsBackground:{fillBackground:!0,transparency:80},reverse:!1,scaleRatio:"",showLabels:!0,labelsStyle:{fontSize:12,bold:!1,italic:!1},levels:[h(Pe,!0,1),h(ge,!0,1),h(z,!0,1),h(pe,!0,1),h(le,!0,1),h(Pe,!0,1)],fanlines:[T(N,!1,1,8,1),T(K,!1,1,5,1),T(Pe,!1,1,4,1),T(ge,!1,1,3,1),T(z,!0,1,2,1),T(pe,!0,1,1,1),T(le,!0,1,1,2),T(le,!1,1,1,3),T(A,!1,1,1,4),T(O,!1,1,1,5),T(N,!1,1,1,8)],arcs:[T(ge,!0,1,1,0),T(ge,!0,1,1,1),T(ge,!0,1,1.5,0),T(z,!0,1,2,0),T(z,!0,1,2,1),T(pe,!0,1,3,0),T(pe,!0,1,3,1),T(le,!0,1,4,0),T(le,!0,1,4,1),T(A,!0,1,5,0),T(A,!0,1,5,1)]},linetoolgannfixed:{fillBackground:!1,arcsBackground:{fillBackground:!0,transparency:80},reverse:!1,
levels:[h(Pe,!0,1),h(ge,!0,1),h(z,!0,1),h(pe,!0,1),h(le,!0,1),h(Pe,!0,1)],fanlines:[T(N,!1,1,8,1),T(K,!1,1,5,1),T(Pe,!1,1,4,1),T(ge,!1,1,3,1),T(z,!0,1,2,1),T(pe,!0,1,1,1),T(le,!0,1,1,2),T(le,!1,1,1,3),T(A,!1,1,1,4),T(O,!1,1,1,5),T(N,!1,1,1,8)],arcs:[T(ge,!0,1,1,0),T(ge,!0,1,1,1),T(ge,!0,1,1.5,0),T(z,!0,1,2,0),T(z,!0,1,2,1),T(pe,!0,1,3,0),T(pe,!0,1,3,1),T(le,!0,1,4,0),T(le,!0,1,4,1),T(A,!0,1,5,0),T(A,!0,1,5,1)]},linetoolgannsquare:{color:"rgba(21, 56, 153, 0.8)",linewidth:1,linestyle:w,showTopLabels:!0,showBottomLabels:!0,showLeftLabels:!0,showRightLabels:!0,fillHorzBackground:!0,horzTransparency:80,fillVertBackground:!0,vertTransparency:80,reverse:!1,fans:t(we,!1),hlevel1:i(0,Pe,!0),hlevel2:i(.25,ge,!0),hlevel3:i(.382,z,!0),hlevel4:i(.5,pe,!0),hlevel5:i(.618,le,!0),hlevel6:i(.75,A,!0),hlevel7:i(1,Pe,!0),vlevel1:i(0,Pe,!0),vlevel2:i(.25,ge,!0),vlevel3:i(.382,z,!0),vlevel4:i(.5,pe,!0),vlevel5:i(.618,le,!0),vlevel6:i(.75,A,!0),vlevel7:i(1,Pe,!0)},linetoolfibspeedresistancefan:{fillBackground:!0,transparency:80,grid:{color:"rgba(21, 56, 153, 0.8)",linewidth:1,linestyle:w,visible:!0},linewidth:1,linestyle:w,showTopLabels:!0,showBottomLabels:!0,showLeftLabels:!0,showRightLabels:!0,reverse:!1,hlevel1:i(0,Pe,!0),hlevel2:i(.25,ge,!0),hlevel3:i(.382,z,!0),hlevel4:i(.5,pe,!0),hlevel5:i(.618,le,!0),hlevel6:i(.75,A,!0),hlevel7:i(1,Pe,!0),vlevel1:i(0,Pe,!0),vlevel2:i(.25,ge,!0),vlevel3:i(.382,z,!0),vlevel4:i(.5,pe,!0),vlevel5:i(.618,le,!0),vlevel6:i(.75,A,!0),vlevel7:i(1,Pe,!0)},linetoolfibretracement:{showCoeffs:!0,showPrices:!0,fillBackground:!0,transparency:80,extendLines:!1,extendLinesLeft:!1,horzLabelsAlign:"left",vertLabelsAlign:"bottom",reverse:!1,coeffsAsPercents:!1,fibLevelsBasedOnLogScale:!1,labelFontSize:12,trendline:{visible:!0,color:Pe,linewidth:1,linestyle:C},levelsStyle:{linewidth:1,linestyle:w},level1:i(0,Pe,!0),level2:i(.236,K,!0),level3:i(.382,ge,!0),level4:i(.5,pe,!0),level5:i(.618,le,!0),level6:i(.786,z,!0),level7:i(1,Pe,!0),level8:i(1.618,A,!0),level9:i(2.618,K,!0),level10:i(3.618,te,!0),level11:i(4.236,ne,!0),level12:i(1.272,ge,!1),level13:i(1.414,K,!1),level16:i(2,le,!1),level14:i(2.272,ge,!1),level15:i(2.414,pe,!1),level17:i(3,z,!1),level18:i(3.272,Pe,!1),level19:i(3.414,A,!1),level20:i(4,K,!1),level21:i(4.272,te,!1),level22:i(4.414,ne,!1),level23:i(4.618,ge,!1),level24:i(4.764,le,!1)},linetoolfibchannel:{showCoeffs:!0,showPrices:!0,fillBackground:!0,transparency:80,extendLeft:!1,extendRight:!1,horzLabelsAlign:"left",vertLabelsAlign:"middle",coeffsAsPercents:!1,labelFontSize:12,levelsStyle:{linewidth:1,linestyle:w},level1:i(0,Pe,!0),level2:i(.236,K,!0),level3:i(.382,ge,!0),level4:i(.5,pe,!0),level5:i(.618,le,!0),level6:i(.786,z,!0),level7:i(1,Pe,!0),level8:i(1.618,A,!0),level9:i(2.618,K,!0),level10:i(3.618,te,!0),level11:i(4.236,ne,!0),level12:i(1.272,ge,!1),level13:i(1.414,K,!1),level16:i(2,le,!1),level14:i(2.272,ge,!1),level15:i(2.414,pe,!1),level17:i(3,z,!1),level18:i(3.272,Pe,!1),level19:i(3.414,A,!1),level20:i(4,K,!1),level21:i(4.272,te,!1),level22:i(4.414,ne,!1),level23:i(4.618,ge,!1),
level24:i(4.764,le,!1)},linetoolprojection:{showCoeffs:!0,fillBackground:!0,transparency:80,color1:V,color2:se,linewidth:1,trendline:{visible:!0,color:we,linestyle:w},level1:r(1,"#808080",!0)},linetool5pointspattern:{color:A,textcolor:I,fillBackground:!0,backgroundColor:A,fontsize:12,bold:!1,italic:!1,transparency:85,linewidth:1},linetoolcypherpattern:{color:A,textcolor:I,fillBackground:!0,backgroundColor:A,fontsize:12,bold:!1,italic:!1,transparency:85,linewidth:1},linetooltrianglepattern:{color:F,textcolor:I,fillBackground:!0,backgroundColor:F,fontsize:12,bold:!1,italic:!1,transparency:85,linewidth:1},linetoolabcd:{color:le,textcolor:I,fontsize:12,bold:!1,italic:!1,linewidth:1},linetoolthreedrivers:{color:F,textcolor:I,fillBackground:!0,backgroundColor:"rgba(149, 40, 204, 0.5)",fontsize:12,bold:!1,italic:!1,transparency:50,linewidth:1},linetoolheadandshoulders:{color:le,textcolor:I,fillBackground:!0,backgroundColor:le,fontsize:12,bold:!1,italic:!1,transparency:85,linewidth:1},linetoolfibwedge:{showCoeffs:!0,fillBackground:!0,transparency:80,trendline:{visible:!0,color:"#808080",linewidth:1,linestyle:w},level1:r(.236,K,!0),level2:r(.382,ge,!0),level3:r(.5,pe,!0),level4:r(.618,le,!0),level5:r(.786,z,!0),level6:r(1,Pe,!0),level7:r(1.618,A,!1),level8:r(2.618,K,!1),level9:r(3.618,F,!1),level10:r(4.236,ne,!1),level11:r(4.618,ne,!1)},linetoolfibcircles:{showCoeffs:!0,fillBackground:!0,transparency:80,coeffsAsPercents:!1,trendline:{visible:!0,color:Pe,linewidth:1,linestyle:C},level1:r(.236,K,!0),level2:r(.382,ge,!0),level3:r(.5,le,!0),level4:r(.618,pe,!0),level5:r(.786,z,!0),level6:r(1,Pe,!0),level7:r(1.618,A,!0),level8:r(2.618,ne,!0),level9:r(3.618,A,!0),level10:r(4.236,ne,!0),level11:r(4.618,K,!0)},linetoolfibspeedresistancearcs:{showCoeffs:!0,fillBackground:!0,transparency:80,fullCircles:!1,trendline:{visible:!0,color:Pe,linewidth:1,linestyle:C},level1:r(.236,K,!0),level2:r(.382,ge,!0),level3:r(.5,le,!0),level4:r(.618,pe,!0),level5:r(.786,z,!0),level6:r(1,Pe,!0),level7:r(1.618,A,!0),level8:r(2.618,ne,!0),level9:r(3.618,A,!0),level10:r(4.236,ne,!0),level11:r(4.618,K,!0)},linetooltrendbasedfibextension:{showCoeffs:!0,showPrices:!0,fillBackground:!0,transparency:80,extendLines:!1,extendLinesLeft:!1,horzLabelsAlign:"left",vertLabelsAlign:"bottom",reverse:!1,coeffsAsPercents:!1,fibLevelsBasedOnLogScale:!1,labelFontSize:12,trendline:{visible:!0,color:Pe,linewidth:1,linestyle:C},levelsStyle:{linewidth:1,linestyle:w},level1:i(0,Pe,!0),level2:i(.236,K,!0),level3:i(.382,ge,!0),level4:i(.5,pe,!0),level5:i(.618,le,!0),level6:i(.786,z,!0),level7:i(1,Pe,!0),level8:i(1.618,A,!0),level9:i(2.618,K,!0),level10:i(3.618,te,!0),level11:i(4.236,ne,!0),level12:i(1.272,ge,!1),level13:i(1.414,K,!1),level16:i(2,le,!1),level14:i(2.272,ge,!1),level15:i(2.414,pe,!1),level17:i(3,z,!1),level18:i(3.272,Pe,!1),level19:i(3.414,A,!1),level20:i(4,K,!1),level21:i(4.272,te,!1),level22:i(4.414,ne,!1),level23:i(4.618,ge,!1),level24:i(4.764,le,!1)},linetooltrendbasedfibtime:{showCoeffs:!0,fillBackground:!0,transparency:80,horzLabelsAlign:"right",
vertLabelsAlign:"bottom",trendline:{visible:!0,color:Pe,linewidth:1,linestyle:C},level1:r(0,Pe,!0),level2:r(.382,K,!0),level3:r(.5,ue,!1),level4:r(.618,pe,!0),level5:r(1,le,!0),level6:r(1.382,z,!0),level7:r(1.618,Pe,!0),level8:r(2,A,!0),level9:r(2.382,ne,!0),level10:r(2.618,te,!0),level11:r(3,F,!0)},linetoolschiffpitchfork:{fillBackground:!0,transparency:80,style:l.Schiff,median:{visible:!0,color:K,linewidth:1,linestyle:w},extendLines:!1,level0:r(.25,me,!1),level1:r(.382,ue,!1),level2:r(.5,le,!0),level3:r(.618,le,!1),level4:r(.75,z,!1),level5:r(1,A,!0),level6:r(1.5,te,!1),level7:r(1.75,ne,!1),level8:r(2,$,!1)},linetoolschiffpitchfork2:{fillBackground:!0,transparency:80,style:l.Schiff2,median:{visible:!0,color:K,linewidth:1,linestyle:w},extendLines:!1,level0:r(.25,me,!1),level1:r(.382,ue,!1),level2:r(.5,le,!0),level3:r(.618,le,!1),level4:r(.75,z,!1),level5:r(1,A,!0),level6:r(1.5,te,!1),level7:r(1.75,ne,!1),level8:r(2,$,!1)},linetoolinsidepitchfork:{fillBackground:!0,transparency:80,style:l.Inside,median:{visible:!0,color:K,linewidth:1,linestyle:w},extendLines:!1,level0:r(.25,me,!1),level1:r(.382,ue,!1),level2:r(.5,le,!0),level3:r(.618,le,!1),level4:r(.75,z,!1),level5:r(1,A,!0),level6:r(1.5,te,!1),level7:r(1.75,ne,!1),level8:r(2,$,!1)},linetoolregressiontrend:{linewidth:1,linestyle:w,styles:{upLine:{display:u.All,color:E,linestyle:w,linewidth:2},downLine:{display:u.All,color:E,linestyle:w,linewidth:2},baseLine:{display:u.All,color:Z,linestyle:C,linewidth:1},extendLines:!1,showPearsons:!0,transparency:70}}},Re(TradingView.defaultProperties.chartproperties),Oe()}if(void 0===TradingView.defaultProperties["study_MA@tv-basicstudies"]&&(TradingView.defaultProperties["study_MA@tv-basicstudies"]={description:"Moving Average",shortDescription:"MA",inputs:{length:9,source:"close"},styles:{MovAvg:{display:u.All,color:A,linestyle:w,linewidth:1,plottype:d.Line,histogramBase:0,title:"MA"}}}),void 0===TradingView.defaultProperties["study_PivotPointsHighLow@tv-basicstudies"]&&(TradingView.defaultProperties["study_PivotPointsHighLow@tv-basicstudies"]={fontsize:10,borderColor:A,backColor:L,textColor:Ie}),void 0===TradingView.defaultProperties["study_PivotPointsStandard@tv-basicstudies"]){var Ve=!0;TradingView.defaultProperties["study_PivotPointsStandard@tv-basicstudies"]={_hardCodedDefaultsVersion:1,fontsize:11,levelsStyle:{showLabels:!0,visibility:{P:Ve,"S1/R1":Ve,"S2/R2":Ve,"S3/R3":Ve,"S4/R4":Ve,"S5/R5":Ve},colors:{P:ve,"S1/R1":ve,"S2/R2":ve,"S3/R3":ve,"S4/R4":ve,"S5/R5":ve},widths:{P:1,"S1/R1":1,"S2/R2":1,"S3/R3":1,"S4/R4":1,"S5/R5":1}}}}if(void 0===TradingView.defaultProperties["study_ZigZag@tv-basicstudies"]&&(TradingView.defaultProperties["study_ZigZag@tv-basicstudies"]={color:A,linewidth:2}),void 0===TradingView.defaultProperties["study_ElliottWave@tv-basicstudies"]&&(TradingView.defaultProperties["study_ElliottWave@tv-basicstudies"]={inputs:{},level0:t(G,!1),level1:t("#008000",!1),level2:t("#0000ff",!1),level3:t("#ff00ff",!1),level4:t("#0080ff",!0),level5:t(G,!0),level6:t("#008000",!0),level7:t("#0000ff",!0),
level8:t("#ff00ff",!0)}),void 0===TradingView.defaultProperties["study_LinearRegression@tv-basicstudies"]&&(TradingView.defaultProperties["study_LinearRegression@tv-basicstudies"]={styles:{upLine:{display:u.All,color:E,linestyle:w,linewidth:1},downLine:{display:u.All,color:E,linestyle:w,linewidth:1},baseLine:{display:u.All,color:Z,linestyle:w,linewidth:1},extendLines:!0,showPearsons:!0,backgroundColor:"rgba(153, 21, 21, 0.3)",transparency:70}}),void 0===TradingView.defaultProperties["study_Compare@tv-basicstudies"]&&(TradingView.defaultProperties["study_Compare@tv-basicstudies"]={minTick:"default"}),void 0===TradingView.defaultProperties["study_Overlay@tv-basicstudies"]){TradingView.defaultProperties["study_Overlay@tv-basicstudies"]={style:a.STYLE_LINE,allowExtendTimeScale:!1,showPriceLine:!1,minTick:"default",candleStyle:{upColor:"#6ba583",downColor:"#d75442",drawWick:!0,drawBorder:!0,drawBody:!0,borderColor:"#378658",borderUpColor:"#225437",borderDownColor:"#5b1a13",wickColor:"#737375",wickUpColor:"#737375",wickDownColor:"#737375",barColorsOnPrevClose:!1},hollowCandleStyle:{upColor:"#6ba583",downColor:"#d75442",drawWick:!0,drawBorder:!0,drawBody:!0,borderColor:"#378658",borderUpColor:"#225437",borderDownColor:"#5b1a13",wickColor:"#737375",wickUpColor:"#737375",wickDownColor:"#737375",barColorsOnPrevClose:!1},barStyle:{upColor:"#6ba583",downColor:"#d75442",barColorsOnPrevClose:!1,dontDrawOpen:!1,thinBars:!0},lineStyle:{color:Se,linestyle:w,linewidth:2,priceSource:"close",styleType:a.STYLE_LINE_TYPE_SIMPLE},areaStyle:{color1:A,color2:A,linecolor:A,linestyle:w,linewidth:2,priceSource:"close",transparency:95},baselineStyle:{baselineColor:Le,topFillColor1:ke,topFillColor2:ke,bottomFillColor1:De,bottomFillColor2:De,topLineColor:Ae,bottomLineColor:Ee,topLineWidth:2,bottomLineWidth:2,priceSource:"close",transparency:50,baseLevelPercentage:50},hiloStyle:{color:A,showBorders:!0,borderColor:A,showLabels:!0,labelColor:A,drawBody:!0},columnStyle:{upColor:n(le,50),downColor:n(K,50),barColorsOnPrevClose:!0,priceSource:"close"},styles:{open:{display:u.All,color:G,linestyle:w,linewidth:1,plottype:d.Line,histogramBase:0},high:{display:u.All,color:G,linestyle:w,linewidth:1,plottype:d.Line,histogramBase:0},low:{display:u.All,color:G,linestyle:w,linewidth:1,plottype:d.Line,histogramBase:0},close:{display:u.All,color:G,linestyle:w,linewidth:1,plottype:d.Line,histogramBase:0}}}}for(var Ne=e.split("."),Fe=TradingView.defaultProperties,We=0;We<Ne.length;We++)Fe&&(Fe=Fe[Ne[We]]);return null!=Fe?TradingView.clone(Fe):{}};function Ve(e,t,i,s,r){if(s)for(var n in s){var o=n.split("."),a=c(o[0]),l=void 0!==r&&r===o[0];0!==o.length&&l&&(a=c((o=o.slice(1))[0])),0!==o.length&&e.hasOwnProperty(a)?h(e,o,s[n])||d(n):l&&d(n)}function c(e){return t&&t[e]?t[e]:e}function h(e,t,i,s){var r=c(t[0]);return!!e.hasOwnProperty(r)&&(t.length>1?h(e[r],t.slice(1),i):(e[r]&&e[r].setValue?e[r].setValue(i):e[r]=i,!0))}function d(e){i||T.logWarn("Path `"+e+"` does not exist.")}}function Re(e,t,i,s){window.__defaultsOverrides&&Ve(e,t,i,window.__defaultsOverrides,s)}
function Ne(e,t){window.__settingsOverrides&&Ve(e,null,!1,window.__settingsOverrides,t)}function Oe(){var e=/^linetool.+/;Object.keys(TradingView.defaultProperties).forEach((function(t){e.test(t)&&Re(TradingView.defaultProperties[t],null,!1,t)}))}function Fe(e,t){return t?function(e,t){var i=Be(e);if(!window._UNIT_TESTS){var s=TradingView.clone(TVSettings.getJSON(e,null));if(function(e){var t=new Set(["linetoolregressiontrend"]);return e.startsWith("study_")||t.has(e)}(e)&&s&&function(e){if(!e)return!1;e=e.toString();var t=new RegExp("\\d+").exec(e);return null!==t&&t[0]===e}(s.version)){var r=s.inputs,n=t.updateStudyInputs(s.id,s.version,"last",r,null);s.inputs=n,s=t.updateStudyState(s,s)}TradingView.merge(i,s),Ne(i,e)}return i}(e,t):function(e){var t=Be(e);if(!window._UNIT_TESTS){var i=TradingView.clone(TVSettings.getJSON(e,null));if(i){TradingView.merge(t,i);const s=e.split(".");Ne(t,void 0===s[1]?e:s[1])}}return t}(e)}Fe.create=function(e,t){if(t){var i=Be(e);TradingView.defaultProperties[e]=Object.assign(t,i)}},Fe.remove=function(e){TradingView.defaultProperties[e]=void 0},TradingView.saveDefaults=function(e,t){void 0===t?TVSettings.remove(e):TVSettings.setJSON(e,t)},TradingView.factoryDefaults=Be,window.applyDefaultOverridesToLinetools=Oe,window.applyDefaultsOverrides=Re,window.applyPropertiesOverrides=Ve,window.defaults=Fe,t.applyDefaultOverridesToLinetools=Oe,t.applyDefaultsOverrides=Re,t.applyPropertiesOverrides=Ve,t.defaults=Fe,t.factoryDefaults=Be,t.saveDefaults=TradingView.saveDefaults},358076:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SelectPointMode:()=>s,toolIsCursor:()=>_,toolIsMeasure:()=>m,resetToCursor:()=>g,lockTimeAxisTime:()=>P,tool:()=>C,iconTool:()=>T,emojiTool:()=>x,cursorTool:()=>I,isToolCreatingNow:()=>M,isToolEditingNow:()=>L,isToolMovingNow:()=>A,isDirectionalMovementActive:()=>k,createdLineTool:()=>E,continuedLineTool:()=>D,cancelledLineTool:()=>B,beenSetLineToolLastPoint:()=>V,startedMovingLineTool:()=>R,movedLineTool:()=>N,finishedMovingLineTool:()=>O,startedChangingLineTool:()=>F,changedLineTool:()=>W,finishedChangingLineTool:()=>z,removedLineTool:()=>H,finishedLineTool:()=>U,changedLineStyle:()=>j,copiedLineTool:()=>G,restoredLineTool:()=>q,restoredLineToolState:()=>$,activePointSelectionMode:()=>Y,isStudyEditingNow:()=>K,createLineTool:()=>J,continueLineTool:()=>Q,cancelLineTool:()=>ee,setLineToolLastPoint:()=>te,startMovingLineTool:()=>ie,moveLineTool:()=>se,finishMovingLineTool:()=>re,startChangingLineTool:()=>ne,changeLineTool:()=>oe,finishChangingLineTool:()=>ae,removeLineTool:()=>le,finishLineTool:()=>ce,changeLineStyle:()=>he,copyLineTool:()=>de,restoreLineTool:()=>ue,restoreLineToolState:()=>pe,init:()=>ge,runOnDrawingStateReady:()=>fe,properties:()=>ve,hideAllDrawings:()=>Se,hideAllIndicators:()=>ye,lockDrawings:()=>be,hideMarksOnBars:()=>we,drawOnAllCharts:()=>Pe,drawOnAllChartsMode:()=>Ce,lockTimeAxis:()=>Te});var s,r=i(650151),n=i(149926),o=i(508547),a=i(210596),l=i.n(a),c=i(922157),h=i.n(c),d=i(870122),u=i(559410),p=i(658363);function _(e){
return"cursor"===e||"arrow"===e||"dot"===e}function m(e){return"measure"===e}function g(e=!1){if(!e&&f){if(f.childs().stayInDrawingMode.value())return}C.setValue(I.value())}!function(e){e[e.None=0]="None",e[e.Replay=1]="Replay",e[e.Study=2]="Study"}(s||(s={}));let f=null,v=null,S=null,y=null,b=null,w=null;const P=new(l()),C=new(l()),T=new(l()),x=new(l()),I=new(l()),M=new(l())(!1),L=new(l())(!1),A=new(l())(!1),k=new(l())(!1),E=new(h()),D=new(h()),B=new(h()),V=new(h()),R=new(h()),N=new(h()),O=new(h()),F=new(h()),W=new(h()),z=new(h()),H=new(h()),U=new(h()),j=new(h()),G=new(h()),q=new(h()),$=new(h()),Y=new(l())(s.None),K=new(l())(!1);function Z(e,t){const i=t||{value:!1};return t=>{i.value||(i.value=!0,e.fire(t),i.value=!1)}}const X={value:!1},J=Z(E,X),Q=Z(D,X),ee=Z(B,X),te=Z(V,X),ie=Z(R),se=Z(N),re=Z(O),ne=Z(F),oe=Z(W),ae=Z(z),le=Z(H),ce=Z(U),he=Z(j,X),de=Z(G,X),ue=Z(q),pe=Z($);let _e=!1,me=[];function ge(){_e||(C.setValue(d.getValue("chart.cursorPreference","cursor")),C.subscribe((e=>_(e)&&I.setValue(e)),{callWithLast:!0}),I.subscribe((e=>{e&&d.setValue("chart.cursorPreference",e)})),f=new o.DefaultProperty("drawings"),v=(0,n.createPrimitiveProperty)(),S=(0,n.createPrimitiveProperty)(),y=(0,n.createPrimitiveProperty)(),b=(0,n.createPrimitiveProperty)(),w=(0,n.createPrimitiveProperty)(),v.setValue(!1),S.setValue(!1),y.setValue(!1),b.setValue(!1),w.setValue(!1),C.subscribe((()=>{(0,u.emit)("onSelectedLineToolChanged")})),T.subscribe((()=>{(0,p.saveDefaults)("linetoolicon",{...(0,p.defaults)("linetoolicon"),icon:T.value()})})),x.subscribe((()=>{(0,p.saveDefaults)("linetoolemoji",{...(0,p.defaults)("linetoolemoji"),emoji:x.value()})})),_e=!0,me.forEach((e=>e())),me=[])}function fe(e){_e?e():me.push(e)}function ve(){return(0,r.ensureNotNull)(f)}function Se(){return(0,r.ensureNotNull)(v)}function ye(){return(0,r.ensureNotNull)(S)}function be(){return(0,r.ensureNotNull)(y)}function we(){return(0,r.ensureNotNull)(b)}function Pe(){return ve().childs().drawOnAllCharts}function Ce(){return ve().childs().drawOnAllChartsMode}function Te(){return(0,r.ensureNotNull)(w)}},98747:(e,t,i)=>{"use strict";i.d(t,{EnvironmentState:()=>r});var s=i(601227);class r{constructor(e,t=!1){this._shift=!1,this._mod=!1,this._alt=!1,void 0!==e&&(this._shift=Boolean(e.shiftKey),this._mod=Boolean((0,s.isMac)()?e.metaKey:e.ctrlKey),this._alt=Boolean(e.altKey)),this._isApiEvent=t}shift(){return this._shift}mod(){return this._mod}alt(){return this._alt}shiftOnly(){return this._shift&&!this._mod&&!this._alt}modOnly(){return this._mod&&!this._shift&&!this._alt}altOnly(){return this._alt&&!this._shift&&!this._mod}modShift(){return this._shift&&this._mod&&!this._alt}isApiEvent(){return this._isApiEvent}static create(e=!1,t=!1,i=!1){return new r({shiftKey:e,ctrlKey:t,metaKey:t,altKey:i})}}},881881:(e,t,i)=>{"use strict";function s(e){return"="+JSON.stringify(r(e))}function r(e){return Object.keys(e).sort().reduce(((t,i)=>("[object Object]"===Object.prototype.toString.call(e[i])?t[i]=r(e[i]):t[i]=e[i],t)),{})}function n(e){return s(e)}function o(e){
return"="===e[0]}function a(e){if(!o(e))return{symbol:e};try{return JSON.parse(e.slice(1))}catch(t){return{symbol:e}}}function l(e){return"string"==typeof e?e:l(e.symbol)}i.r(t),i.d(t,{encodeExtendedSymbolOrGetSimpleSymbolString:()=>n,isEncodedExtendedSymbol:()=>o,decodeExtendedSymbol:()=>a,unwrapSimpleSymbol:()=>l})},563068:(e,t,i)=>{"use strict";i.d(t,{customFormatters:()=>s});const s={dateFormatter:null,timeFormatter:null,tickMarkFormatter:null,priceFormatterFactory:null,studyFormatterFactory:null}},54266:(e,t,i)=>{"use strict";i.d(t,{dateFormatFunctions:()=>m,getDateFormatWithWeekday:()=>g,availableDateFormats:()=>f,defaultDateFormat:()=>v});var s=i(509806),r=i(471187),n=i(821737);const o={1:()=>s.t(null,void 0,i(795425)),2:()=>s.t(null,void 0,i(835050)),3:()=>s.t(null,void 0,i(651369)),4:()=>s.t(null,void 0,i(442762)),5:()=>s.t(null,{context:"short"},i(227991)),6:()=>s.t(null,void 0,i(715224)),7:()=>s.t(null,void 0,i(6215)),8:()=>s.t(null,void 0,i(38465)),9:()=>s.t(null,void 0,i(757902)),10:()=>s.t(null,void 0,i(73546)),11:()=>s.t(null,void 0,i(671230)),12:()=>s.t(null,void 0,i(92203))},a=(e,t)=>(t?e.getMonth():e.getUTCMonth())+1,l=(e,t)=>t?e.getFullYear():e.getUTCFullYear(),c=e=>e.toLocaleDateString(window.language?(0,r.getIsoLanguageCodeFromLanguage)(window.language):void 0,{weekday:"short",timeZone:"UTC"}),h=(e,t)=>(0,n.numberToStringWithLeadingZero)(((e,t)=>t?e.getDate():e.getUTCDate())(e,t),2),d=(e,t)=>o[a(e,t)](),u=(e,t)=>(0,n.numberToStringWithLeadingZero)(a(e,t),2),p=(e,t)=>(0,n.numberToStringWithLeadingZero)(l(e,t)%100,2),_=(e,t)=>(0,n.numberToStringWithLeadingZero)(l(e,t),4),m={"dd MMM 'yy":(e,t)=>`${h(e,t)} ${d(e,t)} '${p(e,t)}`,"MMM dd, yyyy":(e,t)=>`${d(e,t)} ${h(e,t)}, ${_(e,t)}`,"MMM dd":(e,t)=>`${d(e,t)} ${h(e,t)}`,"dd MMM":(e,t)=>`${h(e,t)} ${d(e,t)}`,"yyyy-MM-dd":(e,t)=>`${_(e,t)}-${u(e,t)}-${h(e,t)}`,"yy-MM-dd":(e,t)=>`${p(e,t)}-${u(e,t)}-${h(e,t)}`,"yy/MM/dd":(e,t)=>`${p(e,t)}/${u(e,t)}/${h(e,t)}`,"yyyy/MM/dd":(e,t)=>`${_(e,t)}/${u(e,t)}/${h(e,t)}`,"dd-MM-yyyy":(e,t)=>`${h(e,t)}-${u(e,t)}-${_(e,t)}`,"dd-MM-yy":(e,t)=>`${h(e,t)}-${u(e,t)}-${p(e,t)}`,"dd/MM/yy":(e,t)=>`${h(e,t)}/${u(e,t)}/${p(e,t)}`,"dd/MM/yyyy":(e,t)=>`${h(e,t)}/${u(e,t)}/${_(e,t)}`,"MM/dd/yy":(e,t)=>`${u(e,t)}/${h(e,t)}/${p(e,t)}`,"MM/dd/yyyy":(e,t)=>`${u(e,t)}/${h(e,t)}/${_(e,t)}`};function g(e){return"ja"===window.language?(t,i)=>`${m[e](t,i)} (${c(t)})`:(t,i)=>`${c(t)} ${m[e](t,i)}`}const f=Object.keys(m),v=()=>-1!==["ja","ko","zh","zh_TW"].indexOf(window.language||"")?"yyyy-MM-dd":"dd MMM 'yy"},943624:(e,t,i)=>{"use strict";i.d(t,{DateFormatter:()=>n});var s=i(563068),r=i(54266);class n{constructor(e="yyyy-MM-dd",t=!1){this._dateFormatFunc=t?(0,r.getDateFormatWithWeekday)(e):r.dateFormatFunctions[e]}format(e){return s.customFormatters&&s.customFormatters.dateFormatter?s.customFormatters.dateFormatter.format(e):this._dateFormatFunc(e,!1)}formatLocal(e){
return s.customFormatters.dateFormatter?s.customFormatters.dateFormatter.formatLocal?s.customFormatters.dateFormatter.formatLocal(e):s.customFormatters.dateFormatter.format(e):this._dateFormatFunc(e,!0)}}},499445:(e,t,i)=>{"use strict";i.d(t,{DateTimeFormatter:()=>o});var s=i(951327),r=i(943624);const n={dateFormat:"yyyy-MM-dd",withWeekday:!1,timeFormat:s.hourMinuteSecondFormat,dateTimeSeparator:" "};class o{constructor(e={}){const t=Object.assign({},n,e);this._dateFormatter=new r.DateFormatter(t.dateFormat,t.withWeekday),this._timeFormatter=new s.TimeFormatter(t.timeFormat),this._separator=t.dateTimeSeparator}format(e){return`${this._dateFormatter.format(e)}${this._separator}${this._timeFormatter.format(e)}`}formatLocal(e){return`${this._dateFormatter.formatLocal(e)}${this._separator}${this._timeFormatter.formatLocal(e)}`}}},628454:(e,t,i)=>{"use strict";i.d(t,{LimitedPrecisionNumericFormatter:()=>r});var s=i(486028);class r{constructor(e=1){this._precision=e}format(e){(0,s.isNumber)(e)||(e=parseFloat(e));const t=e.toFixed(this._precision),i=Math.pow(10,-this._precision);return Math.max(parseFloat(t),i)+""}parse(e){const t=parseFloat(e);return isNaN(t)?{res:!1}:{res:!0,value:t,suggest:this.format(t)}}}},66568:(e,t,i)=>{"use strict";i.d(t,{NumericFormatter:()=>n});var s=i(821737),r=i(960521);class n{constructor(e){this._precision=e}format(e){return(void 0!==this._precision?e.toFixed(this._precision):n.formatNoE(e)).replace(".",s.formatterOptions.decimalSign)}parse(e){const t=e.replace(s.formatterOptions.decimalSign,".");let i=parseFloat(t);return this._precision&&(i=+i.toFixed(this._precision)),i}static formatNoE(e){if(!Number.isFinite(e))return String(e);const t=new r.Big(e);return t.lt(1)?t.toFixed():t.toString()}}},58594:(e,t,i)=>{"use strict";i.d(t,{PercentageFormatter:()=>n});var s=i(821737),r=i(561626);class n extends s.PriceFormatter{constructor(e){super(e),this.type="percentage"}state(){const e=s.PriceFormatter.prototype.state.call(this);return e.percent=!0,e}parse(e){return e=e.replace("%",""),super.parse(e)}format(e,t,i,s,n=!0){const o=super.format(e,t,i,s,!1)+"%";return n?(0,r.forceLTRStr)(o):o}static serialize(e){return e.state()}static deserialize(e){return new n(e.priceScale)}}},716590:(e,t,i)=>{"use strict";i.d(t,{PipFormatter:()=>r});var s=i(821737);class r extends s.PriceFormatter{constructor(e,t,i,s){t||(t=1),"forex"!==i&&"cfd"!==i||!s?(super(1),this._isForex=!1):(super(s),this._isForex=!0),this._pipPriceScale=e,this._pipMinMove=t,this._pipMinMove2=s}format(e,t,i){let s=this._isForex?this._pipMinMove2:this._pipMinMove;return void 0===s&&(s=NaN),super.format(e*this._pipPriceScale/s,t,i)}}},821737:(e,t,i)=>{"use strict";i.r(t),i.d(t,{formatterOptions:()=>d,numberToStringWithLeadingZero:()=>m,isFormatterHasForexAdditionalPrecision:()=>g,PriceFormatter:()=>f});var s=i(509806),r=i(960521),n=i(79581),o=i(486028),a=i(561626),l=i(717861);const c=(0,i(817808).getLogger)("Chart.PriceFormatter"),h=new RegExp(/^(-?)[0-9]+$/),d={decimalSign:".",decimalSignFractional:"'"},u=new Map;const p=new Map
;function _(e,t,i,s){let r=0;if(e>0&&t>0){let t=e;for(i&&s&&(t/=s);t>1;)t/=10,r++}return r}function m(e,t){if(!(0,o.isNumber)(e))return"n/a";if(!(0,o.isInteger)(t))throw new TypeError("invalid length");if(t<0||t>24)throw new TypeError("invalid length");if(0===t)return e.toString();return("0000000000000000"+e.toString()).slice(-t)}function g(e){return"hasForexAdditionalPrecision"in e}class f{constructor(e,t,r,a,l){if(this.type="price",this._formatterErrors={custom:s.t(null,void 0,i(332061)),fraction:s.t(null,void 0,i(142015)),secondFraction:s.t(null,void 0,i(643247))},t||(t=1),(0,o.isNumber)(e)&&(0,o.isInteger)(e)||(e=100),e<0)throw new TypeError("invalid base");this._priceScale=e,this._minMove=t,this._minMove2=a,this._variableMinTickData=r||void 0===l?void 0:(0,n.makeVariableMinTickData)(NaN,l),r&&void 0!==a&&a>0&&2!==a&&4!==a&&8!==a?c.logDebug("invalid minmove2"):(this._fractional=r,this._fractionalLength=_(this._priceScale,this._minMove,this._fractional,this._minMove2))}isFractional(){return!!this._fractional}state(){return{fractional:this._fractional,fractionalLength:this._fractionalLength,minMove:this._minMove,minMove2:this._minMove2,priceScale:this._priceScale}}format(e,t,i,s=!0,o=!0,c=!1){let h="";e<0?(h=!1===s?"":"−",e=-e):e&&!0===t&&(h="+");let d,u=this._priceScale,p=this._minMove,m=this._fractionalLength;if(void 0!==this._variableMinTickData){const t=(0,n.getMinTick)({price:e,minTick:NaN,variableMinTickData:this._variableMinTickData,shouldCheckForEquality:!0});u=Math.pow(10,(0,l.numOfDecimalPlaces)(t)),p=(0,r.Big)(t).mul(u).toNumber(),m=_(u,p)}return d=this._fractional?h+this._formatAsFractional(e,i):h+this._formatAsDecimal({price:e,priceScale:u,minMove:p,fractionalLength:m,tailSize:i,cutFractionalByPrecision:c}),o?(0,a.forceLTRStr)(d):d}parse(e){return"+"===(e=(e=(0,a.stripLTRMarks)(e)).replace("−","-"))[0]&&(e=e.substring(1)),this._fractional?this._minMove2?this._parseAsDoubleFractional(e):this._parseAsSingleFractional(e):this._parseAsDecimal(e)}hasForexAdditionalPrecision(){return!this._fractional&&10===this._minMove2}static serialize(e){return e.state()}static deserialize(e){return new f(e.priceScale,e.minMove,e.fractional,e.minMove2)}_formatAsExponential(e){const t=Math.floor(.75*Math.log10(this._priceScale)),i=e*Math.pow(10,t),s=`e-${t}`,r=Math.log10(this._priceScale)-t;return`${i.toFixed(r).replace(".",d.decimalSign)}${s}`}_formatAsDecimal(e){const{price:t,priceScale:i,minMove:s,fractionalLength:n=0,tailSize:o=0,cutFractionalByPrecision:a}=e;if(i>1e10)return this._formatAsExponential(t);let l;l=this._fractional?Math.pow(10,n):Math.pow(10,o)*i/(a?1:s);const c=1/l;let h;if(l>1)h=Math.floor(t);else{const e=Math.floor(Math.round(t/c)*c);h=0===Math.round((t-e)/c)?e:e+c}let u="";if(l>1){let e=a?new r.Big(t).mul(l).round(void 0,0).minus(new r.Big(h).mul(l)).toNumber():parseFloat((Math.round(t*l)-h*l).toFixed(n));e>=l&&(e-=l,h+=1);const i=a?new r.Big(e).round(n,0).toNumber():parseFloat(e.toFixed(n))*s;u=d.decimalSign+m(i,n+o),u=this._removeEndingZeros(u,o)}return h.toString()+u}_getFractPart(e,t,i){
const s=[0,5],r=[0,2,5,7],n=[0,1,2,3,5,6,7,8];return 2===i?void 0===s[e]?-1:s[e]:4===i?void 0===r[e]?-1:r[e]:8===i&&2===t?void 0===n[e]?-1:n[e]:e}_formatAsFractional(e,t){const i=this._priceScale/this._minMove;let s=Math.floor(e),r=t?Math.floor(e*i)-s*i:Math.round(e*i)-s*i;r===i&&(r=0,s+=1);let n="";if(t){let o=(e-s-r/i)*i;o=Math.round(o*Math.pow(10,t)),n=m(o,t),n=this._removeEndingZeros(n,t)}if(!this._fractionalLength)throw new Error("_fractionalLength is not calculated");let o="";if(this._minMove2){const e=r%this._minMove2;r=(r-e)/this._minMove2;const t=m(r,this._fractionalLength),i=this._getFractPart(e,2,this._minMove2);o=t+d.decimalSignFractional+i}else r=this._getFractPart(r,1,this._priceScale),o=m(r*this._minMove,this._fractionalLength);return s.toString()+d.decimalSignFractional+o+n}_removeEndingZeros(e,t){for(let i=0;i<t&&"0"===e[e.length-1];i++)e=e.substring(0,e.length-1);return e}_parseAsDecimal(e){if(e.includes("e")){if(function(e){let t=u.get(e);return t||(t=new RegExp("^(-?)[0-9]+\\"+e+"[0-9]*e(-?)[0-9]+$"),u.set(e,t)),t}(d.decimalSign).exec(e)){const t=parseFloat(e.replace(d.decimalSign,"."));return{value:t,res:!0,suggest:this.format(t)}}return{error:this._formatterErrors.custom,res:!1}}let t=h.exec(e);if(t){const t=parseFloat(e);return{value:t,res:!0,suggest:this.format(t)}}if(t=function(e){let t=p.get(e);return t||(t=new RegExp("^(-?)[0-9]+\\"+d.decimalSign+"[0-9]*$"),p.set(e,t)),t}(d.decimalSign).exec(e),t){const t=parseFloat(e.replace(d.decimalSign,"."));return{value:t,res:!0,suggest:this.format(t)}}return{error:this._formatterErrors.custom,res:!1}}_patchFractPart(e,t,i){const s={0:0,5:1},r={0:0,2:1,5:2,7:3},n={0:0,1:1,2:2,3:3,5:4,6:5,7:6,8:7};return 2===i?void 0===s[e]?-1:s[e]:4===i?void 0===r[e]?-1:r[e]:8===i&&2===t?void 0===n[e]?-1:n[e]:e}_parseAsSingleFractional(e){let t=h.exec(e);if(t){const t=parseFloat(e);return{value:t,res:!0,suggest:this.format(t)}}if(t=new RegExp("^(-?)([0-9]+)\\"+d.decimalSignFractional+"([0-9]+)$").exec(e),t){const e=!!t[1],i=parseInt(t[2]),s=this._priceScale,r=this._patchFractPart(parseInt(t[3]),1,s);if(r>=s||r<0)return{error:this._formatterErrors.fraction,res:!1};let n=i+r/s;return e&&(n=-n),{value:n,res:!0,suggest:this.format(n)}}return{error:this._formatterErrors.custom,res:!1}}_parseAsDoubleFractional(e){let t=h.exec(e);if(t){const t=parseFloat(e);return{value:t,res:!0,suggest:this.format(t)}}if(t=new RegExp("^(-?)([0-9]+)\\"+d.decimalSignFractional+"([0-9]+)\\"+d.decimalSignFractional+"([0-9]+)$").exec(e),t){const e=!!t[1],i=parseInt(t[2]),s=void 0!==this._minMove2?this._minMove2:NaN,r=this._priceScale/s,n=this._minMove2,o=this._patchFractPart(parseInt(t[3]),1,r),a=this._patchFractPart(parseInt(t[4]),2,n);if(o>=r||o<0)return{error:this._formatterErrors.fraction,res:!1};if(void 0!==n&&a>=n||a<0)return{error:this._formatterErrors.secondFraction,res:!1};let l=void 0!==n?i+o/r+a/(r*n):NaN;return e&&(l=-l),{value:l,res:!0,suggest:this.format(l)}}return{error:this._formatterErrors.custom,res:!1}}}},778389:(e,t,i)=>{"use strict";i.d(t,{QuantityFormatter:()=>r})
;var s=i(66568);class r{constructor(e){this._formatter=new s.NumericFormatter(e)}format(e){return this._formatter.format(e)}parse(e){const t=this._formatter.parse(e);return Number.isNaN(t)?{res:!1,error:"Value is NaN"}:{res:!0,value:t}}}},951327:(e,t,i)=>{"use strict";i.d(t,{hourMinuteSecondFormat:()=>n,hourMinuteFormat:()=>o,twelveHourMinuteSecondFormat:()=>a,twelveHourMinuteFormat:()=>l,TimeFormatter:()=>c});var s=i(563068),r=i(821737);const n="%h:%m:%s",o="%h:%m",a="%h:%m:%s %ampm",l="%h:%m %ampm";class c{constructor(e){this._isTwelveHoursFormat=!1,this._formatStr=e||n,this._isTwelveHoursFormat=this._formatStr.includes("%ampm")}format(e){return s.customFormatters.timeFormatter?s.customFormatters.timeFormatter.format(e):this._formatTime(e,!1)}formatLocal(e){return s.customFormatters.timeFormatter?s.customFormatters.timeFormatter.formatLocal?s.customFormatters.timeFormatter.formatLocal(e):s.customFormatters.timeFormatter.format(e):this._formatTime(e,!0)}_formatTime(e,t){let i=t?e.getHours():e.getUTCHours();const s=t?e.getMinutes():e.getUTCMinutes(),n=t?e.getSeconds():e.getUTCSeconds(),o=t?e.getMilliseconds():e.getUTCMilliseconds();let a="";return this._isTwelveHoursFormat&&(a=i>=12?"PM":"AM",i%=12,i=i||12),this._formatStr.replace("%h",(0,r.numberToStringWithLeadingZero)(i,2)).replace("%m",(0,r.numberToStringWithLeadingZero)(s,2)).replace("%s",(0,r.numberToStringWithLeadingZero)(n,2)).replace("%ss",(0,r.numberToStringWithLeadingZero)(o,3)).replace("%ampm",a)}}},551040:(e,t,i)=>{"use strict";i.d(t,{TimeSpanFormatter:()=>r});var s=i(509806);class r{format(e){const t=e<0;e=Math.abs(e);const r=Math.floor(e/86400);e-=86400*r;const n=Math.floor(e/3600);e-=3600*n;const o=Math.floor(e/60);e-=60*o;let a="";return r&&(a+=r+s.t(null,{context:"dates"},i(297840))+" "),n&&(a+=n+s.t(null,{context:"dates"},i(564302))+" "),o&&(a+=o+s.t(null,{context:"dates"},i(592659))+" "),e&&(a+=e+s.t(null,{context:"dates"},i(222448))+" "),t&&(a="-"+a),a.trim()}}},609781:(e,t,i)=>{"use strict";i.d(t,{VolumeFormatter:()=>o});var s=i(509806),r=i(66568),n=i(486028);class o{constructor(e){this.type="volume",this._numericFormatter=new r.NumericFormatter,this._fractionalValues=void 0!==e&&e>0,this._precision=e}state(){return{precision:this._precision}}format(e,t){if(!(0,n.isNumber)(e))return"---";let r="";return e<0?(r="−",e=-e):e>0&&t&&(r="+"),e>=1e100?s.t(null,void 0,i(343088)):(!this._fractionalValues||e>=995?e=Math.round(e):this._fractionalValues&&(e=+e.toFixed(this._precision)),e<995?r+this._formatNumber(e):e<999995?r+this._formatNumber(e/1e3)+"K":e<999999995?(e=1e3*Math.round(e/1e3),r+this._formatNumber(e/1e6)+"M"):e<999999999995?(e=1e6*Math.round(e/1e6),r+this._formatNumber(e/1e9)+"B"):(e=1e9*Math.round(e/1e9),r+this._formatNumber(e/1e12)+"T"))}parse(e){if("---"===e)return{error:"not a number",res:!1,value:NaN};const t={K:1e3,M:1e6,B:1e9},i=e.slice(-1);if(t.hasOwnProperty(i)){const s=this._numericFormatter.parse(e.slice(0,-1));return(0,n.isNumber)(s)?{res:!0,value:s*t[i]}:{error:"not a number",res:!1,value:NaN}}{
const t=this._numericFormatter.parse(e);return(0,n.isNumber)(t)?{res:!0,value:t}:{error:"not a number",res:!1,value:NaN}}}static serialize(e){return e.state()}static deserialize(e){return new o(e.precision)}_formatNumber(e){if(this._fractionalValues&&0!==e){const t=14-Math.ceil(Math.log10(e)),i=Math.pow(10,t);e=Math.round(e*i)/i}return this._numericFormatter.format(e).replace(/(\.[1-9]*)0+$/,((e,t)=>t))}}},161999:(e,t,i)=>{"use strict";i.d(t,{shouldBeFormattedAsPercent:()=>n,shouldBeFormattedAsIndexedTo100:()=>o,getPriceValueFormatterForSource:()=>a});var s=i(632054),r=i(296055);function n(e){const t=e.priceScale();return!(null===t||!t.isPercentage())&&(!(0,r.isActingAsSymbolSource)(e)||(0,s.isPriceSourceStyle)(e.style()))}function o(e){const t=e.priceScale();return!(null===t||!t.isIndexedTo100())&&(!(0,r.isActingAsSymbolSource)(e)||(0,s.isPriceSourceStyle)(e.style()))}function a(e){const t=e.priceScale();if(o(e)&&null!==t)return i=>{var s;return t.formatPriceIndexedTo100(i,null!==(s=e.firstValue())&&void 0!==s?s:100)};if(n(e)&&null!==t)return i=>{var s;return t.formatPricePercentage(i,null!==(s=e.firstValue())&&void 0!==s?s:100)};const i=e.formatter();return i.format.bind(i)}},777277:(e,t,i)=>{"use strict";function s(e,t,i){if(e.isTouch){if(void 0!==i)return i(e),!0}else if(void 0!==t)return t(e),!0;return!1}function r(e,t,i,s){return void 0!==t.executeDefaultAction&&(e.isTouch?Boolean(t.executeDefaultAction[s]):Boolean(t.executeDefaultAction[i]))}var n;i.d(t,{tryCallHandler:()=>s,shouldDefaultActionBeExecuted:()=>r,AreaName:()=>n,HitTestResult:()=>o}),function(e){e.Style="Style",e.Text="Text",e.SourceItemMove="SourceItemMove"}(n||(n={}));class o{constructor(e,t,i){this._result=e,this._data=t||null,this._eraseMarker=i}result(){return this._result}data(){return this._data}hasPressedMoveHandler(e){return null!==this._data&&function(e,t,i){if(e.isTouch){if(void 0!==i)return!0}else if(void 0!==t)return!0;return!1}(e,this._data.pressedMouseMoveHandler,this._data.touchMoveHandler)}tryCallMouseDownOrTouchStartHandler(e){return null!==this._data&&s(e,this._data.mouseDownHandler,this._data.touchStartHandler)}tryCallMouseUpOrTouchEndHandler(e){return null!==this._data&&s(e,this._data.mouseUpHandler,this._data.touchEndHandler)}tryCallMouseEnterHandler(e){return null!==this._data&&s(e,this._data.mouseEnterHandler)}tryCallMouseLeaveHandler(e){return null!==this._data&&s(e,this._data.mouseLeaveHandler)}tryCallMouseMoveHandler(e){return null!==this._data&&s(e,this._data.mouseMoveHandler)}tryCallClickOrTapHandler(e){return null!==this._data&&s(e,this._data.clickHandler,this._data.tapHandler)}tryCallDblClickOrDblTapHandler(e){return null!==this._data&&s(e,this._data.doubleClickHandler,this._data.doubleTapHandler)}tryCallContextMenuHandler(e){return null!==this._data&&s(e,this._data.contextMenuHandler,this._data.touchContextMenuHandler)}eraseMarker(){return this._eraseMarker}}o.MOVEPOINT_BACKGROUND=1,o.REGULAR=2,o.MOVEPOINT=3,o.CHANGEPOINT=4,o.CUSTOM=5},953854:(e,t,i)=>{"use strict";i.d(t,{HorizontalLinePaneView:()=>n})
;var s=i(68976),r=i(284269);class n{constructor(){this._lineRendererData={y:0,color:"rgba(0, 0, 0, 0)",linewidth:1,linestyle:r.LINESTYLE_SOLID,visible:!1},this._lineRenderer=new s.HorizontalLineRenderer,this._invalidated=!0,this._lineRenderer.setData(this._lineRendererData)}update(e){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._lineRenderer}}},927079:(e,t,i)=>{"use strict";var s,r;i.d(t,{PlDisplay:()=>s,TradedGroupHorizontalAlignment:()=>r,tradingPreferencesDefault:()=>n,CustomSourceLayer:()=>o}),function(e){e[e.Money=0]="Money",e[e.Pips=1]="Pips",e[e.Percentage=2]="Percentage"}(s||(s={})),function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"}(r||(r={}));const n={showPositions:!1,positionPL:{visibility:!1,display:s.Money},bracketsPL:{visibility:!1,display:s.Money},showOrders:!1,showExecutions:!1,showExecutionsLabels:!1,showReverse:!1,extendLeft:!1,lineLength:0,horizontalAlignment:r.Right,lineWidth:0,lineStyle:0};var o;!function(e){e[e.Background=0]="Background",e[e.Foreground=1]="Foreground",e[e.Topmost=2]="Topmost"}(o||(o={}))},638273:(e,t,i)=>{"use strict";i.d(t,{ResolutionKind:()=>n,SpecialResolutionKind:()=>o,Interval:()=>h,isHour:()=>u});const s=/^(\d*)([TSHDWMR])$/,r=/^(\d+)$/;var n,o;!function(e){e.Ticks="ticks",e.Seconds="seconds",e.Minutes="minutes",e.Days="days",e.Weeks="weeks",e.Months="months",e.Range="range",e.Invalid="invalid"}(n||(n={})),function(e){e.Hours="hours"}(o||(o={}));const a={};a[n.Ticks]=1e3,a[n.Seconds]=1e3,a[n.Minutes]=60*a[n.Seconds],a[n.Days]=1440*a[n.Minutes],a[n.Weeks]=7*a[n.Days];const l={T:n.Ticks,S:n.Seconds,D:n.Days,W:n.Weeks,M:n.Months,R:n.Range},c=new Set([n.Ticks,n.Seconds,n.Minutes]);class h{constructor(e,t){this._kind=n.Invalid,this._multiplier=0,e!==n.Invalid&&t>0&&(this._kind=e,this._multiplier=t)}kind(){return this._kind}multiplier(){return this._multiplier}isValid(){return this.kind()!==n.Invalid&&this.multiplier()>0}isDWM(){return this.isValid()&&!this.isRange()&&!this.isIntraday()&&!this.isTicks()}isIntraday(){const e=c.has(this.kind());return this.isValid()&&e}isSeconds(){return this.kind()===n.Seconds}isMinutes(){return this.kind()===n.Minutes}isMinuteHours(){return this.kind()===n.Minutes&&u(this.multiplier())}isDays(){return this.kind()===n.Days}isWeeks(){return this.kind()===n.Weeks}isMonths(){return this.kind()===n.Months}isRange(){return this.kind()===n.Range}isTicks(){return this.kind()===n.Ticks}isTimeBased(){return!this.isRange()}letter(){return this.isValid()&&this.kind()!==n.Minutes?this.kind()[0].toUpperCase():""}value(){return this.isValid()?this.kind()===n.Minutes?this.multiplier()+"":this.multiplier()+this.letter():""}isEqualTo(e){if(!(e instanceof h))throw new Error("Argument is not an Interval");return!(!this.isValid()||!e.isValid())&&(this.kind()===e.kind()&&this.multiplier()===e.multiplier())}inMilliseconds(e=Date.now()){if(!this.isValid()||this.isRange())return NaN;if(this.isMonths()){const t=new Date(e);t.setUTCMonth(t.getUTCMonth()+(this.multiplier()||1));return+t-e}
const t=this.multiplier();return a[this.kind()]*t}static isEqual(e,t){return e===t||h.parse(e).isEqualTo(h.parse(t))}static parseExt(e){e=(e+"").toUpperCase().split(",")[0];let t=s.exec(e);return null!==t?"H"===t[2]?{interval:new h(n.Minutes,60*d(t[1])),guiResolutionKind:o.Hours}:{interval:new h(l[t[2]],d(t[1])),guiResolutionKind:l[t[2]]}:(t=r.exec(e),null!==t?{interval:new h(n.Minutes,d(t[1])),guiResolutionKind:n.Minutes}:{interval:new h(n.Invalid,0),guiResolutionKind:n.Invalid})}static parse(e){return h.parseExt(e).interval}static kind(e){return h.parse(e).kind()}static isValid(e){return h.parse(e).isValid()}static isDWM(e){return h.parse(e).isDWM()}static isIntraday(e){return h.parse(e).isIntraday()}static isSeconds(e){return h.parse(e).isSeconds()}static isMinutes(e){return h.parse(e).isMinutes()}static isMinuteHours(e){return h.parse(e).isMinuteHours()}static isDays(e){return h.parse(e).isDays()}static isWeeks(e){return h.parse(e).isWeeks()}static isMonths(e){return h.parse(e).isMonths()}static isRange(e){return h.parse(e).isRange()}static isTicks(e){return h.parse(e).isTicks()}static isTimeBased(e){return h.parse(e).isTimeBased()}static normalize(e){const t=h.parse(e);return t.isValid()?t.value():null}}function d(e){return 0===e.length?1:parseInt(e,10)}function u(e){return e>=60&&!(e%60)}},785359:(e,t,i)=>{"use strict";i.d(t,{intervalsVisibilitiesDefaults:()=>s});const s={ticks:!0,seconds:!0,secondsFrom:1,secondsTo:59,minutes:!0,minutesFrom:1,minutesTo:59,hours:!0,hoursFrom:1,hoursTo:24,days:!0,daysFrom:1,daysTo:366,weeks:!0,weeksFrom:1,weeksTo:52,months:!0,monthsFrom:1,monthsTo:12,ranges:!0}},920936:(e,t,i)=>{"use strict";i.d(t,{IntervalsVisibilitiesProperty:()=>n});var s=i(976704),r=i.n(s);i(224778);class n extends(r()){state(e){return super.state(e)}storeStateIfUndefined(){return!1}}},224778:(e,t,i)=>{"use strict";i.d(t,{makeIntervalsVisibilitiesVisibleAtInterval:()=>l,isActualInterval:()=>h,mergeIntervalVisibilitiesDefaults:()=>d,getIntervalsVisibilitiesForMode:()=>u});var s=i(58121),r=i(822914),n=i(650151),o=i(638273),a=i(785359);function l(e,t){let i=t.multiplier();if(t.isTicks()&&(e.ticks=!0),t.isSeconds()&&(i<60?(e.seconds=!0,e.secondsFrom=Math.min(e.secondsFrom,i),e.secondsTo=Math.max(e.secondsTo,i)):(i=Math.floor(i/60),t=new o.Interval(o.ResolutionKind.Minutes,i))),t.isMinutes())if(i<60)e.minutes=!0,e.minutesFrom=Math.min(e.minutesFrom,i),e.minutesTo=Math.max(e.minutesTo,i);else{const t=Math.floor(i/60);e.hours=!0,e.hoursFrom=Math.min(e.hoursFrom,t),e.hoursTo=Math.max(e.hoursTo,t)}t.isDays()&&(e.days=!0,e.daysFrom=Math.min(e.daysFrom,i),e.daysTo=Math.max(e.daysTo,i)),t.isWeeks()&&(e.weeks=!0,e.weeksFrom=Math.min(e.weeksFrom,i),e.weeksTo=Math.max(e.weeksTo,i)),t.isMonths()&&(e.months=!0,e.monthsFrom=Math.min(e.monthsFrom,i),e.monthsTo=Math.max(e.monthsTo,i)),t.isRange()&&(e.ranges=!0)}function c(e,t,i,s){return e&&s>=t&&s<=i}function h(e,t){const i=t.childs();switch(e.kind()){case o.ResolutionKind.Ticks:return i.ticks.value();case o.ResolutionKind.Seconds:
if(e.multiplier()<60)return c(i.seconds.value(),i.secondsFrom.value(),i.secondsTo.value(),e.multiplier());{const t=Math.floor(e.multiplier()/60);return c(i.minutes.value(),i.minutesFrom.value(),i.minutesTo.value(),t)}case o.ResolutionKind.Minutes:if(e.multiplier()<60)return c(i.minutes.value(),i.minutesFrom.value(),i.minutesTo.value(),e.multiplier());{const t=Math.floor(e.multiplier()/60);return c(i.hours.value(),i.hoursFrom.value(),i.hoursTo.value(),t)}case o.ResolutionKind.Days:return c(i.days.value(),i.daysFrom.value(),i.daysTo.value(),e.multiplier());case o.ResolutionKind.Weeks:return c(i.weeks.value(),i.weeksFrom.value(),i.weeksTo.value(),e.multiplier());case o.ResolutionKind.Months:return c(i.months.value(),i.monthsFrom.value(),i.monthsTo.value(),e.multiplier());case o.ResolutionKind.Range:return i.ranges.value()}return(0,n.assert)(!1,`Unsupported resolution: ${e.value()}`),!1}function d(e){return(0,s.default)((0,r.default)(a.intervalsVisibilitiesDefaults),null!=e?e:{})}function u(e,t){if(0===t||e.isTicks()&&3===t||e.isRange()&&2===t)return d();let i=!1;const s={ticks:!1,seconds:!1,minutes:!1,hours:!1,days:!1,weeks:!1,months:!1,ranges:!1},r=e=>e.multiplier();return[{checker:e=>e.isTicks(),getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.ticks=!0}},{checker:e=>e.isSeconds()&&e.multiplier()<60,getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.seconds=!0,s.secondsFrom=e,s.secondsTo=t}},{checker:e=>e.isSeconds()&&e.multiplier()>=60,getIntervalMultiplier:e=>Math.floor(e.multiplier()/60),markIntervalAsVisible:(e,t)=>{s.minutes=!0,s.minutesFrom=e,s.minutesTo=t}},{checker:e=>e.isMinutes()&&e.multiplier()<60,getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.minutes=!0,s.minutesFrom=e,s.minutesTo=t}},{checker:e=>e.isMinutes()&&e.multiplier()>=60,getIntervalMultiplier:e=>Math.floor(e.multiplier()/60),markIntervalAsVisible:(e,t)=>{s.hours=!0,s.hoursFrom=e,s.hoursTo=t}},{checker:e=>e.isDays(),getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.days=!0,s.daysFrom=e,s.daysTo=t}},{checker:e=>e.isWeeks(),getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.weeks=!0,s.weeksFrom=e,s.weeksTo=t}},{checker:e=>e.isMonths(),getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.months=!0,s.monthsFrom=e,s.monthsTo=t}},{checker:e=>e.isRange(),getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.ranges=!0}}].forEach((s=>{if(s.checker(e)){i=!0;const r=s.getIntervalMultiplier(e);1===t?s.markIntervalAsVisible(r,r):3===t?s.markIntervalAsVisible(r,void 0):s.markIntervalAsVisible(void 0,r)}else(!i&&2===t||i&&3===t)&&s.markIntervalAsVisible(void 0,void 0)})),d(s)}},153026:(e,t,i)=>{"use strict";var s;i.d(t,{PlotRowSearchMode:()=>s}),function(e){e[e.NearestLeft=-1]="NearestLeft",e[e.Exact=0]="Exact",e[e.NearestRight=1]="NearestRight"}(s||(s={}))},241731:(e,t,i)=>{"use strict";var s;i.r(t),i.d(t,{ReplayStatus:()=>s}),function(e){e[e.Undefined=0]="Undefined",e[e.PointSelect=1]="PointSelect",e[e.AutoPlay=2]="AutoPlay",e[e.Pause=3]="Pause"}(s||(s={}))},622200:(e,t,i)=>{"use strict";function s(e){
return Boolean(e.showInObjectTree)}i.d(t,{isDataSource:()=>s})},994528:(e,t,i)=>{"use strict";var s;i.d(t,{SymbolErrorPermissionDeniedReason:()=>s,permissionDenied:()=>r,invalidSymbol:()=>n}),function(e){e.Symbol="symbol",e.GroupPermission="group"}(s||(s={}));const r="permission denied",n="invalid symbol"},296055:(e,t,i)=>{"use strict";function s(e){const t=(null==e?void 0:e.symbolSource)&&e.symbolSource()===e,i=void 0!==(null==e?void 0:e.isActingAsSymbolSource);return t||i}function r(e){return s(e)&&e.isActingAsSymbolSource().value()}i.d(t,{isSymbolSource:()=>s,isActingAsSymbolSource:()=>r})},451215:(e,t,i)=>{"use strict";i.d(t,{LevelsProperty:()=>p});var s=i(486028),r=i(508547),n=i(658363);const o={prefixes:[""],range:[0,0],names:["coeff","color","visible","linestyle","linewidth"],typecheck:{pack:()=>Object(),unpack:()=>[]}};function a(e,t,i,s){return s.push(i[t]),s}function l(e,t,i,s){return s[t]=i[e],s}function c(){return[]}function h(){return{}}function d(e,t,i){return i.prefixes.forEach((r=>{const n=r+"level";for(let r=i.range[0];r<=i.range[1];r++)if(e[n+r]&&(0,s.isSameType)(e[n+r],t.typecheck())){let s=t.tpl();i.names.forEach(((i,o)=>{s=t.fill(""+o,i,e[n+r],s)})),e[n+r]=s}})),e}function u(e,t,i){return i(e,{tpl:h,fill:l,typecheck:t.typecheck.unpack},t)}class p extends r.DefaultProperty{constructor(e,t,i,s,r){r=null!=r?r:d;const n={...o,...null!=s?s:{}};super(e,t?u(t,n,r):t,i),this._map=n,this._levelsIterator=r}state(e,t){const i=super.state(e);return t?i:(s=i,r=this._map,(0,this._levelsIterator)(s,{tpl:c,fill:a,typecheck:r.typecheck.pack},r));var s,r}saveDefaults(){this._useUserPreferences&&(0,n.saveDefaults)(this._defaultName,this.state(this._exclusions,!0))}clone(){const e=this.state(),t=new p(this._defaultName,e);for(let e=0;e<this._exclusions.length;++e)t.addExclusion(this._exclusions[e]);return t}merge(e,t){return super.merge(u(e,this._map,this._levelsIterator),t)}}},720687:(e,t,i)=>{"use strict";i.d(t,{LineToolsGroup:()=>l});var s=i(922157),r=i.n(s),n=i(220863);function o(e){return e.properties().visible.value()}function a(e){return!o(e)}class l{constructor(e,t,i){this._instanceId=(0,n.randomHashN)(6),this._onChanged=new(r()),this._lineToolsSet=new Set,this._lineTools=[...e],this._lineToolsSet=new Set(this._lineTools),this._name=t,this.id=i||(0,n.randomHashN)(6)}instanceId(){return this._instanceId}lineTools(){return this._lineTools}name(){return this._name}setName(e){this._doAndFireOnChange((()=>{this._name=e}))}isActualSymbol(){return this._lineTools.length>0&&this._lineTools[0].isActualSymbol()&&this._lineTools[0].isActualCurrency()&&this._lineTools[0].isActualUnit()}symbol(){return this._lineTools[0].symbol()}currencyId(){var e;return null!==(e=this._lineTools[0].properties().childs().currencyId.value())&&void 0!==e?e:null}unitId(){var e;return null!==(e=this._lineTools[0].properties().childs().unitId.value())&&void 0!==e?e:null}sharingMode(){return this._lineTools[0].sharingMode()}share(e){this._lineTools.forEach((t=>t.share(e)))}containsLineTool(e){return this._lineToolsSet.has(e)}addLineTools(e){
this._doAndFireOnChange((t=>{e.forEach((e=>this._lineToolsSet.add(e))),this._lineTools.push(...e),t.push(...e.map((e=>e.id())))}))}excludeLineTool(e){this._doAndFireOnChange((t=>{this._lineToolsSet.delete(e);const i=this._lineTools.indexOf(e);this._lineTools.splice(i,1),t.push(e.id())}))}excludeLineTools(e){this._doAndFireOnChange((t=>{const i=new Set(e);e.forEach((e=>this._lineToolsSet.delete(e))),this._lineTools=this._lineTools.filter((e=>!i.has(e))),t.push(...e.map((e=>e.id())))}))}state(){return{id:this.id,name:this._name,tools:this._lineTools.map((e=>e.id()))}}visibility(){const e=this._lineTools.some(o),t=this._lineTools.some(a);return e&&!t?"Visible":t&&!e?"Invisible":"Partial"}locked(){const e=this._lineTools.some((e=>e.properties().frozen.value())),t=this._lineTools.some((e=>!e.properties().frozen.value()));return e&&!t?"Locked":t&&!e?"Unlocked":"Partial"}isActualInterval(){const e=this._lineTools.some((e=>e.isActualInterval())),t=this._lineTools.some((e=>!e.isActualInterval()));return e&&!t?"IsActualInterval":t&&!e?"IsNotActualInterval":"Partial"}onChanged(){return this._onChanged}static fromState(e,t){const i=[];for(const s of t.tools){const t=e.dataSourceForId(s);null!==t&&i.push(t)}return i.length>0?new l(i,t.name,t.id):null}_doAndFireOnChange(e){const t=[],i=this.visibility(),s=this.locked(),r=this.name(),n=this.isActualInterval();e(t),this._onChanged.fire({affectedLineTools:t,visibilityChanged:i!==this.visibility(),lockedChanged:s!==this.locked(),titleChanged:r!==this.name(),isActualIntervalChanged:n!==this.isActualInterval()})}}},295203:(e,t,i)=>{"use strict";i.d(t,{LineTool5PointsPattern:()=>a});var s=i(650151),r=i(508547),n=i(365897),o=i(519355);class a extends n.LineDataSource{constructor(e,t,i,s){super(e,t||a.createProperties(),i,s),this._loadPaneViews(e)}pointsCount(){return 5}name(){return"XABCD Pattern"}static createProperties(e){const t=new r.DefaultProperty("linetool5pointspattern",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,991497)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}_loadPaneViews(e){i.e(1583).then(i.bind(i,964236)).then((t=>{this._setPaneViews([new t.Pattern5pointsPaneView(this,e)])}))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([(0,s.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new o.LineToolColorsProperty([(0,s.ensureDefined)(e.child("textcolor"))]))}}},276230:(e,t,i)=>{"use strict";i.d(t,{LineToolABCD:()=>a});var s=i(650151),r=i(508547),n=i(365897),o=i(519355);class a extends n.LineDataSource{constructor(e,t,s,r){const n=t||a.createProperties();super(e,n,s,r),i.e(1583).then(i.bind(i,756041)).then((t=>{this._setPaneViews([new t.ABCDPaneView(this,e)])}))}pointsCount(){return 4}name(){return"ABCD Pattern"}static createProperties(e){const t=new r.DefaultProperty("linetoolabcd",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){
return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,120451)).then((e=>e.PatternWithoutBackgroundDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new o.LineToolColorsProperty([(0,s.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new o.LineToolColorsProperty([(0,s.ensureDefined)(e.child("textcolor"))]))}}},177977:(e,t,i)=>{"use strict";i.d(t,{LineToolArc:()=>h});var s=i(650151),r=i(204652),n=i(86441),o=i(625422),a=i(508547),l=i(365897),c=i(519355);class h extends l.LineDataSource{constructor(e,t,s,r){const n=t||h.createProperties();super(e,n,s,r),this.version=2,this._dist=null,i.e(1583).then(i.bind(i,630521)).then((({ArcPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[2]));this._dist=(0,r.distanceToLine)(e,t,i).distance;const o=t.subtract(e),a=new n.Point(-o.y,o.x),l=e.add(t).scaled(.5);i.subtract(l).dotProduct(a)<0&&(this._dist=-this._dist)}}endChanging(e,t){return this._dist=null,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Arc"}hasEditableCoordinates(){return!1}setPoint(e,t){const i={...t},a=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),l=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1]));switch(e){case 0:{const e=(0,s.ensureNotNull)(this._dist),t=(0,s.ensureNotNull)(this.pointToScreenPoint(i)),r=l.subtract(t),o=t.add(l).scaled(.5);let a=new n.Point(-r.y,r.x);a=a.normalized();const c=o.add(a.scaled(e));this._points[0]=i,this._points[2]=(0,s.ensureNotNull)(this.screenPointToPoint(c));break}case 1:{const e=(0,s.ensureNotNull)(this._dist),t=(0,s.ensureNotNull)(this.pointToScreenPoint(i)),r=t.subtract(a),o=a.add(t).scaled(.5),l=new n.Point(-r.y,r.x).normalized(),c=o.add(l.scaled(e));this._points[1]=i,this._points[2]=(0,s.ensureNotNull)(this.screenPointToPoint(c));break}case 2:{let e=(0,s.ensureNotNull)(this.pointToScreenPoint(i));const t=(0,r.distanceToLine)(a,l,e).distance,c=l.subtract(a),h=a.add(l).scaled(.5),d=new n.Point(-c.y,c.x).normalized(),u=h.add(d.scaled(t)),p=h.add(d.scaled(-t)),_=c.length(),m=c.x/_,g=c.y/_;let f=Math.acos(m);g<0&&(f=-f);let v=(0,o.translationMatrix)(-h.x,-h.y);e=(0,o.transformPoint)(v,e);let S=(0,o.transformPoint)(v,u);v=(0,o.rotationMatrix)(-f),e=(0,o.transformPoint)(v,e),S=(0,o.transformPoint)(v,S),v=(0,o.scalingMatrix)(1,_/(2*t)),e=(0,o.transformPoint)(v,e),S=(0,o.transformPoint)(v,S);const y=e.y*S.y>=0?new n.Point(u.x,u.y):new n.Point(p.x,p.y);this._points[2]=(0,s.ensureNotNull)(this.screenPointToPoint(y));break}}this.normalizePoints()}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=(2*this._points[0].price+3*this._points[1].price)/5;this._points.push({price:e,index:this._points[1].index})}if(1===e&&2===this._timePoint.length){const e={
price:(2*this._timePoint[0].price+3*this._timePoint[1].price)/5,offset:this._timePoint[1].offset,time_t:this._timePoint[1].time_t};this._timePoint.push(e)}}static createProperties(e){const t=new a.DefaultProperty("linetoolarc",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,992622))).GeneralFiguresDefinitionsViewModelBase}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new c.LineToolColorsProperty([e.childs().color]))}}},445314:(e,t,i)=>{"use strict";i.d(t,{LineToolArrowMark:()=>l,LineToolArrowMarkLeft:()=>c,LineToolArrowMarkUp:()=>h,LineToolArrowMarkRight:()=>d,LineToolArrowMarkDown:()=>u});var s=i(508547),r=i(365897),n=i(976704),o=i.n(n),a=i(519355);class l extends r.LineDataSource{constructor(e,t,s,r,n){const o=t||l.createProperties(null,s);super(e,o,r,n),this._textPaneView=null,i.e(1583).then(i.bind(i,683524)).then((({ArrowMarkPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}paneViews(e){const t=super.paneViews();return null!==t&&this._textPaneView&&t.push(this._textPaneView),t}pointsCount(){return 1}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e,t){const i=new s.DefaultProperty(t,e);return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,688659)).then((e=>e.ArrowMarkDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().arrowColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color])),e.hasChild("text")||e.addChild("text",new(o())("")),e.addExclusion("text")}}l.version=2;class c extends l{constructor(e,t,i,s){super(e,t,"linetoolarrowmarkleft",i,s)}direction(){return"left"}name(){return"Arrow Mark Left"}textAlignParams(){return{horzAlign:"left",vertAlign:"middle",offsetX:22,offsetY:3}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkleft")}}class h extends l{constructor(e,t,i,s){super(e,t,"linetoolarrowmarkup",i,s)}direction(){return"up"}name(){return"Arrow Mark Up"}textAlignParams(){return{horzAlign:"center",vertAlign:"top",offsetX:0,offsetY:20}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkup")}}class d extends l{constructor(e,t,i,s){super(e,t,"linetoolarrowmarkright",i,s)}direction(){return"right"}name(){return"Arrow Mark Right"}textAlignParams(){return{horzAlign:"right",vertAlign:"middle",offsetX:22,offsetY:3,forceTextAlign:!0}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkright")}}class u extends l{constructor(e,t,i,s){super(e,t,"linetoolarrowmarkdown",i,s)}direction(){return"down"}name(){return"Arrow Mark Down"}textAlignParams(){return{
horzAlign:"center",vertAlign:"bottom",offsetX:0,offsetY:20}}static createProperties(e){return super.createProperties(e,"linetoolarrowmarkdown")}}},916687:(e,t,i)=>{"use strict";i.d(t,{LineToolArrowMarker:()=>a});var s=i(365897),r=i(508547),n=i(976704),o=i.n(n);class a extends s.LineDataSource{constructor(e,t,s,r){super(e,null!=t?t:a.createProperties(),s,r),i.e(1583).then(i.bind(i,860800)).then((({ArrowMarkerPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}))}pointsCount(){return 2}name(){return"Trend Line"}static createProperties(e){const t=new r.DefaultProperty("linetoolarrowmarker",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,180395)).then((e=>e.ArrowMarkerDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(o())("")),e.addExclusion("text")}}},466552:(e,t,i)=>{"use strict";var s=i(620164).LineToolTrendLine,r=i(508547).DefaultProperty;class n extends s{constructor(e,t,i,s){super(e,t||n.createProperties(),i,s)}name(){return"Arrow"}static createProperties(e){var t=new r("linetoolarrow",e);return this._configureProperties(t),t}}t.LineToolArrow=n},229065:(e,t,i)=>{"use strict";i.d(t,{LineToolBalloon:()=>h});var s=i(509806),r=i(508547),n=i(365897),o=i(976704),a=i.n(o),l=i(519355);const c=s.t(null,void 0,i(119372));class h extends n.LineDataSource{constructor(e,t,i,s){super(e,t||h.createProperties(),i,s),this._createPaneView()}pointsCount(){return 1}name(){return"Balloon"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}shouldBeRemovedOnDeselect(){return""===this._properties.childs().text.value().trim()}static createProperties(e){const t=new r.DefaultProperty("linetoolballoon",e);return this._configureProperties(t),t}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,786607)).then((e=>e.BalloonDefinitionsViewModel))}_createPaneView(){i.e(1583).then(i.bind(i,988863)).then((e=>{this._setPaneViews([new e.BalloonPaneView(this,this._model)])}))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(a())(c)),e.addExclusion("text"),e.addChild("linesColors",new l.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new l.LineToolColorsProperty([e.childs().color]))}}},521905:(e,t,i)=>{"use strict";var s;i.d(t,{LineToolBarsPatternMode:()=>s}),function(e){e[e.Bars=0]="Bars",e[e.Line=1]="Line",e[e.OpenClose=2]="OpenClose",e[e.LineOpen=3]="LineOpen",e[e.LineHigh=4]="LineHigh",e[e.LineLow=5]="LineLow",e[e.LineHL2=6]="LineHL2"}(s||(s={}))},120040:(e,t,i)=>{"use strict";i.d(t,{LineToolBarsPattern:()=>S});var s=i(650151),r=i(509806),n=i(440097),o=i(486028),a=i(710567),l=i(508547),c=i(153026),h=i(365897),d=i(521905),u=i(744687)
;const p=new n.TranslatedString("mirror bars pattern",r.t(null,void 0,i(881870))),_=new n.TranslatedString("flip bars pattern",r.t(null,void 0,i(559942))),m=r.t(null,void 0,i(363158)),g=r.t(null,void 0,i(892754)),f={0:2,1:4,2:1,3:1,4:2,5:3,6:-1},v={0:3,1:4,2:4,3:1,4:2,5:3,6:-1};class S extends h.LineDataSource{constructor(e,t=S.createProperties(),s,r){super(e,t,s,r),this._pattern=[],this._scale=1,this._pointsCoordinatePricesDiff=null;const n=t.childs().mode.value();(0,o.isString)(n)&&t.childs().mode.setValue(parseInt(n)),t.childs().mirrored.listeners().subscribe(this,this._mirror),t.childs().flipped.listeners().subscribe(this,this._flip),t.childs().mode.subscribe(this,this._updateLastPoint),this.version=2,i.e(1583).then(i.bind(i,785694)).then((t=>{this._setPaneViews([new t.BarsPatternPaneView(this,e)])}))}pattern(){return this._pattern}isSynchronizable(){return!1}additionalActions(e){return[new a.Action({actionId:"Chart.LineTool.BarsPattern.ToggleMirrored",checked:this.properties().childs().mirrored.value(),checkable:!0,label:m,onExecute:()=>{e.setProperty(this.properties().childs().mirrored,!this.properties().childs().mirrored.value(),p),this.updateAllViews((0,u.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}),new a.Action({actionId:"Chart.LineTool.BarsPattern.ToggleFlipped",checked:this.properties().childs().flipped.value(),checkable:!0,label:g,onExecute:()=>{e.setProperty(this.properties().childs().flipped,!this.properties().childs().flipped.value(),_),this.updateAllViews((0,u.sourceChangeEvent)(this.id())),this._model.updateSource(this)}})]}pointsCount(){return 2}state(e){return{...super.state(e),pattern:this._pattern,scale:this._scale,diff:this._pointsCoordinatePricesDiff}}restoreData(e){const{pattern:t=this._pattern,scale:i=this._scale,diff:s=this._pointsCoordinatePricesDiff}=e;this._pattern=t,this._scale=i,this._pointsCoordinatePricesDiff=s}name(){return"Bars Pattern"}hasEditableCoordinates(){return!1}cloneData(e){this._pattern=(0,o.clone)(e._pattern),this._scale=e._scale,this._pointsCoordinatePricesDiff=e._pointsCoordinatePricesDiff}firstPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[0];return e.value()===d.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[v[e.value()]]:i[f[e.value()]]}lastPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[this._pattern.length-1];return e.value()===d.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[f[e.value()]]:i[v[e.value()]]}addPoint(e,t,i){const r=super.addPoint(e,t,!0);if(r){const e=this._model.mainSeries(),[{index:t},{index:i}]=this.points(),r=(0,s.ensureDefined)(e.nearestIndex(Math.min(t,i),c.PlotRowSearchMode.NearestRight)),n=(0,s.ensureDefined)(e.nearestIndex(Math.max(t,i),c.PlotRowSearchMode.NearestLeft));this._pattern=this._createPattern(r,n),this._pattern.length>0&&(t>i&&this._points.reverse(),this._points[1].price=this._points[0].price+this._patternPriceDiff(),this._points[1].index=this._points[0].index+(n-r),this.normalizePoints(),this.createServerPoints()),
this._updatePointsCoordinatePricesDiff()}return r}setPoint(e,t,i,s){1===e&&t.index<=this._points[0].index&&(t.index=this._points[0].index+1),0===e&&t.index>=this._points[1].index&&(t.index=this._points[1].index-1),super.setPoint(e,t,i),this._updatePointsCoordinatePricesDiff()}move(e,t,i,s){super.move(e,t,i,s),this._updatePointsCoordinatePricesDiff()}migrateVersion(e,t,i){if(1===e&&this._pattern.length>0){const e=this._patternPriceDiff();2===this._timePoint.length&&(this._timePoint[1].price=this._timePoint[0].price+e),2===this._points.length&&(this._points[1].price=this._points[0].price+e)}}getScale(){return this._scale=this._calculateScale()}static createProperties(e){const t=new l.DefaultProperty("linetoolbarspattern",e);return this._configureProperties(t),t}_preparePoint(e,t){var i;const r=this._alignPointToRangeOfActualData(e),n=this._model.mainSeries(),o=(0,s.ensureNotNull)(n.bars().valueAt(r.index));this.properties().childs().mode.value()===d.LineToolBarsPatternMode.Bars?r.price=(0,s.ensure)(o[2]):r.price=(0,s.ensure)(o[4]);const a=(0,s.ensureNotNull)(this.priceScale()),l=(0,s.ensure)(null===(i=this.ownerSource())||void 0===i?void 0:i.firstValue()),c=.05*a.height(),h=a.priceToCoordinate(r.price,l)-c;return r.price=a.coordinateToPrice(h,l),super._preparePoint(r,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,4917))).BarsPatternDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addExclusion("mirrored"),e.addExclusion("flipped")}_calculatePatternCoordinatePricesDiff(){var e;return this._pattern.length>0&&null!==(e=this._priceCoordinateDiff([this.firstPatternPrice(),this.lastPatternPrice()]))&&void 0!==e?e:null}_updatePointsCoordinatePricesDiff(){this._pointsCoordinatePricesDiff=this._calculatePointsCoordinatePricesDiff()}_calculatePointsCoordinatePricesDiff(){var e;if(2===this._points.length){const[{price:t},{price:i}]=this.points();return null!==(e=this._priceCoordinateDiff([t,i]))&&void 0!==e?e:null}return null}_createPattern(e,t){const i=this._model.mainSeries().data(),r=[];for(let n=e;n<=t;n++)r.push((0,o.clone)((0,s.ensureNotNull)(i.valueAt(n))));return r}_switchPointsPrice(){const e=this._points[0].price;this._timePoint[0].price=this._points[0].price=this._points[1].price,this._timePoint[1].price=this._points[1].price=e}_mirror(){const e=this._pattern;let t=Math.min(e[0][3],e[0][2]),i=Math.max(e[0][3],e[0][2]);for(let s=1;s<e.length;s++)t=Math.min(t,e[s][3]),i=Math.max(i,e[s][2]);if(t<i){const s=(t+i)/2,r=e=>s-(e-s);for(let t=0;t<e.length;t++)e[t][2]=r(e[t][2]),e[t][3]=r(e[t][3]),e[t][1]=r(e[t][1]),e[t][4]=r(e[t][4])}this._switchPointsPrice(),this.updateAllViews((0,u.sourceChangeEvent)(this.id()))}_flip(){const e=this._pattern,t=e.length;for(let i=0;i<t/2;i++){const s=e[i];e[i]=e[t-i-1],e[t-i-1]=s}this._switchPointsPrice(),this.updateAllViews((0,u.sourceChangeEvent)(this.id()))}_patternPriceDiff(){return this.lastPatternPrice()-this.firstPatternPrice()}_pricesToCoordinates(e){var t,i
;const s=this.priceScale(),r=null!==(i=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue())&&void 0!==i?i:null;if(null!==r&&null!==s&&!s.isEmpty())return e.map((e=>s.priceToCoordinate(e,r)))}_priceCoordinateDiff(e){const t=this._pricesToCoordinates(e);if(t)return t[1]-t[0]}_calculateScale(){let e=1;if(2===this._points.length){const t=this._calculatePatternCoordinatePricesDiff();if(!t)return e;const i=this._calculatePointsCoordinatePricesDiff();if(t&&null!==i&&(e=+(i/t).toFixed(8)),this._pointsCoordinatePricesDiff!==i){if(this._scale!==e)return this._updateLastPoint(),this._scale;this._updatePointsCoordinatePricesDiff()}}return e}_updateLastPoint(){var e,t;if(this._points.length<2)return;const i=this.priceScale(),s=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===s||null===i||i.isEmpty())return;const r=this._calculatePatternCoordinatePricesDiff(),n=this._pricesToCoordinates([this.points()[0].price]);null!==r&&n&&(this._timePoint[1].price=this._points[1].price=i.coordinateToPrice(+(this._scale*r).toFixed(8)+n[0],s),this._updatePointsCoordinatePricesDiff())}}},631478:(e,t,i)=>{"use strict";i.d(t,{LineToolBezierCubic:()=>o});var s=i(650151),r=i(508547),n=i(365897);class o extends n.LineDataSource{constructor(e,t,s,r){const n=t||o.createProperties();super(e,n,s,r),this._controlPoints=null,i.e(1583).then(i.bind(i,525146)).then((t=>{this._setPaneViews([new t.BezierCubicPaneView(this,e)])}))}pointsCount(){return 2}name(){return"Double Curve"}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this._controlPoints=this._calculateControlPoints(),i}addPoint(e,t,i){const s=super.addPoint(e,t,i);if(s){const e=this._calculateControlPoints();this._controlPoints=null,this._points.push(e[0]),this._points.push(e[1]),i||(this.normalizePoints(),this.createServerPoints()),this._createPointProperty(2),this._createPointProperty(3)}return s}restorePoints(e,t,i){super.restorePoints(e,t,i),this._createPointProperty(2),this._createPointProperty(3)}controlPoints(){return this._controlPoints}static createProperties(e){const t=new r.DefaultProperty("linetoolbeziercubic",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,702420)).then((e=>e.GeneralBezierDefinitionsViewModel))}_calculateControlPoints(){const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),t=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[1])),i=t.subtract(e).scaled(.5).transposed().scaled(.3),r=e.add(t).scaled(.33),n=e.add(t).scaled(.67),o=r.add(i),a=n.subtract(i);return[(0,s.ensureNotNull)(this.screenPointToPoint(o)),(0,s.ensureNotNull)(this.screenPointToPoint(a))]}}},162847:(e,t,i)=>{"use strict";i.d(t,{LineToolBezierQuadro:()=>o});var s=i(650151),r=i(508547),n=i(365897);class o extends n.LineDataSource{constructor(e,t,s,r){const n=t||o.createProperties();super(e,n,s,r),this._controlPoint=null,i.e(1583).then(i.bind(i,195057)).then((t=>{
this._setPaneViews([new t.BezierQuadroPaneView(this,e)])}))}pointsCount(){return 2}name(){return"Curve"}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this._controlPoint=this._calculateControlPoint(),i}addPoint(e,t,i){const s=super.addPoint(e,t,i);if(s){const e=this._calculateControlPoint();this._points.push(e),this._controlPoint=null,i||(this.normalizePoints(),this.createServerPoints()),this._createPointProperty(2)}return s}restorePoints(e,t,i){super.restorePoints(e,t,i),this._createPointProperty(2)}controlPoint(){return this._controlPoint}static createProperties(e){const t=new r.DefaultProperty("linetoolbezierquadro",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,702420)).then((e=>e.GeneralBezierDefinitionsViewModel))}_calculateControlPoint(){const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),t=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[1])),i=t.subtract(e).scaled(.5).transposed().scaled(.3),r=e.add(t).scaled(.5).add(i);return(0,s.ensureNotNull)(this.screenPointToPoint(r))}}},288062:(e,t,i)=>{"use strict";i.d(t,{LineToolBrushBase:()=>n});var s=i(650151),r=i(365897);class n extends r.LineDataSource{constructor(){super(...arguments),this._finished=!1}pointsCount(){return-1}finished(){return this._finished}finish(){this._finished=!0,this._lastPoint=null,this.normalizePoints(),this.createServerPoints()}hasEditableCoordinates(){return!1}addPoint(e,t,i){if(this._finished)return!0;if(this._lastPoint=null,this._points.length>0){const t=this._points[this._points.length-1],i=(0,s.ensureNotNull)(this.pointToScreenPoint(t));if((0,s.ensureNotNull)(this.pointToScreenPoint(e)).subtract(i).length()<2)return this._finished}return super.addPoint(e),this._finished}restorePoints(e,t,i){super.restorePoints(e,t,i),this._finished=!0}}},334572:(e,t,i)=>{"use strict";i.d(t,{LineToolBrush:()=>o});var s=i(508547),r=i(288062),n=i(519355);class o extends r.LineToolBrushBase{constructor(e,t,i,s){super(e,t||o.createProperties(),i,s),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Brush"}hasEditableCoordinates(){return!1}static createProperties(e){const t=new s.DefaultProperty("linetoolbrush",e);return this._configureProperties(t),t}_loadPaneViews(e){i.e(1583).then(i.bind(i,177855)).then((t=>{this._setPaneViews([new t.BrushPaneView(this,e)])}))}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,74824)).then((e=>e.BrushDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new n.LineToolColorsProperty([e.childs().backgroundColor],e.childs().fillBackground))}}},90783:(e,t,i)=>{"use strict";i.d(t,{LineToolCallout:()=>c});var s=i(509806),r=i(976704),n=i.n(r),o=i(508547),a=i(519355),l=i(365897);class c extends l.LineDataSource{constructor(e,t,s,r){super(e,t||c.createProperties(),s,r),this._barOffset=0,
this._dragStartLeftEdgeIndex=NaN,this._timeScale=e.timeScale(),i.e(1583).then(i.bind(i,489439)).then((e=>{this._setPaneViews([new e.CalloutPaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Callout"}getBarOffset(){return this._barOffset}shouldBeRemovedOnDeselect(){return""===this._properties.childs().text.value().trim()}addPoint(e){const t=super.addPoint(e);return t&&this._calculateBarOffset(),t}setLastPoint(e){const t=super.setLastPoint(e);return 2===this.points().length&&this._calculateBarOffset(),t}setPoint(e,t){switch(e){case 0:super.setPoint(e,t),this._calculateBarOffset();break;case 1:const i=this.properties().childs();if(!i.wordWrapWidth)return;const s=this._points,r=this._dragStartLeftEdgeIndex,n=Math.round((t.index-r)/2);if(isFinite(r)&&isFinite(n)){s[1]={index:r+n,price:s[1].price},this._calculateBarOffset(),this.normalizePoints();const e=this._timeScale.indexToCoordinate(r+2*n)-this._timeScale.indexToCoordinate(r)-8-2;if(!isFinite(e))return;i.wordWrapWidth.setValue(Math.max(100,e));break}s[1]=t,this._calculateBarOffset(),this.normalizePoints()}}setPoints(e){super.setPoints(e);const t=this.properties().childs();if(!t.wordWrapWidth)return;const i=this._dragStartLeftEdgeIndex,s=Math.round((e[1].index-i)/2);if(this._calculateBarOffset(),this.normalizePoints(),isFinite(i)&&isFinite(s)){const e=this._timeScale.indexToCoordinate(i+2*s)-this._timeScale.indexToCoordinate(i)-8-2;if(!isFinite(e))return;t.wordWrapWidth.setValue(Math.max(100,e))}}move(e,t,i){super.move(e,t,i),this._calculateBarOffset()}state(e){const t=super.state(e);return t.barOffset=this._barOffset,t}restoreData(e){e.barOffset?this._barOffset=e.barOffset:this._calculateBarOffset(),this.calculatePoint2()}setPriceScale(e){super.setPriceScale(e),e&&e.priceRange()&&this.calculatePoint2()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}calculatePoint2(){if(this._model.lineBeingEdited()===this||this._model.sourcesBeingMoved().includes(this))return;if(this._points.length<2)return;const[e,t]=this.points();this._points[1]={price:t.price,index:e.index+this._barOffset}}static createProperties(e){const t=new o.DefaultProperty("linetoolcallout",e);return this._configureProperties(t),t}_applyTemplateImpl(e){this.properties().childs().text.setValue(e.text),super._applyTemplateImpl(e)}_correctPoints(e,t){if(null===this._currentMovingPoint||void 0===this._currentMovingPoint.logical||null===this._startMovingPoint||void 0===this._startMovingPoint.logical)return!1;const i=this._currentMovingPoint.logical.index-this._startMovingPoint.logical.index,s=this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price,r=e[1];return r.index=r.index+i,r.price+=s,e[1]=r,!0}_onPointsetUpdated(e){super._onPointsetUpdated(e),0!==e.length&&(this._dragStartLeftEdgeIndex=this.points()[1].index)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,463548))).CalloutDefinitionsViewModel}static _configureProperties(e){
super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(n())(s.t(null,void 0,i(37229)))),e.addExclusion("text"),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color]))}_calculateBarOffset(){this.points().length>1&&(this._barOffset=this.points()[1].index-this.points()[0].index)}}},817359:(e,t,i)=>{"use strict";var s=i(365897).LineDataSource,r=i(508547).DefaultProperty;class n extends s{constructor(e,t,s,r){super(e,t||n.createProperties(),s,r),i.e(1583).then(i.t.bind(i,71880,19)).then((({LineToolCircleLinesPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 2}name(){return"Cyclic Lines"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,470404))).CyclicAndSineLinesPatternDefinitionsViewModel}static createProperties(e){var t=new r("linetoolcirclelines",e);return this._configureProperties(t),t}}t.LineToolCircleLines=n},408716:(e,t,i)=>{"use strict";i.d(t,{LineToolCircle:()=>l});var s=i(976704),r=i.n(s),n=i(508547),o=i(365897),a=i(519355);class l extends o.LineDataSource{constructor(e,t,s,r){const n=t||l.createProperties();super(e,n,s,r),i.e(1583).then(i.bind(i,586499)).then((({CirclePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}pointsCount(){return 2}name(){return"Circle"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e){const t=new n.DefaultProperty("linetoolcircle",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,422498))).EllipseCircleDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(r())("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("linesWidths",new a.LineToolWidthsProperty([e.childs().linewidth])),e.addChild("backgroundsColors",new a.LineToolColorsProperty([e.childs().backgroundColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor],e.childs().showLabel)),e.addExclusion("linesColors"),e.addExclusion("linesWidths"),e.addExclusion("backgroundsColors"),e.addExclusion("text")}}},442619:(e,t,i)=>{"use strict";i.d(t,{LineToolComment:()=>n});var s=i(508547),r=i(229065);class n extends r.LineToolBalloon{constructor(e,t,i,s){super(e,t||n.createProperties(),i,s)}name(){return"Comment"}static createProperties(e){const t=new s.DefaultProperty("linetoolcomment",e);return n._configureProperties(t),t}_createPaneView(){i.e(1583).then(i.bind(i,679171)).then((e=>{this._setPaneViews([new e.CommentPaneView(this,this._model)])}))}}},780419:(e,t,i)=>{"use strict";i.d(t,{LineToolCrossLine:()=>a});var s=i(508547),r=i(359299),n=i(661243),o=i(365897);class a extends o.LineDataSource{
constructor(e,t,s,o){super(e,t||a.createProperties(),s,o),this._priceAxisView=new r.LineToolHorzLinePriceAxisView(this),this._timeAxisView=new n.LineToolVertLineTimeAxisView(this),i.e(1583).then(i.bind(i,459137)).then((({CrossLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Cross Line"}priceAxisViews(e,t){return this.isSourceHidden()?null:t===this.priceScale()&&this.properties().childs().showPrice.value()&&this._model.paneForSource(this)===e?[this._priceAxisView]:null}timeAxisViews(){return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e),this._timeAxisView.update()}canHasAlert(){return!1}lineColor(){return this.properties().childs().linecolor.value()}lineWidth(){return this.properties().childs().linewidth.value()}lineStyle(){return this.properties().childs().linestyle.value()}static createProperties(e){const t=new s.DefaultProperty("linetoolcrossline",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,754685)).then((e=>e.CrossLineDefinitionsViewModel))}}},110905:(e,t,i)=>{"use strict";i.d(t,{LineToolCypherPattern:()=>n});var s=i(295203),r=i(508547);class n extends s.LineTool5PointsPattern{constructor(e,t,i,s){super(e,t||n.createProperties(),i,s)}name(){return"Cypher Pattern"}static createProperties(e){const t=new r.DefaultProperty("linetoolcypherpattern",e);return this._configureProperties(t),t}_loadPaneViews(e){i.e(1583).then(i.bind(i,694673)).then((t=>{this._setPaneViews([new t.CypherPaneView(this,e)])}))}}},737731:(e,t,i)=>{"use strict";i.d(t,{nonThemedFactoryDefaultsBase:()=>d,themedFactoryDefaultsBase:()=>u,DateAndPriceBaseProperties:()=>p});var s=i(676507),r=i(111982),n=i(602564),o=i(785359),a=i(940092),l=i(976704),c=i.n(l);const h=(0,s.getHexColorByName)("color-tv-blue-500"),d={linewidth:1,fontsize:12,fillLabelBackground:!0,fillBackground:!0,backgroundTransparency:60,intervalsVisibilities:{...o.intervalsVisibilitiesDefaults},customText:{visible:!1,fontsize:12,bold:!1,italic:!1}},u=new Map([[r.StdTheme.Light,{textcolor:(0,s.getHexColorByName)("color-black"),labelBackgroundColor:(0,s.getHexColorByName)("color-white"),linecolor:h,backgroundColor:(0,n.generateColor)(h,85),shadow:"rgba(0, 0, 0, 0.2)",customText:{color:h}}],[r.StdTheme.Dark,{textcolor:(0,s.getHexColorByName)("color-white"),labelBackgroundColor:(0,s.getHexColorByName)("color-cold-gray-800"),linecolor:h,backgroundColor:(0,n.generateColor)(h,85),shadow:"rgba(0, 0, 0, 0.4)",customText:{color:h}}]]);class p extends a.ThemedDefaultProperty{constructor(e,t,i,s,r){var n,o,a;super(e,t,i,s,r),null===(n=this.childs().customText)||void 0===n||n.addChild("text",new(c())(null!==(a=null===(o=null==r?void 0:r.customText)||void 0===o?void 0:o.text)&&void 0!==a?a:""))}_allKeys(){const e=super._allKeys();return e.push("customText.text"),e}}},333581:(e,t,i)=>{"use strict";i.d(t,{
LineToolDateAndPriceRange:()=>g});var s=i(650151),r=i(365897),n=i(299845),o=i(111982),a=i(676507),l=i(940092),c=i(737731);const h=(0,a.getHexColorByName)("color-tv-blue-500"),d={...c.nonThemedFactoryDefaultsBase,drawBorder:!1,borderWidth:1},u=new Map([[o.StdTheme.Light,{...c.themedFactoryDefaultsBase.get(o.StdTheme.Light),borderColor:h}],[o.StdTheme.Dark,{...c.themedFactoryDefaultsBase.get(o.StdTheme.Dark),borderColor:h}]]),p=(0,l.extractAllPropertiesKeys)((0,s.ensureDefined)(u.get(o.StdTheme.Light))),_=(0,l.extractAllPropertiesKeys)(d);class m extends c.DateAndPriceBaseProperties{static create(e){return new this("linetooldateandpricerange",(()=>(0,l.factoryDefaultsForCurrentTheme)(d,u)),_,p,e)}}class g extends r.LineDataSource{constructor(e,t,s,r){super(e,t||g.createProperties(),s,r),this._volumeCalculator=null,i.e(1583).then(i.bind(i,589493)).then((e=>{this._setPaneViews([new e.DateAndPriceRangePaneView(this,this._model)])}))}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date and Price Range"}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,s.assert)(null===this._volumeCalculator),this._volumeCalculator=new n.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e){const t=m.create(e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,477316))).GeneralDatePriceRangeDefinitionsViewModel}}},144827:(e,t,i)=>{"use strict";i.d(t,{LineToolDateRange:()=>_});var s=i(650151),r=i(365897),n=i(299845),o=i(111982),a=i(940092),l=i(737731);const c={...l.nonThemedFactoryDefaultsBase,extendTop:!1,extendBottom:!1},h=l.themedFactoryDefaultsBase,d=(0,a.extractAllPropertiesKeys)((0,s.ensureDefined)(h.get(o.StdTheme.Light))),u=(0,a.extractAllPropertiesKeys)(c);class p extends l.DateAndPriceBaseProperties{static create(e){return new this("linetooldaterange",(()=>(0,a.factoryDefaultsForCurrentTheme)(c,h)),u,d,e)}}class _ extends r.LineDataSource{constructor(e,t,s,r){super(e,t||_.createProperties(),s,r),this._volumeCalculator=null,i.e(1583).then(i.bind(i,268795)).then((e=>{this._setPaneViews([new e.DateRangePaneView(this,this._model)])}))}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date Range"}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,s.assert)(null===this._volumeCalculator),this._volumeCalculator=new n.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e){const t=p.create(e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,477316))).GeneralDatePriceRangeDefinitionsViewModel}}},612452:(e,t,i)=>{"use strict";var s=i(365897).LineDataSource,r=i(508547).DefaultProperty;class n extends s{constructor(e,t,s,r){super(e,t||n.createProperties(),s,r),this.version=n.version,i.e(1583).then(i.t.bind(i,918582,19)).then((({DisjointChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 3}name(){return"Disjoint Channel"}hasEditableCoordinates(){return!1}addPoint(e,t){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),super.addPoint(e)}setLastPoint(e,t){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),super.setLastPoint(e)}setPoint(e,t,i){var s=.5*(this._points[1].price+this._points[2].price);if(i&&i.shift()&&1===e){this._snapPoint45Degree(t,this.points()[0])}if(e<3&&super.setPoint(e,t),0!==e&&2!==e){if(1===e){var r=this._points[1].price-s;this._points[2].price=this._points[1].price-2*r}else if(3===e){r=t.price-this._points[2].price;this._points[0].price=this._points[1].price-r,this._points[0].index=t.index}this.normalizePoints()}}getPoint(e){if(e<3)return super.getPoint(e);var t=this._points[0].price-this._points[2].price;return{index:this._points[0].index,price:this._points[1].price-t}}canHasAlert(){return!0}_getAlertPlots(){var e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));var s=this._points[2];s.time=t.time,s.index=t.index;var r,n,o,a,l={price:s.price+(t.price-e.price),time:e.time,index:e.index},c=[];s.index<=l.index?(c.push(s),c.push(l)):(c.push(l),c.push(s)),i[0].price>c[0].price?(r=i,n=c):c[0].price>i[0].price||c[1].price>i[1].price?(r=c,n=i):(r=i,n=c);var h=this.properties().extendLeft.value(),d=this.properties().extendRight.value();return e.index<=t.index?(o=h,a=d):(o=d,a=h),[this._linePointsToAlertPlot(r,"Upper",o,a),this._linePointsToAlertPlot(n,"Lower",o,a)]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,796471))).GeneralTrendFiguresDefinitionsViewModel}static createProperties(e){var t=new r("linetooldisjointangle",e);return this._configureProperties(t),t}}n.version=1,t.LineToolDisjointChannel=n},360246:(e,t,i)=>{"use strict";i.d(t,{LineToolElliott:()=>u,LineToolElliottImpulse:()=>m,LineToolElliottTriangle:()=>f,LineToolElliottTripleCombo:()=>S,LineToolElliottCorrection:()=>w,LineToolElliottDoubleCombo:()=>C});var s=i(509806),r=i(440097),n=i(365897),o=i(710567),a=i(508547),l=i(519355);const c=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],h=new r.TranslatedString("change Elliott degree",s.t(null,void 0,i(876020))),d=[{value:0,title:s.t(null,void 0,i(433820))},{value:1,title:s.t(null,void 0,i(558397))},{value:2,title:s.t(null,void 0,i(609753))},{value:3,title:s.t(null,void 0,i(718367))},{value:4,title:s.t(null,void 0,i(591889))},{value:5,
title:s.t(null,void 0,i(495176))},{value:6,title:s.t(null,void 0,i(348404))},{value:7,title:s.t(null,void 0,i(671778))},{value:8,title:s.t(null,{context:"wave"},i(266051))},{value:9,title:s.t(null,{context:"wave"},i(486054))},{value:10,title:s.t(null,void 0,i(185884))},{value:11,title:s.t(null,void 0,i(471722))},{value:12,title:s.t(null,void 0,i(210931))},{value:13,title:s.t(null,void 0,i(729662))},{value:14,title:s.t(null,void 0,i(609632))}];class u extends n.LineDataSource{constructor(e,t,s,r){super(e,null!=t?t:u.createProperties(),s,r),this.version=4,i.e(1583).then(i.bind(i,758857)).then((e=>{this._setPaneViews([new e.ElliottLabelsPaneView(this,this._model)])}))}migrateVersion(e,t,i){if(i.properties.hasChild("background")&&i.properties.removeProperty("background"),i.properties.hasChild("backgroundColor")&&i.properties.removeProperty("backgroundColor"),i.properties.hasChild("showBackground")&&i.properties.removeProperty("showBackground"),1===e){const e=Object.assign({},this._timePoint[0]);if(this._timePoint.unshift(e),this._points.length>0){const e=Object.assign({},this._points[0]);this._points.unshift(e)}}}applyTemplate(e){const t=e;delete t.background,delete t.backgroundColor,delete t.showBackground,super.applyTemplate(e)}name(){return"Elliott Labels"}additionalActions(e){return[new o.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",label:s.t(null,void 0,i(69479)),subItems:c.map((t=>{const i=d.filter((e=>e.value===t))[0];return new o.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",label:i.title,checkable:!0,checked:this.properties().childs().degree.value()===t,onExecute:()=>{e.setProperty(this.properties().childs().degree,t,h)}})}))})]}label(e){const t=c.length-this.properties().childs().degree.value()-1,i=Math.floor(t/3);return{group:i,bold:!!(i%2),decoration:["","brackets","circle"][t%3],label:this.labelsGroup()[i][e]}}availableDegreesValues(){return d}static createProperties(e){const t=new a.DefaultProperty("linetoolelliott",e);return this._configureProperties(t),t}static migrateState(e){const t={0:11,1:10,2:9,3:8,4:7,5:6,6:5,7:4,8:3},i={0:11,1:8};"LineToolElliottSubminuette"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinor"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottCircle"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize]),"LineToolElliottMajorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize])}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,285410))).ElliottPatternDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new l.LineToolColorsProperty([e.childs().color])),e.addExclusion("linesColors")}}class p extends u{pointsCount(){return 6}}
const _=[["0","1","2","3","4","5"],["0","i","ii","iii","iv","v"],["0","1","2","3","4","5"],["0","I","II","III","IV","V"],["0","1","2","3","4","5"]];class m extends p{constructor(e,t,i,s){super(e,t||m.createProperties(),i,s)}name(){return"Elliott Impulse Wave (12345)"}labelsGroup(){return _}static createProperties(e){const t=new a.DefaultProperty("linetoolelliottimpulse",e);return this._configureProperties(t),t}}const g=[["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"]];class f extends p{constructor(e,t,i,s){super(e,t||f.createProperties(),i,s)}name(){return"Elliott Triangle Wave (ABCDE)"}labelsGroup(){return g}static createProperties(e){const t=new a.DefaultProperty("linetoolelliotttriangle",e);return this._configureProperties(t),t}}const v=[["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"]];class S extends p{constructor(e,t,i,s){super(e,null!=t?t:S.createProperties(),i,s)}name(){return"Elliott Triple Combo Wave (WXYXZ)"}labelsGroup(){return v}static createProperties(e){const t=new a.DefaultProperty("linetoolelliotttriplecombo",e);return this._configureProperties(t),t}}class y extends u{pointsCount(){return 4}}const b=[["0","A","B","C"],["0","a","b","c"],["0","A","B","C"],["0","a","b","c"],["0","A","B","C"]];class w extends y{constructor(e,t,i,s){super(e,null!=t?t:w.createProperties(),i,s)}name(){return"Elliott Correction Wave (ABC)"}labelsGroup(){return b}static createProperties(e){const t=new a.DefaultProperty("linetoolelliottcorrection",e);return this._configureProperties(t),t}}const P=[["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"]];class C extends y{constructor(e,t,i,s){super(e,null!=t?t:C.createProperties(),i,s)}name(){return"Elliott Double Combo Wave (WXY)"}labelsGroup(){return P}static createProperties(e){const t=new a.DefaultProperty("linetoolelliottdoublecombo",e);return this._configureProperties(t),t}}},683086:(e,t,i)=>{"use strict";i.d(t,{LineToolEllipse:()=>d});var s=i(650151),r=i(204652),n=i(86441),o=i(976704),a=i.n(o),l=i(365897),c=i(508547),h=i(519355);class d extends l.LineDataSource{constructor(e,t,s,r){super(e,t||d.createProperties(),s,r),this.version=2,this._dist=null,this._fakePointAdded=!1,i.e(1583).then(i.bind(i,931961)).then((({EllipsePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[2]));this._dist=(0,r.distanceToLine)(e,t,i).distance||0}}addPoint(e,t,i){const s=super.addPoint(e,t,i);return s&&(this._fakePointAdded=!1),s}setPoint(e,t,i,o){const a={...t};let l=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),c=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),h=(0,
s.ensureNotNull)(this.pointToScreenPoint(this._points[2]));switch(e){case 0:{if(i&&i.shift()){this._snapPoint45Degree(a,this._points[1]),this._points[0]=a,this._points[2]=this._preparePointInternal(this._points[2],i,!0),this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[0],this._points[1],this._points[2]);break}l=(0,s.ensureNotNull)(this.pointToScreenPoint(a));const e=c.subtract(l),t=l.add(c).scaled(.5),r=new n.Point(-e.y,e.x).normalized();h=t.add(r.scaled((0,s.ensureNotNull)(this._dist))),this._points[0]=a,this._points[2]=(0,s.ensureNotNull)(this.screenPointToPoint(h));break}case 1:{if(i&&i.shift()){this._snapPoint45Degree(a,this._points[0]),this._points[1]=a,this._points[2]=this._preparePointInternal(this._points[2],i,!0),this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[1],this._points[0],this._points[2]);break}c=(0,s.ensureNotNull)(this.pointToScreenPoint(a));const e=c.subtract(l),t=l.add(c).scaled(.5),r=new n.Point(-e.y,e.x).normalized();h=t.add(r.scaled((0,s.ensureNotNull)(this._dist))),this._points[1]=a,this._points[2]=(0,s.ensureNotNull)(this.screenPointToPoint(h));break}case 2:{const e=(0,s.ensureNotNull)(this.pointToScreenPoint(a)),t=(0,r.distanceToLine)(l,c,e).distance,i=c.subtract(l),o=l.add(c).scaled(.5),d=new n.Point(-i.y,i.x).normalized();h=o.add(d.scaled(t)),this._points[2]=(0,s.ensureNotNull)(this.screenPointToPoint(h));break}case 3:{const e=(0,s.ensureNotNull)(this.pointToScreenPoint(a)),t=(0,r.distanceToLine)(l,c,e).distance,i=c.subtract(l),o=l.add(c).scaled(.5),d=new n.Point(-i.y,i.x).normalized();h=o.add(d.scaled(t)),this._points[2]=(0,s.ensureNotNull)(this.screenPointToPoint(h));break}}this.normalizePoints()}pointsCount(){return 3}name(){return"Ellipse"}hasEditableCoordinates(){return!1}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=this._points[0].price,t=.5*(this._points[0].price+this._points[1].price);this._points[0]={price:t,index:this._points[0].index},this._points[1]={price:t,index:this._points[1].index},this._points.push({price:e,index:this._points[0].index})}if(1===e&&2===this._timePoint.length){const e=this._timePoint[0].price,t=.5*(this._timePoint[0].price+this._timePoint[1].price);this._timePoint[0].price=t,this._timePoint[1].price=t;const i={price:e,offset:this._timePoint[0].offset,time_t:this._timePoint[0].time_t};this._timePoint.push(i)}}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e){const t=new c.DefaultProperty("linetoolellipse",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,422498))).EllipseCircleDefinitionsViewModel}_preparePoint(e,t){const i=this._preparePointInternal(e,t,!1);return t&&t.shift()&&this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[1],this._points[0],i),i}_applyTemplateImpl(e){super._applyTemplateImpl(e),
this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(a())("")),e.addChild("linesColors",new h.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new h.LineToolColorsProperty([e.childs().textColor],e.childs().showLabel)),e.addExclusion("text")}_preparePointInternal(e,t,i){let r={...e};if(t&&t.shift()){const t=this.points().length;if(!this._fakePointAdded&&3===t&&!i)return r;if(this._fakePointAdded||2===t||i){this._snapPoint45Degree(e,this._points[0]),this._fakePointAdded?this._points[1]=e:i||(this._fakePointAdded=!0,super._addPointIntenal(e));const t=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),a=o.x-t.x,l=o.y-t.y,c=Math.sqrt(a*a+l*l)/2,h=o.subtract(t),d=t.add(o).scaled(.5),u=new n.Point(-h.y,h.x).normalized(),p=d.add(u.scaled(c));r=(0,s.ensureNotNull)(this.screenPointToPoint(p)),(isNaN(r.price)||isNaN(r.index))&&(r=(0,s.ensureNotNull)(this.screenPointToPoint(d)))}}else this._fakePointAdded&&(this._points.splice(1,1),this._fakePointAdded=!1);return r}_fixVerticalDiameterPoints(e,t,i){const r=(0,s.ensureNotNull)(this.pointToScreenPoint(e)),o=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),a=this._model.timeScale(),l=a.indexToCoordinate(e.index),c=a.indexToCoordinate(i.index);let h=2*Math.abs(l-c);h*=t.price>e.price?1:-1,e.price=(0,s.ensureNotNull)(this.screenPointToPoint(new n.Point(r.x,o.y+h))).price}}},672670:(e,t,i)=>{"use strict";i.d(t,{LineToolEmoji:()=>c});var s=i(208142),r=i(817808),n=i(745132),o=i(508547),a=i(775562);const l=(0,r.getLogger)("Chart.LineToolEmoji");class c extends a.LineToolSvgIconBase{constructor(e,t,i,s){super(e,t||c.createProperties(),i,s),this.version=1,this._loadViews()}name(){return"Emoji"}static createProperties(e){const t=new o.DefaultProperty("linetoolemoji",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,660034))).LineDataSourceDefinitionsViewModel}async _loadViews(){const e=this._properties.childs().emoji.value(),t=(0,s.getTwemojiUrl)(e,"svg");try{const[s,{EmojiPaneView:r},{svgRenderer:o}]=await Promise.all([(0,n.fetch)(t).then((e=>e.text())),i.e(1583).then(i.bind(i,877276)),i.e(2616).then(i.bind(i,953957))]);if(!this._isDestroyed){this._svgContent=s,this._onIconChanged.fire();const t=o(s);null===t&&l.logWarn(`Couldn't create svg renderer for emoji ${e}`),this._setPaneViews([new r(this,this._model,t)])}}catch(t){l.logWarn(`An error ocurred while loading emoji content ${e}: ${t}`)}}}},231593:(e,t,i)=>{"use strict";i.d(t,{ExecutionsPositionController:()=>u,LineToolExecution:()=>_});var s=i(650151),r=i(365897),n=i(458013),o=i(508547),a=i(153026),l=i(484727),c=i(792268),h=i(744687);const d=c.sortSourcesPreOrdered.LineToolExecution;class u{constructor(e){this._pane=e}getXYCoordinate(e,t,i){let r=0;const n=e.getDirection(),o="buy"===n,l=this._pane.model().mainSeries()
;if(l.bars){const e=o?10:-10,t=l.bars().search(i,a.PlotRowSearchMode.NearestLeft);if(null!==t){i=t.index;const n=o?t.value[3]:t.value[2],a=l.priceScale(),c=(0,s.ensureNotNull)(l.firstValue());r=a.priceToCoordinate(n,c)+e}}e.setAlignedTimePointIndex(i);const c=t.visibleBarsStrictRange();if(!isFinite(i)||null===c||i>c.lastBar()||i<c.firstBar())return{x:-1,y:-1};const h=u._cachedByBarIndexOrderedExecutions[i]||this._pane.sourcesByGroup().all();for(let t=h.length-1;t>=0;--t){const s=h[t];if(!(s instanceof _)||s.adapter().alignedTimePointIndex()!==i||s.adapter().getDirection()!==n)continue;if(s===e.line())break;const a=s.adapter().height();r=o?r+a:r-a}return{x:t.indexToCoordinate(i),y:r}}static recreateOrderedByBarsSourcesCache(e){this.clearOrderedByBarsSourcesCache();const t=e.sourcesByGroup().all();for(const e of t){if(!(e instanceof _))continue;const t=e.adapter().alignedTimePointIndex();if(void 0===t)continue;const i=u._cachedByBarIndexOrderedExecutions[t]||[];u._cachedByBarIndexOrderedExecutions[t]=i,i.push(e)}}static clearOrderedByBarsSourcesCache(){u._cachedByBarIndexOrderedExecutions={}}}u._cachedByBarIndexOrderedExecutions={};class p{constructor(e,t){this._unixtime=NaN,this._line=e,this._model=t}alignedTimePointIndex(){return this._alignedTimePointIndex}setAlignedTimePointIndex(e){this._alignedTimePointIndex=e}line(){return this._line}getIndex(){return this._model.timeScale().baseIndex()-this._line.points()[0].index}setIndex(e){const t=this._model.timeScale().baseIndex()-Math.abs(e);this._line.startMoving({logical:this._line.points()[0]});const i={...this._line.points()[0]};return i.index=t,this._line.move({logical:i}),this._line.endMoving(!1),this}getTime(){return this._unixtime}setTime(e){return this._unixtime=e,this._line.restorePoints([{offset:0,price:this.getPrice(),time_t:this._unixtime}],[]),this._line.createServerPoints(),this}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line.normalizedPoints().length>0?this._line.normalizedPoints()[0].price:NaN}setPrice(e){return this._line.points().length>0&&(this._line.points()[0].price=e),this._line.normalizedPoints().length>0&&(this._line.normalizedPoints()[0].price=e),this}getText(){return this._line.properties().childs().text.value()}setText(e){return this._line.properties().childs().text.setValue(e||""),this._line.updateAllViewsAndRedraw((0,h.sourceChangeEvent)(this._line.id())),this}getArrowHeight(){return this._line.properties().childs().arrowHeight.value()}setArrowHeight(e){return this._line.properties().childs().arrowHeight.setValue(e||5),this}getArrowSpacing(){return this._line.properties().childs().arrowSpacing.value()}setArrowSpacing(e){return this._line.properties().childs().arrowSpacing.setValue(e||1),this}getDirection(){return this._line.properties().childs().direction.value()}setDirection(e){return this._line.properties().childs().direction.setValue(e||"buy"),this}getArrowColor(){const e=this._line.properties().childs();return"buy"===this.getDirection()?e.arrowBuyColor.value():e.arrowSellColor.value()}
setArrowColor(e){return"buy"===this.getDirection()?this.setArrowBuyColor(e):this.setArrowSellColor(e),this}setArrowBuyColor(e){return this._line.properties().childs().arrowBuyColor.setValue(e),this}setArrowSellColor(e){return this._line.properties().childs().arrowSellColor.setValue(e),this}getTextColor(){const e=this._line.properties().childs();return n.getColorFromProperties(e.textColor,e.textTransparency)}setTextColor(e){const t=this._line.properties().childs();return n.setColorToProperties(e,t.textColor,t.textTransparency),this}getFont(){const e=this._line.properties().childs();return n.getFontFromProperties(e.fontFamily,e.fontSize,e.fontBold,e.fontItalic)}setFont(e){const t=this._line.properties().childs();return n.setFontToProperties(e,t.fontFamily,t.fontSize,t.fontBold,t.fontItalic),this}setTooltip(e){return null==e?e="":e+="",this._line.properties().childs().tooltip.setValue(e),this}getTooltip(){return this._line.properties().childs().tooltip.value()}remove(){this._model.removeSource(this._line)}getPoints(){return this._line.points()}height(){const e=this.getArrowHeight(),t=this.getArrowSpacing();let i=0;this.getText()&&(i=n.fontHeight(this.getFont()));return e+t+i+10}}class _ extends r.LineDataSource{constructor(e,t,s,r){super(e,null!=t?t:_.createProperties(),s,r),this._adapter=new p(this,e),this.customization.forcePriceAxisLabel=!1,this.customization.disableErasing=!0,this.setSelectionEnabled(!1),i.e(1583).then(i.bind(i,978780)).then((e=>{this._setPaneViews([new e.ExecutionPaneView(this,this._model)])}))}adapter(){return this._adapter}zorder(){return d}isSpeciallyZOrderedSource(){return!0}pointsCount(){return 1}name(){return"Execution"}hasContextMenu(){return!1}state(){return{}}updateAllViews(e){if(this._isVisible())return super.updateAllViews(e)}priceAxisViews(e,t){return this._isVisible()?super.priceAxisViews(e,t):null}paneViews(){return window.TradingView.printing&&!l.enabled("snapshot_trading_drawings")?null:this._isVisible()?super.paneViews():null}userEditEnabled(){return!1}showInObjectTree(){return!1}cloneable(){return!1}copiable(){return!1}isSynchronizable(){return!1}static createProperties(e){const t=new o.DefaultProperty("linetoolexecution",e,!1,!1);return _._configureProperties(t),t}_isVisible(){return this._model.properties().childs().tradingProperties.childs().showExecutions.value()}}},713624:(e,t,i)=>{"use strict";var s=i(620164).LineToolTrendLine,r=i(508547).DefaultProperty;class n extends s{constructor(e,t,i,s){super(e,t||n.createProperties(),i,s)}name(){return"Extended Line"}static createProperties(e){var t=new r("linetoolextended",e);return this._configureProperties(t),t}}t.LineToolExtended=n},607431:(e,t,i)=>{"use strict";i.d(t,{LineToolFibChannel:()=>h});var s=i(650151),r=i(509806),n=i(440097),o=i(365897),a=i(451215),l=i(519355);const c=new n.TranslatedString("erase level line",r.t(null,void 0,i(812962)));class h extends o.LineDataSource{constructor(e,t,s,r){super(e,t||h.createProperties(),s,r),this.version=2,i.e(1583).then(i.bind(i,441120)).then((({FibChannelPaneView:e})=>{
this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 24}migrateVersion(e,t,i){i.properties.removeProperty("reverse")}pointsCount(){return 3}name(){return"Fib Channel"}processErase(e,t){const i="level"+t,s=this.properties().child(i).childs().visible;e.setProperty(s,!1,c)}static createProperties(e){const t=new a.LevelsProperty("linetoolfibchannel",e,!1,{range:[1,24],names:["coeff","color","visible"]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,84617))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[];for(let i=1;i<=24;i++){const r=(0,s.ensureDefined)(e.child("level"+i));t.push((0,s.ensureDefined)(r.child("color")))}e.addChild("linesColors",new l.LineToolColorsProperty(t))}}},923236:(e,t,i)=>{"use strict";var s=i(440097).TranslatedString,r=i(365897).LineDataSource,n=i(451215).LevelsProperty,o=i(519355),a=o.LineToolWidthsProperty,l=o.LineToolColorsProperty,c=new s("erase level line",i(509806).t(null,void 0,i(812962)));class h extends r{constructor(e,t,s,r){super(e,t||h.createProperties(),s,r),i.e(1583).then(i.t.bind(i,816369,19)).then((({FibCirclesPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return h.LevelsCount}pointsCount(){return 2}name(){return"Fib Circles"}processErase(e,t){var i="level"+t,s=this.properties()[i].visible;e.setProperty(s,!1,c)}static createProperties(e){var t=new n("linetoolfibcircles",e,!1,{range:[1,11]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,916354))).FibCirclesDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("trendline").child("linewidth")],i=[e.child("trendline").child("color")],s=1;s<=this.LevelsCount;s++)t.push(e.child("level"+s).child("linewidth")),i.push(e.child("level"+s).child("color"));e.addChild("linesColors",new l(i)),e.addChild("linesWidths",new a(t))}}h.LevelsCount=11,t.LineToolFibCircles=h},228733:(e,t,i)=>{"use strict";i.d(t,{LineToolFibRetracement:()=>c});var s=i(509806),r=i(440097),n=i(451215),o=i(365897),a=i(519355);const l=new r.TranslatedString("erase level line",s.t(null,void 0,i(812962)));class c extends o.LineDataSource{constructor(e,t,s,r){super(e,t||c.createProperties(),s,r),this.version=2,i.e(1583).then(i.bind(i,344245)).then((e=>{this._setPaneViews([new e.FibRetracementPaneView(this,this._model)])}))}levelsCount(){return 24}pointsCount(){return 2}name(){return"Fib Retracement"}migrateVersion(e){1===e&&this.properties().childs().extendLines.setValue(!0)}processErase(e,t){const i="level"+t,{visible:s}=this.properties().childs()[i].childs();e.setProperty(s,!1,l)}fibLevelsBasedOnLogScale(){var e
;return this.properties().childs().fibLevelsBasedOnLogScale.value()&&!!(null===(e=this.priceScale())||void 0===e?void 0:e.isLog())}static createProperties(e){const t=new n.LevelsProperty("linetoolfibretracement",e,!1,{range:[1,24],names:["coeff","color","visible"]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,84617))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){var t;const i=e;super._configureProperties(i);const s=[i.childs().trendline.childs().linewidth,i.childs().levelsStyle.childs().linewidth],r=[i.childs().trendline.childs().color];for(let e=1;e<=24;e++){const s=null===(t=i.child("level"+e))||void 0===t?void 0:t.child("color");r.push(s)}i.addChild("linesColors",new a.LineToolColorsProperty(r)),i.addChild("linesWidths",new a.LineToolWidthsProperty(s))}}},569803:(e,t,i)=>{"use strict";var s=i(440097).TranslatedString,r=i(365897).LineDataSource,n=i(451215).LevelsProperty,o=i(519355),a=o.LineToolWidthsProperty,l=o.LineToolColorsProperty,c=new s("erase level line",i(509806).t(null,void 0,i(812962)));class h extends r{constructor(e,t,s,r){super(e,t||h.createProperties(),s,r),i.e(1583).then(i.bind(i,430139)).then((({FibSpeedResistanceArcsPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return h.LevelsCount}pointsCount(){return 2}name(){return"Fib Speed Resistance Arcs"}processErase(e,t){var i="level"+t,s=this.properties()[i].visible;e.setProperty(s,!1,c)}static createProperties(e){var t=new n("linetoolfibspeedresistancearcs",e,!1,{range:[1,11]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,827429))).FibSpeedResistanceArcsDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("trendline").child("linewidth")],i=[e.child("trendline").child("color")],s=1;s<=this.LevelsCount;s++)t.push(e.child("level"+s).child("linewidth")),i.push(e.child("level"+s).child("color"));e.addChild("linesColors",new l(i)),e.addChild("linesWidths",new a(t))}}h.LevelsCount=11,t.LineToolFibSpeedResistanceArcs=h},646817:(e,t,i)=>{"use strict";var s=i(440097).TranslatedString,r=i(365897).LineDataSource,n=i(451215).LevelsProperty,o=i(519355).LineToolColorsProperty,a=new s("erase level line",i(509806).t(null,void 0,i(812962)));class l extends r{constructor(e,t,s,r){super(e,t||l.createProperties(),s,r),i.e(1583).then(i.bind(i,844617)).then((({FibSpeedResistanceFanPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}hLevelsCount(){return l.HLevelsCount}vLevelsCount(){return l.VLevelsCount}pointsCount(){return 2}name(){return"Fib Speed Resistance Fan"}processErase(e,t){var i="h"===t.type?"hlevel"+t.index:"vlevel"+t.index,s=this.properties()[i].visible;e.setProperty(s,!1,a)}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,225695))).FibSpeedResistanceFanDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static createProperties(e){void 0!==e&&void 0===e.reverse&&(e.reverse=!0);var t=new n("linetoolfibspeedresistancefan",e,!1,{range:[1,7],prefixes:["h","v"],names:["coeff","color","visible"]});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e);var t=[e.child("grid").child("color")];for(let i=1;i<=this.HLevelsCount;i++)t.push(e.child("hlevel"+i).child("color"));for(let i=1;i<=this.VLevelsCount;i++)t.push(e.child("vlevel"+i).child("color"));e.addChild("linesColors",new o(t)),e.addExclusion("linesColors")}}l.HLevelsCount=7,l.VLevelsCount=7,t.LineToolFibSpeedResistanceFan=l},512952:(e,t,i)=>{"use strict";var s=i(365897).LineDataSource,r=i(508547).DefaultProperty;class n extends s{constructor(e,t,s,r){super(e,t||n.createProperties(),s,r),i.e(1583).then(i.bind(i,12634)).then((({FibSpiralPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 2}name(){return"Fib Spiral"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,832327))).FibSpiralDefinitionsViewModel}static createProperties(e){var t=new r("linetoolfibspiral",e);return this._configureProperties(t),t}}t.LineToolFibSpiral=n},505584:(e,t,i)=>{"use strict";i.d(t,{LineToolFibTimeZone:()=>c});var s=i(509806),r=i(440097),n=i(519355),o=i(451215),a=i(365897);const l=new r.TranslatedString("erase level line",s.t(null,void 0,i(812962)));class c extends a.LineDataSource{constructor(e,t,s,r){super(e,t||c.createProperties(),s,r),this.version=2,i.e(1583).then(i.bind(i,705603)).then((({FibTimeZonePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 11}migrateVersion(e,t,i){if(1===e){const e=i.properties.childs(),t=i.properties,s=t.baselinecolor.value(),r=t.linecolor.value(),n=t.linewidth.value(),o=t.linestyle.value();e.level1.childs().color.setValue(s);for(let t=2;t<=11;t++)e["level"+t].childs().color.setValue(r);for(let t=1;t<=11;t++)e["level"+t].childs().linewidth.setValue(n),e["level"+t].childs().linestyle.setValue(o)}}pointsCount(){return 2}name(){return"Fib Time Zone"}processErase(e,t){const i="level"+t,s=this.properties().childs()[i].childs().visible;e.setProperty(s,!1,l)}static createProperties(e){const t=new o.LevelsProperty("linetoolfibtimezone",e,!1,{range:[1,11]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,456216))).FibTimezoneDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[],i=[];for(let s=1;s<=11;s++){const r=e.childs()["level"+s].childs();t.push(r.linewidth),i.push(r.color)}e.addChild("linesColors",new n.LineToolColorsProperty(i)),e.addChild("linesWidths",new n.LineToolWidthsProperty(t))}}},762250:(e,t,i)=>{"use strict";i.d(t,{
LineToolFibWedgeBase:()=>o});var s=i(650151),r=i(86441),n=i(365897);class o extends n.LineDataSource{pointsCount(){return 3}hasEditableCoordinates(){return!1}setPoint(e,t){if(super.setPoint(e,t),!this._recursiveGuard)try{if(this._recursiveGuard=!0,2===e){const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0]));let t=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1]));const i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[2])).subtract(e).length();let n=t.subtract(e);n.length()<=0&&(n=new r.Point(1,0)),t=e.add(n.normalized().scaled(i));const o=(0,s.ensureNotNull)(this.screenPointToPoint(t)),a=this._pointsProperty.childs().points[1];a.childs().price.setValue(o.price),a.childs().bar.setValue(o.index)}else{const e=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[2]));const n=t.subtract(e).length();let o=i.subtract(e);o.length()<=0&&(o=new r.Point(1,0)),i=e.add(o.normalized().scaled(n));const a=(0,s.ensureNotNull)(this.screenPointToPoint(i)),l=this._pointsProperty.childs().points[2];l.childs().price.setValue(a.price),l.childs().bar.setValue(a.index)}}finally{this._recursiveGuard=!1}}addPoint(e){if(2===this._points.length){const t=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let r=(0,s.ensureNotNull)(this.pointToScreenPoint(e));const n=i.subtract(t).length(),o=r.subtract(t).normalized();r=t.add(o.scaled(n));const a=(0,s.ensureNotNull)(this.ownerSource()),l=(0,s.ensureNotNull)(a.firstValue()),c=(0,s.ensureNotNull)(this.priceScale()).coordinateToPrice(r.y,l);e={index:Math.round(this._model.timeScale().coordinateToIndex(r.x)),price:c}}return super.addPoint(e)}}},801656:(e,t,i)=>{"use strict";var s=i(440097).TranslatedString,r=i(762250).LineToolFibWedgeBase,n=i(451215).LevelsProperty,o=i(519355),a=o.LineToolWidthsProperty,l=o.LineToolColorsProperty,c=new s("erase level line",i(509806).t(null,void 0,i(812962)));class h extends r{constructor(e,t,s,r){super(e,t||h.createProperties(),s,r),i.e(1583).then(i.t.bind(i,401064,19)).then((({FibWedgePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}isSynchronizable(){return!1}levelsCount(){return h.LevelsCount}name(){return"Fib Wedge"}processErase(e,t){var i="level"+t,s=this.properties()[i].visible;e.setProperty(s,!1,c)}static createProperties(e){var t=new n("linetoolfibwedge",e,!1,{range:[1,11]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,849989))).FibWedgeDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("trendline").child("linewidth")],i=[e.child("trendline").child("color")],s=1;s<=this.LevelsCount;s++)t.push(e.child("level"+s).child("linewidth")),i.push(e.child("level"+s).child("color"));e.addChild("linesColors",new l(i)),
e.addChild("linesWidths",new a(t))}}h.LevelsCount=11,t.LineToolFibWedge=h},607777:(e,t,i)=>{"use strict";i.d(t,{LineToolFlagMark:()=>a});var s=i(86441),r=i(365897),n=i(508547),o=i(519355);class a extends r.LineDataSource{constructor(e,t,r,n){super(e,t||a.createProperties(),r,n),i.e(1583).then(i.bind(i,391538)).then((({FlagMarkPaneView:e})=>{const t=new e(this,this.model());t.setAnchors(new s.Point(0,0)),this._setPaneViews([t])}))}pointsCount(){return 1}name(){return"Flag Mark"}static createProperties(e){e&&void 0===e.flagColor&&(e.flagColor="#318757");const t=new n.DefaultProperty("linetoolflagmark",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,926982)).then((e=>e.FlagMarkDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new o.LineToolColorsProperty([e.childs().flagColor])),e.addExclusion("backgroundsColors")}}a.version=2},102280:(e,t,i)=>{"use strict";var s=i(365897).LineDataSource,r=i(508547).DefaultProperty;class n extends s{constructor(e,t,s,r){super(e,t||n.createProperties(),s,r),this.version=n.version,i.e(1583).then(i.t.bind(i,641278,19)).then((({FlatBottomPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 3}name(){return"Flat Bottom"}hasEditableCoordinates(){return!1}addPoint(e,t){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),super.addPoint(e)}setLastPoint(e,t){return t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[this.points().length-2]),super.setLastPoint(e)}setPoint(e,t,i){if(i&&i.shift()&&1===e){this._snapPoint45Degree(t,this.points()[0])}if(2===e)this._points[1].index=t.index;else if(3===e)return this._points[0].index=t.index,this._points[2].price=t.price,void this.normalizePoints();super.setPoint(e,t)}getPoint(e){return e<3?super.getPoint(e):3===e?{index:this._points[0].index,price:this._points[2].price}:void 0}canHasAlert(){return!0}_getAlertPlots(){var e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));var s=this._points[2];s.time=t.time,s.index=t.index;var r,n,o,a,l={price:s.price,time:e.time,index:e.index},c=[];s.index<=l.index?(c.push(s),c.push(l)):(c.push(l),c.push(s)),i[0].price>c[0].price?(r=i,n=c):c[0].price>i[0].price||c[1].price>i[1].price?(r=c,n=i):(r=i,n=c);var h=this.properties().extendLeft.value(),d=this.properties().extendRight.value();return e.index<=t.index?(o=h,a=d):(o=d,a=h),[this._linePointsToAlertPlot(r,"Upper",o,a),this._linePointsToAlertPlot(n,"Lower",h,a)]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,796471))).GeneralTrendFiguresDefinitionsViewModel}static createProperties(e){var t=new r("linetoolflatbottom",e);return this._configureProperties(t),t}}n.version=1,t.LineToolFlatBottom=n},897455:(e,t,i)=>{"use strict";i.d(t,{
createPropertiesObject:()=>a});var s=i(486028),r=i(451215);function n(e,t,i){var r;for(const n of Object.keys(null!==(r=e.levels)&&void 0!==r?r:{}))if(e.levels[n]&&(0,s.isSameType)(e.levels[n],t.typecheck())){let s=t.tpl();i.names.forEach(((i,r)=>{s=t.fill(""+r,i,e.levels[n],s)})),e.levels[n]=s}return e}class o extends r.LevelsProperty{constructor(e,t){super(e,t,!1,{names:["width","color","visible"]},n)}}function a(e,t){return new o(e,t)}},568318:(e,t,i)=>{"use strict";i.d(t,{LineToolGannComplex:()=>d});var s=i(86441),r=i(650151),n=i(628454),o=i(365897),a=i(10145),l=i(897455),c=i(519355),h=i(574570);class d extends o.LineDataSource{constructor(e,t,s,r){super(e,t||d.createProperties(),s,r),this.version=2,this._scaleRatioFormatter=new n.LimitedPrecisionNumericFormatter(7),this.version=2,i.e(1583).then(i.bind(i,963159)).then((({GannComplexPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}));const o=this.properties();this._adjustScaleRatio(o),o.subscribe(this,this._adjustScaleRatio),o.childs().scaleRatio.subscribe(this,this._correctFirstPoint),this._syncStateExclusions=["scaleRatio"],o.onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.subscribe(this,this._handleTemplateApplying),this._onTemplateApplied.subscribe(this,this._correctFirstPoint)}migrateVersion(e,t,i){1===e&&(this._points.length>=this.pointsCount()?setTimeout((()=>this._migratePoint())):this._timePoint.length>=this.pointsCount()&&this._pointAdded.subscribe(this,this._migratePoint))}destroy(){const e=this.properties();e.unsubscribe(this,this._adjustScaleRatio),e.childs().scaleRatio.unsubscribe(this,this._correctFirstPoint),e.onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.unsubscribe(this,this._handleTemplateApplying),this._onTemplateApplied.unsubscribe(this,this._correctFirstPoint),super.destroy()}pointsCount(){return 2}name(){return"Gann Square"}addPoint(e,t,i){this._points.length>1&&this._points.pop();const s=super.addPoint(e,t,i),n=this.priceScale();return!(0,r.ensureNotNull)(n).isLog()&&s&&this._correctFirstPoint(),s}setPoint(e,t,i){super.setPoint(e,t,i),void 0!==i&&i.shift()?this._correctPoint(e):this._correctScaleRatio()}setLastPoint(e,t){const i=this.priceScale();return(0,r.ensureNotNull)(i).isLog()||(this._points[1]=e,this._correctPoint(1)),super.setLastPoint(e,t)}isReversed(){return this.properties().childs().reverse.value()}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let s=0;s<i;s++){const i=t.levels.childs()[s].childs();e.push({index:s,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let s=0;s<i;s++){const i=t.fanlines.childs()[s].childs();e.push({index:s,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),
width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let s=0;s<i;s++){const i=t.arcs.childs()[s].childs();e.push({index:s,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}isLabelsVisible(){return this.properties().childs().showLabels.value()}getLabelsStyle(){const e=this.properties().childs(),{fontSize:t,bold:i,italic:s}=e.labelsStyle.childs(),r=e.levels.childCount();return{textColor:e.levels.childs()[r-1].childs().color.value(),font:h.CHART_FONT_FAMILY,fontSize:t.value(),bold:i.value(),italic:s.value()}}getScaleRatioStep(){return 1e-7}getScaleRatioFormatter(){return this._scaleRatioFormatter}getPriceDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.price-t.price}getIndexDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.index-t.index}getScaleRatio(){const e=this.getPriceDiff(),t=this.getIndexDiff();return null!==e&&null!==t&&0!==t?Math.abs(e/t):null}static createProperties(e){const t=(0,l.createPropertiesObject)("linetoolganncomplex",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,717963)).then((e=>e.GannComplexAndFixedDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addExclusion("scaleRatio");const t=[],i=[],s=e.childs();{const e=s.levels.childCount();for(let r=0;r<e;r++){const e=s.levels.childs()[r].childs();t.push(e.width),i.push(e.color)}}{const e=s.fanlines.childCount();for(let r=0;r<e;r++){const e=s.fanlines.childs()[r].childs();t.push(e.width),i.push(e.color)}}{const e=s.arcs.childCount();for(let r=0;r<e;r++){const e=s.arcs.childs()[r].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new c.LineToolColorsProperty(i)),e.addChild("linesWidths",new c.LineToolWidthsProperty(t))}_correctScaleRatio(){const e=this.properties().childs(),t=this.getScaleRatio();e.scaleRatio.setValue(t)}_getAdjustedScaleRatio(){const e=this.model().mainSeries().priceScale(),t=this.model().timeScale();return(0,a.scaleRatio)(t,e)}_adjustScaleRatio(e){const t=e.scaleRatio.value();""!==t&&null!==t||e.scaleRatio.setValue(this._getAdjustedScaleRatio())}_correctPoint(e){if(this._points.length<2)return;const t=this.getIndexDiff();if(null===t)return;const i=this.properties().childs().scaleRatio.value();if(null!==i){const s=this._points[e],r=0===e?this._points[1]:this._points[0],n=s.price-r.price>0,o=s.index-r.index>0;let a=n&&!o||!n&&o?-1:1;0===e&&(a=-a),s.price=r.price+a*t*i,this._pointChanged.fire(e)}this.normalizePoints()}_correctFirstPoint(){this._correctPoint(this.isReversed()?0:1)}_handleRestoringFactoryDefaults(){
this.properties().childs().scaleRatio.setValue(this._getAdjustedScaleRatio())}_handleTemplateApplying(e){""===e.scaleRatio&&(e.scaleRatio=this._getAdjustedScaleRatio())}_migratePoint(){if(this.points().length<this.pointsCount())return;const e=this._getScreenPoints();if(null===e)return;const t=(0,r.ensureNotNull)(this.screenPointToPoint(e[1]));this.setPoint(1,t),this._pointAdded.unsubscribe(this,this._migratePoint)}_getScreenPoints(){const e=this._calcAngle();if(null===e)return null;let[t,i]=this.points();this.isReversed()&&([t,i]=[i,t]);const n=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),o=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),a=Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2)),l=new s.Point(Math.cos(e),-Math.sin(e)),c=l.normalized(),h=c.x<0?-1:1,d=c.y<0?-1:1;return[n.addScaled(l,a),n.add(new s.Point(5*a*h,5*a*d))]}_calcAngle(){const[e,t]=this.points(),i=(0,r.ensureNotNull)(this.pointToScreenPoint(e));let s=(0,r.ensureNotNull)(this.pointToScreenPoint(t)).subtract(i);if(s.length()>0){s=s.normalized();let e=Math.acos(s.x);return s.y>0&&(e=-e),e}return null}}},660840:(e,t,i)=>{"use strict";var s=i(440097).TranslatedString,r=i(365897).LineDataSource,n=i(451215).LevelsProperty,o=i(519355),a=o.LineToolWidthsProperty,l=o.LineToolColorsProperty,c=new s("erase level line",i(509806).t(null,void 0,i(812962)));class h extends r{constructor(e,t,s,r){super(e,t||h.createProperties(),s,r),i.e(1583).then(i.bind(i,557366)).then((({GannFanPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return h.LevelsCount}pointsCount(){return 2}name(){return"Gann Fan"}processErase(e,t){var i="level"+t,s=this.properties()[i].visible;e.setProperty(s,!1,c)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,335017))).GannFanDefinitionsViewModel}static createProperties(e){var t=new n("linetoolgannfan",e,!1,{range:[1,9]});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e);for(var t=[],i=[],s=1;s<=this.LevelsCount;s++)t.push(e.child("level"+s).child("linewidth")),i.push(e.child("level"+s).child("color"));e.addChild("linesColors",new l(i)),e.addChild("linesWidths",new a(t))}}h.LevelsCount=9,t.LineToolGannFan=h},850515:(e,t,i)=>{"use strict";i.d(t,{LineToolGannFixed:()=>l});var s=i(86441),r=i(650151),n=i(365897),o=i(519355),a=i(897455);class l extends n.LineDataSource{constructor(e,t,s,r){super(e,t||l.createProperties(),s,r),this._constructor="LineToolGannFixed",i.e(1583).then(i.bind(i,967975)).then((({GannFixedPaneView:e})=>{this._setPaneViews([new e(this,this.model())])})),this.properties().childs().reverse.subscribe(this,this._reversePoints)}pointsCount(){return 2}name(){return"Gann Square Fixed"}axisPoints(){const e=this.points(),t=this.getScreenPoints();return e.length<2||t.length<2?[]:[e[0],(0,r.ensureNotNull)(this.screenPointToPoint(t[1]))]}getScreenPoints(){const e=this.points();if(e.length<2)return[];const t=this._calcAngle();if(null===t)return[];const[i,n]=e,o=(0,
r.ensureNotNull)(this.pointToScreenPoint(i)),a=(0,r.ensureNotNull)(this.pointToScreenPoint(n)),l=Math.sqrt(Math.pow(o.x-a.x,2)+Math.pow(o.y-a.y,2)),c=new s.Point(Math.cos(t),-Math.sin(t)),h=c.normalized(),d=h.x<0?-1:1,u=h.y<0?-1:1;return[o.addScaled(c,l),o.add(new s.Point(5*l*d,5*l*u))]}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let s=0;s<i;s++){const i=t.levels.childs()[s].childs();e.push({index:s,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let s=0;s<i;s++){const i=t.fanlines.childs()[s].childs();e.push({index:s,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let s=0;s<i;s++){const i=t.arcs.childs()[s].childs();e.push({index:s,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}static createProperties(e){const t=(0,a.createPropertiesObject)("linetoolgannfixed",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,717963)).then((e=>e.GannComplexAndFixedDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e);const t=[],i=[],s=e.childs();{const e=s.levels.childCount();for(let r=0;r<e;r++){const e=s.levels.childs()[r].childs();t.push(e.width),i.push(e.color)}}{const e=s.fanlines.childCount();for(let r=0;r<e;r++){const e=s.fanlines.childs()[r].childs();t.push(e.width),i.push(e.color)}}{const e=s.arcs.childCount();for(let r=0;r<e;r++){const e=s.arcs.childs()[r].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new o.LineToolColorsProperty(i)),e.addChild("linesWidths",new o.LineToolWidthsProperty(t))}_calcAngle(){const e=this.points();if(e.length<2)return null;const[t,i]=e,s=this.pointToScreenPoint(t),r=this.pointToScreenPoint(i);if(null===s||null===r)return null;let n=r.subtract(s);if(n.length()<=0)return null;n=n.normalized();let o=Math.acos(n.x);return n.y>0&&(o=-o),o}_reversePoints(){const[e,t]=this._points;this._points[0]=t,this._points[1]=e,this.normalizePoints(),this.restart()}}},177403:(e,t,i)=>{"use strict";var s=i(365897).LineDataSource,r=i(451215).LevelsProperty,n=i(519355).LineToolColorsProperty,o=[4.5,9,11.25,18,22.5,36,45],a=function(){for(var e=[],t=o.length-1,i=1,s=0,r=0;r<1e10;)r=o[s]*i,e.push(Math.round(r)),e.push(Math.ceil(-r)),s===t-1&&(i*=10),s=(s+1)%t;return e.sort((function(e,t){return e<t?-1:e>t?1:0
})),e}();class l extends s{constructor(e,t,s,r){super(e,t||l.createProperties(),s,r),i.e(1583).then(i.t.bind(i,708004,19)).then((({GannSquarePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}hLevelsCount(){return l.HLevelsCount}vLevelsCount(){return l.VLevelsCount}pointsCount(){return 2}name(){return"Gann Box"}_alignPriceOnPattern(e,t){var i=Math.round(1e6*(e.price-t.price))/1e6;if(0===i)return t.price;for(var s=o[0],r=o[o.length-1],n=1,a=Math.abs(i);a<s*n||r*n<a;)a<s*n?n*=.1:r*n<a&&(n*=10);for(var l=r*n,c=o.length-2;c>=0&&!(o[c]*n<a);--c)l=o[c]*n;return e.price=t.price+(i>=0?l:-l),e}_alignTimeOnPattern(e,t){var i=e.index-t.index;if(0===i)return 0;for(var s=a.length-2;s>=0&&!(a[s]<i);--s);return s+=i>0?1:0,e.index=t.index+a[s],e}_alignPointsFixedIncrement(e,t){return this._alignTimeOnPattern(e,t),this._alignPriceOnPattern(e,t),e}_preparePoint(e,t){return t&&t.shift()&&0!==this._points.length&&this._alignPointsFixedIncrement(e,this._points[0]),super._preparePoint(e,t)}getPoint(e){if(e<2)return super.getPoint(e);var t=null;switch(e){case 2:case 3:var i=this.points();if(i.length===this.pointsCount()){var s=i[0].index,r=i[1].price;3===e&&(s=i[1].index,r=i[0].price),t={index:s,price:r}}}return t}setPoint(e,t,i){if(i&&i.shift()){var s=e%2==0?this._points[1]:this._points[0];this._alignPointsFixedIncrement(t,s)}switch(e){case 2:this._points[0].index=t.index,this._points[1].price=t.price;break;case 3:this._points[1].index=t.index,this._points[0].price=t.price;break;default:super.setPoint(e,t,i)}}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,552046))).GannSquareDefinitionsViewModel}static createProperties(e){var t=new r("linetoolgannsquare",e,!1,{range:[1,7],prefixes:["h","v"],names:["coeff","color","visible"]});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("color"),e.child("fans").child("color")],i=1;i<=this.HLevelsCount;i++)t.push(e.child("hlevel"+i).child("color"));for(i=1;i<=this.VLevelsCount;i++)t.push(e.child("vlevel"+i).child("color"));e.addChild("linesColors",new n(t)),e.addExclusion("linesColors")}}l.HLevelsCount=7,l.VLevelsCount=7,t.LineToolGannSquare=l},653436:(e,t,i)=>{"use strict";i.d(t,{LineToolGhostFeed:()=>c});var s=i(508547),r=i(365897),n=i(650151),o=i(486028);class a{constructor(e,t,i){this._source=e,this._segmentIndex=t,this._bars=null!=i?i:[]}setBars(e){this._bars=e}clone(e){return new a(e,this._segmentIndex,(0,o.clone)(this._bars))}generate(){this._bars=[];const e=this._source.points(),t=e[this._segmentIndex],i=e[this._segmentIndex+1];if(!t||!i||t.index===i.index)return;const s=this._segmentIndex?t.index+1:t.index,r=Math.sign(i.index-t.index);for(let e=s;e!==i.index;e+=r)this._bars.push(this._createBar())}bars(){return this._bars}setSize(e){if(e<this._bars.length)this._bars.splice(e,this._bars.length-e);else for(;this._bars.length<e;)this._bars.push(this._createBar())}_createBar(){
const e=this._source.properties().averageHL.value(),t=this._source.properties().variance.value()/100,i=(0,n.ensureNotNull)(this._source.ownerSource()).base();let s=Math.random();const r=e*(1-2*s)*t;s=Math.random();const o=e*(1+(.5-s)*t),a=r-o/2,l=a+o;return{o:(a+Math.random()*o)/i,h:l/i,l:a/i,c:(a+Math.random()*o)/i}}}var l=i(744687);class c extends r.LineDataSource{constructor(e,t,s,r){const n=t||c.createProperties();if(super(e,n,s,r),this._segments=[],this._finished=!1,this._segmentsPixelsWhileMoving=null,!s){const e=Math.round(this._calculateATR());n.childs().averageHL.setValue(e)}n.childs().averageHL.listeners().subscribe(this,this._regenerate),n.childs().variance.listeners().subscribe(this,this._regenerate),this._currentAverageHL=n.childs().averageHL.value(),this._currentVariance=n.childs().variance.value(),this._currentInterval=e.mainSeries().interval(),this.properties().onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),i.e(1583).then(i.bind(i,192118)).then((t=>{this._setPaneViews([new t.GhostFeedPaneView(this,e)])}))}isSynchronizable(){return!1}destroy(){this.properties().onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),super.destroy()}propertiesChanged(){super.propertiesChanged(),this._currentAverageHL===this.properties().childs().averageHL.value()&&this._currentVariance===this.properties().childs().variance.value()||this._regenerate()}pointsCount(){return-1}name(){return"Ghost Feed"}segmentBars(e){return this._segments[e].bars()}segments(){return this._segments}generateBars(e){this._segments.length<=e&&this._segments.push(new a(this,e)),this._segments[e].generate()}addPoint(e,t,i){if(this._finished)return!0;if(this._points.length>0){const i=this._points[this._points.length-1];if(!(null==t?void 0:t.isApiEvent())&&i.index===e.index){this._lastPoint=null,this.normalizePoints(),this.createServerPoints();for(let e=0;e<this._points.length;e++)this._createPointProperty(e);return!0}}const s=super.addPoint(e,t,i);return this._points.length>1&&this.generateBars(this._points.length-2),s}finish(){this._finished=!0,this._lastPoint=null,this.normalizePoints(),this.createServerPoints()}setPoint(e,t,i,s){if(super.setPoint(e,t,i),e>0){const i=this.points()[e-1],s=t.index-i.index;this._segments[e-1].setSize(Math.abs(s))}if(e<this.points().length-1){const i=this.points()[e+1].index-t.index;this._segments[e].setSize(Math.abs(i))}}state(e){const t=super.state(e);return t.segments=this._segments.map((e=>({bars:[...e.bars()]}))),t}restoreData(e){e.segments&&(this._segments=e.segments.map(((e,t)=>new a(this,t,e.bars)))),this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value()}onData(e){super.onData(e);if(!this.pointsProperty().childs().points.child("0"))for(let e=0;e<this._points.length;e++)this._createPointProperty(e);this._currentInterval!==this._model.mainSeries().interval()&&(this._regenerate(),this._currentInterval=this._model.mainSeries().interval())}cloneData(e){
this._segments=e._segments.map((e=>e.clone(this)))}startMoving(e,t,i,s){super.startMoving(e,t,i,s),this._preparePixelSegments()}move(e,t,i,s){super.move(e,t,i,s),this._restoreSegmentsFromPixels()}endMoving(e,t){return this._segmentsPixelsWhileMoving=null,super.endMoving(e,t)}static createProperties(e){const t=new s.DefaultProperty("linetoolghostfeed",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,568210))).GhostFeedDefinitionsViewModel}_handleRestoringFactoryDefaults(){const e=Math.round(this._calculateATR());this.properties().childs().averageHL.setValue(e)}_regenerate(){this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value(),this._segments.forEach((e=>e.generate())),this.updateAllViews((0,l.sourceChangeEvent)(this.id())),this._model.updateSource(this)}_calculateATR(){const e=this._model.mainSeries(),t=[];e.bars().each(((e,i)=>{const s=i[2],r=i[3];return null!=s&&null!=r&&t.push(s-r),!1}));let i=0===t.length?0:t.reduce(((e,t)=>e+t),0)/t.length;return i*=e.base(),i}_preparePixelSegments(){var e,t;const i=this.priceScale(),s=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===i||null===s||i.isEmpty()||!i.isLog())return;const r=this.points();this._segmentsPixelsWhileMoving=this._segments.map(((e,t)=>{const n=r[t].price,o=r[t+1].price,a=i.priceToCoordinate(n,s),l=(i.priceToCoordinate(o,s)-a)/(e.bars().length-1);return{bars:e.bars().map(((e,t)=>{const r=a+t*l,n=i.coordinateToPrice(r,s);return{open:i.priceToCoordinate(n+e.o,s)-r,high:i.priceToCoordinate(n+e.h,s)-r,low:i.priceToCoordinate(n+e.l,s)-r,close:i.priceToCoordinate(n+e.c,s)-r}}))}}))}_restoreSegmentsFromPixels(){var e,t;const i=this.priceScale(),s=null!==(t=null===(e=this.ownerSource())||void 0===e?void 0:e.firstValue())&&void 0!==t?t:null;if(null===i||null===s||null===this._segmentsPixelsWhileMoving)return;const r=this.points();this._segmentsPixelsWhileMoving.forEach(((e,t)=>{const n=this._segments[t],o=r[t].price,a=r[t+1].price,l=i.priceToCoordinate(o,s),c=(i.priceToCoordinate(a,s)-l)/(e.bars.length-1),h=n.bars().map(((t,r)=>{const n=e.bars[r],o=l+r*c,a=i.coordinateToPrice(o,s);return{...t,o:i.coordinateToPrice(n.open+o,s)-a,h:i.coordinateToPrice(n.high+o,s)-a,l:i.coordinateToPrice(n.low+o,s)-a,c:i.coordinateToPrice(n.close+o,s)-a}}));n.setBars(h)}))}}},345057:(e,t,i)=>{"use strict";i.d(t,{LineToolHeadAndShoulders:()=>o});var s=i(508547),r=i(365897),n=i(519355);class o extends r.LineDataSource{constructor(e,t,s,r){const n=t||o.createProperties();super(e,n,s,r),i.e(1583).then(i.bind(i,344796)).then((t=>{this._setPaneViews([new t.LineToolHeadAndShouldersPaneView(this,e)])}))}pointsCount(){return 7}name(){return"Head and Shoulders"}static createProperties(e){const t=new s.DefaultProperty("linetoolheadandshoulders",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){
return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,991497)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new n.LineToolColorsProperty([e.childs().textcolor]))}}},556434:(e,t,i)=>{"use strict";i.d(t,{LineToolHighlighter:()=>n});var s=i(508547),r=i(288062);class n extends r.LineToolBrushBase{constructor(e,t,i,s){super(e,t||n.createProperties(),i,s),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Highlighter"}static createProperties(e){const t=new s.DefaultProperty("linetoolhighlighter",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,718637)).then((e=>e.HighlighterDefinitionsViewModel))}_loadPaneViews(e){i.e(1583).then(i.bind(i,676223)).then((t=>{this._setPaneViews([new t.HighlighterPaneView(this,e)])}))}}},359299:(e,t,i)=>{"use strict";i.d(t,{LineToolHorzLinePriceAxisView:()=>n});var s=i(672428),r=i(602564);class n extends s.PriceAxisView{constructor(e){super(),this._source=e}_updateRendererData(e,t,i){e.visible=!1;const s=this._source.points(),n=this._source.priceScale();if(0===s.length||null===n||n.isEmpty())return;const o=s[0];if(!isFinite(o.price))return;const a=this._source.ownerSource(),l=null!==a?a.firstValue():null;if(null===l)return;const c=(0,r.resetTransparency)(this._source.properties().linecolor.value());i.background=c,i.textColor=this.generateTextColor(c),i.coordinate=n.priceToCoordinate(o.price,l),e.text=n.formatPrice(o.price,l),e.visible=!0}}},387952:(e,t,i)=>{"use strict";i.d(t,{LineToolHorzLine:()=>l});var s=i(976704),r=i.n(s),n=i(508547),o=i(365897),a=i(359299);class l extends o.LineDataSource{constructor(e,t,s,r){super(e,t||l.createProperties(),s,r),this._priceAxisView=new a.LineToolHorzLinePriceAxisView(this),i.e(1583).then(i.bind(i,38362)).then((({HorzLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}state(e){const t=super.state(e);return t.points&&0!==t.points.length&&(t.points[0].offset=0),t}pointsCount(){return 1}name(){return"Horizontal Line"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}timeAxisViews(){return null}timeAxisPoints(){return[]}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e)}canHasAlert(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}denormalizeTimePoints(){this._points=[],this._timePoint.length>0&&this._points.push({price:this._timePoint[0].price,index:0})}clearData(){const e=this._points;super.clearData(),this._points=e}static createProperties(e){const t=new n.DefaultProperty("linetoolhorzline",e);return this._configureProperties(t),t}
_getAlertPlots(){return[this.points()[0].price]}_pointsForPointset(){return[]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,393519)).then((e=>e.HorizontalLineDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(r())("")),e.addExclusion("text")}}},43911:(e,t,i)=>{"use strict";i.d(t,{LineToolHorzRay:()=>l});var s=i(508547),r=i(976704),n=i.n(r),o=i(359299),a=i(365897);class l extends a.LineDataSource{constructor(e,t,s,r){super(e,null!=t?t:l.createProperties(),s,r),this._priceAxisView=new o.LineToolHorzLinePriceAxisView(this),i.e(1583).then(i.bind(i,339050)).then((({HorzRayPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Horizontal Ray"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}canHasAlert(){return!0}static createProperties(e){const t=new s.DefaultProperty("linetoolhorzray",e);return this._configureProperties(t),t}_getAlertPlots(){const e=this._points[0],t={index:e.index+1,price:e.price},i=this._linePointsToAlertPlot([e,t],null,!1,!0);return null!==i?[i]:[]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,925841))).HorizontalRayDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(n())("")),e.addExclusion("text")}}},539421:(e,t,i)=>{"use strict";i.d(t,{LineToolIcon:()=>a});var s=i(508547),r=i(519355),n=i(775562);const o=(0,i(817808).getLogger)("Chart.LineToolIcon");class a extends n.LineToolSvgIconBase{constructor(e,t,i,s){super(e,t||a.createProperties(),i,s),this.version=1,this._loadViews()}name(){return"Icon"}applyTemplate(e){delete e.icon,super.applyTemplate(e)}static createProperties(e){const t=new s.DefaultProperty("linetoolicon",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,28883)).then((e=>e.IconsDefinitionsViewModel))}async _loadViews(){const[{getSvgContentForCharCode:e,getSvgRenderer:t},{IconPaneView:s},{svgRenderer:r}]=await Promise.all([i.e(7987).then(i.bind(i,206650)),i.e(1583).then(i.bind(i,282403)),i.e(2616).then(i.bind(i,953957))]);if(!this._isDestroyed){const i=this._properties.childs().icon.value();this._svgContent=e(i),this._onIconChanged.fire();const n=t(r,i)
;null===n&&o.logWarn(`Couldn't create svg renderer for icon ${i}`),this._setPaneViews([new s(this,this._model,n)])}}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new r.LineToolColorsProperty([e.childs().color]))}}},684156:(e,t,i)=>{"use strict";i.d(t,{LineToolInfoLine:()=>n});var s=i(508547),r=i(620164);class n extends r.LineToolTrendLine{constructor(e,t,i,s){super(e,t||n.createProperties(),i,s)}pointsCount(){return 2}name(){return"Info Line"}static createProperties(e){const t=new s.DefaultProperty("linetoolinfoline",e);return this._configureProperties(t),t}}},546725:(e,t,i)=>{"use strict";var s=i(451215).LevelsProperty,r=i(806788).LineToolPitchfork;class n extends r{constructor(e,t,i,s){super(e,t||n.createProperties(),i,s)}name(){return"Inside Pitchfork"}static createProperties(e){var t=new s("linetoolinsidepitchfork",e,!1,{range:[0,8]});return this._configureProperties(t),t}}t.LineToolInsidePitchfork=n},315264:(e,t,i)=>{"use strict";var s;i.r(t),i.d(t,{isMtpPredictorToolName:()=>o,isStudyLineToolName:()=>a,isLineToolName:()=>l,isLineDrawnWithPressedButton:()=>c,isLineToolFinishRequiredWhenCreatedByApi:()=>h,isLineToolDrawWithoutPoints:()=>d,isImageToolName:()=>u,isTextToolName:()=>p});var r=i(494037);const n=new Set([]);function o(e){return n.has(e)}function a(e){return"LineToolRegressionTrend"===e||"LineToolVbPFixed"===e||"LineToolFixedRangeVolumeProfile"===e}function l(e){return e in(s||(s=i.t(r,2)))||a(e)}function c(e){return"LineToolBrush"===e||"LineToolHighlighter"===e}function h(e){return c(e)||"LineToolPath"===e||"LineToolPolyline"===e||"LineToolGhostFeed"===e}function d(e){return"LineToolTweet"===e||"LineToolIdea"===e||"LineToolImage"===e}function u(e){return"LineToolImage"===e}function p(e){switch(e){case"LineToolBalloon":case"LineToolComment":case"LineToolText":case"LineToolTextAbsolute":case"LineToolCallout":case"LineToolNote":case"LineToolNoteAbsolute":case"LineToolSignpost":return!0}return!1}},137680:(e,t,i)=>{"use strict";i.d(t,{LineDataSourcePointIndexProperty:()=>n});var s=i(976704),r=i.n(s);class n extends(r()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t}value(){return this._lineSource.points()[this._pointIndex].index}setValue(e){const t=this._lineSource.points()[this._pointIndex];t.index=e,this._lineSource.startChanging(this._pointIndex,t),this._setPointImpl(t),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this);const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)}_setPointImpl(e){this._lineSource.setPoint(this._pointIndex,e)}}},113627:(e,t,i)=>{"use strict";i.d(t,{LineToolPriceAxisView:()=>o});var s=i(650151),r=i(672428),n=i(602564);class o extends r.PriceAxisView{constructor(e,t){super(),this._active=!1,this._source=e,this._data=t,this._properties=e.model().properties().childs().scalesProperties}setActive(e){this._active=e}_updateRendererData(e,t,i){e.visible=!1;const s=this._source.model();if(!s.timeScale()||s.timeScale().isEmpty())return
;const r=this._source.priceScale();if(null===r||r.isEmpty())return;if(!s.selection().isSelected(this._source)&&!this._source.isForcedDrawPriceAxisLabel())return;if(null===s.timeScale().visibleBarsStrictRange())return;const o=this._source.priceAxisPoints(),a=this._data.pointIndex;if(o.length<=a)return;const l=o[a];if(!isFinite(l.price))return;const c=this._source.ownerSource(),h=null!==c?c.firstValue():null;if(null===h)return;let d=this._data.backgroundPropertyGetter?this._data.backgroundPropertyGetter():null;null===d&&(d=this._getBgColor()),i.background=(0,n.resetTransparency)(d),i.borderColor="#2E84A6",i.textColor=this.generateTextColor(i.background),i.coordinate=r.priceToCoordinate(l.price,h),e.text=this._formatPrice(l.price,h),e.visible=!0}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_formatPrice(e,t){return(0,s.ensureNotNull)(this._source.priceScale()).formatPrice(e,t)}}},53794:(e,t,i)=>{"use strict";i.d(t,{LineDataSourceTimeAxisView:()=>r});var s=i(51545);class r extends s.TimeAxisView{constructor(e,t){super(e.model()),this._active=!1,this._source=e,this._pointIndex=t,this._properties=e.model().properties().childs().scalesProperties}setActive(e){this._active=e}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_getIndex(){if(!this._model.selection().isSelected(this._source))return null;const e=this._source.timeAxisPoints();return e.length<=this._pointIndex?null:e[this._pointIndex].index}_isVisible(){return!0}}},365897:(e,t,i)=>{"use strict";i.d(t,{LineDataSource:()=>O});var s=i(86441),r=i(650151),n=i(559410),o=i(817808),a=i(484727),l=i(922157),c=i.n(l),h=i(872580),d=i(210596),u=i.n(d),p=i(706486),_=i(382213),m=i(224778),g=i(785359),f=i(632054),v=i(565601),S=i(638273),y=i(976704),b=i.n(y),w=i(358076),P=i(881517),C=i(920936),T=i(486028),x=i(744687),I=i(296055),M=i(137680);class L extends(b()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t,e.pointAdded().subscribe(this,(e=>{this._pointIndex===e&&this._listeners.fire(this)})),e.pointChanged().subscribe(this,(e=>{this._pointIndex===e&&this._listeners.fire(this)}))}value(){const e=this._lineSource.points()[this._pointIndex].price,t=(0,r.ensureNotNull)(this._lineSource.ownerSource()).formatter();if(t.parse){const i=t.format(e),s=t.parse(i);return s.res?s.value:e}return e}setValue(e){const t=this._lineSource.points()[this._pointIndex];t.price=parseFloat(""+e),this._lineSource.startChanging(this._pointIndex,t),this._lineSource.setPoint(this._pointIndex,t),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this);const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)}}var A=i(53794),k=i(113627),E=i(519355),D=i(584739);const B=(0,o.getLogger)("Chart.LineDataSource"),V=a.enabled("datasource_copypaste");class R{constructor(){this._states=[]}
start(e){this._states.push(e)}finish(e){const t=(0,r.ensureDefined)(this._states.pop());return s=t,(i=e).length!==s.length?{indexesChanged:!0,pricesChanged:!0}:i.reduce(((e,t,i)=>{const r=s[i];return e.indexesChanged=e.indexesChanged||t.index!==r.index,e.pricesChanged=e.pricesChanged||t.price!==r.price,e}),{indexesChanged:!1,pricesChanged:!1});var i,s}isEmpty(){return 0===this._states.length}}let N=0;class O extends P.DataSource{constructor(e,t,i,s){if(super(s),this.version=1,this.toolname="",this.customization={forcePriceAxisLabel:!1,disableErasing:!1,disableSave:!1,showInObjectsTree:!0},this._currentPointsetAndSymbolId=null,this._pointChanged=new(c()),this._pointAdded=new(c()),this._priceAxisViews=[],this._timeAxisViews=[],this._timePoint=[],this._points=[],this._lastPoint=null,this._paneViews=new Map,this._normalizedPointsChanged=new(c()),this._fixedPointsChanged=new(c()),this._changeStatesStack=new R,this._startMovingPoint=null,this._currentMovingPoint=null,this._isActualSymbol=!1,this._isActualInterval=!1,this._isActualCurrency=!1,this._isActualUnit=!1,this._isDestroyed=!1,this._sharingMode=new(u())(0),this._onTemplateApplying=new(c()),this._onTemplateApplied=new(c()),this._syncStateExclusions=[],this._definitionsViewModel=null,this._syncLineStyleMuted=!1,this._onIsActualIntervalChange=new(c()),this._linkKey=new(u())(null),this._serverUpdateTime=null,this._boundCalcIsActualSymbol=this.calcIsActualSymbol.bind(this),this._alertUndoMode=!1,this._model=e,this._properties=t,this._localAndServerAlertsMismatch=!1,this._properties.hasChild("interval")||this._properties.addChild("interval",new(b())(e.mainSeries().interval())),this.calcIsActualSymbol(),this._properties.childs().intervalsVisibilities.listeners().subscribe(this,this.calcIsActualSymbol),this._properties.subscribe(this,(()=>this.propertiesChanged())),this._createPointsProperties(),this.pointsCount()>0)for(let e=0;e<this.pointsCount();e++)this._priceAxisViews.push(this.createPriceAxisView(e)),this._timeAxisViews.push(new A.LineDataSourceTimeAxisView(this,e));this._properties.childs().visible.subscribe(this,(e=>{const t=!1===(0,w.hideAllDrawings)().value();e.value()?e.value()&&t&&n.emit("drawing_event",this._id,"show"):(this._model.selection().isSelected(this)&&this._model.selectionMacro((e=>{e.removeSourceFromSelection(this)})),t&&n.emit("drawing_event",this._id,"hide")),this._onSourceHiddenMayChange()})),(0,w.hideAllDrawings)().subscribe(this,this._onSourceHiddenMayChange),this._definitionsViewModel=null,this._isDestroyed=!1}destroy(){this._paneViews.forEach(((e,t)=>this._destroyPanePaneViews(t))),this.stop(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),null!==this._ownerSource&&(this._ownerSource.currencyChanged().unsubscribeAll(this),this._ownerSource.unitChanged().unsubscribeAll(this),(0,I.isSymbolSource)(this._ownerSource)&&(this._ownerSource.symbolResolved().subscribe(this,this._boundCalcIsActualSymbol),this._ownerSource.isActingAsSymbolSource().unsubscribe(this._boundCalcIsActualSymbol))),
this.ownerSourceChanged().unsubscribeAll(this),(0,w.hideAllDrawings)().unsubscribeAll(this),this._isDestroyed=!0}priceScale(){return this._ownerSource?this._ownerSource.priceScale():null}createPriceAxisView(e){return new k.LineToolPriceAxisView(this,{pointIndex:e})}model(){return this._model}symbol(){return this._properties.childs().symbol.value()}linkKey(){return this._linkKey}serverUpdateTime(){return this._serverUpdateTime}setServerUpdateTime(e){this._serverUpdateTime=e}boundToSymbol(){return!0}isAvailableInFloatingWidget(){return!0}points(){const e=[];for(let t=0;t<this._points.length;t++){const i=this._points[t];e.push({index:i.index,price:i.price,time:i.time})}return this._lastPoint&&e.push(this._correctLastPoint(this._lastPoint)),!this.isFixed()&&this._currentMovingPoint&&this._startMovingPoint&&this._correctPoints(e),e}timeAxisPoints(){return this.points()}priceAxisPoints(){return this.points()}fixedPoint(){var e;let t;const i=this.priceScale();if(this._positionPercents&&null!==i&&!i.isEmpty()){const e=this._positionPercents,r=this._model.timeScale().width()*e.x,n=i.height()*e.y;t=new s.Point(r,n)}else void 0!==this._fixedPoint&&(t=null===(e=this._fixedPoint)||void 0===e?void 0:e.clone());if(this._currentMovingPoint&&this._startMovingPoint&&void 0!==t){const e=this._correctFixedPoint(t);e.didCorrect&&(t=e.point)}return t}positionPercents(){return this._positionPercents}normalizedPoints(){return this._timePoint}normalizedPointsChanged(){return this._normalizedPointsChanged}fixedPointChanged(){return this._fixedPointsChanged}geometry(){const e=(0,r.ensureNotNull)(this.priceScale());return this.points().map((t=>{const i=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),n=i.x/this._model.timeScale().width(),o=i.y/e.height();return new s.Point(n,o)}))}widthsProperty(){var e;return null!==(e=this._properties.childs().linesWidths)&&void 0!==e?e:null}lineColorsProperty(){var e;return null!==(e=this._properties.childs().linesColors)&&void 0!==e?e:null}backgroundColorsProperty(){var e;return null!==(e=this._properties.childs().backgroundsColors)&&void 0!==e?e:null}textColorsProperty(){var e;return null!==(e=this._properties.childs().textsColors)&&void 0!==e?e:null}pointsProperty(){return this._pointsProperty}hasEditableCoordinates(){return!0}startMoving(e,t,i,s){this.isFixed()&&this.restoreFixedPoint(),this._startMovingPoint=e}move(e,t,i,s){if(i&&(i.shiftOnly()||i.modShift()))if(this.isFixed()){const t=this._alignScreenPointHorizontallyOrVertically((0,r.ensureDefined)(e.screen));this._currentMovingPoint={screen:t}}else{const t=this._alignPointHorizontallyOrVertically((0,r.ensureDefined)(e.logical)),i=(0,r.ensureNotNull)(this.pointToScreenPoint(t));this._currentMovingPoint={logical:t,screen:i}}else this._currentMovingPoint=e;this.updateAllViews((0,x.sourceChangeEvent)(this.id()))}endMoving(e,t,i){let s=!1,o=!1;if(this._currentMovingPoint&&this._startMovingPoint){if(this.isFixed()){const e=this._correctFixedPoint((0,r.ensureDefined)(this._fixedPoint));e.didCorrect&&(this._fixedPoint=e.point,this._fixedPointsChanged.fire())
}else{const e=(0,r.ensureDefined)(this._currentMovingPoint.logical),t=(0,r.ensureDefined)(this._startMovingPoint.logical);s=e.index!==t.index,o=e.price!==t.price;if(this._correctPoints(this._points,i)){n.emit("drawing_event",this._id,"move"),n.emit("drawing_event",this._id,"points_changed");for(let e=0;e<this._points.length;e++)this._pointChanged.fire(e)}}this._startMovingPoint=null,this._currentMovingPoint=null}const a={indexesChanged:s,pricesChanged:o};return this.isFixed()?(this.calcPositionPercents(),this.updateAllViews((0,x.sourceChangeEvent)(this.id())),a):(this.updateAllViews((0,x.sourceChangeEvent)(this.id())),s&&!e?(this._properties.childs().interval.setValue(this._model.mainSeries().interval()),this.normalizePoints(),this.createServerPoints()):(this._copyPricesWithoutNormalization(),this._normalizedPointsChanged.fire()),a)}startMovingPoint(){return this._startMovingPoint?{...this._startMovingPoint}:null}currentMovingPoint(){return this._currentMovingPoint?{...this._currentMovingPoint}:null}startChanging(e,t){void 0!==e&&void 0!==t&&(e<this._priceAxisViews.length&&this._priceAxisViews[e].setActive(!0),e<this._timeAxisViews.length&&this._timeAxisViews[e].setActive(!0)),this._changeStatesStack.start(this.points())}endChanging(e,t,i){const s=this._changeStatesStack.finish(this.points());s.indexesChanged&&this._changeStatesStack.isEmpty()?(this._properties.childs().interval.setValue(this._model.mainSeries().interval()),this.normalizePoints(),t||this.createServerPoints()):(this._copyPricesWithoutNormalization(),this._normalizedPointsChanged.fire()),n.emit("drawing_event",this._id,"points_changed");for(let e=0;e<this._priceAxisViews.length;e++)this._priceAxisViews[e].setActive(!1);for(let e=0;e<this._timeAxisViews.length;e++)this._timeAxisViews[e].setActive(!1);return s}setPoint(e,t,i,s){if(i&&i.shift()&&this._snapTo45DegreesAvailable()){const i=0===e?1:e-1;this._snapPoint45Degree(t,this.points()[i])}this._setPoint(e,t)}getPoint(e){return this.points()[e]||null}alignCrossHairToAnchor(e){return!0}setLastPoint(e,t){return this._lastPoint=this._preparePoint(e,t),this.updateAllViews((0,x.sourceChangeEvent)(this.id())),this._lastPoint}lastPoint(){return this._lastPoint}getChangePointForSync(e){return this.getPoint(e)}setPoints(e){this._points=e}isForcedDrawPriceAxisLabel(){return this.customization.forcePriceAxisLabel}clearData(){this._points=[]}denormalizeTimePoints(){let e=[];for(let t=0;t<this._timePoint.length;t++){const i=this._model.timeScale().denormalizeTimePoint(this._timePoint[t]);if(void 0===i){e=[];break}e.push({index:i,price:this._timePoint[t].price})}e.length>0&&(this._points=e)}restorePoints(e,t,i){const s=this._timePoint.length>0&&!(0,T.deepEquals)(this._timePoint,e)[0];this._timePoint=(0,h.deepCopy)(e),this._points=t,i||this.denormalizeTimePoints(),s&&this._normalizedPointsChanged.fire()}restorePositionPercents(e){this._positionPercents=e}calcIsActualSymbol(){const e=this.ownerSource();if(null===e)this._isActualSymbol=!1;else{const t=(0,r.ensureNotNull)(e.symbolSource());this._migrateSymbolProperty()
;const i=this._properties.childs().symbol,s=i.value();if(this._isActualSymbol=t.symbolSameAsCurrent(s),this._isActualSymbol){const e=t.symbol();(0,v.areEqualSymbols)(s,e)||(B.logWarn('Possible drawing "migrating" detected from "'+s+'" to "'+e+'"'),B.logWarn("Series symbolInfo: "+JSON.stringify(t.symbolInfo())),B.logWarn(`${(new Error).stack}`)),i.setValue(e)}}this.calcIsActualInterval(),this.calcIsActualCurrency(),this.calcIsActualUnit(),this._onSourceHiddenMayChange()}calcIsActualCurrency(){const e=this.ownerSource();if(null===e)return void(this._isActualCurrency=!1);let t=this._properties.childs().currencyId.value();if(null!==t){const i=e.symbolSource();0,this._isActualCurrency=t===(0,f.symbolCurrency)(i.symbolInfo(),void 0,!0)}else{const t=(0,r.ensureNotNull)(e.symbolSource()).symbolInfo();this._isActualCurrency=null!==t&&(0,f.symbolCurrency)(t)===(0,f.symbolOriginalCurrency)(t)}this._onSourceHiddenMayChange()}calcIsActualUnit(){const e=this.ownerSource();if(null===e)return void(this._isActualUnit=!1);const t=this._properties.childs().unitId.value();if(null!==t)this._isActualUnit=t===(0,r.ensureNotNull)(e.symbolSource()).unit();else{const t=(0,r.ensureNotNull)(e.symbolSource()).symbolInfo(),i=this._model.unitConversionEnabled();this._isActualUnit=null!==t&&(0,f.symbolUnit)(t,i)===(0,f.symbolOriginalUnit)(t,i)}this._onSourceHiddenMayChange()}calcIsActualInterval(){const e=this._isActualInterval,t=this._properties,i=this._model.mainSeries();this._isActualInterval=(0,m.isActualInterval)(S.Interval.parse(i.interval()),t.childs().intervalsVisibilities),!this._isActualInterval&&this._model.selection().isSelected(this)&&this._model.selectionMacro((e=>e.removeSourceFromSelection(this))),this._isActualInterval!==e&&this._onIsActualIntervalChange.fire(),this._onSourceHiddenMayChange()}paneViews(e){if(this.isSourceHidden())return null;const t=this._getPaneViews(this.isMultiPaneAvailable()?e:void 0);if(null===t)return null;if(1===t.length)return[t[0]];const i=[];for(let e=t.length-1;e>=0;--e)i.push(t[e]);return i}priceAxisViews(e,t){if(t!==this.priceScale()||this.isSourceHidden())return null;if(this._model.lineBeingEdited()===this){const e=this._model.linePointBeingEdited();if(null!==e&&e<this._priceAxisViews.length){const t=this._priceAxisViews.slice(),i=t[e];return t.splice(e,1),t.push(i),t}return this._priceAxisViews}return this._priceAxisViews}timeAxisViews(){if(this.isSourceHidden())return null;if(this._model.lineBeingEdited()===this){const e=this._model.linePointBeingEdited();if(null!==e&&e<this._timeAxisViews.length){const t=this._timeAxisViews.slice(),i=t[e];return t.splice(e,1),t.push(i),t}return this._timeAxisViews}return this._timeAxisViews}isSavedInChart(){return!this.customization.disableSave}isSavedInStudyTemplates(){return!1}setSavingInChartEnabled(e){this.customization.disableSave=!e}shouldBeRemovedOnDeselect(){return!1}getOrderTemplate(){return null}getSourceIcon(){return{type:"loadSvg",svgId:"linetool."+this.toolname}}alertId(){return this._alertId}setAlert(e,t){throw new Error("not implemented")}
editAlert(e){}getAlert(){throw new Error("not implemented")}getAlertSync(){return null}synchronizeAlert(e){0}syncAlert(e){0}stateForAlert(){return null}getAlertIsActive(){return!1}detachAlert(){}removeAlert(){}deleteAlert(){}areLocalAndServerAlertsMismatch(){return!1}showInObjectTree(){return this.customization.showInObjectsTree}setShowInObjectsTreeEnabled(e){this.customization.showInObjectsTree=e}start(){this.createServerPoints()}processHibernate(){this.isSourceHidden()?this.isStarted()&&this.stop():this.isStarted()||this.start()}onData(e){"pointset_error"!==e.method?e.params.customId===this._currentPointsetIdWithPrefix()&&this._onPointsetUpdated(e.params.plots):B.logError(`Error getting pointset: ${e.params[0]} ${e.params[1]}`)}isBeingEdited(){return this===this._model.lineBeingEdited()}isActualSymbol(){return this._isActualSymbol}isActualCurrency(){return this._isActualCurrency}isActualInterval(){return this._isActualInterval}isActualUnit(){return this._isActualUnit}onIsActualIntervalChange(){return this._onIsActualIntervalChange}setOwnerSource(e){null!==this._ownerSource&&(this._ownerSource.currencyChanged().unsubscribeAll(this),this._ownerSource.unitChanged().unsubscribeAll(this)),null!==this._ownerSource&&(0,I.isSymbolSource)(this._ownerSource)&&(this._ownerSource.symbolResolved().unsubscribe(this,this._boundCalcIsActualSymbol),this._ownerSource.isActingAsSymbolSource().unsubscribe(this._boundCalcIsActualSymbol)),super.setOwnerSource(e),e&&(this.setPriceScale(e.priceScale()),e.currencyChanged().subscribe(this,this.calcIsActualCurrency),e.unitChanged().subscribe(this,this.calcIsActualUnit),this.calcIsActualSymbol(),this._migrateZOrder()),(0,I.isSymbolSource)(e)&&(e.symbolResolved().subscribe(this,this._boundCalcIsActualSymbol),e.isActingAsSymbolSource().subscribe(this._boundCalcIsActualSymbol))}dataAndViewsReady(){return this._paneViews.size>0}pointAdded(){return this._pointAdded}pointChanged(){return this._pointChanged}pointToScreenPoint(e){var t;const i=this._model.timeScale(),r=this.priceScale(),n=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue();if(!r||r.isEmpty()||i.isEmpty()||null==n)return null;const o=i.indexToCoordinate(e.index),a=r.priceToCoordinate(e.price,n);return new s.Point(o,a)}screenPointToPoint(e){var t;const i=this.priceScale(),s=null===(t=this.ownerSource())||void 0===t?void 0:t.firstValue();if(null==s||!isFinite(s)||null===i)return null;const r=this._model.timeScale().coordinateToIndex(e.x);return{price:i.coordinateToPrice(e.y,s),index:r}}calcMiddlePoint(e,t){return new s.Point((e.x+t.x)/2,(e.y+t.y)/2)}addPoint(e,t,i){const s=this._preparePoint(e,t);return this._addPointIntenal(s,t,i)}addFixedPoint(e){return this._fixedPoint=e,this.calcPositionPercents(),!0}calcPositionPercents(){const e=this.priceScale();if(!e||e.isEmpty()||void 0===this._fixedPoint)return;const t=this._fixedPoint.x/this._model.timeScale().width(),i=this._fixedPoint.y/e.height();return this._positionPercents={x:t,y:i},this._positionPercents}restoreFixedPoint(){this._fixedPoint=this.fixedPoint()}
getPointByPosition(e,t,i,s){return[t,i,s][e]}propertiesChanged(e){this.calcIsActualInterval(),this.updateAllViewsAndRedraw((0,x.sourceChangeEvent)(this.id())),e||this._syncLineStyleIfNeeded(),void 0===this._pendingPropertyChangedEvent&&(this._pendingPropertyChangedEvent=setTimeout((()=>{this._pendingPropertyChangedEvent=void 0,n.emit("drawing_event",this._id,"properties_changed")}),0))}state(e){var t,i;const s={type:this.toolname,id:this.id(),state:this.properties().state(null!==(t=this._propertiesStateExclusions())&&void 0!==t?t:void 0),points:(0,h.deepCopy)(this._timePoint),zorder:this.zorder(),ownerSource:null===(i=this.ownerSource())||void 0===i?void 0:i.id()};return this.linkKey().value()&&(s.linkKey=this.linkKey().value()),delete s.state.points,e&&(s.indexes=this._points),this.isFixed()&&(s.positionPercents=this._positionPercents||this.calcPositionPercents()),"version"in this&&1!==this.version&&(s.version=this.version),s}updateAllViews(e){this._isActualSymbol&&this._isActualCurrency&&this._isActualUnit&&this._isActualInterval&&this._properties.childs().visible.value()&&(this._updateAllPaneViews(e),this._priceAxisViews.forEach((t=>t.update(e))),this._timeAxisViews.forEach((t=>t.update(e))))}updateAllViewsAndRedraw(e){this.updateAllViews(e),this._model.updateSource(this)}tags(){return[this.toolname]}properties(){return this._properties}restoreExternalPoints(e,t){if(this._timePoint=(0,h.deepCopy)(e.points),t.indexesChanged){if(this.properties().childs().interval.setValue(e.interval),!this.isActualSymbol())return this._clearServerPoints(),void this._normalizedPointsChanged.fire();this.createServerPoints()}else{const t=Math.min(this._points.length,e.points.length);for(let i=0;i<t;i++)this._points[i].price=e.points[i].price}this._normalizedPointsChanged.fire()}restoreExternalState(e){this.properties().mergeAndFire(e)}applyTemplate(e){this._onTemplateApplying.fire(e),this._applyTemplateImpl(e),this.calcIsActualSymbol(),this.updateAllViews((0,x.sourceChangeEvent)(this.id())),this.model().lightUpdate(),this._onTemplateApplied.fire()}template(){return this.properties().preferences()}isFixed(){return!1}isLocked(){const e=this.properties().child("frozen");return void 0!==e&&e.value()}isSourceHidden(){return!this._properties.childs().visible.value()||(0,w.hideAllDrawings)().value()&&this.canBeHidden()||!this._isActualInterval||!this._isActualSymbol||!this._isActualCurrency||!this._isActualUnit}isSynchronizable(){return this.priceScale()===this._model.mainSeries().priceScale()}copiable(){return V}cloneable(){return null!==this._ownerSource&&null!==this._ownerSource.firstValue()}movable(){return!0}async getPropertyDefinitionsViewModel(){if(null===this._definitionsViewModel){const e=await this._getPropertyDefinitionsViewModelClass();return null===e||this._isDestroyed?null:(this._definitionsViewModel=new e(this._model.undoModel(),this),this._definitionsViewModel)}return this._definitionsViewModel}title(){return this.translatedType()}translatedType(){var e
;return null!==(e=D.lineToolsLocalizedNames[this.toolname])&&void 0!==e?e:"Line Tool"}name(){return"Line Tool"}createServerPoints(){if(!this._isActualSymbol)return;if(!this._model.chartApi().isConnected().value())return;if(this._clearServerPoints(),this._model.timeScale().isEmpty())return;if(0===this._timePoint.length&&this._points.length>0&&this.normalizePoints(),!this._readyToCreatePointset())return;const e=this._pointsForPointset();if(0===e.length)return;++N,this._currentPointsetAndSymbolId={pointsetId:N,symbolId:(0,r.ensureNotNull)(this._model.mainSeries().seriesSource().symbolInstanceId())};const t=(0,_.getServerInterval)(this.properties().childs().interval.value());this._model.chartApi().createPointset(this._currentPointsetIdWithPrefix(),"turnaround",this._currentPointsetAndSymbolId.symbolId,t,e,this.onData.bind(this))}finish(){}realign(){var e;this.calcIsActualSymbol(),this.isFixed()||this.isSourceHidden()||this._model.lineBeingCreated()===this||this._model.lineBeingEdited()===this||(null===(e=this._currentPointsetAndSymbolId)||void 0===e?void 0:e.symbolId)===this._model.mainSeries().seriesSource().symbolInstanceId()||this._clearServerPoints(),this.updateAllViews((0,x.sourceChangeEvent)(this.id()))}stop(){this._clearServerPoints()}restart(){this.isFixed()||(this._currentPointsetAndSymbolId=null,this.createServerPoints())}isStarted(){return null!==this._currentPointsetAndSymbolId}convertYCoordinateToPriceForMoving(e,t){var i;const s=(0,r.ensureNotNull)(this.priceScale());if(s.isEmpty())return null;const n=this.ownerSource(),o=(0,r.ensure)(null===(i=n||t)||void 0===i?void 0:i.firstValue());return s.coordinateToPrice(e,o)}syncMultichartState(e){const t={points:this._timePoint,interval:this._model.mainSeries().interval()},i=this.linkKey().value();if(null!==i&&this.isSynchronizable()){const s={model:this._model,linkKey:i,symbol:this._model.mainSeries().symbol(),finalState:t,changes:e};(0,w.finishChangingLineTool)(s)}}enableCurrentIntervalVisibility(){const e=this.properties().childs().intervalsVisibilities.state();void 0!==e&&((0,m.makeIntervalsVisibilitiesVisibleAtInterval)(e,S.Interval.parse(this._model.mainSeries().interval())),this.properties().childs().intervalsVisibilities.mergeAndFire(e))}clonePositionOffset(){return this.isFixed()?{barOffset:0,xCoordOffset:20,yCoordOffset:20}:{barOffset:0,xCoordOffset:0,yCoordOffset:-40}}sharingMode(){return this._sharingMode}share(e){this.isSynchronizable()&&this._sharingMode.setValue(e)}syncLineStyleState(){const e=this.properties().state(this._syncStateExclusions);return delete e.interval,e.intervalsVisibilities=(0,m.mergeIntervalVisibilitiesDefaults)(e.intervalsVisibilities),e}moveLineTool(e){e.forEach(((e,t)=>this._setPoint(t,e))),this.normalizePoints()}_setPoint(e,t){this._points[e].index===t.index?this._points[e].price=t.price:this._points[e]=t,this._pointChanged.fire(e)}_correctLastPoint(e){return(0,T.clone)(e)}_pointsForPointset(){return this._timePoint.map((e=>[e.time_t,e.offset]))}_snapPoint45Degree(e,t,i){
const s=this._model.timeScale(),n=s.indexToCoordinate(t.index),o=s.indexToCoordinate(e.index)-n,a=(0,r.ensureNotNull)(this.priceScale()),l=t.price,c=e.price,h=(0,r.ensureNotNull)((0,r.ensureNotNull)(this.ownerSource()).firstValue()),d=a.priceToCoordinate(l,h),u=a.priceToCoordinate(c,h)-d,p=Math.round(Math.atan2(o,u)/Math.PI*4);if(2===Math.abs(p))i||(e.price=l);else if(0===Math.abs(p)||4===Math.abs(p))i||(e.index=t.index);else{const t=Math.sqrt(o*o+u*u),i=o<0?-1:1,r=u<0?-1:1;let l=Math.max(Math.abs(u),Math.abs(o));l/=l*Math.sqrt(2)/t;const c=Math.round(s.coordinateToIndex(n+l*i)),p=Math.abs(s.indexToCoordinate(c)-n),_=a.coordinateToPrice(d+p*r,h);e.index=c,e.price=_}}normalizePoint(e){return{...this._model.timeScale().normalizeBarIndex(e.index),price:e.price}}normalizePoints(){this._timePoint=[];for(let e=0;e<this._points.length;e++)if(void 0!==this._points[e].index){const t=this.normalizePoint(this._points[e]);if(!t.time_t){this._timePoint=[];break}this._timePoint.push(t)}this._normalizedPointsChanged.fire()}_setPaneViews(e,t,i){if(this._isDestroyed)for(const t of e)t.destroy&&t.destroy();else this._paneViews.set(t,e),void 0!==t&&i&&t.onDestroyed().subscribe(this,(()=>this._destroyPanePaneViews(t))),this._model.lightUpdate()}_getPaneViews(e){return this._paneViews.get(e)||null}_updateAllPaneViews(e){this._paneViews.forEach((t=>{for(const i of t)i.update(e)}))}_alignPointHorizontallyOrVertically(e){const t=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,r.ensureDefined)((0,r.ensureNotNull)(this._startMovingPoint).logical),s=(0,r.ensureDefined)((0,r.ensureNotNull)(this._startMovingPoint).screen),n=Math.abs(s.x-t.x),o=Math.abs(s.y-t.y);if(n<10&&o<10)return e;return{index:n<o?i.index:e.index,price:n<o?e.price:i.price}}_alignScreenPointHorizontallyOrVertically(e){const t=(0,r.ensureDefined)((0,r.ensureNotNull)(this._startMovingPoint).screen),i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);return i<10&&n<10?e:i<n?new s.Point(t.x,e.y):new s.Point(e.x,t.y)}_correctPoints(e,t){const i=(0,r.ensureDefined)((0,r.ensureNotNull)(this._currentMovingPoint).screen),s=(0,r.ensureDefined)((0,r.ensureNotNull)(this._startMovingPoint).screen),n=i.subtract(s);if(n.length()<1&&!t)return!1;for(let t=0;t<e.length;t++){const i=e[t],s=(0,r.ensureNotNull)(this.pointToScreenPoint(i)).add(n),o=(0,r.ensureNotNull)(this.screenPointToPoint(s));e[t].index=o.index,e[t].price=o.price}return!0}_correctFixedPoint(e){if(void 0===this._fixedPoint)return{didCorrect:!1,point:e};const t=(0,r.ensureDefined)((0,r.ensureNotNull)(this._currentMovingPoint).screen),i=(0,r.ensureDefined)((0,r.ensureNotNull)(this._startMovingPoint).screen),s=t.subtract(i);return s.length()>=1?{didCorrect:!0,point:e.add(s)}:{didCorrect:!1,point:e}}_currentPointsetIdWithPrefix(){return"pointset_"+(0,r.ensureNotNull)(this._currentPointsetAndSymbolId).pointsetId}_clearServerPoints(){null!==this._currentPointsetAndSymbolId&&this._model.chartApi().isConnected().value()&&this._model.chartApi().removePointset(this._currentPointsetIdWithPrefix()),this._currentPointsetAndSymbolId=null}
_createPointProperty(e){const t=this._pointsProperty.childs().points;t.addProperty(""+e,{});const i=t[e];i.addChild("price",new L(this,e)),i.addChild("bar",new M.LineDataSourcePointIndexProperty(this,e))}_createPointsProperties(){this._pointsProperty=new(b()),this._pointsProperty.addChild("points",new(b()));for(let e=0;e<this.pointsCount();e++)this._createPointProperty(e)}_alignPointToRangeOfActualData(e){const t=(0,r.ensureNotNull)(this._model.mainSeries().bars().firstIndex()),i=(0,r.ensureNotNull)(this._model.mainSeries().bars().lastIndex());let s=Math.max(e.index,t);return s=Math.min(s,i),{...e,index:s}}_migrateSymbolProperty(){const e=this._properties.childs();if(e.symbolStateVersion.value()<2){const t=(0,r.ensureNotNull)(this.ownerSource()),i=(0,r.ensureNotNull)(t.symbolSource()),s=this._model.mainSeries();if(i===s)return void e.symbolStateVersion.setValueSilently(2);if(null===s.symbolInfo())return;if(null===i.symbolInfo())return;s.symbolSameAsCurrent(e.symbol.value())&&e.symbol.setValueSilently(i.symbol()),e.symbolStateVersion.setValueSilently(2)}}_migrateZOrder(){const e=this._properties.childs();e.zOrderVersion.value()<2&&(this.ownerSource()===this.model().mainSeries()&&this.setZorder(this.zorder()-this.model().mainSeries().obsoleteZOrder()),e.zOrderVersion.setValueSilently(2))}_preparePoint(e,t){const i=e;return t&&t.shift()&&this.points().length>=2&&this._snapTo45DegreesAvailable()&&this._snapPoint45Degree(i,this.points()[this.points().length-2]),i}_addPointIntenal(e,t,i){this._points.push(e);const s=this._points.length===this.pointsCount();return s?(this._lastPoint=null,i||(this.normalizePoints(),this.createServerPoints())):this._lastPoint=e,this._pointAdded.fire(this._points.length-1),s}_onSourceHiddenMayChange(){this._model.invalidate(p.InvalidationMask.validateAction((()=>{this!==this._model.lineBeingCreated()&&(this._isDestroyed||this.processHibernate())})))}_saveAlertIdInState(){return!0}_onPointsetUpdated(e){if(0!==e.length){for(let t=0;t<e.length;t++){const i=e[t],s=this._timePoint[i.index],r={index:i.value[0],time:new Date(1e3*i.value[1]),price:s.price};this._points.length<=i.index?(this._points.push(r),this._pointAdded.fire(this._points.length-1)):(this._points[i.index]=r,this._pointChanged.fire(i.index))}0,this.updateAllViewsAndRedraw((0,x.sourceChangeEvent)(this.id()))}}_snapTo45DegreesAvailable(){return!1}_onMainSeriesSymbolResolved(){const e=this.ownerSource();null===e||this._model.mainSeries()===e.symbolSource()||this.isSourceHidden()||this.createServerPoints()}_readyToCreatePointset(){return this._timePoint.length>0}_onAlertData(e){}_propertiesStateExclusions(){return null}_syncLineStyleIfNeeded(){const e=this.linkKey().value();!this._syncLineStyleMuted&&e&&(0,w.changeLineStyle)({linkKey:e,state:this.syncLineStyleState(),model:this._model})}_muteSyncLineStyle(){this._syncLineStyleMuted=!0}_unmuteSyncLineStyleWithoutApplyingChanges(){this.propertiesChanged(),this._syncLineStyleMuted=!1}_applyTemplateImpl(e){e.intervalsVisibilities=(0,
m.mergeIntervalVisibilitiesDefaults)(e.intervalsVisibilities);const t=this.properties();t.mergePreferences(e),t.saveDefaults(),this.propertiesChanged()}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_getAlertPlots(){return[]}_getUndoHistory(){return this._model.undoModel().undoHistory()}_synchronizeAlert(e){}_linePointsToAlertPlot(e,t,i,s){return null}static _configureProperties(e){if(O._addCollectedProperties(e),e.hasChild("symbolStateVersion")||e.addChild("symbolStateVersion",new(b())(1)),e.hasChild("zOrderVersion")||e.addChild("zOrderVersion",new(b())(1)),e.hasChild("visible")||e.addChild("visible",new(b())(!0)),e.hasChild("frozen")||e.addChild("frozen",new(b())(!1)),e.hasChild("symbol")||e.addChild("symbol",new(b())("")),e.hasChild("currencyId")||e.addChild("currencyId",new(b())(null)),e.hasChild("unitId")||e.addChild("unitId",new(b())(null)),e.addExclusion("symbolStateVersion"),e.addExclusion("zOrderVersion"),e.addExclusion("visible"),e.addExclusion("frozen"),e.addExclusion("symbol"),e.addExclusion("currencyId"),e.addExclusion("unitId"),e.hasChild("intervalsVisibilities")){const t=(0,T.merge)((0,T.clone)(g.intervalsVisibilitiesDefaults),e.childs().intervalsVisibilities.state());e.removeProperty("intervalsVisibilities"),e.addChild("intervalsVisibilities",new C.IntervalsVisibilitiesProperty(t))}else e.addChild("intervalsVisibilities",new C.IntervalsVisibilitiesProperty(g.intervalsVisibilitiesDefaults));e.hasChild("title")||e.addChild("title",new(b())("")),e.addExclusion("symbolInfo"),e.addExclusion("points"),e.addExclusion("interval"),e.addExclusion("title"),e.hasChild("singleChartOnly")&&e.removeProperty("singleChartOnly"),e.hasChild("font")&&e.removeProperty("font")}static _addCollectedProperties(e){e.hasChild("linewidth")&&e.addChild("linesWidths",new E.LineToolWidthsProperty([(0,r.ensureDefined)(e.child("linewidth"))])),e.hasChild("linecolor")&&e.addChild("linesColors",new E.LineToolColorsProperty([(0,r.ensureDefined)(e.child("linecolor"))])),e.hasChild("backgroundColor")&&e.addChild("backgroundsColors",new E.LineToolColorsProperty([(0,r.ensureDefined)(e.child("backgroundColor"))])),e.hasChild("textColor")&&e.addChild("textsColors",new E.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textColor"))])),e.addExclusion("linesWidths"),e.addExclusion("linesColors"),e.addExclusion("backgroundsColors"),e.addExclusion("textsColors")}_removeAlertSubscriptions(){var e;null===(e=this._unsubscribeAlertCallbacks)||void 0===e||e.call(this),this._unsubscribeAlertCallbacks=void 0}_addAlertSubscriptions(e){}_destroyPanePaneViews(e){const t=this._paneViews.get(e);if(void 0!==t)for(const e of t)e.destroy&&e.destroy();void 0!==e&&e.onDestroyed().unsubscribeAll(this),this._paneViews.delete(e)}_copyPricesWithoutNormalization(){const e=Math.min(this._points.length,this._timePoint.length);for(let t=0;t<e;t++)this._timePoint[t].price=this._points[t].price}}},519355:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LineToolMultiplePropertyBaseImpl:()=>l,LineToolCollectedProperty:()=>c,LineToolWidthsProperty:()=>h,
LineToolColorsProperty:()=>d,MultipleLineWidthsProperty:()=>p,MultipleLineColorsProperty:()=>_});var s=i(817808),r=i(922157),n=i.n(r);const o=(0,s.getLogger)("Chart.LineToolCollectedProperty");class a{applyValue(e,t){e.setValue(t)}}class l{constructor(e,t){this._onChange=new(n()),this._properties=e,e.forEach((e=>e.subscribe(this,(()=>{this._onChange.fire(this)})))),this._showIfProperty=t}visible(){var e;return!this._showIfProperty||(null===(e=this._showIfProperty)||void 0===e?void 0:e.value())}value(){if(0===this._properties.length)return o.logError("Incorrect call, should not request value of 0 properties"),"mixed";const e=this._properties[0].value();return 1===this._properties.length||this._properties.every((t=>t.value()===e))?e:"mixed"}state(){}merge(){}destroy(){this._properties.forEach((e=>e.unsubscribeAll(this)))}subscribe(e,t){this._onChange.subscribe(e,t)}unsubscribe(e,t){this._onChange.unsubscribe(e,t)}unsubscribeAll(e){this._onChange.unsubscribeAll(e)}storeStateIfUndefined(){return!0}}class c extends l{setValue(e,t,i){if("mixed"===e)return;const s=null!=i?i:new a;this._properties.forEach((t=>s.applyValue(t,e)))}}class h extends c{}class d extends c{firstColor(){return this._properties[0].value()}}class u extends l{setValue(e,t,i){if("mixed"===e)return;const s=null!=i?i:new a;this._properties.forEach((t=>t.setValue(e,void 0,s)))}}class p extends u{}class _ extends u{}},494037:(e,t,i)=>{"use strict";t.LineToolFibRetracement=i(228733).LineToolFibRetracement,t.LineToolFibChannel=i(607431).LineToolFibChannel,t.LineToolFibSpeedResistanceArcs=i(569803).LineToolFibSpeedResistanceArcs,t.LineToolProjection=i(859782).LineToolProjection,t.LineToolTrendBasedFibExtension=i(843313).LineToolTrendBasedFibExtension,t.LineToolElliott=i(360246).LineToolElliott,t.LineToolFibCircles=i(923236).LineToolFibCircles,t.LineToolVertLine=i(913031).LineToolVertLine,t.LineToolCrossLine=i(780419).LineToolCrossLine,t.LineToolBarsPattern=i(120040).LineToolBarsPattern,t.LineToolTrendBasedFibTime=i(340140).LineToolTrendBasedFibTime,t.LineToolFibTimeZone=i(505584).LineToolFibTimeZone,t.LineToolCircleLines=i(817359).LineToolCircleLines,t.LineToolDateRange=i(144827).LineToolDateRange,t.LineToolPriceRange=i(225745).LineToolPriceRange,t.LineToolDateAndPriceRange=i(333581).LineToolDateAndPriceRange,t.LineToolParallelChannel=i(82639).LineToolParallelChannel,t.LineToolTrendAngle=i(999570).LineToolTrendAngle,t.LineToolTrendLine=i(620164).LineToolTrendLine,t.LineToolInfoLine=i(684156).LineToolInfoLine,t.LineToolArrowMark=i(445314).LineToolArrowMark,t.LineToolExecution=i(231593).LineToolExecution,t.LineToolPitchfan=i(710186).LineToolPitchfan,t.LineToolGannSquare=i(177403).LineToolGannSquare,t.LineToolFibSpeedResistanceFan=i(646817).LineToolFibSpeedResistanceFan,t.LineToolGannComplex=i(568318).LineToolGannComplex,t.LineToolGannFixed=i(850515).LineToolGannFixed,t.LineToolGannFan=i(660840).LineToolGannFan,t.LineToolFibWedge=i(801656).LineToolFibWedge,t.LineToolPitchfork=i(806788).LineToolPitchfork,t.LineToolDisjointAngle=i(612452).LineToolDisjointChannel,
t.LineToolFlatBottom=i(102280).LineToolFlatBottom,t.LineToolIcon=i(539421).LineToolIcon,t.LineToolEmoji=i(672670).LineToolEmoji,t.LineToolRotatedRectangle=i(685328).LineToolRotatedRectangle,t.LineToolFibSpiral=i(512952).LineToolFibSpiral,t.LineToolHeadAndShoulders=i(345057).LineToolHeadAndShoulders,t.LineToolTriangle=i(101573).LineToolTriangle,t.LineToolTrianglePattern=i(202574).LineToolTrianglePattern,t.LineTool5PointsPattern=i(295203).LineTool5PointsPattern,t.LineToolThreeDrivers=i(981781).LineToolThreeDrivers,t.LineToolABCD=i(276230).LineToolABCD,t.LineToolPolyline=i(7490).LineToolPolyline,t.LineToolPath=i(478762).LineToolPath,t.LineToolPrediction=i(830860).LineToolPrediction,t.LineToolPriceLabel=i(136111).LineToolPriceLabel,t.LineToolArrowMarker=i(916687).LineToolArrowMarker,t.LineToolNote=i(603676).LineToolNote,t.LineToolNoteAbsolute=i(603676).LineToolNoteAbsolute,t.LineToolSignpost=i(592357).LineToolSignpost,t.LineToolBrush=i(334572).LineToolBrush,t.LineToolArc=i(177977).LineToolArc,t.LineToolCallout=i(90783).LineToolCallout,t.LineToolBalloon=i(229065).LineToolBalloon,t.LineToolComment=i(442619).LineToolComment,t.LineToolText=i(287011).LineToolText,t.LineToolHorzLine=i(387952).LineToolHorzLine,t.LineToolHorzRay=i(43911).LineToolHorzRay,t.LineToolRectangle=i(902846).LineToolRectangle,t.LineToolCircle=i(408716).LineToolCircle,t.LineToolEllipse=i(683086).LineToolEllipse,t.LineToolTimeCycles=i(115040).LineToolTimeCycles,t.LineToolSineLine=i(355012).LineToolSineLine,t.LineToolGhostFeed=i(653436).LineToolGhostFeed,t.LineToolBezierQuadro=i(162847).LineToolBezierQuadro,t.LineToolBezierCubic=i(631478).LineToolBezierCubic,t.LineToolArrow=i(466552).LineToolArrow,t.LineToolRay=i(407838).LineToolRay,t.LineToolExtended=i(713624).LineToolExtended,t.LineToolSchiffPitchfork=i(835157).LineToolSchiffPitchfork,t.LineToolSchiffPitchfork2=i(317751).LineToolSchiffPitchfork2,t.LineToolInsidePitchfork=i(546725).LineToolInsidePitchfork,t.LineToolTextAbsolute=i(287011).LineToolTextAbsolute,t.LineToolArrowMarkLeft=i(445314).LineToolArrowMarkLeft,t.LineToolArrowMarkRight=i(445314).LineToolArrowMarkRight,t.LineToolArrowMarkUp=i(445314).LineToolArrowMarkUp,t.LineToolArrowMarkDown=i(445314).LineToolArrowMarkDown,t.LineToolFlagMark=i(607777).LineToolFlagMark,t.LineToolCypherPattern=i(110905).LineToolCypherPattern,t.LineToolElliottImpulse=i(360246).LineToolElliottImpulse,t.LineToolElliottTriangle=i(360246).LineToolElliottTriangle,t.LineToolElliottTripleCombo=i(360246).LineToolElliottTripleCombo,t.LineToolElliottCorrection=i(360246).LineToolElliottCorrection,t.LineToolElliottDoubleCombo=i(360246).LineToolElliottDoubleCombo,t.LineToolRiskRewardLong=i(727084).LineToolRiskRewardLong,t.LineToolRiskRewardShort=i(727084).LineToolRiskRewardShort,t.LineToolPosition=i(564571).LineToolPosition,t.LineToolOrder=i(991444).LineToolOrder,t.LineToolHighlighter=i(556434).LineToolHighlighter,t.LineToolPriceNote=i(4718).LineToolPriceNote},584739:(e,t,i)=>{"use strict";i.d(t,{lineToolsLocalizedNames:()=>r});var s=i(509806);const r={
LineTool5PointsPattern:s.t(null,void 0,i(566527)),LineToolABCD:s.t(null,void 0,i(532852)),LineToolArc:s.t(null,void 0,i(745104)),LineToolArrow:s.t(null,void 0,i(696237)),LineToolArrowMarkDown:s.t(null,void 0,i(908738)),LineToolArrowMarkLeft:s.t(null,void 0,i(835062)),LineToolArrowMarkRight:s.t(null,void 0,i(192163)),LineToolArrowMarkUp:s.t(null,void 0,i(633196)),LineToolBalloon:s.t(null,void 0,i(40664)),LineToolComment:s.t(null,void 0,i(119372)),LineToolBarsPattern:s.t(null,void 0,i(98838)),LineToolBezierCubic:s.t(null,void 0,i(59368)),LineToolBezierQuadro:s.t(null,void 0,i(517206)),LineToolBrush:s.t(null,void 0,i(530251)),LineToolCallout:s.t(null,void 0,i(764149)),LineToolCircleLines:s.t(null,void 0,i(587761)),LineToolCypherPattern:s.t(null,void 0,i(927891)),LineToolDateAndPriceRange:s.t(null,void 0,i(379859)),LineToolDateRange:s.t(null,void 0,i(660222)),LineToolDisjointAngle:s.t(null,void 0,i(603556)),LineToolElliottCorrection:s.t(null,void 0,i(291215)),LineToolElliottDoubleCombo:s.t(null,void 0,i(180983)),LineToolElliottImpulse:s.t(null,void 0,i(674118)),LineToolElliottTriangle:s.t(null,void 0,i(95840)),LineToolElliottTripleCombo:s.t(null,void 0,i(866637)),LineToolEllipse:s.t(null,void 0,i(469418)),LineToolExtended:s.t(null,void 0,i(302578)),LineToolFibChannel:s.t(null,void 0,i(482719)),LineToolFibCircles:s.t(null,void 0,i(464192)),LineToolFibRetracement:s.t(null,void 0,i(463835)),LineToolFibSpeedResistanceArcs:s.t(null,void 0,i(418072)),LineToolFibSpeedResistanceFan:s.t(null,void 0,i(220877)),LineToolFibSpiral:s.t(null,void 0,i(476783)),LineToolFibTimeZone:s.t(null,void 0,i(489037)),LineToolFibWedge:s.t(null,void 0,i(472489)),LineToolFlagMark:s.t(null,void 0,i(155678)),LineToolImage:s.t(null,void 0,i(223450)),LineToolFlatBottom:s.t(null,void 0,i(829230)),LineToolAnchoredVWAP:s.t(null,void 0,i(961704)),LineToolGannComplex:s.t(null,void 0,i(366321)),LineToolGannFixed:s.t(null,void 0,i(887107)),LineToolGannFan:s.t(null,void 0,i(168102)),LineToolGannSquare:s.t(null,void 0,i(981180)),LineToolHeadAndShoulders:s.t(null,void 0,i(742616)),LineToolHorzLine:s.t(null,void 0,i(160049)),LineToolHorzRay:s.t(null,void 0,i(76604)),LineToolIcon:s.t(null,void 0,i(326579)),LineToolEmoji:s.t(null,void 0,i(285223)),LineToolInsidePitchfork:s.t(null,void 0,i(312354)),LineToolNote:s.t(null,void 0,i(275549)),LineToolNoteAbsolute:s.t(null,void 0,i(366828)),LineToolSignpost:s.t(null,void 0,i(368161)),LineToolParallelChannel:s.t(null,void 0,i(670394)),LineToolPitchfan:s.t(null,void 0,i(422293)),LineToolPitchfork:s.t(null,void 0,i(143852)),LineToolPolyline:s.t(null,void 0,i(953047)),LineToolPath:s.t(null,void 0,i(234402)),LineToolPrediction:s.t(null,void 0,i(436972)),LineToolPriceLabel:s.t(null,void 0,i(495921)),LineToolArrowMarker:s.t(null,void 0,i(982473)),LineToolPriceRange:s.t(null,void 0,i(102032)),LineToolProjection:s.t(null,void 0,i(187086)),LineToolRay:s.t(null,void 0,i(50470)),LineToolRectangle:s.t(null,void 0,i(200328)),LineToolCircle:s.t(null,void 0,i(490068)),LineToolRegressionTrend:s.t(null,void 0,i(435001)),
LineToolRiskRewardLong:s.t(null,void 0,i(844604)),LineToolRiskRewardShort:s.t(null,void 0,i(937819)),LineToolFixedRangeVolumeProfile:s.t(null,{context:"study"},i(40434)),LineToolRotatedRectangle:s.t(null,void 0,i(409998)),LineToolSchiffPitchfork:s.t(null,void 0,i(518559)),LineToolSchiffPitchfork2:s.t(null,void 0,i(298114)),LineToolSineLine:s.t(null,void 0,i(369502)),LineToolText:s.t(null,{context:"tool"},i(20936)),LineToolTextAbsolute:s.t(null,void 0,i(694782)),LineToolThreeDrivers:s.t(null,void 0,i(298538)),LineToolTimeCycles:s.t(null,void 0,i(395005)),LineToolTrendAngle:s.t(null,void 0,i(294770)),LineToolTrendBasedFibExtension:s.t(null,void 0,i(715501)),LineToolTrendBasedFibTime:s.t(null,void 0,i(931196)),LineToolTrendLine:s.t(null,void 0,i(423104)),LineToolInfoLine:s.t(null,void 0,i(627677)),LineToolTriangle:s.t(null,void 0,i(729245)),LineToolTrianglePattern:s.t(null,void 0,i(112390)),LineToolVertLine:s.t(null,void 0,i(156211)),LineToolCrossLine:s.t(null,void 0,i(260997)),LineToolHighlighter:s.t(null,void 0,i(831895)),LineToolPriceNote:s.t(null,void 0,i(328625)),LineToolVbPFixed:s.t(null,void 0,i(518426))};r.LineToolGhostFeed=s.t(null,void 0,i(807914))},232468:(e,t,i)=>{"use strict";i.r(t),i.d(t,{cloneLineTool:()=>z,createLineTool:()=>E,createLineToolProperties:()=>B,createStudyLineToolProperties:()=>V,getNewToolProperties:()=>k,isLineDrawnWithPressedButton:()=>T.isLineDrawnWithPressedButton,isLineTool:()=>N,isLineToolName:()=>T.isLineToolName,isStudyLineTool:()=>O,isStudyLineToolName:()=>T.isStudyLineToolName,isTrading:()=>F,lineToolByLinkKey:()=>H,prepareLineToolPropertiesByOwnerSource:()=>D,setNewToolProperties:()=>L,supportsPhantomMode:()=>R,tryFindStudyLineToolNameByStudyId:()=>W,unsetNewToolProperties:()=>A});var s=i(650151),r=i(86441),n=i(224778),o=i(746713),a=i(365897),l=i(494037),c=i.t(l,2),h=i(724912),d=i(101709),u=i(898005),p=i(278787),_=i(519355),m=i(486028),g=i(508547);const f=(0,d.studyIdString)("RegressionTrend","tv-basicstudies");function v(e){return void 0!==e.startPrice&&void 0!==e.endPrice}function S(e,t,i,s){return t.styles&&(y(t.styles.baseLine),y(t.styles.downLine),y(t.styles.upLine)),t}function y(e){void 0!==e&&void 0!==e.visible&&(e.display=e.visible?15:0,delete e.visible)}class b extends o.StudyLineDataSource{constructor(e,t,r,n,o){r=null!=r?r:(0,s.ensureNotNull)(e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:f}));super(e,r,"linreg_",null!=t?t:b.createProperties(e),n,o),this.version=2,this._trendData=null,i.e(1583).then(i.bind(i,79541)).then((e=>{this._setPaneViews([new e.RegressionTrendPaneView(this,this._model)])}))}formatter(){throw new Error("This method should never be called")}pointsCount(){return 2}clearData(){this._trendData=null,super.clearData()}state(e){var t;const i=super.state(e);return e?{...i,nonseriesdata:null!==(t=this._trendData)&&void 0!==t?t:void 0}:i}restoreData(e){var t;super.restoreData(e),this._trendData=null!==(t=e.nonseriesdata)&&void 0!==t?t:null}startIndex(){if(null===this._trendData||null===this._indexes)return null
;const e=this._indexes[this._trendData.startIndex];return e!==h.INVALID_TIME_POINT_INDEX?e:null}endIndex(){if(null===this._trendData||null===this._indexes)return null;const e=this._indexes[this._trendData.endIndex];return e!==h.INVALID_TIME_POINT_INDEX?e:null}baseLine(){return null===this._trendData?null:this._trendData.baseLine}downLine(){return null===this._trendData?null:this._trendData.downLine}upLine(){return null===this._trendData?null:this._trendData.upLine}pearsons(){return null===this._trendData?null:this._trendData.pearsons}recalcStudyIfNeeded(){this._onStudyInputsMayChange()}cloneable(){return!1}static createProperties(e,t){const i=u.StudyMetaInfo.getStudyPropertyRootNameById(f),r=(0,s.ensureNotNull)(e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:f})),n=(0,g.createDefaultsState)(!0,i,[],e.studyVersioning());return this.createRegressionTrendPropertiesFromStudyMetaInfoAndState(r,r,(0,m.merge)((0,m.clone)(n),null!=t?t:{}),e.studyVersioning())}static createRegressionTrendPropertiesFromStudyMetaInfoAndState(e,t,i,s){const r=(0,p.prepareStudyPropertiesForLoadChart)(e,t,i,s,S);return this._configureProperties(r),r}static studyId(){return f}_studyInputs(e){(0,s.assert)(2===e.length,"all the line tool points should be defined");const[t,i]=e;if(t.index===i.index)return null;const r=this._getPointTime(t.index<=i.index?t:i,!0),n=this._getPointTime(i.index>=t.index?i:t,!0);return null===r||null===n?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),"first bar time":1e3*r,"last bar time":1e3*n}}_onDataUpdated(e,t,i){null!==t&&(t.indexes_replace||(this._trendData=t.data),"nochange"!==i&&(this._indexes=i),super._onDataUpdated(e,t,i))}_isReady(){return null!==this._trendData&&void 0!==this._trendData.startIndex&&void 0!==this._trendData.endIndex&&v(this._trendData.upLine)&&v(this._trendData.baseLine)&&v(this._trendData.downLine)}_updateAnchorsPrice(){if(!this._trendData||(0,m.isNaN)(this._trendData.baseLine.startPrice)||(0,m.isNaN)(this._trendData.baseLine.endPrice))return;const{startPrice:e,endPrice:t}=this._trendData.baseLine;2===this._points.length&&(this._points[0].price=(0,s.ensureDefined)(e),this._points[1].price=(0,s.ensureDefined)(t),this._timePoint[0].price=(0,s.ensureDefined)(e),this._timePoint[1].price=(0,s.ensureDefined)(t))}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(3623),i.e(6682),i.e(7214),i.e(7358),i.e(34),i.e(607)]).then(i.bind(i,46742))).RegressionTrendDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=e.childs().styles.childs(),i=[t.upLine.childs().linewidth,t.downLine.childs().linewidth,t.baseLine.childs().linewidth];e.addChild("linesWidths",new _.LineToolWidthsProperty(i))}}var w=i(702434);const P=(0,d.studyIdString)("VbPFixed","tv-basicstudies");class C extends w.LineToolVbPFixed{constructor(e,t,i,s,r){const n=i||e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:P});super(e,t,n,s,r)}calcIsActualSymbol(){
o.StudyLineDataSource.prototype.calcIsActualSymbol.apply(this)}boundToSymbol(){return!0}isSynchronizable(){return this.priceScale()===this._model.mainSeries().priceScale()}static studyId(){return P}static createProperties(e,t){const i=u.StudyMetaInfo.getStudyPropertyRootNameById(P),r=(0,s.ensureNotNull)(e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:P})),n=(0,g.createDefaultsState)(!0,i,[],e.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(r,r,(0,m.merge)((0,m.clone)(n),null!=t?t:{}),e.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(e,t,i,s){const r=(0,p.prepareStudyPropertiesForLoadChart)(e,t,i,s);return this._configureProperties(r),r}}var T=i(315264),x=i(948222);function I(e){for(const t of Object.keys(e))TradingView[t]=e[t]}I(c),I({LineToolRegressionTrend:b,LineToolVbPFixed:w.LineToolVbPFixed,LineToolFixedRangeVolumeProfile:C});let M=null;function L(e,t,i){return null!==M&&M.tool===e&&M.toolData===t||(M={properties:B(e,void 0,i),tool:e,toolData:t}),M.properties}function A(){M=null}function k(e){return null!==M&&M.tool===e?M.properties:null}function E(e,t,i,r,n,o){let a;if((0,s.assert)((0,T.isLineToolName)(e),"Unknown line tool: "+e),n||i||(i=k(e)||void 0),"LineToolVbPFixed"===e)a=new w.LineToolVbPFixed(t,i,(0,s.ensureDefined)(r),n,o);else if("LineToolFixedRangeVolumeProfile"===e)a=new C(t,i,(0,s.ensureDefined)(r),n,o);else if("LineToolRegressionTrend"===e)a=new b(t,i,(0,s.ensureDefined)(r),n,o);else{a=new((0,s.ensureDefined)(c[e]))(t,i,n,o)}return a.toolname=e,A(),a}function D(e,t){const i=(0,s.ensureNotNull)(t.symbolSource());e.childs().symbol.setValue(i.symbol()),i.model().currencyConversionEnabled()&&e.childs().currencyId.setValue(i.currency()),i.model().unitConversionEnabled()&&e.childs().unitId.setValue(i.unit()),e.childs().symbolStateVersion.setValue(2),e.childs().zOrderVersion.setValue(2)}function B(e,t,i){if((0,s.assert)((0,T.isLineToolName)(e),`${e} should be name of the line tool`),"LineToolVbPFixed"===e)return w.LineToolVbPFixed.createProperties(i,t);if("LineToolFixedRangeVolumeProfile"===e)return C.createProperties(i,t);if("LineToolRegressionTrend"===e)return b.createProperties(i,t);return(0,s.ensureDefined)(c[e]).createProperties(t)}function V(e,t,i,r,n){if((0,s.assert)((0,T.isStudyLineToolName)(e),`${e} should be name of the study line tool`),"LineToolVbPFixed"===e)return w.LineToolVbPFixed.createPropertiesFromStudyMetaInfoAndState(t,i,r,n);if("LineToolFixedRangeVolumeProfile"===e)return C.createPropertiesFromStudyMetaInfoAndState(t,i,r,n);if("LineToolRegressionTrend"===e)return b.createRegressionTrendPropertiesFromStudyMetaInfoAndState(t,i,r,n);throw new Error(`Property creation is not implemented for study line tool ${e}`)}function R(e){(0,s.assert)((0,T.isLineToolName)(e),`${e} should be name of the line tool`);const t=c[e];return void 0!==t&&Boolean(t.supportPhantomMode)}function N(e){return e instanceof a.LineDataSource}function O(e){return e instanceof o.StudyLineDataSource}function F(e){return e instanceof x.LineToolTrading}
function W(e){let t=null;return e===b.studyId()?t="LineToolRegressionTrend":e===w.LineToolVbPFixed.studyId()?t="LineToolVbPFixed":e===C.studyId()&&(t="LineToolFixedRangeVolumeProfile"),t}function z(e,t,i,o){const a=t.toolname,l=t.properties().state();l.intervalsVisibilities=(0,n.mergeIntervalVisibilitiesDefaults)(null==l?void 0:l.intervalsVisibilities);const c=B(t.toolname,l,e);c.childs().visible.setValue(!0);const h=(0,s.ensureNotNull)(t.ownerSource()),d=E(a,e,c);void 0!==o&&d.setId(o),d.setOwnerSource(h),d.toolname=a;const u=d.clonePositionOffset();if(t.isFixed()){const e=(0,s.ensureDefined)(t.fixedPoint()),n=i?e.add(new r.Point(u.xCoordOffset,u.yCoordOffset)):e;d.addFixedPoint(n)}const p=t.normalizedPoints(),_=i?function(e,t,i){const r=(0,s.ensureNotNull)(t.priceScale()),n=(0,s.ensureNotNull)(t.firstValue());return e.map((e=>{const t=e.price,s=r.priceToCoordinate(t,n)+i.yCoordOffset,o=r.coordinateToPrice(s,n);return{time_t:e.time_t,price:o,offset:e.offset+i.barOffset}}))}(p,h,u):p,m=t.points();return d.restorePoints(_,m),d.cloneData&&d.cloneData(t),d.recalculateStateByData&&d.recalculateStateByData(),d}function H(e,t){var i;return null!==(i=e.dataSources().find((e=>N(e)&&e.linkKey().value()===t)))&&void 0!==i?i:null}},603676:(e,t,i)=>{"use strict";var s=i(365897).LineDataSource,r=i(976704),n=i(508547).DefaultProperty;class o extends s{constructor(e,t,s,r){super(e,t||o.createProperties(),s,r),this.version=o.version,i.e(1583).then(i.bind(i,176020)).then((({NotePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Note"}getTooltipWidth(){return o.TOOLTIP_WIDTH}getTooltipPadding(){return o.TOOLTIP_PADDING}getTooltipLineSpacing(){return o.TOOLTIP_LINESPACING}template(){var e=super.template();return e.text=this.properties().childs().text.value(),e}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static createProperties(e){void 0!==e&&void 0!==e.markerColor&&void 0===e.borderColor&&(e.borderColor=e.markerColor);var t=new n("linetoolnote",e);return this._configureProperties(t),t}state(e){var t=super.state(e);return e&&(t.state.fixedSize=!1),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,627458))).NoteDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new r(i(509806).t(null,void 0,i(37229)))),e.addExclusion("text")}}o.TOOLTIP_WIDTH=300,o.TOOLTIP_PADDING=10,o.TOOLTIP_LINESPACING=5,o.version=1;class a extends o{constructor(e,t){super(e,t||a.createProperties())}title(){return i(509806).t(null,void 0,i(366828))}name(){return"Anchored Note"}isFixed(){return!0}hasEditableCoordinates(){return!1}static createProperties(e){var t=new n("linetoolnoteabsolute",e);return this._configureProperties(t),t}}t.LineToolNote=o,t.LineToolNoteAbsolute=a},991444:(e,t,i)=>{"use strict"
;var s=i(948222).LineToolTrading,r=i(113627).LineToolPriceAxisView,n=i(458013),o=i(365897).LineDataSource,a=i(508547).DefaultProperty;const l=i(484727);var c=i(792268).sortSourcesPreOrdered.LineToolOrder;function h(e){return null==e?e="":e+="",e}class d{constructor(e){this._line=e,this._data={bodyText:"order",quantityText:"0"},this._editable=!0,this._cancellable=!0,this._mode="",this._direction="buy",this._active=!0}setMode(e){return this._mode=e,this._line.updateAllViewsAndRedraw(),this}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(),this}setActive(e){return this._active=e,this._line.updateAllViewsAndRedraw(),this}setEditable(e){return this._editable=e,this._line.updateAllViewsAndRedraw(),this}getEditable(){return this._editable}setCancellable(e){return this._cancellable=e,this._line.updateAllViewsAndRedraw(),this}getCancellable(){return this._cancellable}hasMoveCallback(){return this.isFunction(this._onMoveCallback)}hasModifyCallback(){return this.isFunction(this._onModifyCallback)}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line._points[0]=t,this._line.normalizePoints(),this._line.updateAllViewsAndRedraw()}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(),this}setTooltip(e){return this._line.properties().tooltip.setValue(h(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setModifyTooltip(e){return this._line.properties().modifyTooltip.setValue(h(e)),this}getModifyTooltip(){return this._line.properties().modifyTooltip.value()}setCancelTooltip(e){return this._line.properties().cancelTooltip.setValue(h(e)),this}getCancelTooltip(){return this._line.properties().cancelTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(),this}getExtendLeft(){var e=this._line.properties().extendLeft.value();return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}setLineLength(e){return this._line.properties().lineLength.setValue(Math.max(0,Math.min(e,100))),this}getLineColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.lineActiveBuyColor.value():e.lineInactiveBuyColor.value():this._active?e.lineActiveSellColor.value():e.lineInactiveSellColor.value()}setLineColor(e){return"buy"===this._direction?this._active?this.setLineActiveBuyColor(e):this.setLineInactiveBuyColor(e):this._active?this.setLineActiveSellColor(e):this.setLineInactiveSellColor(e),this}
setLineActiveBuyColor(e){return this._line.properties().lineActiveBuyColor.setValue(e),this}setLineInactiveBuyColor(e){return this._line.properties().lineInactiveBuyColor.setValue(e),this}setLineActiveSellColor(e){return this._line.properties().lineActiveSellColor.setValue(e),this}setLineInactiveSellColor(e){return this._line.properties().lineInactiveSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.bodyBorderActiveBuyColor.value():e.bodyBorderInactiveBuyColor.value():this._active?e.bodyBorderActiveSellColor.value():e.bodyBorderInactiveSellColor.value()}setBodyBorderColor(e){return"buy"===this._direction?this._active?this.setBodyBorderActiveBuyColor(e):this.setBodyBorderInactiveBuyColor(e):this._active?this.setBodyBorderActiveSellColor(e):this.setBodyBorderInactiveSellColor(e),this}setBodyBorderActiveBuyColor(e){return this._line.properties().bodyBorderActiveBuyColor.setValue(e),this}setBodyBorderInactiveBuyColor(e){return this._line.properties().bodyBorderInactiveBuyColor.setValue(e),this}setBodyBorderActiveSellColor(e){return this._line.properties().bodyBorderActiveSellColor.setValue(e),this}setBodyBorderInactiveSellColor(e){return this._line.properties().bodyBorderInactiveSellColor.setValue(e),this}getBodyBackgroundColor(){return n.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return n.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return"limit"===this._mode?this._active?e.bodyTextActiveLimitColor.value():e.bodyTextInactiveLimitColor.value():"stop"===this._mode?this._active?e.bodyTextActiveStopColor.value():e.bodyTextInactiveStopColor.value():"buy"===this._direction?this._active?e.bodyTextActiveBuyColor.value():e.bodyTextInactiveBuyColor.value():this._active?e.bodyTextActiveSellColor.value():e.bodyTextInactiveSellColor.value()}setBodyTextColor(e){return"limit"===this._mode?this._active?this.setBodyTextActiveLimitColor(e):this.setBodyTextInactiveLimitColor(e):"stop"===this._mode?this._active?this.setBodyTextActiveStopColor(e):this.setBodyTextInactiveStopColor(e):"buy"===this._direction?this._active?this.setBodyTextActiveBuyColor(e):this.setBodyTextInactiveBuyColor(e):this._active?this.setBodyTextActiveSellColor(e):this.setBodyTextInactiveSellColor(e),this}setBodyTextInactiveLimitColor(e){return this._line.properties().bodyTextInactiveLimitColor.setValue(e),this}
setBodyTextActiveLimitColor(e){return this._line.properties().bodyTextActiveLimitColor.setValue(e),this}setBodyTextInactiveStopColor(e){return this._line.properties().bodyTextInactiveStopColor.setValue(e),this}setBodyTextActiveStopColor(e){return this._line.properties().bodyTextActiveStopColor.setValue(e),this}setBodyTextInactiveBuyColor(e){return this._line.properties().bodyTextInactiveBuyColor.setValue(e),this}setBodyTextActiveBuyColor(e){return this._line.properties().bodyTextActiveBuyColor.setValue(e),this}setBodyTextInactiveSellColor(e){return this._line.properties().bodyTextInactiveSellColor.setValue(e),this}setBodyTextActiveSellColor(e){return this._line.properties().bodyTextActiveSellColor.setValue(e),this}getBodyFont(){return n.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){return n.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBorderActiveBuyColor.value():e.quantityBorderInactiveBuyColor.value():this._active?e.quantityBorderActiveSellColor.value():e.quantityBorderInactiveSellColor.value()}setQuantityBorderColor(e){return"buy"===this._direction?this._active?this.setQuantityBorderActiveBuyColor(e):this.setQuantityBorderInactiveBuyColor(e):this._active?this.setQuantityBorderActiveSellColor(e):this.setQuantityBorderInactiveSellColor(e),this}setQuantityBorderActiveBuyColor(e){return this._line.properties().quantityBorderActiveBuyColor.setValue(e),this}setQuantityBorderInactiveBuyColor(e){return this._line.properties().quantityBorderInactiveBuyColor.setValue(e),this}setQuantityBorderActiveSellColor(e){return this._line.properties().quantityBorderActiveSellColor.setValue(e),this}setQuantityBorderInactiveSellColor(e){return this._line.properties().quantityBorderInactiveSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBackgroundActiveBuyColor.value():e.quantityBackgroundInactiveBuyColor.value():this._active?e.quantityBackgroundActiveSellColor.value():e.quantityBackgroundInactiveSellColor.value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this._active?this.setQuantityBackgroundActiveBuyColor(e):this.setQuantityBackgroundInactiveBuyColor(e):this._active?this.setQuantityBackgroundActiveSellColor(e):this.setQuantityBackgroundInactiveSellColor(e),this}setQuantityBackgroundActiveBuyColor(e){return this._line.properties().quantityBackgroundActiveBuyColor.setValue(e),this}setQuantityBackgroundInactiveBuyColor(e){return this._line.properties().quantityBackgroundInactiveBuyColor.setValue(e),this}setQuantityBackgroundActiveSellColor(e){return this._line.properties().quantityBackgroundActiveSellColor.setValue(e),this}
setQuantityBackgroundInactiveSellColor(e){return this._line.properties().quantityBackgroundInactiveSellColor.setValue(e),this}getQuantityTextColor(){return n.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){return n.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return n.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return n.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getCancelButtonBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonBorderActiveBuyColor.value():e.cancelButtonBorderInactiveBuyColor.value():this._active?e.cancelButtonBorderActiveSellColor.value():e.cancelButtonBorderInactiveSellColor.value()}setCancelButtonBorderColor(e){return"buy"===this._direction?this._active?this.setCancelButtonBorderActiveBuyColor(e):this.setCancelButtonBorderInactiveBuyColor(e):this._active?this.setCancelButtonBorderActiveSellColor(e):this.setCancelButtonBorderInactiveSellColor(e),this}setCancelButtonBorderActiveBuyColor(e){return this._line.properties().cancelButtonBorderActiveBuyColor.setValue(e),this}setCancelButtonBorderInactiveBuyColor(e){return this._line.properties().cancelButtonBorderInactiveBuyColor.setValue(e),this}setCancelButtonBorderActiveSellColor(e){return this._line.properties().cancelButtonBorderActiveSellColor.setValue(e),this}setCancelButtonBorderInactiveSellColor(e){return this._line.properties().cancelButtonBorderInactiveSellColor.setValue(e),this}getCancelButtonBackgroundColor(){return n.getColorFromProperties(this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency)}setCancelButtonBackgroundColor(e){return n.setColorToProperties(e,this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency),this}getCancelButtonIconColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonIconActiveBuyColor.value():e.cancelButtonIconInactiveBuyColor.value():this._active?e.cancelButtonIconActiveSellColor.value():e.cancelButtonIconInactiveSellColor.value()}setCancelButtonIconColor(e){return"buy"===this._direction?this._active?this.setCancelButtonIconActiveBuyColor(e):this.setCancelButtonIconInactiveBuyColor(e):this._active?this.setCancelButtonIconActiveSellColor(e):this.setCancelButtonIconInactiveSellColor(e),this}setCancelButtonIconActiveBuyColor(e){return this._line.properties().cancelButtonIconActiveBuyColor.setValue(e),this}setCancelButtonIconInactiveBuyColor(e){return this._line.properties().cancelButtonIconInactiveBuyColor.setValue(e),this}
setCancelButtonIconActiveSellColor(e){return this._line.properties().cancelButtonIconActiveSellColor.setValue(e),this}setCancelButtonIconInactiveSellColor(e){return this._line.properties().cancelButtonIconInactiveSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw()}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw()}getBlocked(){return this._blocked}isFunction(e){return"function"==typeof e}onCancel(e,t){return t?this.isFunction(t)&&(this._onCancelData=e,this._onCancelCallback=t):this.isFunction(e)&&(this._onCancelCallback=e),this}callOnCancel(){this.isFunction(this._onCancelCallback)&&this._onCancelCallback.call(this,this._onCancelData)}isOnCancelCallbackPresent(){return this.isFunction(this._onCancelCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onMove(e,t){return t?this.isFunction(t)&&(this._onMoveData=e,this._onMoveCallback=t):this.isFunction(e)&&(this._onMoveCallback=e),this}callOnMove(){this.isFunction(this._onMoveCallback)&&this._onMoveCallback.call(this,this._onMoveData)}onContextMenu(e,t){return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class u extends s{constructor(e,t){super(e,t||u.createProperties()),this._adapter=new d(this),this.setSelectionEnabled(!0),i.e(1583).then(i.bind(i,83722)).then((({OrderPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}zorder(){return c}isSpeciallyZOrderedSource(){return!0}setPoint(e,t,i){this._points[e]=t,this.normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}name(){return"Order"}endMoving(e){var t=this._startMovingPoint&&this._currentMovingPoint&&this._startMovingPoint.logical.price!==this._currentMovingPoint.logical.price;super.endMoving(),!e&&t&&this._adapter.callOnMove()}createPriceAxisView(e){var t={pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()};return this._priceAxisView=new r(this,t),this._priceAxisView}paneViews(){return TradingView.printing&&!l.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?o.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!l.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?o.prototype.priceAxisViews.call(this,e,t):null}adapter(){return this._adapter}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){
return this._adapter.callOnContextMenu()}movable(){return Boolean(this._adapter._onMoveCallback)}static createProperties(e){var t=new a("linetoolorder",e,!1,!1);return this._configureProperties(t),t}}t.LineToolOrder=u},82639:(e,t,i)=>{"use strict";i.d(t,{LineToolParallelChannel:()=>d});var s=i(650151),r=i(86441),n=i(508547),o=i(358076),a=i(365897),l=i(486028),c=i(210596),h=i.n(c);class d extends a.LineDataSource{constructor(e,t,s,r){super(e,t||d.createProperties(),s,r),this._alertCreationAvailable=new(h())(super.alertCreationAvailable().value()&&this._isTimePointsValid()),this._priceAxisViews.push(this.createPriceAxisView(3)),this._coordOffsetWhileMovingOrChanging=null,this._pendingPriceOffset=null,i.e(1583).then(i.bind(i,723842)).then((({ParallelChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})),this._normalizedPointsChanged.subscribe(this,(()=>this._alertCreationAvailable.setValue(super.alertCreationAvailable().value()&&this._isTimePointsValid())))}alertCreationAvailable(){return this._alertCreationAvailable.readonly()}paneViews(e){return null!==this._pendingPriceOffset&&this._applyPendingPriceOffset(),super.paneViews(e)}setLastPoint(e,t){t&&t.shift()&&2===this.points().length&&this._snapPoint45Degree(e,this.points()[0]);const i=(0,l.clone)(e);return super.setLastPoint(e),i}startMoving(e,t,i,s){super.startMoving(e,t,i,s),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endMoving(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endMoving(e,t,i)}startChanging(e,t){super.startChanging(e,t),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endChanging(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endChanging(e,t,i)}restoreExternalPoints(e,t,i){const s=i?e.points:this._timePoint.map(((t,i)=>({price:t.price,offset:e.points[i].offset,time_t:e.points[i].time_t})));if(super.restoreExternalPoints({...e,points:s},t),t.pricesChanged&&this._points.length===s.length)for(let e=0;e<s.length;e++)this._points[e].price=s[e].price}restorePoints(e,t,i){super.restorePoints(e,t,i),this._alertCreationAvailable.setValue(super.alertCreationAvailable().value()&&this._isTimePointsValid())}setPoint(e,t,i,r){var n;if(this._points[0].index===this._points[1].index&&e>=4)return;this._snapPointBeforeChange(e,t,i);const a=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),l=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),c=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),h=(0,s.ensureNotNull)(this._coordOffsetWhileMovingOrChanging),d=(0,s.ensureNotNull)(this.priceScale()),u=(0,s.ensure)(null===(n=this.ownerSource())||void 0===n?void 0:n.firstValue());switch(e){case 0:super.setPoint(e,t,i),this._points[2].price=d.coordinateToPrice(c.y+h,u);break;case 1:super.setPoint(e,t,i);break;case 2:super.setPoint(e,t,i),this._points[0].price=d.coordinateToPrice(c.y-h,u),this._points[0].index=t.index;break;case 3:this._points[1].price=d.coordinateToPrice(c.y-h,u),this._points[1].index=t.index;break;case 4:{
const e=l.subtract(a),t=(c.x-a.x)/e.x,i=a.addScaled(e,t),s=c.y-i.y;this._points[2].price=d.coordinateToPrice(a.y+s,u);break}case 5:{const e=l.subtract(a),t=(c.x-a.x)/e.x,i=a.addScaled(e,t),s=c.y-i.y;this._points[0].price=d.coordinateToPrice(a.y+s,u),this._points[1].price=d.coordinateToPrice(l.y+s,u);break}}const p=this.linkKey().value();if(p&&!r&&e<4){const e=this._points.map((e=>e.price));(0,o.changeLineStyle)({model:this._model,linkKey:p,state:{prices:e}})}}state(e){const t=super.state(e);return this._pendingPriceOffset&&(t.priceOffset=this._pendingPriceOffset),t}restoreExternalState(e){const{prices:t,...i}=e;if(t&&this.isActualSymbol())for(let e=0;e<t.length;e++)this._points[e].price=this._timePoint[e].price=t[e];super.restoreExternalState(i)}restoreData(e){void 0!==e.priceOffset&&(this._pendingPriceOffset=e.priceOffset)}getPoint(e){if(e<3)return super.getPoint(e);const t=this.pointToScreenPoint(this._points[0]),i=this.pointToScreenPoint(this._points[1]),s=this.pointToScreenPoint(this._points[2]);if(!t||!i||!s)return null;switch(e){case 3:{const e=s.y-t.y,n=i.add(new r.Point(0,e));return this.screenPointToPoint(n)}case 4:{const e=s.y-t.y,n=i.add(new r.Point(0,e)),o=s.add(n).scaled(.5);return this.screenPointToPoint(o)}case 5:{const e=t.add(i).scaled(.5);return this.screenPointToPoint(e)}}return null}alignCrossHairToAnchor(e){return e<=3}pointsCount(){return 3}name(){return"Parallel Channel"}hasEditableCoordinates(){return!1}addPoint(e,t,i){const r=this.points().length;return t&&t.shift()&&2===r&&this._snapPoint45Degree(e,this.points()[0]),2===this._points.length&&(e=this._convertLastPointTo3rdPoint((0,s.ensureNotNull)(this._lastPoint))),super.addPoint(e,t)}timeAxisPoints(){return this._axisPoints()}priceAxisPoints(){return this._axisPoints()}canHasAlert(){return!0}static createProperties(e){const t=new n.DefaultProperty("linetoolparallelchannel",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,264821))).ParallelChannelDefinitionsViewModel}_getAlertPlots(){const e=this.getPoint(3);if(!e)return[];const t=[this._points[0],this._points[1],this._points[2],e],i=(e,t)=>e.index<=t.index?[e,t]:[t,e],s=i(t[0],t[1]),r=i(t[2],t[3]);let n,o,a,l;t[2].price<t[0].price?(o=r,n=s):(o=s,n=r);const c=this.properties().childs().extendLeft.value(),h=this.properties().childs().extendRight.value();return t[0].index<=t[1].index?(a=c,l=h):(a=h,l=c),[this._linePointsToAlertPlot(n,"Upper",a,l),this._linePointsToAlertPlot(o,"Lower",a,l)].filter((e=>null!==e))}_correctLastPoint(e){if(this._points.length<2||this._points[1].index===this._points[0].index)return e;const t=(0,s.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),n=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=i.subtract(n),a=(t.x-n.x)/o.x,l=n.addScaled(o,a),c=t.y-l.y,h=n.add(new r.Point(0,c));return(0,s.ensureNotNull)(this.screenPointToPoint(h))}_isTimePointsValid(){
return this._timePoint.every((e=>Number.isFinite(e.price)))}_axisPoints(){const e=this.points(),t=this._points[0]?this.pointToScreenPoint(this._points[0]):null,i=this._points[1]?this.pointToScreenPoint(this._points[1]):null,n=this._points[2]?this.pointToScreenPoint(this._points[2]):null;if(t&&i&&n){const o=i.y-t.y,a=n.add(new r.Point(0,o));e.push((0,s.ensureNotNull)(this.screenPointToPoint(a)))}return e}_convertLastPointTo3rdPoint(e){const t=(0,s.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[1])),n=(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=i.subtract(n),a=(t.x-n.x)/o.x,l=n.addScaled(o,a),c=t.y-l.y,h=n.add(new r.Point(0,c));return(0,s.ensureNotNull)(this.screenPointToPoint(h))}_findPixelsHeight(){const e=this.pointToScreenPoint(this._points[2]),t=this.pointToScreenPoint(this._points[0]);return e&&t?e.y-t.y:null}_applyPendingPriceOffset(){const e=this._pendingPriceOffset;if(null===e||this._points.length<3)return;const t=this.priceScale(),i=(0,s.ensureNotNull)(this.ownerSource()).firstValue();if(!t||t.isEmpty()||null===i)return;const r=e+this._points[0].price,n=e+this._points[1].price,o=.5*(r+n)-e,a=.5*(r+n),l=t.priceToCoordinate(o,i),c=t.priceToCoordinate(a,i)-l,h=t.priceToCoordinate(this._points[0].price,i)+c,d=t.coordinateToPrice(h,i);this._points[2].price=d,this._timePoint[2].price=d,this._points[2].index=this._points[0].index,this._timePoint[2].time_t=this._timePoint[0].time_t,this._timePoint[2].offset=this._timePoint[0].offset,this._pendingPriceOffset=null}_snapPointBeforeChange(e,t,i){if(i&&i.shift())switch(e){case 0:case 1:this._snapPoint45Degree(t,this._points[1-e]);break;case 2:case 3:const i=(0,s.ensureNotNull)(this.getPoint(5-e));this._snapPoint45Degree(t,i)}}}},478762:(e,t,i)=>{"use strict";i.d(t,{LineToolPath:()=>c});var s=i(650151),r=i(86441),n=i(508547),o=i(918922),a=i(365897),l=i(519355);class c extends a.LineDataSource{constructor(e,t,s,r){const n=t||c.createProperties();super(e,n,s,r),this._finished=!1,i.e(1583).then(i.bind(i,128596)).then((t=>{this._setPaneViews([new t.PathPaneView(this,e)])}))}pointsCount(){return-1}name(){return"Path"}hasEditableCoordinates(){return!1}finish(){this._finished=!0,this._lastPoint=null,this.normalizePoints(),this.createServerPoints()}addPoint(e,t,i){var n;if(this._finished)return!0;const a=(0,s.ensureNotNull)(this.priceScale()),l=this._model.timeScale().indexToCoordinate(e.index),c=e.price,h=(0,s.ensure)(null===(n=this.ownerSource())||void 0===n?void 0:n.firstValue()),d=a.priceToCoordinate(c,h);if(this._points.length>0){const e=this._points[this._points.length-1],i=this._model.timeScale().indexToCoordinate(e.index),s=e.price,n=a.priceToCoordinate(s,h),c=new r.Point(l,d).subtract(new r.Point(i,n)).length();if(!(null==t?void 0:t.isApiEvent())&&c<(0,o.interactionTolerance)().minDistanceBetweenPoints)return this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}static createProperties(e){const t=new n.DefaultProperty("linetoolpath",e)
;return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,787758)).then((e=>e.PathDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesWidths",new l.LineToolWidthsProperty([(0,s.ensureDefined)(e.child("lineWidth"))])),e.addChild("linesColors",new l.LineToolColorsProperty([e.childs().lineColor]))}}},710186:(e,t,i)=>{"use strict";var s=i(440097).TranslatedString,r=i(365897).LineDataSource,n=i(451215).LevelsProperty,o=i(519355),a=o.LineToolWidthsProperty,l=o.LineToolColorsProperty,c=new s("erase level line",i(509806).t(null,void 0,i(812962)));class h extends r{constructor(e,t,s,r){super(e,t||h.createProperties(),s,r),i.e(1583).then(i.bind(i,768007)).then((({PitchfanLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return h.LevelsCount}pointsCount(){return 3}name(){return"Pitchfan"}processErase(e,t){var i="level"+t,s=this.properties()[i].visible;e.setProperty(s,!1,c)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,911051))).PitchBaseDefinitionsViewModel}static createProperties(e){var t=new n("linetoolpitchfan",e,!1,{range:[0,8]});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("median").child("linewidth")],i=[e.child("median").child("color")],s=0;s<=this.LevelsCount;s++)t.push(e.child("level"+s).child("linewidth")),i.push(e.child("level"+s).child("color"));e.addChild("linesColors",new l(i)),e.addChild("linesWidths",new a(t))}}h.LevelsCount=8,t.LineToolPitchfan=h},487337:(e,t,i)=>{"use strict";var s;i.d(t,{LineToolPitchforkStyle:()=>s}),function(e){e[e.Original=0]="Original",e[e.Schiff=1]="Schiff",e[e.Inside=2]="Inside",e[e.Schiff2=3]="Schiff2"}(s||(s={}))},806788:(e,t,i)=>{"use strict";var s=i(440097).TranslatedString,r=i(365897).LineDataSource,n=i(451215).LevelsProperty,o=i(710567).Action,a=i(890255).ACTION_ID,l=i(487337).LineToolPitchforkStyle,c=null,h=i(519355),d=h.LineToolWidthsProperty,u=h.LineToolColorsProperty,p=new s("erase level line",i(509806).t(null,void 0,i(812962))),_=new s("change {title} style",i(509806).t(null,void 0,i(474428)));class m extends r{constructor(e,t,i,s){super(e,t||m.createProperties(),i,s),this._properties.style.listeners().subscribe(this,this._recreatePaneView),this._recreatePaneView()}levelsCount(){return m.LevelsCount}additionalActions(e){for(var t=[],r=[{title:i(509806).t(null,void 0,i(825595)),actionId:a.ChartLineToolPitchforkChangeTypeToOriginal},{title:i(509806).t(null,void 0,i(966276)),actionId:a.ChartLineToolPitchforkChangeTypeToModifiedSchiff},{title:i(509806).t(null,void 0,i(809114)),actionId:a.ChartLineToolPitchforkChangeTypeToInside},{title:i(509806).t(null,void 0,i(151464)),actionId:a.ChartLineToolPitchforkChangeTypeToSchiff}],n=0;n<4;n++){var l=new o({actionId:r[n].actionId,checked:this.properties().style.value()===n,checkable:!0,
label:r[n].title,payload:{target:this,value:n},onExecute:function(t){var i=t.getPayload(),r=i.target;e.setProperty(r.properties().style,i.value,_.format({title:new s(r.name(),r.title())})),r.updateAllViews(),r._model.updateSource(r)}});t.push(l)}return[t[0],t[3],t[1],t[2]]}_recreatePaneView(){if(null!==c){var e=[];this._properties.style.value()===l.Original?e=[new c.PitchforkLinePaneView(this,this._model)]:this._properties.style.value()===l.Schiff?e=[new c.SchiffPitchforkLinePaneView(this,this._model)]:this._properties.style.value()===l.Schiff2?e=[new c.SchiffPitchfork2LinePaneView(this,this._model)]:this._properties.style.value()===l.Inside&&(e=[new c.InsidePitchforkLinePaneView(this,this._model)]),this._setPaneViews(e)}else i.e(1583).then(i.bind(i,310183)).then((e=>{null===c&&(c=e),this._recreatePaneView()}))}pointsCount(){return 3}name(){return"Pitchfork"}processErase(e,t){var i="level"+t,s=this.properties()[i].visible;e.setProperty(s,!1,p)}static createProperties(e){var t=new n("linetoolpitchfork",e,!1,{range:[0,8]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,543424))).PitchForkDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);for(var t=[e.child("median").child("linewidth")],i=[e.child("median").child("color")],s=0;s<=this.LevelsCount;s++)t.push(e.child("level"+s).child("linewidth")),i.push(e.child("level"+s).child("color"));e.addChild("linesColors",new u(i)),e.addChild("linesWidths",new d(t))}}m.LevelsCount=8,t.LineToolPitchfork=m},7490:(e,t,i)=>{"use strict";i.d(t,{LineToolPolyline:()=>l});var s=i(650151),r=i(86441),n=i(508547),o=i(918922),a=i(365897);class l extends a.LineDataSource{constructor(e,t,s,r){const n=t||l.createProperties();super(e,n,s,r),this._finished=!1,i.e(1583).then(i.bind(i,250681)).then((t=>{this._setPaneViews([new t.PolylinePaneView(this,e)])}))}pointsCount(){return-1}name(){return"Polyline"}hasEditableCoordinates(){return!1}finish(){this._finished=!0,this._lastPoint=null,this.normalizePoints(),this.createServerPoints()}addPoint(e,t,i){var n;if(this._finished)return!0;const a=(0,s.ensureNotNull)(this.priceScale()),l=this._model.timeScale().indexToCoordinate(e.index),c=e.price,h=(0,s.ensure)(null===(n=this.ownerSource())||void 0===n?void 0:n.firstValue()),d=a.priceToCoordinate(c,h),u=(0,o.interactionTolerance)().minDistanceBetweenPoints;if(this._points.length>0){const e=this._points[this._points.length-1],i=this._model.timeScale().indexToCoordinate(e.index),s=e.price,n=a.priceToCoordinate(s,h),o=new r.Point(l,d).subtract(new r.Point(i,n)).length();if(!(null==t?void 0:t.isApiEvent())&&o<u)return this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0;const c=this._points[0],p=this._model.timeScale().indexToCoordinate(c.index),_=a.priceToCoordinate(c.price,h),m=new r.Point(l,d).subtract(new r.Point(p,_)).length();if(!(null==t?void 0:t.isApiEvent())&&m<u)return this.properties().childs().filled.setValue(!0),
this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}setPoint(e,t,i){var n;super.setPoint(e,t,i);const a=this.priceScale();if(!(this._model.timeScale().isEmpty()||null===a||a.isEmpty()||e!==this._points.length-1&&0!==e)){const i=(0,s.ensure)(null===(n=this.ownerSource())||void 0===n?void 0:n.firstValue()),l=this._model.timeScale().indexToCoordinate(t.index),c=a.priceToCoordinate(t.price,i),h=e===this._points.length-1?this._points[0]:this._points[this._points.length-1],d=this._model.timeScale().indexToCoordinate(h.index),u=a.priceToCoordinate(h.price,i);new r.Point(l,c).subtract(new r.Point(d,u)).length()<(0,o.interactionTolerance)().minDistanceBetweenPoints&&this.properties().childs().filled.setValue(!0)}}static createProperties(e){const t=new n.DefaultProperty("linetoolpolyline",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,240776)).then((e=>e.PolylinesDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addExclusion("filled")}}},236214:(e,t,i)=>{"use strict";i.d(t,{PositionAveragePriceAxisView:()=>r});var s=i(113627);class r extends s.LineToolPriceAxisView{_formatPrice(e,t){return this._source.formatter().format(e)}}},564571:(e,t,i)=>{"use strict";var s=i(948222).LineToolTrading,r=i(365897).LineDataSource,n=i(236214).PositionAveragePriceAxisView,o=i(458013),a=i(508547).DefaultProperty,l=i(821737).PriceFormatter;const c=i(484727);var h=i(792268).sortSourcesPreOrdered.LineToolPosition;function d(e){return null==e?e="":e+="",e}class u{constructor(e){this._line=e,this._data={bodyText:"position",quantityText:"0"},this._closeEnabled=!0,this._direction="buy",this._profitState="neutral"}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(),this}setProfitState(e){return this._profitState=e,this._line.updateAllViewsAndRedraw(),this}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line._points[0]=t,this._line.normalizePoints(),this._line.updateAllViewsAndRedraw()}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(),this}setTooltip(e){return this._line.properties().tooltip.setValue(d(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setProtectTooltip(e){return this._line.properties().protectTooltip.setValue(d(e)),this}getProtectTooltip(){return this._line.properties().protectTooltip.value()}setCloseTooltip(e){return this._line.properties().closeTooltip.setValue(d(e)),this}getCloseTooltip(){return this._line.properties().closeTooltip.value()}setReverseTooltip(e){return this._line.properties().reverseTooltip.setValue(d(e)),this}getReverseTooltip(){
return this._line.properties().reverseTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(),this}getExtendLeft(){var e=this._line.properties().extendLeft.value();return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}setLineLength(e){return this._line.properties().lineLength.setValue(Math.max(0,Math.min(e,100))),this}getLineColor(){var e=this._line.properties();return("buy"===this._direction?e.lineBuyColor:e.lineSellColor).value()}setLineColor(e){return"buy"===this._direction?this.setLineBuyColor(e):this.setLineSellColor(e),this}setLineBuyColor(e){return this._line.properties().lineBuyColor.setValue(e),this}setLineSellColor(e){return this._line.properties().lineSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.bodyBorderBuyColor:e.bodyBorderSellColor).value()}setBodyBorderColor(e){return"buy"===this._direction?this.setBodyBorderBuyColor(e):this.setBodyBorderSellColor(e),this}setBodyBorderBuyColor(e){return this._line.properties().bodyBorderBuyColor.setValue(e),this}setBodyBorderSellColor(e){return this._line.properties().bodyBorderSellColor.setValue(e),this}getBodyBackgroundColor(){return o.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return("positive"===this._profitState?e.bodyTextPositiveColor:"negative"===this._profitState?e.bodyTextNegativeColor:e.bodyTextNeutralColor).value()}setBodyTextColor(e){return"positive"===this._profitState?this.setBodyTextPositiveColor(e):"negative"===this._profitState?this.setBodyTextNegativeColor(e):this.setBodyTextNeutralColor(e),this}setBodyTextPositiveColor(e){return this._line.properties().bodyTextPositiveColor.setValue(e),this}setBodyTextNegativeColor(e){return this._line.properties().bodyTextNegativeColor.setValue(e),this}setBodyTextNeutralColor(e){return this._line.properties().bodyTextNeutralColor.setValue(e),this}getBodyFont(){
return o.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){return o.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBorderBuyColor:e.quantityBorderSellColor).value()}setQuantityBorderColor(e){return"buy"===this._direction?this.setQuantityBorderBuyColor(e):this.setQuantityBorderSellColor(e),this}setQuantityBorderBuyColor(e){return this._line.properties().quantityBorderBuyColor.setValue(e),this}setQuantityBorderSellColor(e){return this._line.properties().quantityBorderSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBackgroundBuyColor:e.quantityBackgroundSellColor).value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this.setQuantityBackgroundBuyColor(e):this.setQuantityBackgroundSellColor(e),this}setQuantityBackgroundBuyColor(e){return this._line.properties().quantityBackgroundBuyColor.setValue(e),this}setQuantityBackgroundSellColor(e){return this._line.properties().quantityBackgroundSellColor.setValue(e),this}getQuantityTextColor(){return o.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){return o.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return o.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return o.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getReverseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonBorderBuyColor:e.reverseButtonBorderSellColor).value()}setReverseButtonBorderColor(e){return"buy"===this._direction?this.setReverseButtonBorderBuyColor(e):this.setReverseButtonBorderSellColor(e),this}setReverseButtonBorderBuyColor(e){return this._line.properties().reverseButtonBorderBuyColor.setValue(e),this}setReverseButtonBorderSellColor(e){return this._line.properties().reverseButtonBorderSellColor.setValue(e),this}getReverseButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency)}setReverseButtonBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency),this}getReverseButtonIconColor(){
var e=this._line.properties();return("buy"===this._direction?e.reverseButtonIconBuyColor:e.reverseButtonIconSellColor).value()}setReverseButtonIconColor(e){return"buy"===this._direction?this.setReverseButtonIconBuyColor(e):this.setReverseButtonIconSellColor(e),this}setReverseButtonIconBuyColor(e){return this._line.properties().reverseButtonIconBuyColor.setValue(e),this}setReverseButtonIconSellColor(e){return this._line.properties().reverseButtonIconSellColor.setValue(e),this}getCloseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonBorderBuyColor:e.closeButtonBorderSellColor).value()}setCloseButtonBorderColor(e){return"buy"===this._direction?this.setCloseButtonBorderBuyColor(e):this.setCloseButtonBorderSellColor(e),this}setCloseButtonBorderBuyColor(e){return this._line.properties().closeButtonBorderBuyColor.setValue(e),this}setCloseButtonBorderSellColor(e){return this._line.properties().closeButtonBorderSellColor.setValue(e),this}getCloseButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency)}setCloseButtonBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency),this}getCloseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonIconBuyColor:e.closeButtonIconSellColor).value()}setCloseButtonIconColor(e){return"buy"===this._direction?this.setCloseButtonIconBuyColor(e):this.setCloseButtonIconSellColor(e),this}setCloseButtonIconBuyColor(e){return this._line.properties().closeButtonIconBuyColor.setValue(e),this}setCloseButtonIconSellColor(e){return this._line.properties().closeButtonIconSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw()}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw()}isFunction(e){return"function"==typeof e}onReverse(e,t){return t?this.isFunction(t)&&(this._onReverseData=e,this._onReverseCallback=t):this.isFunction(e)&&(this._onReverseCallback=e),this}callOnReverse(){this.isFunction(this._onReverseCallback)&&this._onReverseCallback.call(this,this._onReverseData)}isOnReverseCallbackPresent(){return this.isFunction(this._onReverseCallback)}onClose(e,t){return t?this.isFunction(t)&&(this._onCloseData=e,this._onCloseCallback=t):this.isFunction(e)&&(this._onCloseCallback=e),this}setCloseEnabled(e){return this._closeEnabled===e||(this._closeEnabled=e,this._onCloseCallback&&this._line.updateAllViewsAndRedraw()),this}isCloseEnabled(){return this._closeEnabled}callOnClose(){this.isFunction(this._onCloseCallback)&&this._closeEnabled&&this._onCloseCallback.call(this,this._onCloseData)}isOnCloseCallbackPresent(){return this._closeEnabled&&this.isFunction(this._onCloseCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){
this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onContextMenu(e,t){return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class p extends s{constructor(e,t){super(e,t||p.createProperties()),this._adapter=new u(this),i.e(1583).then(i.t.bind(i,181367,19)).then((({PositionPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}));var s=e.mainSeries().symbolInfo(),r=null!==s?s.pricescale:100,n=null!==s&&s.fractional?s.minmov:1,o=null!==s&&s.fractional,a=null!==s?s.minmove2:void 0;this._formatter=new l(r,n,o,a)}zorder(){return h}isSpeciallyZOrderedSource(){return!0}setPoint(e,t,i){this._points[e]=t,this.normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}name(){return"Position"}createPriceAxisView(e){return this._priceAxisView=new n(this,{pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()}),this._priceAxisView}paneViews(){return TradingView.printing&&!c.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?r.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!c.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?r.prototype.priceAxisViews.call(this,e,t):null}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}formatter(){return this._formatter}static createProperties(e){var t=new a("linetoolposition",e,!1,!1);return this._configureProperties(t),t}}t.LineToolPosition=p},44674:(e,t,i)=>{"use strict";var s,r;i.r(t),i.d(t,{AlertStatus:()=>s,Direction:()=>r}),function(e){e[e.Waiting=0]="Waiting",e[e.Success=1]="Success",e[e.Failure=2]="Failure"}(s||(s={})),function(e){e[e.Up=1]="Up",e[e.Down=2]="Down"}(r||(r={}))},830860:(e,t,i)=>{"use strict";var s=i(650151).ensureNotNull,r=i(365897).LineDataSource,n=i(508547).DefaultProperty,o=i(44674);class a extends r{constructor(e,t,s,r){super(e,t||a.createProperties(),s,r),this._predictionPaneView=null;const n=this._model.mainSeries();n.properties().interval.subscribe(this,(()=>{this.setStatus(o.AlertStatus.Waiting)})),n.dataEvents().dataUpdated().subscribe(this,this.recalculateStateByData),i.e(1583).then(i.t.bind(i,68567,19)).then((({PredictionPaneView:e})=>{this._predictionPaneView=new e(this,this._model),this._setPaneViews([this._predictionPaneView])}))}destroy(){const e=this._model.mainSeries();e.properties().interval.unsubscribeAll(this),e.dataEvents().dataUpdated().unsubscribeAll(this),super.destroy()}dataAndViewsReady(){
return super.dataAndViewsReady()&&this._predictionPaneView&&this._predictionPaneView.iconsReady()}isSynchronizable(){return!1}status(){return this._properties.status.value()}setStatus(e){return this._properties.status.setValue(e)}pointsCount(){return 2}name(){return"Forecast"}restorePoints(e,t,i){super.restorePoints(e,t,i),this.recalculateStateByData()}recalculateStateByData(){if(!this.isSourceHidden()&&!(this._points.length<2||this._model.mainSeries().bars().isEmpty())){var e=this._points[1];if(this.status())e.index>this._model.timeScale().baseIndex()&&this.setStatus(o.AlertStatus.Waiting);else{var t=this._model.mainSeries().bars().valueAt(e.index);if(null!==t){var i=this.direction();if(i===o.Direction.Up&&t[TradingView.HIGH_PLOT]>=e.price)this.setStatus(o.AlertStatus.Success);else if(i===o.Direction.Down&&t[TradingView.LOW_PLOT]<=e.price)this.setStatus(o.AlertStatus.Success);else{var r=s(this._model.mainSeries().bars().lastIndex());e.index!==r&&this.setStatus(o.AlertStatus.Failure)}}}}}addPoint(e){var t=super.addPoint(e);return t&&this.recalculateStateByData(),t}endChanging(){super.endChanging(),this.setStatus(o.AlertStatus.Waiting),this.recalculateStateByData()}onData(e){super.onData(e),this.recalculateStateByData()}endMoving(e,t,i){super.endMoving(e,t,i),this.setStatus(o.AlertStatus.Waiting),this.recalculateStateByData()}direction(){if(this.points().length<2)return o.Direction.Up;var e=this.points()[0];return this.points()[1].price>e.price?o.Direction.Up:o.Direction.Down}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,989969))).PredictionDefinitionsViewModel}cloneable(){return!1}static createProperties(e){var t=new n("linetoolprediction",e);return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.merge({status:o.AlertStatus.Waiting})}}t.LineToolPrediction=a},136111:(e,t,i)=>{"use strict";var s=i(365897).LineDataSource,r=i(508547).DefaultProperty,n=i(519355).LineToolColorsProperty;class o extends s{constructor(e,t,s,r){super(e,t||o.createProperties(),s,r),i.e(1583).then(i.t.bind(i,102801,19)).then((({PriceLabelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Price Label"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,490523))).PriceLabelDefinitionsViewModel}static createProperties(e){var t=new r("linetoolpricelabel",e);return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n([e.childs().borderColor])),e.addChild("textsColors",new n([e.childs().color]))}}t.LineToolPriceLabel=o},4718:(e,t,i)=>{"use strict";i.d(t,{LineToolPriceNote:()=>c});var s=i(650151),r=i(508547),n=i(976704),o=i.n(n),a=i(365897),l=i(744687);class c extends a.LineDataSource{constructor(e,t,s,r){super(e,t||c.createProperties(),s,r),this._labelMovingDelta=null,i.e(1583).then(i.bind(i,774094)).then((t=>{
this._setPaneViews([new t.PriceNotePaneView(this,e)])}))}pointsCount(){return 2}name(){return"Price Note"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}startMoving(e,t,i){if(1===t){if(this.isSourceHidden())return;const i=(0,s.ensureDefined)(e.logical),r=this.points()[1];this._labelMovingDelta={index:r.index-i.index,price:r.price-i.price},this.startChanging(t,i)}else this._labelMovingDelta=null,super.startMoving(e,t,i)}move(e,t,i){if(null!==this._labelMovingDelta){const t=(0,s.ensureDefined)(e.logical),r={index:t.index+this._labelMovingDelta.index,price:t.price+this._labelMovingDelta.price};this.setPoint(1,r,i),this.updateAllViews((0,l.sourceChangeEvent)(this.id()))}else super.move(e,t,i)}endMoving(e,t,i){return null!==this._labelMovingDelta?(this._labelMovingDelta=null,this.endChanging(!1,e)):super.endMoving(e,t,i)}static createProperties(e){const t=new r.DefaultProperty("linetoolpricenote",e);return this._configureProperties(t),t}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,608622)).then((e=>e.PriceNoteDefinitionsViewModel))}_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(o())("")),e.addExclusion("text"),e.hasChild("backgroundsColors")&&e.removeProperty("backgroundsColors"),e.hasChild("textsColors")&&e.removeProperty("textsColors")}}},225745:(e,t,i)=>{"use strict";i.d(t,{LineToolPriceRange:()=>p});var s=i(365897),r=i(650151),n=i(111982),o=i(940092),a=i(737731);const l={...a.nonThemedFactoryDefaultsBase,extendLeft:!1,extendRight:!1},c=a.themedFactoryDefaultsBase,h=(0,o.extractAllPropertiesKeys)((0,r.ensureDefined)(c.get(n.StdTheme.Light))),d=(0,o.extractAllPropertiesKeys)(l);class u extends a.DateAndPriceBaseProperties{static create(e){return new this("linetoolpricerange",(()=>(0,o.factoryDefaultsForCurrentTheme)(l,c)),d,h,e)}}class p extends s.LineDataSource{constructor(e,t,s,r){super(e,t||p.createProperties(),s,r),i.e(1583).then(i.bind(i,295285)).then((e=>{this._setPaneViews([new e.PriceRangePaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Price Range"}static createProperties(e){const t=u.create(e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,477316))).GeneralDatePriceRangeDefinitionsViewModel}}},859782:(e,t,i)=>{"use strict";var s=i(451215).LevelsProperty,r=i(762250).LineToolFibWedgeBase,n=i(519355).LineToolColorsProperty;class o extends r{constructor(e,t,s,r){super(e,t||o.createProperties(),s,r),i.e(1583).then(i.t.bind(i,555458,19)).then((({ProjectionLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 1}name(){return"Projection"}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,780585))).ProjectionDefinitionsViewModel}static createProperties(e){var t=new s("linetoolprojection",e,!1,{range:[1,1]});return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n([e.trendline.color]))}}t.LineToolProjection=o},407838:(e,t,i)=>{"use strict";var s=i(620164).LineToolTrendLine,r=i(508547).DefaultProperty;class n extends s{constructor(e,t,i,s){super(e,t||n.createProperties(),i,s)}name(){return"Ray"}static createProperties(e){var t=new r("linetoolray",e);return this._configureProperties(t),t}}t.LineToolRay=n},902846:(e,t,i)=>{"use strict";i.d(t,{LineToolRectangle:()=>h});var s=i(86441),r=i(508547),n=i(976704),o=i.n(n),a=i(365897),l=i(519355),c=i(650151);class h extends a.LineDataSource{constructor(e,t,s,r){const n=t||h.createProperties();super(e,n,s,r),i.e(1583).then(i.bind(i,724366)).then((({RectanglePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}pointsCount(){return 2}textColorsProperty(){return this.properties().childs().showLabel.value()?super.textColorsProperty():null}name(){return"Rectangle"}setPoint(e,t,i){if(e<2&&super.setPoint(e,t,i),i&&i.shift()){const i=this._getAnchorPointForIndex(e);if(e>=4)return this._correctMiddlePoints(e,t,i),void this.normalizePoints();this._snapPoint45Degree(t,i)}switch(e){case 2:this._points[1].price=t.price,this._points[0].index=t.index;break;case 3:this._points[0].price=t.price,this._points[1].index=t.index;break;case 4:this._points[0].index=t.index;break;case 5:this._points[1].index=t.index;break;case 6:this._points[0].price=t.price;break;case 7:this._points[1].price=t.price}this.normalizePoints()}getPoint(e){return e<2?super.getPoint(e):this._getAnchorPointForIndex(e)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e){const t=new r.DefaultProperty("linetoolrectangle",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,347746)).then((e=>e.RectangleDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_snapPoint45Degree(e,t,i){const s=this.m_priceScale,r=this.ownerSource();if(null===s||null===r)return;const n=r.firstValue();if(null===n)return;const o=this._model.timeScale(),a=(0,c.ensureNotNull)(this.pointToScreenPoint(e)),l=(0,c.ensureNotNull)(this.pointToScreenPoint(t)),h=a.x-l.x,d=a.y-l.y,u=h<0?-1:1,p=d<0?-1:1,_=Math.max(Math.abs(h),Math.abs(d)),m=Math.round(o.coordinateToIndex(l.x+_*u)),g=Math.abs(o.indexToCoordinate(m)-l.x),f=s.coordinateToPrice(l.y+g*p,n);e.index=m,e.price=f}_correctMiddlePoints(e,t,i){e<6?this._correctRightLeftMiddlePoint(e,t,i):this._correctTopBottomMiddlePoint(e,t,i)}_correctRightLeftMiddlePoint(e,t,i){const r=(0,c.ensureNotNull)(this.pointToScreenPoint(t)),n=(0,c.ensureNotNull)(this.pointToScreenPoint(i)),o=(0,
c.ensureNotNull)(this.pointToScreenPoint(this._points[0])),a=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let l=r.x-n.x;if(0===l)return;const h=o.x<a.x?1:-1,d=o.y<a.y?1:-1;switch(l*=h,e){case 4:{const e=a.y-d*l/2,t=(0,c.ensureNotNull)(this.screenPointToPoint(new s.Point(a.x,e)));this._points[1].price=t.price;const i=(0,c.ensureNotNull)(this.screenPointToPoint(new s.Point(o.x+h*l,o.y+d*l/2)));this._points[0].price=i.price,this._points[0].index=i.index;break}case 5:{const e=o.y-d*l/2,t=(0,c.ensureNotNull)(this.screenPointToPoint(new s.Point(o.x,e)));this._points[0].price=t.price;const i=(0,c.ensureNotNull)(this.screenPointToPoint(new s.Point(a.x+h*l,a.y+d*l/2)));this._points[1].price=i.price,this._points[1].index=i.index;break}}}_correctTopBottomMiddlePoint(e,t,i){const r=this.m_priceScale,n=this.ownerSource();if(null===r||null===n)return;const o=this._model.timeScale(),a=n.firstValue();if(null===a)return;const l=(0,c.ensureNotNull)(this.pointToScreenPoint(t)),h=(0,c.ensureNotNull)(this.pointToScreenPoint(i)),d=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[0])),u=(0,c.ensureNotNull)(this.pointToScreenPoint(this._points[1])),p=l.y-h.y,_=p<0?-1:1,m=d.x<u.x?1:-1,g=d.y<u.y?1:-1;switch(e){case 6:{const e=Math.floor(u.x-m*p/2),t=(0,c.ensureNotNull)(this.screenPointToPoint(new s.Point(e,u.y))),i=Math.abs(this._points[1].index-t.index),n=m*g*_*Math.ceil(i/2);if(0===n)return;this._points[1].index=this._points[1].index-n;const l=_*Math.abs(o.indexToCoordinate(this._points[1].index)-u.x);this._points[0].price=r.coordinateToPrice(d.y+l,a),this._points[0].index=this._points[0].index+n;break}case 7:{const e=Math.floor(d.x-m*p/2),t=(0,c.ensureNotNull)(this.screenPointToPoint(new s.Point(e,d.y))),i=Math.abs(this._points[0].index-t.index),n=m*g*_*Math.ceil(i/2);if(0===n)return;this._points[0].index=this._points[0].index-n;const l=_*Math.abs(o.indexToCoordinate(this._points[0].index)-d.x);this._points[1].price=r.coordinateToPrice(u.y+l,a),this._points[1].index=this._points[1].index+n;break}}}_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(o())("")),e.addChild("linesColors",new l.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new l.LineToolColorsProperty([e.childs().textColor],e.childs().showLabel)),e.addExclusion("text"),e.addExclusion("linesColors"),e.addExclusion("textsColors")}_getAnchorPointForIndex(e){const t=this.points(),i=t[0],s=t[1];let r=0,n=0;switch(e){case 0:r=i.price,n=i.index;break;case 1:r=s.price,n=s.index;break;case 2:r=s.price,n=i.index;break;case 3:r=i.price,n=s.index;break;case 4:r=(s.price+i.price)/2,n=i.index;break;case 5:r=(s.price+i.price)/2,n=s.index;break;case 6:r=i.price,n=(s.index+i.index)/2;break;case 7:r=s.price,n=(s.index+i.index)/2}return{index:n,price:r}}}},817946:(e,t,i)=>{"use strict";i.d(t,{LineToolRiskRewardBase:()=>S});var s=i(650151),r=i(66568),n=i(153026),o=i(786432),a=i(365897),l=i(226376),c=i(384125),h=i(672428),d=i(602564);class u extends h.PriceAxisView{
constructor(e,t){super(),this._source=e,this._data=t}_updateRendererData(e,t,i){if(e.visible=!1,!this._showAxisLabel())return;const s=this._source.priceScale();if(0===this._source.points().length||null===s||s.isEmpty())return;const r=this._source.ownerSource(),n=null!==r?r.firstValue():null;if(null===n)return;const o=this._data.priceProperty.value(),a=(0,d.resetTransparency)(this._data.colorProperty.value());i.background=a,i.textColor=this.generateTextColor(a),i.coordinate=s.priceToCoordinate(o,n),e.text=s.formatPrice(o,n),e.visible=!0}_showAxisLabel(){return this._source.properties().childs().showPriceLabels.value()}}var p=i(976704),_=i.n(p);class m extends(_()){constructor(e,t){super(),this._lineSource=e,this._pointIndex=t}value(){const e=this._lineSource.points()[this._pointIndex].price;return this._formatAndParsePrice(e)}state(){return this.value()}merge(e,t){return this.setValue(e),t?[]:null}_formatAndParsePrice(e){const t=(0,s.ensureNotNull)(this._lineSource.ownerSource()).formatter();if(t.parse){const i=t.format(e),s=t.parse(i);return s.res?s.value:e}return e}}class g extends m{constructor(e){super(e,0)}setValue(e){const t=this._lineSource.points()[this._pointIndex];this._lineSource.startChanging(this._pointIndex,t),t.price=parseFloat(""+e),this._lineSource.setPoint(this._pointIndex,t),this._lineSource.recalculate(),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this),this._lineSource.endChanging(!1,!1),this._lineSource.syncPriceLevels()}}class f extends m{constructor(e){super(e,1)}value(){const e=this._lineSource.stopPrice();return this._formatAndParsePrice(e)}setValue(e){const t=Math.round(Math.abs(e-this._lineSource.entryPrice())*this._lineSource.ownerSourceBase());this._lineSource.properties().childs().stopLevel.setValue(t),this._lineSource.syncPriceLevels()}}class v extends m{constructor(e){super(e,2)}value(){const e=this._lineSource.profitPrice();return this._formatAndParsePrice(e)}setValue(e){const t=Math.round(Math.abs(e-this._lineSource.entryPrice())*this._lineSource.ownerSourceBase());this._lineSource.properties().childs().profitLevel.setValue(t),this._lineSource.syncPriceLevels()}}class S extends a.LineDataSource{constructor(e,t,n,a){super(e,t,n,a),this._syncStateExclusions=["points","entryPrice","stopPrice","targetPrice","stopLevel","profitLevel","riskSize","qty","amountTarget","amountStop"],t.hasChild("stopLevel")||t.hasChild("profitLevel")||(t.addProperty("stopLevel",0),t.addProperty("profitLevel",0),this.ownerSourceChanged().subscribe(this,(()=>{const i=(0,s.ensureNotNull)(e.timeScale().visibleBarsStrictRange()),r=i.firstBar(),n=i.lastBar(),a=(0,s.ensureNotNull)(this.ownerSource()),l=a.priceScale();let c=(0,s.ensureNotNull)(a.priceRange(r,n));if(l&&l.isLog()){const e=l.logicalToPrice(c.minValue()),t=l.logicalToPrice(c.maxValue());c=new o.PriceRange(e,t)}if(c&&!c.isEmpty()){const e=Math.round(.2*c.length()*this.ownerSourceBase());t.merge({stopLevel:e,profitLevel:e})}}),!0)),t.childs().stopLevel.listeners().subscribe(this,this.recalculate),
t.childs().stopLevel.listeners().subscribe(null,(()=>{this.properties().childs().stopPrice.childChanged(null)})),t.childs().profitLevel.listeners().subscribe(this,this.recalculate),t.childs().profitLevel.listeners().subscribe(null,(()=>{this.properties().childs().targetPrice.childChanged(null)})),t.addChild("entryPrice",new g(this)),t.addChild("stopPrice",new f(this)),t.addChild("targetPrice",new v(this)),t.hasChild("riskSize")||t.addProperty("riskSize",0),t.hasChild("qty")||t.addProperty("qty",0),t.hasChild("amountTarget")||t.addProperty("amountTarget",t.childs().accountSize.value()),t.hasChild("amountStop")||t.addProperty("amountStop",t.childs().accountSize.value()),t.addExclusion("riskSize"),t.addExclusion("qty"),t.addExclusion("amountTarget"),t.addExclusion("amountStop"),this._riskInPercentsFormatter=new r.NumericFormatter(2),this._riskInMoneyFormatter=new r.NumericFormatter,t.childs().risk.subscribe(this,this._recalculateRiskSize),t.childs().accountSize.subscribe(this,this._recalculateRiskSize),t.childs().riskDisplayMode.subscribe(this,this._recalculateRisk),t.childs().riskDisplayMode.subscribe(this,this._recalculateRiskSize),t.childs().entryPrice.subscribe(this,this._recalculateRiskSize),t.childs().stopPrice.subscribe(this,this._recalculateRiskSize),t.childs().profitLevel.subscribe(this,this._recalculateRiskSize),t.childs().profitLevel.subscribe(this,this.syncPriceLevels.bind(this)),t.childs().stopLevel.subscribe(this,this._recalculateRiskSize),t.childs().stopLevel.subscribe(this,this.syncPriceLevels.bind(this)),t.childs().qty.subscribe(this,this._recalculateRiskSize),this.ownerSourceChanged().subscribe(null,((e,t)=>{e&&e.barsProvider().dataUpdated().unsubscribeAll(this),t&&t.barsProvider().dataUpdated().subscribe(this,this._onSeriesUpdated)})),this.pointAdded().subscribe(this,(e=>{switch(e){case c.RiskRewardPointIndex.Entry:case c.RiskRewardPointIndex.Close:this._recalculateRiskSize(),this._recalculateQty()}})),this.pointChanged().subscribe(this,(e=>{switch(e){case c.RiskRewardPointIndex.Entry:case c.RiskRewardPointIndex.Close:this._recalculateRiskSize(),this._recalculateQty()}})),t.childs().riskDisplayMode.value()===l.RiskDisplayMode.Percentage&&t.childs().risk.value()>100&&t.childs().riskDisplayMode.setValueSilently(l.RiskDisplayMode.Money),this.version=2,this._entryPriceAxisView=new u(this,{colorProperty:t.childs().linecolor,priceProperty:t.childs().entryPrice}),this._stopPriceAxisView=new u(this,{colorProperty:t.childs().stopBackground,priceProperty:t.childs().stopPrice}),this._profitPriceAxisView=new u(this,{colorProperty:t.childs().profitBackground,priceProperty:t.childs().targetPrice}),i.e(1583).then(i.bind(i,931631)).then((({RiskRewardPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}destroy(){var e;null===(e=this.ownerSource())||void 0===e||e.barsProvider().dataUpdated().unsubscribeAll(this),this.ownerSourceChanged().unsubscribeAll(this),super.destroy()}recalculateStateByData(){this.recalculate()}calculatePL(e){return this.entryPrice()-e}lastBarData(){var e
;const t=null===(e=this.ownerSource())||void 0===e?void 0:e.barsProvider();if(!t)return null;const i=t.bars().firstIndex(),r=t.bars().lastIndex();if(null===i||null===r||isNaN(i)||isNaN(r))return null;const o=this.points();if(4===o.length){const e=o[c.RiskRewardPointIndex.ActualClose];return e.index<i?null:{closePrice:e.price,index:Math.min(r,e.index)}}const a=o[c.RiskRewardPointIndex.Close];if(a.index<i)return null;const l=Math.min(r,a.index),h=t.bars().search(l,n.PlotRowSearchMode.NearestLeft);return null===h?null:{closePrice:(0,s.ensure)(h.value[4]),index:h.index}}ownerSourceBase(){var e;const t=null===(e=this.ownerSource())||void 0===e?void 0:e.symbolSource().symbolInfo();return t?t.pricescale/t.minmov:100}_ownerSourcePointValue(){var e,t,i;return null!==(i=null===(t=null===(e=this.ownerSource())||void 0===e?void 0:e.symbolSource().symbolInfo())||void 0===t?void 0:t.pointvalue)&&void 0!==i?i:1}_onSeriesUpdated(e,t,i){this.isSourceHidden()||this._points.length<2||null!==i&&i.index>Math.max(this._points[0].index,this._points[1].index)||this.recalculateStateByData()}}},226376:(e,t,i)=>{"use strict";var s;i.d(t,{RiskDisplayMode:()=>s}),function(e){e.Percentage="percents",e.Money="money"}(s||(s={}))},384125:(e,t,i)=>{"use strict";var s;i.d(t,{RiskRewardPointIndex:()=>s}),function(e){e[e.Entry=0]="Entry",e[e.Close=1]="Close",e[e.ActualEntry=2]="ActualEntry",e[e.ActualClose=3]="ActualClose"}(s||(s={}))},727084:(e,t,i)=>{"use strict";var s=i(650151).ensureNotNull,r=i(365897).LineDataSource,n=i(358076),o=i(508547).DefaultProperty,a=i(384125).RiskRewardPointIndex,l=i(226376).RiskDisplayMode,c=i(817946).LineToolRiskRewardBase,h=i(486028).isNumber,d=i(122621),u=d.SIDE,p=d.ORDERTYPE;class _ extends c{riskFormatter(e){return e===l.Percentage?this._riskInPercentsFormatter:this._riskInMoneyFormatter}getRiskStep(e){return e===l.Percentage?.01:1}_roundValue(e){return parseFloat(e.toFixed(2))}hasEditableCoordinates(){return!1}_recalculateRisk(){var e=this.properties(),t=e.riskDisplayMode.value(),i=e.riskSize.value(),s=e.accountSize.value(),r=e.risk.value();r=t===l.Percentage?this._roundValue(i/s*100):this._roundValue(s/100*r),this._riskInChange=!0,e.risk.setValue(this.riskFormatter(t).format(r)),this._riskInChange=!1}_recalculateRiskSize(){if(!this._riskInChange){var e=this.properties(),t=e.risk.value(),i=e.riskDisplayMode.value(),s=e.accountSize.value();i===l.Percentage?e.riskSize.setValue(t/100*s):t>s?(e.risk.setValue(s),e.riskSize.setValue(s)):e.riskSize.setValue(t)}}migrateVersion(e,t,i){if(1===e&&this._points.length>=1){var s=[];if(s.push(this._points[0]),n={price:(n=this._points[0]).price,index:this._getClosePointIndex(n.index)},s.push(n),this._points[1]&&s.push(this._points[1]),this._points[2]&&s.push(this._points[2]),this._points=s,this._timePoint.length>=1){var r=[],n=this._timePoint[0];r.push(n);var o={price:n.price,time_t:n.time_t,offset:this._getClosePointIndex(n.offset)};r.push(o),this._timePoint[1]&&s.push(this._points[1]),this._timePoint[2]&&s.push(this._points[2]),this._timePoint=r}}}priceAxisViews(e,t){
return this.isSourceHidden()||t!==this.priceScale()||this._model.paneForSource(this)!==e?null:[this._entryPriceAxisView,this._stopPriceAxisView,this._profitPriceAxisView]}updateAllViews(){this.isActualSymbol()&&this._properties.visible.value()&&(n.hideAllDrawings().value()&&this.userEditEnabled()||(super.updateAllViews(),this._entryPriceAxisView.update(),this._stopPriceAxisView.update(),this._profitPriceAxisView.update()))}restoreExternalState(e){if(h(e.entryPrice)){if(e=Object.assign({},e),!this.isActualSymbol())this._timePoint[0].price=e.entryPrice,delete e.entryPrice;this.properties().merge(e)}else super.restoreExternalState(e)}_changeEntryPoint(e){var t=this.properties().stopPrice.value(),i=this.properties().targetPrice.value(),s=1/this.ownerSourceBase(),r=Math.min(t,i)+s,n=Math.max(t,i)-s;e.price=Math.max(r,Math.min(n,this._roundPrice(e.price))),super.setPoint(0,e),this.properties().stopPrice.setValue(t),this.properties().targetPrice.setValue(i)}setPoint(e,t,i){if(this.isActualSymbol()){switch(this._muteSyncLineStyle(),e){case 0:this._changeEntryPoint(t);break;case 2:this.properties().stopPrice.setValue(this.preparseStopPrice(t.price));break;case 3:this.properties().targetPrice.setValue(this.preparseProfitPrice(t.price));break;case 1:t.price=this._roundPrice(t.price),super.setPoint(1,t),this.recalculate()}this._unmuteSyncLineStyleWithoutApplyingChanges(),this.syncPriceLevels()}}getPoint(e){switch(e){case 0:return this._points[0];case 1:return{index:this._points[1].index,price:this._points[0].price};case 2:return{index:this._points[0].index,price:this.stopPrice()};case 3:return{index:this._points[0].index,price:this.profitPrice()}}return null}setPoints(e){this._muteSyncLineStyle(),super.setPoints(e),this.recalculate(),this._unmuteSyncLineStyleWithoutApplyingChanges(),this.syncPriceLevels()}syncPriceLevels(){if(this.linkKey().value()){var e=this.properties(),t={entryPrice:e.entryPrice.value(),stopLevel:e.stopLevel.value(),profitLevel:e.profitLevel.value()};n.changeLineStyle({linkKey:this.linkKey().value(),state:t,model:this._model})}}pointsCount(){return 1}name(){return"Risk/Reward"}addPoint(e){e.price=this._roundPrice(e.price),super.addPoint(e,null,!0);var t={price:e.price,index:this._getClosePointIndex(e.index)};super._addPointIntenal(t,null,!0);var i=this.calculateActualEntry(e,t);i&&(super._addPointIntenal(i,null,!0),(t=this.findClosePoint(i,t))&&super._addPointIntenal(t,null,!0));return this._lastPoint=null,this.normalizePoints(),this.createServerPoints(),!0}setOwnerSource(e){super.setOwnerSource(e);const t=this.ownerSource();t&&t.symbolSource().symbolInfo()&&(this._recalculateAmount(),this._recalculateRiskSize(),this._recalculateQty())}_roundPrice(e){const t=this.ownerSourceBase();return Math.round(e*t)/t}recalculate(){if(0!==this.points().length){var e=this.properties().targetPrice.value(),t=this.properties().stopPrice.value(),i=[this._points[0],this._points[1]],s=this.calculateActualEntry(this.points()[0],this.points()[1]);if(s){i.push(s);var r=this.findClosePoint(s,this.points()[1]);r&&i.push(r)}
this._points=i,e!==this.properties().targetPrice.value()&&this.properties().targetPrice._listeners.fire(this.properties().targetPrice),t!==this.properties().stopPrice.value()&&this.properties().stopPrice._listeners.fire(this.properties().stopPrice)}}start(){super.start(),this.recalculate()}startMoving(e,t,i){e.logical.price=this._roundPrice(e.logical.price),super.startMoving(e,t,i)}move(e,t,i){e.logical.price=this._roundPrice(e.logical.price),super.move(e,t,i),this.recalculate(),this._entryPriceAxisView.update()}_correctPoints(e,t){return!!this.isActualSymbol()&&r.prototype._correctPoints.call(this,[e[0],e[1]],t)}entryPrice(){return this.points()[0].price}findClosePoint(e,t){const i=this.ownerSource();if(!i)return null;for(var r=i.barsProvider().bars(),n=s(r.firstIndex()),o=Math.max(e.index,n),a=s(r.lastIndex()),l=Math.min(a,t.index),c=o;c<=l;c++){var h=r.valueAt(c);if(null!==h){var d=this.checkStopPrice(h);if(null!=d)return{index:c,price:d}}}return null}calculateActualEntry(e,t){const i=this.ownerSource();if(!i)return null;const r=i.barsProvider().bars();if(r.isEmpty())return null;for(var n=s(r.firstIndex()),o=Math.max(e.index,n),a=e.price,l=s(r.lastIndex()),c=Math.min(l,t.index),h=o;h<=c;h++){var d=r.valueAt(h);if(null!==d&&d[TradingView.HIGH_PLOT]>=a&&d[TradingView.LOW_PLOT]<=a)return{index:h,price:a}}return null}axisPoints(){if(!this._points[a.ActualEntry])return[];var e=this._points[a.ActualEntry],t=null;if(4===this._points.length)t=this._points[a.ActualClose];else{var i=this.lastBarData();if(!i)return[];t={index:i.index,price:i.closePrice}}return[e,t]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,667915))).RiskRewardDefinitionsViewModel}template(){var e=this.properties(),t=r.prototype.template.call(this);return t.stopLevel=e.stopLevel.value(),t.profitLevel=e.profitLevel.value(),t}_applyTemplateImpl(e){delete e.targetPrice,delete e.stopPrice,delete e.entryPrice,super._applyTemplateImpl(e);var t=this.properties();void 0!==e.stopLevel&&t.stopLevel.setValue(e.stopLevel),void 0!==e.profitLevel&&t.profitLevel.setValue(e.profitLevel)}getOrderTemplate(){var e=this.properties();return{qty:e.qty.value()/e.lotSize.value(),limitPrice:e.entryPrice.value(),stopLoss:e.stopPrice.value(),takeProfit:e.targetPrice.value(),side:this._orderSide(),type:p.LIMIT,seenPrice:null}}_propertiesStateExclusions(){return["entryPrice","stopPrice","targetPrice"]}static _configureProperties(e){r._configureProperties(e),e.addExclusion("stopLevel"),e.addExclusion("profitLevel"),e.addExclusion("stopPrice"),e.addExclusion("targetPrice"),e.addExclusion("entryPrice")}_getClosePointIndex(e){var t=this._model.timeScale(),i=Math.round(t.width()/t.barSpacing());return e+Math.max(3,Math.round(.15*i))}}_.version=2;class m extends _{constructor(e,t,i,s){super(e,t||m.createProperties(),i,s);var r=this.properties();r.entryPrice.subscribe(this,this._recalculateQty),r.stopPrice.subscribe(this,this._recalculateQty),r.riskSize.subscribe(this,this._recalculateQty),
r.entryPrice.subscribe(this,this._recalculateAmount),r.profitLevel.subscribe(this,this._recalculateAmount),r.stopLevel.subscribe(this,this._recalculateAmount),r.accountSize.subscribe(this,this._recalculateAmount),r.riskSize.subscribe(this,this._recalculateAmount),r.qty.subscribe(this,this._recalculateAmount)}_recalculateQty(){if(0!==this.points().length){var e=this.properties(),t=e.entryPrice.value(),i=e.stopPrice.value(),s=e.riskSize.value()/(Math.abs(i-t)*this._ownerSourcePointValue());e.qty.setValue(s)}}_recalculateAmount(){if(0===this.points().length)return;var e=this.properties(),t=e.accountSize.value(),i=e.entryPrice.value(),s=e.qty.value(),r=e.stopPrice.value(),n=e.targetPrice.value();const o=this._ownerSourcePointValue();var a=this._roundValue(t+(i-n)*s*o),l=this._roundValue(t-(r-i)*s*o);e.amountTarget.setValue(a),e.amountStop.setValue(l)}name(){return"Risk/Reward short"}stopPrice(){return this.entryPrice()+this.properties().stopLevel.value()/this.ownerSourceBase()}profitPrice(){return this.entryPrice()-this.properties().profitLevel.value()/this.ownerSourceBase()}preparseStopPrice(e){e=this._roundPrice(e);var t=this.entryPrice()+1/this.ownerSourceBase();return Math.max(e,t)}preparseProfitPrice(e){e=this._roundPrice(e);var t=this.entryPrice()-1/this.ownerSourceBase();return Math.min(e,t)}checkStopPrice(e){var t=this.stopPrice(),i=this.profitPrice();return e[TradingView.HIGH_PLOT]>=t?this.stopPrice():e[TradingView.LOW_PLOT]<=i?this.profitPrice():null}_orderSide(){return u.SELL}static createProperties(e){var t=new o("linetoolriskrewardshort",e);return this._configureProperties(t),t}}class g extends _{constructor(e,t,i,s){super(e,t||g.createProperties(),i,s);var r=this.properties();r.entryPrice.subscribe(this,this._recalculateQty),r.stopPrice.subscribe(this,this._recalculateQty),r.riskSize.subscribe(this,this._recalculateQty),r.entryPrice.subscribe(this,this._recalculateAmount),r.profitLevel.subscribe(this,this._recalculateAmount),r.stopLevel.subscribe(this,this._recalculateAmount),r.accountSize.subscribe(this,this._recalculateAmount),r.riskSize.subscribe(this,this._recalculateAmount),r.qty.subscribe(this,this._recalculateAmount)}_recalculateQty(){if(0!==this.points().length){var e=this.properties(),t=e.entryPrice.value(),i=e.stopPrice.value(),s=e.riskSize.value()/(Math.abs(t-i)*this._ownerSourcePointValue());e.qty.setValue(s)}}_recalculateAmount(){if(0!==this.points().length){var e=this.properties(),t=e.accountSize.value(),i=e.entryPrice.value(),s=e.qty.value(),r=e.stopPrice.value(),n=e.targetPrice.value(),o=this._ownerSourcePointValue(),a=this._roundValue(t+(n-i)*s*o),l=this._roundValue(t-(i-r)*s*o);e.amountTarget.setValue(a),e.amountStop.setValue(l)}}stopPrice(){return this.entryPrice()-this.properties().stopLevel.value()/this.ownerSourceBase()}profitPrice(){return this.entryPrice()+this.properties().profitLevel.value()/this.ownerSourceBase()}calculatePL(e){return e-this.entryPrice()}preparseStopPrice(e){e=this._roundPrice(e);var t=this.entryPrice()-1/this.ownerSourceBase();return Math.min(e,t)}
preparseProfitPrice(e){e=this._roundPrice(e);var t=this.entryPrice()+1/this.ownerSourceBase();return Math.max(e,t)}checkStopPrice(e){var t=this.stopPrice(),i=this.profitPrice();return e[TradingView.LOW_PLOT]<=t?this.stopPrice():e[TradingView.HIGH_PLOT]>=i?this.profitPrice():null}name(){return"Risk/Reward long"}_orderSide(){return u.BUY}static createProperties(e){var t=new o("linetoolriskrewardlong",e);return this._configureProperties(t),t}}t.LineToolRiskRewardLong=g,t.LineToolRiskRewardShort=m},685328:(e,t,i)=>{"use strict";var s=i(86441).Point,r=i(204652).distanceToLine,n=i(365897).LineDataSource,o=i(508547).DefaultProperty,a=i(519355).LineToolColorsProperty;class l extends n{constructor(e,t,s,r){super(e,t||l.createProperties(),s,r),i.e(1583).then(i.t.bind(i,593613,19)).then((({RotatedRectanglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){var i=this._getPaneViews()[0],s=i._points[0],n=i._points[1],o=i._points[2];this._distance=r(s,n,o).distance}}setPoint(e,t,i){if(super.setPoint(e,t,i),0===e||1===e){var r=this._getPaneViews()[0];r.update();var n=r._points[0],o=r._points[1].subtract(n),a=new s(o.y,-o.x).normalized().scaled(this._distance),l=n.add(a),c=this.screenPointToPoint(l);this._points[2]=c}}endChanging(e,t){delete this._distance,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Rotated Rectangle"}hasEditableCoordinates(){return!1}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,992622))).GeneralFiguresDefinitionsViewModel}_snapTo45DegreesAvailable(){return!0}static createProperties(e){var t=new o("linetoolrotatedrectangle",e);return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a([e.color]))}}t.LineToolRotatedRectangle=l},835157:(e,t,i)=>{"use strict";var s=i(451215).LevelsProperty,r=i(806788).LineToolPitchfork;class n extends r{constructor(e,t,i,s){super(e,t||n.createProperties(),i,s)}name(){return"Modified Schiff Pitchfork"}static createProperties(e){var t=new s("linetoolschiffpitchfork",e,!1,{range:[0,8]});return this._configureProperties(t),t}}t.LineToolSchiffPitchfork=n},317751:(e,t,i)=>{"use strict";var s=i(451215).LevelsProperty,r=i(806788).LineToolPitchfork;class n extends r{constructor(e,t,i,s){super(e,t||n.createProperties(),i,s)}name(){return"Schiff Pitchfork"}static createProperties(e){var t=new s("linetoolschiffpitchfork2",e,!1,{range:[0,8]});return this._configureProperties(t),t}}t.LineToolSchiffPitchfork2=n},592357:(e,t,i)=>{"use strict";i.d(t,{LineToolSignpost:()=>g});var s=i(509806),r=i(508547),n=i(365897),o=i(976704),a=i.n(o);class l extends(a()){constructor(e){super(),this._source=e,e.pointAdded().subscribe(this,(()=>this.listeners().fire(this))),e.pointChanged().subscribe(this,(()=>this.listeners().fire(this)))}value(){const e=this._source.properties().childs().position.value();return parseFloat(e.toFixed(2))}setValue(e){
this._source.properties().childs().position.setValue(e),this._source.model().updateSource(this._source),this.listeners().fire(this),this._source.syncMultichartState({pricesChanged:!1,indexesChanged:!1})}}var c=i(137680);class h extends c.LineDataSourcePointIndexProperty{constructor(e,t){super(e,t),this._source=e}_setPointImpl(e){this._source.setPointAndChangeIndex(this._pointIndex,e)}}var d=i(519355),u=i(650151),p=i(801093),_=i(358076);class m extends n.LineDataSource{constructor(){super(...arguments),this._startMovingAnchorY=NaN}priceSource(){return this.ownerSource()}addPoint(e,t,i){return super.addPoint(this._updatePositionAndCorrectPoint(e),t,i)}setPoint(e,t,i){super.setPoint(e,this._updatePositionAndCorrectPoint(t,!this.isPhantom()&&!this._allowChangeAnchorHorizontally()),i),this._syncPosition()}setPointAndChangeIndex(e,t,i){super.setPoint(e,this._updatePositionAndCorrectPoint(t,!1),i),this._syncPosition()}startMoving(e,t,i,s){s||(this._startMovingAnchorY=(0,u.ensureNotNull)(this._anchorYCoordinate())),super.startMoving(e,t,i)}move(e,t,i,s){var r;const n=(0,u.ensureDefined)((0,u.ensureNotNull)(this.startMovingPoint()).logical),o=(0,u.ensureDefined)(e.logical);if(!s&&0===t){const e=this._points[0],t=o.index-n.index,i=(0,u.ensureNotNull)(this.priceScale()),s=(0,u.ensure)(null===(r=this.ownerSource())||void 0===r?void 0:r.firstValue()),a=i.priceToCoordinate(o.price,s)-i.priceToCoordinate(n.price,s),l=this._startMovingAnchorY+a,c=i.coordinateToPrice(l,s);this._updatePositionAndCorrectPoint({index:e.index+t,price:c})}super.move(e,t,i),s||this._syncPosition()}_allowChangeAnchorHorizontally(){return!1}_updatePositionAndCorrectPoint(e,t){t&&(e.index=this._points[0].index);const i=this.priceSource();if(null===i)return e;const s=i.priceScale(),r=i.firstValue();if(null===s||s.isEmpty()||null===r)return e;const n=s.height();let o=n/2,a=e.price>=s.coordinateToPrice(o,r)?1:-1;const l=this._model.mainSeries();if(i===l){const t=l.data().search(this._baseSeriesIndexForPoint(e));if(null!==t){const i=(0,p.seriesPrice)(l,t,-1),n=(0,p.seriesPrice)(l,t,1);a=e.price>=i?1:-1,o=s.priceToCoordinate(1===a?n:i,r),e.price=1===a?Math.max(n,e.price):e.price}}const c=1===(-1===a!==s.isInverted()?-1:1)?o:n-o,h=s.priceToCoordinate(e.price,r),d=Math.min(n,Math.abs(h-o)),u=Math.max(0,Math.min(100,100*d/c))*a;return this.properties().childs().position.setValue(u),e}_baseSeriesIndexForPoint(e){return e.index}_syncPosition(){const e=this.linkKey().value();if(null!==e){const t={position:this.properties().childs().position.value()};(0,_.changeLineStyle)({linkKey:e,state:t,model:this._model})}}_anchorYCoordinate(){const e=this.priceSource();if(null===e)return null;const t=e.priceScale(),i=e.firstValue();if(null===t||t.isEmpty()||null===i)return null;const s=this._model.mainSeries(),r=this.customEvent();if(null===r)return null;let n=null;if(e===s&&(n=(0,p.seriesBasePosition)(s,r)),null===n&&(n=(0,p.noDataBasePosition)(r,t,i)),null===n)return null;const o=r.position(),a=t.priceToCoordinate(n.price,i);return(0,p.positionToCoordinate)(o,t.height(),a,(0,
p.positionVisualDirection)(o,t.isInverted()))}}class g extends m{constructor(e,t,s,r){super(e,null!=t?t:g.createProperties(),s,r),i.e(1583).then(i.bind(i,186422)).then((t=>{this._setPaneViews([new t.SignpostPaneView(this,e)])}))}pointsCount(){return 1}name(){return"Signpost"}customEvent(){return{index:()=>{var e,t;return null!==(t=null===(e=this.points()[0])||void 0===e?void 0:e.index)&&void 0!==t?t:null},position:()=>this.properties().childs().position.value()}}showInObjectTree(){return!this.isPhantom()&&super.showInObjectTree()}isPhantom(){return this._model.isPhantomLine(this)}clonePositionOffset(){return{barOffset:1,xCoordOffset:0,yCoordOffset:0}}template(){const e=super.template(),t=this.properties().childs();return e.text=t.text.value(),e.position=t.position.value(),e}shouldBeRemovedOnDeselect(){const e=this._properties.childs();if(e.showImage.value())return!1;return""===e.text.value().trim()}static createProperties(e){const t=new r.DefaultProperty("linetoolsignpost",e);return this._configureProperties(t),t.hasChild("text")||t.addChild("text",new(a())(s.t(null,void 0,i(37229)))),t.hasChild("position")||t.addChild("position",new(a())(50)),t.addExclusion("text"),t.addExclusion("position"),t.addChild("backgroundsColors",new d.LineToolColorsProperty([t.childs().plateColor])),t}_createPointProperty(e){super._createPointProperty(e);const t=this._pointsProperty.childs().points[e];t.removeProperty("price"),t.removeProperty("bar"),t.addChild("price",new l(this)),t.addChild("bar",new h(this,0))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text),this.properties().childs().position.setValue(e.position)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,200573)).then((e=>e.SignpostDefinitionsViewModel))}static _configureProperties(e){n.LineDataSource._configureProperties(e)}}g.supportPhantomMode=!0},355012:(e,t,i)=>{"use strict";i.d(t,{LineToolSineLine:()=>n});var s=i(508547),r=i(365897);class n extends r.LineDataSource{constructor(e,t,s,r){super(e,t||n.createProperties(),s,r),i.e(1583).then(i.bind(i,17484)).then((e=>{this._setPaneViews([new e.SineLinePaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Sine Line"}static createProperties(e){const t=new s.DefaultProperty("linetoolsineline",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,470404))).CyclicAndSineLinesPatternDefinitionsViewModel}}},746713:(e,t,i)=>{"use strict";i.d(t,{StudyLineDataSource:()=>C});var s=i(650151),r=i(486028),n=i(445588),o=i(365897),a=i(508547),l=i(898005),c=i(135834),h=i(939291),d=i(152244),u=i(864095),p=i(732537),_=i(278787),m=i(871555),g=i(85761),f=i(744687),v=i(981820),S=i(606978);class y extends S.StatusProviderBase{constructor(e){super(e.model().properties().childs().scalesProperties.childs().textColor),this._source=e}color(){return"#ff0000"}errorStatus(){
const e=this._source.status();return e.type===v.StudyStatusType.Error?{error:this.sourceStatusText(),solutionId:(0,v.studyStatusSolutionId)(e),title:(0,v.studyStatusTitle)(e),studyFeature:(0,v.studyStatusFeature)(e)}:null}getSplitTitle(){return this._source.titleInParts()}text(){return this._source.translatedType()}sourceStatusText(){return(0,v.convertStudyStatusToString)(this._source.status(),!0)}}var b=i(706486),w=i(160047);class P extends w.StatusView{constructor(e){super(e.statusProvider({}))}getSplitTitle(){return this._statusProvider.getSplitTitle()}}class C extends o.LineDataSource{constructor(e,t,s,r,n,o){super(e,r,n,o),this._indexes=null,this._inputs=null,this._definitionsViewModel=null,this._pointsetPoints=null,this._loadedPlots=null,this._loadedGraphics=null,this._beingCreatedPaneView=null,this._anchorsPaneView=null,this._isLegendDisplayed=!1,this._alignerCache=null,Promise.all([i.e(1583).then(i.bind(i,368227)),i.e(1583).then(i.bind(i,479015))]).then((t=>{const{LineToolBeingCreatedPaneView:i}=t[0],{StudyLineDataSourceAnchorsPaneView:s}=t[1];this._beingCreatedPaneView=new i(this,e),this._anchorsPaneView=new s(this,this.model()),this._model.lightUpdate()})),this._metaInfo=t,this._dataSource=new d.StudyDataSource(e.chartApi(),e.mainSeries().seriesSource(),s,t),this._dataSource.dataCleared().subscribe(this,this._onDataCleared),this._dataSource.dataUpdated().subscribe(this,this._onDataUpdated),this._dataSource.studyStatusChanged().subscribe(this,this._onStudyStatusChanged),this._statusProvider=new y(this),this._statusView=new P(this),this._showStudyArgumentsProperty=e.properties().childs().paneProperties.childs().legendProperties.childs().showStudyArguments}isDisplayedInLegend(){return this._isLegendDisplayed}titleInParts(){const e=[];if(this._showStudyArgumentsProperty.value()&&this._inputs)for(const t of this._metaInfo.inputs){if(!0===t.isHidden||"bool"===t.type)continue;const i=this._inputs[t.id];e.push(i.toString())}return[this.name(),e]}destroy(){this._dataSource.dataUpdated().unsubscribeAll(this),this._dataSource.dataCleared().unsubscribeAll(this),this._dataSource.studyStatusChanged().unsubscribeAll(this),this._dataSource.destroy(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),this._unsubscribeApplyInputsOnSeriesCompleted(),this._isDestroyed=!0,super.destroy()}stop(){super.stop(),this._isDestroyed||(this._dataSource.stop(),this.clearData())}start(){super.start(),this._isDestroyed||null===this._inputs||this._dataSource.start()}metaInfo(){return this._metaInfo}graphicsInfo(){return this._metaInfo.graphics}series(){return this._model.mainSeries()}translatedType(){return this._metaInfo.description}name(){return this._metaInfo.description}studyId(){return this._metaInfo.id}setPoint(e,t,i){super.setPoint(e,this._preparePoint(t,i))}move(e){}clearData(){this._clearAllDataExceptPointsetPoints(),this._pointsetPoints=null,this.updateAllViews((0,f.sourceChangeEvent)(this.id()))}data(){return this.plots()}plots(){
return this._loadedPlots||this._dataSource.plots()}graphics(){return this._loadedGraphics||this._dataSource.graphics()}firstValue(){return this._model.mainSeries().firstValue()}state(e){const t=super.state(e);let i;this.metaInfo()instanceof l.StudyMetaInfo?i=this.metaInfo().state():(i=(0,r.clone)(this.metaInfo()),i.id=l.StudyMetaInfo.parseIdString(i.id+(i.version?"-"+i.version:"")).fullId);const s={...t,metaInfo:i};return e&&(s.data=this.plots().state(),s.nonseriesindexes=this._indexes,s.graphics=(0,c.saveStudyGraphics)(this.graphics(),null)),s}restoreData(e){var t;void 0!==e.data&&(this._loadedPlots=new n.PlotList((0,p.studyPlotFunctionMap)(this._metaInfo),p.studyEmptyPlotValuePredicate),this._loadedPlots.restoreState(e.data)),this._indexes=null!==(t=e.nonseriesindexes)&&void 0!==t?t:this._indexes,this._loadedGraphics=e.graphics?(0,c.loadStudyGraphics)(e.graphics):this._loadedGraphics}getPropertyDefinitionsViewModel(){return null===this._definitionsViewModel?this._getPropertyDefinitionsViewModelClass().then((e=>null===e||this._isDestroyed?null:(null===this._definitionsViewModel&&(this._definitionsViewModel=new e(this._model.undoModel(),this)),this._definitionsViewModel))):Promise.resolve(this._definitionsViewModel)}paneViews(e){let t=[];if(this.isSourceHidden())return t;if(this._isReady()&&this._changeStatesStack.isEmpty()){const i=super.paneViews(e);null!==i&&(t=t.concat(i))}else null!==this._beingCreatedPaneView&&t.push(this._beingCreatedPaneView);return null!==this._anchorsPaneView&&t.push(this._anchorsPaneView),t}propertiesChanged(e){super.propertiesChanged(e),this._onStudyInputsMayChange()}dataAndViewsReady(){return super.dataAndViewsReady()&&this._isReady()}endChanging(e,t){const i=super.endChanging(e,t);return i.indexesChanged?this.clearData():this._updateAnchorsPrice(!0),i}moveData(e){this._dataSource.moveData(e)}restorePoints(e,t,i){super.restorePoints(e,t,i),this._updateAnchorsPrice(!0)}realign(){super.realign(),null===this._model.mainSeries().symbolInfo()&&(this._alignerCache=null)}statusProvider(e){return this._statusProvider}statusView(){return this._statusView}legendView(){return null}dataProblemModel(){return null}dataUpdatedModeModel(){return null}marketStatusModel(){return null}onStatusChanged(){return this._dataSource.studyStatusChanged()}status(){return this._dataSource.studyStatus()}recalcStudyIfNeeded(){}static createPropertiesFromStudyMetaInfoAndState(e,t,i,s){const r=(0,_.prepareStudyPropertiesForLoadChart)(e,t,i,s);return this._configureProperties(r),r}_onStudyStatusChanged(e,t){let i;switch(t.type){case u.StudyStatusType.Error:i=!0;break;case u.StudyStatusType.Completed:i=!1;break;default:return}if(i===this._isLegendDisplayed)return;this._isLegendDisplayed=i;const s=this._model.paneForSource(this);if(s){const e=this._model.panes().indexOf(s),t=b.InvalidationMask.invalidateLegendWidgetLayout(e);this.model().invalidate(t)}}_studyId(){return this._dataSource.studyId()}_isReady(){return!0}_updateAllPaneViews(e){var t,i;super._updateAllPaneViews(e),
null===(t=this._beingCreatedPaneView)||void 0===t||t.update(),null===(i=this._anchorsPaneView)||void 0===i||i.update(e)}_getPointTime(e,t){const i=e.index,s=this._model.timeScale().indexToTimePoint(i);if(null!==s)return s;if(t||void 0===e.time)return null;const r=this._model.mainSeries().symbolInfo();if(null===r)return null;let n=this._model.properties().childs().timezone.value();"exchange"===n&&(n=r.timezone);const o=(0,m.cal_to_utc)((0,m.get_timezone)(n),e.time);return this._getStartBarAligner()(o)/1e3}_updateAnchorsPrice(e){}_onPointsetUpdated(e){super._onPointsetUpdated(e),this._pointsetPoints=this._points.map((e=>({price:e.price,index:e.index,time:e.time}))),this._onStudyInputsMayChange()}_onDataCleared(){this.updateAllViews((0,f.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),this._model.updateSource(this)}_onDataUpdated(e,t,i){var s;this._updateAnchorsPrice(),this.updateAllViews((0,f.sourceChangeEvent)({sourceId:this.id(),firstUpdatedTimePointIndex:null===(s=e[0])||void 0===s?void 0:s.index})),this._model.updateSource(this)}_onStudyInputsMayChange(){let e=null;if(null!==this._pointsetPoints&&this._pointsetPoints.length===this.pointsCount()&&(e=this._studyInputs(this._pointsetPoints),null===e&&(this._clearAllDataExceptPointsetPoints(),this.updateAllViews((0,f.sourceChangeEvent)(this.id())))),null!==e){const t=this.metaInfo().inputs.map((e=>e.id)),i=Object.keys(e);for(const s of i)t.includes(s)||delete e[s]}this._areInputsEqual(this._inputs,e)||this._applyStudyInputs(e)}_preparePoint(e,t){return super._preparePoint(this._alignPointToRangeOfActualData(e),t)}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_subscribeApplyInputsOnSeriesCompleted(){this._unsubscribeApplyInputsOnSeriesCompleted(),this._model.mainSeries().dataEvents().completed().subscribe(this,(()=>this._onStudyInputsMayChange()),!0)}_unsubscribeApplyInputsOnSeriesCompleted(){this._model.mainSeries().dataEvents().completed().unsubscribeAll(this)}_onInputsChanged(){0}static _createPropertiesFromStudyIdAndState(e,t){const i=l.StudyMetaInfo.getStudyPropertyRootNameById(e),s=new a.DefaultProperty(i,t);return this._configureProperties(s),s}static _configureProperties(e){super._configureProperties(e),e.removeExclusion("intervalsVisibilities")}_areInputsEqual(e,t){return null===t?null===e:null!==e&&(0,h.areStudyInputsEqual)(this._metaInfo.inputs,e,t)}_applyStudyInputs(e){const t=this._inputs;this._inputs=e,null!==e&&(this._unsubscribeApplyInputsOnSeriesCompleted(),this._dataSource.setInputs(e),null===t&&this.isStarted()&&!this._dataSource.isStarted()&&this._dataSource.start()),this._onInputsChanged()}_clearAllDataExceptPointsetPoints(){this._inputs=null,this._dataSource.clearData(),this._loadedPlots=null,this._indexes=null,this._loadedGraphics=null}_getStartBarAligner(){const e=this._model.mainSeries().interval();return null!==this._alignerCache&&this._alignerCache.resolution===this._model.mainSeries().interval()||(this._alignerCache={resolution:e,aligner:(0,g.createTimeToBarTimeAligner)(e,(0,
s.ensureNotNull)(this._model.mainSeries().symbolInfo()))}),this._alignerCache.aligner}}},775562:(e,t,i)=>{"use strict";i.d(t,{LineToolSvgIconBase:()=>l});var s=i(650151),r=i(86441),n=i(922157),o=i.n(n),a=i(365897);class l extends a.LineDataSource{constructor(e,t,i,s){super(e,t,i,s),this._onIconChanged=new(o()),this._svgContent=null,this._loadViews()}pointsCount(){return 1}hasEditableCoordinates(){return!1}getAnchorLimit(){return 80}getChangePointForSync(e){return null}setPoint(e,t,i){const n=Object.assign({},t),o=(0,s.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),a=(0,s.ensureNotNull)(this.pointToScreenPoint(n)).subtract(o),l=this.properties().childs();if(0===e||1===e){const t=a.normalized();let i=Math.acos(-t.x);Math.asin(t.y)>0&&(i=2*Math.PI-i),0===e&&(i+=Math.PI),l.angle.setValue(i)}else{const t=a.add(new r.Point(15*(3===e?-1:1),0));l.size.setValue(2*Math.abs(t.x))}}getSourceIcon(){const e=this.svgContent();return null===e?null:{type:"svgContent",content:e}}onSourceIconChanged(){return this._onIconChanged}svgContent(){return this._svgContent}static _configureProperties(e){super._configureProperties(e),e.addExclusion("angle")}}},287011:(e,t,i)=>{"use strict";i.d(t,{LineToolText:()=>u,LineToolTextAbsolute:()=>p});var s=i(650151),r=i(86441),n=i(509806),o=i(365897),a=i(976704),l=i.n(a),c=i(508547),h=i(519355),d=i(744687);class u extends o.LineDataSource{constructor(e,t,s,r){const n=t||u.createProperties();super(e,n,s,r),this._barSpacing=e.timeScale().barSpacing(),this._recalculatePointsOnCenter=!1,i.e(1583).then(i.bind(i,800671)).then((({TextPaneView:t})=>{const i=this._recalculatePointsOnCenter?(e,t)=>{this._recalculatePointsOnCenter&&this._recalculateCenterPosition(e,t)}:void 0;this._setPaneViews([new t(this,e,void 0,void 0,void 0,void 0,void 0,i)])}))}centerPosition(){this._recalculatePointsOnCenter=!0}setPoint(e,t,i){const r=this.properties().childs();let n;if(1===e&&r.wordWrapWidth.value()){const e=this.model().timeScale();n=this.isFixed()?(0,s.ensureDefined)(this.fixedPoint()).x:e.indexToCoordinate(this.points()[0].index);const i=e.indexToCoordinate(t.index)-n-~~(r.fontsize.value()/6);if(!isFinite(i))return;r.wordWrapWidth.setValue(Math.max(100,i))}}pointsCount(){return 1}name(){return"Text"}setPriceScale(e){super.setPriceScale(e),e&&e.priceRange()&&(this._priceDencity=e.height()/(0,s.ensureNotNull)(e.priceRange()).length(),this._isPriceDencityLog=e.isLog())}restoreSize(){const e=(0,s.ensureNotNull)(this.priceScale());this._barSpacing=this.model().timeScale().barSpacing(),this._priceDencity=e.height()/(0,s.ensureNotNull)(e.priceRange()).length(),this.redraw((0,d.sourceChangeEvent)(this.id()))}redraw(e){this.updateAllViews(e),this._model.updateSource(this)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}state(e){const t=super.state(e);return e&&(t.state.fixedSize=!1),t}barSpacing(){return this._barSpacing}priceDencity(){return this._priceDencity}isPriceDencityLog(){return this._isPriceDencityLog}hasEditableCoordinates(){return!1}shouldBeRemovedOnDeselect(){
return""===this._properties.childs().text.value().trim()}static createProperties(e){const t=new c.DefaultProperty("linetooltext",e);return this._configureProperties(t),t}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,526236)).then((e=>e.TextDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(l())(n.t(null,void 0,i(37229)))),e.addChild("linesColors",new h.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new h.LineToolColorsProperty([e.childs().color])),e.addExclusion("text"),e.addExclusion("linesColors"),e.addExclusion("textsColors")}_recalculateCenterPosition(e,t){const i=this.isFixed()?(0,s.ensureDefined)(this.fixedPoint()):(0,s.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=new r.Point(i.x-e/2,i.y-t/2),o=(0,s.ensureNotNull)(this.screenPointToPoint(n));this.setPoints([o]),this.normalizePoints(),this.createServerPoints(),this.redraw((0,d.sourceChangeEvent)(this.id()))}}class p extends u{constructor(e,t){super(e,t||p.createProperties())}name(){return"Anchored Text"}hasEditableCoordinates(){return!1}isFixed(){return!0}static createProperties(e){const t=new c.DefaultProperty("linetooltextabsolute",e);return this._configureProperties(t),t}}},981781:(e,t,i)=>{"use strict";i.d(t,{LineToolThreeDrivers:()=>o});var s=i(508547),r=i(365897),n=i(519355);class o extends r.LineDataSource{constructor(e,t,s,r){const n=t||o.createProperties();super(e,n,s,r),i.e(1583).then(i.bind(i,911070)).then((t=>{this._setPaneViews([new t.LineToolThreeDrivesPaneView(this,e)])}))}pointsCount(){return 7}name(){return"Three Drives Pattern"}static createProperties(e){const t=new s.DefaultProperty("linetoolthreedrivers",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,120451)).then((e=>e.PatternWithoutBackgroundDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new n.LineToolColorsProperty([e.childs().textcolor])),e.addChild("linesWidths",new n.LineToolWidthsProperty([e.childs().linewidth])),e.hasChild("backgroundsColors")&&e.removeProperty("backgroundsColors")}}},115040:(e,t,i)=>{"use strict";i.d(t,{LineToolTimeCycles:()=>o});var s=i(822914),r=i(508547),n=i(365897);class o extends n.LineDataSource{constructor(e,t,s,r){super(e,null!=t?t:o.createProperties(),s,r),i.e(1583).then(i.bind(i,173177)).then((e=>{this._setPaneViews([new e.TimeCyclesPaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Time Cycles"}setPoint(e,t){const i=(0,s.default)(t),r=this._points[0],n=this._points[1];r.price=i.price,n.price=i.price,this._points[e]=i,this.normalizePoints()}addPoint(e,t,i){const s=super.addPoint(e,t,!0);if(s){
const e=this._points[0];this._points[1].price=e.price,i||(this.normalizePoints(),this.createServerPoints())}return s}static createProperties(e){const t=new r.DefaultProperty("linetooltimecycles",e);return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,659531))).TimeCyclesPatternDefinitionsViewModel}}},948222:(e,t,i)=>{"use strict";const s=i(365897).LineDataSource,r=i(125361).alignToStep;class n extends s{constructor(e,t){super(e,t),this.customization.forcePriceAxisLabel=!0,this.customization.disableErasing=!0,this.customization.showInObjectsTree=!1,this.setSelectionEnabled(!1)}isSynchronizable(){return!1}pointsCount(){return n.POINTS_COUNT}hasContextMenu(){return!1}state(){return null}startMoving(){super.startMoving.apply(this,arguments),this._cursorMoved=!1}endMoving(){super.endMoving.apply(this,arguments),this._cursorMoved=!1}_correctPoints(e,t){this._currentMovingPoint&&this._startMovingPoint?this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price&&(this._cursorMoved=!0):this._cursorMoved=!1;for(var i=1/this.priceScale().mainSource().base(),s=0;s<e.length;s++){var n=e[s];this._cursorMoved&&(n.price=this._currentMovingPoint.logical.price),n.price=r(n.price,i),e[s]=n}}userEditEnabled(){return!0}movable(){return!1}canBeHidden(){return!1}isUserDeletable(){return!1}showInObjectTree(){return!1}doesMovingAffectsUndo(){return!1}isAvailableInFloatingWidget(){return!1}timeAxisViews(){return null}cloneable(){return!1}copiable(){return!1}}n.POINTS_COUNT=1,e.exports.LineToolTrading=n},999570:(e,t,i)=>{"use strict";i.d(t,{LineToolTrendAngle:()=>d});var s=i(86441),r=i(650151),n=i(508547),o=i(365897),a=i(976704),l=i.n(a),c=i(744687);class h extends(l()){constructor(e){super(),this._lineSource=e}value(){return Math.round(180*this._lineSource.angle()/Math.PI)}setValue(e){const t=e*Math.PI/180,i=(0,r.ensureNotNull)(this._lineSource.pointToScreenPoint(this._lineSource.points()[0])),n=Math.cos(t),o=-Math.sin(t),a=new s.Point(n,o),l=i.addScaled(a,this._lineSource.distance()),h=(0,r.ensureNotNull)(this._lineSource.screenPointToPoint(l));this._lineSource.setPoint(1,h);const d=this._lineSource.model();d.updateSource(this._lineSource),this._lineSource.updateAllViews((0,c.sourceChangeEvent)(this._lineSource.id())),d.updateSource(this._lineSource)}notifyChanged(){this._listeners.fire(this)}}class d extends o.LineDataSource{constructor(e,t,s,r){const n=t||d.createProperties();super(e,n,s,r),this._angle=0,this._distance=0,n.addChild("angle",new h(this)),i.e(1583).then(i.bind(i,868642)).then((({TrendAnglePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}isSynchronizable(){return!1}pointsCount(){return 2}name(){return"Trend Angle"}angle(){return this._angle}distance(){return this._distance}addPoint(e,t){const i=super.addPoint(e,t);return i&&this._calculateAngle(),i}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this.points().length>1&&this._calculateAngle(),i}axisPoints(){
if(this.points().length<2)return[];const e=[this.points()[0]],t=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),i=Math.cos(this._angle)*this._distance,n=-Math.sin(this._angle)*this._distance,o=t.add(new s.Point(i,n)),a=(0,r.ensureNotNull)(this.screenPointToPoint(o));return e.push(a),e}setPoint(e,t,i){super.setPoint(e,t,i),this.points().length>1&&1===e&&this._calculateAngle()}restoreData(e){var t,i;this._angle=null!==(t=e.angle)&&void 0!==t?t:0,this._distance=null!==(i=e.distance)&&void 0!==i?i:0}state(e){const t=super.state(e);return t.angle=this._angle,t.distance=this._distance,t}cloneData(e){this._angle=e.angle(),this._distance=e.distance()}canHasAlert(){return!0}static createProperties(e){const t=new n.DefaultProperty("linetooltrendangle",e);return this._configureProperties(t),t}_snapTo45DegreesAvailable(){return!0}_getAlertPlots(){const e=this._linePointsToAlertPlot(this._points,null,this._properties.childs().extendLeft.value(),this._properties.childs().extendRight.value());return null===e?[]:[e]}_calculateAngle(){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0]));let t=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[1])).subtract(e);const i=t.length();i>0?(t=t.normalized(),this._angle=Math.acos(t.x),t.y>0&&(this._angle=-this._angle),this._distance=i):this._angle=0;this.properties().childs().angle.notifyChanged()}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,363164)).then((e=>e.TrendAngleDefinitionsViewModel))}}},843313:(e,t,i)=>{"use strict";i.d(t,{LineToolTrendBasedFibExtension:()=>c});var s=i(509806),r=i(440097),n=i(451215),o=i(519355),a=i(365897);const l=new r.TranslatedString("erase level line",s.t(null,void 0,i(812962)));class c extends a.LineDataSource{constructor(e,t,s,r){super(e,t||c.createProperties(),s,r),this.version=2,i.e(1583).then(i.bind(i,717395)).then((({TrendBasedFibExtensionPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 24}pointsCount(){return 3}name(){return"Trend-Based Fib Extension"}migrateVersion(e,t){1===e&&this.properties().childs().extendLines.setValue(!0)}processErase(e,t){const i="level"+t,s=this.properties().childs()[i].childs().visible;e.setProperty(s,!1,l)}fibLevelsBasedOnLogScale(){var e;return this.properties().childs().fibLevelsBasedOnLogScale.value()&&Boolean(null===(e=this.priceScale())||void 0===e?void 0:e.isLog())}static createProperties(e){const t=new n.LevelsProperty("linetooltrendbasedfibextension",e,!1,{range:[0,8]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,84617))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){const t=e.childs();super._configureProperties(e);const i=[t.trendline.childs().color];for(let e=1;e<=24;e++){const s=t["level"+e].childs().color;i.push(s)}e.addChild("linesColors",new o.LineToolColorsProperty(i))
;const s=[t.trendline.childs().linewidth,t.levelsStyle.childs().linewidth];e.addChild("linesWidths",new o.LineToolWidthsProperty(s))}}},340140:(e,t,i)=>{"use strict";i.d(t,{LineToolTrendBasedFibTime:()=>c});var s=i(509806),r=i(440097),n=i(365897),o=i(451215),a=i(519355);const l=new r.TranslatedString("erase level line",s.t(null,void 0,i(812962)));class c extends n.LineDataSource{constructor(e,t,s,r){super(e,t||c.createProperties(),s,r),this.version=1,i.e(1583).then(i.bind(i,634806)).then((({TrendBasedFibTimePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 11}pointsCount(){return 3}name(){return"Trend-Based Fib Time"}processErase(e,t){const i="level"+t,s=this.properties().childs()[i].childs().visible;e.setProperty(s,!1,l)}static createProperties(e){const t=new o.LevelsProperty("linetooltrendbasedfibtime",e,!1,{range:[1,11]});return this._configureProperties(t),t}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,826655))).TrendBasedFibTimeDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=e.childs(),i=[t.trendline.childs().linewidth],s=[t.trendline.childs().color];for(let e=1;e<=11;e++)i.push(t["level"+e].childs().linewidth),s.push(t["level"+e].childs().color);e.addChild("linesColors",new a.LineToolColorsProperty(s)),e.addChild("linesWidths",new a.LineToolWidthsProperty(i))}}},620164:(e,t,i)=>{"use strict";i.d(t,{LineToolTrendLine:()=>l});var s=i(508547),r=i(365897),n=i(113627),o=i(976704),a=i.n(o);class l extends r.LineDataSource{constructor(e,t,s,r){super(e,t||l.createProperties(),s,r),this._trendLinePaneView=null,i.e(1583).then(i.bind(i,614231)).then((({TrendLinePaneView:e})=>{this._trendLinePaneView=new e(this,this._model),this._setPaneViews([this._trendLinePaneView])}))}dataAndViewsReady(){return super.dataAndViewsReady()&&null!==this._trendLinePaneView&&this._trendLinePaneView.iconsReady()}pointsCount(){return 2}name(){return"Trend Line"}canHasAlert(){return!0}showPriceLabels(){return this._properties.childs().showPriceLabels.value()}createPriceAxisView(e){return new n.LineToolPriceAxisView(this,{pointIndex:e,backgroundPropertyGetter:()=>this.showPriceLabels()?this._properties.childs().linecolor.value():null})}isForcedDrawPriceAxisLabel(){return this.showPriceLabels()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e){const t=new s.DefaultProperty("linetooltrendline",e);return this._configureProperties(t),t}_getAlertPlots(){const e=this._linePointsToAlertPlot(this._points,null,this._properties.childs().extendLeft.value(),this._properties.childs().extendRight.value());return null===e?[]:[e]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,600265))).TrendLineDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}
_snapTo45DegreesAvailable(){return!0}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(a())("")),e.addExclusion("text")}}},202574:(e,t,i)=>{"use strict";i.d(t,{LineToolTrianglePattern:()=>o});var s=i(508547),r=i(365897),n=i(519355);class o extends r.LineDataSource{constructor(e,t,s,r){const n=t||o.createProperties();super(e,n,s,r),i.e(1583).then(i.bind(i,50186)).then((t=>{this._setPaneViews([new t.LineToolTrianglePatternPaneView(this,e)])}))}pointsCount(){return 4}name(){return"Triangle Pattern"}static createProperties(e){const t=new s.DefaultProperty("linetooltrianglepattern",e);return this._configureProperties(t),t}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,991497)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new n.LineToolColorsProperty([e.childs().textcolor])),e.addChild("backgroundsColors",new n.LineToolColorsProperty([e.childs().backgroundColor]))}}},101573:(e,t,i)=>{"use strict";var s=i(365897).LineDataSource,r=i(508547).DefaultProperty,n=i(519355).LineToolColorsProperty;class o extends s{constructor(e,t,s,r){super(e,t||o.createProperties(),s,r),i.e(1583).then(i.t.bind(i,870736,19)).then((({TrianglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 3}name(){return"Triangle"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,992622))).GeneralFiguresDefinitionsViewModel}static createProperties(e){var t=new r("linetooltriangle",e);return this._configureProperties(t),t}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new n([e.childs().color]))}}t.LineToolTriangle=o},661243:(e,t,i)=>{"use strict";i.d(t,{LineToolVertLineTimeAxisView:()=>r});var s=i(53794);class r extends s.LineDataSourceTimeAxisView{constructor(e){super(e,0)}_getBgColor(){return this._source.properties().linecolor.value()}_getAlwaysInViewPort(){return!1}_getIndex(){const e=this._source.points();return 0===e.length?null:e[0].index}}},913031:(e,t,i)=>{"use strict";i.d(t,{LineToolVertLine:()=>h});var s=i(650151),r=i(86441),n=i(508547),o=i(976704),a=i.n(o),l=i(365897),c=i(661243);class h extends l.LineDataSource{constructor(e,t,s,r){const n=t||h.createProperties();super(e,n,s,r),this._timeAxisView=new c.LineToolVertLineTimeAxisView(this),this._paneViewFactory=null,this.properties().childs().extendLine.subscribe(this,(()=>e.lightUpdate())),i.e(1583).then(i.bind(i,511032)).then((t=>{this._paneViewFactory=i=>new t.VertLinePaneView(this,e,i),this._model.lightUpdate()}))}destroy(){this.properties().childs().extendLine.unsubscribeAll(this),super.destroy()}pointsCount(){return 1}name(){return"Vertical Line"}timeAxisViews(){
return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(e){super.updateAllViews(e),this._timeAxisView.update(e)}canHasAlert(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}isMultiPaneAvailable(){return!0}isMultiPaneEnabled(){return this.properties().childs().extendLine.value()}paneViews(e){return e=(0,s.ensureDefined)(e),this.isMultiPaneEnabled()||this._model.paneForSource(this)===e?(null===this._getPaneViews(e)&&null!==this._paneViewFactory&&this._setPaneViews([this._paneViewFactory(e)],e,!0),super.paneViews(e)):null}priceAxisViews(){return null}priceAxisPoints(){return[]}pointToScreenPoint(e){const t=this._model.timeScale();if(t.isEmpty())return null;const i=t.indexToCoordinate(e.index);return new r.Point(i,0)}convertYCoordinateToPriceForMoving(e){return 0}static createProperties(e){null!=e&&(void 0===e.textOrientation&&(e.textOrientation="horizontal"),void 0===e.extendLine&&(e.extendLine=!1));const t=new n.DefaultProperty("linetoolvertline",e);return this._configureProperties(t),t}_getAlertPlots(){const e=this._points[0],t={index:e.index,price:e.price+1},i=this._linePointsToAlertPlot([e,t],null,!0,!0);return null===i?[]:[i]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(6682),i.e(4800),i.e(7214),i.e(34),i.e(8537)]).then(i.bind(i,606374)).then((e=>e.VerticalLineDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new(a())("")),e.addExclusion("text")}}},702434:(e,t,i)=>{"use strict";i.d(t,{LineToolVbPFixed:()=>f});var s=i(277973),r=i(650151),n=i(101709),o=i(898005),a=i(746713),l=i(135834),c=i(40371),h=i(744687),d=i(486028),u=i(508547),p=i(278787);const _=(0,n.studyIdString)("VbPFixed","tv-volumebyprice");function m(e,t,i,s){return t.styles&&(g(t.styles.developingPoc),g(t.styles.developingVAHigh),g(t.styles.developingVALow)),t}function g(e){void 0!==e&&void 0!==e.visible&&(e.display=e.visible?15:0,delete e.visible)}class f extends a.StudyLineDataSource{constructor(e,t,i,s,r){const n=i||e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:_});super(e,n,"vbpfixed_",null!=t?t:f.createProperties(e),s,r),this._createPaneViews().then((e=>{this._setPaneViews(e)})),this.clearData()}pointsCount(){return 2}boundToSymbol(){return!1}offset(e){return 0}getMinFirstBarIndexForPlot(){return-1/0}calcIsActualSymbol(){this._isActualSymbol=!0,this._isActualCurrency=!0,this._isActualUnit=!0,this.calcIsActualInterval()}cloneable(){return!1}isSynchronizable(){return!1}isPlotVisibleAt(e,t){return(this.properties().childs().styles.childs()[e].childs().display.value()&t)===t}static createProperties(e,t){const i=o.StudyMetaInfo.getStudyPropertyRootNameById(_),s=(0,r.ensureNotNull)(e.studyMetaInfoRepository().findByIdSync({type:"java",studyId:_})),n=(0,u.createDefaultsState)(!0,i,[],e.studyVersioning())
;return this.createPropertiesFromStudyMetaInfoAndState(s,s,(0,d.merge)((0,d.clone)(n),null!=t?t:{}),e.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(e,t,i,s){const r=(0,p.prepareStudyPropertiesForLoadChart)(e,t,i,s,m);return this._configureProperties(r),r}static studyId(){return _}_studyInputs(e){(0,r.assert)(2===e.length,"all the line tool points should be defined");const[t,i]=e,s=Math.max(t.index,i.index),n=this._model.mainSeries().bars().lastIndex(),o=this._getPointTime(t.index<=i.index?t:i,!0),a=this._getPointTime(i.index>=t.index?i:t,!0);if(null===o||null===a)return this._subscribeApplyInputsOnSeriesCompleted(),null;return{...this.properties().childs().inputs.state(),first_bar_time:1e3*o,last_bar_time:1e3*a,subscribeRealtime:n===s,mapRightBoundaryToBarStartTime:!!this._needExtendToBarsEnding()||void 0}}_isReady(){return!(0,l.isStudyGraphicsEmpty)(this.graphics())}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(3623),i.e(6682),i.e(7214),i.e(7358),i.e(34),i.e(607)]).then(i.bind(i,696734))).StudyLineDataSourceDefinitionsViewModel}_onDataUpdated(){this._updateAnchors(),this.updateAllViews((0,h.sourceChangeEvent)(this.id())),this._model.updateSource(this)}_updateAnchors(){const e=this._calculateAnchors();if(!e)return;const[{index:t,price:i},{index:s,price:r}]=e;if(this._timePoint.length&&(this._timePoint[0].price=i,this._timePoint[1].price=r),this._points.length){const e=this.model().timeScale(),n=e.indexToTimePoint(t),o=e.indexToTimePoint(t);this._points[0]={index:t,price:i,time:(0,d.isNumber)(n)?new Date(1e3*n):void 0},this._points[1]={index:s,price:r,time:(0,d.isNumber)(o)?new Date(1e3*o):void 0}}}_calculateAnchors(){let e=null,t=null,i=null,r=null;if(this.graphics().hhists().forEach((s=>{s.forEach((s=>{const{priceLow:n,priceHigh:o,firstBarTime:a,lastBarTime:l}=s;(!e||n<e)&&(e=n),(!t||o>t)&&(t=o),(!i||a<i)&&(i=a),(!r||l>r)&&(r=l)}))})),!((0,s.default)(e)||(0,s.default)(t)||(0,s.default)(r)||(0,s.default)(i)))return[{price:t,index:i},{price:e,index:r}]}_updateAnchorsPrice(){const e=this._calculateAnchors();if(!e)return;const[{price:t},{price:i}]=e;this._timePoint.length&&(this._timePoint[0].price=t,this._timePoint[1].price=i),this._points.length&&(this._points[0].price=t,this._points[1].price=i)}async _createPaneViews(){var e;const t=this._metaInfo,s=t.graphics,r=[],n=this._needExtendToBarsEnding();if(s.hhists){const{HHistPaneView:t}=await i.e(507).then(i.bind(i,179710)),s=null===(e=this.properties().childs().graphics.childs().polygons)||void 0===e?void 0:e.childs();r.push(new t(this,this._model,void 0,null==s?void 0:s.histBoxBg,n))}if(s.horizlines){const{HorizLinePaneView:e}=await i.e(507).then(i.bind(i,606029));r.push(new e(this,this._model,void 0,n))}return t.plots.length>0&&r.push(this._createStudyPlotPaneView(t.plots[0].id,n)),t.plots.length>1&&r.push(this._createStudyPlotPaneView(t.plots[1].id,n)),t.plots.length>2&&r.push(this._createStudyPlotPaneView(t.plots[2].id,n)),r}_createStudyPlotPaneView(e,t){
return new c.StudyPlotPaneView(this,this._model.mainSeries(),this._model,e,t)}_needExtendToBarsEnding(){var e;return void 0!==(null===(e=this.metaInfo().defaults.inputs)||void 0===e?void 0:e.mapRightBoundaryToBarStartTime)}}},501182:(e,t,i)=>{"use strict";var s;i.d(t,{MagnetMode:()=>s}),function(e){e[e.WeakMagnet=0]="WeakMagnet",e[e.StrongMagnet=1]="StrongMagnet"}(s||(s={}))},592884:(e,t,i)=>{"use strict";i.d(t,{magnetEnabled:()=>m,magnetMode:()=>g,setIsMagnetEnabled:()=>f,setMagnetMode:()=>v});var s=i(508547),r=i(210596),n=i.n(r),o=i(501182),a=i(358076),l=i(232468),c=i(568822);const h=new(n())(!1),d=new(n())(o.MagnetMode.WeakMagnet),u=(0,c.modifierPressed)(),p=(0,c.shiftPressed)();function _(){const e=u.value();if(p.value()&&(a.isToolEditingNow.value()||a.isToolCreatingNow.value()))return void h.setValue(!1);let t,i;if(a.activePointSelectionMode.value()===a.SelectPointMode.Replay)t=i=!1;else{const s=a.tool.value(),r=a.isStudyEditingNow.value()||a.activePointSelectionMode.value()===a.SelectPointMode.Study;t=e&&((0,l.isLineToolName)(s)||a.isToolEditingNow.value()||(0,a.toolIsMeasure)(s)||r),i=(0,a.properties)().childs().magnet.value()}d.setValue(!i&&t?o.MagnetMode.StrongMagnet:(0,a.properties)().childs().magnetMode.value()),h.setValue(t?!i:i)}function m(){return h}function g(){return d}function f(e){(0,s.saveDefaultProperties)(!0),(0,a.properties)().childs().magnet.setValue(e),(0,s.saveDefaultProperties)(!1)}function v(e){(0,s.saveDefaultProperties)(!0),(0,a.properties)().childs().magnetMode.setValue(e),(0,a.properties)().childs().magnet.setValue(!0),(0,s.saveDefaultProperties)(!1)}(0,a.runOnDrawingStateReady)((()=>{(0,a.properties)().childs().magnet.subscribe(null,_),(0,a.properties)().childs().magnetMode.subscribe(null,_),u.subscribe(_),p.subscribe(_),a.tool.subscribe(_),a.isToolEditingNow.subscribe(_),_()}))},783204:(e,t,i)=>{"use strict";i.d(t,{MainSeriesScaleRatioProperty:()=>n});var s=i(922157),r=i.n(s);class n{constructor(e){this._changed=new(r()),this._model=e}getStepChangeValue(){return.1}getMinValue(){return 1e-7}getMaxValue(){return 99999999}value(){return this._model.mainSeriesScaleRatio()}setValue(e,t){(e!==this.value()||t)&&(this._model.setMainSeriesScaleRatio(e),this._onChanged())}state(){return null}clone(){return new n(this._model)}listeners(){return this._changed}subscribe(e,t){this._changed.subscribe(e,t)}unsubscribe(e,t){this._changed.unsubscribe(e,t)}unsubscribeAll(e){this._changed.unsubscribeAll(e)}storeStateIfUndefined(){return!0}_onChanged(){this._changed.fire(this)}}},744687:(e,t,i)=>{"use strict";i.r(t),i.d(t,{sourceChangeEvent:()=>r,globalChangeEvent:()=>o,viewportChangeEvent:()=>l,selectionChangeEvent:()=>h});var s=i(827147);function r(e){return(0,s.default)(e)?{type:"data-source-change",sourceId:e}:{type:"data-source-change",...e}}const n={type:"global-change"};function o(){return n}const a={type:"viewport-change"};function l(){return a}const c={type:"selection-change"};function h(){return c}},900827:(e,t,i)=>{"use strict";i.d(t,{ensureTimePointIndexIndex:()=>n,unpackNonSeriesData:()=>o})
;var s=i(130551),r=i(650151);function n(e){if(e<0)throw new Error("TimePointIndexIndex should be non-negative integer");return e}async function o(e){if(""===e)return null;const t=JSON.parse(e);if(!(0,s.isObject)(t)||"function"==typeof t)throw new Error("Non-object content in the non-series envelope");if((0,s.hasProperty)(t,"indexes_replace"))return{indexes_replace:!0};const i={indexes_replace:!1};if((0,s.hasProperty)(t,"offsets")&&(i.offsets=t.offsets),(0,s.hasProperty)(t,"isUpdate")){if("boolean"!=typeof t.isUpdate)throw new Error('Invalid type of "isUpdate" field');i.isUpdate=t.isUpdate}return(0,s.hasProperty)(t,"data")&&(i.data=t.data),(0,s.hasProperty)(t,"graphicsCmds")&&(i.graphicsCmds=function(e){if(!(0,s.isObject)(e))throw new Error("Graphics commands should be wrapped in an object");if((0,s.hasProperty)(e,"create"),(0,s.hasProperty)(e,"erase")){const t=e.erase;(0,r.assert)(Array.isArray(t),"Collection of erase commands should be array");for(const e of t){if(!(0,s.isObject)(e)||!(0,s.hasProperty)(e,"action"))throw new Error("Command should be an object with 'action' property");(0,r.assert)("all"===e.action||"one"===e.action,"Erase command action should be 'all' or 'one'")}}return e}(t.graphicsCmds)),i}},58216:(e,t,i)=>{"use strict";i.d(t,{notAvailable:()=>r});var s=i(509806);const r=i(484727).enabled("use_na_string_for_not_available_values")?s.t(null,void 0,i(516542)):"∅"},411404:(e,t,i)=>{"use strict";var s;i.d(t,{PaneCursorType:()=>s}),function(e){e[e.Default=0]="Default",e[e.Pointer=1]="Pointer",e[e.Eraser=2]="Eraser",e[e.Dot=3]="Dot",e[e.Grabbing=4]="Grabbing",e[e.ZoomIn=5]="ZoomIn",e[e.VerticalResize=6]="VerticalResize",e[e.HorizontalResize=7]="HorizontalResize",e[e.DiagonalNeSwResize=8]="DiagonalNeSwResize",e[e.DiagonalNwSeResize=9]="DiagonalNwSeResize"}(s||(s={}))},70362:(e,t,i)=>{"use strict";i.d(t,{PanePriceAxisView:()=>n});var s=i(256776);class r{constructor(e){this._priceAxisViewRenderer=null,this._rendererOptions=null,this._align="right",this._width=0,this._height=0,this._textWidthCache=e}setParams(e,t,i,s,r){this._priceAxisViewRenderer=e,this._rendererOptions=t,this._width=i,this._height=s,this._align=r}draw(e,t){null!==this._rendererOptions&&null!==this._priceAxisViewRenderer&&this._priceAxisViewRenderer.draw(e,this._rendererOptions,this._textWidthCache,this._width,this._height,this._align,t.pixelRatio)}hitTest(e){var t,i;return void 0===(null===(t=this._priceAxisViewRenderer)||void 0===t?void 0:t.hitTest)?null:null===(i=this._priceAxisViewRenderer)||void 0===i?void 0:i.hitTest(e,this._width,this._align)}}class n{constructor(e,t,i){this._renderer=null,this._invalidated=!0,this._priceAxisView=e,this._textWidthCache=new s.TextWidthCache(100),this._dataSource=t,this._chartModel=i,this._fontSize=-1,this._panePriceAxisViewRenderer=new r(this._textWidthCache)}update(e){this._invalidated=!0}renderer(e,t){return this._invalidated&&this._updateImpl(e,t),this._renderer}_updateImpl(e,t){this._renderer=null
;const i=this._chartModel.crossHairSource(),s=this._dataSource===i?i.pane:this._chartModel.paneForSource(this._dataSource);if(null===s)return;const r=this._priceScale();if(null===r)return;let n=s.priceScalePosition(r);if("overlay"===n&&(n=s.priceScalePosition(s.defaultPriceScale())),"overlay"===n)return;const o=this._chartModel.priceAxisRendererOptions();o.fontSize!==this._fontSize&&(this._fontSize=o.fontSize,this._textWidthCache.reset()),this._panePriceAxisViewRenderer.setParams(this._priceAxisView.paneRenderer(),o,t,e,n),this._renderer=this._panePriceAxisViewRenderer,this._invalidated=!1}_priceScale(){return this._dataSource.priceScale()}}},329776:(e,t,i)=>{"use strict";i.d(t,{PaneRendererArea:()=>a});var s=i(650151),r=i(507967),n=i(918922),o=i(664114);class a extends r.PaneRendererLine{constructor(e){e.forceLineColor=!1,super(e)}draw(e,t){var i,r,a,l,c;const h=this._data;if(0===h.items.length)return;let d=null!==(r=null===(i=this._data.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==r?r:0,u=(null!==(l=null===(a=this._data.visibleItemsRange)||void 0===a?void 0:a.endItemIndex)&&void 0!==l?l:this._data.items.length)-1;for(;d<u&&!(0,n.coordinateIsValid)(h.items[d].y);)d++;for(;u>=0&&!(0,n.coordinateIsValid)(h.items[u].y);)u--;if(d>u)return;e.save(),e.scale(t.pixelRatio,t.pixelRatio),e.lineCap="butt",e.strokeStyle=h.lineColor,e.lineWidth=h.lineWidth,(0,o.setLineStyle)(e,h.lineStyle),e.lineWidth=1;const p={},_=h.items;for(let e=d;e<=u;e++){const t=_[e];let i;if(i=t.style?t.style.color:h.lineColor,e<u&&_[e+1].style){const r=(0,s.ensureDefined)(_[e+1].style).color;if(i!==r){const e=p[r]||[];e.push(t),p[r]=e}}const r=p[i]||[];r.push(t),p[i]=r}for(const t of Object.keys(p)){const i=p[t];e.beginPath();let s=0;for(let r=0;r<i.length;r++)i[r].style&&(null===(c=i[r].style)||void 0===c?void 0:c.color)!==t&&(e.moveTo(Math.round(i[s].x),h.bottom),this._walkLine(e,i.slice(s,r),!0,h.bottom,!0),s=r);if(e.moveTo(Math.round(i[s].x),h.bottom),this._walkLine(e,i.slice(s,i.length),!0,h.bottom,!0),e.closePath(),h.isSeries){const t=e.createLinearGradient(0,0,0,h.bottom);t.addColorStop(0,h.color1),t.addColorStop(1,h.color2),e.fillStyle=t,h.simpleMode=!0}else e.fillStyle=t;e.fill()}e.lineWidth=h.lineWidth,e.restore(),super.draw(e,t)}}},385824:(e,t,i)=>{"use strict";i.d(t,{CompositeRenderer:()=>s});class s{constructor(){this._renderers=[],this._globalAlpha=1}setGlobalAlpha(e){this._globalAlpha=e}append(e){this._renderers.push(e)}insert(e,t){this._renderers.splice(t,0,e)}clear(){this._renderers.length=0}isEmpty(){return 0===this._renderers.length}draw(e,t){for(let i=0;i<this._renderers.length;i++)e.save(),e.globalAlpha=this._globalAlpha,this._renderers[i].draw(e,t),e.restore()}drawBackground(e,t){e.save(),e.globalAlpha=this._globalAlpha;for(let i=0;i<this._renderers.length;i++){const s=this._renderers[i];s.drawBackground&&s.drawBackground(e,t)}e.restore()}hitTest(e,t){let i=null;for(let s=this._renderers.length-1;s>=0;s--){const r=this._renderers[s].hitTest(e,t);null!==r&&(null===i||r.result()>i.result())&&(i=r)}return i}
doesIntersectWithBox(e){return this._renderers.some((t=>!!t.doesIntersectWithBox&&t.doesIntersectWithBox(e)))}}},664114:(e,t,i)=>{"use strict";i.r(t),i.d(t,{clearRectWithGradient:()=>o,fillRectInnerBorder:()=>a,drawHorizontalLine:()=>l,drawVerticalLine:()=>c,drawRoundRect:()=>d,drawRoundRectWithInnerBorder:()=>u,fillRectWithBorder:()=>p,createCircle:()=>_,drawPoly:()=>m,setLineStyle:()=>g,drawLine:()=>f});var s=i(86441),r=i(284269),n=i(795161);function o(e,t,i,s,r,n,o){e.save(),e.globalCompositeOperation="copy";const a=e.createLinearGradient(0,0,0,r);a.addColorStop(0,n),a.addColorStop(1,o),e.fillStyle=a,e.fillRect(t,i,s,r),e.restore()}function a(e,t,i,s,r,n){e.fillRect(t+n,i,s-2*n,n),e.fillRect(t+n,i+r-n,s-2*n,n),e.fillRect(t,i,n,r),e.fillRect(t+s-n,i,n,r)}function l(e,t,i,s){e.beginPath();const r=e.lineWidth%2?.5:0;e.moveTo(i,t+r),e.lineTo(s,t+r),e.stroke()}function c(e,t,i,s){e.beginPath();const r=e.lineWidth%2?.5:0;e.moveTo(t+r,i),e.lineTo(t+r,s),e.stroke()}function h(e,t){return Array.isArray(e)?e.map((e=>0===e?e:e+t)):e+t}function d(e,t,i,s,r,n,o){let a,l,c,h;if(Array.isArray(n))if(2===n.length){const e=Math.max(0,n[0]),t=Math.max(0,n[1]);a=e,l=e,c=t,h=t}else{if(4!==n.length)throw new Error("Wrong border radius - it should be like css border radius");a=Math.max(0,n[0]),l=Math.max(0,n[1]),c=Math.max(0,n[2]),h=Math.max(0,n[3])}else{const e=Math.max(0,n);a=e,l=e,c=e,h=e}o||e.beginPath(),e.moveTo(t+a,i),e.lineTo(t+s-l,i),0!==l&&e.arcTo(t+s,i,t+s,i+l,l),e.lineTo(t+s,i+r-c),0!==c&&e.arcTo(t+s,i+r,t+s-c,i+r,c),e.lineTo(t+h,i+r),0!==h&&e.arcTo(t,i+r,t,i+r-h,h),e.lineTo(t,i+a),0!==a&&e.arcTo(t,i,t+a,i,a)}function u(e,t,i,s,r,o,a=0,l=0,c="",u=n.LineStyle.Solid){if(e.save(),!l||!c||c===o)return d(e,t,i,s,r,a),e.fillStyle=o,e.fill(),void e.restore();const p=l/2;if("transparent"!==o){const p="transparent"!==c&&u!==n.LineStyle.Solid;d(e,p?t:t+l,p?i:i+l,p?s:s-2*l,p?r:r-2*l,p?a:h(a,-l)),e.fillStyle=o,e.fill()}if("transparent"!==c){d(e,t+p,i+p,s-l,r-l,h(a,-p)),e.lineWidth=l,e.strokeStyle=c,g(e,u),e.closePath(),e.stroke()}e.restore()}function p(e,t,i,r,n,o,a,l,c,h,d,u,p,_,m){const f=h?0:t,v=d?p:r;if(void 0!==o&&(e.fillStyle=o,e.fillRect(f,i,v-f+_,n-i)),void 0!==a&&l>0){if(e.beginPath(),g(e,c),void 0!==m){const t=m.map((e=>e*l));e.setLineDash(t)}let o=(0,s.point)(0,0),h=(0,s.point)(0,0),d=(0,s.point)(0,0),p=(0,s.point)(0,0);switch(u){case"outer":{const e=.5*l;d=(0,s.point)(0,e),p=(0,s.point)(0,e),o=(0,s.point)(e,-l),h=(0,s.point)(e,-l);break}case"center":{const e=l%2?.5:0,t=l%2?.5:_;d=(0,s.point)(.5*l-e,-e),p=(0,s.point)(t+.5*l,-e),o=(0,s.point)(-e,e+.5*l),h=(0,s.point)(t,e+.5*l);break}case"inner":{const e=.5*l;d=(0,s.point)(0,-e),p=(0,s.point)(1,-e),o=(0,s.point)(-e,l),h=(0,s.point)(1-e,l);break}}e.lineWidth=l,e.strokeStyle=a,e.moveTo(f-d.x,i-d.y),e.lineTo(v+p.x,i-p.y),e.moveTo(r+h.x,i+h.y),e.lineTo(r+h.x,n-h.y),e.moveTo(f-d.x,n+d.y),e.lineTo(v+p.x,n+p.y),e.moveTo(t-o.x,i+o.y),e.lineTo(t-o.x,n-o.y),e.stroke()}}function _(e,t,i,s){e.beginPath(),e.arc(t,i,s,0,2*Math.PI,!1),e.closePath()}function m(e,t,i){e.beginPath(),
e.moveTo(t[0].x,t[0].y);for(const i of t)e.lineTo(i.x,i.y);e.closePath(),e.stroke(),i&&e.fill()}function g(e,t){let i=[];t!==r.LINESTYLE_SOLID&&(i=function(e,t){return[[e.lineWidth,2*e.lineWidth],[5*e.lineWidth,6*e.lineWidth],[6*e.lineWidth,6*e.lineWidth],[e.lineWidth,4*e.lineWidth],[2*e.lineWidth,e.lineWidth]][t-1]}(e,t)),e.setLineDash(i)}function f(e,t,i,s,r){isFinite(t)&&isFinite(s)&&isFinite(i)&&isFinite(r)&&(e.save(),e.beginPath(),e.moveTo(t,i),e.lineTo(s,r),e.stroke(),e.restore())}},918922:(e,t,i)=>{"use strict";i.d(t,{extendAndClipLineSegment:()=>h,getArrowPoints:()=>d,optimalBarWidth:()=>u,optimalCandlestickWidth:()=>p,optimalHiLoWidth:()=>_,interactionTolerance:()=>m,coordinateIsValid:()=>g,setValidLineStyle:()=>f,fillScaledRadius:()=>v,strokeScaledRadius:()=>S});var s=i(86441),r=i(5531),n=i(242786),o=i(486028),a=i(664114);const l={line:13,minDistanceBetweenPoints:10,series:14,curve:10,anchor:13,esd:4},c={line:3,minDistanceBetweenPoints:5,series:2,curve:3,anchor:2,esd:0};function h(e,t,i,n,o,a){if((0,s.equalPoints)(e,t))return null;const l=new s.Point(0,0),c=new s.Point(i,n);if(o){if(a){const i=(0,r.intersectLineAndBox)((0,s.lineThroughPoints)(e,t),(0,s.box)(l,c));return Array.isArray(i)?i:null}{const i=(0,r.intersectRayAndBox)(t,e,(0,s.box)(l,c));return null===i||(0,s.equalPoints)(t,i)?null:(0,s.lineSegment)(t,i)}}if(a){const i=(0,r.intersectRayAndBox)(e,t,(0,s.box)(l,c));return null===i||(0,s.equalPoints)(e,i)?null:(0,s.lineSegment)(e,i)}{const i=(0,r.intersectLineSegmentAndBox)((0,s.lineSegment)(e,t),(0,s.box)(l,c));return Array.isArray(i)?i:null}}function d(e,t,i,s){const r=.5*i,n=Math.sqrt(2),o=t.subtract(e),a=o.normalized();let l=5*i;s&&(l=Math.min(l,.35*o.length()));const c=1*r;if(l*n*.2<=c)return[];const h=a.scaled(l),d=t.subtract(h),u=a.transposed(),p=1*l,_=u.scaled(p),m=d.add(_),g=d.subtract(_),f=m.subtract(t).normalized().scaled(c),v=g.subtract(t).normalized().scaled(c),S=t.add(f),y=t.add(v),b=r*(n-1),w=u.scaled(b),P=Math.min(l-1*r/n,r*n*1),C=a.scaled(P),T=t.subtract(w),x=t.add(w),I=t.subtract(C);return[[m,S],[g,y],[T,I.subtract(w)],[x,I.add(w)]]}function u(e,t){return t=t||1,Math.floor(.3*e*t)}function p(e,t){if(e>=2.5&&e<=4)return Math.floor(3*t);const i=1-.2*Math.atan(Math.max(4,e)-4)/(.5*Math.PI),s=Math.floor(e*i*t),r=Math.floor(e*t),n=Math.min(s,r);return Math.max(Math.floor(t),n)}function _(e){return.4*e}function m(){return(0,n.lastMouseOrTouchEventInfo)().isTouch?l:c}function g(e){return null!=e&&!(0,o.isNaN)(e)}function f(e,t){void 0!==t&&(0,a.setLineStyle)(e,t)}function v(e,t){const i=Math.max(1,Math.floor(t))%2?.5:0;return Math.round(e*t)+i}function S(e,t,i){const s=Math.max(1,Math.floor(t))%2?.5:0;return Math.round(e*t)+(s!==i%2?.5:0)}},68976:(e,t,i)=>{"use strict";i.d(t,{HorizontalLineRenderer:()=>a});var s=i(777277),r=i(664114),n=i(918922),o=i(289763);class a{constructor(){this._data=null,this._hitTest=new s.HitTestResult(s.HitTestResult.REGULAR)}setData(e){this._data=e}setHitTest(e){this._hitTest=e}hitTest(e){
if(null===this._data||!1===this._data.visible||null===this._hitTest)return null;const t=(0,n.interactionTolerance)().line,i=Math.abs(e.y-this._data.y)<=t+this._data.linewidth/2,s=void 0===this._data.left||this._data.left-e.x<=t,r=void 0===this._data.right||e.x-this._data.right<=t;return i&&s&&r?this._hitTest:null}draw(e,t){if(null===this._data)return;if(!1===this._data.visible)return;if(this._data.y<-this._data.linewidth/2||this._data.y>t.cssHeight+this._data.linewidth/2)return;const i=t.pixelRatio;e.lineCap="butt",e.strokeStyle=this._data.color,e.lineWidth=Math.max(1,Math.floor(this._data.linewidth*i)),void 0!==this._data.linestyle&&(0,r.setLineStyle)(e,this._data.linestyle);const s=void 0!==this._data.left?Math.max(this._data.left,0):0,n=void 0!==this._data.right?Math.min(this._data.right,t.cssWidth):t.cssWidth,a=Math.round(this._data.y*i),l=Math.round(s*i),c=Math.round(n*i),h=this._data.excludeBoundaries;void 0!==h&&(e.save(),(0,o.addExclusionArea)(e,t,h)),(0,r.drawHorizontalLine)(e,a,l,c),void 0!==this._data.excludeBoundaries&&e.restore()}}},856996:(e,t,i)=>{"use strict";function s(e,t){return e.pixelRatio===t.pixelRatio}i.d(t,{areEqualPaneRenderParams:()=>s})},409353:(e,t,i)=>{"use strict";var s;i.d(t,{LineEnd:()=>s}),function(e){e[e.Normal=0]="Normal",e[e.Arrow=1]="Arrow",e[e.Circle=2]="Circle"}(s||(s={}))},507967:(e,t,i)=>{"use strict";i.d(t,{PaneRendererLine:()=>l});var s=i(86441),r=i(204652),n=i(777277),o=i(918922),a=i(664114);class l{constructor(e){this._data=e}hitTest(e,t){var i,a,l,c;const h=(0,o.interactionTolerance)().series+this._data.lineWidth/2;let d=null!==(a=null===(i=this._data.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==a?a:0,u=(null!==(c=null===(l=this._data.visibleItemsRange)||void 0===l?void 0:l.endItemIndex)&&void 0!==c?c:this._data.items.length)-1;for(;u-d>2;){const t=Math.round((u+d)/2);this._data.items[t].x<=e.x?d=t:u=t}d=Math.max(1,d-1),u=Math.min(this._data.items.length-1,u+1);for(let t=d;t<=u;++t){const i=this._data.items[t-1],o=this._data.items[t],a=i.x,l=o.x;if((0,r.distanceToSegment)(new s.Point(a,i.y),new s.Point(l,o.y),new s.Point(e.x,e.y)).distance<=h)return this._data.hittest?this._data.hittest:new n.HitTestResult(n.HitTestResult.REGULAR)}return null}draw(e,t){e.save(),e.scale(t.pixelRatio,t.pixelRatio),e.lineCap="square",e.lineJoin="round",e.strokeStyle=this._data.lineColor,e.fillStyle=this._data.lineColor,e.lineWidth=this._data.lineWidth,(0,a.setLineStyle)(e,this._data.lineStyle),(0,o.setValidLineStyle)(e,this._data.lineStyle),this._data.simpleMode?this._drawSimpleMode(e,t.pixelRatio):this._drawLines(e),e.restore()}_drawSimpleMode(e,t){var i,s,r,n;if(e.beginPath(),this._walkLine(e,this._data.items,!1,NaN),e.stroke(),this._data.withMarkers){e.save(),e.scale(1/t,1/t);const o=Math.max(1,Math.floor(t))%2/2,a=(this._data.lineWidth+2)*t+o,l=2*Math.PI;e.beginPath();const c=null!==(s=null===(i=this._data.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==s?s:0
;for(let i=(null!==(n=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==n?n:this._data.items.length)-1+1;i-- >=c;){const s=this._data.items[i];if(s){const i=Math.round(s.x*t)+o,r=s.y*t;e.moveTo(i,r),e.arc(i,r,a,0,l)}}e.fill(),e.restore()}}_walkLine(e,t,i,s,r){var n,a,l,c;if(!t)return;const h=.25*this._data.barSpacing;let d,u,p,_,m;const g=o.coordinateIsValid,f=r?0:null!==(a=null===(n=this._data.visibleItemsRange)||void 0===n?void 0:n.startItemIndex)&&void 0!==a?a:0,v=r?t.length-1:Math.min((null!==(c=null===(l=this._data.visibleItemsRange)||void 0===l?void 0:l.endItemIndex)&&void 0!==c?c:t.length)-1,t.length-1);for(let e=f;e<=v;e++){const i=t[e];if(g(i.y)){u=i,d=e;break}}if(void 0!==d&&void 0!==u)for(let r=d;r<=v;r++){_=t[r],m=t[r+1]||{};const n=Math.round(_.x);if(g(_.y))if(p&&g(p.y))e.lineTo(n,_.y),i&&!g(m.y)&&e.lineTo(n,s);else if(m&&g(m.y))i?(r!==d&&e.lineTo(n,s),e.lineTo(n,_.y)):e.moveTo(n,_.y);else if(i){if(0===r)continue;r!==d&&e.lineTo(n-h,s),e.lineTo(n-h,_.y),e.lineTo(n+h,_.y),e.lineTo(n+h,s)}else e.moveTo(n-h,_.y),e.lineTo(n+h,_.y);p=_}}_drawLines(e){var t,i,s,r;if(!this._data.items.length)return;let n,a,l;const c=.25*this._data.barSpacing,h=o.coordinateIsValid;e.beginPath();const d=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,u=(null!==(r=null===(s=this._data.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==r?r:this._data.items.length)-1,p=this._data.items[d];p&&e.moveTo(p.x,p.y);let _,m=e.strokeStyle,g=e.lineWidth;for(let t=d+1;t<=u;++t){let i,s,r;n=this._data.items[t-1],a=this._data.items[t],l=this._data.items[t+1],a.style&&!this._data.forceLineColor?(i=a.style.color,s=a.style.width,r=a.style.style):(i=this._data.lineColor,s=this._data.lineWidth,r=this._data.lineStyle),this._data.ignorePaletteLineWidth&&(s=this._data.lineWidth);(i!==m||s!==g||r!==_)&&(m=i,g=s,_=r,e.stroke(),e.beginPath(),e.strokeStyle=i,e.lineWidth=s,(0,o.setValidLineStyle)(e,r),e.moveTo(n.x,n.y)),f=n,S=l,h((v=a).y)&&(h(f.y)?e.lineTo(v.x,v.y):S&&h(S.y)?e.moveTo(v.x,v.y):(e.moveTo(v.x-c,v.y),e.lineTo(v.x+c,v.y)))}var f,v,S;e.stroke()}}},716384:(e,t,i)=>{"use strict";i.d(t,{MediaCoordinatesPaneRenderer:()=>r});var s=i(327714);class r{draw(e,t){new s.CanvasRenderingTarget2D(e,(0,s.size)({width:t.cssWidth,height:t.cssHeight}),(0,s.size)({width:t.physicalWidth,height:t.physicalHeight})).useMediaCoordinateSpace((e=>this._drawImpl(e)))}drawBackground(e,t){new s.CanvasRenderingTarget2D(e,(0,s.size)({width:t.cssWidth,height:t.cssHeight}),(0,s.size)({width:t.physicalWidth,height:t.physicalHeight})).useMediaCoordinateSpace((e=>this._drawBackgroundImpl(e)))}_drawBackgroundImpl(e){}}},827175:(e,t,i)=>{"use strict";i.d(t,{RectangleRenderer:()=>d});var s=i(650151),r=i(86441),n=i(934026),o=i(204652),a=i(777277),l=i(602564),c=i(664114),h=i(284269);class d{constructor(e,t,i){this._data=null,this._hitTestResult=e||new a.HitTestResult(a.HitTestResult.MOVEPOINT),this._backHitTestResult=t||new a.HitTestResult(a.HitTestResult.MOVEPOINT_BACKGROUND),
this._forceOverrideTransparency=Boolean(i)}setData(e){this._data=e}hitTest(e,t){if(null===this._data||this._data.points.length<2||this._data.nohittest)return null;const[i,s]=this._getPointsInPhysicalSpace(t),n=new r.Point(s.x,i.y),a=new r.Point(i.x,s.y),l=new r.Point(e.x*t.pixelRatio,e.y*t.pixelRatio),c=this._extendAndHitTestLineSegment(l,i,n,t);if(null!==c)return c;const h=this._extendAndHitTestLineSegment(l,a,s,t);if(null!==h)return h;let d=(0,o.distanceToSegment)(n,s,l);return d.distance<=3?this._hitTestResult:(d=(0,o.distanceToSegment)(i,a,l),d.distance<=3?this._hitTestResult:this._data.fillBackground?this._hitTestBackground(l,i,s,t):null)}getColor(){const e=(0,s.ensure)(this._data);return void 0===e.transparency?e.backcolor:(0,l.generateColor)(e.backcolor,e.transparency,this._forceOverrideTransparency)}draw(e,t){if(null===this._data||this._data.points.length<2||this._data.linewidth<=0&&!this._data.fillBackground)return;e.save();const[i,s]=this._getPointsInPhysicalSpace(t),r=this._data.linewidth?Math.max(1,Math.floor(this._data.linewidth*t.pixelRatio)):0,n=this._data.fillBackground?this.getColor():void 0,o=Math.max(1,Math.floor(t.pixelRatio));(0,c.fillRectWithBorder)(e,i.x,i.y,s.x,s.y,n,this._data.color,r,h.LINESTYLE_SOLID,this._data.extendLeft,this._data.extendRight,"center",t.physicalWidth,this._data.includeRightEdge&&1===o?1:0),e.restore()}_getPointsInPhysicalSpace(e,t=0){const i=(0,s.ensureNotNull)(this._data),[n,o]=i.points,a=e.pixelRatio,l=Math.min(n.x,o.x),c=Math.max(n.x,o.x),h=Math.min(n.y,o.y),d=Math.max(n.y,o.y),u=Math.round(l*a)+t,p=Math.round(c*a)+t,_=Math.round(h*a)+t,m=Math.round(d*a)+t;return[new r.Point(u,_),new r.Point(p,m)]}_extendAndHitTestLineSegment(e,t,i,s){const r=this._extendAndClipLineSegment(t,i,s);if(null!==r){if((0,o.distanceToSegment)(r[0],r[1],e).distance<=3)return this._hitTestResult}return null}_extendAndClipLineSegment(e,t,i){const n=(0,s.ensureNotNull)(this._data);if((0,r.equalPoints)(e,t)&&!n.extendLeft&&!n.extendRight)return null;const o=i.physicalWidth,a=Math.min(e.x,t.x),l=Math.max(e.x,t.x),c=n.extendLeft?0:Math.max(a,0),h=n.extendRight?o:Math.min(l,o);return c>h||h<=0||c>=o?null:[new r.Point(c,e.y),new r.Point(h,t.y)]}_hitTestBackground(e,t,i,s){const o=this._extendAndClipLineSegment(t,i,s);return null!==o&&(0,n.pointInBox)(e,(0,r.box)(o[0],o[1]))?this._backHitTestResult:null}}},125348:(e,t,i)=>{"use strict";var s;i.d(t,{StatsPosition:()=>s}),function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"}(s||(s={}))},270349:(e,t,i)=>{"use strict";i.d(t,{StepLineDecoration:()=>s,PaneRendererStepLine:()=>m});var s,r=i(204652),n=i(777277),o=i(86441),a=i(624595),l=i(918922),c=i(664114),h=i(602564);!function(e){e[e.None=0]="None",e[e.Diamonds=1]="Diamonds"}(s||(s={}));class d{initialize(e,t,i,s){var r,n,o,a;const l=e.lineStyle;t.lineCap="butt",t.lineJoin="round";const h=Math.max(Math.floor(null!==(n=null===(r=s.style)||void 0===r?void 0:r.width)&&void 0!==n?n:e.lineWidth*i.pixelRatio));void 0!==l&&(0,c.setLineStyle)(t,l);const d=h%2?.5:0
;t.moveTo(Math.round(s.x*i.pixelRatio)+d,Math.round(s.y*i.pixelRatio)+d),t.strokeStyle=null!==(a=null===(o=s.style)||void 0===o?void 0:o.color)&&void 0!==a?a:e.lineColor,t.lineWidth=h}finishFragment(e){e.stroke()}hitTest(e,t,i,s,r){return d.hitTest(e,t,i,s,r)}applyColor(e,t){e.strokeStyle=t}applyLineWidth(e,t){e.lineWidth=t}drawItem(e,t,i,s){e.lineTo(i.x,i.y),void 0!==s&&(e.lineTo(s.x,i.y),e.lineTo(s.x,s.y))}static hitTest(e,t,i,s,n){var a,c;const h=t.pixelRatio,d=null!==(c=null===(a=i.style)||void 0===a?void 0:a.width)&&void 0!==c?c:e.lineWidth,u=Math.max(1,Math.floor(d*h))%2?.5:0,p=(0,l.interactionTolerance)().series+d/2;let _;if(isNaN(s.y)){const e=i.x+u,t=s.x+u,a=new o.Point(e,i.y),l=new o.Point(t,i.y);_=(0,r.distanceToSegment)(a,l,n).distance}else{const t=Math.round(s.x-e.barSpacing/2*h)+u,a=new o.Point(t,i.y),l=new o.Point(t,s.y);_=Math.min((0,r.distanceToSegment)(i,a,n).distance,(0,r.distanceToSegment)(a,l,n).distance,(0,r.distanceToSegment)(l,s,n).distance)}return _<=p}}class u{constructor(){this._lineWidth=1}initialize(e,t,i,s){var r,n,o,a;this.applyColor(t,null!==(n=null===(r=s.style)||void 0===r?void 0:r.color)&&void 0!==n?n:e.lineColor),this._lineWidth=Math.max(Math.floor(null!==(a=null===(o=s.style)||void 0===o?void 0:o.width)&&void 0!==a?a:e.lineWidth*i.pixelRatio))}finishFragment(e){e.fill()}drawItem(e,t,i,s,r){if(r&&void 0!==s&&!Number.isNaN(s.y)){e.save(),e.translate(s.x,s.y),e.rotate(Math.PI/4);const i=this._scaleByLineWidth(this._lineWidth);e.scale(i,i),this._drawItemRotatedAndTranslated(e,t),e.restore()}}applyLineWidth(e,t){this._lineWidth=t}hitTest(e,t,i,s,r){var n,a;if(!s.valIsNotSameAsPrev)return!1;const l=Math.round((i.x+s.x)/2),c=new o.Point(l,s.y),h=r.subtract(c),d=Math.max(Math.floor(null!==(a=null===(n=i.style)||void 0===n?void 0:n.width)&&void 0!==a?a:e.lineWidth*t.pixelRatio));return this._hitTestTranslated(h,d)}_scaleByLineWidth(e){return Math.sqrt(e)}}class p extends u{applyColor(e,t){e.fillStyle=t}_hitTestTranslated(e,t){return Math.abs(e.x)+Math.abs(e.y)<8*this._scaleByLineWidth(t)/2}_drawItemRotatedAndTranslated(e,t){(0,c.drawRoundRect)(e,-4,-4,8,8,2,!0)}}class _ extends u{applyColor(e,t){e.fillStyle=(0,h.applyTransparency)(t,85)}_hitTestTranslated(e,t){return Math.abs(e.x)+Math.abs(e.y)<21*this._scaleByLineWidth(t)/2}_drawItemRotatedAndTranslated(e,t){(0,c.drawRoundRect)(e,-10.5,-10.5,21,21,5,!0)}}class m{constructor(e,t){this._data=null,this._data=null!=e?e:null,this._extendLineToLastConfirmedBar=Boolean(t)}setData(e){this._data=e}hitTest(e,t){const i=this._data;if(null===i||0===i.items.length)return null;const{items:r,items:{length:l},lastConfirmedSeriesBarCoordinate:c,visibleItemsRange:{startItemIndex:h,endItemIndex:u}={startItemIndex:0,endItemIndex:l}}=i,p=i.decoration===s.Diamonds?[new d,new _]:[new d];const m=(0,a.lowerbound)(r,e,((e,t)=>e.x<=t.x),h,u),g=Math.max(0,m-1),f=Math.min(l,m+1);for(let s=g;s<f;s++){const a=r[s],h=r[s+1];if(h){if(p.some((s=>s.hitTest(i,t,a,h,e))))return new n.HitTestResult(n.HitTestResult.REGULAR)
}else if(this._extendLineToLastConfirmedBar&&void 0!==c&&f===l&&a.x<t.cssWidth&&a.x<c){const s=(0,o.point)(c,a.y);if(d.hitTest(i,t,a,s,e))return new n.HitTestResult(n.HitTestResult.REGULAR)}}return null}draw(e,t){if(null===this._data||0===this._data.items.length)return;e.save();(this._data.decoration===s.Diamonds?[new d,new p,new _]:[new d]).forEach((i=>this._drawImpl(e,t,i))),e.restore()}_drawImpl(e,t,i){var s,r,n,a,l,c,h,d,u,p,_,m,g,f,v,S;if(null===this._data||0===this._data.items.length)return;const{lineWidth:y,lineColor:b,items:w}=this._data,P=t.pixelRatio;let C=Math.max(Math.floor(null!==(r=null===(s=w[0].style)||void 0===s?void 0:s.width)&&void 0!==r?r:y*P)),T=C%2?.5:0;i.initialize(this._data,e,t,w[0]);const x=null!==(a=null===(n=this._data.visibleItemsRange)||void 0===n?void 0:n.startItemIndex)&&void 0!==a?a:0,I=null!==(c=null===(l=this._data.visibleItemsRange)||void 0===l?void 0:l.endItemIndex)&&void 0!==c?c:w.length,M=this._data.barSpacing;if(!(I<=x)){e.beginPath(),i.applyColor(e,null!==(d=null===(h=w[x].style)||void 0===h?void 0:h.color)&&void 0!==d?d:b);for(let s=x;s<I;s++){const r=w[s],n=s===I-1?null:w[s+1];let a=0;this._data.extendToBarsEndings&&(s===x&&(a=-this._data.barSpacing/2),s===I-1&&(a=this._data.barSpacing/2));const l=Math.round((r.x+a)*P)+T,c=Math.round(r.y*P)+T;if(!n){if(i.drawItem(e,t,(0,o.point)(l,c)),this._extendLineToLastConfirmedBar&&void 0!==this._data.lastConfirmedSeriesBarCoordinate&&l<t.physicalWidth&&r.x<this._data.lastConfirmedSeriesBarCoordinate){const s=Math.round((this._data.lastConfirmedSeriesBarCoordinate+a)*P)+T;l<s&&i.drawItem(e,t,(0,o.point)(Math.min(t.physicalWidth,s),c),void 0,!0)}continue}const h=isNaN(n.y),d=Math.round((n.x-M/2)*P)+T,L=Math.round(n.y*P)+T;i.drawItem(e,t,(0,o.point)(l,c),(0,o.point)(d,L),n.valIsNotSameAsPrev);const A=null!==(p=null===(u=r.style)||void 0===u?void 0:u.color)&&void 0!==p?p:b,k=null!==(m=null===(_=r.style)||void 0===_?void 0:_.width)&&void 0!==m?m:y,E=null!==(f=null===(g=n.style)||void 0===g?void 0:g.color)&&void 0!==f?f:b,D=null!==(S=null===(v=n.style)||void 0===v?void 0:v.width)&&void 0!==S?S:y,B=A!==E,V=k!==D;(B||V||h)&&(i.finishFragment(e),B&&i.applyColor(e,E),V&&(C=Math.max(1,Math.floor(D*P)),T=C%2?.5:0,i.applyLineWidth(e,C)),e.beginPath(),e.moveTo(d,L))}i.finishFragment(e)}}}},861812:(e,t,i)=>{"use strict";i.d(t,{calculateLabelPosition:()=>u,getTextBoundaries:()=>p,wordWrap:()=>_,TextRenderer:()=>x});var s=i(86441),r=i(650151),n=i(934026),o=i(561626),a=i(777277),l=i(664114),c=i(486028),h=i(289763),d=i(284269);function u(e,t,i,r,n){const o=.5*(t.x+i.x);let a=i.y;return t.y>i.y?(a-=e.height/2+r.y,a=Math.max(e.height/2,a)):(a+=e.height/2+r.y,a=Math.min(n-e.height/2,a)),new s.Point(o,a)}function p(e,t,i){if(e.isOutOfScreen(t,i))return null;const s=e.getPolygonPoints();return 0===s.length?null:s}function _(e,t,i){i=(0,c.isString)(i)?parseInt(i):i,e+="";const s=!(0,c.isNumber)(i)||!isFinite(i)||i<=0?e.split(/\r\n|\r|\n|$/):e.split(/[^\S\r\n]*(?:\r\n|\r|\n|$)/);if(s[s.length-1]||s.pop(),!(0,c.isNumber)(i)||!isFinite(i)||i<=0)return s
;const r=[];for(let e=0;e<s.length;e++){const n=s[e],o=(0,h.measureText)(n,t).width;if(o<=i){r.push(n);continue}const a=n.split(/([-)\]},.!?:;])|(\s+)/);let l=0;for(;a.length;){let e=~~(i/o*(a.length+2)/3);if(e<=0||(0,h.measureText)(a.slice(0,3*e-1).join(""),t).width<=i)for(;(0,h.measureText)(a.slice(0,3*(e+1)-1).join(""),t).width<=i;)e++;else for(;e>0&&(0,h.measureText)(a.slice(0,3*--e-1).join(""),t).width>i;);if(e>0)r.push(a.slice(0,3*e-1).join("")),a.splice(0,3*e);else{const e=a[0]+(a[1]||"");if(l=1===l?1:~~(i/(0,h.measureText)(e,t).width*e.length),(0,h.measureText)(e.substring(0,l),t).width<=i)for(;(0,h.measureText)(e.substring(0,l+1),t).width<=i;)l++;else for(;l>1&&(0,h.measureText)(e.substring(0,--l),t).width>i;);l<1&&(l=1),r.push(e.substring(0,l)),a[0]=e.substring(l),a[1]=""}if((0,h.measureText)(a.join(""),t).width<=i){r.push(a.join(""));break}}}return r}function m(e,t,i){if(0===i)return e.clone();const r=(e.x-t.x)*Math.cos(i)-(e.y-t.y)*Math.sin(i)+t.x,n=(e.x-t.x)*Math.sin(i)+(e.y-t.y)*Math.cos(i)+t.y;return new s.Point(r,n)}function g(e,t){const i=Math.round(t+2*b(e)+2*S(e));return i%2?i+1:i}function f(e,t){return P(e)*t+w(e)*(t-1)+2*y(e)+2*v(e)}function v(e){return void 0!==e.boxPaddingVert?e.boxPaddingVert*T(e):void 0!==e.boxPadding?e.boxPadding*T(e):P(e)/3}function S(e){return void 0!==e.boxPaddingHorz?e.boxPaddingHorz*T(e):void 0!==e.boxPadding?e.boxPadding*T(e):P(e)/3}function y(e){return(e.backgroundVertInflate||0)*T(e)}function b(e){return(e.backgroundHorzInflate||0)*T(e)}function w(e){return(e.padding||0)*T(e)}function P(e){return Math.ceil(C(e)*T(e))}function C(e){return e.fontsize||e.fontSize||30}function T(e){const t=Math.min(1,Math.max(.2,Math.min(e.scaleX||1,e.scaleY||1)));if(1===t)return t;const i=C(e);return Math.ceil(t*i)/i}class x{constructor(e,t){this._data=null,this._internalData=null,this._boxSize=null,this._polygonPoints=null,this._linesInfo=null,this._fontInfo=null,this._hittest=t||new a.HitTestResult(a.HitTestResult.MOVEPOINT,{areaName:a.AreaName.Text}),void 0!==e&&this.setData(e)}setData(e){null!==e?(e.horzTextAlign||(e.horzTextAlign=e.horzAlign),!function(e,t){if(null===e||null===t)return null===e==(null===t);if(void 0===e.points!=(void 0===t.points))return!1;if(void 0!==e.points&&void 0!==t.points){if(e.points.length!==t.points.length)return!1;for(let r=0;r<e.points.length;++r)if(i=e.points[r],s=t.points[r],i.x!==s.x||i.y!==s.y)return!1}var i,s
;return e.text===t.text&&e.vertAlign===t.vertAlign&&e.horzAlign===t.horzAlign&&e.horzTextAlign===t.horzTextAlign&&e.font===t.font&&e.offsetX===t.offsetX&&e.offsetY===t.offsetY&&e.bold===t.bold&&e.italic===t.italic&&e.fontsize===t.fontsize&&e.fontSize===t.fontSize&&e.backgroundRoundRect===t.backgroundRoundRect&&e.forceTextAlign===t.forceTextAlign&&e.wordWrapWidth===t.wordWrapWidth&&e.forceCalculateMaxLineWidth===t.forceCalculateMaxLineWidth&&e.padding===t.padding&&e.scaleY===t.scaleY&&e.scaleX===t.scaleX&&e.highlightBorder===t.highlightBorder&&e.backgroundHorzInflate===t.backgroundHorzInflate&&e.backgroundVertInflate===t.backgroundVertInflate&&e.boxPadding===t.boxPadding&&e.boxPaddingVert===t.boxPaddingVert&&e.boxPaddingHorz===t.boxPaddingHorz&&e.angle===t.angle&&e.maxHeight===t.maxHeight&&(0,c.deepEquals)(e.boxShadow,t.boxShadow)[0]}(this._data,e)?(this._data=e,this._internalData=null,this._boxSize=null,this._polygonPoints=null,this._linesInfo=null,this._fontInfo=null):this._data=e):this._data=null}hitTest(e){return null===this._data||void 0===this._data.points||0===this._data.points.length?null:(0,n.pointInPolygon)(e,this.getPolygonPoints())?this._hittest:null}doesIntersectWithBox(e){return null!==this._data&&void 0!==this._data.points&&0!==this._data.points.length&&(0,n.pointInBox)(this._data.points[0],e)}measure(){if(null===this._data)return{width:0,height:0};const e=this._getBoxSize();return{width:e.boxWidth,height:e.boxHeight}}rect(){if(null===this._data)return{x:0,y:0,width:0,height:0};const e=this._getInternalData();return{x:e.boxLeft,y:e.boxTop,width:e.boxWidth,height:e.boxHeight}}isOutOfScreen(e,t){if(null===this._data||void 0===this._data.points||0===this._data.points.length)return!0;const i=this._getInternalData();if(i.boxLeft+i.boxWidth<0||i.boxLeft>e){const i=(0,s.box)(new s.Point(0,0),new s.Point(e,t));return this.getPolygonPoints().every((e=>!(0,n.pointInBox)(e,i)))}return!1}setPoints(e,t){(0,r.ensureNotNull)(this._data).points=e,this._hittest=t||new a.HitTestResult(a.HitTestResult.MOVEPOINT)}fontStyle(e){return null===this._data?"":this._getFontInfo().fontStyle}wordWrap(e,t,i){return _(e,i||this.fontStyle(),t)}draw(e,t){if(null===this._data||void 0===this._data.points||0===this._data.points.length)return;if(this.isOutOfScreen(t.cssWidth,t.cssHeight))return;const i=t.pixelRatio,s=this._getInternalData(),r=this._getRotationPoint().scaled(i);e.save(),e.translate(r.x,r.y),e.rotate(this._data.angle||0),e.translate(-r.x,-r.y);const n=this._getFontInfo().fontSize;e.textBaseline=s.textBaseLine,e.textAlign=s.textAlign,e.font=this.fontStyle();const{scaledLeft:o,scaledRight:a,scaledTop:c,scaledBottom:u}=function(e,t){const i=Math.round(e.boxLeft*t),s=Math.round(e.boxTop*t);return{scaledLeft:i,scaledRight:i+Math.round(e.boxWidth*t),scaledTop:s,scaledBottom:s+Math.round(e.boxHeight*t)}}(s,i);if(this._data.backgroundColor||this._data.borderColor||this._data.highlightBorder&&this._data.wordWrapWidth){const t=this._data.borderWidth||Math.max(n/12,1),s=Math.round(t*i),r=s/2;let h=!1;if(this._data.boxShadow){e.save()
;const{shadowColor:t,shadowBlur:i,shadowOffsetX:s=0,shadowOffsetY:r=0}=this._data.boxShadow;e.shadowColor=t,e.shadowBlur=i,e.shadowOffsetX=s,e.shadowOffsetY=r,h=!0}if(this._data.backgroundRoundRect)this._data.backgroundColor&&((0,l.drawRoundRect)(e,o,c,a-o,u-c,this._data.backgroundRoundRect*i),e.fillStyle=this._data.backgroundColor,e.fill(),h&&(e.restore(),h=!1)),this._data.borderColor&&((0,l.drawRoundRect)(e,o-r,c-r,a-o+s,u-c+s,this._data.backgroundRoundRect*i+s),e.strokeStyle=this._data.borderColor,e.lineWidth=s,e.stroke(),h&&(e.restore(),h=!1));else if(this._data.backgroundColor&&(e.fillStyle=this._data.backgroundColor,e.fillRect(o,c,a-o,u-c),h&&(e.restore(),h=!1)),this._data.borderColor||this._data.highlightBorder){let t;this._data.borderColor?(e.strokeStyle=this._data.borderColor,t=s):(e.strokeStyle=this._data.color,(0,l.setLineStyle)(e,d.LINESTYLE_DASHED),t=Math.max(1,Math.floor(i))),e.lineWidth=t,e.beginPath(),e.moveTo(o-t/2,c-t/2),e.lineTo(o-t/2,u+t/2),e.lineTo(a+t/2,u+t/2),e.lineTo(a+t/2,c-t/2),e.lineTo(o-t/2,c-t/2),e.stroke(),h&&e.restore()}}e.fillStyle=this._data.color;const p=(o+Math.round(s.textStart*i))/i,_=.05*n;let m=(c+Math.round((s.textTop+_)*i))/i;const g=w(this._data),f=this.getLinesInfo();for(const t of f.lines)(0,h.drawScaled)(e,i,(()=>e.fillText(t,p,m))),m+=n+g;e.restore()}getPolygonPoints(){if(null!==this._polygonPoints)return this._polygonPoints;if(null===this._data)return[];const e=this._data.angle||0,{boxLeft:t,boxTop:i,boxWidth:r,boxHeight:n}=this._getInternalData(),o=this._getRotationPoint();return this._polygonPoints=[m(new s.Point(t,i),o,e),m(new s.Point(t+r,i),o,e),m(new s.Point(t+r,i+n),o,e),m(new s.Point(t,i+n),o,e)],this._polygonPoints}getLinesInfo(){if(null===this._linesInfo){const e=(0,r.ensureNotNull)(this._data);let t=this.wordWrap(e.text,e.wordWrapWidth);if(void 0!==e.maxHeight){const i=function(e){const t=(0,r.ensureDefined)(e.maxHeight),i=P(e),s=w(e);return Math.floor((t+s)/(i+s))}(e);t.length>i&&(t=t.slice(0,i))}this._linesInfo={linesMaxWidth:this._getLinesMaxWidth(t),lines:t}}return this._linesInfo}_getLinesMaxWidth(e){const t=this.fontStyle();if(null!==this._data&&this._data.wordWrapWidth&&!this._data.forceCalculateMaxLineWidth)return this._data.wordWrapWidth*T(this._data);let i=0;for(const s of e)i=Math.max(i,(0,h.measureText)(s,t).width);return i}_getInternalData(){if(null!==this._internalData)return this._internalData;const e=(0,r.ensureNotNull)(this._data),t=this._getBoxSize(),i=t.boxWidth,s=t.boxHeight,n=(0,r.ensureDefined)(e.points)[0];let a=n.y;switch(e.vertAlign){case"bottom":a-=s+e.offsetY;break;case"middle":a-=s/2;break;case"top":a+=e.offsetY}let l=n.x;const c=S(e),h=v(e),d=b(e)+c;let u;const p=a+(y(e)+h)+P(e)/2;let _;switch(e.horzAlign){case"left":l+=e.offsetX;break;case"center":l-=i/2;break;case"right":l-=i+e.offsetX}switch((0,r.ensureDefined)(e.horzTextAlign)){case"left":_="start",u=l+d,(0,o.isRtl)()&&(e.forceTextAlign?_="left":(u=l+i-d,_="right"));break;case"center":_="center",u=l+i/2;break;case"right":_="end",u=l+i-d,(0,
o.isRtl)()&&e.forceTextAlign&&(_="right")}return this._internalData={boxLeft:l,boxTop:a,boxWidth:i,boxHeight:s,textStart:u-l,textTop:p-a,textAlign:_,textBaseLine:"middle"},this._internalData}_getFontInfo(){if(null===this._fontInfo){const e=(0,r.ensureNotNull)(this._data),t=P(e),i=(e.bold?"bold ":"")+(e.italic?"italic ":"")+t+"px "+e.font;this._fontInfo={fontStyle:i,fontSize:t}}return this._fontInfo}_getBoxSize(){if(null===this._boxSize){const e=this.getLinesInfo(),t=(0,r.ensureNotNull)(this._data);this._boxSize={boxWidth:g(t,e.linesMaxWidth),boxHeight:f(t,e.lines.length)}}return this._boxSize}_getRotationPoint(){const{boxLeft:e,boxTop:t,boxWidth:i,boxHeight:n}=this._getInternalData(),{horzAlign:o,vertAlign:a}=(0,r.ensureNotNull)(this._data);let l,c;switch(o){case"center":l=e+i/2;break;case"left":l=e;break;case"right":l=e+i}switch(a){case"middle":c=t+n/2;break;case"top":c=t;break;case"bottom":c=t+n}return new s.Point(l,c)}}},804747:(e,t,i)=>{"use strict";i.d(t,{drawArrow:()=>d,TrendLineRenderer:()=>u});var s=i(650151),r=i(204652),n=i(409353),o=i(777277),a=i(664114),l=i(918922),c=i(289763);function h(e,t,i,s,r){t.save(),t.fillStyle="#000000",t.beginPath(),t.arc(e.x*r,e.y*r,i*r,0,2*Math.PI,!1),t.fill(),s.strokeWidth&&(t.lineWidth=s.strokeWidth,t.stroke()),t.restore()}function d(e,t,i,s,r,n=!1){if(t.subtract(e).length()<1)return;const o=(0,l.getArrowPoints)(e,t,s,n);for(let e=0;e<o.length;++e){const t=o[e][0],s=o[e][1];(0,a.drawLine)(i,t.x*r,t.y*r,s.x*r,s.y*r)}}class u{constructor(){this._data=null,this._hittest=new o.HitTestResult(o.HitTestResult.MOVEPOINT)}setData(e){this._data=e}setHitTest(e){this._hittest=e}draw(e,t){const i=this._data;if(null===i)return;if("points"in i&&i.points.length<2)return;const s=t.pixelRatio;void 0!==i.excludeBoundaries&&(e.save(),(0,c.addExclusionArea)(e,t,i.excludeBoundaries)),e.lineCap="butt",e.strokeStyle=i.color,e.lineWidth=Math.max(1,Math.floor(i.linewidth*s)),(0,a.setLineStyle)(e,i.linestyle);const r=i.points[0],n=i.points[1];let o=[];i.overlayLineEndings?o=[r.clone(),n.clone()]:this._drawEnds(e,[r,n],i.linewidth,s);const l=this._extendAndClipLineSegment(r,n,t);null!==l&&i.linewidth>0&&(l[0].x===l[1].x?(0,a.drawVerticalLine)(e,Math.round(l[0].x*s),l[0].y*s,l[1].y*s):l[0].y===l[1].y?(0,a.drawHorizontalLine)(e,Math.round(l[0].y*s),l[0].x*s,l[1].x*s):(0,a.drawLine)(e,l[0].x*s,l[0].y*s,l[1].x*s,l[1].y*s)),i.overlayLineEndings&&this._drawEnds(e,o,i.linewidth,s),void 0!==i.excludeBoundaries&&e.restore()}hitTest(e,t){const i=this._data;if(null===i)return null;if("points"in i&&i.points.length<2)return null;const s=(0,l.interactionTolerance)().line,n=i.points[0],o=i.points[1],a=this._extendAndClipLineSegment(n,o,t);if(null!==a){if((0,r.distanceToSegment)(a[0],a[1],e).distance<=s)return this._hittest}return null}_extendAndClipLineSegment(e,t,i){const r=(0,s.ensureNotNull)(this._data);return(0,l.extendAndClipLineSegment)(e,t,i.cssWidth,i.cssHeight,r.extendleft,r.extendright)}_drawEnds(e,t,i,r){const o=t[0],a=t[1],l=(0,s.ensureNotNull)(this._data);switch(l.leftend){case n.LineEnd.Arrow:
d(a,o,e,i,r);break;case n.LineEnd.Circle:h(o,e,i,(0,s.ensureDefined)(l.endstyle),r)}switch(l.rightend){case n.LineEnd.Arrow:d(o,a,e,i,r);break;case n.LineEnd.Circle:h(a,e,i,(0,s.ensureDefined)(l.endstyle),r)}}}},418562:(e,t,i)=>{"use strict";i.d(t,{VerticalLineRenderer:()=>a});var s=i(777277),r=i(664114),n=i(918922),o=i(289763);class a{constructor(){this._data=null,this._hitTest=new s.HitTestResult(s.HitTestResult.MOVEPOINT)}setData(e){this._data=e}setHitTest(e){this._hitTest=e}hitTest(e){if(null===this._data||null===this._hitTest)return null;const t=(0,n.interactionTolerance)().line,i=Math.abs(e.x-this._data.x)<=t+this._data.linewidth/2,s=void 0===this._data.top||this._data.top-e.y<=t,r=void 0===this._data.bottom||e.y-this._data.bottom<=t;return i&&s&&r?this._hitTest:null}draw(e,t){if(null===this._data)return;if(this._data.linewidth<=0)return;if(this._data.x<-this._data.linewidth/2||this._data.x>t.cssWidth+this._data.linewidth/2)return;const i=t.pixelRatio;e.lineCap="butt",e.strokeStyle=this._data.color,e.lineWidth=Math.max(1,Math.floor(this._data.linewidth*i)),void 0!==this._data.linestyle&&(0,r.setLineStyle)(e,this._data.linestyle);const s=void 0!==this._data.top?Math.max(this._data.top,0):0,n=void 0!==this._data.bottom?Math.min(this._data.bottom,t.cssHeight):t.cssHeight,a=Math.round(this._data.x*i),l=Math.floor(s*i),c=Math.ceil(n*i),h=this._data.excludeBoundaries;void 0!==h&&(e.save(),(0,o.addExclusionArea)(e,t,h)),(0,r.drawVerticalLine)(e,a,l,c),void 0!==h&&e.restore()}}},792268:(e,t,i)=>{"use strict";i.d(t,{sortSourcesPreOrdered:()=>s,sortSources:()=>r});const s={News:10000001,BarMarks:10000002,TimeScaleMarks:10000003,ChartEventsSource:10000004,Dividends:10000005,Splits:10000006,Earnings:10000007,RollDates:10000008,FutureContractExpiration:10000009,LineToolOrder:10000010,LineToolPosition:10000011,LineToolExecution:10000012,AlertLabel:10000013};function r(e){return[...e].sort(((e,t)=>e.zorder()-t.zorder()))}},445588:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PlotList:()=>u,mergeMinMax:()=>p,mergePlotRows:()=>_});var s=i(650151),r=i(624595),n=i(724912),o=i(817808),a=i(153026);const l=(0,o.getLogger)("Chart.PlotList"),c=30;function h(e){return e.index}function d(e){return e.value[0]}class u{constructor(e=null,t=null){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache=new Map,this._rowSearchCacheByIndex=new Map,this._rowSearchCacheByIndexWithoutEmptyValues=new Map,this._rowSearchCacheByTime=new Map,this._rowSearchCacheByTimeWithoutEmptyValues=new Map,this._plotFunctions=e||new Map,this._emptyValuePredicate=t}clear(){this._items=[],this._start=0,this._end=0,this._shareRead=!1,this._minMaxCache.clear(),this._invalidateSearchCaches()}first(){return this.size()>0?this._items[this._start]:null}last(){return this.size()>0?this._items[this._end-1]:null}firstIndex(){return this.size()>0?this._indexAt(this._start):null}lastIndex(){return this.size()>0?this._indexAt(this._end-1):null}size(){return this._end-this._start}isEmpty(){return 0===this.size()}contains(e){
return null!==this.search(e,a.PlotRowSearchMode.Exact)}valueAt(e){const t=this.search(e);return null!==t?t.value:null}add(e,t){if(this._shareRead)return l.logDebug("add: readonly collection modification attempt"),!1;const i={index:e,value:t},s=this._nonCachedSearch(e,a.PlotRowSearchMode.Exact,h);return this._invalidateSearchCaches(),null===s?(this._items.splice(this._lowerbound(e,h),0,i),this._start=0,this._end=this._items.length,!0):(this._items[s]=i,!1)}search(e,t=a.PlotRowSearchMode.Exact,i){return this._searchImpl(e,t,this._rowSearchCacheByIndex,this._rowSearchCacheByIndexWithoutEmptyValues,h,i)}searchByTime(e,t=a.PlotRowSearchMode.Exact,i){return this._searchImpl(e,t,this._rowSearchCacheByTime,this._rowSearchCacheByTimeWithoutEmptyValues,d,i)}fold(e,t){let i=t;for(let t=this._start;t<this._end;++t){i=e(this._indexAt(t),this._valueAt(t),i)}return i}findFirst(e,t){const i=void 0!==t&&Math.min(this._start+t,this._end)||this._end;for(let t=this._start;t<i;++t){const i=this._indexAt(t),s=this._valueAt(t);if(e(i,s))return{index:i,value:s}}return null}findLast(e,t){const i=void 0!==t&&Math.max(this._end-t,this._start)||this._start;for(let t=this._end-1;t>=i;--t){const i=this._indexAt(t),s=this._valueAt(t);if(e(i,s))return{index:i,value:s}}return null}each(e){for(let t=this._start;t<this._end;++t){if(e(this._indexAt(t),this._valueAt(t)))break}}reduce(e,t){let i=t;for(let t=this._start;t<this._end;++t){i=e(i,this._indexAt(t),this._valueAt(t))}return i}range(e,t){const i=new u(this._plotFunctions,this._emptyValuePredicate);return i._items=this._items,i._start=this._lowerbound(e,h),i._end=this._upperbound(t),i._shareRead=!0,i}plottableRange(e){const t=new u(this._plotFunctions,this._emptyValuePredicate);return t._items=this._items,t._start=this._upperbound(n.UNPLOTTABLE_TIME_POINT_INDEX),t._end=this._end,t._shareRead=!0,!0===e&&t._start>this._start&&(t._start-=1),t}rangeIterator(e,t){const i=this._lowerbound(e,h),s=this._upperbound(t);if(i===s)return{hasNext:()=>!1,next:()=>{throw new Error("Invalid operation")}};let r=i-1;return{hasNext:()=>r<s-1,next:()=>(r+=1,this._items[r])}}minMaxOnRangeCached(e,t,i){if(this.isEmpty())return null;let s=null;for(const r of i){s=p(s,this._minMaxOnRangeCachedImpl(e-r.offset,t-r.offset,r.name))}return s}minMaxOnRange(e,t,i){if(this.isEmpty())return null;let s=null;for(const r of i){s=p(s,this._minMaxOnRange(e-r.offset,t-r.offset,r.name))}return s}merge(e){return this._shareRead?(l.logDebug("merge: readonly collection modification attempt"),null):0===e.length?null:this.isEmpty()||e[e.length-1].index<this._items[0].index?this._prepend(e):e[0].index>this._items[this._items.length-1].index?this._append(e):1===e.length&&e[0].index===this._items[this._items.length-1].index?(this._updateLast(e[0]),e[0]):this._merge(e)}addTail(e,t=!1){if(0===e.length)return;let i=0;t&&this._end-this._start>0&&(i=1,this._items[this._end-this._start-1].value=e[0].value);for(let t=i;t<e.length;++t){const i=e[t],s=this.lastIndex();if(null===s){l.logError("Can't add tail to the empty plotlist");break}
this.add(s+1,i.value)}this._invalidateSearchCaches()}move(e){if(this._shareRead)return void l.logDebug("move: readonly collection modification attempt");if(0===e.length)return;const t=this._items.slice();for(const i of e){const e=this._bsearch(i.old,h);if(null!==e&&void 0!==t[e])if(i.new===n.INVALID_TIME_POINT_INDEX)t[e]=void 0;else{t[e]={index:i.new,value:t[e].value};const s=this._bsearch(i.new,h);if(null!==s){const e=t[s];void 0!==e&&e.index===i.new&&(t[s]=void 0)}}}this._items=t.filter((e=>void 0!==e)).sort(((e,t)=>e.index-t.index)),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._start=0,this._end=this._items.length}remove(e){if(this._shareRead)return l.logDebug("remove: readonly collection modification attempt"),null;const t=this._nonCachedSearch(e,a.PlotRowSearchMode.NearestRight,h);if(null===t)return null;const i=this._items.splice(t);return this._end=this._items.length,this._minMaxCache.clear(),this._invalidateSearchCaches(),i.length>0?i[0]:null}state(){const e=this._items.slice(this._start,this._end);return{start:0,end:e.length,data:e}}restoreState(e){e?(this._start=e.start,this._end=e.end,this._shareRead=!1,this._items=e.data,this._minMaxCache.clear(),this._invalidateSearchCaches()):this.clear()}_indexAt(e){return this._items[e].index}_valueAt(e){return this._items[e].value}_length(){return this._items.length}_searchImpl(e,t,i,s,r,n){const o=void 0!==n?i:s,a=void 0!==n?1e4*(t+1)+n:t;let l=o.get(e);if(void 0!==l){const e=l.get(a);if(void 0!==e)return e}const c=this._nonCachedSearch(e,t,r,n);if(null===c)return null;const h={index:this._indexAt(c),value:this._valueAt(c)};return void 0===l&&(l=new Map,o.set(e,l)),l.set(a,h),h}_nonCachedSearch(e,t,i,s){const r=this._lowerbound(e,i),n=r===this._end||e!==i(this._items[r]);if(n&&t!==a.PlotRowSearchMode.Exact)switch(t){case a.PlotRowSearchMode.NearestLeft:return this._searchNearestLeft(r,s);case a.PlotRowSearchMode.NearestRight:return this._searchNearestRight(r,s);default:throw new TypeError("Unknown search mode")}if(void 0===s||n||t===a.PlotRowSearchMode.Exact)return n?null:r;switch(t){case a.PlotRowSearchMode.NearestLeft:return this._nonEmptyNearestLeft(r,s);case a.PlotRowSearchMode.NearestRight:return this._nonEmptyNearestRight(r,s);default:throw new TypeError("Unknown search mode")}}_nonEmptyNearestRight(e,t){const i=(0,s.ensure)(this._emptyValuePredicate),r=(0,s.ensure)(t);for(;e<this._end&&i(this._valueAt(e),r);)e+=1;return e===this._end?null:e}_nonEmptyNearestLeft(e,t){const i=(0,s.ensureNotNull)(this._emptyValuePredicate),r=(0,s.ensure)(t);for(;e>=this._start&&i(this._valueAt(e),r);)e-=1;return e<this._start?null:e}_searchNearestLeft(e,t){if(e===this._start)return null;const i=e-1,s=i!==this._end?i:null;return void 0!==t&&null!==s?this._nonEmptyNearestLeft(s,t):s}_searchNearestRight(e,t){const i=e,s=i!==this._end?i:null;return void 0!==t&&null!==s?this._nonEmptyNearestRight(s,t):s}_bsearch(e,t){const i=this._lowerbound(e,t);return i!==this._end&&e===t(this._items[i])?i:null}_lowerbound(e,t){return(0,
r.lowerbound)(this._items,e,((e,i)=>t(e)<i),this._start,this._end)}_upperbound(e){return(0,r.upperbound)(this._items,e,((e,t)=>t.index>e),this._start,this._end)}_plotMinMax(e,t,i){let s=null;const r=this._plotFunctions.get(i);if(void 0===r)throw new Error(`Plot "${i}" is not registered`);for(let i=e;i<t;i++){const e=r(this._items[i].value);null==e||Number.isNaN(e)||(null===s?s={min:e,max:e}:(e<s.min&&(s.min=e),e>s.max&&(s.max=e)))}return s}_invalidateCacheForRow(e){const t=Math.floor(e.index/c);this._minMaxCache.forEach((e=>e.delete(t)))}_prepend(e){return(0,s.assert)(!this._shareRead,"collection should not be readonly"),(0,s.assert)(0!==e.length,"plotRows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=e.concat(this._items),this._start=0,this._end=this._items.length,e[0]}_append(e){return(0,s.assert)(!this._shareRead,"collection should not be readonly"),(0,s.assert)(0!==e.length,"plotRows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=this._items.concat(e),this._start=0,this._end=this._items.length,e[0]}_updateLast(e){(0,s.assert)(!this.isEmpty(),"plot list should not be empty");const t=this._items[this._end-1];(0,s.assert)(t.index===e.index,"last row index should match new row index"),this._invalidateCacheForRow(e),this._invalidateSearchCaches(),this._items[this._end-1]=e}_merge(e){return(0,s.assert)(0!==e.length,"plot rows should not be empty"),this._invalidateSearchCaches(),this._minMaxCache.clear(),this._items=_(this._items,e),this._start=0,this._end=this._items.length,e[0]}_minMaxOnRangeCachedImpl(e,t,i){if(this.isEmpty())return null;let r=null;const n=(0,s.ensureNotNull)(this.firstIndex()),o=(0,s.ensureNotNull)(this.lastIndex()),a=Math.max(e,n),l=Math.min(t,o),h=Math.ceil(a/c)*c,d=Math.max(h,Math.floor(l/c)*c);r=p(r,this._minMaxOnRange(a,Math.min(h,t,l),i));let u=this._minMaxCache.get(i);void 0===u&&(u=new Map,this._minMaxCache.set(i,u));for(let e=Math.max(h+1,a);e<d;e+=c){const t=Math.floor(e/c);let s=u.get(t);if(void 0===s){const e=t*c,r=(t+1)*c-1;s=this._minMaxOnRange(e,r,i),u.set(t,s)}r=p(r,s)}r=p(r,this._minMaxOnRange(d,l,i));return r}_minMaxOnRange(e,t,i){return this._plotMinMax(this._lowerbound(e,h),this._upperbound(t),i)}_invalidateSearchCaches(){this._rowSearchCacheByIndex.clear(),this._rowSearchCacheByIndexWithoutEmptyValues.clear(),this._rowSearchCacheByTime.clear(),this._rowSearchCacheByTimeWithoutEmptyValues.clear()}}function p(e,t){if(null===e)return t;if(null===t)return e;return{min:Math.min(e.min,t.min),max:Math.max(e.max,t.max)}}function _(e,t){const i=function(e,t){const i=e.length,s=t.length;let r=i+s,n=0,o=0;for(;n<i&&o<s;)e[n].index<t[o].index?n++:e[n].index>t[o].index?o++:(n++,o++,r--);return r}(e,t),s=new Array(i);let r=0,n=0;const o=e.length,a=t.length;let l=0;for(;r<o&&n<a;)e[r].index<t[n].index?(s[l]=e[r],r++):e[r].index>t[n].index?(s[l]=t[n],n++):(s[l]=t[n],r++,n++),l++;for(;r<o;)s[l]=e[r],r++,l++;for(;n<a;)s[l]=t[n],n++,l++;return s}},672428:(e,t,i)=>{"use strict";i.d(t,{PriceAxisView:()=>p})
;var s=i(86441),r=i(934026),n=i(242786),o=i(561626),a=i(289763),l=i(777277),c=i(664114),h=i(411404);class d{constructor(e,t){this.setData(e,t)}setData(e,t){this._data=e,this._commonData=t}draw(e,t,i,s,r,n,l){var h,d,u;const p=this._data;if(!p.visible||this._isOutOfScreen(t,r))return;const _=this._commonData,m=void 0!==p.labelIcon,g=p.ignoreOffset?0:t.offsetSize,f=t.borderSize,v=t.paddingTop+_.additionalPaddingTop,S=t.paddingBottom+_.additionalPaddingBottom,y=t.paddingInner,b=t.paddingOuter,w=t.fontSize;let P=p.text,C=p.textColor||_.textColor,T=p.secondLine||"",x=_.secondLineTextColor||C,I=p.thirdLine||"";const M=_.thirdLineTextColor||C;0===T.length&&(T=I,x=M,I=""),0===P.length&&(P=T,C=x,T=I,x=M,I=""),e.save(),e.font=t.font;const L=i.yMidCorrection(e,P)*l,A=Math.ceil(i.measureText(e,P)),k=w+v+S,E=Boolean(T),D=Boolean(I),B=E?Math.ceil(i.measureText(e,T)):0,V=D?Math.ceil(i.measureText(e,I)):0,R=f+y+b+A+g,N=B>0?f+y+b+B+g:0,O=V>0?f+y+b+V+g:0,F=Math.max(R,N,O),W=Math.max(1,Math.floor(l));let z=Math.round(k*l);z%2!=W%2&&(z+=1);const H=Math.round((w+t.lineSpacing)*l),U=Math.round(2*(w+t.lineSpacing)*l),j=Math.max(1,Math.floor(f*l)),G=p.separatorVisible?j:0,q=p.borderVisible?j:0,$=m?z:Math.round(F*l),Y=Math.round(g*l),K=Math.ceil(s*l),Z=Math.ceil(y*l),X=Math.round((null!==(h=_.fixedCoordinate)&&void 0!==h?h:_.coordinate)*l)-Math.floor(.5*l),J=Math.floor(X+W/2-z/2),Q=J+z,ee="right"===n,te=ee?K-G:G,ie=K;let se,re=te;const ne=null!==(d=p.backgroung)&&void 0!==d?d:_.background;e.fillStyle=ne;const oe=2*l;if(e.textAlign=ee?"right":"left",e.textBaseline="middle",ee?(re=te-$,se=te-Y-Z-1):(re=te+$,se=te+Y+Z),P||m){const i=D?z+U:E?z+H:z;if(((t,s,r)=>{ee?(0,c.drawRoundRectWithInnerBorder)(e,re,J,$,i,t,[oe,0,0,oe],q,s,r):(0,c.drawRoundRectWithInnerBorder)(e,te,J,$,i,t,[0,oe,oe,0],q,s,r)})(ne,null!==(u=_.borderColor)&&void 0!==u?u:ne,_.borderStyle),p.separatorVisible&&(e.fillStyle=t.paneBackgroundColor,e.fillRect(ee?ie-G:0,J,G,Q-J)),m){switch(p.labelIcon){case 0:this._drawPlusIcon(e,te,re,J,X,Q,W);break;case 1:this._drawClockIcon(e,te,re,X,W,l)}return void e.restore()}e.save(),e.translate(se,(J+Q)/2+L),(0,a.drawScaled)(e,l,(()=>{e.fillStyle=C,e.fillText(P,0,0)})),e.restore()}E&&(e.fillStyle=x,e.save(),e.translate(se,(J+Q)/2+L+H),(0,a.drawScaled)(e,l,(()=>{e.fillText((0,o.startWithLTR)(T),0,0)})),e.restore()),D&&(e.fillStyle=M,e.save(),e.translate(se,(J+Q)/2+L+U),(0,a.drawScaled)(e,l,(()=>{e.fillText((0,o.startWithLTR)(I),0,0)})),e.restore()),e.restore()}topBottomTotalHeight(e){const t=this._lines();if(!this._data.visible||0===t)return{top:0,bottom:0,total:0};const i=e.fontSize/2+e.paddingTop+this._commonData.additionalPaddingTop,s=(t-.5)*e.fontSize+(t-1)*e.lineSpacing+e.paddingBottom+this._commonData.additionalPaddingBottom;return{top:i,bottom:s,total:i+s}}hitTest(e){const t=this._data.hitTestData;if(void 0===t||!this._data.visible)return null;const i=(0,n.lastMouseOrTouchEventInfo)().isTouch?10:0,o=(0,s.box)(new s.Point(t.xl-i,t.y-i),new s.Point(t.xl+t.containerWidth+i,t.y+t.containerHeight+i)),a=t.left&&(0,r.pointInBox)(e,o),c=(0,
s.box)(new s.Point(t.xr-i,t.y-i),new s.Point(t.xr+t.containerWidth+i,t.y+t.containerHeight+i)),d=t.right&&(0,r.pointInBox)(e,c);if(a||d){const i=a?"left":"right";return new l.HitTestResult(l.HitTestResult.CUSTOM,{cursorType:h.PaneCursorType.Default,clickHandler:void 0===t.clickHandler?void 0:t.clickHandler.bind(this,e,i),tapHandler:void 0===t.clickHandler?void 0:t.clickHandler.bind(this,e,i),tooltip:t.tooltip})}return null}_drawPlusIcon(e,t,i,s,r,n,o){e.fillStyle=this._commonData.textColor,e.strokeStyle=this._commonData.textColor,e.lineWidth=o;const a=Math.abs(t-i);let l=Math.round(.35*a);l%2!=o%2&&(l+=1);let c=Math.round(.65*a);c%2!=o%2&&(c+=1);const h=Math.floor((a-l)/2),d=Math.min(t,i),u=d+Math.floor(a/2-o/2);e.fillRect(d+h,r,l,o),e.fillRect(u,s+h,o,l),e.beginPath(),e.arc(u+o/2,r+o/2,c/2,0,2*Math.PI,!1),e.stroke()}_drawClockIcon(e,t,i,s,r,n){e.fillStyle=this._commonData.textColor,e.lineWidth=r;const o=Math.abs(t-i);let a=Math.round(.35*o);a%2!=r%2&&(a+=1);let l=Math.round(.65*o);l%2!=r%2&&(l+=1);const c=Math.min(t,i)+Math.floor(o/2-r/2);e.save(),e.translate(c+r/2-l/2,s+r/2-l/2),e.scale(n,n);const h=new Path2D("M7.5 0.8a1 1 0 0 0 0 13.4 1 1 0 0 0 0-13.4zm0 1a1 1 0 0 1 0 11 1 1 0 0 1 0-11zm-.97-.25A3.5 3.5 0 0 0 3.5 0 3.5 3.5 0 0 0 0 3.5a3.5 3.5 0 0 0 1.75 3.03l.5-.86A2.5 2.5 0 0 1 1 3.5 2.5 2.5 0 0 1 3.5 1a2.5 2.5 0 0 1 2.17 1.25zm6.72 4.78A3.5 3.5 0 0 0 15 3.5 3.5 3.5 0 0 0 11.5 0a3.5 3.5 0 0 0-3.03 1.75l.86.5A2.5 2.5 0 0 1 11.5 1 2.5 2.5 0 0 1 14 3.5a2.5 2.5 0 0 1-1.25 2.17zM7 5h1v5H7zm3 2v1H5V7z");e.fill(h),e.restore()}_lines(){const e=this._data;return(e.text?1:0)+(e.secondLine?1:0)+(e.thirdLine?1:0)}_isOutOfScreen(e,t){var i;const s=this._commonData,r=null!==(i=s.fixedCoordinate)&&void 0!==i?i:s.coordinate,{total:n}=this.topBottomTotalHeight(e),o=n/this._lines();return r-o/2-3>t||r+(n-o/2)+3<0}}var u=i(602564);class p{constructor(e){this._commonRendererData={coordinate:0,textColor:"#FFF",background:"#000",additionalPaddingBottom:0,additionalPaddingTop:0},this._axisRendererData={text:"",visible:!1,separatorVisible:!1,borderVisible:!1,ignoreOffset:!1},this._paneRendererData={text:"",visible:!1,separatorVisible:!0,borderVisible:!1,ignoreOffset:!0},this._invalidated=!0,this._axisRenderer=new(e||d)(this._axisRendererData,this._commonRendererData),this._paneRenderer=new(e||d)(this._paneRendererData,this._commonRendererData)}text(){return this._updateRendererDataIfNeeded(),this._axisRendererData.text}secondLineText(){return this._updateRendererDataIfNeeded(),this._axisRendererData.secondLine}thirdLineText(){return this._updateRendererDataIfNeeded(),this._axisRendererData.thirdLine}background(){return this._updateRendererDataIfNeeded(),this._commonRendererData.background}color(){return this._updateRendererDataIfNeeded(),this.generateTextColor(this.background())}generateTextColor(e){return(0,u.colorFromBackground)(e)}coordinate(){return this._updateRendererDataIfNeeded(),this._commonRendererData.coordinate}floatCoordinate(){var e;return this._updateRendererDataIfNeeded(),
null!==(e=this._commonRendererData.floatCoordinate)&&void 0!==e?e:this._commonRendererData.coordinate}update(e){this._invalidated=!0}topBottomTotalHeight(e){this._updateRendererDataIfNeeded();const{top:t,bottom:i,total:s}=this._axisRenderer.topBottomTotalHeight(e),{top:r,bottom:n,total:o}=this._paneRenderer.topBottomTotalHeight(e);return{top:Math.max(t,r),bottom:Math.max(i,n),total:Math.max(s,o)}}getFixedCoordinate(){return this._commonRendererData.fixedCoordinate||0}setFixedCoordinate(e){this._commonRendererData.fixedCoordinate=e}isVisible(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible||this._paneRendererData.visible}isAxisLabelVisible(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible}isPaneLabelVisible(){return this._updateRendererDataIfNeeded(),this._paneRendererData.visible}renderer(){return this._updateRendererDataIfNeeded(),this._axisRenderer}paneRenderer(){return this._updateRendererDataIfNeeded(),this._paneRenderer}setPaneRendererLabelIcon(e){this._paneRendererData.labelIcon=e}setPaneLabelVisible(e){this._paneRendererData.visible=e,this._invalidated=!0}ignoreAlignment(){return!1}_updateRendererDataIfNeeded(){this._invalidated&&(this._commonRendererData.fixedCoordinate=void 0,this._updateRendererData(this._axisRendererData,this._paneRendererData,this._commonRendererData),this._invalidated=!1)}}},539301:(e,t,i)=>{"use strict";i.d(t,{isPriceDataSource:()=>a,PriceDataSource:()=>l});var s=i(881517),r=i(922157),n=i.n(r),o=i(296055);function a(e){return e instanceof l}class l extends s.DataSource{constructor(e,t){super(t),this._formatterChanged=new(n()),this._priceStepChanged=new(n()),this._currencyChanged=new(n()),this._unitChanged=new(n()),this._priceRangeReadyChanged=new(n()),this._priceStep=null,this._priceRangeReady=!0,this._model=e}base(){return 0}model(){return this._model}currencyChanged(){return this._currencyChanged}isCurrencySource(){return!0}isDisplayedInLegend(){return!0}unitChanged(){return this._unitChanged}isUnitSource(){return!0}priceRange(e,t){return null}isDraggable(){return!0}priceLineColor(e){return e}formatterChanged(){return this._formatterChanged}priceStep(e){return this._priceStep}priceStepChanged(){return this._priceStepChanged}isIncludedInAutoScale(){return!0}correctScaleMargins(e){return e}priceRangeReady(){return this._priceRangeReady}priceRangeReadyChanged(){return this._priceRangeReadyChanged}disablePriceRangeReady(){const e=this.priceScale();null===e||e.isAutoScale()||e.mainSource()!==this||(this._priceRangeReady=!1,e.recalculatePriceRangeOnce()),this._priceRangeReadyChanged.fire(!1)}statusView(){return null}legendView(){return null}marketStatusModel(){return null}dataUpdatedModeModel(){return null}dataProblemModel(){return null}_enablePriceRangeReady(){this._priceRangeReady=!0,this._priceRangeReadyChanged.fire(!0)}_onSourceCurrencyChanged(){(0,o.isActingAsSymbolSource)(this)||this._currencyChanged.fire()}_onSourceUnitChanged(){(0,o.isActingAsSymbolSource)(this)||this._unitChanged.fire()}_onSourcePriceRangeReadyChanged(e){(0,
o.isActingAsSymbolSource)(this)||e||this.disablePriceRangeReady()}}},929654:(e,t,i)=>{"use strict";i.d(t,{PriceLineAxisView:()=>l,SeriesPriceLineAxisView:()=>c,StudyPriceLineAxisView:()=>h});var s=i(672428),r=i(650151),n=i(284269),o=i(664114);class a{constructor(e,t){this.setData(e,t)}setData(e,t){this._data=e,this._commonData=t}draw(e,t,i,s,a,l,c){var h;if(!this._data.visible)return;const d=null!==(h=this._commonData.fixedCoordinate)&&void 0!==h?h:this._commonData.coordinate;e.lineWidth=Math.max(1,Math.floor((0,r.ensureDefined)(this._data.linewidth)*c)),e.lineCap="butt",(0,o.setLineStyle)(e,void 0===this._data.linestyle?n.LINESTYLE_DOTTED:this._data.linestyle),e.strokeStyle=this._commonData.textColor,(0,o.drawHorizontalLine)(e,Math.round(d*c),0,Math.ceil(s*c))}topBottomTotalHeight(e){return{top:0,bottom:0,total:0}}}class l extends s.PriceAxisView{constructor(e){super(e||a)}ignoreAlignment(){return!0}_updateRendererData(e,t,i){if(t.visible=!1,e.visible=!1,!this._isVisible())return;const s=this._value();s.noData||(i.background="",i.textColor=this._priceLineColor(s.color),i.coordinate=s.coordinate,i.floatCoordinate=s.floatCoordinate,e.linewidth=this._lineWidth(),e.linestyle=this._lineStyle(),e.backgroundAreaVisible=this._backgroundAreaVisible(),e.backgroundAreaColor=this._backgroundAreaColor(),e.backgroundAreaHeight=this._backgroundAreaHeight(),e.visible=!0)}_lineStyle(){return n.LINESTYLE_DOTTED}_backgroundAreaVisible(){return!1}_backgroundAreaColor(){return""}_backgroundAreaHeight(){return 0}}class c extends l{constructor(e){super(),this._series=e}_value(){return this._series.lastValueData(void 0,!0)}_priceLineColor(e){return this._series.priceLineColor(e)}_lineWidth(){return this._series.properties().childs().priceLineWidth.value()}_isVisible(){const e=this._series.model().properties().childs().scalesProperties.childs().showSeriesLastValue.value();return this._series.properties().childs().showPriceLine.value()&&e}}class h extends l{constructor(e,t){super(),this._study=e,this._plotname=t}_value(){return this._study.lastValueData(this._plotname,!0)}_lineWidth(){return this._study.properties().childs().styles.childs()[this._plotname].childs().linewidth.value()}_lineStyle(){return n.LINESTYLE_DOTTED}_priceLineColor(e){return e}_isVisible(){const e=this._study.model().properties().childs().scalesProperties.childs().showStudyLastValue.value(),t=this._study.isPlotVisibleAt(this._plotname,1);return this._study.properties().childs().styles.childs()[this._plotname].childs().trackPrice.value()&&e&&t}}},341315:(e,t,i)=>{"use strict";i.d(t,{PriceScaleBase:()=>L});var s=i(650151),r=i(486028),n=i(922157),o=i.n(n),a=i(624595),l=i(786432),c=i(273900),h=i(793713),d=i(539301),u=i(976704),p=i.n(u),_=i(663890),m=i(296055),g=i(632054),f=i(478265),v=i(792268),S=i(218954);class y{constructor(e,t){if(this._base=e,this._integralDividers=t,(0,S.isBaseDecimal)(this._base))this._fractionalDividers=[2,2.5,2];else{this._fractionalDividers=[];for(let e=this._base;1!==e;){if(e%2==0)this._fractionalDividers.push(2),e/=2;else{
if(e%5!=0)throw new Error("unexpected base");this._fractionalDividers.push(2),this._fractionalDividers.push(2.5),e/=5}if(this._fractionalDividers.length>100)throw new Error("something wrong with base")}}}tickSpan(e,t,i){const s=0===this._base?0:1/this._base,r=Math.min(1e-14,(e-t)/1e3);let n=Math.pow(10,Math.max(0,Math.ceil((0,S.log10)(e-t)))),o=0,a=this._integralDividers[0];for(;;){const e=(0,S.greaterOrEqual)(n,s,r)&&n>s+r,t=(0,S.greaterOrEqual)(n,i*a,r),l=(0,S.greaterOrEqual)(n,1,r);if(!(e&&t&&l))break;n/=a,a=this._integralDividers[++o%this._integralDividers.length]}if(n<=s+r&&(n=s),n=Math.max(1,n),this._fractionalDividers.length>0&&(0,S.equal)(n,1,r))for(o=0,a=this._fractionalDividers[0];(0,S.greaterOrEqual)(n,i*a,r)&&n>s+r;)n/=a,a=this._fractionalDividers[++o%this._fractionalDividers.length];return n}}class b{constructor(e,t,i,s){this._marks=null,this._priceScale=e,this._base=t,this._coordinateToLogicalFunc=i,this._logicalToCoordinateFunc=s}base(){return this._base}setBase(e){if(e<0)throw new Error("base < 0");this._base=e}tickSpan(e,t,i=0){if(e<t)throw new Error("high < low");const s=this._priceScale.height(),r=(e-t)*this._tickMarkHeight()/s,n=new y(this._base,[2,2.5,2]),o=new y(this._base,[2,2,2.5]),a=new y(this._base,[2.5,2,2]);let l=0;const c=n.tickSpan(e,t,r);c>i&&(l=c);const h=o.tickSpan(e,t,r);h>i&&(l=Math.min(l,h));const d=a.tickSpan(e,t,r);return d>i&&(l=Math.min(l,d)),l>0?l:e-t}rebuildTickMarks(){this._marks=null}marks(){return null===this._marks&&(this._marks=this._rebuildTickMarksImpl()),this._marks}_fontHeight(){return this._priceScale.fontSize()}_tickMarkHeight(){return Math.ceil(2.5*this._fontHeight())}_rebuildTickMarksImpl(){const e=this._priceScale,t=[],i=e.mainSource();if(e.isEmpty()||null===i)return t;let s=i.firstValue();null===s&&(s=0);const r=e.height(),n=this._coordinateToLogicalFunc(r-1,s),o=this._coordinateToLogicalFunc(0,s),a=Math.max(n,o),l=Math.min(n,o);if(a===l)return t;let c=this.tickSpan(a,l),h=a%c;h+=h<0?c:0;const d=a>=l?1:-1;let u=null;const p=e.formatter();let _=NaN;for(let i=a-h;i>l;i-=c){i===_&&(c=this.tickSpan(a,l,c)),_=i;const r=this._logicalToCoordinateFunc(i,s);null!==u&&Math.abs(r-u)<this._tickMarkHeight()||(t.push({coord:r,label:p.format(i)}),u=r,e.isLog()&&(c=this.tickSpan(i*d,l)))}return t}}var w=i(232468),P=i(358076),C=i(58594),T=i(821737);const x=new C.PercentageFormatter,I=new T.PriceFormatter(100,1),M={autoScale:!0,autoScaleDisabled:!1,lockScale:!1,percentage:!1,percentageDisabled:!1,log:!1,logDisabled:!1,alignLabels:!0,isInverted:!1,indexedTo100:!1};class L{constructor(e){this._marksCache=null,this._onMarksChanged=new(o()),this.m_dataSources=[],this._sourcesForAutoscale=null,this._hasSeries=!1,this._studiesCount=0,this._drawingCount=0,this._seriesLikeSources=[],this._priceDataSources=[],this._mainSource=null,this._lastSourceRemoved=new(o()),this._scaleSeriesOnly=!1,this._invalidatedForRange={isValid:!0,visibleBars:null},this.m_priceRange=null,this._logFormula=(0,c.logFormulaForPriceRange)(null),this.m_height=0,this._margins={top:0,bottom:0},
this._correctedMarginsCache=null,this._topPixelMargin=0,this._bottomPixelMargin=0,this._internalHeightCache=null,this._internalHeightChanged=new(o()),this._priceRangeSnapshot=null,this._scrollStartPoint=null,this._currencyCache=null,this._unitCache=null,this._measureUnitIdCache=null,this._recalculatePriceRangeOnce=!1,this._cachedOrderedSoruces=null,this._scaleStartPoint=null,this._twoPointsScaleStartPosition=null,this._maxPriceRange=null,this._minPriceRange=null,this._priceRangeChanged=new(o()),this._sourcesToUpdateViews=null,this._markBuilder=new b(this,100,this._coordinateToLogical.bind(this),this._logicalToCoordinate.bind(this)),this._formatter=null,this._id="",e=Object.assign({},M,e),this._properties=new(p())(e),this._boundOnSourceIsActingAsSymbolSourceChanged=this._onSourceIsActingAsSymbolSourceChanged.bind(this)}id(){return this._id}setId(e){this._id=e}isLog(){return this._properties.childs().log.value()}isPercentage(){return this._properties.childs().percentage.value()}isInverted(){return this._properties.childs().isInverted.value()}isIndexedTo100(){return this._properties.childs().indexedTo100.value()}isAutoScale(){return this._properties.childs().autoScale.value()&&!this.isLockScale()}isLockScale(){return this._properties.childs().lockScale.value()}isRegular(){return!this.isPercentage()&&!this.isLog()&&!this.isIndexedTo100()}properties(){return this._properties}height(){return this.m_height}setHeight(e){this.m_height!==e&&(this.m_height=e,this._invalidateInternalHeightCache(),this._marksCache=null)}internalHeight(){if(this._internalHeightCache)return this._internalHeightCache;const e=this.height()-this.topPixelMargin()-this.bottomPixelMargin();return this._internalHeightCache=e,e}priceRange(){return this._makeSureItIsValid(),this.m_priceRange}setPriceRange(e,t,i){if(!(e instanceof l.PriceRange))throw new TypeError("incorrect price range");const s=this.m_priceRange;if(!t&&l.PriceRange.compare(s,e))return;const r=null!==this._maxPriceRange&&this._maxPriceRange.containsStrictly(e),n=null!==this._minPriceRange&&e.containsStrictly(this._minPriceRange);this.isLockScale()&&!t&&(r||n)||(this._marksCache=null,this.m_priceRange=e,i||this._priceRangeChanged.fire(s,e))}setMinPriceRange(e){this._minPriceRange=e}setMaxPriceRange(e){this._maxPriceRange=e}recalculatePriceRangeOnce(){this._recalculatePriceRangeOnce=!0}priceRangeShouldBeRecalculatedOnce(){if(!this._recalculatePriceRangeOnce||this.isLockScale())return!1;const e=this.mainSource();return null!==e&&e.priceRangeReady()}priceRangeChanged(){return this._priceRangeChanged}canDetachSource(e){return this.m_dataSources.some((t=>t!==e&&(0,d.isPriceDataSource)(t)&&!((0,_.isStudy)(t)&&t.isLinkedToSeries())))}updateAllViews(e){const t=this._getSourcesToUpdateViews();for(const i of t)i.updateAllViews(e)}logFormula(){return this._logFormula}state(){var e;const t=this._properties.childs();return{id:this._id,m_priceRange:this.isAutoScale()?null:(null===(e=this.priceRange())||void 0===e?void 0:e.serialize())||null,m_isAutoScale:this.isAutoScale(),
m_isPercentage:t.percentage.value(),m_isIndexedTo100:t.indexedTo100.value(),m_isLog:t.log.value(),m_isLockScale:this.isLockScale(),m_isInverted:this.isInverted(),m_height:this.m_height,m_topMargin:this._margins.top,m_bottomMargin:this._margins.bottom,alignLabels:t.alignLabels.value(),logFormula:(0,r.clone)(this._logFormula)}}restoreState(e){let t=e.m_priceRange;if(void 0===t)throw new TypeError("invalid state");if(void 0===e.m_isAutoScale)throw new TypeError("invalid state");void 0!==e.id&&(this._id=e.id);const i={autoScale:e.m_isAutoScale};void 0!==e.m_isPercentage&&(i.percentage=e.m_isPercentage),void 0!==e.m_isIndexedTo100&&(i.indexedTo100=e.m_isIndexedTo100),void 0!==e.m_isLog&&(i.log=e.m_isLog),void 0!==e.m_isLockScale&&(i.lockScale=e.m_isLockScale),void 0!==e.m_isInverted&&this._properties.childs().isInverted.setValue(e.m_isInverted),void 0!==e.m_height&&this.setHeight(Math.max(0,e.m_height)),this.setMode(i),t?(t instanceof l.PriceRange||(t=new l.PriceRange(t)),this.setPriceRange(t,!0)):this.m_priceRange=null,e.logFormula&&(this._logFormula=e.logFormula),void 0!==e.m_topMargin&&(this._margins.top=e.m_topMargin),void 0!==e.m_bottomMargin&&(this._margins.bottom=e.m_bottomMargin),void 0!==e.alignLabels&&this._properties.childs().alignLabels.setValue(e.alignLabels),this._mainSource=null,this._scaleSeriesOnly=!1}priceToLogical(e){return this.isLog()&&e?(0,c.toLog)(e,this._logFormula):e}logicalToPrice(e){return this.isLog()?(0,c.fromLog)(e,this._logFormula):e}priceToCoordinate(e,t){const i=this._priceToPercentOrIndexedTo100IfNeeded(e,t);return this._logicalToCoordinate(i)}coordinateToPrice(e,t){let i=this._coordinateToLogical(e);return this.isPercentage()?i=(0,c.fromPercent)(i,t):this.isIndexedTo100()&&(i=(0,c.fromIndexedTo100)(i,t)),i}mainSource(){if(null!==this._mainSource)return this._mainSource;let e;for(const t of this.m_dataSources){if(t instanceof h.Series){e=t;break}!e&&(0,d.isPriceDataSource)(t)&&(e=t)}return this._mainSource=e||null,this._correctedMarginsCache=null,this._mainSource}pricesArrayToCoordinates(e,t,i){this._makeSureItIsValid();const r=this.bottomPixelMargin(),n=(0,s.ensureNotNull)(this.priceRange()),o=n.minValue(),a=n.maxValue(),l=this.internalHeight()-1,h=this.isInverted(),d=l/(a-o);void 0===i&&(i=e.length);const u=this.isPercentage(),p=this.isIndexedTo100(),_=this.isLog(),m=this.m_height;let g,f;for(let s=0;s<i;s++)g=e[s],Number.isFinite(g)&&(u?g=(0,c.toPercent)(g,t):p?g=(0,c.toIndexedTo100)(g,t):_&&(g=(0,c.toLog)(g,this._logFormula)),f=r+d*(g-o),e[s]=h?f:m-1-f)}pointsArrayToCoordinates(e,t,i){var r,n;this._makeSureItIsValid();const o=(0,s.ensureNotNull)(this.priceRange()),a=this.bottomPixelMargin(),l=o.minValue(),h=o.maxValue(),d=this.internalHeight()-1,u=this.isInverted(),p=d/(h-l),_=e,m=null!==(r=null==i?void 0:i.startItemIndex)&&void 0!==r?r:0,g=null!==(n=null==i?void 0:i.endItemIndex)&&void 0!==n?n:_.length;if(this.isPercentage())for(let e=m;e<g;e++)_[e].y=(0,c.toPercent)(_[e].y,t);if(this.isIndexedTo100())for(let e=m;e<g;e++)_[e].y=(0,c.toIndexedTo100)(_[e].y,t)
;if(this.isLog())for(let e=m;e<g;e++)_[e].y=this.priceToLogical(_[e].y);for(let e=m;e<g;e++){const t=_[e].y;if(isNaN(t)||null==t)continue;const i=a+p*(t-l),s=u?i:this.m_height-1-i;_[e].y=s}}barPricesToCoordinates(e,t){this._makeSureItIsValid();const i=(0,s.ensureNotNull)(this.priceRange()),r=e,n=this.bottomPixelMargin(),o=i.minValue(),a=i.maxValue(),l=this.internalHeight()-1;let h=null;if(this.isPercentage()?h=c.toPercent:this.isIndexedTo100()?h=c.toIndexedTo100:this.isLog()&&(h=(e,t)=>e?(0,c.toLog)(e,this._logFormula):e),0===r.length)return;const d="open"in r[0],u="close"in r[0];if(null!==h)for(let e=0;e<r.length;e++){if(!r[e])continue;const i=r[e];d&&(i.open=h(i.open,t)),i.high=h(i.high,t),i.low=h(i.low,t),u&&(i.close=h(i.close,t)),void 0!==i.additionalPrice&&(i.additionalPrice=h(i.additionalPrice,t))}const p=l/(a-o),_=this.isInverted();for(let e=0;e<r.length;e++){const t=r[e];if(!t)continue;if(d){const e=n+p*(t.open-o),i=_?e:this.m_height-1-e;t.open=i}const i=n+p*(t.high-o),s=_?i:this.m_height-1-i;t.high=s;const a=n+p*(t.low-o),l=_?a:this.m_height-1-a;if(t.low=l,u){const e=n+p*(t.close-o),i=_?e:this.m_height-1-e;t.close=i}if(void 0!==t.additionalPrice){const e=n+p*(t.additionalPrice-o);t.additionalPrice=_?e:this.m_height-1-e}}}formatter(){return null===this._formatter&&this.updateFormatter(),(0,s.ensureNotNull)(this._formatter)}updateFormatter(){this._marksCache=null;const e=this.mainSource();let t=100;e&&(t=e.base()),this._formatter=null,this.isPercentage()?(this._formatter=x,t=100):this.isIndexedTo100()?(this._formatter=new T.PriceFormatter(100,1),t=100):this._formatter=e?e.formatter():I,this._markBuilder=new b(this,t,this._coordinateToLogical.bind(this),this._logicalToCoordinate.bind(this)),this._markBuilder.rebuildTickMarks()}formatPrice(e,t,i){return this.isPercentage()?this.formatPricePercentage(e,t,i):this.isIndexedTo100()?this.formatPriceIndexedTo100(e,t):this.formatter().format(e)}formatPriceAbsolute(e){return this._mainSourceFormatter().format(e)}formatPricePercentage(e,t,i){return e=(0,c.toPercent)(e,t),x.format(e,i)}formatPriceIndexedTo100(e,t){const i=(0,c.toIndexedTo100)(e,t);return this.formatter().format(i)}getFormattedValues(e,t,i){const s=this.formatPriceAbsolute(e),r=this.formatPricePercentage(e,t,i),n=this.formatPriceIndexedTo100(e,t);return{formattedPriceAbsolute:s,formattedPricePercentage:r,formattedPriceIndexedTo100:n,text:(0,c.getCurrentModePriceText)(this,{formattedPriceAbsolute:s,formattedPricePercentage:r,formattedPriceIndexedTo100:n})}}dataSources(){return this.m_dataSources}seriesLikeSources(){return this._seriesLikeSources}addDataSource(e,t){if(t||-1===this.m_dataSources.indexOf(e)){if((0,d.isPriceDataSource)(e)&&(this._priceDataSources.push(e),e.currencyChanged().subscribe(this,(()=>this._currencyCache=null)),e.unitChanged().subscribe(this,(()=>this._unitCache=null)),(0,m.isSymbolSource)(e)&&(this._seriesLikeSources.push(e),e.symbolResolved().subscribe(this,(()=>{this._currencyCache=null,this._unitCache=null,this._measureUnitIdCache=null})),
e.isActingAsSymbolSource().subscribe(this._boundOnSourceIsActingAsSymbolSourceChanged),e instanceof h.Series))){const t=e.properties();this._hasSeries||(t.childs().lockScale&&(this.setMode({lockScale:t.childs().lockScale.value()}),t.removeProperty("lockScale")),t.childs().pnfStyle.child("lockScale")&&t.childs().pnfStyle.removeProperty("lockScale")),this._hasSeries=!0}e.properties().visible.listeners().subscribe(this,this._dropScaleCache),(0,_.isStudy)(e)&&(e.onIsActualIntervalChange().subscribe(this,this._dropScaleCache),e.onHibernationStateChange().subscribe(this,this._dropScaleCache),0===this._studiesCount&&(0,P.hideAllIndicators)().subscribe(this,this._dropScaleCache),this._studiesCount++),(0,w.isLineTool)(e)&&(0===this._drawingCount&&(0,P.hideAllDrawings)().subscribe(this,this._dropScaleCache),this._drawingCount++),this.m_dataSources.push(e),this._mainSource=null,this._correctedMarginsCache=null,this._sourcesToUpdateViews=null,this._dropScaleCache(),this.updateFormatter(),this._initScaleProperties(),this.invalidateSourcesCache()}}removeDataSource(e){const t=this.m_dataSources.indexOf(e);if((0,s.assert)(-1!==t,"Source is not attached to scale"),e.properties().visible.listeners().unsubscribe(this,this._dropScaleCache),this.m_dataSources.splice(t,1),(0,d.isPriceDataSource)(e)){const t=this._priceDataSources.indexOf(e);if((0,s.assert)(-1!==t,"Source is not found"),this._priceDataSources.splice(t,1),(0,m.isSymbolSource)(e)){const t=this._seriesLikeSources.indexOf(e);(0,s.assert)(-1!==t,"Source is not found"),this._seriesLikeSources.splice(t,1),e.symbolResolved().unsubscribeAll(this),e.isActingAsSymbolSource().unsubscribe(this._boundOnSourceIsActingAsSymbolSourceChanged),e instanceof h.Series&&(this._hasSeries=!1)}e.currencyChanged().unsubscribeAll(this),e.unitChanged().unsubscribeAll(this)}this.mainSource()||this.setMode({autoScale:!0}),(0,_.isStudy)(e)&&(e.onIsActualIntervalChange().unsubscribe(this,this._dropScaleCache),e.onHibernationStateChange().unsubscribe(this,this._dropScaleCache),this._studiesCount--,0===this._studiesCount&&(0,P.hideAllIndicators)().unsubscribe(this,this._dropScaleCache)),(0,w.isLineTool)(e)&&(this._drawingCount--,0===this._drawingCount&&(0,P.hideAllDrawings)().unsubscribe(this,this._dropScaleCache)),this._mainSource=null,this._correctedMarginsCache=null,this._sourcesForAutoscale=null,this._sourcesToUpdateViews=null,this.updateFormatter(),this.invalidateSourcesCache(),0===this.m_dataSources.length&&this._lastSourceRemoved.fire(),this._currencyCache=null,this._unitCache=null,this._measureUnitIdCache=null}currency(e){if(null!==this._currencyCache&&e.size()===this._currencyCache.availableCurrenciesCount)return this._currencyCache.value;let t;const i=new Set,r=new Set,n=new Set,o=new Map;let a,l=0===this._seriesLikeSources.length,c=!0,h=0,d=0;const u=this._seriesLikeSources.filter(m.isActingAsSymbolSource);for(const d of u){if(!d.isVisible())continue;const u=d.symbolInfo();if(null===u){t=null;break}const p=(0,g.symbolOriginalCurrency)(u);if(null===p){t=null;break}o.set(p,(0,s.ensureNotNull)((0,
g.symbolOriginalCurrency)(u,!0)));const _=d.currency();if(null===_){t=null;break}o.set(_,(0,s.ensureNotNull)((0,g.symbolCurrency)(u,!0)));const m=(0,g.symbolBaseCurrency)(u);null!==m&&r.add(m),c=c&&p===_,n.add(_),i.add(p),void 0===a?a=_:null!==a&&a!==_&&(a=null),l||e.convertible(_)&&(0,g.symbolCurrencyConvertible)(u)||(l=!0),h+=1}if(null!==t)for(const i of this._priceDataSources){if(u.includes(i))continue;const r=i;if(!r.isCurrencySource()||!r.isVisible())continue;const c=r.currency();if(null===c){t=null;break}n.add(c),d+=1;const h=(0,s.ensureNotNull)(r.symbolSource()),p=r.currencySourceSymbolInfo();if(null===p){t=null;break}if(l||e.convertible(c)&&(0,g.symbolCurrencyConvertible)(p)||(l=!0),o.set(c,(0,s.ensureNotNull)((0,g.symbolCurrency)(p,!0))),u.includes(h)||(l=!0),void 0===a)a=c;else if(null!==a&&a!==c){a=null;break}}return void 0===t&&(t=0===h&&0===d?null:{readOnly:l,selectedCurrency:a||null,currencies:n,originalCurrencies:i,baseCurrencies:r,symbolSourceCount:h,allCurrenciesAreOriginal:c,displayedValues:o}),this._currencyCache={value:t,availableCurrenciesCount:e.size()},t}unit(e){if(null!==this._unitCache&&e.size()===this._unitCache.availableUnitsCount)return this._unitCache.value;let t;const i=new Set,r=new Set,n=new Map,o=new Map;let l,c=0===this._seriesLikeSources.length?new Set:e.allGroups(),h=!0,d=0,u=0;const p=this._seriesLikeSources.filter(m.isActingAsSymbolSource);for(const s of p){if(!s.isVisible())continue;const u=s.symbolInfo();if(null===u){t=null;break}const p=(0,g.symbolOriginalUnit)(u,s.model().unitConversionEnabled());if(null===p){t=null;break}n.set(p,e.name(p)),o.set(p,e.description(p));const _=s.unit();if(null===_){t=null;break}if(n.set(_,e.name(_)),o.set(_,e.description(_)),h=h&&p===_,r.add(_),i.add(p),void 0===l?l=_:null!==l&&l!==_&&(l=null),c.size>0){const t=(0,f.unitConvertibleGroups)(u,_,e);c=(0,a.intersect)(c,new Set(t))}d+=1}if(null!==t)for(const i of this._priceDataSources){if(p.includes(i))continue;const h=i;if(!h.isUnitSource()||!h.isVisible())continue;const d=h.unit();if(null===d){t=null;break}r.add(d),u+=1;const _=(0,s.ensureNotNull)(h.symbolSource()),m=_.symbolInfo();if(null===m){t=null;break}if(c.size>0){const t=(0,f.unitConvertibleGroups)(m,d,e);c=(0,a.intersect)(c,new Set(t))}if(n.set(d,e.name(d)),o.set(d,e.description(d)),p.includes(_)||(c=new Set),void 0===l)l=d;else if(null!==l&&l!==d){l=null;break}}if(void 0===t)if(0===d&&0===u)t=null;else{t={availableGroups:c,selectedUnit:l||null,units:r,originalUnits:i,symbolSourceCount:d,allUnitsAreOriginal:h,names:n,descriptions:o}}return this._unitCache={value:t,availableUnitsCount:e.size()},t}measureUnitId(e){if(null!==this._measureUnitIdCache&&e.size()===this._measureUnitIdCache.availableUnitsCount)return this._measureUnitIdCache.value;let t,i;const s=new Map,r=new Map,n=new Set;let o=0;const a=this._seriesLikeSources.filter(m.isActingAsSymbolSource);for(const l of a){if(!l.isVisible())continue;const a=l.measureUnitId();if(null===a){t=null;break}n.add(a),s.set(a,e.name(a)),r.set(a,e.description(a)),
void 0===i?i=a:null!==i&&i!==a&&(i=null),o+=1}return void 0===t&&(t=0===o?null:{selectedMeasureUnitId:i||null,measureUnitIds:n,names:s,descriptions:r,symbolSourceCount:o}),this._measureUnitIdCache={value:t,availableUnitsCount:e.size()},t}setMargins(e){if(!(0,r.isNumber)(e.top)||!(0,r.isNumber)(e.bottom))throw new TypeError("invalid margin");if(e.top<0||e.top>30||e.bottom<0||e.bottom>30)throw new RangeError("invalid margin");this._margins.top===e.top&&this._margins.bottom===e.bottom||(this._margins=e,this._correctedMarginsCache=null,this._invalidateInternalHeightCache(),this._marksCache=null)}topMargin(){return this._correctedMargins().top}bottomMargin(){return this._correctedMargins().bottom}invalidateMargins(){this._correctedMarginsCache=null}topPixelMargin(){return this.isInverted()?this.bottomMargin()*this.height()+this._bottomPixelMargin:this.topMargin()*this.height()+this._topPixelMargin}bottomPixelMargin(){return this.isInverted()?this.topMargin()*this.height()+this._topPixelMargin:this.bottomMargin()*this.height()+this._bottomPixelMargin}marks(){return this._makeSureItIsValid(),null===this._marksCache&&(this._markBuilder.rebuildTickMarks(),this._marksCache=this._markBuilder.marks(),this._onMarksChanged.fire()),this._marksCache}onMarksChanged(){return this._onMarksChanged}priceRangeInPrice(){if(this.isEmpty())return null;const e=this.mainSource();if(null===e)return null;const t=(0,s.ensureNotNull)(e.firstValue()),i=this.height();return{from:this.coordinateToPrice(i-1,t),to:this.coordinateToPrice(0,t)}}setPriceRangeInPrice(e){if(this.isPercentage()||this.isIndexedTo100())return;const t=this.isInverted(),i=t?this.bottomMargin():this.topMargin(),s=t?this.topMargin():this.bottomMargin(),r=this.isLog();let n=r?(0,c.toLog)(e.from,this._logFormula):e.from,o=r?(0,c.toLog)(e.to,this._logFormula):e.to;const a=o-n;n+=s*a,o-=i*a,this.setMode({autoScale:!1}),this.setPriceRange(new l.PriceRange(n,o)),this._marksCache=null,this._onMarksChanged.fire()}hasMainSeries(){return this._hasSeries}getStudies(){return this.dataSources().filter(_.isStudy)}lastSourceRemoved(){return this._lastSourceRemoved}sourcesForAutoscale(){return this._mainSource&&this._scaleSeriesOnly!==this._scalesProperties.childs().scaleSeriesOnly.value()&&(this._sourcesForAutoscale=null),this._sourcesForAutoscale||(this._sourcesForAutoscale=this._recalculateSourcesForAutoscale()),this._sourcesForAutoscale}recalculatePriceRange(e){this._invalidatedForRange={visibleBars:e,isValid:!1}}internalHeightChanged(){return this._internalHeightChanged}orderedSources(){if(this._cachedOrderedSoruces)return this._cachedOrderedSoruces;let e=this.m_dataSources.slice();return e=(0,v.sortSources)(e),this._cachedOrderedSoruces=e,this._cachedOrderedSoruces}invalidateSourcesCache(){this._cachedOrderedSoruces=null,this._sourcesToUpdateViews=null}startScale(e){var t,i;this.isEmpty()||this.isPercentage()||this.isIndexedTo100()||null!==this._scaleStartPoint||null!==this._priceRangeSnapshot||(this._scaleStartPoint=this.m_height-e,
this._priceRangeSnapshot=null!==(i=null===(t=this.priceRange())||void 0===t?void 0:t.clone())&&void 0!==i?i:null)}scaleTo(e){if(this.isPercentage()||this.isIndexedTo100()||null===this._scaleStartPoint)return;this.setMode({autoScale:!1}),(e=this.m_height-e)<0&&(e=0);let t=(this._scaleStartPoint+.2*(this.m_height-1))/(e+.2*(this.m_height-1));const i=(0,s.ensureNotNull)(this._priceRangeSnapshot).clone();t=Math.max(t,.1),i.scaleAroundCenter(t),this.setPriceRange(i)}endScale(){this.isPercentage()||this.isIndexedTo100()||null!==this._scaleStartPoint&&(this._scaleStartPoint=null,this._priceRangeSnapshot=null)}startTwoPointsScale(e,t){if(this.isEmpty()||this.isPercentage()||this.isIndexedTo100()||null!==this._twoPointsScaleStartPosition)return;const i=Math.min(e,t),s=Math.max(e,t);this._twoPointsScaleStartPosition={topLogical:this._coordinateToLogical(i),bottomLogical:this._coordinateToLogical(s)}}twoPointsScale(e,t){if(this.isPercentage()||this.isIndexedTo100()||null===this._twoPointsScaleStartPosition)return;this.setMode({autoScale:!1});const i=Math.min(e,t),s=Math.max(e,t),{topLogical:r,bottomLogical:n}=this._twoPointsScaleStartPosition,o=this.bottomPixelMargin(),a=this.internalHeight()-1,c=(this._invertedCoordinate(i)-o)/a,h=(n-r)/((this._invertedCoordinate(s)-o)/a-c),d=r-h*c,u=d+h;this.setPriceRange(new l.PriceRange(this.priceToLogical(d),this.priceToLogical(u)))}endTwoPointsScale(){this._twoPointsScaleStartPosition=null}startScroll(e){var t,i;this.isAutoScale()||null===this._scrollStartPoint&&null===this._priceRangeSnapshot&&(this.isEmpty()||(this._scrollStartPoint=e,this._priceRangeSnapshot=null!==(i=null===(t=this.priceRange())||void 0===t?void 0:t.clone())&&void 0!==i?i:null))}scrollTo(e){if(this.isAutoScale())return;if(null===this._scrollStartPoint||null===this._priceRangeSnapshot)return;const t=this.priceRange();if(null===t)return;let i=e-this._scrollStartPoint;this.isInverted()&&(i*=-1);const s=i*(t.length()/(this.internalHeight()-1)),r=this._priceRangeSnapshot.clone();r.shift(s),this.setPriceRange(r,!0),this._marksCache=null}endScroll(){this.isAutoScale()||null!==this._scrollStartPoint&&(this._scrollStartPoint=null,this._priceRangeSnapshot=null)}_recalculateSourcesForAutoscale(){this._mainSource&&(this._scaleSeriesOnly=this._scalesProperties.childs().scaleSeriesOnly.value());const e=this._scaleSeriesOnly&&this._hasSeries;return this.m_dataSources.filter((t=>!!(t.properties().visible.value()||t instanceof h.Series)&&(e?t instanceof h.Series:(0,_.isStudy)(t)?!t.isSourceHidden()&&t.isIncludedInAutoScale():t.isIncludedInAutoScale())))}_updateAutoScaleDisabledProperty(e){const t=this._properties.childs(),i=t.indexedTo100.value()||t.percentage.value()||t.lockScale.value();e?t.autoScaleDisabled.setValueSilently(i):t.autoScaleDisabled.setValue(i)}_setAutoScaleValueWithDependentProperties(e){const t=this._properties.childs();t.autoScale.setValueSilently(e),e&&(t.percentage.setValueSilently(!1),t.indexedTo100.setValueSilently(!1),t.lockScale.setValueSilently(!1),t.logDisabled.setValueSilently(!1)),
this._updateAutoScaleDisabledProperty(!0)}_setLockScaleValueWithDependentProperties(e){const t=this._properties.childs();t.lockScale.setValueSilently(e),e&&(t.autoScale.setValueSilently(!1),t.percentage.setValueSilently(!1),t.indexedTo100.setValueSilently(!1),t.log.setValueSilently(!1)),t.percentageDisabled.setValueSilently(e),t.logDisabled.setValueSilently(e),this._updateAutoScaleDisabledProperty(!0)}_setPercentageValueWithDependentProperties(e){const t=this._properties.childs();t.percentage.setValueSilently(e),e&&(t.autoScale.setValueSilently(!0),t.log.setValueSilently(!1),t.lockScale.setValueSilently(!1),t.indexedTo100.setValueSilently(!1)),this._updateAutoScaleDisabledProperty(!0)}_setIndexedTo100ValueWithDependentProperties(e){const t=this._properties.childs();t.indexedTo100.setValueSilently(e),e&&(t.autoScale.setValueSilently(!0),t.log.setValueSilently(!1),t.lockScale.setValueSilently(!1),t.percentage.setValueSilently(!1)),this._updateAutoScaleDisabledProperty(!0)}_setLogValueWithDependentProperties(e){const t=this._properties.childs();t.log.setValueSilently(e),e&&(t.lockScale.setValueSilently(!1),t.percentage.setValueSilently(!1),t.indexedTo100.setValueSilently(!1)),this._updateAutoScaleDisabledProperty(!0)}_recalculatePriceRangeImpl(){const e=this._invalidatedForRange.visibleBars;if(null===e)return;let t=null;const i=this.sourcesForAutoscale(),s=this.isPercentage(),r=this.isIndexedTo100();let n=0,o=0;for(const a of i){if(!a.properties().visible.value())continue;const i=a.firstValue();if(null===i||s&&0===i)continue;const l=e.firstBar(),h=e.lastBar(),d=a.autoScaleInfo(l,h);let u=d.range;u&&(s?u=(0,c.toPercentRange)(u,i):r&&(u=(0,c.toIndexedTo100Range)(u,i)),t=null===t?u:t.merge(u)),void 0!==d.topPixelMargin&&(n=Math.max(n,d.topPixelMargin)),void 0!==d.bottomPixelMargin&&(o=Math.max(o,d.bottomPixelMargin))}if((Math.abs(n-this._topPixelMargin)>0||Math.abs(o-this._bottomPixelMargin)>0)&&(this._bottomPixelMargin=o,this._topPixelMargin=n,this._marksCache=null,this._invalidateInternalHeightCache()),t){if(t.minValue()===t.maxValue()&&(t=new l.PriceRange(t.minValue()-.5,t.maxValue()+.5)),this.isLog()){const e=this._convertPriceRangeFromLog(t),i=(0,c.logFormulaForPriceRange)(e);if(!(0,c.logFormulasAreSame)(i,this._logFormula)){const s=this._priceRangeSnapshot?this._convertPriceRangeFromLog(this._priceRangeSnapshot):null;this._logFormula=i,t=this._convertPriceRangeToLog(e),s&&(this._priceRangeSnapshot=this._convertPriceRangeToLog(s))}}this.setPriceRange(t)}else this.m_priceRange||(this.setPriceRange(new l.PriceRange(-.5,.5)),this._logFormula=(0,c.logFormulaForPriceRange)(null));this._invalidatedForRange.isValid=!0;const a=this.mainSource();null!==a&&this._recalculatePriceRangeOnce&&(this._recalculatePriceRangeOnce=!a.priceRangeReady())}_makeSureItIsValid(){this._invalidatedForRange.isValid||(this._invalidatedForRange.isValid=!0,this._recalculatePriceRangeImpl())}_invalidateInternalHeightCache(){this._internalHeightCache=null,this._internalHeightChanged.fire()}_coordinateToLogical(e){if(this._makeSureItIsValid(),
this.isEmpty())return 0;const t=this._invertedCoordinate(e),i=(0,s.ensureNotNull)(this.priceRange()),r=i.minValue()+(i.maxValue()-i.minValue())*((t-this.bottomPixelMargin())/(this.internalHeight()-1));return this.logicalToPrice(r)}_logicalToCoordinate(e){if(this._makeSureItIsValid(),this.isEmpty())return 0;e=this.priceToLogical(e);const t=(0,s.ensureNotNull)(this.priceRange()),i=this.bottomPixelMargin()+(this.internalHeight()-1)*(e-t.minValue())/(t.maxValue()-t.minValue());return this._invertedCoordinate(i)}_dropScaleCache(){this._sourcesForAutoscale=null,this._currencyCache=null,this._unitCache=null,this._measureUnitIdCache=null}_invertedCoordinate(e){return this.isInverted()?e:this.height()-1-e}_initScaleProperties(){const e=this.isLockScale(),t=this.properties().childs();e&&(t.percentage.setValue(!1),t.indexedTo100.setValue(!1),t.log.setValue(!1),t.autoScale.setValue(!1)),t.percentageDisabled.setValue(e),t.logDisabled.setValue(e),this._updateAutoScaleDisabledProperty(!1),t.percentage.value()&&(t.log.setValue(!1),t.indexedTo100.setValue(!1)),t.indexedTo100.value()&&(t.log.setValue(!1),t.percentage.setValue(!1))}_correctedMargins(){if(null===this._correctedMarginsCache){const e=this.mainSource();this._correctedMarginsCache=null!==e?e.correctScaleMargins(this._margins):this._margins}return this._correctedMarginsCache}_getSourcesToUpdateViews(){return this._sourcesToUpdateViews||(this._sourcesToUpdateViews=this.m_dataSources.filter((e=>!(0,w.isLineTool)(e)||e.isActualSymbol()&&e.isActualCurrency()))),this._sourcesToUpdateViews}_mainSourceFormatter(){const e=this.mainSource();return(null==e?void 0:e.formatter())||I}_priceToPercentOrIndexedTo100IfNeeded(e,t){return this.isPercentage()?(0,c.toPercent)(e,t):this.isIndexedTo100()?(0,c.toIndexedTo100)(e,t):e}_onSourceIsActingAsSymbolSourceChanged(){this._dropScaleCache()}}},341537:(e,t,i)=>{"use strict";var s;i.d(t,{PriceAxisLastValueMode:()=>s}),function(e){e[e.LastPriceAndPercentageValue=0]="LastPriceAndPercentageValue",e[e.LastValueAccordingToScale=1]="LastValueAccordingToScale"}(s||(s={}))},273900:(e,t,i)=>{"use strict";i.r(t),i.d(t,{fromPercent:()=>o,toPercent:()=>a,toPercentRange:()=>l,fromIndexedTo100:()=>c,toIndexedTo100:()=>h,toIndexedTo100Range:()=>d,toLog:()=>u,fromLog:()=>p,logFormulaForPriceRange:()=>_,logFormulasAreSame:()=>m,getCurrentModePriceText:()=>g,getOppositeModePriceText:()=>f});var s=i(786432),r=i(218954);const n={logicalOffset:4,coordOffset:1e-4};function o(e,t){return t<0&&(e=-e),e/100*t+t}function a(e,t){const i=100*(e-t)/(t||1);return t<0?-i:i}function l(e,t){const i=a(e.minValue(),t),r=a(e.maxValue(),t);return new s.PriceRange(i,r)}function c(e,t){return t<0&&(e=-e),(e-=100)/100*t+t}function h(e,t){const i=100*(e-t)/t+100;return t<0?-i:i}function d(e,t){const i=h(e.minValue(),t),r=h(e.maxValue(),t);return new s.PriceRange(i,r)}function u(e,t){const i=Math.abs(e);if(i<1e-25)return 0;const s=(0,r.log10)(i+t.coordOffset)+t.logicalOffset;return e<0?-s:s}function p(e,t){const i=Math.abs(e);if(i<1e-15)return 0
;const s=Math.pow(10,i-t.logicalOffset)-t.coordOffset;return e<0?-s:s}function _(e){if(null===e)return n;const t=Math.abs(e.maxValue()-e.minValue());if(t>=1||t<1e-15)return n;const i=Math.ceil(Math.abs(Math.log10(t))),s=n.logicalOffset+i;return{logicalOffset:s,coordOffset:1/Math.pow(10,s)}}function m(e,t){return e.logicalOffset===t.logicalOffset&&e.coordOffset===t.coordOffset}function g(e,t){return e.isPercentage()?t.formattedPricePercentage:e.isIndexedTo100()?t.formattedPriceIndexedTo100:t.formattedPriceAbsolute}function f(e,t){return e.isPercentage()||e.isIndexedTo100()?t.formattedPriceAbsolute:t.formattedPricePercentage}},786432:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PriceRange:()=>n});var s=i(486028);const r=(0,i(817808).getLogger)("Chart.PriceRange");class n{constructor(e,t){if(null!==e&&"object"==typeof e){const t=e;this._minValue=t.m_minValue,this._maxValue=t.m_maxValue}else{const i=e;this._minValue=i,void 0!==t&&(this._maxValue=t)}}equals(e){return this._minValue===e._minValue&&this._maxValue===e._maxValue}clone(){return new n(this._minValue,this._maxValue)}minValue(){return this._minValue}setMinValue(e){this._minValue=e}maxValue(){return this._maxValue}setMaxValue(e){this._maxValue=e}length(){return this._maxValue-this._minValue}isEmpty(){return this._maxValue===this._minValue||this._maxValue!=this._maxValue||this._minValue!=this._minValue}serialize(){return{m_maxValue:this._maxValue,m_minValue:this._minValue}}state(){return{max:this._maxValue,min:this._minValue}}merge(e){return new n(Math.min(this.minValue(),e.minValue()),Math.max(this.maxValue(),e.maxValue()))}apply(e,t){this._minValue=Math.min(this._minValue,e),this._maxValue=Math.max(this._maxValue,t)}set(e,t){this._minValue=e,this._maxValue=t}scaleAroundCenter(e){if(!(0,s.isNumber)(e))return void r.logDebug("PriceRange.scaleAroundCenter: invalid coeff");if(0===this._maxValue-this._minValue)return;const t=.5*(this._maxValue+this._minValue);let i=this._maxValue-t,n=this._minValue-t;i*=e,n*=e,this._maxValue=t+i,this._minValue=t+n}shift(e){(0,s.isNumber)(e)?(this._maxValue+=e,this._minValue+=e):r.logDebug("PriceRange.shift: invalid coeff")}containsStrictly(e){return e.minValue()>this._minValue&&e.maxValue()<this._maxValue}static compare(e,t){return null===e||null===t?e===t:e.equals(t)}}},455562:(e,t,i)=>{"use strict";var s=i(922157),r=i(341315).PriceScaleBase,n=i(786432).PriceRange,o=i(220863).randomHash,a=i(273900),l=a.fromLog,c=a.toLog;class h extends r{constructor(e,t){super(t),this._scalesProperties=e;var i=this;this._modeChanged=new s,this._properties.isInverted.listeners().subscribe(this,h.prototype._onIsInvertedChanged),this._properties.listeners().subscribe(null,(function(){if(i.mainSource()&&i.mainSource().model()){var e=i.mainSource().model().paneForSource(i.mainSource());i.mainSource().model().updatePane(e)}})),this._scalesProperties.listeners().subscribe(this,(function(){this._marksCache=null})),this.setId(o())}_convertPriceRangeFromLog(e){if(null===e)return null;var t=l(e.minValue(),this._logFormula),i=l(e.maxValue(),this._logFormula)
;return new n(t,i)}_convertPriceRangeToLog(e){if(null===e)return null;var t=c(e.minValue(),this._logFormula),i=c(e.maxValue(),this._logFormula);return new n(t,i)}_canConvertPriceRangeFromLog(e){if(null===e)return!1;var t=l(e.minValue(),this._logFormula),i=l(e.maxValue(),this._logFormula);return isFinite(t)&&isFinite(i)}mode(){return{autoScale:this._properties.autoScale.value(),lockScale:this._properties.lockScale.value(),percentage:this._properties.percentage.value(),indexedTo100:this._properties.indexedTo100.value(),log:this._properties.log.value()}}setMode(e){var t={},i=this.mode(),s=this._properties.state(),r=null;void 0!==e.autoScale&&e.autoScale!==s.autoScale&&(t.autoScale=e.autoScale,this._setAutoScaleValueWithDependentProperties(e.autoScale)),void 0!==e.lockScale&&e.lockScale!==s.lockScale&&(t.lockScale=e.lockScale,this._setLockScaleValueWithDependentProperties(e.lockScale)),void 0!==e.percentage&&e.percentage!==s.percentage&&(t.percentage=e.percentage,this._setPercentageValueWithDependentProperties(e.percentage),this._invalidatedForRange.isValid=!1),void 0!==e.indexedTo100&&e.indexedTo100!==s.indexedTo100&&(t.indexedTo100=e.indexedTo100,this._setIndexedTo100ValueWithDependentProperties(e.indexedTo100),this._invalidatedForRange.isValid=!1),void 0!==e.log&&e.log!==s.log&&(t.log=e.log,this._setLogValueWithDependentProperties(e.log)),s.log&&!this._properties.log.value()&&(this._canConvertPriceRangeFromLog(this.m_priceRange)?null!==(r=this._convertPriceRangeFromLog(this.m_priceRange))&&this.setPriceRange(r):this.properties().autoScale.setValue(!0)),!s.log&&this._properties.log.value()&&null!==(r=this._convertPriceRangeToLog(this.m_priceRange))&&this.setPriceRange(r),s.autoScale!==this._properties.autoScale.value()&&this._properties.autoScale.listeners().fire(this._properties.autoScale),s.autoScaleDisabled!==this._properties.autoScaleDisabled.value()&&this._properties.autoScaleDisabled.listeners().fire(this._properties.autoScaleDisabled),s.lockScale!==this._properties.lockScale.value()&&this._properties.lockScale.listeners().fire(this._properties.lockScale),s.percentage!==this._properties.percentage.value()&&(this._properties.percentage.listeners().fire(this._properties.percentage),this.updateFormatter()),s.indexedTo100!==this._properties.indexedTo100.value()&&(this._properties.indexedTo100.listeners().fire(this._properties.indexedTo100),this.updateFormatter()),s.percentageDisabled!==this._properties.percentageDisabled.value()&&this._properties.percentageDisabled.listeners().fire(this._properties.percentageDisabled),s.log!==this._properties.log.value()&&this._properties.log.listeners().fire(this._properties.log),s.logDisabled!==this._properties.logDisabled.value()&&this._properties.logDisabled.listeners().fire(this._properties.logDisabled),void 0===t.log&&void 0===t.percentage&&void 0===t.lockScale&&void 0===t.autoScale&&void 0===t.indexedTo100||this._modeChanged.fire(i,this.mode())}modeChanged(){return this._modeChanged}fontSize(){return this._scalesProperties.fontSize.value()}isEmpty(){
return this._makeSureItIsValid(),0===this.m_height||!this.m_priceRange||this.m_priceRange.isEmpty()}_onIsInvertedChanged(){this._marksCache=null,this._markBuilder.rebuildTickMarks()}}t.PriceScale=h},149926:(e,t,i)=>{"use strict";i.d(t,{createPrimitiveProperty:()=>n});var s=i(976704),r=i.n(s);function n(e){return new(r())(e)}},940092:(e,t,i)=>{"use strict";i.d(t,{extractAllPropertiesKeys:()=>S,factoryDefaultsForCurrentTheme:()=>b,ThemedDefaultProperty:()=>P});var s=i(58121),r=i(590042),n=i(316230),o=i(598279),a=i(138651),l=i(650151),c=i(870122),h=i(872580),d=i(702054),u=i(651049),p=i(976704),_=i.n(p),m=i(658363),g=i(922157),f=i.n(g);const v=(0,i(817808).getLogger)("ThemedDefaults");function S(e){const t=Object.keys(e),i=[];return t.forEach((t=>{const s=e[t];if((0,o.default)(s)){S(s).forEach((e=>i.push(`${t}.${e}`)))}else i.push(t)})),i}function y(e,t,i=""){const s={};return t.forEach((r=>{const n=r.split("."),a=n[0],l=e[a],c=""===i?a:`${i}.${a}`;if(e.hasOwnProperty(a))if(n.length>1){if(!(0,o.default)(l))return void v.logError(`path ${c} must be an object, but it is a primitive`);{const e=t.filter((e=>e.startsWith(`${a}.`))).map((e=>e.split(".").slice(1).join(".")));s[a]=y(l,e,c)}}else{if((0,o.default)(l))return void v.logError(`path ${c} must be a primitive, but it is an object`);s[a]=l}})),s}function b(e,t){var i;const r=null!==(i=d.watchedTheme.value())&&void 0!==i?i:u.StdTheme.Light,n=(0,h.deepCopy)(e);return(0,s.default)(n,(0,l.ensureDefined)(t.get(r))),n}function w(e,t){const i=(0,r.default)(e,((e,i,s)=>{if(void 0===t[s])return e;if(!(0,n.default)(i,t[s]))if((0,o.default)(i)&&(0,o.default)(t[s])){const r=w(i,t[s]);void 0!==r&&(e[s]=r)}else e[s]=i;return e}),{});return(0,a.default)(i)?void 0:i}class P extends(_()){constructor(e,t,i,r,n){super(function(e,t,i){var r;const n=t(),o=(0,h.deepCopy)(null!==(r=c.getJSON(e,null))&&void 0!==r?r:{});return(0,s.default)(n,o),(0,s.default)(n,null!=i?i:{}),n}(e,t,n)),this._applyingThemeInProcess=!1,this._restoreFactoryDefaultsEvent=new(f()),this._defaultName=e,this._defaultsSupplier=t,this._notThemedDefaultsKeys=i,this._themedDefaultsKeys=r}restoreFactoryDefaults(){const e=this._defaultsSupplier();this.mergeAndFire(e),this.saveDefaults(),this._restoreFactoryDefaultsEvent.fire()}addExclusion(){}preferences(){const e=this._allKeys();return y(this.state(),e)}mergePreferences(e){const t=this._allKeys();this.mergeAndFire(y(e,t))}childChanged(e){super.childChanged(e),this._applyingThemeInProcess||this.saveDefaults()}saveDefaults(){const e=this.state(),t=this._defaultsSupplier();let i=w(y(e,this._notThemedDefaultsKeys),y(t,this._notThemedDefaultsKeys));const r=y(t,this._themedDefaultsKeys),n=y(e,this._themedDefaultsKeys),o=w(n,r);(0,a.default)(o)||(i=null!=i?i:{},(0,s.default)(i,n)),(0,m.saveDefaults)(this._defaultName,i)}_allKeys(){return[...this._themedDefaultsKeys,...this._notThemedDefaultsKeys]}}},235171:(e,t,i)=>{"use strict";i.d(t,{convertPropertyToWatchedValue:()=>n});var s=i(210596),r=i.n(s);function n(e){const t=new(r())(e.value());let i=!1;e.subscribe(t,(()=>{i||(i=!0,
t.setValue(e.value()),i=!1)}));const s=()=>{i||(i=!0,e.setValue(t.value()),i=!1)};return t.subscribe(s),t.spawn((()=>{e.unsubscribeAll(t),t.unsubscribe(s)}))}},896778:(e,t,i)=>{"use strict";i.d(t,{combineProperty:()=>l,createPrimitivePropertyFromGetterAndSubscription:()=>a,createWVFromGetterAndSubscription:()=>s.createWVFromGetterAndSubscription,createWVFromGetterAndSubscriptions:()=>r.createWVFromGetterAndSubscriptions,createWVFromProperty:()=>n});var s=i(551910),r=i(979861);function n(e){return(0,s.createWVFromGetterAndSubscription)((()=>e.value()),e)}var o=i(149926);function a(e,t){const i=(0,o.createPrimitiveProperty)(e()),s={};return i.destroy=()=>{t.unsubscribeAll(s)},t.subscribe(s,(()=>{i.setValue(e())})),i}function l(e,...t){const i=()=>e(...t.map((e=>e.value()))),s=(0,o.createPrimitiveProperty)(i()),r=()=>s.setValue(i()),n={};for(const e of t)e.subscribe(n,r);return s.destroy=()=>{t.forEach((e=>e.unsubscribeAll(n)))},s}},551910:(e,t,i)=>{"use strict";i.d(t,{createWVFromGetterAndSubscription:()=>n});var s=i(210596),r=i.n(s);function n(e,t){const i=new(r())(e()),s={};t.subscribe(s,(()=>{i.setValue(e())}));return i.readonly().spawn((()=>t.unsubscribeAll(s)))}},979861:(e,t,i)=>{"use strict";i.d(t,{createWVFromGetterAndSubscriptions:()=>n});var s=i(210596),r=i.n(s);function n(e,t){const i=new(r())(e()),s={};t.forEach((t=>t.subscribe(s,(()=>{i.setValue(e())}))));return i.readonly().spawn((()=>t.forEach((e=>e.unsubscribeAll(s)))))}},976704:(e,t,i)=>{"use strict";var s=i(922157),r=i(486028).isFunction;function n(e){if(this._listeners=new s,this._childs=[],this._muteChildChanges=!1,void 0!==e)if(this.isPrimitiveType(e))this._value=e;else for(var t in e)this.addProperty(t,e[t])}n.prototype.merge=function(e,t){var i=null;if(t)var s=(i=[]).length;if(void 0===e)return i;if(this.isPrimitiveType(e))return t&&this._value!==e&&i.push(this),this._value=e,i;if(Array.isArray(e))for(var r=0;r<e.length;r++)if(this[r]){var n=this[r].merge(e[r],t);t&&(i=i.concat(n))}else this.addProperty(r,e[r]),t&&i.push(this[r]);else for(var o in e)if(this[o]){n=this[o].merge(e[o],t);t&&void 0!==n&&(i=i.concat(n))}else this.addProperty(o,e[o]),t&&i.push(this[o]);return t&&i.length>s&&i.push(this),i},n.prototype.mergeAndFire=function(e){var t=this.merge(e,!0);this._muteChildChanges=!0,t.forEach((function(e){e._muteChildChanges=!0})),t.forEach((function(e){e._muteChildChanges=!1,e.listeners().fire(e)})),this._muteChildChanges=!1,t.length>0&&this.listeners().fire(this)},n.prototype.state=function(e){var t=r(this.value)?this.value():void 0;void 0===t&&(t={});for(var i=0;i<this._childs.length;i++){var s=this._childs[i];if(e&&-1!==e.indexOf(s))continue;const r=this[s];let l;if(e){for(var n=[],o=0;o<e.length;o++){var a=e[o];a.startsWith(s+".")&&n.push(a.substring(s.length+1))}l=r.state(n)}else l=r.state();(void 0!==l||r.storeStateIfUndefined())&&(t[s]=l)}return t},n.prototype.storeStateIfUndefined=function(){return!0},n.prototype.clone=function(e){return new n(this.state())},n.prototype.isPrimitiveType=function(e){
return null===e||(!!isNumber(e)||("string"==typeof e||"boolean"==typeof e))},n.prototype.value=function(){return this._value},n.prototype.listeners=function(){return this._listeners},n.prototype.childCount=function(){return this._childs.length},n.prototype.childNames=function(){return this._childs},n.prototype.child=function(e){return this[e]},n.prototype.setValue=function(e,t){(this._value!==e||t)&&(this._value=e,this._listeners.fire(this))},n.prototype.setValueSilently=function(e){this._value=e},n.prototype.addProperty=function(e,t){var i=new n(t);this[e]=i,this._childs.push(e),i.subscribe(this,this.childChanged)},n.prototype.removeProperty=function(e){this[e].unsubscribe(this,this.childChanged),delete this[e],this._childs=this._childs.filter((function(t){return t!==e}))},n.prototype.hasChild=function(e){return this._childs.indexOf(e)>=0},n.prototype.addChild=function(e,t){this[e]&&this[e].unsubscribe(this,this.childChanged),this[e]=t,-1===this._childs.indexOf(e)&&this._childs.push(e),t.subscribe(this,this.childChanged)},n.prototype.childChanged=function(e,t){this._muteChildChanges||this.listeners().fire(this)},n.prototype.subscribe=function(e,t){this.listeners().subscribe(e,t,!1)},n.prototype.unsubscribe=function(e,t){this.listeners().unsubscribe(e,t)},n.prototype.unsubscribeAll=function(e){this.listeners().unsubscribeAll(e)},n.prototype.childs=function(){return this},e.exports=n},729357:(e,t,i)=>{"use strict";i.d(t,{QuotesProvider:()=>a});var s=i(588163),r=i(922157),n=i.n(r),o=i(220863);class a{constructor(e="full"){this._quotes=null,this._quoteSessionSymbol=null,this._quoteSessionClientId="",this._pausedQuoteSessionSymbol=null,this._quotesUpdate=new(n()),this._quoteSymbolChanged=new(n()),this._multiplexerType=e}setQuotesSessionSymbol(e){this._quoteSessionSymbol!==e&&(this._pausedQuoteSessionSymbol=null,this._quoteSessionClientId||(this._quoteSessionClientId="series-"+(0,o.guid)()),this._unsubscribeQuoteSession(),e&&this._subscribeQuoteSession(e),this._quoteSymbolChanged.fire())}quotesUpdate(){return this._quotesUpdate}quoteSymbolChanged(){return this._quoteSymbolChanged}quotes(){return this._quotes}isPaused(){return null!==this._pausedQuoteSessionSymbol}pause(){null===this._pausedQuoteSessionSymbol&&(this._pausedQuoteSessionSymbol=this._quoteSessionSymbol,this._unsubscribeQuoteSession())}resume(){null!==this._pausedQuoteSessionSymbol&&(this._subscribeQuoteSession(this._pausedQuoteSessionSymbol),this._pausedQuoteSessionSymbol=null)}destroy(){this._unsubscribeQuoteSession()}_onUpdate(e,t){this._quotes=e&&e.values||null,t&&t.values&&this._quotesUpdate.fire(e,t)}_subscribeQuoteSession(e){this._quoteSessionSymbol=e,(0,s.getQuoteSessionInstance)(this._multiplexerType).subscribe(this._quoteSessionClientId,this._quoteSessionSymbol,this._onUpdate.bind(this))}_unsubscribeQuoteSession(){this._quoteSessionSymbol&&((0,s.getQuoteSessionInstance)(this._multiplexerType).unsubscribe(this._quoteSessionClientId,this._quoteSessionSymbol),this._quoteSessionSymbol=null,this._quotes=null)}}},382213:(e,t,i)=>{"use strict";i.r(t),
i.d(t,{normalizeIntervalString:()=>_,isAvailable:()=>m,setLastUsedResolution:()=>g,getRangeResolution:()=>f,getTimeBasedResolution:()=>v,getDefaultResolution:()=>S,getResolutionByChartStyle:()=>y,getApplicableIntervalForFrequency:()=>b,getServerInterval:()=>w,isResolutionMultiplierValid:()=>P,getMaxResolutionValue:()=>T,getResolutionsFromSettings:()=>x,convertResolutionsFromSettings:()=>I,mergeResolutions:()=>M,sortResolutions:()=>L,compareResolutions:()=>k,getCustomResolutions:()=>E,getTranslatedResolution:()=>D,getTranslatedResolutionModel:()=>B,isSecondsEnabled:()=>R,isTicksEnabled:()=>N,isIntervalEnabled:()=>O,parseIntervalValue:()=>F,intervalIsSupported:()=>W});var s=i(509806),r=i(638273),n=i(632054),o=i(870122),a=i(688401),l=i(909196),c=i(486028),h=i(484727);const d={[r.ResolutionKind.Ticks]:1,[r.ResolutionKind.Seconds]:60,[r.ResolutionKind.Minutes]:1440,[r.SpecialResolutionKind.Hours]:24,[r.ResolutionKind.Days]:365,[r.ResolutionKind.Weeks]:52,[r.ResolutionKind.Months]:12,[r.ResolutionKind.Range]:1e6,[r.ResolutionKind.Invalid]:NaN},u={[r.ResolutionKind.Ticks]:0,[r.ResolutionKind.Seconds]:1,[r.ResolutionKind.Minutes]:2,[r.SpecialResolutionKind.Hours]:3,[r.ResolutionKind.Days]:4,[r.ResolutionKind.Weeks]:5,[r.ResolutionKind.Months]:6,[r.ResolutionKind.Range]:7,[r.ResolutionKind.Invalid]:8},p={[r.ResolutionKind.Invalid]:"",[r.ResolutionKind.Ticks]:s.t(null,{context:"interval_short"},i(959231)),[r.ResolutionKind.Seconds]:s.t(null,{context:"interval_short"},i(2949)),[r.ResolutionKind.Minutes]:s.t(null,{context:"interval_short"},i(806791)),[r.SpecialResolutionKind.Hours]:s.t(null,{context:"interval_short"},i(113994)),[r.ResolutionKind.Days]:s.t(null,{context:"interval_short"},i(713395)),[r.ResolutionKind.Weeks]:s.t(null,{context:"interval_short"},i(185521)),[r.ResolutionKind.Months]:s.t(null,{context:"interval_short"},i(137720)),[r.ResolutionKind.Range]:s.t(null,{context:"interval_short"},i(269838))};function _(e){return r.Interval.parse(e).value()}function m(e){const t=r.Interval.parse(e);if(!R()&&t.isSeconds())return!1;if(!N()&&t.isTicks())return!1;const i=t.value(),s=a.linking.dataFrequencyResolution.value();if(void 0!==s&&k(i,s)<0)return!1;const n=a.linking.supportedResolutions.value();return void 0!==n?void 0!==n.find((e=>_(e)===i)):t.isSeconds()?Boolean(a.linking.seconds.value()):t.isTicks()?Boolean(a.linking.ticks.value()):t.isIntraday()?Boolean(a.linking.intraday.value()):t.isDWM()}function g(e){r.Interval.isValid(e)&&(r.Interval.isRange(e)?o.setValue("chart.lastUsedRangeResolution",e):o.setValue("chart.lastUsedTimeBasedResolution",e))}function f(e){const t=o.getValue("chart.lastUsedRangeResolution");if(void 0!==t&&r.Interval.isRange(t))return t;let i="100R";for(const t of e){const e=r.Interval.parse(t);if(e.isRange()){const t=e.value();if("100R"===t)return t;i=t}}return i}function v(e){const t=o.getValue("chart.lastUsedTimeBasedResolution");if(void 0!==t&&r.Interval.isTimeBased(t))return t;let i="1D";for(const t of e){const e=r.Interval.parse(t);if(e.isTimeBased()){const t=e.value();if("1D"===t)return t;i=t}}
return i}function S(e){return e?"100R":"1D"}function y(e,t,i){const s=n.isRangeStyle(e),o=r.Interval.isRange(t);return!s&&o?v(i):s&&!o?f(i):t}function b(e,t){return k(t,e)>=0?t:e}function w(e){return r.Interval.isRange(e)?"1":e}function P(e){const{interval:t,guiResolutionKind:i}=r.Interval.parseExt(e);if(!t.isValid())return!1;return(i===r.SpecialResolutionKind.Hours?t.multiplier()/60:t.multiplier())<=C(i)}function C(e){const t=d[e];return Number.isNaN(t)?1:t}function T(e){return C(r.Interval.parseExt(e).guiResolutionKind)}function x(e){const t=I(o.getJSON(e,[]));return(0,l.uniq)(t.filter(P).map(_))}function I(e){return Array.isArray(e)?e:Object.keys(e).map(r.Interval.normalize).filter(c.notNull)}function M(...e){let t=[].concat(...e);return t=(0,l.uniq)(t.filter(P).map(_)),L(t)}function L(e){return e.sort(k)}function A(e){const t=r.Interval.parse(e),i=t.multiplier()||1;return t.isMinuteHours()?[r.SpecialResolutionKind.Hours,i/60]:[t.kind(),i]}function k(e,t){if(e===t)return 0;const[i,s]=A(e),[r,n]=A(t);return i!==r?u[i]-u[r]:s-n}function E(){return[]}function D(e){const{multiplier:t,shortKind:i}=B(e);return`${t}${i}`}function B(e,t){const i=r.Interval.parse(e);let s=i.multiplier(),n=i.kind();if(!i.isValid()){if(t)return null;throw new TypeError("Can't translate invalid interval")}return i.isMinuteHours()&&(s=Math.floor(s/60),n=r.SpecialResolutionKind.Hours),{multiplier:s.toString(),shortKind:V(n),hint:`${s} ${V(n,s)}`,mayOmitMultiplier:i.isDWM()&&1===s,mayOmitShortKind:i.isMinutes()&&!i.isMinuteHours()}}function V(e,t){if(!t)return p[e];switch(e){case r.ResolutionKind.Ticks:return s.t(null,{plural:"ticks",count:t},i(699136));case r.ResolutionKind.Days:return s.t(null,{plural:"days",count:t},i(730572));case r.ResolutionKind.Weeks:return s.t(null,{plural:"weeks",count:t},i(947966));case r.ResolutionKind.Months:return s.t(null,{plural:"months",count:t},i(99062));case r.ResolutionKind.Seconds:return s.t(null,{plural:"seconds",count:t},i(671787));case r.ResolutionKind.Minutes:return s.t(null,{plural:"minutes",count:t},i(569143));case r.SpecialResolutionKind.Hours:return s.t(null,{plural:"hours",count:t},i(52254));case r.ResolutionKind.Range:return s.t(null,{plural:"ranges",count:t},i(682797));default:return e}}function R(){return h.enabled("seconds_resolution")}function N(){return h.enabled("tick_resolution")}function O(e){{const t=r.Interval.parse(e);if(!R()&&t.isSeconds())return!1;if(!N()&&t.isTicks())return!1}return!0}function F(e){let t;t=/^[,\s]*(^[1-9][0-9]*)?\s*([hdwmst]?)\s*$/i;const i=t.exec(e)||[],s=~~i[1],r=i[2]&&i[2].toUpperCase()||null,n={qty:!s&&r?1:s,unit:r};return n.error=!s&&!r,n.intraday=!(n.error||n.unit&&"H"!==n.unit&&"S"!==n.unit&&"T"!==n.unit),n.range="R"===n.unit,n}function W(e){if(h.enabled("allow_supported_resolutions_set_only")){const t=r.Interval.normalize(e);return null!==t&&m(t)}{const t=F(e);if(t.error)return!1;if(!h.enabled("custom_resolutions")){const t=r.Interval.normalize(e),i=window.ChartApiInstance.defaultResolutions().filter(O);if(!t||-1===i.indexOf(t))return!1}
const i=a.linking.dataFrequencyResolution.value();if(void 0!==i&&null!==t.unit&&b(i,t.unit)!==t.unit)return!1;if(t.intraday)return a.linking.intraday.value();{const e=a.linking.supportedResolutions.value();return!e||null!==t.unit&&!!~e.indexOf(t.unit)}}}},10145:(e,t,i)=>{"use strict";i.d(t,{scaleRatio:()=>r,priceRangeByScaleRatio:()=>n,barSpacingByScaleRatio:()=>o});var s=i(786432);function r(e,t){if(t.isLog()||e.isEmpty()||t.isEmpty())return null;const i=function(e){if(e.isEmpty())return null;const t=e.priceRange();if(null===t)return null;const i=t.length();return e.internalHeight()/i}(t);if(null===i)return null;return e.getValidBarSpacing()/Math.max(1e-10,i)}function n(e,t,i){if(e.isLog()||null===i||e.isEmpty())return null;const r=e.priceRange();if(null===r||r.isEmpty())return null;const n=e.internalHeight()/(t/i),o=r.length();if(n===o)return r;const a=(n-o)/2;return new s.PriceRange(r.minValue()-a,r.maxValue()+a)}function o(e,t){if(e.isLog()||null===t||e.isEmpty())return null;const i=e.priceRange();if(null===i)return null;const s=i.length();return e.internalHeight()/s*t}},618851:(e,t,i)=>{"use strict";i.d(t,{createPriceScaleSelectionStrategy:()=>l,allPriceScaleSelectionStrategyInfo:()=>c});var s=i(650151),r=i(509806),n=i(663890);class o{constructor(e){this._priceScalesLimit=8,this._metaInfo=e}metaInfo(){return this._metaInfo}findSuitableScale(e,t,i,s){if(void 0!==s)return this._tryToGetDesiredPriceScale(e,t,s,i);if((0,n.isStudy)(t)){const s=t.metaInfo();if("Volume"===s.shortId&&e.containsMainSeries())return e.createPriceScaleAtPosition("overlay");const r=t.desiredPriceScalePosition();if(null!==r)return this._tryToGetDesiredPriceScale(e,t,r,i);if(void 0!==i&&((0,n.isStudy)(i)||e.isMainPane())&&s.is_price_study)return this._getPriceScaleTheSameAsForSource(i,e)}let r=!1;if((0,n.isStudy)(t)){const i=t.metaInfo().groupingKey;if(void 0!==i){const t=e.model().findNonOverlayStudyWithGroupingKey(i,e);if(null!==t)return this._getPriceScaleTheSameAsForSource(t.study,t.pane)}r=Boolean(t.metaInfo().is_price_study)}else t===e.model().mainSeries()&&(r=!0);if(r){const t=this._findFirstScaleForPriceStudy(e);if(null!==t)return t}return this.createNewPriceScaleIfPossible(e)}canCreateNewPriceScale(e){return e.leftPriceScales().length+e.rightPriceScales().length<this._priceScalesLimit}_getPriceScaleTheSameAsForSource(e,t){return t.isOverlay(e)?t.createPriceScaleAtPosition("overlay"):(0,s.ensureNotNull)(e.priceScale())}_priceScaleIsPrice(e,t){const i=e.mainSource();return!!i&&(i===t.mainSeries()||!!(0,n.isStudy)(i)&&Boolean(i.metaInfo().is_price_study))}_findFirstScaleForPriceStudy(e){const t=e.model();for(let i=0;i<this._priceScalesLimit;i++){if(e.rightPriceScales().length>i&&this._priceScaleIsPrice(e.rightPriceScales()[i],t))return e.rightPriceScales()[i];if(e.leftPriceScales().length>i&&this._priceScaleIsPrice(e.leftPriceScales()[i],t))return e.leftPriceScales()[i]}return null}_targetPriceScaleIndex(e,t){if(e.mainSource()===t.mainSeries())return 0}_tryToGetDesiredPriceScale(e,t,i,r){switch(i){case"left":
return this.canCreateNewPriceScale(e)?e.createPriceScaleAtPosition("left"):e.createPriceScaleAtPosition("overlay");case"right":return this.canCreateNewPriceScale(e)?e.createPriceScaleAtPosition("right"):e.createPriceScaleAtPosition("overlay");case"as-series":return void 0!==r?(0,s.ensureNotNull)(r.priceScale()):e.isMainPane()?(0,s.ensureNotNull)((0,s.ensureNotNull)(e.mainDataSource()).priceScale()):this.createNewPriceScaleIfPossible(e);case"overlay":return e.createPriceScaleAtPosition("overlay")}}}const a=[{name:"left",title:r.t(null,void 0,i(665323)),ctor:class extends o{constructor(e){super(e)}apply(e){const t=e.model();e.rightPriceScales().slice(0).forEach((i=>e.movePriceScale(i,"left",this._targetPriceScaleIndex(i,t))))}createNewPriceScaleIfPossible(e){return this.canCreateNewPriceScale(e)?e.createPriceScaleAtPosition("left"):e.createPriceScaleAtPosition("overlay")}}},{name:"right",title:r.t(null,void 0,i(214113)),ctor:class extends o{constructor(e){super(e)}apply(e){const t=e.model();e.leftPriceScales().slice(0).forEach((i=>e.movePriceScale(i,"right",this._targetPriceScaleIndex(i,t))))}createNewPriceScaleIfPossible(e){return this.canCreateNewPriceScale(e)?e.createPriceScaleAtPosition("right"):e.createPriceScaleAtPosition("overlay")}}},{name:"auto",title:r.t(null,void 0,i(86951)),ctor:class extends o{constructor(e){super(e)}apply(e){if(e.containsMainSeries()){const t=(0,s.ensureNotNull)((0,s.ensureNotNull)(e.mainDataSource()).priceScale());e.movePriceScale(t,"right",0)}const t=e.model();for(;e.leftPriceScales().length>e.rightPriceScales().length;){const i=e.leftPriceScales()[e.leftPriceScales().length-1];e.movePriceScale(i,"right",this._targetPriceScaleIndex(i,t))}for(;e.rightPriceScales().length-e.leftPriceScales().length>1;){const i=e.rightPriceScales()[e.rightPriceScales().length-1];e.movePriceScale(i,"left",this._targetPriceScaleIndex(i,t))}}createNewPriceScaleIfPossible(e){if(!this.canCreateNewPriceScale(e))return e.createPriceScaleAtPosition("overlay");const t=e.leftPriceScales().length<e.rightPriceScales().length?"left":"right";return e.createPriceScaleAtPosition(t)}}}];function l(e){const t=(0,s.ensureDefined)(a.find((t=>t.name===e)));return new t.ctor(t)}function c(){return a}},773423:(e,t,i)=>{"use strict";i.d(t,{SelectionIndexes:()=>r});var s=i(650151);class r{constructor(e){this._baseIndex=null,this._offsetInBar=null,this._offsetInTime=null,this._barsBetweenPoints=null,this._timescale=e}indexes(){const e=this._timescale.visibleBarsStrictRange();if(null===e)return[];const t=e.firstBar(),i=e.lastBar();if(null===this._offsetInTime||null===this._barsBetweenPoints){const e=this._timescale.barSpacing();this._barsBetweenPoints=Math.floor(120/e),this._offsetInBar=i%this._barsBetweenPoints,this._offsetInTime=this._timescale.indexToTimePoint(this._offsetInBar),this._baseIndex=this._timescale.baseIndex()}const r=this._timescale.baseIndex();this._baseIndex!==r&&(this._baseIndex=r,this._offsetInBar=(0,s.ensureNotNull)(this._timescale.timePointToIndex(this._offsetInTime)));const n=(0,
s.ensureNotNull)(this._offsetInBar),o=[];let a=Math.floor((t-n)/this._barsBetweenPoints);const l=Math.floor((i-n)/this._barsBetweenPoints);for(;a<=l;a++)o.push(n+a*this._barsBetweenPoints);return o}clear(){this._offsetInBar=null,this._offsetInTime=null,this._baseIndex=null,this._barsBetweenPoints=null}}},815553:(e,t,i)=>{"use strict";i.d(t,{SelectionRenderer:()=>l});var s=i(934026),r=i(676507),n=i(777277),o=i(411404);const a=r.colorsPalette["color-tv-blue-600"];class l{constructor(e){this._data=e||null}setData(e){this._data=e}draw(e,t){if(null===this._data||!this._data.visible)return;const i=t.pixelRatio;e.strokeStyle=void 0!==this._data.color?this._data.color:a,e.lineCap="butt";const s=Math.max(1,Math.floor(i));e.lineWidth=s;const r=this._data.vertOffset||0;for(let t=0;t<this._data.points.length;++t){const o=this._data.points[t];(n=o,Number.isFinite(n.x)&&Number.isFinite(n.y))&&(e.fillStyle=this._data.bgColors[t],this._drawMarker(e,o,r,s,i))}var n}hitTest(e){if(!this._data||!this._data.visible)return null;for(let t=0;t<this._data.points.length;t++){const i=this._data.points[t];if(i.subtract(e).length()<=5.5){const e=void 0!==this._data.pointsCursorType?this._data.pointsCursorType[t]:o.PaneCursorType.Default;return new n.HitTestResult(this._data.hittestResult,{pointIndex:i.data,cursorType:e})}}return null}doesIntersectWithBox(e){return!!this._data&&this._data.points.some((t=>(0,s.pointInBox)(t,e)))}_drawMarker(e,t,i,s,r){let n=Math.round(3.5*r*2);n%2!=s%2&&(n+=1);let o=Math.round(n+2*(.5*s+.75*r));o%2!=s%2&&(o+=1);const a=Math.round(t.x*r),l=Math.round((t.y+i)*r),c=s%2/2;e.beginPath(),e.arc(a+c,l+c,o/2,0,2*Math.PI,!0),e.closePath(),e.fill(),e.beginPath(),e.arc(a+c,l+c,n/2,0,2*Math.PI,!0),e.closePath(),e.stroke()}}},135055:(e,t,i)=>{"use strict";i.d(t,{SeriesBase:()=>li});var s=i(650151),r=i(601227),n=i(32133),o=i(559410),a=i(817808),l=i(539301),c=i(510656),h=i(445588),d=i(153026),u=i(786432),p=i(976704),_=i.n(p),m=i(632054),g=i(238695),f=i(821737),v=i(667342),S=i(160047),y=i(509806),b=i(484727),w=i(9136),P=i(606978),C=i(54031);function T(e,t){return(Math.round(e*Math.pow(10,t))/Math.pow(10,t)).toString()||""}function x(e){const t="QUANDL"===(e=e||{}).exchange,r={title:"",description:"",interval:"",exchange:"",provider:"",chartStyle:"",sessionDescription:"",priceSource:""};let n="";if(e.description&&t)if(2===e.description.split("/").length)n=e.description.split("/")[1];else{e.description.split("'").filter((e=>e.length)).forEach((e=>{let t=[];t=e&&("/"===e[0]||/\d+\/\(?/.test(e))?[e]:e.split("/").filter((e=>e.length)),n+=t[2===t.length?1:0]}))}else n=e.description?e.description:e.symbol;if(e.ticker?(r.title=e.ticker,r.description=I(n)):r.title=I(n),e.interval&&(r.interval=(0,C.translatedIntervalString)(e.interval)),t&&e.description){const t=/[\w_]+\/[\w_]+/.exec(e.description);t&&t[0]?r.provider=I(t[0].split("/")[0]):r.provider=I(e.description.split("/")[0])}return e.exchange&&(r.exchange=I(e.exchange)),r.chartStyle=I(function(e){const t=e.inputs;switch(e.style){case 4:
const r=t.style+("ATR"===t.style?`(${t.atrLength})`:""),n=(0,s.ensureDefined)(e.boxSize||t.boxSize);return`${y.t(null,void 0,i(20801))} [${r}, ${T(n,4)}]`;case 7:return`${y.t(null,void 0,i(717558))} [${t.lb}]`;case 5:const o=t.style+("ATR"===t.style?`(${t.atrLength})`:""),a=e.reversalAmount||t.reversalAmount,l=void 0!==a?`, ${T(a,8)}`:"";return`${y.t(null,void 0,i(292901))} [${o}${l}]`;case 6:const c=`${t.style}${"ATR"===t.style?"("+t.atrLength+")":""}`,h=e.boxSize||t.boxSize;return`${y.t(null,void 0,i(145113))} [${c}, ${T((0,s.ensureDefined)(h),8)}, ${t.reversalAmount}]`}return 8===e.style?y.t(null,void 0,i(240530)):""}(e)),e.sessionDescription&&(r.sessionDescription=I(e.sessionDescription)),void 0!==e.priceSource&&(r.priceSource=I(e.priceSource)),r}function I(e){return e.replace(/'/g,"")}const M=y.t(null,void 0,i(389659)),L=b.enabled("hide_unresolved_symbols_in_legend"),A=b.enabled("symbol_info_price_source");class k extends P.StatusProviderBase{constructor(e,t,i,s){super(t),this._series=e,this._statusViewProperties=i,this._options=s||{}}text(){return function(e){const t=x(e);return(e.ticker?t.description:t.title)+(t.interval?", "+t.interval:"")+function(e,t=", "){return(e.provider?`${t}${e.provider}`:"")+(e.exchange?`${t}${e.exchange}`:"")+(e.chartStyle?`${t}${e.chartStyle}`:"")+(e.branding?`${t}${e.branding}`:"")+(e.sessionDescription?`${t}${e.sessionDescription}`:"")}(t)}(this._getTitleGenerationOptions())}getSplitTitle(){return x(this._getTitleGenerationOptions())}bold(){return!1}size(){return this._statusViewProperties.childs().fontSize.value()+"px"}errorStatus(){const e=this._series.seriesErrorMessage();return null!==e?{error:e,title:M}:null}_getTitleGenerationOptions(){var e,t,i;const s=this._series.symbolInfo(),r=this._statusViewProperties.childs(),n=this._series.symbolTextSourceProxyProperty().value();let o;if(r.showExchange.value()&&s){const i=(0,m.isEconomicSymbol)(s)&&(null!==(t=null===(e=s.source2)||void 0===e?void 0:e.description)&&void 0!==t?t:s.source);o=i||s.exchange}const a=null!==(i=A&&(null==s?void 0:s.price_source_id)?this._series.model().availablePriceSources().name(s.price_source_id):null)&&void 0!==i?i:void 0;return{description:D(n,s),exchange:o,symbol:L&&null===s?"":this._series.symbol(),interval:r.showInterval.value()&&!this._options.hideResolution?this._series.interval():void 0,style:this._series.properties().childs().style.value(),inputs:this._series.getInputsProperties().state(),boxSize:this._series.data().boxSize,reversalAmount:this._series.data().reversalAmount,ticker:E(n,s),priceSource:a}}}function E(e,t){return"ticker-and-description"!==e?"":null!==t?t.name:void 0}function D(e,t){if(null!==t)return"ticker"===e?t.name:"long-description"===e&&void 0!==t.long_description?t.long_description:(0,w.getTranslatedSymbolDescription)({pro_name:t.pro_name||void 0,short_name:t.name||void 0,description:t.description||void 0,short_description:t.short_description||void 0,local_description:t.local_description||void 0,language:t.language||void 0})}class B extends S.StatusView{constructor(e,t,i,s){
super(new k(e,t,i,s)),this._invalidated=!0,this._series=e,this._series.onRestarted().subscribe(this,this.update),this._series.dataEvents().symbolResolved().subscribe(this,this.update),this._series.dataEvents().completed().subscribe(this,this.update),this._series.boxSizeValue().subscribe(this.update.bind(this)),i.childs().symbolTextSource.listeners().subscribe(this,this.update)}getSeriesPrecision(){let e=4;const t=this._series.symbolInfo();return t&&t.pricescale&&(e=Math.round(Math.log(t.pricescale)/Math.log(10))),e}round(e){const t=this.getSeriesPrecision(),i=Math.round(e*Math.pow(10,t))/Math.pow(10,t);return i?i.toString():""}update(){this._invalidated=!0}text(){return this._updateImpl(),super.text()}color(){return this._updateImpl(),super.color()}bold(){return this._updateImpl(),super.bold()}size(){return this._updateImpl(),super.size()}getSplitTitle(){return this._updateImpl(),this._statusProvider.getSplitTitle()}_updateImpl(){this._invalidated&&(this._bold=this._statusProvider.bold(),this._size=this._statusProvider.size(),this._text=this._statusProvider.text(),this._invalidated=!1)}}var V=i(665265),R=i(595398);const N={open:y.t(null,{context:"in_legend"},i(978155)),high:y.t(null,{context:"in_legend"},i(556723)),low:y.t(null,{context:"in_legend"},i(304292)),close:y.t(null,{context:"in_legend"},i(977297)),hl2:y.t(null,{context:"in_legend"},i(605801)),hlc3:y.t(null,{context:"in_legend"},i(698865)),ohlc4:y.t(null,{context:"in_legend"},i(242659))};class O extends R.SeriesValuesProvider{constructor(e,t){super(e,t);const i=t.properties().childs().paneProperties.childs().legendProperties.childs();this._showBarChange=i.showBarChange,this._showSeriesOHLC=i.showSeriesOHLC,this._showVolume=i.showVolume,this._seriesStyle=e.properties().childs().style;const s=this._emptyValues[0],r=this._emptyValues[1],n=this._emptyValues[2];s.title=N.open,r.title=N.high,n.title=N.low,s.unimportant=!0,r.unimportant=!0,n.unimportant=!0,this._emptyValues[3].title=N.close,this._emptyValues[6].title="",this._emptyValues[4].title=""}getValues(e){const t=super.getValues(e),i=this._showSeriesOHLC.value(),s=this._showBarChange.value(),r=12===this._series.style(),n=t[6];n.visible=n.visible&&s&&!r;const o=t[7];if(o.visible=o.visible&&this._showVolume.value(),this._showLastPriceAndChangeOnly()){const e=t[5];return e.visible=e.visible&&i,t}const a=(0,m.isPriceSourceStyle)(this._seriesStyle.value()),l=i&&!a,c=i&&a;return t[0].visible=l&&!r,t[1].visible=l,t[2].visible=l,t[3].visible=l&&!r,t[4].visible=c,t}}var F=i(896778);const W=y.t(null,void 0,i(313468));class z extends V.SeriesDataWindowView{constructor(e,t){super(e,t),this._backgroundColorSpawn=t.backgroundTopColor().spawn(),this._backgroundColorSpawn.subscribe(this.update.bind(this));const i=t.properties().childs().paneProperties.childs().legendProperties.childs();this._visibilityProperty=(0,F.combineProperty)(((e,t,i)=>e||t||i),i.showBarChange,i.showSeriesOHLC,i.showVolume),this._visibilityProperty.subscribe(this,this.update)}areValuesVisible(){return this._visibilityProperty.value()}additional(){
return null}marketTitle(){const e=this._series.marketStatusModel().status().value();return this._showLastPriceAndChangeOnly()&&("pre_market"===e||"post_market"===e)?`${W}:`:""}destroy(){this._backgroundColorSpawn.destroy(),this._visibilityProperty.destroy()}_createValuesProvider(e,t){return new O(e,t)}}var H=i(210596),U=i.n(H),j=i(435818),G=i(871555);function q(){const e=window.ChartApiInstance.serverTimeOffset();return Date.now()/1e3+e}function $(e,t,i){return e<=i?t<=i?1/0:t/1e3:Math.min(e,t)/1e3}class Y{constructor(e,t){this._marketStatus=new(U())(null),this._lastMarketStatus=null,this._sessionsSpec=null,this._nextSessionEdgeInternal=null,this._nextSessionEdge=new(U())(null),this._recalcNextSessionEdgeTimerId=null,this._futuresContractExpirationTime=null,this._quotesProvider=e,e.quotesUpdate().subscribe(this,this._update.bind(this)),this._resetSubscription=t,this._resetSubscription.subscribe(this,this._resetStatus)}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._quotesProvider.quoteSymbolChanged().unsubscribeAll(this),this._resetSubscription.unsubscribeAll(this),null!==this._recalcNextSessionEdgeTimerId&&clearTimeout(this._recalcNextSessionEdgeTimerId)}futuresContractExpirationTime(){return this._futuresContractExpirationTime}setSymbolInfo(e){var t,i,s,r,n;if(this._nextSessionEdgeInternal=null,null===e)return void(this._sessionsSpec=null);const o=new j.SessionSpec(e.timezone,null!==(t=e.session_display)&&void 0!==t?t:e.session,e.session_holidays,e.corrections);let a,l;const c=null===(i=e.subsessions)||void 0===i?void 0:i.find((e=>"premarket"===e.id)),h=null===(s=e.subsessions)||void 0===s?void 0:s.find((e=>"postmarket"===e.id));void 0!==c&&(a=new j.SessionSpec(e.timezone,null!==(r=c["session-display"])&&void 0!==r?r:c.session,e.session_holidays,c["session-correction"])),void 0!==h&&(l=new j.SessionSpec(e.timezone,null!==(n=h["session-display"])&&void 0!==n?n:h.session,e.session_holidays,h["session-correction"])),this._sessionsSpec={general:o,preMarket:a,postMarket:l},this._recalculateNextSessionEdge()}status(){return this._marketStatus}nextSessionEdge(){return this._nextSessionEdge}_resetStatus(){this._marketStatus.setValue(null)}_update(e){void 0!==e&&void 0!==e.values.current_session&&(this._lastMarketStatus=e.values.current_session),null!==this._lastMarketStatus?this._marketStatus.setValue(this._lastMarketStatus):this._resetStatus()}_getNextSessionEdgeInternal(){var e;if(null===this._sessionsSpec||"24x7"===this._sessionsSpec.general.spec())return null;const t=1e3*q();if(null===this._nextSessionEdgeInternal||(null!==(e=this._nextSessionEdgeInternal.timestamp)&&void 0!==e?e:1/0)<=t/1e3){const{general:e,preMarket:i,postMarket:s}=this._sessionsSpec,r=(0,G.get_timezone)(e.timezone()),n=(0,G.utc_to_cal)(r,t),o=$((0,G.cal_to_utc)(r,e.alignToNearestSessionStart(n,1)),(0,G.cal_to_utc)(r,e.alignToNearestSessionEnd(n,1)),t),a=$(void 0!==i?(0,G.cal_to_utc)(r,i.alignToNearestSessionStart(n,1)):1/0,void 0!==i?(0,G.cal_to_utc)(r,i.alignToNearestSessionEnd(n,1)):1/0,t),l=$(void 0!==s?(0,
G.cal_to_utc)(r,s.alignToNearestSessionStart(n,1)):1/0,void 0!==s?(0,G.cal_to_utc)(r,s.alignToNearestSessionEnd(n,1)):1/0,t),c=Math.min(o,a,l);c===1/0&&(this._nextSessionEdgeInternal={timestamp:null}),this._nextSessionEdgeInternal=c===l?{timestamp:c,status:"post_market"}:c===a?{timestamp:c,status:"pre_market"}:{timestamp:c}}return this._nextSessionEdgeInternal}_recalculateNextSessionEdge(){const e=this._getNextSessionEdgeInternal();if(null===e||null===e.timestamp)return void this._nextSessionEdge.setValue(null);const t={status:e.status,remainingSeconds:Math.max(0,e.timestamp-q())};if(null===this._recalcNextSessionEdgeTimerId){let e=Math.ceil(t.remainingSeconds%60);0===e&&(e+=60),this._recalcNextSessionEdgeTimerId=setTimeout((()=>this._recalculateNextSessionEdgeByTimer()),1e3*e)}this._nextSessionEdge.setValue(t)}_recalculateNextSessionEdgeByTimer(){this._recalcNextSessionEdgeTimerId=null,this._recalculateNextSessionEdge()}}var K=i(588535),Z=i(638273),X=i(290728),J=i(831551),Q=i(220863);let ee=0;class te{constructor(e,t){this._extrapolatedData=[],this._cacheForFuture=!1,this._modelId=ee++,this._builderCache=null,this._uniqueId=(0,Q.randomHashN)(6),this._resolution=t,this._symbolInfo=e,this._valid=Boolean(e.timezone)&&Boolean(e.session),this._session=new X.SessionInfo(e.timezone,e.session,e.session_holidays,e.corrections)}syncSourceTarget(){return{uniqueId:this._uniqueId,resolution:this._resolution,symbolInfo:this._symbolInfo,session:this._session.state()}}getSymbolInfo(){return this._symbolInfo}getSession(){return this._session}getResolution(){return this._resolution}uniqueId(){return this._modelId}distance(e,t){if(!this.isValid())return{success:!1};if(e>t)return{success:!1};if(e===t)return{success:!0,result:0};let i=this._extrapolatedData.length,s=0!==i?this._extrapolatedData[0]:null,r=null!==s?this._extrapolatedData[i-1]:null;const n=e<t;if(1e3*e===s&&this._cacheForFuture===n||(this._extrapolatedData=[1e3*e],i=1,s=null,r=null),null===s||null!==r&&1e3*t>r){const s=(0,J.extrapolateBarsFrontToTime)(this._barBuilder(),r||1e3*e,1e3*t,2e3,!0);this._extrapolatedData=this._extrapolatedData.concat(s.times),i=this._extrapolatedData.length,this._cacheForFuture=n}if(r=this._extrapolatedData[i-1],r<1e3*t)return{success:!1};const o=this._extrapolatedData.indexOf(1e3*t);return-1===o?{success:!1}:{success:!0,result:o}}projectTime(e,t){if(!this.isValid())return e;let i=this._extrapolatedData.length,s=i>0?this._extrapolatedData[0]:null,r=null!==s?this._extrapolatedData[i-1]:null;const n=t>=0;1e3*e===s&&this._cacheForFuture===n||(this._extrapolatedData=[1e3*e],i=1,s=null,r=null);const o=Math.abs(t);if(null===s||o>=i){const s=(0,J.extrapolateBarsFrontByCount)(this._barBuilder(),r||1e3*e,Math.sign(t)*(o-i+1),!0);this._extrapolatedData=this._extrapolatedData.concat(s.times),i=this._extrapolatedData.length,this._cacheForFuture=n}return i<o?e:this._extrapolatedData[o]/1e3}isValid(){return this._valid}dataSize(){return this._extrapolatedData.length}createNewModelWithResolution(e){return new te(this._symbolInfo,e)}_barBuilder(){
return null===this._builderCache&&(this._builderCache=(0,X.newBarBuilder)(this._resolution,this._session,this._session)),this._builderCache}}var ie=i(551910),se=i(982129),re=i(448064);const ne=(0,a.getLogger)("Chart.Definitions.Series");function oe(e,t){return"TickByTick"===e?{mode:e,updatePeriod:t}:{mode:e}}function ae(e,t,i){const s=[];return(0,se.isDelay)(e.delay)?function(e){const t=[];return(0,se.witoutRealtime)(e)?t.push(oe("DelayNoRealtime")):t.push(oe("DelayToRealtime")),t}(e):(0,se.isEod)(e,t)?(s.push(oe("EOD")),s):s}class le{constructor(e,t,i,s){this._dataUpdatedInfoStatus=new(U())(null),this._symbolInfo=(0,ie.createWVFromGetterAndSubscription)(e.getter,e.onChange),this._status=(0,ie.createWVFromGetterAndSubscription)(t.getter,t.onChange),this._updatePeriod=(0,ie.createWVFromGetterAndSubscription)(i.getter,i.onChange),this._symbolInfo.subscribe(this._update.bind(this)),this._status.subscribe(this._update.bind(this)),this._updatePeriod.subscribe(this._update.bind(this)),this._resetSubscription=s,this._resetSubscription.subscribe(this,this._resetStatus)}destroy(){this._symbolInfo.destroy(),this._status.destroy(),this._updatePeriod.destroy(),this._resetSubscription.unsubscribeAll(this)}status(){return this._dataUpdatedInfoStatus.readonly()}symbolName(){const e=this._symbolInfo.value();return null!==e?e.name:""}time(){const e=this._symbolInfo.value(),t=null!==e&&e.delay&&e.delay>0?e.delay:900;return Math.round(t/60)}listedExchange(){const e=this._symbolInfo.value();return null!==e?e.listed_exchange:""}async description(){const e=this._symbolInfo.value();if(null===e)return"";let t={};try{t=(0,s.ensureNotNull)(await(0,se.getExchange)(e))}catch(e){ne.logWarn(`Cannot get exchange ${(0,re.errorToString)(e)}`)}return t.description||e.listed_exchange}exchange(){const e=this._symbolInfo.value();return null!==e?e.exchange:""}proName(){const e=this._symbolInfo.value();return null!==e?e.pro_name:""}firstReplacedByBatsExchange(){const e=this._symbolInfo.value();return e&&(0,se.firstReplacedByBatsExchange)(e)}_resetStatus(){this._dataUpdatedInfoStatus.setValue(null)}_update(){const e=this._symbolInfo.value();if(null===e)return void this._dataUpdatedInfoStatus.setValue(null);const t=this._status.value();if("string"==typeof t)return void this._dataUpdatedInfoStatus.setValue(null);if(2===t||1===t)return;const i=ae(e,t,this._updatePeriod.value());0!==i.length?this._dataUpdatedInfoStatus.setValue(i):this._dataUpdatedInfoStatus.setValue(null)}}var ce=i(812813),he=i(486028);class de{constructor(e,t){this._dataProblem=new ce.WatchedObject(null),this._quotesProvider=e,this._quotesProvider.quotesUpdate().subscribe(this,this._update.bind(this)),this._resetSubscription=t,this._resetSubscription.subscribe(this,this._resetStatus)}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._resetSubscription.unsubscribeAll(this)}status(){return this._dataProblem}_resetStatus(){this._dataProblem.setValue(null)}_update(e){void 0===e.values||void 0===e.values.data_problem?this._resetStatus():this._dataProblem.setValue((0,
he.clone)(e.values.data_problem))}}var ue=i(729357),pe=i(602564),_e=i(672428),me=i(341537);function ge(e){return e<10?`0${e}`:e.toString()}var fe=i(273900),ve=i(744687);const Se=b.enabled("force_exchange_as_title"),ye=b.enabled("chart_style_hilo_last_price"),be=[0,1,2,3,9,8,10];ye&&be.push(12);const we={alwaysShowGlobalLast:!1,visibleOnHistoryOnly:!1,showCountdown:!0,showSymbolLabel:!0,useSolidBodyColor:!0};class Pe extends _e.PriceAxisView{constructor(e,t,i){super(),this._previousCountdown="",this._source=e,this._model=t,this._options={...we,...i}}updateCountdown(){this._countdownText()!==this._previousCountdown&&(this.update((0,ve.sourceChangeEvent)(this._source.id())),this._model.updateSourcePriceScale(this._source))}_getSource(){return this._source}_getModel(){return this._model}_isCountdownEnabled(){return this._options.showCountdown}_countdownText(){const e=Z.Interval.parse(this._source.interval());if(e.isDWM()||e.isTicks()||e.isSeconds()&&1===e.multiplier())return"";const t=this._source.data().bars().last();if(null===t)return"";const i=1e3*(0,s.ensure)(t.value[0]),r=Z.Interval.parse(this._source.interval()).inMilliseconds(),n=i.valueOf()+r;let o=Math.round((n-this._currentTime())/1e3);if(o<=0)return"";o=Math.min(o,r/1e3);let a=null;o>=3600&&(a=ge(Math.floor(o/3600))),o%=3600;const l=ge(Math.floor(o/60));o%=60;const c=ge(Math.floor(o));return null!==a?`${a}:${l}:${c}`:`${l}:${c}`}_updateRendererData(e,t,i){var r;if(e.visible=!1,t.visible=!1,!this._source.isVisible())return;const n=this._source.properties().childs();if(!ye&&12===n.style.value())return;const o=this._model.timeScale().visibleBarsStrictRange(),a=this._source.data().last();if(null===o||null===a)return;if(this._options.visibleOnHistoryOnly&&o.contains(a.index))return;const l=this._model.properties().childs().scalesProperties.childs();let c=l.showSeriesLastValue.value(),h=this._isCountdownEnabled()&&n.showCountdown.value()&&be.includes(n.style.value())&&(this._options.alwaysShowGlobalLast||o.contains(a.index)),d=this._options.showSymbolLabel&&l.showSymbolLabels.value();const u=l.seriesLastValueMode.value()===me.PriceAxisLastValueMode.LastPriceAndPercentageValue,p=this._source.lastValueData(void 0,this._options.alwaysShowGlobalLast);if(p.noData)return;const _=8===n.style.value();if((c||h||d)&&_&&n.haStyle.childs().showRealLastPrice.value()){const e=this._source.lastValueData(void 0,!1),t=this._source.lastValueData(void 0,!0);e.noData||t.noData||e.index!==t.index||(c=!1,h=!1,d=!1)}const m=(0,pe.resetTransparency)(this._source.priceLineColor(p.color));if(this._options.useSolidBodyColor?(i.background=m,i.borderColor=void 0):(i.background=this._model.backgroundColorAtYPercentFromTop((null!==(r=i.fixedCoordinate)&&void 0!==r?r:i.coordinate)/(0,s.ensureNotNull)(this._model.paneForSource(this._source)).height()),i.borderColor=m),i.coordinate=p.coordinate,i.floatCoordinate=p.floatCoordinate,c||h){const t=this._axisFirstLineText(p,c);e.text=t,this._options.useSolidBodyColor?(i.textColor=this.generateTextColor(i.background),
e.borderVisible=!1):(e.borderVisible=!0,i.textColor=m),e.textColor=i.textColor;const s=c&&u?(0,fe.getOppositeModePriceText)(this._source.priceScale(),p):"";e.secondLine=s,i.secondLineTextColor=i.textColor;const r=h?this._countdownText():"";this._previousCountdown=r,e.thirdLine=r,i.thirdLineTextColor=(0,pe.generateColor)(i.textColor,25),0===t.length&&0===s.length&&0===r.length||(e.visible=!0)}d&&(t.text=this._paneText(d),t.visible=t.text.length>0)}_paneText(e){let t="";const i=this._source.symbolInfo();return Se?t=(0,m.displayedSymbolExchange)(i):e&&(t=(0,m.displayedSymbolName)(i)),t}_axisFirstLineText(e,t){return t?(0,fe.getCurrentModePriceText)(this._source.priceScale(),e):""}_currentTime(){return Date.now()+1e3*this._source.serverTimeOffset()}}class Ce extends _e.PriceAxisView{constructor(e,t){super(),this._source=e,this._model=t}_updateRendererData(e,t,i){e.visible=!1;const s=this._source;if(!this._model.properties().childs().scalesProperties.childs().showSeriesPrevCloseValue.value())return;if(s.isDWM())return;const r=s.prevClose();if(null===r)return;const n=(0,pe.resetTransparency)(this._source.properties().childs().prevClosePriceLineColor.value());i.background=n,i.textColor=this.generateTextColor(n),i.coordinate=r.coordinate,e.text=(0,fe.getCurrentModePriceText)(s.priceScale(),r),e.visible=!0}}var Te=i(470313),xe=i(284269);class Ie extends Te.SeriesHorizontalLinePaneView{constructor(e){super(e),this._lineRendererData.linestyle=xe.LINESTYLE_DOTTED}_updateImpl(){this._lineRendererData.visible=!1;const e=this._series.properties().childs();if(!e.showPrevClosePriceLine.value())return;if(this._series.isDWM())return;const t=this._series.prevClose();null!==t&&(this._lineRendererData.visible=!0,this._lineRendererData.y=t.coordinate,this._lineRendererData.color=e.prevClosePriceLineColor.value(),this._lineRendererData.linewidth=e.prevClosePriceLineWidth.value())}}i(611593);var Me=i(203308),Le=i(86441),Ae=i(773423),ke=i(777277);class Ee{constructor(e,t){this._bars=[],this._invalidated=!0,this._isMarkersEnabled=(0,b.enabled)("source_selection_markers"),this._selectionData=null,this._blockSize=0,this._series=e,this._model=t,this._selectionIndexer=new Ae.SelectionIndexes(t.timeScale())}update(){this._invalidated=!0}nearestIndex(e,t){var i,s;return null!==(s=null===(i=this.bars().search(e,t))||void 0===i?void 0:i.index)&&void 0!==s?s:null}items(){return this._bars}_updateImpl(){if(this._bars=[],6===this._series.properties().childs().style.value()&&!this._series.data().boxSize)return;const e=this._series.priceScale(),t=this._model.timeScale();if(t.isEmpty()||!e||e.isEmpty())return;const i=t.visibleStrictDataRange(this.bars());if(null===i)return;if(0===this.bars().size())return;if(this._series.data().bars().isEmpty())return;let r=i.firstBar();const n=i.lastBar(),o=this._series.firstValue();if(null===o)return;for(;r<=n;r++){if(null!==this.bars().valueAt(r))break}if(r>n)return;const a=this.bars().range(r,n),l=this._series.barColorer(),c={},h=this._series.properties().childs().style.value(),d=5===h||6===h,u=this.isProjection(),p=(0,
s.ensureNotNull)(this.bars().lastIndex()),_=6===h?(0,s.ensureDefined)(this._series.data().boxSize):0;if(a.each(((e,t)=>{const i=t[1],s=t[2],r=t[3],n=t[4];if(void 0===i||void 0===s||void 0===r||void 0===n||null===i||null===s||null===r||null===n)return!1;c.value=t;const o=l.barStyle(e,u,c),a=d?t[6]:void 0,m={time:Math.round(e),open:i,high:s,low:r,close:n,color:o.barColor,borderColor:o.barBorderColor,isUp:o.isBarUp};switch(c.previousValue=t,h){case 6:m.low-=.5*_,m.high+=.5*_,m.upColor=o.upColor,m.downColor=o.downColor,m.isMergedBar=o.isMergedBar,m.additionalNum=Math.round(1+(s-r)/_);break;case 5:if(m.upColor=o.upColor,m.downColor=o.downColor,m.isTwoColorBar=o.isTwoColorBar,!(0,Me.default)(a))break;m.additionalPrice=a,u&&m.time===p&&(m.combinedWithProjection=!0)}return this._bars.push(m),!1})),6===h&&(this._blockSize=(e.priceToCoordinate(0,o)-e.priceToCoordinate(500,o))/500*_),e.barPricesToCoordinates(this._bars,o),t.barIndexesToCoordinates(this._bars),this._model.selection().isSelected(this._series)){const i=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,barSpacing:t.barSpacing(),hittestResult:ke.HitTestResult.REGULAR};const r=(0,s.ensureNotNull)(this._model.paneForSource(this._series)).height();this._selectionData.hittestResult=ke.HitTestResult.REGULAR;for(let s=0;s<i.length;s++){const n=i[s],a=this._series.bars().valueAt(n);if(null===a)continue;const l=a[1],c=a[4];if(null==l||null==c)continue;const h=.5*(l+c),d=t.indexToCoordinate(n),u=e.priceToCoordinate(h,o);this._selectionData.points.push(new Le.Point(d,u)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(u/r))}}else this._selectionIndexer.clear()}}class De extends Ee{bars(){return this._series.bars()}isProjection(){return!1}}class Be extends Ee{bars(){return this._series.nsBars()}isProjection(){return!0}}var Ve=i(929654);class Re extends Pe{lastPrice(){return this._getSource().data().lastProjectionPrice}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const r=this._getModel(),n=this._getSource(),o=n.priceScale(),a=r.timeScale(),l=this.lastPrice();if(a.isEmpty()||o.isEmpty()||void 0===l)return;const c=a.visibleBarsStrictRange();if(null===c)return;const h=c.firstBar(),u=c.lastBar(),p=n.data(),_=p.search(u,d.PlotRowSearchMode.NearestLeft);if(null===_)return;const m=n.nearestIndex(h,d.PlotRowSearchMode.NearestRight);if(void 0===m)return;const g=n.model().properties().childs().scalesProperties.childs(),f=(0,s.ensureNotNull)(p.valueAt(m))[4];let v=i.background,S=g.showSeriesLastValue.value(),y=!1,b=!1,w=!1;const P=n.lastValueData(4,!1),C=n.properties().childs();if(8===C.style.value()&&C.haStyle.childs().showRealLastPrice.value()){const e=n.lastValueData(4,!0);if(e.noData||e.color===i.background||(v=(0,pe.resetTransparency)(e.color)),!e.noData&&!P.noData){const t=e.index===P.index;y=t&&g.showSymbolLabels.value(),b=g.seriesLastValueMode.value()===me.PriceAxisLastValueMode.LastPriceAndPercentageValue,S=S&&t,w=t&&this._isCountdownEnabled()&&C.showCountdown.value()}}else{
const e=n.barColorer().barStyle(_.index,!0);v=(0,pe.resetTransparency)(e.barColor)}if(i.background=v,i.textColor=this.generateTextColor(v),i.secondLineTextColor=i.textColor,i.thirdLineTextColor=(0,pe.generateColor)(i.textColor,25),i.coordinate=o.priceToCoordinate(l,f),e.visible=S||w,!P.noData){const i=n.priceScale().isPercentage();P.formattedPriceAbsolute=o.formatPriceAbsolute(l),P.formattedPricePercentage=o.formatPricePercentage(l,f,!0),P.text=i?P.formattedPricePercentage:P.formattedPriceAbsolute,e.text=this._axisFirstLineText(P,S),e.secondLine=S&&b?i?P.formattedPriceAbsolute:P.formattedPricePercentage:"",e.thirdLine=w?this._countdownText():"",t.text=this._paneText(y)}t.visible=y}}var Ne=i(70362),Oe=i(953854),Fe=i(676507);const We={light:{lineStyle:xe.LINESTYLE_DOTTED,lineWidth:1,textColor:Fe.colorsPalette["color-cold-gray-900"],backgroundColor:Fe.colorsPalette["color-tv-blue-50"],lineColor:Fe.colorsPalette["color-cold-gray-500"]},dark:{lineStyle:xe.LINESTYLE_DOTTED,lineWidth:1,textColor:Fe.colorsPalette["color-white"],backgroundColor:Fe.colorsPalette["color-tv-blue-a800"],lineColor:Fe.colorsPalette["color-cold-gray-500"]}};function ze(e){return e?We.dark:We.light}class He extends Oe.HorizontalLinePaneView{constructor(e,t,i){super(),this._model=e,this._isVisible=t.lineVisible,this._lineColor=t.lineColor,this._lineWidth=t.lineWidth,this._getValue=i}_updateImpl(){const e=this._lineRendererData;if(e.visible=!1,!this._isVisible.value())return;const t=this._model.mainSeries(),i=t.priceScale(),s=t.firstValue(),r=this._getValue();if(null===s||null===r)return;const n=ze(this._model.isDark()),o=this._lineColor.value()?this._lineColor.value():n.lineColor,a=this._lineWidth.value()?this._lineWidth.value():n.lineWidth;e.visible=!0,e.y=i.priceToCoordinate(r,s),e.linestyle=n.lineStyle,e.linewidth=a,e.color=o}}class Ue extends _e.PriceAxisView{constructor(e,t,i,s){super(),this._model=e,this._label=t,this._isVisible=i,this._getValue=s}_updateRendererData(e,t,i){if(e.visible=!1,t.visible=!1,!this._isVisible.value())return;const s=this._model.mainSeries(),r=s.priceScale(),n=s.firstValue(),o=this._getValue();if(null===n||null===o)return;const a=ze(this._model.isDark());e.visible=!0,t.visible=!0,e.text=r.formatPriceAbsolute(o),t.text=this._label,i.coordinate=r.priceToCoordinate(o,n),i.background=a.backgroundColor,i.textColor=a.textColor}}class je extends Ve.PriceLineAxisView{constructor(e,t,i){super(),this._model=e,this._isLineVisible=t,this._getValue=i}_isVisible(){return this._isLineVisible.value()}_lineWidth(){return ze(this._model.isDark()).lineWidth}_lineStyle(){return ze(this._model.isDark()).lineStyle}_priceLineColor(e){return ze(this._model.isDark()).lineColor}_value(){const e=this._model.mainSeries(),t=e.priceScale(),i=e.firstValue(),s=this._getValue();if(null===i||null===s)return{noData:!0};const r=t.priceToCoordinate(s,i);return{noData:!1,floatCoordinate:r,coordinate:r,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",formattedPriceIndexedTo100:"",text:"",index:0}}}
const Ge=y.t(null,void 0,i(330777)),qe=y.t(null,void 0,i(608136));function $e(e,t,i,s){const r=new He(e,i,s),n=new Ue(e,i.label,i.labelVisible,s);return{paneView:r,panePriceAxisView:new Ne.PanePriceAxisView(n,t,e),priceAxisView:n,priceLineAxisView:new je(e,i.lineVisible,s)}}const Ye={light:{lineStyle:xe.LINESTYLE_DOTTED,lineWidth:1,textColor:(0,Fe.getHexColorByName)("color-cold-gray-900"),backgroundColor:(0,Fe.getHexColorByName)("color-tv-blue-50"),lineColor:(0,Fe.getHexColorByName)("color-cold-gray-500")},dark:{lineStyle:xe.LINESTYLE_DOTTED,lineWidth:1,textColor:(0,Fe.getHexColorByName)("color-white"),backgroundColor:(0,Fe.getHexColorByName)("color-tv-blue-a800"),lineColor:(0,Fe.getHexColorByName)("color-cold-gray-500")}};function Ke(e){return e?Ye.dark:Ye.light}class Ze extends Oe.HorizontalLinePaneView{constructor(e,t,i){super(),this._model=e,this._isVisible=t.lineVisible,this._lineColor=t.lineColor,this._lineWidth=t.lineWidth,this._getValue=i}_updateImpl(){const e=this._lineRendererData;if(e.visible=!1,!this._isVisible.value())return;const t=this._model.mainSeries(),i=t.priceScale(),s=t.firstValue(),r=this._getValue();if(null===s||null===r)return;const n=Ke(this._model.isDark()),o=this._lineColor.value()?this._lineColor.value():n.lineColor,a=this._lineWidth.value()?this._lineWidth.value():n.lineWidth;e.visible=!0,e.y=i.priceToCoordinate(r,s),e.linestyle=n.lineStyle,e.linewidth=a,e.color=o}}class Xe extends _e.PriceAxisView{constructor(e,t,i,s){super(),this._model=e,this._label=t,this._isVisible=i,this._getValue=s}_updateRendererData(e,t,i){if(e.visible=!1,t.visible=!1,!this._isVisible.value())return;const s=this._model.mainSeries(),r=s.priceScale(),n=s.firstValue(),o=this._getValue();if(null===n||null===o)return;const a=Ke(this._model.isDark());e.visible=!0,t.visible=!0,e.text=r.formatPriceAbsolute(o),t.text=this._label,i.coordinate=r.priceToCoordinate(o,n),i.background=a.backgroundColor,i.textColor=a.textColor}}class Je extends Ve.PriceLineAxisView{constructor(e,t,i){super(),this._model=e,this._isLineVisible=t,this._getValue=i}_isVisible(){return this._isLineVisible.value()}_lineWidth(){return Ke(this._model.isDark()).lineWidth}_lineStyle(){return Ke(this._model.isDark()).lineStyle}_priceLineColor(e){return Ke(this._model.isDark()).lineColor}_value(){const e=this._model.mainSeries(),t=e.priceScale(),i=e.firstValue(),s=this._getValue();if(null===i||null===s)return{noData:!0};const r=t.priceToCoordinate(s,i);return{noData:!1,floatCoordinate:r,coordinate:r,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",formattedPriceIndexedTo100:"",text:"",index:0}}}const Qe=y.t(null,void 0,i(622554));function et(e,t,i,s){const r=i.childs(),n=function(e,t,i,s){const r=new Ze(e,i,s),n=new Xe(e,i.label,i.labelVisible,s),o=new Ne.PanePriceAxisView(n,t,e),a=new Je(e,i.lineVisible,s);return{paneView:r,panePriceAxisView:o,priceAxisView:n,priceLineAxisView:a}}(e,t,{label:Qe,labelVisible:r.averageClosePriceLabelVisible,lineVisible:r.averageClosePriceLineVisible,lineColor:r.averagePriceLineColor,
lineWidth:r.averagePriceLineWidth},(()=>s(0)));return{paneViews:[n.paneView],panePriceAxisViews:[n.panePriceAxisView],priceAxisViews:[n.priceAxisView],priceLineAxisViews:[n.priceLineAxisView]}}var tt=i(922157),it=i.n(tt),st=i(565601),rt=i(881881);class nt{constructor(){this._data=null}setData(e){this._data=e}data(){return this._data}draw(e,t){const i=this._data;if(null===i)return;const s=t.pixelRatio;e.save();const r=Math.max(1,Math.floor(s)),n=r%2/2,o=Math.round(i.center.x*s)+n,a=i.center.y*s;e.fillStyle=i.seriesLineColor,e.beginPath();const l=Math.max(2,1.5*i.seriesLineWidth)*s;e.arc(o,a,l,0,2*Math.PI,!1),e.fill(),e.fillStyle=i.fillColor,e.beginPath(),e.arc(o,a,i.radius*s,0,2*Math.PI,!1),e.fill(),e.lineWidth=r,e.strokeStyle=i.strokeColor,e.beginPath(),e.arc(o,a,i.radius*s+r/2,0,2*Math.PI,!1),e.stroke(),e.restore()}hitTest(e,t){return null}}function ot(e){return e}const at=[{start:0,end:.25,startRadius:4,endRadius:10,startFillAlpha:.25,endFillAlpha:0,startStrokeAlpha:.4,endStrokeAlpha:.8,easing:ot},{start:.25,end:.525,startRadius:10,endRadius:14,startFillAlpha:0,endFillAlpha:0,startStrokeAlpha:.8,endStrokeAlpha:0,easing:ot},{start:.525,end:1,startRadius:14,endRadius:14,startFillAlpha:0,endFillAlpha:0,startStrokeAlpha:0,endStrokeAlpha:0,easing:ot}];function lt(e,t,i,s){const r=i+(s-i)*t;return(0,pe.applyTransparency)(e,(0,pe.alphaToTransparency)(r))}function ct(e,t){const i=e%2600/2600;let s;for(const e of at)if(i>=e.start&&i<=e.end){s=e;break}if(void 0===s)throw new Error("Last price animation internal logic error");const r=s.easing((i-s.start)/(s.end-s.start));return{fillColor:lt(t,r,s.startFillAlpha,s.endFillAlpha),strokeColor:lt(t,r,s.startStrokeAlpha,s.endStrokeAlpha),radius:(n=r,o=s.startRadius,a=s.endRadius,o+(a-o)*n)};var n,o,a}class ht{constructor(e){this._renderer=new nt,this._invalidated=!0,this._stageInvalidated=!0,this._startTime=performance.now(),this._endTime=this._startTime-1,this._series=e}update(e){if(this._invalidated=!0,"data-source-change"===e.type&&e.sourceId===this._series.id()&&e.realtime&&this._series.seriesLoaded()){const e=performance.now(),t=this._endTime-e;if(t>0)return void(t<650&&(this._endTime+=2600));this._startTime=e,this._endTime=e+2600}}invalidateStage(){this._stageInvalidated=!0}animationActive(){return performance.now()<=this._endTime}stopAnimation(){this._endTime=this._startTime-1}renderer(e,t){return this._invalidated?(this._updateImpl(e,t),this._invalidated=!1,this._stageInvalidated=!1):this._stageInvalidated&&(this._updateRendererDataStage(),this._stageInvalidated=!1),this._renderer}_updateImpl(e,t){this._renderer.setData(null);const i=this._series.model().timeScale(),s=i.visibleBarsStrictRange(),r=this._series.firstValue(),n=this._series.lastValueData(void 0,!0,!0);if(null===s||null===r||void 0===n.index||void 0===n.price||!s.contains(n.index))return;const o=new Le.Point(i.indexToCoordinate(n.index),this._series.priceScale().priceToCoordinate(n.price,r)),a=n.color,l=this._series.properties().childs();let c;switch(this._series.style()){case 3:
c=l.areaStyle.childs().linewidth.value();break;case 10:const t=l.baselineStyle,i=Math.round(e*(Math.abs(100-t.childs().baseLevelPercentage.value())/100));c=o.y<=i?t.childs().topLineWidth.value():t.childs().bottomLineWidth.value();break;default:c=l.lineStyle.childs().linewidth.value()}const h=ct(this._duration(),a);this._renderer.setData({seriesLineColor:a,seriesLineWidth:c,fillColor:h.fillColor,strokeColor:h.strokeColor,radius:h.radius,center:o})}_updateRendererDataStage(){const e=this._renderer.data();if(null!==e){const t=ct(this._duration(),e.seriesLineColor);e.fillColor=t.fillColor,e.strokeColor=t.strokeColor,e.radius=t.radius}}_duration(){return this.animationActive()?performance.now()-this._startTime:2599}}var dt=i(706486),ut=i(243387),pt=i(994528),_t=i(382213);const mt=b.enabled("chart_style_hilo_last_price");class gt extends Te.SeriesHorizontalLinePaneView{constructor(e){super(e),this._lineRendererData.linestyle=xe.LINESTYLE_DOTTED}_updateImpl(){this._lineRendererData.visible=!1;const e=this._series.properties().childs();if(!e.showPriceLine.value())return;if(!mt&&12===e.style.value())return;const t=this._series.lastValueData(void 0,!0);t.noData||(this._lineRendererData.visible=!0,this._lineRendererData.y=t.coordinate,this._lineRendererData.color=this._series.priceLineColor(t.color),this._lineRendererData.linewidth=e.priceLineWidth.value())}}var ft=i(404356),vt=i(740517),St=i(385824),yt=i(815553),bt=i(918922),wt=i(42152);class Pt extends wt.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barWidth=e.barSpacing}draw(e,t){e.save();const i=Math.round(t.pixelRatio*this._barWidth/2);let s=null;for(let r=0;r<this._bars.length;++r){const n=this._bars[r],o=Math.round(n.time*t.pixelRatio),a=null===s?Math.round(o-i):s+1,l=(r<this._bars.length-1?Math.round(this._bars[r+1].time*t.pixelRatio):o+2*i)-i-a,c=Math.round(Math.min(n.close,n.open)*t.pixelRatio),h=Math.round(Math.max(n.close,n.open)*t.pixelRatio)-c+1;e.fillStyle=n.borderColor,e.fillRect(a,c,l,h),e.fillRect(o,Math.round(n.high*t.pixelRatio),1,Math.round((n.low-n.high)*t.pixelRatio)),e.fillStyle=n.color,e.fillRect(a+1,c+1,l-2,h-2),s=a+l-1}e.restore()}_getTolerance(){return(0,bt.interactionTolerance)().series+.5}_getBarSpacing(){return this._barWidth}}class Ct extends De{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const i={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()},s=new St.CompositeRenderer;return s.append(new Pt(i)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&s.append(new yt.SelectionRenderer(this._selectionData)),s}}class Tt extends Be{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const i={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()};return new Pt(i)}}class xt extends De{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const i={bars:this._bars,barSpacing:.9*this._model.timeScale().barSpacing()},s=new St.CompositeRenderer;return s.append(new Pt(i)),
this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&s.append(new yt.SelectionRenderer(this._selectionData)),s}}class It extends Be{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const i={bars:this._bars,barSpacing:.9*this._model.timeScale().barSpacing()};return new Pt(i)}}class Mt extends wt.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barSpacing=e.barSpacing,this._barLineWidth=Math.max(1,(0,bt.optimalBarWidth)(e.barSpacing,1))}draw(e,t){let i,s,r;e.save(),e.lineCap="square";const n=Math.floor(t.pixelRatio)%2?1:0;for(const o of this._bars){const a=Math.round(t.pixelRatio*this._barLineWidth*.5),l=Math.round(t.pixelRatio*o.time-a),c=void 0===s||o.isUp?Math.round(t.pixelRatio*o.high-a):s,h=2*a;let d;if(o.isTwoColorBar){const s=Math.round(t.pixelRatio*o.additionalPrice-t.pixelRatio*o.high+a),r=c+s,u=Math.round(t.pixelRatio*o.low-t.pixelRatio*o.additionalPrice+a),p=void 0!==i&&o.isUp?i:r+u;e.fillStyle=o.upColor,e.fillRect(l,c,h+n,s),e.fillStyle=o.downColor,e.fillRect(l,r,h+n,p+a-r+1),d=p}else{const s=Math.round(t.pixelRatio*o.low-t.pixelRatio*o.high+a),r=void 0!==i&&o.isUp?i:c+s;e.fillStyle=o.color,e.fillRect(l,c,h+n,r+a-c+1),d=r}if(!o.combinedWithProjection){o.isTwoColorBar?e.fillStyle=o.isUp?o.downColor:o.upColor:e.fillStyle=o.color;const i=void 0===r?Math.round((o.time-this._barSpacing)*t.pixelRatio+a):r+2*a,l=Math.round(o.time*t.pixelRatio-a)-i+1,c=2*a+n;if(o.isUp)e.fillRect(i,d-a+1-n,l,c);else{const r=void 0===s?Math.round(o.open*t.pixelRatio-a):s;e.fillRect(i,r,l,c)}}r=l,i=d,s=c}e.restore()}_getTolerance(){return(0,bt.interactionTolerance)().series+this._barLineWidth/4}_getBarSpacing(){return this._barLineWidth}}class Lt extends De{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const i={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()},s=new St.CompositeRenderer;return s.append(new Mt(i)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&s.append(new yt.SelectionRenderer(this._selectionData)),s}}class At extends Be{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const i={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()};return new Mt(i)}}var kt;!function(e){e[e.EllipseWidth=.9]="EllipseWidth",e[e.EllipseRadius=.95]="EllipseRadius",e[e.SimplifiedEllipseWidth=.86]="SimplifiedEllipseWidth"}(kt||(kt={}));class Et extends wt.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barSpacing=e.barSpacing,this._barWidth=e.barSpacing}draw(e,t){if(0===this._bars.length)return;e.save();const i=this._bars.reduce(((e,t)=>Math.max(e,(t.low-t.high)/t.additionalNum)),0);this._barSpacing>1&&i>=1?this._drawFillSigns(e,t):this._drawSimplified(e,t),e.restore()}_drawImpl(e){}_getTolerance(){return(0,bt.interactionTolerance)().series+this._barWidth/8}_getBarSpacing(){return this._barSpacing}_drawBarCross(e,t,i,s){!function(e,t,i,s,r){e.moveTo(t,i),e.lineTo(t+s,i+r),e.moveTo(t+s,i),e.lineTo(t,i+r)
}(e,t.time-.5*this._barWidth,t.high+s*i,this._barWidth,i)}_drawBarEllipse(e,t,i,s){!function(e,t,i,s,r){e.save(),e.translate(t+s/2,i+r/2),e.scale(s/2,r/2),e.moveTo(1,0),e.arc(0,0,kt.EllipseRadius,0,2*Math.PI,!1),e.restore()}(e,t.time-this._barWidth*kt.EllipseWidth*.5,t.high+s*i,this._barWidth*kt.EllipseWidth,i)}_drawFillSigns(e,t){e.scale(t.pixelRatio,t.pixelRatio),e.lineCap="butt",e.lineWidth=1;for(const t of this._bars){const i=(t.low-t.high)/t.additionalNum;if(t.isMergedBar&&(e.beginPath(),t.isUp?this._drawBarEllipse(e,t,i,t.additionalNum-1):this._drawBarCross(e,t,i,0),e.strokeStyle=t.isUp?t.downColor:t.upColor,e.stroke()),e.beginPath(),t.isUp)for(let s=t.additionalNum-1-(t.isMergedBar?1:0);s>-1;s--)this._drawBarCross(e,t,i,s);else for(let s=t.isMergedBar?1:0;s<t.additionalNum;s++)this._drawBarEllipse(e,t,i,s);e.strokeStyle=t.color,e.stroke()}}_drawSimplified(e,t){for(const i of this._bars){const s=i.isUp?1:kt.SimplifiedEllipseWidth,r=(i.time-.5*this._barWidth*s)*t.pixelRatio,n=(i.time+.5*this._barWidth*s)*t.pixelRatio,o=Math.max(1,n-r);let a=i.high*t.pixelRatio;const l=i.low*t.pixelRatio,c=i.high*t.pixelRatio;let h=Math.max(1,l-c);if(i.isMergedBar){e.fillStyle=i.isUp?i.downColor:i.upColor;const t=(i.low-i.high)/i.additionalNum,s=Math.max(1,Math.round(t));i.isUp?(e.fillRect(r,a,o,s),a+=s):(e.fillRect(r,a+o-s,o,s),h-=s)}e.fillStyle=i.color,e.fillRect(r,a,o,h)}}}class Dt extends De{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const i={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()},s=new St.CompositeRenderer;return s.append(new Et(i)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&s.append(new yt.SelectionRenderer(this._selectionData)),s}}class Bt extends Be{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const i={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()};return new Et(i)}}var Vt=i(386434),Rt=i(575960),Nt=i(170554),Ot=i(363425),Ft=i(155957),Wt=i(71133);class zt extends Nt.SeriesCandlesPaneView{renderer(e,t){this._invalidated&&(this._updateImpl(null),this._invalidated=!1);const i=this._source.priceScale();if(!i)return null;const s=this._source.properties().childs().haStyle.childs(),r=this._model.timeScale().barSpacing(),n={bars:this._bars,barSpacing:r,bodyVisible:s.drawBody.value(),borderVisible:s.drawBorder.value(),borderColor:s.borderColor.value(),wickColor:s.wickColor.value(),barWidth:(0,bt.optimalBarWidth)(r),wickVisible:s.drawWick.value(),isPriceScaleInverted:i.isInverted()},o=new St.CompositeRenderer;return o.append(new Wt.PaneRendererCandles(n)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&o.append(new yt.SelectionRenderer(this._selectionData)),o}}var Ht=i(659020),Ut=i(279822),jt=i(307007),Gt=i(254303),qt=i(663890),$t=i(563068)
;const Yt=b.enabled("price_scale_always_last_bar_value"),Kt=b.enabled("display_data_mode"),Zt=r.CheckMobile.any(),Xt=!b.enabled("hide_series_legend_item"),Jt=b.enabled("hide_price_scale_global_last_bar_value"),Qt=b.enabled("show_average_close_price_line_and_label"),ei=b.enabled("no_bars_status"),ti=b.enabled("charting_library_debug_mode"),ii=b.enabled("chart_style_hilo_last_price"),si=(0,a.getLogger)("Chart.Series"),ri=b.enabled("pre_post_market_sessions");const ni={countdownEnabled:!0,lastPriceAnimationEnabled:!0};function oi(e,t,i){return void 0===t?null:`${e}=${t} (${i?"changed":"unchanged"})`}function ai(e){const t=e.state();return t.data.forEach((e=>e.value.splice(7,1))),t}class li extends l.PriceDataSource{constructor(e,t,i,r){super(e,"_seriesId"),this.requestingIntradayWhenNotSupported=new(it()),this.requestingStyleIsNotSupported=new(it()),this.requestingStyleSupportRecovered=new(it()),this.requestingResolutionLessThanFrequency=new(it()),this._paneView=null,this._futureBarsPaneView=null,this._projectionBarsPaneView=null,this._waterlineView=null,this._priceLineView=null,this._gotoDateView=null,this._baseHorizontalLineView=null,this._priceStep=null,this._symbolInfo=null,this._prevSymbolInfo=null,this._isPrePostMarketPricesAvailableProperty=new(_())(!1),this._isBackAdjustmentForbiddenProperty=new(_())(!0),this._isSettlementAsCloseForbiddenProperty=new(_())(!0),this._highLowPriceCache=new Map,this._averagePriceCache=new Map,this._prevClosePriceAxisView=null,this._priceScaleChanged=new(it()),this._priceScaleAboutToBeChanged=new(it()),this._onRestarted=new(it()),this._onStatusChanged=new(it()),this._extendedHoursChanged=new(it()),this._tagsChanged=new(it()),this._intervalChanged=new(it()),this._sessionIdChanged=new(it()),this._requestMoreDataAvailable=!0,this._lineStyleLastPriceCirclePaneView=new ht(this),this._prevClosePriceLineView=null,this._dataPoweredBy=null,this._loading=!0,this._seriesLoaded=!1,this._status=0,this._symbolResolvingActive=new(U())(!1),this._predictBars=0,this._syncModel=null,this._data=null,this._lastCompleteFlags=null,this._haStyle={studyId:(0,s.ensureNotNull)((0,m.chartStyleStudyId)(8,!0))},this._renkoStyle={studyId:(0,s.ensureNotNull)((0,m.chartStyleStudyId)(4,!0))},this._pbStyle={studyId:(0,s.ensureNotNull)((0,m.chartStyleStudyId)(7,!0))},this._kagiStyle={studyId:(0,s.ensureNotNull)((0,m.chartStyleStudyId)(5,!0))},this._pnfStyle={studyId:(0,s.ensureNotNull)((0,m.chartStyleStudyId)(6,!0))},this._rangeStyle={studyId:(0,s.ensureNotNull)((0,m.chartStyleStudyId)(11,!0))},this._barColorerCache=null,this._boxSizeValue=new(U()),this._base=100,this._pointValue=1,this._formattingDeps=null,this._formatter=new f.PriceFormatter(this._base),this._ignoreMinMoveFormatter=new f.PriceFormatter(this._base),this._ignoreMinMovePriceStep=null,this._lastBarCloseTime=null,this._onSessionIdPropertyChangedBound=this._onSessionIdPropertyChanged.bind(this),this._ignoreSessionIdProxyPropertyChanges=!1,this._textSourceIsAlwaysTickerRestrictionEnabled=!1,this._lastPriceAnimationActive=!1,
this._currentSession="out_of_session",this._onStyleChanged=new(it()),this._intervalObj=null,this._obsoleteZOrder=0,this._seriesErrorMessage=null,this._seriesAlwaysFalseHibernatedVW=new(U())(!1),this._styleToRecover=null,this._precomputedBarStyles=new WeakMap,this._doNotShowLastAvailableBar=!1,this._gotoDateResultCleared=!1,this._endOfDataPaneView=null,this._pendingTimeRange=null,this._replaySubscriber=null,this._symbolIntervalChanged=new(it()),this._isReplayResolutionAvailableForUser=null,this._onInReplayStateChanged=new(it()),this._replayExitedDueUnsupportedInterval=new(it()),this._replayExitedDueUnavailableForUserInterval=new(it()),this._onTimeFrameApplied=new(it()),this._prevRequestedInterval="",this._isActingAsSymbolSource=new(U())(!0),this._seriesSource=new ut.SeriesDataSource(e.chartApi(),"s",r);const n=this._seriesSource.dataEvents();n.symbolResolved().subscribe(this,this._onSymbolResolved),n.symbolError().subscribe(this,this._onSymbolError),n.seriesTimeFrame().subscribe(this,this._onSeriesTimeFrame),n.seriesError().subscribe(this,this._onSeriesError),n.loading().subscribe(this,this._onSeriesLoading),n.completed().subscribe(this,this._onSeriesCompleted),n.dataUpdated().subscribe(this,this._onDataUpdated),n.barReceived().subscribe(this,this._onBarReceived),this._quotesProvider=new ue.QuotesProvider,this._quotesProvider.quotesUpdate().subscribe(this,this._onQuotesUpdate);const o=t.childs();if(t.hasChild("extendedHours")){(0,s.ensureDefined)(o.extendedHours).value()&&!t.hasChild("sessionId")&&t.addChild("sessionId",new(_())("extended")),t.removeProperty("extendedHours")}t.hasChild("sessionId")||t.addChild("sessionId",new(_())(g.SubsessionId.Regular)),this._setProperties(t),this._sessionIdProxyProperty=new(_())(o.sessionId.value()),o.sessionId.subscribe(this,(()=>this._updateSessionIdProxyProperty())),this._sessionIdProxyProperty.subscribe(this,this._onSessionIdProxyPropertyChanged),this._symbolTextSourceProxyProperty=new(_()),this._recalcSymbolTextSourceProxyProperty(),o.statusViewStyle.childs().symbolTextSource.subscribe(this,this._recalcSymbolTextSourceProxyProperty),this._symbolTextSourceProxyProperty.subscribe(this,(()=>e.lightUpdate())),this._options=(0,he.merge)((0,he.clone)(ni),i),this._prevChartStyle=o.style.value(),this._priceAxisView=new Pe(this,e,{alwaysShowGlobalLast:!Jt,showCountdown:i.countdownEnabled});let a=null;Yt||Jt||(a=new Pe(this,e,{visibleOnHistoryOnly:!0,showSymbolLabel:!1,showCountdown:!1,alwaysShowGlobalLast:!1,useSolidBodyColor:!1})),this._priceLinePriceAxisView=new Ve.SeriesPriceLineAxisView(this),this._priceLineAxisViews=[this._priceLinePriceAxisView];const l=new Re(this,e,{showCountdown:i.countdownEnabled});this._priceAxisViews=[this._priceAxisView,l],null!==a&&this._priceAxisViews.push(a),this._prevClosePriceAxisView=new Ce(this,e),this._priceAxisViews.unshift(this._prevClosePriceAxisView),this._prevClosePriceLineView=new Ie(this),this._panePriceAxisView=new Ne.PanePriceAxisView(this._priceAxisView,this,e),
this._historyPricePanePriceAxisView=null!==a?new Ne.PanePriceAxisView(a,this,e):null,this._projectionPriceAxisView=new Ne.PanePriceAxisView(l,this,e),this._labelPaneViews=[this._panePriceAxisView,this._projectionPriceAxisView],null!==this._historyPricePanePriceAxisView&&this._labelPaneViews.push(this._historyPricePanePriceAxisView),this._highLowAvgPaneViews=[],this._averagePaneViews=[],Qt&&this._createAverageViews(),this._createHighLowAvgViews(),this._subscribeRestartToSessionIdChange(),o.visible.subscribe(this,this._updateLastPriceAnimationActive),this._updateLastPriceAnimationActive(),this._dataWindowView=new V.SeriesDataWindowView(this,e),this._legendView=new z(this,e),this._statusView=new B(this,this._model.properties().childs().scalesProperties.childs().textColor,o.statusViewStyle),this._marketStatusModel=new Y(this._quotesProvider,o.symbol.listeners()),this._dataUpdatedModeModel=Kt?new le({getter:this.symbolInfo.bind(this),onChange:n.symbolResolved()},{getter:this.status.bind(this),onChange:this._onStatusChanged},{getter:()=>{var e;return null===(e=this._lastCompleteFlags)||void 0===e?void 0:e.rt_update_period},onChange:n.completed()},o.symbol.listeners()):null,this._dataProblemModel=new de(this._quotesProvider,o.symbol.listeners()),this._symbolResolvingActive.subscribe((()=>e.realignLineTools())),this._intervalChanged.subscribe(this,(()=>e.realignLineTools()))}supportsPressedChunks(){return!0}pressedChunks(e,t){return this.data().pressedChunks(e,t)}seriesErrorMessage(){return this._seriesErrorMessage}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._quotesProvider.destroy(),this._model.timeScale().visibleBarsStrictRangeChanged().unsubscribeAll(this),this._unsubscribeRestartToSessionIdChange(),this._replayExitedDueUnsupportedInterval.destroy(),this._replayExitedDueUnavailableForUserInterval.destroy(),this._onTimeFrameApplied.destroy()}isActingAsSymbolSource(){return this._isActingAsSymbolSource.readonly()}barColorer(){if(this._barColorerCache)return this._barColorerCache;let e=null;const t=this._model.dataSources();for(let i=t.length-1;i>=0;i--){const r=t[i];if((0,qt.isStudy)(r)&&r.hasBarColorer()&&!r.isSourceHidden()){const t=(0,s.ensureNotNull)(r.barColorer());null===e?e=t:e.pushBackBarColorer(t)}}return null===e?e=new Gt.SeriesBarColorer(this):e.pushBackBarColorer(new Gt.SeriesBarColorer(this)),this._barColorerCache=e,e}createPaneView(){this._paneView=null,this._projectionBarsPaneView=null,this._waterlineView=null,this._priceLineView=this.hasClosePrice()?new gt(this):null;const e=this._properties.childs().style.value();switch(e){case 0:this._paneView=new Rt.SeriesBarsPaneView(this,this._model);break;case 1:this._paneView=new Nt.SeriesCandlesPaneView(this,this._model);break;case 2:this._paneView=new Ot.SeriesLinePaneView(this,this._model);break;case 3:this._paneView=new Ft.SeriesAreaPaneView(this,this._model);break;case 8:this._paneView=new zt(this,this._model);break;case 9:this._paneView=new Ht.SeriesHollowCandlesPaneView(this,this._model);break;case 13:
this._paneView=new Vt.SeriesColumnsPaneView(this,this._model);break;case 10:{this._paneView=new Ut.SeriesBaselinePaneView(this,this._model);const e=this._properties.childs().baselineStyle.childs();this._waterlineView=new ft.SeriesWaterlinePaneView({paneHeight:()=>this.priceScale().height(),color:()=>e.baselineColor.value(),baseLevelPercentage:()=>e.baseLevelPercentage.value()});break}case 12:this._paneView=new vt.SeriesHiLoPaneView(this,this._model)}switch(e){case 4:this._paneView=new Ct(this,this._model),this._projectionBarsPaneView=new Tt(this,this._model);break;case 7:this._paneView=new xt(this,this._model),this._projectionBarsPaneView=new It(this,this._model);break;case 5:this._paneView=new Lt(this,this._model),this._projectionBarsPaneView=new At(this,this._model);break;case 6:this._paneView=new Dt(this,this._model),this._projectionBarsPaneView=new Bt(this,this._model)}if(null===this._paneView)throw Error("Unknown chart style assigned: "+e)}properties(){return this._properties}zorder(){return 0}quotesProvider(){return this._quotesProvider}currentSession(){return this._currentSession}syncModel(){if(!this._syncModel){const e=this.symbolInfo(),t=this.interval();if(!e||!t)return null;this._syncModel=new te(e,t)}return this._syncModel}labelPaneViews(){return this._labelPaneViews}topPaneViews(){const e=[];if(null!==this._gotoDateView&&e.push(this._gotoDateView),this._lastPriceAnimationActive){const t=this._lineStyleLastPriceCirclePaneView;t.animationActive()&&setTimeout((()=>this._model.invalidate(dt.InvalidationMask.cursor())),0),t.invalidateStage(),e.push(t)}return 0!==e.length?e:null}paneViews(){if(!this.properties().childs().visible.value())return null;const e=[(0,s.ensureNotNull)(this._baseHorizontalLineView),(0,s.ensureNotNull)(this._paneView)];return this._endOfDataPaneView&&e.push(this._endOfDataPaneView),this._futureBarsPaneView&&e.push(this._futureBarsPaneView),this._projectionBarsPaneView&&e.push(this._projectionBarsPaneView),null!==this._waterlineView&&e.push(this._waterlineView),e.push((0,s.ensureNotNull)(this._prevClosePriceLineView)),null!==this._priceLineView&&e.push(this._priceLineView),e.push(...this._highLowAvgPaneViews),e.push(...this._averagePaneViews),e}priceAxisViews(e,t){return e.findTargetPriceAxisViews(this,t,this._priceAxisViews,this._priceLineAxisViews)}clearHighLowPriceCache(){this._highLowPriceCache.clear()}clearAveragePriceCache(){this._averagePriceCache.clear()}priceScaleChanged(){return this._priceScaleChanged}priceScaleAboutToBeChanged(){return this._priceScaleAboutToBeChanged}disconnect(){this._seriesSource.stop(),this._predictBars=0,this._status=0,this._model.isSnapshot()||(this._prevSymbolInfo=null,this._symbolInfo=null)}isStarted(){return this._seriesSource.isStarted()}restart(e=!0){if(5===this._status)return;this._loading=!0,this._lastCompleteFlags=null,this._onRestarted.fire(),this._setStatus(1),this._updateSymbolInfo(null,e);let t=this._properties.childs().interval.value();Z.Interval.isEqual(t,this._prevRequestedInterval)&&this._notifyIntervalChanged(t);let i=null
;this._pendingTimeRange&&(i=this._pendingTimeRange,this._pendingTimeRange=null),this._onBeforeModifySeries(this.getSymbolString(),t),this._onTimeFrameApplied.fire(i),t=(0,_t.getServerInterval)(t),this._data=null,this._seriesSource.modifySeries(this._getResolvingSymbolObject(),t,i),this._seriesSource.isStarted()||this._seriesSource.start(),this._prevRequestedInterval=this.interval(),this.updateAllViews((0,ve.sourceChangeEvent)(this.id())),this._model.lightUpdate()}isSymbolInvalid(){return 4===this._status}getSymbolString(){return(0,rt.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject())}invalidateBarStylesCache(e){si.logDebug("Invalidate style cache starting from "+e),this._clearStylePlot(this.bars(),e),this._clearStylePlot(this.nsBars())}isStatusBad(){return 12===this.status()||4===this.status()||10===this.status()}isStatusError(){return 12===this.status()}actualSymbol(){return(0,m.actualSymbol)(this.symbolInfo(),this.symbol())}proSymbol(){return(0,m.proSymbol)(this.symbolInfo(),this.symbol())}onStyleChanged(){return this._onStyleChanged}style(){return this.properties().childs().style.value()}setStyle(e){this.setSymbolParams({style:e})}isRangeBasedStyle(){return(0,m.isRangeBasedStyle)(this.style())}symbolSameAsCurrent(e){return(0,st.symbolSameAsCurrent)(e,this.symbolInfo())}status(){return this._status}symbol(){return this.properties().childs().symbol.value()}symbolInfo(){return this._symbolInfo}symbolResolved(){return this.dataEvents().symbolResolved()}symbolResolvingActive(){return this._symbolResolvingActive}symbolHibernated(){return this._seriesAlwaysFalseHibernatedVW}firstValue(){const e=this.firstBar();return null===e?null:this._barFunction(e,0)}firstBar(){const e=this.model().timeScale().visibleBarsStrictRange();if(null===e)return null;const t=e.firstBar(),i=this.data().search(t,d.PlotRowSearchMode.NearestRight);return null!==i?i.value:null}formatter(e=!0){return e?this._formatter:this._ignoreMinMoveFormatter}priceStep(e=!0){return e?this._priceStep:this._ignoreMinMovePriceStep}bars(){return this.data().bars()}nsBars(){return this.data().nsBars()}interval(){return this.properties().childs().interval.value()}setInterval(e){this.setSymbolParams({interval:e})}intervalObj(){const e=this.interval();if(null!==this._intervalObj&&this._intervalObj.resolutionString===e)return this._intervalObj.interval;const t=Z.Interval.parse(e);return this._intervalObj={resolutionString:e,interval:t},t}prevClose(){const e=this.priceScale();if(e.isEmpty()||this.data().isEmpty())return null;const t=this.quotes(),i=this.firstValue();if(null===t||null===i)return null;const s=t.prev_close_price;return void 0===s?null:{coordinate:e.priceToCoordinate(s,i),floatCoordinate:e.priceToCoordinate(s,i),formattedPricePercentage:e.formatPricePercentage(s,i,!0),formattedPriceAbsolute:e.formatPriceAbsolute(s),formattedPriceIndexedTo100:e.formatPriceIndexedTo100(s,i)}}priceLineColor(e){return this.properties().childs().priceLineColor.value()||e}hasClosePrice(){return ii||12!==this.properties().childs().style.value()}
lastValueData(e,t,i){var s;const r={noData:!0},n=this.priceScale();if(this.model().timeScale().isEmpty()||n.isEmpty()||this.data().isEmpty())return r;const o=this.model().timeScale().visibleBarsStrictRange(),a=this.firstValue();if(null===o||null===a)return r;let l,c;if(t){const e=this.data().bars().last();if(null===e)return r;l=e.value,c=e.index}else{const e=this.data().bars().search(o.lastBar(),d.PlotRowSearchMode.NearestLeft);if(null===e)return r;l=e.value,c=e.index}const h=null!==(s=void 0!==e?l[e]:this._barFunction(l,2))&&void 0!==s?s:NaN,u=this.barColorer().barStyle(c,!1),p=n.priceToCoordinate(h,a),_={...n.getFormattedValues(h,a,!0),noData:!1,color:u.barColor,floatCoordinate:p,coordinate:p,index:c};return i&&(_.price=h),_}isDWM(){return this.intervalObj().isDWM()}data(){var e;return null!==(e=this._data)&&void 0!==e?e:this._seriesSource.data()}clearData(){(0,s.assert)(null===this._data,"Cannot clear loaded data"),this._seriesSource.clearData()}nearestValue(e,t,i){var s;const r=this.nearestData(e,i);return null!==(s=null==r?void 0:r.value[t])&&void 0!==s?s:void 0}onSymbolIntervalChanged(){return this._symbolIntervalChanged}onIntervalChanged(){return this._intervalChanged}onStatusChanged(){return this._onStatusChanged}onRestarted(){return this._onRestarted}onExtendedHoursChanged(){return this._extendedHoursChanged}requestMoreData(e){if(3!==this._status&&7!==this._status&&8!==this._status&&9!==this._status&&6!==this._status&&11!==this._status)return;if(this._model.timeScale().isEmpty())return;const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return;if(0===this.bars().size())return;const i=t.lastBar()-(0,s.ensureNotNull)(this.data().last()).index;if(this._predictBars<i&&(this._predictBars=i,this._seriesSource.requestMoreTickmarks(i)),!this._requestMoreDataAvailable)return;const r=(0,s.ensureNotNull)(this.bars().firstIndex()),n=e||r-t.firstBar();n<=0||(Number.isFinite(n)?(this._requestMoreDataAvailable=!1,this._loading=!0,this._seriesSource.requestMoreData(n),this._setStatus(2)):si.logWarn("requestMoreData: invalid bar count: "+n+", visible bars: ["+t.firstBar()+", "+t.lastBar()+"], last index: "+(0,s.ensureNotNull)(this.data().last()).index+", predicted bars: "+this._predictBars+", required bars:"+e))}isNeedRestart(e){return 5!==this._status&&(void 0===e&&(e=this.properties().childs().style.value()),!(0,m.isRangeStyle)(this._prevChartStyle)&&!(0,m.isRangeStyle)(e)&&!(this._prevChartStyle===e||!(0,m.isRequiringRestartSeriesStyles)(this._prevChartStyle)&&!(0,m.isRequiringRestartSeriesStyles)(e)))}isStyleSupportedForReplay(e){return 8!==e&&(0,m.isTimeBasedStyle)(e)}sessionId(){return this.properties().childs().sessionId.value()}sessionIdChanged(){return this._sessionIdChanged}priceRange(e,t){var i,r;const n=this.m_priceScale;if(this.data().isEmpty()||!n)return null;if(n.isLockScale()){const e=this._model.mainSeriesScaleRatio();if(null!==e){const i=n.internalHeight()/(this.model().timeScale().barSpacing()/e),r=(0,s.ensureNotNull)(this.data().search(t,d.PlotRowSearchMode.NearestLeft)).value,o=((0,
s.ensure)(r[2])+(0,s.ensure)(r[3]))/2;return new u.PriceRange(o-.5*i,o+.5*i)}}const o=this.priceSource();let a,l,c;if(null!==o?(a=this.data().bars().minMaxOnRangeCached(e,t,[{name:o,offset:0}]),l=this.data().nsBars().minMaxOnRangeCached(e,t,[{name:o,offset:0}])):(a=this.data().bars().minMaxOnRangeCached(e,t,[{name:"low",offset:0},{name:"high",offset:0}]),l=this.data().nsBars().minMaxOnRange(e,t,[{name:"low",offset:0},{name:"high",offset:0}])),a=(0,h.mergeMinMax)(a,l),null===a)c=new u.PriceRange(-.5,.5);else if(a.min===a.max){const e=5/(null!==(r=null===(i=this._symbolInfo)||void 0===i?void 0:i.pricescale)&&void 0!==r?r:100);c=new u.PriceRange(a.min-e,a.max+e)}else c=new u.PriceRange(a.min,a.max);return n.isLog()?new u.PriceRange(n.priceToLogical(c.minValue()),n.priceToLogical(c.maxValue())):c}autoScaleInfo(e,t){const i=this.priceRange(e,t);if(null===this._paneView)return{range:i};const s=this._paneView;return{range:i,topPixelMargin:s.topPixelMargin?s.topPixelMargin():void 0,bottomPixelMargin:s.bottomPixelMargin?s.bottomPixelMargin():void 0}}onChartStyleChanged(e=!0){var t;this._updateBarFunction(),this.isNeedRestart()&&(this.data().clear(),this.model().timeScale().scrollToRealtime(!1),this.restart(e));const i=this.properties();this._prevChartStyle=i.childs().style.value(),this._onStyleChanged.fire(i.childs().style.value()),this.invalidateBarStylesCache(),this._updateLastPriceAnimationActive(),(null===(t=this._styleToRecover)||void 0===t?void 0:t.originalStyle)!==this.style()&&(this._styleToRecover=null)}setChartStyleWithIntervalIfNeeded(e,t){const i=this.interval(),s=null!=t?t:(0,_t.getResolutionByChartStyle)(e,i,this._model.defaultResolutions()),r=Z.Interval.isEqual(s,i);this.setSymbolParams({interval:r?void 0:s,style:e})}idForAlert(){return super.idForAlert()}alertCreationAvailable(){return new(U())(!1).readonly()}hasStateForAlert(){return!1}stateForAlert(){throw new Error("Not implemented")}styleStudyInfos(){return{haStyle:this._haStyle,renkoStyle:this._renkoStyle,pbStyle:this._pbStyle,kagiStyle:this._kagiStyle,pnfStyle:this._pnfStyle,rangeStyle:this._rangeStyle}}isSpread(){var e;return"spread"===(null===(e=this._symbolInfo)||void 0===e?void 0:e.type)}isYield(){return null!==this._symbolInfo&&(0,se.isYield)(this._symbolInfo)}sessionIdProxyProperty(){return this._sessionIdProxyProperty}symbolTextSourceProxyProperty(){return this._symbolTextSourceProxyProperty}setTextSourceIsAlwaysTickerRestrictionEnabled(e){this._textSourceIsAlwaysTickerRestrictionEnabled=e,this._recalcSymbolTextSourceProxyProperty()}isPrePostMarketPricesAvailableProperty(){return this._isPrePostMarketPricesAvailableProperty}isSettlementAsCloseForbiddenProperty(){return this._isSettlementAsCloseForbiddenProperty}isBackAdjustmentForbiddenProperty(){return this._isBackAdjustmentForbiddenProperty}invalidateBarColorerCache(){this._barColorerCache=null,this.invalidateBarStylesCache()}replayExitedDueUnsupportedInterval(){throw new Error("Not implemented")}replayExitedDueUnavailableForUserInterval(){throw new Error("Not implemented")}onTimeFrameApplied(){
return this._onTimeFrameApplied}onInReplayStateChanged(){throw new Error("Not implemented")}dataWindowView(){return this._dataWindowView}statusView(){return Xt?this._statusView:null}legendView(){return this._legendView}marketStatusModel(){return this._marketStatusModel}dataUpdatedModeModel(){return this._dataUpdatedModeModel}dataProblemModel(){return this._dataProblemModel}setDefaultTimeframe(e){this._pendingTimeRange=e}loadDataTo(e){const t=this._properties.childs().interval.value();this._onTimeFrameApplied.fire(e),this._seriesSource.modifySeries(this._getResolvingSymbolObject(),(0,_t.getServerInterval)(t),e)}isInReplay(){return null!==this._replaySubscriber}quotes(){return this.data().isEmpty()?null:this._quotesProvider.quotes()}base(){return this._base}pointValue(){return this._pointValue}barCloseTime(){return this._lastBarCloseTime}priceSource(){let e=null;const t=this._properties.childs();switch(t.style.value()){case 2:e=t.lineStyle.childs().priceSource.value();break;case 3:e=t.areaStyle.childs().priceSource.value();break;case 10:e=t.baselineStyle.childs().priceSource.value();break;case 13:e=t.columnStyle.childs().priceSource.value()}return e}updateAllViews(e){var t,i,s,r,n,o,a,l,c;null===(t=this._paneView)||void 0===t||t.update(e),this._dataWindowView.update(),this._legendView.update(),this._statusView.update(),this._averagePaneViews.forEach((t=>t.update(e))),this._highLowAvgPaneViews.forEach((t=>t.update(e))),this._labelPaneViews.forEach((t=>t.update(e))),this._priceAxisViews.forEach((t=>t.update(e))),this._priceLineAxisViews.forEach((t=>t.update(e))),null===(i=this._futureBarsPaneView)||void 0===i||i.update(e),null===(s=this._projectionBarsPaneView)||void 0===s||s.update(e),null===(r=this._waterlineView)||void 0===r||r.update(e),null===(n=this._prevClosePriceLineView)||void 0===n||n.update(e),null===(o=this._priceLineView)||void 0===o||o.update(e),null===(a=this._gotoDateView)||void 0===a||a.update(e),null===(l=this._endOfDataPaneView)||void 0===l||l.update(e),null===(c=this._baseHorizontalLineView)||void 0===c||c.update(e);const h=this._model.activeStrategySource().value();null==h||h.updateAllViews(e),this._lineStyleLastPriceCirclePaneView.update(e)}barFunction(){return this._barFunction}precomputedBarStyle(e){return this._precomputedBarStyles.get(e)}setPrecomputedBarStyle(e,t){this._precomputedBarStyles.set(e,t)}setSymbolParams(e){const{symbol:t,currency:i,unit:r,style:n}=e;let o=e.interval;const a=this.properties().childs(),l=this._symbolInfo;let c,h,d;if(null!==l?(c=void 0!==t&&!(0,st.symbolSameAsCurrent)(t,l),h=void 0!==i&&!(0,st.currenciesAreSame)(i,l),d=void 0!==r&&!(0,st.unitsAreSame)(r,l,this._model.unitConversionEnabled())):(c=void 0!==t&&t!==a.symbol.value(),h=void 0!==i&&i!==a.currencyId.value(),d=void 0!==r&&r!==a.unitId.value()),void 0!==o&&!c){const e=this.getSupportedResolution(o,!1);e!==o&&(si.logWarn(`Change interval value from ${o} to ${e} because first is not supported`),o=e)}
const u=void 0!==o&&!Z.Interval.isEqual(a.interval.value(),o),p=void 0!==n&&n!==a.style.value(),_=[oi("symbol",t,c),oi("interval",o,u),oi("currency",i,h),oi("unit",r,d),oi("style",n,p)].filter((e=>null!==e)).join("; ");si.logInfo(`Applying series symbol params: ${_}`),void 0!==t&&a.symbol.setValue(t),void 0!==i&&a.currencyId.setValue(i),void 0!==r&&a.unitId.setValue(r),u&&a.interval.setValue((0,s.ensureDefined)(o)),p&&a.style.setValue(n);let m=!1;if(p){m=this.isNeedRestart();const e=!c&&(h||d);this.onChartStyleChanged(e)}!m&&(c||u||h||d)&&this._applySymbolParamsChanges({symbolChanged:c,currencyChanged:h,unitChanged:d,intervalChanged:u,styleChanged:p}),(c||h||d)&&this.model().checkLineToolSelection()}setSymbol(e){this.setSymbolParams({symbol:e})}currency(){return this.properties().childs().currencyId.value()||null}setCurrency(e){this.setSymbolParams({currency:e})}isConvertedToOtherCurrency(){return(0,m.isConvertedToOtherCurrency)(this.symbolInfo())}unit(){return this.properties().childs().unitId.value()||null}setUnit(e){this.setSymbolParams({unit:e})}measureUnitId(){return(0,m.measureUnitId)(this.symbolInfo())}isConvertedToOtherUnit(){return(0,m.isConvertedToOtherUnit)(this.symbolInfo(),this._model.unitConversionEnabled())}symbolSource(){return this}barsProvider(){return this}title(){return this.symbolTitle()}name(){return this.symbolTitle()}symbolTitle(e,t,i="exchange"){let s=this.properties().childs().symbol.value();const r=this.symbolInfo();if(null!==r){const{type:t}=r;s=(0,m.symbolTitle)(r,e,"forex"===t?"exchange":i)}return t?s:`${s}, ${(0,C.translatedIntervalString)(this.properties().childs().interval.value())}`}setObsoleteZOrder(e){this._obsoleteZOrder=e}obsoleteZOrder(){return this._obsoleteZOrder}valuesProvider(){return new O(this,this.model())}statusProvider(e){return new k(this,this._model.properties().childs().scalesProperties.childs().textColor,this.properties().childs().statusViewStyle,e)}open(e){const t=this.data().valueAt(e);return t&&t[1]}high(e){const t=this.data().valueAt(e);return t&&t[2]}low(e){const t=this.data().valueAt(e);return t&&t[3]}close(e){const t=this.data().valueAt(e);return t&&t[4]}moveItem(e,t,i){if(10===this.style()&&0===t){const t=this.priceScale(),i=this.properties().childs().baselineStyle,s=t.height(),r=100-e.y/s*100,n=r<0?0:Math.round(10*r)/10;i.childs().baseLevelPercentage.setValue(Math.max(Math.min(n,100),0))}}rerequestData(){this._applySymbolParamsChanges({force:!0})}switchToReplay(e,t){throw new Error("Not implemented")}switchToRealtime(){throw new Error("Not implemented")}requestMoreDataAvailable(){return this._requestMoreDataAvailable}seriesLoaded(){return this._seriesLoaded}endOfData(){var e;return void 0!==(null===(e=this._lastCompleteFlags)||void 0===e?void 0:e.data_completed)}endOfDataType(){var e,t;return null!==(t=null===(e=this._lastCompleteFlags)||void 0===e?void 0:e.data_completed)&&void 0!==t?t:null}dataPoweredBy(){return null}boxSizeValue(){return this._boxSizeValue}isUserDeletable(){return!1}changeTimeFrame(){(0,n.trackEvent)("GUI","Change timeframe")}
onTagsChanged(){return this._tagsChanged}state(e){var t;const i=this.obsoleteZOrder();let s={type:"MainSeries",id:this.id(),zorder:i,haStyle:this._haStyle,renkoStyle:this._renkoStyle,pbStyle:this._pbStyle,kagiStyle:this._kagiStyle,pnfStyle:this._pnfStyle,rangeStyle:this._rangeStyle,formattingDeps:this._formattingDeps};const r=this.properties().state();if((null===(t=this._symbolInfo)||void 0===t?void 0:t.ticker)&&(r.symbol=this._symbolInfo.ticker),this._model.unitConversionEnabled()||(r.unitId=null),s.state=r,e){let e=this.bars();const t=this._model.timeScale().visibleExtendedDataRange(e,0);null!==t&&(e=e.range(t.firstBar(),t.lastBar())),s={...s,bars:ai(e),nsBars:ai(this.nsBars()),symbolInfo:this._symbolInfo,rtPrice:this.data().lastProjectionPrice,boxSize:this.data().boxSize,reversalAmount:this.data().reversalAmount}}return s}restoreState(e,t){if(t&&this._setStatus(5),!this._model.unitConversionEnabled()&&e.state&&delete e.state.unitId,this._properties.mergeAndFire(e.state),this._properties.hasChild("esdBreaksStyle")&&this._properties.removeProperty("esdBreaksStyle"),this._prevChartStyle=this.properties().childs().style.value(),this.createPaneView(),t){const t=e;this.restoreData(t.bars,t.nsBars,t.symbolInfo,t.rtPrice,t.boxSize,t.reversalAmount)}e.formattingDeps&&(this._formattingDeps=e.formattingDeps,this._recreatePriceFormattingDependencies())}restoreData(e,t,i,s,r,n){this._status=5,this._data=new c.SeriesData,this._data.bars().restoreState(e),this._data.nsBars().restoreState(t),this._updateSymbolInfo(i,!1),this._data.lastProjectionPrice=s,this._data.boxSize=r;const o=this.properties().childs();r||(6===o.style.value()?this._data.boxSize=o.pnfStyle.childs().inputs.childs().boxSize.value():4===o.style.value()&&(this._data.boxSize=o.renkoStyle.childs().inputs.childs().boxSize.value())),this._data.reversalAmount=n,n||5===o.style.value()&&(this._data.reversalAmount=o.kagiStyle.childs().inputs.childs().reversalAmount.value()),this._loading=!1}async setGotoDateResult(e,t){this._gotoDateResultCleared=!1;const s=await i.e(4079).then(i.bind(i,48161));this._gotoDateResultCleared||(this._gotoDateView=new s.GotoDateView(this,e,t),this._gotoDateView.doNotShowLastAvailableBar(this._doNotShowLastAvailableBar),this._model.updateSource(this))}clearGotoDateResult(){this._gotoDateView=null,this._gotoDateResultCleared=!0}doNotShowLastAvailableBar(e){var t;this._doNotShowLastAvailableBar=e,null===(t=this._gotoDateView)||void 0===t||t.doNotShowLastAvailableBar(e)}dataUpdated(){return this.dataEvents().dataUpdated()}getSupportedResolution(e,t=!0){if(null===this._symbolInfo||!(0,st.symbolSameAsCurrent)(this.symbol(),this._symbolInfo))return e;if(Z.Interval.isRange(e)&&(0,m.isCloseBasedSymbol)(this._symbolInfo)){const t=this.interval();if(!Z.Interval.isRange(t))return t;e="1D"}const i=this._symbolInfo.data_frequency;if(void 0!==i){let s=(0,_t.getApplicableIntervalForFrequency)(i,e);if(s!==e){this._model.defaultResolutions();return t&&this.requestingResolutionLessThanFrequency.fire(i,s),s}}
if(Z.Interval.isIntraday(e)&&!this._symbolInfo.has_intraday)return t&&this.requestingIntradayWhenNotSupported.fire(),"D";if(this._symbolInfo.hasOwnProperty("supported_resolutions")){const t=Z.Interval.normalize(e),i=this._symbolInfo.supported_resolutions;if(null!==t&&-1===i.indexOf(t))return i[0]}return e}_barsState(e){const t=e.state();return t.data.forEach((e=>e.value.splice(7,1))),t}_updateBarFunction(){this._barFunction=(0,jt.barFunctionByStyle)(this.style(),this.priceSource())}_setProperties(e){e.hasChild("timeframe")||e.merge({timeframe:""}),e.hasChild("shortName")||e.merge({shortName:""}),e.hasChild("currencyId")||e.addChild("currencyId",new(_())(null)),e.hasChild("unitId")||e.addChild("unitId",new(_())(null)),this._properties=e;const t=e.childs();t.currencyId.subscribe(this,this._onCurrencyChanged),t.unitId.subscribe(this,this._onUnitChanged),t.timeframe.subscribe(this,this.changeTimeFrame),e.subscribe(this,this._onPropertiesChanged)}_updateSessionIdProxyProperty(e){const t=this._properties.childs().sessionId.value();let i=t;if(e){const e=this.symbolInfo();null!==e&&(i=e.subsession_id||t)}this._ignoreSessionIdProxyPropertyChanges=!0,this._sessionIdProxyProperty.setValue(i),this._ignoreSessionIdProxyPropertyChanges=!1}_onSessionIdProxyPropertyChanged(){this._ignoreSessionIdProxyPropertyChanges||this._properties.childs().sessionId.setValue(this._sessionIdProxyProperty.value()),this._updateLastPriceAnimationActive()}_onSymbolResolved(e){this._seriesErrorMessage=null,this._updateSymbolInfo(e,!1),this._model.updateSource(this),this._model.onWidget()||((0,n.trackEvent)("Symbol",e.listed_exchange,e.name),(0,n.trackEvent)("Symbol Type",e.type,e.listed_exchange));const t=e.minmov/e.pricescale,i=this.properties().childs();4===i.style.value()&&i.renkoStyle.childs().inputs.childs().boxSize.value()<t?i.renkoStyle.childs().inputs.merge({boxSize:t}):6===i.style.value()&&i.pnfStyle.childs().inputs.childs().boxSize.value()<t?i.pnfStyle.childs().inputs.merge({boxSize:t}):5===i.style.value()&&i.kagiStyle.childs().inputs.childs().reversalAmount.value()<t&&i.kagiStyle.childs().inputs.merge({reversalAmount:t});const s=this.interval(),r=this.getSupportedResolution(s);s!==r&&this.setSymbolParams({interval:r}),this._checkChartStyle(),this._formattingDeps={format:e.format,pricescale:e.pricescale,minmov:e.minmov,fractional:e.fractional,minmove2:e.minmove2}}_onSymbolError(e){this._setStatus(4),this._loading=!1,this._properties.childs().shortName.setValue(this._properties.childs().symbol.value()),this._model.clearAllStudies(),this.updateAllViews((0,ve.sourceChangeEvent)(this.id())),this._model.updateSource(this),e!==pt.permissionDenied&&this._model.resetTimeScale(),this._symbolResolvingActive.setValue(!1)}_sendTelemetryCounter(e,t){}_getTelemetryAdditionalData(e,t){return{}}_onSeriesError(e){this._loading=!1;let t=e.error;const i=e.ctx;if(i){const e={};Object.keys(i).forEach((t=>{e[t]=i[t].toString()})),t=t.format(e)}ti&&si.logNormal("Error reason: "+t),this._seriesErrorMessage=t;const s="unknown_symbol"!==t?12:ei&&this._symbolInfo?10:4
;this._setStatus(s),this._seriesLoaded=!0,this._enablePriceRangeReady()}_onSeriesLoading(e){this._loading=!0,this._setStatus(2)}_onDataUpdated(e,t){t?this._requestMoreDataAvailable=!0:this._lastPriceAnimationActive&&this._seriesLoaded&&this._lineStyleLastPriceCirclePaneView.update((0,ve.sourceChangeEvent)(this.id())),this._lastBarCloseTime=e&&e.closeTime||null,this._boxSizeValue.setValue(this.data().boxSize),this._statusView.update(),this.clearAveragePriceCache(),this.clearHighLowPriceCache();const i=this.model(),r=(0,s.ensureNotNull)(i.paneForSource(this));i.recalculatePane(r,(0,ve.sourceChangeEvent)({sourceId:this.id(),realtime:!t})),i.updateSource(this)}_setStatus(e){this._status=e,this._statusView.update(),this.model().updateSource(this),this._onStatusChanged.fire()}_onBarReceived(e){this.model().recalcVisibleRangeStudies(!0)}_recreateFormatter(){var e,t,i;let s=null;s=null!==(t=null===(e=null===$t.customFormatters||void 0===$t.customFormatters?void 0:$t.customFormatters.priceFormatterFactory)||void 0===e?void 0:e.call($t.customFormatters,this.symbolInfo(),this.properties().childs().minTick.value()))&&void 0!==t?t:null,null!==s?(this._formatter=s,this._ignoreMinMoveFormatter=s):(this._formatter=(0,m.createSeriesFormatter)(null!==(i=this.symbolInfo())&&void 0!==i?i:this._formattingDeps,this.properties().childs().minTick.value()),this._ignoreMinMoveFormatter=(0,m.createSeriesFormatter)(this.symbolInfo(),this.properties().childs().minTick.value(),!0)),this.priceScale()&&this.priceScale().updateFormatter(),this._formatterChanged.fire()}_recreatePriceStep(){const{minMove:e,priceScale:t}=(0,m.getSeriesPriceFormattingState)(this.symbolInfo()),i=e/t;this._ignoreMinMovePriceStep=1/t,this._priceStep!==i&&(this._priceStep=i,this._priceStepChanged.fire())}_recreatePriceFormattingDependencies(){this._recreateFormatter(),this._recreatePriceStep()}_onQuotesUpdate(e,t){if(Zt){const e=void 0!==t.values.change||void 0!==t.values.change_percent;e&&this._legendView.update();const i=void 0!==t.values.prev_close_price;i&&((0,s.ensureNotNull)(this._prevClosePriceLineView).update((0,ve.sourceChangeEvent)(this.id())),(0,s.ensureNotNull)(this._prevClosePriceAxisView).update((0,ve.sourceChangeEvent)(this.id()))),(e||i)&&this.model().updateSource(this)}void 0!==e.values.current_session&&e.values.current_session!==this._currentSession&&(this._currentSession=e.values.current_session,this._updateLastPriceAnimationActive())}_updateIsPrePostMarketPricesForbiddenProperty(){const e=(0,m.symbolHasPreOrPostMarket)(this._symbolInfo)&&(this.isDWM()||(0,m.isRegularSessionId)(this.sessionIdProxyProperty().value()));this._isPrePostMarketPricesAvailableProperty.setValue(e)}_updateSettlementAsCloseForbiddenProperty(){}_updateBackAdjustmentForbiddenProperty(){}_removeReplaySubscriber(){throw new Error("Not implemented")}_getSymbolForApi(){return(0,m.symbolForApi)(this.symbolInfo()||this._prevSymbolInfo,this.symbol())}_getSymbolObject(){const e=this._getExtendedSymbolObject();if(v.SYMBOL_STRING_DATA.hasOwnProperty(this.properties().childs().style.value())){
return{symbol:e,type:this.styleStudyInfo(this.getStyleShortName()+"Style").studyId+"!",inputs:this.getInputsProperties().state()}}return e}_getExtendedSymbolObject(){const e={symbol:this._getSymbolForApi()},t=this.properties().childs();null!==this.currency()&&(e["currency-id"]=this.currency());const i=this.unit();return this._model.unitConversionEnabled()&&null!==i&&(e["unit-id"]=i),!this.isDWM()&&ri&&(e.session=t.sessionId.value()),e}_checkChartStyle(){const e=this.style();(0,m.isCloseBasedSymbol)(this.symbolInfo())?(0,m.isSingleValueBasedStyle)(e)||(this.requestingStyleIsNotSupported.fire(),this._styleToRecover={correctedStyle:this.style(),originalStyle:e}):null!==this._styleToRecover&&(this.requestingStyleSupportRecovered.fire(this._styleToRecover.originalStyle),this._styleToRecover=null)}_updateSymbolInfo(e,t){if(this._prevSymbolInfo=t?this._symbolInfo:null,this._symbolInfo=e,e){const t=this._properties.childs();t.shortName.setValue(e.name);const i=(0,m.extractSymbolNameFromSymbolInfo)(e,this.symbol());i&&t.symbol.setValue(i);const s=(0,m.symbolCurrency)(e),r=(0,m.symbolUnit)(e,this._model.unitConversionEnabled());"alwaysOff"===(0,K.currencyUnitVisibilityProperty)().value()||s===t.currencyId.value()&&r===t.unitId.value()||this._model.fullUpdate(),t.currencyId.setValue(s),t.unitId.setValue(r),this._updateSessionIdProxyProperty(!0)}this._base=e?e.pricescale/e.minmov:100,this._pointValue=e&&e.pointvalue||1;const i=this._getSymbolForApi();this._quotesProvider.setQuotesSessionSymbol(i),this._marketStatusModel.setSymbolInfo(e),e&&this._recreatePriceFormattingDependencies(),this._statusView.update(),this.priceScale().updateFormatter(),this._symbolResolvingActive.setValue(!e),ri&&this._updateIsPrePostMarketPricesForbiddenProperty()}_createHighLowAvgViews(){const e=this.properties().childs().highLowAvgPrice,t=this._getHighLowPrice.bind(this),i=function(e,t,i,s){const r=i.childs(),n=$e(e,t,{label:Ge,labelVisible:r.highLowPriceLabelsVisible,lineVisible:r.highLowPriceLinesVisible,lineColor:r.highLowPriceLinesColor,lineWidth:r.highLowPriceLinesWidth},(()=>s(0))),o=$e(e,t,{label:qe,labelVisible:r.highLowPriceLabelsVisible,lineVisible:r.highLowPriceLinesVisible,lineColor:r.highLowPriceLinesColor,lineWidth:r.highLowPriceLinesWidth},(()=>s(1)));return{paneViews:[n.paneView,o.paneView],panePriceAxisViews:[n.panePriceAxisView,o.panePriceAxisView],priceAxisViews:[n.priceAxisView,o.priceAxisView],priceLineAxisViews:[n.priceLineAxisView,o.priceLineAxisView]}}(this._model,this,e,t);this._highLowAvgPaneViews.push(...i.paneViews),this._labelPaneViews.push(...i.panePriceAxisViews),this._priceAxisViews.push(...i.priceAxisViews),this._priceLineAxisViews.push(...i.priceLineAxisViews)}_createAverageViews(){const e=this.properties().childs().highLowAvgPrice,t=this._getAveragePrice.bind(this),i=et(this._model,this,e,t);this._averagePaneViews.push(...i.paneViews),this._labelPaneViews.push(...i.panePriceAxisViews),this._priceAxisViews.push(...i.priceAxisViews),this._priceLineAxisViews.push(...i.priceLineAxisViews)}_getHighLowPrice(e){
if(!this._highLowPriceCache.has(e)){const e=this._model.timeScale().visibleBarsStrictRange();if(null===e)return null;const t=function(e,t,i){return e.minMaxOnRangeCached(t,i,[{name:"low",offset:0},{name:"high",offset:0}])}(this._model.mainSeries().bars(),e.firstBar(),e.lastBar());if(null===t)return null;this._highLowPriceCache.set(1,t.min),this._highLowPriceCache.set(0,t.max)}return this._highLowPriceCache.get(e)}_getAveragePrice(e){if(!this._averagePriceCache.has(e)){const e=this._model.timeScale().visibleBarsStrictRange();if(null===e)return null;const t=function(e,t,i){0;const s=(0,c.barFunction)("close");let r=0,n=0;for(let o=t;o<=i;o++){const t=e.valueAt(o);null!==t&&(r+=s(t),n++)}return n?r/n:null}(this._model.mainSeries().bars(),e.firstBar(),e.lastBar());if(null===t)return null;this._averagePriceCache.set(0,t)}return this._averagePriceCache.get(e)}_onSeriesCompleted(e){var t;this._loading=!1,this._seriesErrorMessage=null;let i=e.updateMode;switch("pulsed"===i&&(i="delayed"),i){case"streaming":this._setStatus(3);break;case"endofday":this._setStatus(6);break;case"delayed":this._setStatus(8);break;case"replay":this._setStatus(11)}i.match(/delayed_streaming/)&&this._setStatus(9),this._lastCompleteFlags=null!==(t=e.flags)&&void 0!==t?t:null;const r=(0,s.ensureNotNull)(this._model.paneForSource(this));r.recalculatePriceScale(this.priceScale(),(0,ve.sourceChangeEvent)(this.id()));const n=dt.InvalidationMask.full();null!==this._model.appliedTimeFrame().value()&&n.lockVisibleTimeRangeOnResize(),this._model.invalidate(n),this.model().recalcVisibleRangeStudies(!0),this.model().recalcStudyBasedLineTools(),!this.priceScale().isLockScale()||this.model().timeScale().isEmpty()||this._seriesLoaded||(this.model().timeScale().correctOffset(),this.model().timeScale().correctBarSpacing(),this.model().resetPriceScale(r,this.priceScale())),this._seriesLoaded=!0,this._enablePriceRangeReady()}_notifyIntervalChanged(e){var t,i;const s={timeframe:null!==(t=this._pendingTimeRange)&&void 0!==t?t:void 0};this._intervalChanged.fire(e,s),this._pendingTimeRange=null!==(i=s.timeframe)&&void 0!==i?i:null}_onCurrencyChanged(){this._currencyChanged.fire()}_onUnitChanged(){this._unitChanged.fire()}_applySymbolParamsChanges(e){this._lastCompleteFlags=null,this.clearGotoDateResult();const t=this.interval();this.currency(),this.unit();Z.Interval.isRange(t)&&this._properties.childs().rangeStyle.childs().inputs.childs().range.setValue(Z.Interval.parse(t).multiplier());const{symbolChanged:i,intervalChanged:s,currencyChanged:r,unitChanged:n,force:o}=e,a=ri&&s&&Z.Interval.parse(t).isDWM()!=Z.Interval.parse(t).isDWM();if(this._syncModel=null,this._prevRequestedInterval=t,5!==this._status&&(!this._seriesSource.isStarted()||i||r||n||a)&&this._updateSymbolInfo(null,!i&&(r||n)),5===this._status)return void this._model.realignLineTools();this._loading=!0,this._setStatus(1),ri&&this._updateIsPrePostMarketPricesForbiddenProperty(),this._symbolIntervalChanged.fire(),s&&this._notifyIntervalChanged(t),this._onRestarted.fire(),this._seriesLoaded=!1,
this._lineStyleLastPriceCirclePaneView.stopAnimation();let l=null;this._pendingTimeRange&&(l=this._pendingTimeRange,this._pendingTimeRange=null),this._onTimeFrameApplied.fire(l),this._onBeforeModifySeries(this.getSymbolString(),t),this._data=null,this._seriesSource.modifySeries(this._getResolvingSymbolObject(),(0,_t.getServerInterval)(t),l,o),this._seriesSource.isStarted()||(this._predictBars=0,this._seriesSource.start()),(i||r||n)&&this.disablePriceRangeReady(),this.updateAllViews((0,ve.sourceChangeEvent)(this.id())),this._model.lightUpdate()}_isIntervalSupported(e){return!0}_onBeforeModifySeries(e,t){0}_getResolvingSymbolObject(){return this._getSymbolObject()}_onSessionIdPropertyChanged(){this._sessionIdChanged.fire(),this.isDWM()||(this.restart(),this._updateLastPriceAnimationActive())}_subscribeRestartToSessionIdChange(){this.properties().childs().sessionId.subscribe(this,this._onSessionIdPropertyChangedBound)}_unsubscribeRestartToSessionIdChange(){this.properties().childs().sessionId.unsubscribe(this,this._onSessionIdPropertyChangedBound)}_updateLastPriceAnimationActive(){if(!this._options.lastPriceAnimationEnabled)return;const e=this._lastPriceAnimationActive,t=this.properties().childs(),i=t.style.value();if(this._model.isSnapshot()||!t.visible.value()||3!==i&&10!==i&&2!==i)this._lastPriceAnimationActive=!1;else{const e=this.currentSession(),t=!(0,m.isRegularSessionId)(this.sessionIdProxyProperty().value())&&!this.isDWM();this._lastPriceAnimationActive="market"===e||t&&("pre_market"===e||"post_market"===e)}this._lastPriceAnimationActive&&e!==this._lastPriceAnimationActive&&this.model().invalidate(dt.InvalidationMask.cursor())}_onPropertiesChanged(e){const t=this._properties.childs();e!==t.symbol&&e!==t.interval&&e!==t.timeframe&&(this._tagsChanged.fire(),this.createPaneView(),this.updateAllViews((0,ve.sourceChangeEvent)(this._id)),this.model().updateSource(this),(0,o.emit)("series_properties_changed",this._id))}_recalcSymbolTextSourceProxyProperty(){this._textSourceIsAlwaysTickerRestrictionEnabled?this._symbolTextSourceProxyProperty.setValue("ticker"):this._symbolTextSourceProxyProperty.setValue(this._properties.childs().statusViewStyle.childs().symbolTextSource.value())}_clearStylePlot(e,t){if(0===e.size())return;if(void 0===t&&e!==this.nsBars())return void(this._precomputedBarStyles=new WeakMap);const i=null!=t?t:(0,s.ensureNotNull)(e.firstIndex()),r=(0,s.ensureNotNull)(e.lastIndex())+1;e.range(i,r).each(((e,t)=>(this._precomputedBarStyles.delete(t),!1)))}}},667342:(e,t,i)=>{"use strict";i.r(t),i.d(t,{STATUS_OFFLINE:()=>s,STATUS_RESOLVING:()=>r,STATUS_LOADING:()=>n,STATUS_READY:()=>o,STATUS_INVALID_SYMBOL:()=>a,STATUS_SNAPSHOT:()=>l,STATUS_EOD:()=>c,STATUS_PULSE:()=>h,STATUS_DELAYED:()=>d,STATUS_DELAYED_STREAMING:()=>u,STATUS_NO_BARS:()=>p,STATUS_REPLAY:()=>_,STATUS_ERROR:()=>m,SERIES_STATUS_TEXT:()=>g,STYLE_LINE_TYPE_MARKERS:()=>f,STYLE_LINE_TYPE_STEP:()=>v,STYLE_LINE_TYPE_SIMPLE:()=>S,STYLE_BARS:()=>y,STYLE_CANDLES:()=>b,STYLE_LINE:()=>w,STYLE_AREA:()=>P,STYLE_RENKO:()=>C,STYLE_KAGI:()=>T,STYLE_PNF:()=>x,
STYLE_PB:()=>I,STYLE_HEIKEN_ASHI:()=>M,STYLE_HOLLOW_CANDLES:()=>L,STYLE_BASELINE:()=>A,STYLE_RANGE:()=>k,STYLE_HILO:()=>E,STYLE_COLUMNS:()=>D,STYLE_SHORT_NAMES:()=>B,SYMBOL_STRING_DATA:()=>V});const s=0,r=1,n=2,o=3,a=4,l=5,c=6,h=7,d=8,u=9,p=10,_=11,m=12,g={[s]:"connecting",[r]:"loading",[n]:"loading",[o]:"realtime",[a]:"invalid",[l]:"snapshot",[c]:"endofday",[h]:"endofday",[d]:"delayed",[u]:"delayed_streaming",[p]:"forbidden",[_]:"replay",[m]:"error"},f=0,v=1,S=2,y=0,b=1,w=2,P=3,C=4,T=5,x=6,I=7,M=8,L=9,A=10,k=11,E=12,D=13,B={0:"bar",1:"candle",9:"hollowCandle",2:"line",3:"area",4:"renko",7:"pb",5:"kagi",6:"pnf",8:"ha",10:"baseline",11:"range",12:"hilo",13:"column"},V={4:{type:"BarSetRenko@tv-prostudies",basicStudyVersion:64},7:{type:"BarSetPriceBreak@tv-prostudies",basicStudyVersion:34},5:{type:"BarSetKagi@tv-prostudies",basicStudyVersion:34},6:{type:"BarSetPnF@tv-prostudies",basicStudyVersion:34},8:{type:"BarSetHeikenAshi@tv-basicstudies",basicStudyVersion:60},11:{type:"BarSetRange@tv-basicstudies",basicStudyVersion:72}}},510656:(e,t,i)=>{"use strict";i.d(t,{seriesPlotFunctionMap:()=>c,barFunction:()=>h,SeriesData:()=>p});var s,r=i(650151),n=i(445588),o=i(624595);!function(e){e[e.FromLeft=-1]="FromLeft",e[e.FromRight=1]="FromRight"}(s||(s={}));const a={open:e=>e[1],high:e=>e[2],low:e=>e[3],close:e=>e[4],hl2:e=>(e[2]+e[3])/2,hlc3:e=>(e[2]+e[3]+e[4])/3,ohlc4:e=>(e[1]+e[2]+e[3]+e[4])/4},l=["open","high","low","close","hl2","hlc3","ohlc4"];function c(){const e=new Map;return l.forEach(((t,i)=>{e.set(t,h(t))})),e}function h(e,t,i){const s=a[null!=t?t:e],r=a[e],n=a[null!=i?i:e];return(e,t)=>{switch(t){case 0:return s(e);case 2:return n(e);default:return r(e)}}}function d(e,t){return null==e[t]}const u=[{barsToMerge:10,forBarspacingLargerThen:.03},{barsToMerge:30,forBarspacingLargerThen:.01},{barsToMerge:100,forBarspacingLargerThen:.003},{barsToMerge:500,forBarspacingLargerThen:0}];class p{constructor(){this._pressedChunks={chunks:new Map,priceSource:"uninitialized"},this.m_bars=new n.PlotList(c(),d),this.m_nsBars=new n.PlotList(c(),d),this._clearPressedChunks()}bars(){return this.m_bars}nsBars(){return this.m_nsBars}pressedChunks(e,t){if(t!==this._pressedChunks.priceSource){this._pressedChunks.priceSource=t;const e=this.m_bars.first();e&&(this._clearPressedChunks(),this._rebuildPressedChunks(e))}const i=(0,r.ensureDefined)(u.find((t=>t.forBarspacingLargerThen<=e)));return(0,r.ensureDefined)(this._pressedChunks.chunks.get(i.barsToMerge))}mergeRegularBars(e){const t=this.m_bars.size(),i=this.m_bars.merge(e);return i&&"uninitialized"!==this._pressedChunks.priceSource&&(t===this.m_bars.size()&&i.index===this.m_bars.lastIndex()?this._updateLatestChunks():this._rebuildPressedChunks(i)),i}size(){return this.m_bars.size()+this.m_nsBars.size()}each(e){this.m_bars.each(e),this.m_nsBars.each(e)}clear(){this.m_bars.clear(),this.m_nsBars.clear(),this.lastProjectionPrice=void 0,this._clearPressedChunks()}isEmpty(){return this.m_bars.isEmpty()&&this.m_nsBars.isEmpty()}first(){
return this.m_bars.isEmpty()?this.m_nsBars.first():this.m_bars.first()}last(){return this.m_nsBars.isEmpty()?this.m_bars.last():this.m_nsBars.last()}search(e,t){return this.nsBars().isEmpty()?this.bars().search(e,t):this.bars().isEmpty()||(0,r.ensureNotNull)(this.nsBars().firstIndex())<=e?this.nsBars().search(e,t):this.bars().search(e,t)}valueAt(e){const t=this.search(e);return null!==t?t.value:null}plotValueToTimePointIndex(e,t,i){if(i===s.FromRight){const i=(i,s)=>{const r=s[t];return null!=r&&e>=r},s=this.m_bars.findLast(i);if(null!==s)return s.index;const r=this.m_nsBars.findLast(i);return null!==r?r.index:this.m_bars.firstIndex()}if(i===s.FromLeft){const i=(i,s)=>{const r=s[t];return null!=r&&e<=r},s=this.m_bars.findFirst(i);if(null!==s)return s.index;const r=this.m_nsBars.findFirst(i);return null!==r?r.index:this.m_bars.lastIndex()}throw new Error("plotValueToTimePointIndex: unsupported search mode")}moveData(e){this.m_bars.move(e),this.m_nsBars.move(e),this.m_bars.size()>0&&this._rebuildPressedChunks((0,r.ensureNotNull)(this.m_bars.first()))}_rebuildPressedChunks(e){const t=this._pressedChunks.priceSource;if("uninitialized"===t)return;const i=e.index,s=a[t],n=(e,t,i)=>{let r=null;for(;e.hasNext();){const n=e.next(),o=s(n.value);r&&n.index-r.startTime>=i.barsToMerge&&(t.push(r),r=null),r?(r.endTime=n.index,r.high=Math.max(r.high,o),r.low=Math.min(r.low,o),r.close=o):r={startTime:n.index,endTime:n.index,open:o,high:o,low:o,close:o}}r&&t.push(r)};u.forEach((e=>{const t=(0,r.ensureDefined)(this._pressedChunks.chunks.get(e.barsToMerge)),s=(0,o.lowerbound)(t,i,((e,t)=>e.endTime<t));if(0===s&&t.length>0){const i=t[0].startTime-1,s=(0,r.ensureNotNull)(this.m_bars.firstIndex()),o=this.m_bars.rangeIterator(s,i),a=[];n(o,a,e);const l=a.concat(t);this._pressedChunks.chunks.set(e.barsToMerge,l)}else{const i=(0,r.ensureNotNull)(this.m_bars.lastIndex());t.splice(s);let o=(0,r.ensureNotNull)(this.m_bars.firstIndex());t.length&&(o=t[t.length-1].endTime+1);const a=this.m_bars.rangeIterator(o,i);n(a,t,e)}}))}_updateLatestChunks(){const e=(0,r.ensureNotNull)(this.m_bars.lastIndex());u.forEach((t=>{const i=(0,r.ensureDefined)(this._pressedChunks.chunks.get(t.barsToMerge)),s=this.m_bars.rangeIterator(e,e).next(),n=s.value[4],o=i[i.length-1];o.high=Math.max(o.high,n),o.low=Math.min(o.low,n),o.close=n,o.endTime=s.index}))}_clearPressedChunks(){u.forEach((e=>this._pressedChunks.chunks.set(e.barsToMerge,[])))}}},299845:(e,t,i)=>{"use strict";i.d(t,{SeriesTimeRangeVolumeCalculator:()=>s});class s{constructor(e){this._value=null,this._series=e,this._series.dataEvents().dataUpdated().subscribe(this,this._onSeriesUpdated)}destroy(){this._series.dataEvents().dataUpdated().unsubscribeAll(this)}volume(e,t){if(null!==this._value&&this._value.from===e&&this._value.to===t)return this._value.value;let i=0;const s=this._series.data().bars(),r=s.firstIndex(),n=s.lastIndex();if(null!==r&&e<r&&t<r||null!==n&&e>n&&t>n)i=NaN;else{const s=this._series.data().bars().rangeIterator(Math.min(e,t),Math.max(e,t));for(;s.hasNext();){const e=s.next().value[5]
;if(void 0===e){i=NaN;break}i+=e}}return this._value={from:e,to:t,value:i},i}_onSeriesUpdated(e,t){if(null===this._value)return;if(t)return void(this._value=null);const i=this._series.data().bars().lastIndex();(null===i||i<=this._value.to)&&(this._value=null)}}},632054:(e,t,i)=>{"use strict";i.r(t),i.d(t,{getTranslatedChartStyleName:()=>w,isRequiringRestartSeriesStyles:()=>P,isRangeBasedStyle:()=>C,isRangeStyle:()=>T,isTimeBasedStyle:()=>x,isValidStyle:()=>I,isSingleValueBasedStyle:()=>M,setLastUsedStyle:()=>L,getLastUsedStyle:()=>A,getLastUsedSingleValueBasedStyle:()=>k,getDefaultStyle:()=>E,getChartStyleByResolution:()=>D,chartStyleStudyId:()=>B,preparePriceAxisProperties:()=>V,hasProjection:()=>N,isPriceSourceStyle:()=>O,getSeriesPriceFormattingState:()=>F,createSeriesFormatter:()=>W,symbolCurrencyConvertible:()=>z,symbolCurrency:()=>H,symbolOriginalCurrency:()=>U,symbolBaseCurrency:()=>j,isConvertedToOtherCurrency:()=>G,symbolUnitConvertible:()=>q,symbolUnit:()=>$,symbolOriginalUnit:()=>Y,isConvertedToOtherUnit:()=>K,symbolUnitConvertibleGroupsIfExist:()=>Z,symbolCurrentContract:()=>X,symbolHasPreOrPostMarket:()=>J,symbolHasSeveralSessions:()=>Q,symbolHasEconomicEvents:()=>ee,extractSymbolNameFromSymbolInfo:()=>te,symbolTitle:()=>ie,displayedSymbolName:()=>se,displayedSymbolExchange:()=>re,actualSymbol:()=>ne,proSymbol:()=>oe,symbolForApi:()=>ae,isRegularSessionId:()=>le,isCloseBasedSymbol:()=>ce,isMeasureUnitSymbol:()=>he,measureUnitId:()=>de,hasVolume:()=>ue,isEconomicSymbol:()=>pe,getStudySymbolExchange:()=>_e,isFutureContinuousSymbolWithBackajustment:()=>me,isFuturesContractSymbol:()=>ge,isCryptoSymbol:()=>fe});var s=i(509806),r=i(870122),n=i(667342),o=i(638273),a=i(821737),l=i(484727),c=i(650151),h=i(609781),d=i(58594);const u=l.enabled("pay_attention_to_ticker_not_symbol"),p=l.enabled("uppercase_instrument_names"),_=l.enabled("charting_library_single_symbol_request"),m=l.enabled("use_ticker_on_symbol_info_update"),g=l.enabled("hide_object_tree_and_price_scale_exchange_label"),f=[4,5,6,7,8],v=[4,5,6,7,11],S=[0,1,9,2,3,10,8,12,13],y=[2,10,3,13],b={0:s.t(null,void 0,i(16812)),1:s.t(null,void 0,i(463528)),2:s.t(null,void 0,i(301277)),3:s.t(null,void 0,i(542097)),9:s.t(null,void 0,i(661582)),10:s.t(null,void 0,i(117712)),12:s.t(null,void 0,i(631994)),13:s.t(null,void 0,i(636018)),4:s.t(null,void 0,i(20801)),7:s.t(null,void 0,i(563492)),5:s.t(null,void 0,i(292901)),6:s.t(null,void 0,i(99969)),11:s.t(null,void 0,i(490357)),8:s.t(null,void 0,i(240530))};function w(e){return b[e]}function P(e){return-1!==f.indexOf(e)}function C(e){return-1!==v.indexOf(e)}function T(e){return 11===e}function x(e){return-1!==S.indexOf(e)}function I(e){return C(e)||x(e)}function M(e){switch(e){case 3:case 10:case 2:case 13:return!0;default:return!1}}function L(e,t){I(e)&&(11!==e&&r.setValue("chart.lastUsedStyle",e),ce(t)&&M(e)&&r.setValue("chart.lastUsedSingleValueBasedStyle",e))}function A(){const e=r.getInt("chart.lastUsedStyle");return void 0===e?1:e}function k(){const e=r.getInt("chart.lastUsedSingleValueBasedStyle")
;return void 0===e?2:e}function E(e){return e?11:1}function D(e,t){const i=T(t),s=o.Interval.isRange(e);return!i&&s?E(!0):i&&!s?E(!1):t}function B(e,t){const i=n.SYMBOL_STRING_DATA[e];return void 0===i?null:t?`${i.type}-${i.basicStudyVersion}`:i.type}function V(e){const t=e.priceAxisProperties,i=t.lockScale.value(),s=6===e.style.value();(s||i)&&(t.log.setValue(!1),t.percentage.setValue(!1)),t.logDisabled.setValue(!(!s&&!i)),t.percentageDisabled.setValue(!(!s&&!i))}const R=[4,7,5,6];function N(e){return-1!==R.indexOf(e)}function O(e){return y.includes(e)}function F(e,t="default",i=!1){let s,r,n=100,o=1;if("default"===t)null!=e&&(n=e.pricescale,o=e.minmov,s=e.fractional,r=e.minmove2);else{let e=t.split(",");3!==e.length&&(e=["100","1","false"]),n=parseInt(e[0]),o=parseInt(e[1]),s="true"===e[2]}return i&&(o=1),{priceScale:n,minMove:o,fractional:s,minMove2:r}}function W(e,t,i=!1){if("default"===t&&null!=e){const t=e.formatter||e.format;if("volume"===t)return new h.VolumeFormatter(2);if("percent"===t)return new d.PercentageFormatter(e.pricescale)}const{priceScale:s,minMove:r,fractional:n,minMove2:o}=F(e,t,i);return new a.PriceFormatter(s,r,n,o)}function z(e){return null!==e&&"spread"!==e.type}function H(e,t,i){if(null===e)return null;const s=!t||i?e.currency_id:e.currency_code;return void 0===s||""===s?null:s}function U(e,t){const i=t?e.original_currency_code:e.original_currency_id;return null!=i?i:H(e,t)}function j(e){return e.base_currency_id||null}function G(e){return!(null===e||!z(e))&&(void 0!==e.original_currency_id&&e.original_currency_id!==e.currency_id)}function q(e,t){return t&&null!==e&&"spread"!==e.type}function $(e,t){if(null===e||!t)return null;const i=e.unit_id;return void 0===i||""===i?null:i}function Y(e,t){return t?e.original_unit_id||$(e,t):null}function K(e,t){return!(null===e||!q(e,t))&&(void 0!==e.original_unit_id&&e.original_unit_id!==e.unit_id)}function Z(e,t){return null!==e&&q(e,t)?e.unit_conversion_types||null:[]}function X(e){return"futures"===e.type&&e.front_contract||null}function J(e){return null!==e&&void 0!==e.subsessions&&e.subsessions.some((e=>"premarket"===e.id||"postmarket"===e.id))}function Q(e){return null!==e&&void 0!==e.subsessions&&e.subsessions.filter((e=>!e.private)).length>1}function ee(e){return null!==e&&("forex"===e.type||"cfd"===e.type||fe(e))}function te(e,t){let i=e&&(e.pro_name||e.full_name||e.name);return _&&t?i=t:m&&e&&e.ticker&&(i=e.ticker),p&&i&&(i=i.toUpperCase()),i}function ie(e,t,i="exchange"){return t||g?e.name:`${e.name}, ${e[i]}`}function se(e){let t=e&&(X(e)||e.name)||"";return t.length>40&&(t=t.substring(0,37)+"..."),t.trim()}function re(e){const t=e?e.exchange:"";return p?t.toUpperCase():t}function ne(e,t){return null!==e?e.full_name:t}function oe(e,t){return null!==e?e.pro_name:t}function ae(e,t){return u&&e?(0,c.ensureDefined)(e.ticker):ne(e,t)}function le(e){return"regular"===e||"us_regular"===e}function ce(e){return"c"===(null==e?void 0:e.visible_plots_set)}function he(e){return null!==e&&("unit"===e.measure&&null!==de(e))}function de(e){var t
;return null!==(t=null==e?void 0:e.value_unit_id)&&void 0!==t?t:null}function ue(e){return void 0!==e.visible_plots_set?"ohlcv"===e.visible_plots_set:!e.has_no_volume}function pe(e){return null!==e&&"economic"===e.type}function _e(e){return pe(e)&&e.source?e.source:e.exchange&&0!==e.exchange.length?e.exchange:void 0}function me(e){var t;return null!==e&&"futures"===e.type&&Boolean(e.has_backadjustment&&(null===(t=e.typespecs)||void 0===t?void 0:t.includes("continuous")))}function ge(e){var t;return null!==e&&"futures"===e.type&&!Boolean(null===(t=e.typespecs)||void 0===t?void 0:t.includes("continuous"))}function fe(e){var t;return(null===(t=e.typespecs)||void 0===t?void 0:t.includes("crypto"))||"crypto"===e.type||"bitcoin"===e.type}},793713:(e,t,i)=>{"use strict";var s=i(976704);TradingView.DEFAULT_BAR_COUNT=300,TradingView.TIME_PLOT=0,TradingView.OPEN_PLOT=1,TradingView.HIGH_PLOT=2,TradingView.LOW_PLOT=3,TradingView.CLOSE_PLOT=4,TradingView.ADT_PLOT=6;var r=i(135055).SeriesBase,n=(i(32133).trackEvent,i(817808).getLogger("Chart.Series")),o=i(667342),a=i(959823).SeriesHorizontalBaseLinePaneView,l=i(606615).deepExtend,c=i(559410),h=i(820402).TIMEFRAMETYPE,d=i(632054).isSingleValueBasedStyle;class u extends r{constructor(e,t,i,s){t.removeProperty("currencyId"),super(e,t,i,s),this._chartApi=e._chartApi,this.createPaneView(),this._properties.addExclusion&&(this._properties.addExclusion("visible"),this._properties.addExclusion("currencyId")),this._futureBarsPaneView=null,this.properties().minTick.listeners().subscribe(this,u.prototype._recreateFormatter);var r=this;this.properties().minTick.listeners().subscribe(null,(function(){r._model.fullUpdate()})),this._priceLineView=null,this._baseHorizontalLineView=new a(this),this.bindStyleChange(),this.bindJapChartsInputs(),this._createIsDWMProperty(),this.properties().showCountdown.listeners().subscribe(this,u.prototype._onChangeShowCountdown),this._onChangeShowCountdown(this.properties().showCountdown),this._recreatePriceFormattingDependencies(),this.properties().lineStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this.properties().areaStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this.properties().baselineStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this.properties().columnStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this._updateBarFunction()}isLoading(){return this._loading}styleStudyInfo(e){return this.styleStudyInfos()[e]}serverTimeOffset(){return this._chartApi.serverTimeOffset()}_onChangeShowCountdown(e){var t=this;e.value()?this._countdownUpdateTimer=this._model.setInterval((function(){t._priceAxisView.updateCountdown()}),500):(this._model.clearInterval(this._countdownUpdateTimer),delete this._countdownUpdateTimer)}_createIsDWMProperty(){this._isDWMProperty=new s(this.isDWM()),this._onRestarted.subscribe(this,(function(){this._isDWMProperty.setValue(this.isDWM())}))}isDWMProperty(){return this._isDWMProperty}fixLastBar(e){0}isPulse(){
return this._symbolInfo&&this._symbolInfo.resolutions.length>0}seriesSource(){return this._seriesSource}_onSeriesTimeFrame(e,t,i,s,r){var n=d(this.style())?e+.5:e,o=t;if(void 0===r)null!==i&&i.type!==h.PeriodBack||(o+=this._model.studyAwareDefaultRightOffset());else if(r.applyDefaultRightMargin)o+=this._model.studyAwareDefaultRightOffset();else if(r.percentRightMargin){var a=t-n+1,l=Math.max(0,Math.min(.99,r.percentRightMargin/100));o+=l*a/(1-l)}this._model.setTimeViewport(n,o)}hl2(e){return(this.high(e)+this.low(e))/2}hlc3(e){return(this.high(e)+this.low(e)+this.close(e))/3}ohlc4(e){return(this.open(e)+this.high(e)+this.low(e)+this.close(e))/4}nearestData(e,t){if(TradingView.isInteger(e)){var i=this.data().search(e,t);return null!==i?i:void 0}n.logDebug("Series.nearestData: incorrect logicalPoint")}nearestIndex(e,t){var i=this.nearestData(e,t);return i?i.index:void 0}purgeSymbolInfo(){this._symbolInfo=null}bindStyleChange(){var e=this;Object.keys(u.STYLE_SHORT_NAMES).map((function(e){return u.STYLE_SHORT_NAMES[e]+"Style"})).forEach((function(t){e._properties[t].listeners().subscribe(e,u.prototype.invalidateBarStylesCache)}))}bindJapChartsInputs(){this._properties.renkoStyle.inputs.boxSize.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.style.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.atrLength.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.wicks.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.sources.listeners().subscribe(this,this.onInputChanged),this._properties.pbStyle.inputs.lb.listeners().subscribe(this,this.onInputChanged),this._properties.kagiStyle.inputs.reversalAmount.listeners().subscribe(this,this.onInputChanged),this._properties.kagiStyle.inputs.style.listeners().subscribe(this,this.onInputChanged),this._properties.kagiStyle.inputs.atrLength.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.boxSize.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.reversalAmount.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.sources.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.style.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.atrLength.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.oneStepBackBuilding.listeners().subscribe(this,this.onInputChanged),this._properties.rangeStyle.inputs.phantomBars.listeners().subscribe(this,this.onInputChanged)}createDividendsAdjustmentProperty(){throw new Error("Not implemented")}dividendsAdjustmentProperty(){return null}applyPreferences(e){var t=l({},e);this.m_priceScale.setMode({autoScale:t.priceAxisProperties.autoScale,percentage:t.priceAxisProperties.percentage,log:t.priceAxisProperties.log,lockScale:t.priceAxisProperties.lockScale}),this.setChartStyleWithIntervalIfNeeded(t.style),delete t.style,delete t.interval,
this._properties.mergePreferences(t),this._properties.saveDefaults(),this.createPaneView(),this.invalidateBarStylesCache()}onInputChanged(){this.restart()}getStyleShortName(){var e=this._properties.style.value();if(u.STYLE_SHORT_NAMES.hasOwnProperty(e))return u.STYLE_SHORT_NAMES[e];throw new Error("Missed short name for style "+e)}getStyleProperties(){return this._properties[this.getStyleShortName()+"Style"]}getInputsProperties(){return this.getStyleProperties().inputs||new s}getInputsInfoProperties(){return this.getStyleProperties().inputInfo||new s}getSymbolName(){return this._symbolInfo?this._symbolInfo.name:""}priceScale(){return this.m_priceScale}setPriceScale(e){this.m_priceScale!==e&&(this._priceScaleAboutToBeChanged.fire(),this.m_priceScale=e,this._properties.removeProperty("priceAxisProperties"),this._properties.addChild("priceAxisProperties",e.properties()),this._properties.priceAxisProperties.childChanged(),c.emit("series_event","price_scale_changed"),this._priceScaleChanged.fire(e))}getSourceIcon(){return{type:"loadSvg",svgId:"series."+this.properties().style.value()}}isStyleSupported(e){return!0}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._quotesProvider.destroy(),this.clearGotoDateResult(),this._legendView.destroy(),this._marketStatusModel.destroy(),null!==this._dataUpdatedModeModel&&this._dataUpdatedModeModel.destroy(),this._dataProblemModel.destroy(),this._paneView&&this._paneView.destroy&&this._paneView.destroy(),this._seriesSource.destroy(),super.destroy()}dataEvents(){return this._seriesSource.dataEvents()}moveData(e){return this._seriesSource.moveData(e)}}Object.assign(u,o),TradingView.Series=u,t.Series=u,t.isSeries=function(e){return e instanceof u}},155957:(e,t,i)=>{"use strict";i.d(t,{SeriesAreaPaneView:()=>l});var s=i(602564),r=i(329776),n=i(385824),o=i(815553),a=i(229184);class l extends a.SeriesSingleLinePaneView{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const i=this._source.priceScale();if(!i)return null;const a=this._source.properties().childs().areaStyle.childs(),l=a.transparency.value(),c={simpleMode:!1,barSpacing:this._model.timeScale().barSpacing(),items:this._items,lineColor:a.linecolor.value(),lineStyle:a.linestyle.value(),lineWidth:a.linewidth.value(),isSeries:!0,withMarkers:!1,bottom:i.height(),color1:(0,s.generateColor)(a.color1.value(),l),color2:(0,s.generateColor)(a.color2.value(),l)},h=new n.CompositeRenderer;return h.append(new r.PaneRendererArea(c)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&h.append(new o.SelectionRenderer(this._selectionData)),h}}},170238:(e,t,i)=>{"use strict";function s(e,t){return 100*(t-e)/Math.abs(e||1)}i.d(t,{barPercentChange:()=>s})},611593:(e,t,i)=>{"use strict";i.d(t,{PaneRendererBars:()=>n});var s=i(918922),r=i(42152);class n extends r.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barSpacing=e.barSpacing,this._dontDrawOpen=e.dontDrawOpen,this._thinBars=e.thinBars}draw(e,t){e.save();const i=t.pixelRatio
;if(this._barWidth=this._calcBarWidth(i),this._barWidth>=2){Math.max(1,Math.floor(i))%2!=this._barWidth%2&&this._barWidth--}this._barLineWidth=this._thinBars?Math.min(this._barWidth,Math.floor(i)):this._barWidth;let s=null;const r=this._barLineWidth<=this._barWidth&&this._barSpacing>=Math.floor(1.5*t.pixelRatio);for(const t of this._bars){s!==t.color&&(e.fillStyle=t.color,s=t.color);const n=Math.floor(.5*this._barLineWidth),o=Math.round(t.time*i),a=o-n,l=this._barLineWidth,c=a+l-1,h=Math.min(t.high,t.low),d=Math.max(t.high,t.low),u=Math.round(h*i)-n,p=Math.round(d*i)+n,_=Math.max(p-u,this._barLineWidth);e.fillRect(a,u,l,_);const m=Math.ceil(1.5*this._barWidth);if(r){const s=o-m,r=o+m,h=Math.min(a-s,r-c);if(!this._dontDrawOpen){let r=Math.max(u,Math.round(t.open*i)-n),o=r+l-1;o>u+_-1&&(o=u+_-1,r=o-l+1),e.fillRect(s,r,h,o-r+1)}let d=Math.max(u,Math.round(t.close*i)-n),p=d+l-1;p>u+_-1&&(p=u+_-1,d=p-l+1),e.fillRect(c+1,d,h,p-d+1)}}e.restore()}_getTolerance(){const e=this._calcBarWidth(1),t=this._thinBars?Math.min(e,1):e;return(0,s.interactionTolerance)().series+t/2}_getBarSpacing(){return this._barSpacing}_calcBarWidth(e){const t=Math.floor(e);return Math.max(t,Math.floor((0,s.optimalBarWidth)(this._barSpacing,e)))}}},575960:(e,t,i)=>{"use strict";i.d(t,{SeriesBarsPaneView:()=>a});var s=i(385824),r=i(815553),n=i(569623),o=i(611593);class a extends n.SeriesBarCandlesPaneView{renderer(e,t){this._invalidated&&(this._updateImpl(null),this._invalidated=!1);const i=this._source.properties().childs(),n={bars:this._bars,barSpacing:this._model.timeScale().barSpacing(),dontDrawOpen:i.barStyle.childs().dontDrawOpen.value(),thinBars:11===i.style.value()?i.rangeStyle.childs().thinBars.value():i.barStyle.childs().thinBars.value()},a=new s.CompositeRenderer;return a.append(new o.PaneRendererBars(n)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&a.append(new r.SelectionRenderer(this._selectionData)),a}_createItem(e,t,i){const s={time:e,open:NaN,high:NaN,low:NaN,close:NaN,color:i.barColor};return(0,n.baseBarCandlesUpdater)(t,s)?s:null}}},279822:(e,t,i)=>{"use strict";i.d(t,{SeriesBaselinePaneView:()=>m});var s=i(602564),r=i(385824),n=i(86441),o=i(5531),a=i(204652),l=i(918922),c=i(624595),h=i(716384),d=i(777277);class u extends h.MediaCoordinatesPaneRenderer{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}hitTest(e){if(null===this._data)return null;const{items:t,topLineWidth:i,bottomLineWidth:s}=this._data,r=(0,l.interactionTolerance)().series+(i+s)/4,o=(0,c.lowerbound)(t,e,((e,t)=>e.x<=t.x)),h=Math.max(1,o-1),u=Math.min(t.length-1,o+1);for(let i=h;i<=u;++i){const s=t[i-1],o=t[i],{distance:l}=(0,a.distanceToSegment)(new n.Point(s.x,s.y),new n.Point(o.x,o.y),new n.Point(e.x,e.y));if(l<=r)return new d.HitTestResult(d.HitTestResult.REGULAR)}return null}_drawImpl(e){if(null===this._data)return
;const{items:t,baseLevelCoordinate:i,bottom:s,bottomFillColor1:r,bottomFillColor2:a,topFillColor1:c,topFillColor2:h,topLineColor:d,bottomLineColor:u,topLineWidth:p,bottomLineWidth:_}=this._data;if(!function(e){if(0===e.length)return!1;const t=e.findIndex((e=>(0,l.coordinateIsValid)(e.y)));if(-1===t)return!1;let i=e.length-1;for(;i>t&&!(0,l.coordinateIsValid)(e[i].y);)i--;return!(t>i)}(t))return;const m=e.context,{topItems:g,bottomItems:f}=function(e,t){const i=[],s=[];let r=null;for(let a=0;a<e.length;a++){let c=e[a];const h=e[a+1]||{};if((0,l.coordinateIsValid)(c.y))c.y<=t&&i.push(c),c.y>=t&&s.push(c),r=c;else{if(null===r)continue;c=r}if((0,l.coordinateIsValid)(h.y)&&(c.y>t&&h.y<t||c.y<t&&h.y>t))if(Math.abs(c.x-h.x)<1){const e=new n.Point(c.x,t);i.push(e),s.push(e)}else{const e=(0,o.intersectLineSegments)(c,h,new n.Point(c.x,t),new n.Point(h.x,t));if(null!==e){const t=c.add(h.subtract(c).scaled(e));i.push(t),s.push(t)}}}return{topItems:i,bottomItems:s}}(t,i);m.lineCap="round",m.lineJoin="round",0!==g.length&&(m.beginPath(),m.moveTo(g[0].x,i),this._makeLine(m,g,!0,0),m.closePath(),m.fillStyle=this._makeLinearGradient(m,c,h,i-s,i),m.fill(),m.beginPath(),this._makeLine(m,g,!1,0),m.lineWidth=p,m.strokeStyle=d,m.stroke()),0!==f.length&&(m.beginPath(),m.moveTo(f[0].x,i),this._makeLine(m,f,!0,1),m.closePath(),m.fillStyle=this._makeLinearGradient(m,r,a,i,i+s),m.fill(),m.beginPath(),this._makeLine(m,f,!1,1),m.lineWidth=_,m.strokeStyle=u,m.stroke())}_makeLine(e,t,i,s){if(null===this._data)return;const r=t.findIndex((e=>(0,l.coordinateIsValid)(e.y)));if(-1===r)return;const{barSpacing:n,baseLevelCoordinate:o}=this._data,a=.25*n;let c;const h=t.length;for(let n=r;n<h;n++){const h=t[n],d=t[n+1]||{};if((0,l.coordinateIsValid)(h.y)){if(0===s){if(c&&c.y>=o&&h.y>=o){e.moveTo(h.x,h.y);continue}}else if(c&&c.y<=o&&h.y<=o){e.moveTo(h.x,h.y);continue}if(c&&(0,l.coordinateIsValid)(c.y))e.lineTo(h.x,h.y),i&&!(0,l.coordinateIsValid)(d.y)&&e.lineTo(h.x,o);else if(d&&(0,l.coordinateIsValid)(d.y))i?(n!==r&&e.lineTo(h.x,o),e.lineTo(h.x,h.y)):e.moveTo(h.x,h.y);else if(i){if(0===n)continue;n!==r&&e.lineTo(h.x-a,o),e.lineTo(h.x-a,h.y),e.lineTo(h.x+a,h.y),e.lineTo(h.x+a,o)}else e.moveTo(h.x-a,h.y),e.lineTo(h.x+a,h.y);c=h}}}_makeLinearGradient(e,t,i,s,r){const n=e.createLinearGradient(0,s,0,r);return n.addColorStop(0,t),n.addColorStop(1,i),n}}var p=i(815553),_=i(229184);class m extends _.SeriesSingleLinePaneView{constructor(){super(...arguments),this._renderer=new u,this._topFillColor1="",this._topFillColor2="",this._bottomFillColor1="",this._bottomFillColor2="",this._topLineColor="",this._bottomLineColor="",this._topLineWidth=0,this._bottomLineWidth=0,this._barSpacing=0,this._bottom=0,this._baseLevelCoordinate=0}renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer.setData({items:this._items,topFillColor1:this._topFillColor1,topFillColor2:this._topFillColor2,bottomFillColor1:this._bottomFillColor1,bottomFillColor2:this._bottomFillColor2,topLineColor:this._topLineColor,bottomLineColor:this._bottomLineColor,
topLineWidth:this._topLineWidth,bottomLineWidth:this._bottomLineWidth,barSpacing:this._barSpacing,baseLevelCoordinate:this._baseLevelCoordinate,bottom:this._bottom});const i=new r.CompositeRenderer;return i.append(this._renderer),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&i.append(new p.SelectionRenderer(this._selectionData)),i}_updateImpl(){super._updateImpl();const e=this._source.priceScale();if(!e)return;const t=this._source.properties().childs().baselineStyle.childs(),i=t.transparency.value();this._topFillColor1=(0,s.generateColor)(t.topFillColor1.value(),i),this._topFillColor2=(0,s.generateColor)(t.topFillColor2.value(),i),this._bottomFillColor1=(0,s.generateColor)(t.bottomFillColor1.value(),i),this._bottomFillColor2=(0,s.generateColor)(t.bottomFillColor2.value(),i),this._topLineColor=t.topLineColor.value(),this._bottomLineColor=t.bottomLineColor.value(),this._topLineWidth=t.topLineWidth.value(),this._bottomLineWidth=t.bottomLineWidth.value(),this._barSpacing=this._model.timeScale().barSpacing(),this._bottom=e.height(),this._baseLevelCoordinate=Math.round(this._bottom*(Math.abs(100-t.baseLevelPercentage.value())/100))}}},404356:(e,t,i)=>{"use strict";i.d(t,{SeriesWaterlinePaneView:()=>a});var s=i(953854),r=i(411404),n=i(777277),o=i(284269);class a extends s.HorizontalLinePaneView{constructor(e){super(),this._getters=e;const t={cursorType:r.PaneCursorType.VerticalResize,activeItem:0,areaName:n.AreaName.SourceItemMove};this._lineRenderer.setHitTest(new n.HitTestResult(n.HitTestResult.MOVEPOINT,t)),this._lineRendererData.visible=!0,this._lineRendererData.linestyle=o.LINESTYLE_SPARSE_DOTTED}_updateImpl(){const{baseLevelPercentage:e,paneHeight:t,color:i}=this._getters,s=Math.abs(100-e());this._lineRendererData.y=Math.round(t()*(s/100)),this._lineRendererData.color=i()}}},42152:(e,t,i)=>{"use strict";i.d(t,{PaneRendererSeriesBase:()=>r});var s=i(777277);class r{constructor(){this._bars=[]}hitTest(e){const t=this._bars,i=this._getBarSpacing(),s=i/2;if(0===t.length)return null;const r=this._getTolerance(),n=t[0],o=t[t.length-1];if(e.x<n.time-s-r)return null;if(e.x>o.time+s+r)return null;let a=0,l=t.length-1,c=-1;for(;a<=l;){const i=Math.floor((a+l)/2),h=t[i];let d=s;if(h!==n&&h!==o||(d+=r),Math.abs(h.time-e.x)<=d){c=i;break}e.x-h.time>s?a=i+1:l=i-1}if(-1!==c){const n=Math.ceil(r/i);if(0!==n){const i=Math.max(0,c-n),o=Math.min(t.length-1,c+n);for(let n=i;n<=o;n++)if(Math.abs(e.x-t[n].time)<=s+r&&this._isPointAtBar(t[n],e.y,r))return this._getHitTest()}else if(this._isPointAtBar(t[c],e.y,r))return this._getHitTest()}return null}_getHitTest(){return new s.HitTestResult(s.HitTestResult.REGULAR)}_isPointAtBar(e,t,i){const s=Math.min(e.high,e.low),r=Math.max(e.high,e.low);return s-i<=t&&t<=r+i}}},71133:(e,t,i)=>{"use strict";i.d(t,{PaneRendererCandles:()=>l});var s=i(650151),r=i(777277),n=i(664114),o=i(918922),a=i(42152);class l extends a.PaneRendererSeriesBase{constructor(e){super(),this._barSpacing=1,this._barWidth=1,this._borderVisible=!1,this._barBorderWidth=1,
this._wickVisible=!1,this._bodyVisible=!0,this._borderColor=void 0,this._wickColor=void 0,this._hittest=void 0,this._isPriceScaleInverted=!1,e&&this.setData(e)}setData(e){this._bars=e.bars,this._barSpacing=e.barSpacing,this._borderVisible=e.borderVisible,this._bodyVisible=e.bodyVisible,this._wickVisible=e.wickVisible,this._borderColor=e.borderColor,this._wickColor=e.wickColor,this._hittest=e.hittest,this._isPriceScaleInverted=e.isPriceScaleInverted}hitTest(e){return this._wickVisible||this._borderVisible||this._bodyVisible?super.hitTest(e):null}draw(e,t){if(0===this._bars.length)return;const i=t.pixelRatio;if(this._barWidth=(0,o.optimalCandlestickWidth)(this._barSpacing,i),this._barWidth>=2){Math.floor(i)%2!=this._barWidth%2&&this._barWidth--}this._wickVisible&&this._drawWicks(e,i),this._borderVisible&&this._drawBorder(e,i),this._bodyVisible&&this._drawCandles(e,i)}_getTolerance(){return(0,o.interactionTolerance)().series+this._barBorderWidth/2}_getBarSpacing(){return this._barSpacing}_getHitTest(){return this._hittest||new r.HitTestResult(r.HitTestResult.REGULAR)}_isPointAtBar(e,t,i){const s=this._bodyVisible||this._borderVisible,r=this._wickVisible;if(!s&&!r)return!1;if(s){const s=r?Math.min(e.high,e.low):Math.min(e.open,e.close),n=r?Math.max(e.high,e.low):Math.max(e.open,e.close);return s-i<=t&&t<=n+i}{const s=Math.min(e.open,e.close),r=Math.max(e.open,e.close);return e.high-i<=t&&t<=s+i||r-i<=t&&t<=e.low+i}}_drawWicks(e,t){const i=this._bars;let r="",n=Math.min(Math.floor(t),Math.floor(this._barSpacing*t));n=Math.max(Math.floor(t),Math.min(n,this._barWidth));const o=Math.floor(.5*n);let a=null;for(const l of i){const i=l.wickColor?l.wickColor:(0,s.ensureDefined)(this._wickColor);i!==r&&(e.fillStyle=i,r=i);let c=Math.round(Math.min(l.open,l.close)*t),h=Math.round(Math.max(l.open,l.close)*t);this._isPriceScaleInverted&&([h,c]=[c,h]);const d=Math.round(l.high*t),u=Math.round(l.low*t);let p=Math.round(t*l.time)-o;const _=p+n-1;null!==a&&(p=Math.max(a+1,p),p=Math.min(p,_));const m=_-p+1;e.fillRect(p,d,m,c-d),e.fillRect(p,h+1,m,u-h-1),a=_}}_calculateBorderWidth(e){let t=Math.floor(1*e);this._barWidth<=2*t&&(t=Math.floor(.5*(this._barWidth-1)));const i=Math.max(Math.floor(e),t);return this._barWidth<=2*i?Math.max(Math.floor(e),Math.floor(1*e)):i}_drawBorder(e,t){let i="";const r=this._calculateBorderWidth(t);let o=null;for(const a of this._bars){if(a.borderColor!==i&&(e.fillStyle=a.borderColor?a.borderColor:(0,s.ensureDefined)(this._borderColor),i=a.borderColor),this._bodyVisible&&a.hollow)continue;let l=Math.round(a.time*t)-Math.floor(.5*this._barWidth);const c=l+this._barWidth-1,h=Math.round(Math.min(a.open,a.close)*t),d=Math.round(Math.max(a.open,a.close)*t);if(null!==o&&(l=Math.max(o+1,l),l=Math.min(l,c)),this._barSpacing*t>2*r)(0,n.fillRectInnerBorder)(e,l,h,c-l+1,d-h+1,r);else{const t=c-l+1;e.fillRect(l,h,t,d-h+1)}o=c}}_drawCandles(e,t){let i="";const s=this._calculateBorderWidth(t);for(const r of this._bars){if(this._borderVisible&&this._barWidth<=2*s&&!r.hollow)continue
;let o=Math.round(Math.min(r.open,r.close)*t),a=Math.round(Math.max(r.open,r.close)*t),l=Math.round(r.time*t)-Math.floor(.5*this._barWidth),c=l+this._barWidth-1;if(r.color!==i){const t=r.color;e.fillStyle=t,i=t}if(r.hollow)e.fillStyle=r.color,(0,n.fillRectInnerBorder)(e,l,o,c-l+1,a-o+1,s);else{if(this._borderVisible&&(l+=s,o+=s,c-=s,a-=s),o>a)continue;e.fillRect(l,o,c-l+1,a-o+1)}}}}},170554:(e,t,i)=>{"use strict";i.d(t,{SeriesCandlesPaneView:()=>l});var s=i(385824),r=i(918922),n=i(815553),o=i(569623),a=i(71133);class l extends o.SeriesBarCandlesPaneView{renderer(e,t){this._invalidated&&(this._updateImpl(null),this._invalidated=!1);const i=this._source.priceScale();if(!i)return null;const o=this._source.properties().childs().candleStyle.childs(),l=this._model.timeScale().barSpacing(),c={bars:this._bars,barSpacing:l,bodyVisible:o.drawBody.value(),borderVisible:o.drawBorder.value(),borderColor:o.borderColor.value(),wickColor:o.wickColor.value(),barWidth:(0,r.optimalBarWidth)(l),wickVisible:o.drawWick.value(),isPriceScaleInverted:i.isInverted()},h=new s.CompositeRenderer;return h.append(new a.PaneRendererCandles(c)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&h.append(new n.SelectionRenderer(this._selectionData)),h}_createItem(e,t,i){const s={time:e,open:NaN,high:NaN,low:NaN,close:NaN,color:i.barColor,borderColor:i.barBorderColor,wickColor:i.barWickColor,hollow:i.isBarHollow};return(0,o.baseBarCandlesUpdater)(t,s)?s:null}}},386434:(e,t,i)=>{"use strict";i.d(t,{SeriesColumnsPaneView:()=>p});var s=i(650151),r=i(86441),n=i(484727),o=i(203308),a=i(777277),l=i(385824),c=i(153026),h=i(773423),d=i(815553),u=i(933465);class p{constructor(e,t){this._items=[],this._invalidated=!0,this._isMarkersEnabled=(0,n.enabled)("source_selection_markers"),this._selectionData=null,this._histogramBase=0,this._source=e,this._model=t,this._selectionIndexer=new h.SelectionIndexes(t.timeScale())}update(){this._invalidated=!0}renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const i={barSpacing:this._model.timeScale().barSpacing(),items:this._items,lineColor:"",histogramBase:this._histogramBase},s=new l.CompositeRenderer;return s.append(new u.PaneRendererColumns(i)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&s.append(new d.SelectionRenderer(this._selectionData)),s}_updateImpl(){this._items=[];const e=this._model.timeScale(),t=this._source.priceScale();if(e.isEmpty()||!t||t.isEmpty())return;const i=e.visibleBarsStrictRange();if(null===i)return;if(0===this._source.bars().size())return;const n=this._source.nearestIndex(i.firstBar(),c.PlotRowSearchMode.NearestRight),l=this._source.nearestIndex(i.lastBar(),c.PlotRowSearchMode.NearestLeft);if(void 0===n||void 0===l)return;const h=this._source.bars().range(n,l),d=this._source.barColorer(),u={},p=this._source.barFunction(),_=h.reduce(((e,t,s)=>{const n=p(s);if(!(0,o.default)(n))return e;u.value=s;let a=this._source.precomputedBarStyle(s);void 0===a&&(a=d.barStyle(t,!1,u),
this._source.setPrecomputedBarStyle(s,a));const l=new r.Point(t,n);return l.style=a,l.timePointIndex=t,this._items.push(l),u.previousValue=s,i.contains(t)&&null!=e?e:n}),null);if(null!==_)if(t.pointsArrayToCoordinates(this._items,_),e.timedValuesToCoordinates(this._items),this._histogramBase=t.isInverted()?0:t.height(),this._model.selection().isSelected(this._source)){const i=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,barSpacing:e.barSpacing(),hittestResult:a.HitTestResult.REGULAR};const n=(0,s.ensureNotNull)(this._model.paneForSource(this._source)).height();this._selectionData.hittestResult=a.HitTestResult.REGULAR;for(let s=0;s<i.length;s++){const o=i[s],a=this._source.bars().valueAt(o);if(null===a)continue;const l=p(a),c=e.indexToCoordinate(o),h=t.priceToCoordinate(l,_);this._selectionData.points.push(new r.Point(c,h)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(h/n))}}else this._selectionIndexer.clear()}}},740517:(e,t,i)=>{"use strict";i.d(t,{SeriesHiLoPaneView:()=>g});var s=i(448874),r=i(779292),n=i(624595),o=i(918922),a=i(777277),l=i(716384);class c extends l.MediaCoordinatesPaneRenderer{constructor(){super(...arguments),this._data=null,this._barWidth=null}setData(e){this._data=e,this._barWidth=Math.max(1,Math.round((0,o.optimalHiLoWidth)(e.barSpacing)))}hitTest(e){if(null===this._data||null===this._barWidth)return null;const t=this._data.bars,i=.5*this._data.barSpacing;if(0===t.length)return null;if(e.x<t[0].time-i)return null;if(e.x>t[t.length-1].time+i)return null;const s=t[(0,n.lowerbound)(t,e.x-i,((e,t)=>e.time<t))];if(e.x<s.time-i||e.x>s.time+i)return null;const r=(0,o.interactionTolerance)().series+this._barWidth/2,l=Math.min(s.high,s.low),c=Math.max(s.high,s.low),h=this._data.fontSize;return l-r-h<=e.y&&e.y<=l+r||c-r<=e.y&&e.y<=c+r+h?new a.HitTestResult(a.HitTestResult.REGULAR):null}_drawImpl(e){if(null===this._data||null===this._barWidth)return;const{font:t,fontSize:i,labelColor:s,bars:n,inverted:o,labelsPadding:a}=this._data,l=e.context;l.textAlign="center",l.fillStyle=s,l.font=(0,r.makeFont)(i,t);for(let e=0;e<n.length;++e){const t=n[e],i=Math.round(Math.min(t.high,t.low)),s=Math.round(Math.max(t.high,t.low)),r=Math.round(t.time);l.textBaseline="alphabetic",l.fillText(o?t.lowLabel:t.highLabel,r,i-a),l.textBaseline="top",l.fillText(o?t.highLabel:t.lowLabel,r,s+a)}}}var h=i(385824),d=i(815553),u=i(574570),p=i(289763),_=i(71133),m=i(569623);class g extends m.SeriesBarCandlesPaneView{constructor(e,t){super(e,t),this._labelsRenderer=new c,this._candlesRenderer=new _.PaneRendererCandles,this._maxLengthLabel="",this._calculateFontSize=(0,s.default)(((e,t)=>Math.max(1,(0,n.lowerboundExt)((e=>e+1),null,(i=>{const s=(0,r.makeFont)(i,u.CHART_FONT_FAMILY);return(0,p.measureText)(e,s).width<=t}),7,36))),((e,t)=>`${e}/${t}`))}renderer(e,t,i){const s=this._source.priceScale();if(!s||s.isEmpty())return null
;const r=new h.CompositeRenderer,n=this._needLabels(),a=this._source.properties().childs().hiloStyle.childs(),l=this._model.timeScale().barSpacing();if(this._invalidated){const e=this._source.formatter();this._maxLengthLabel="",this._updateImpl({generateLabels:n,formatter:e}),this._invalidated=!1}if(this._candlesRenderer.setData({bars:this._bars,wickVisible:!1,bodyVisible:a.drawBody.value(),barSpacing:l,borderVisible:a.showBorders.value(),barWidth:(0,o.optimalHiLoWidth)(l)}),r.append(this._candlesRenderer),n){const e=this._calculateLabelFontSize();e&&e>=8&&(this._labelsRenderer.setData({bars:this._bars,barSpacing:l,font:u.CHART_FONT_FAMILY,fontSize:e,labelColor:a.labelColor.value(),inverted:s.isInverted(),labelsPadding:.4*e}),r.append(this._labelsRenderer))}return this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&r.append(new d.SelectionRenderer(this._selectionData)),r}topPixelMargin(){return this._margin()}bottomPixelMargin(){return this._margin()}_createItem(e,t,i,s){const r={time:e,open:NaN,high:NaN,low:NaN,close:NaN,color:i.barColor,borderColor:i.barBorderColor,hollow:!1,highLabel:"",lowLabel:""};if(!(0,m.baseBarCandlesUpdater)(t,r))return null;if(r.open=r.high,r.close=r.low,s.generateLabels){const e=s.formatter.format(r.high),t=s.formatter.format(r.low);r.highLabel=e,r.lowLabel=t;const i=(e.length>t.length?e:t).replace(/\d/g,"0");i.length>this._maxLengthLabel.length&&(this._maxLengthLabel=i)}return r}_margin(){if(this._needLabels()){const e=this._calculateLabelFontSize();if(e&&e>=8)return 1.4*e}return 0}_calculateLabelFontSize(){return""===this._maxLengthLabel?null:this._calculateFontSize(this._maxLengthLabel,Math.floor(this._model.timeScale().barSpacing())-2)}_needLabels(){const e=this._source.properties().childs().hiloStyle.childs().showLabels.value(),t=this._model.timeScale().barSpacing();return e&&t>5}}},659020:(e,t,i)=>{"use strict";i.d(t,{SeriesHollowCandlesPaneView:()=>l});var s=i(385824),r=i(918922),n=i(815553),o=i(71133),a=i(170554);class l extends a.SeriesCandlesPaneView{renderer(e,t){this._invalidated&&(this._updateImpl(null),this._invalidated=!1);const i=this._source.priceScale();if(!i)return null;const a=this._source.properties().childs().hollowCandleStyle.childs(),l=this._model.timeScale().barSpacing(),c={bars:this._bars,barSpacing:l,bodyVisible:a.drawBody.value(),borderVisible:a.drawBorder.value(),borderColor:a.borderColor.value(),wickColor:a.wickColor.value(),barWidth:(0,r.optimalBarWidth)(l),wickVisible:a.drawWick.value(),isPriceScaleInverted:i.isInverted()},h=new s.CompositeRenderer;return h.append(new o.PaneRendererCandles(c)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&h.append(new n.SelectionRenderer(this._selectionData)),h}}},363425:(e,t,i)=>{"use strict";i.d(t,{SeriesLinePaneView:()=>h});var s=i(777277),r=i(385824),n=i(507967),o=i(270349),a=i(815553),l=i(667342),c=i(229184);class h extends c.SeriesSingleLinePaneView{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1)
;const i=this._source.properties().childs().lineStyle.childs(),c={barSpacing:this._model.timeScale().barSpacing(),items:this._items,lineColor:i.color.value(),lineStyle:i.linestyle.value(),withMarkers:i.styleType.value()===l.STYLE_LINE_TYPE_MARKERS,lineWidth:i.linewidth.value(),simpleMode:!0,hitTestResult:s.HitTestResult.REGULAR};let h,d;if(h=i.styleType.value()===l.STYLE_LINE_TYPE_STEP?new o.PaneRendererStepLine(c):new n.PaneRendererLine(c),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData){const e=new r.CompositeRenderer;e.append(h),e.append(new a.SelectionRenderer(this._selectionData)),d=e}else d=h;return d}}},569623:(e,t,i)=>{"use strict";i.d(t,{baseBarCandlesUpdater:()=>c,SeriesBarCandlesPaneView:()=>h});var s=i(86441),r=i(484727),n=i(773423),o=i(153026),a=i(777277);function l(e){return null!=e}function c(e,t){const i=e[1],s=e[2],r=e[3],n=e[4];return!!(l(i)&&l(s)&&l(r)&&l(n))&&(t.open=i,t.high=s,t.low=r,t.close=n,!0)}class h{constructor(e,t){this._bars=[],this._invalidated=!0,this._isMarkersEnabled=(0,r.enabled)("source_selection_markers"),this._selectionData=null,this._source=e,this._model=t,this._selectionIndexer=new n.SelectionIndexes(t.timeScale())}items(){return this._bars}update(){this._invalidated=!0}_updateImpl(e){const t=this._model.timeScale(),i=this._source.priceScale();if(this._bars=[],t.isEmpty()||!i||i.isEmpty())return;const r=t.visibleBarsStrictRange();if(null===r)return;if(0===this._source.bars().size())return;let n=this._source.nearestIndex(r.firstBar(),o.PlotRowSearchMode.NearestRight);const l=this._source.nearestIndex(r.lastBar(),o.PlotRowSearchMode.NearestLeft);if(void 0===n||void 0===l)return;for(;n<=l;n++){if(null!==this._source.bars().valueAt(n))break}if(n>l)return;const c=this._source.bars().range(n,l),h=this._source.barColorer(),d={};if(c.each(((t,i)=>{d.value=i;let s=this._source.precomputedBarStyle(i);void 0===s&&(s=h.barStyle(t,!1,d),this._source.setPrecomputedBarStyle(i,s));const r=this._createItem(Math.round(t),i,s,e);return!!r&&(d.previousValue=i,this._bars.push(r),!1)})),0===this._bars.length)return;const u=this._source.firstValue();if(null!==u)if(i.barPricesToCoordinates(this._bars,u),t.barIndexesToCoordinates(this._bars),this._model.selection().isSelected(this._source)){const e=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,hittestResult:a.HitTestResult.REGULAR,barSpacing:t.barSpacing()};const r=this._model.paneForSource(this._source);if(!r)return;const n=r.height();for(let r=0;r<e.length;r++){const o=e[r],a=this._source.bars().valueAt(o);if(null===a)continue;const l=a[1],c=a[4];if(null==l||null==c)continue;const h=.5*(l+c),d=t.indexToCoordinate(o),p=i.priceToCoordinate(h,u);this._selectionData.points.push(new s.Point(d,p)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(p/n))}}else this._selectionIndexer.clear()}}},243387:(e,t,i)=>{"use strict";i.d(t,{SeriesDataSource:()=>y})
;var s=i(650151),r=i(486028),n=i(881881),o=i(638273),a=i(510656),l=i(900827),c=i(994528),h=i(922157),d=i.n(h);class u{constructor(){this._created=new(d()),this._modified=new(d()),this._loading=new(d()),this._completed=new(d()),this._error=new(d()),this._symbolError=new(d()),this._symbolResolved=new(d()),this._seriesError=new(d()),this._symbolNotPermitted=new(d()),this._symbolInvalid=new(d()),this._symbolGroupNotPermitted=new(d()),this._chartTypeNotPermitted=new(d()),this._intradaySpreadNotPermitted=new(d()),this._intradayExchangeNotPermitted=new(d()),this._customIntervalNotPermitted=new(d()),this._secondsIntervalNotPermitted=new(d()),this._tickMarksRangeChanged=new(d()),this._barReceived=new(d()),this._seriesTimeFrame=new(d()),this._dataUpdated=new(d())}destroy(){this._created.destroy(),this._modified.destroy(),this._loading.destroy(),this._completed.destroy(),this._error.destroy(),this._symbolError.destroy(),this._symbolResolved.destroy(),this._seriesError.destroy(),this._symbolInvalid.destroy(),this._symbolNotPermitted.destroy(),this._symbolGroupNotPermitted.destroy(),this._chartTypeNotPermitted.destroy(),this._intradaySpreadNotPermitted.destroy(),this._intradayExchangeNotPermitted.destroy(),this._customIntervalNotPermitted.destroy(),this._secondsIntervalNotPermitted.destroy(),this._tickMarksRangeChanged.destroy(),this._barReceived.destroy(),this._seriesTimeFrame.destroy(),this._dataUpdated.destroy()}created(){return this._created}modified(){return this._modified}loading(){return this._loading}completed(){return this._completed}error(){return this._error}symbolError(){return this._symbolError}symbolResolved(){return this._symbolResolved}seriesError(){return this._seriesError}symbolInvalid(){return this._symbolInvalid}symbolNotPermitted(){return this._symbolNotPermitted}symbolGroupNotPermitted(){return this._symbolGroupNotPermitted}chartTypeNotPermitted(){return this._chartTypeNotPermitted}intradaySpreadNotPermitted(){return this._intradaySpreadNotPermitted}intradayExchangeNotPermitted(){return this._intradayExchangeNotPermitted}customIntervalNotPermitted(){return this._customIntervalNotPermitted}secondsIntervalNotPermitted(){return this._secondsIntervalNotPermitted}tickMarksRangeChanged(){return this._tickMarksRangeChanged}barReceived(){return this._barReceived}seriesTimeFrame(){return this._seriesTimeFrame}dataUpdated(){return this._dataUpdated}fireCompleted(e){this._completed.fire(e)}fireCreated(e){this._created.fire(e)}fireModified(){this._modified.fire()}fireLoading(e){this._loading.fire(e)}fireError(){this._error.fire()}fireSymbolError(e){this._symbolError.fire(e),this.fireError()}fireSymbolResolved(e){this._symbolResolved.fire(e)}fireSeriesError(e){this._seriesError.fire(e),this.fireError()}fireSymbolInvalid(){this._symbolInvalid.fire()}fireSymbolNotPermitted(e){this._symbolNotPermitted.fire(e)}fireSymbolGroupNotPermitted(e){this._symbolGroupNotPermitted.fire(e)}fireChartTypeNotPermitted(e){this._chartTypeNotPermitted.fire(e),this.fireError()}fireIntradaySpreadNotPermitted(){
this._intradaySpreadNotPermitted.fire(),this.fireError()}fireIntradayExchangeNotPermitted(){this._intradayExchangeNotPermitted.fire(),this.fireError()}fireCustomIntervalNotPermitted(e){this._customIntervalNotPermitted.fire(e),this.fireError()}fireSecondsIntervalNotPermitted(){this._secondsIntervalNotPermitted.fire(),this.fireError()}fireTickMarksRangeChanged(e){this._tickMarksRangeChanged.fire(e)}fireBarReceived(e){this._barReceived.fire(e)}fireSeriesTimeFrame(e,t,i,s,r){this._seriesTimeFrame.fire(e,t,i,s,r)}fireDataUpdated(e,t,i){this._dataUpdated.fire(e,t,i)}}var p=i(817808),_=i(632054);const m=(0,p.getLogger)("Chart.SeriesDataSource");var g;!function(e){e[e.Idle=0]="Idle",e[e.AwaitingConnection=1]="AwaitingConnection",e[e.AwaitingFirstDataUpdate=2]="AwaitingFirstDataUpdate",e[e.Active=3]="Active"}(g||(g={}));let f=1;let v=1;function S(e){return e.startDate?e.endDate||e.count?e.endDate?["from_to",e.startDate,e.endDate]:["bar_count",e.startDate,(0,s.ensure)(e.count)]:["from_to",e.startDate]:e.count||300}class y{constructor(e,t,i,s){this._symbol=null,this._resolvedSymbolName=null,this._createSeriesOverriddenParams=0,this._instanceId=null,this._symbolInstanceId=null,this._resolution=null,this._timeFrame=null,this._data=new a.SeriesData,this._dataEvents=new u,this._status=g.Idle,this._turnaroundCounter=1,this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=e,this._turnaroundPrefix=t,this._createSeriesParams=S(null!=i?i:{count:300}),this._timeFrame=s||null,this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged)}modifySeries(e,t,i=null,n=!1){n&&(m.logNormal("Due to force flag clearing symbol & resolution to force re-requesting data."),this._symbol=null,this._resolution=null);const a=this._symbol,l=this._resolution;if(this._symbol=e,this._resolution=t,null===this._instanceId)return void(this._timeFrame=i);const c=!(0,r.deepEquals)(a,e)[0]||null!==this._resolvedSymbolName&&this._resolvedSymbolName!==this._getSymbolNameString(e),h=null===l||!o.Interval.isEqual(l,t);(c||h||null!==i)&&(this._timeFrame=null,(c||h)&&this._turnaroundCounter++,c&&this._resolveSymbol(),this._gateway.modifySeries(this._instanceId,this.turnaround(),(0,s.ensureNotNull)(this._symbolInstanceId),this._resolution,i,this._onMessage.bind(this)),this._dataEvents.fireModified())}requestMoreData(e){null!==this._instanceId&&this._gateway.requestMoreData(this._instanceId,e,this._onMessage.bind(this))}requestMoreTickmarks(e){null!==this._instanceId&&this._gateway.requestMoreTickmarks(this._instanceId,e,this._onMessage.bind(this))}isStarted(){return this._status!==g.Idle}isActive(){return this._status===g.Active}resolution(){return this._resolution}start(){this.isStarted()?m.logNormal("start: data source is already started, nothing to do"):((0,s.assert)(null!==this._symbol,"symbol must be set before start"),(0,
s.assert)(null!==this._resolution,"resolution must be set before start"),this._gateway.isConnected().value()?this._createSeries():this._changeStatusTo(g.AwaitingConnection))}stop(){this.isStarted()?(null!==this._instanceId&&(this._gateway.removeSeries(this._instanceId),this._instanceId=null),this._changeStatusTo(g.Idle)):m.logNormal("stop: data source is already stopped, nothing to do")}instanceId(){return this._instanceId}data(){return this._data}clearData(){this.isStarted()?this._enqueueUpdate((()=>this._clearDataImpl())):this._clearDataImpl()}dataEvents(){return this._dataEvents}turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}symbolInstanceId(){return this._symbolInstanceId}symbol(){return this._symbol}moveData(e){this._enqueueUpdate((()=>this._data.moveData(e)))}setInitialRequestOptions(e){this._createSeriesOverriddenParams=S(e)}_resolveSymbol(){null!==this._symbol&&(this._symbolInstanceId=this._gateway.resolveSymbol("sds_sym_"+f++,(0,n.encodeExtendedSymbolOrGetSimpleSymbolString)(this._symbol),this._onMessage.bind(this)))}_clearDataImpl(){this._data.clear()}_changeStatusTo(e){(0,s.assert)(this._status!==e,"Source and destination status should be distinct"),m.logNormal(`Status changed from ${g[this._status]} to ${g[e]}`),this._status=e}_createSeries(){(0,s.assert)(this._status!==g.Active,'Status should not be "Active" when creating a study'),this._instanceId="sds_"+v++,this._resolveSymbol();const e=this._createSeriesOverriddenParams||this._createSeriesParams;this._createSeriesOverriddenParams&&(this._createSeriesOverriddenParams=0),this._gateway.createSeries(this._instanceId,this.turnaround(),(0,s.ensureNotNull)(this._symbolInstanceId),(0,s.ensureNotNull)(this._resolution),e,this._timeFrame,this._onMessage.bind(this)),this._timeFrame=null,this._changeStatusTo(g.AwaitingFirstDataUpdate),this._dataEvents.fireCreated(this._instanceId)}_onGatewayIsConnectedChanged(e){e?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===g.AwaitingConnection&&this._createSeries()}_onGatewayDisconnected(){this._status!==g.Idle&&this._status!==g.AwaitingConnection&&(this._instanceId=null,this._changeStatusTo(g.AwaitingConnection)),this._turnaroundCounter=1}_onMessage(e){this._enqueueUpdate((()=>this._onMessageImpl(e)))}async _onMessageImpl(e){switch(e.method){case"symbol_resolved":{const[t,i]=e.params;if(t!==this._symbolInstanceId){m.logNormal(`Resolve for old symbol, expected: ${this._symbolInstanceId}, actual ${e.params[0]}`);break}this._onSymbolResolved(i);break}case"symbol_error":if(e.params[0]!==this._symbolInstanceId){m.logNormal(`Symbol error for old symbol, expected: ${this._symbolInstanceId}, actual ${e.params[0]}`);break}this._onSymbolError(e);break;case"series_timeframe":{const[t,i,s,r,n,o,a]=e.params;if(!this._checkTurnaround(t,i)){m.logNormal(`Time frame for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t} (${i})`);break}this._onSeriesTimeFrame(s,r,n,o,a);break}case"series_error":{const[t,i]=e.params
;if(!this._checkTurnaround(t,i)){m.logNormal(`Series error for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t} (${i})`);break}this._onSeriesError(e.params[2]);break}case"series_loading":{const[t,i]=e.params;if(!this._checkTurnaround(t,i))break;this._onSeriesLoading(e.time);break}case"series_completed":{const[t,i,s,r]=e.params;if(!this._checkTurnaround(t,s)){m.logNormal(`Series completed for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t} (${s})`);break}this._onSeriesCompleted(i,e.time,r);break}case"data_update":if(!this._checkTurnaround(e.params.customId,e.params.turnaround)){m.logNormal(`Data update for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e.params.customId} (${e.params.turnaround})`);break}await this._onDataUpdate(e.params.plots,e.params.nonseries,e.params.lastBar);break;case"clear_data":if(e.params.turnaround!==this.turnaround()){m.logNormal(`Clear data for old data, expected: ${this.turnaround()}, actual ${e.params.turnaround}`);break}this._clearDataImpl(),this._dataEvents.fireDataUpdated(void 0,!1,null)}}_onSeriesError(e){let t,i;if("string"==typeof e)i={error:e},t=e;else if(i=e,e.ctx){const i={};Object.entries(e.ctx).forEach((([e,t])=>{i[e]=t.toString()})),t=e.error.format(i)}else t=e.error;if(t.startsWith("study_not_auth:")){const e=t.split(":",2)[1].split("@",2)[0];if(["BarSetRenko","BarSetPriceBreak","BarSetKagi","BarSetPnF"].includes(e))this._dataEvents.fireChartTypeNotPermitted(e);else if("BarSetSpread"===e)this._dataEvents.fireIntradaySpreadNotPermitted();else if("BarSetRange"===e){const e=`${(0,s.ensureNotNull)(this._symbol).inputs.range}R`;this._dataEvents.fireCustomIntervalNotPermitted(e)}}else"resolution_not_entitled"===t?this._dataEvents.fireIntradayExchangeNotPermitted():"custom_resolution"===t?this._dataEvents.fireCustomIntervalNotPermitted((0,s.ensureNotNull)(this._resolution)):"seconds_not_entitled"===t&&this._dataEvents.fireSecondsIntervalNotPermitted();this._dataEvents.fireSeriesError(i)}_onSeriesTimeFrame(e,t,i,s,r){this._dataEvents.fireSeriesTimeFrame(e,t,i,null==s||s,r)}_onSymbolError(e){if(e.params[1]===c.permissionDenied)switch(e.params[2]){case c.SymbolErrorPermissionDeniedReason.Symbol:this._dataEvents.fireSymbolNotPermitted(e.params[3]);break;case c.SymbolErrorPermissionDeniedReason.GroupPermission:this._dataEvents.fireSymbolGroupNotPermitted(e.params[3]);break;default:this._dataEvents.fireSymbolNotPermitted(e.params[2])}else e.params[1]===c.invalidSymbol&&this._dataEvents.fireSymbolInvalid();this._dataEvents.fireSymbolError(e.params[1])}_onSymbolResolved(e){this._resolvedSymbolName=(0,_.symbolForApi)(e,this._getSymbolNameString((0,s.ensureNotNull)(this._symbol))),this._dataEvents.fireSymbolResolved(e)}_getSymbolNameString(e){return"string"==typeof e.symbol?e.symbol:e.symbol.symbol}async _onDataUpdate(e,t,i){this._onDataUnpacked(e,i,await async function(e){if(void 0===e)return{projectionPlots:[],boxSize:null};if(""===e.d||"nochange"===e.indexes)return null;const t=await(0,
l.unpackNonSeriesData)(e.d);if(null===t||t.indexes_replace)return null;const i=e.indexes,{bars:s,price:r,boxSize:n,reversalAmount:o}=t.data,a=(s||[]).map((e=>{let t;return"factor"in e?t=e.factor:"additionalPrice"in e&&(t=e.additionalPrice),{index:i[e.time],value:[0,e.open,e.high,e.low,e.close,e.volume,t]}}));return{lastPrice:r,projectionPlots:a,reversalAmount:o,boxSize:n}}(t))}_enqueueUpdate(e){return this._ongoingDataUpdate=this._ongoingDataUpdate.then(e,e),this._ongoingDataUpdate}_onDataUnpacked(e,t,i){if(this._status===g.Idle)return;this._status===g.AwaitingFirstDataUpdate&&(this._changeStatusTo(g.Active),this._clearDataImpl());const s=this._data.bars().size(),r=this._data.bars().firstIndex(),n=this._data.mergeRegularBars(e);null!==i&&(this._data.nsBars().clear(),this._data.nsBars().merge(i.projectionPlots),this._data.lastProjectionPrice=i.lastPrice,null!==i.boxSize&&(this._data.boxSize=i.boxSize),this._data.reversalAmount=i.reversalAmount);const o=null===r||null!==n&&n.index<r;this._dataEvents.fireDataUpdated(t,o,n),s!==this._data.bars().size()&&null!==n&&this._dataEvents.fireBarReceived(n)}_onSeriesLoading(e){this._dataEvents.fireLoading(e)}_onSeriesCompleted(e,t,i){this._dataEvents.fireCompleted({updateMode:e,time:t,flags:i})}_checkTurnaround(e,t){return this._instanceId===e&&(void 0===t||t===this.turnaround())}}},665265:(e,t,i)=>{"use strict";i.d(t,{SeriesDataWindowView:()=>_});var s=i(150335),r=i(43657),n=i(54031),o=i(601227),a=i(358076),l=i(632054),c=i(484727),h=i(595398),d=i(232468);const u=o.CheckMobile.any(),p=c.enabled("hide_resolution_in_legend");class _ extends r.DataWindowView{constructor(e,t){super(),this._invalidated=!0,this._series=e,this._model=t,this._valuesProvider=this._createValuesProvider(e,t),this._items=this._valuesProvider.getItems().map((e=>new r.DataWindowItem(e.id,e.title,"",e.unimportant))),this.update()}update(){this._invalidated=!0}items(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items}series(){return this._series}_updateImpl(){var e,t;const i=this._series.symbolInfo();if(i){const e=[i.name];p||e.push((0,n.translatedIntervalString)(this._series.interval())),(0,l.isEconomicSymbol)(i)&&i.source?e.push(i.source):e.push((0,o.onWidget)()||"forex"===i.type?i.exchange:i.listed_exchange),this._header=e.join(", "),this._title=i.description}else this._header=this._series.symbol();let r=this._model.crossHairSource().appliedIndex();c.enabled("use_last_visible_bar_value_in_legend")&&!(0,s.isNumber)(r)&&(r=null!==(t=null===(e=this._model.timeScale().visibleBarsStrictRange())||void 0===e?void 0:e.lastBar())&&void 0!==t?t:NaN);const a=this._valuesProvider.getValues(r);for(let e=0;e<a.length;++e){const t=a[e],i=this._items[e];i.setValue(t.value),i.setVisible(t.visible),i.setColor(t.color)}}_createValuesProvider(e,t){return new h.SeriesValuesProvider(e,t)}_showLastPriceAndChangeOnly(){return u&&(null===this._model.crossHairSource().pane||(0,d.isLineToolName)(a.tool.value())||null!==this._model.lineBeingEdited())}}},959823:(e,t,i)=>{"use strict";i.d(t,{
SeriesHorizontalBaseLinePaneView:()=>r});var s=i(470313);class r extends s.SeriesHorizontalLinePaneView{constructor(e){super(e)}_updateImpl(){this._lineRendererData.visible=!1;const e=this._series.priceScale().mode();if(!e.percentage&&!e.indexedTo100)return;const t=this._series.firstValue();null!==t&&(this._lineRendererData.visible=!0,this._lineRendererData.y=this._series.priceScale().priceToCoordinate(t,t),this._lineRendererData.color=this._series.properties().childs().baseLineColor.value())}}},470313:(e,t,i)=>{"use strict";i.d(t,{SeriesHorizontalLinePaneView:()=>r});var s=i(953854);class r extends s.HorizontalLinePaneView{constructor(e){super(),this._series=e,this._model=e.model()}}},229184:(e,t,i)=>{"use strict";i.d(t,{SeriesSingleLinePaneView:()=>d});var s=i(203308),r=i(86441),n=i(650151),o=i(484727),a=i(773423),l=i(153026),c=i(777277),h=i(624595);class d{constructor(e,t){this._items=[],this._invalidated=!0,this._isMarkersEnabled=(0,o.enabled)("source_selection_markers"),this._selectionData=null,this._source=e,this._model=t,this._selectionIndexer=new a.SelectionIndexes(t.timeScale())}update(){this._invalidated=!0}_updateImpl(){var e,t;this._items=[];const i=this._model.timeScale(),o=this._source.priceScale();if(i.isEmpty()||!o||o.isEmpty())return;const a=i.visibleBarsStrictRange();if(null===a)return;if(0===this._source.bars().size())return;const d=null!==(e=this._source.nearestIndex(a.firstBar()-1,l.PlotRowSearchMode.NearestLeft))&&void 0!==e?e:a.firstBar()-1,u=null!==(t=this._source.nearestIndex(a.lastBar()+1,l.PlotRowSearchMode.NearestRight))&&void 0!==t?t:a.lastBar()+1,p=this._source.barFunction();let _=null;const m=this._model.timeScale().barSpacing();if(m<.1&&this._source.supportsPressedChunks()){_=this._source.firstValue();const e=this._source.pressedChunks(m,(0,n.ensureNotNull)(this._source.priceSource())),t=(0,h.lowerbound)(e,d,((e,t)=>e.startTime<t)),i=Math.min(e.length-1,(0,h.lowerbound)(e,u,((e,t)=>e.endTime<t)));for(let s=t;s<=i;s++){const t=e[s];[t.open,t.high,t.low,t.close].forEach((e=>{const i=new r.Point(t.startTime,e);this._items.push(i)}))}}else{_=this._source.bars().range(d,u).reduce(((e,t,i)=>{const n=p(i);if(!(0,s.default)(n))return e;const o=new r.Point(t,n);return this._items.push(o),a.contains(t)?null!=e?e:n:e}),null)}if(null!==_)if(o.pointsArrayToCoordinates(this._items,_),i.timedValuesToCoordinates(this._items),this._model.selection().isSelected(this._source)){const e=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,barSpacing:i.barSpacing(),hittestResult:c.HitTestResult.REGULAR};const t=(0,n.ensureNotNull)(this._model.paneForSource(this._source)).height();this._selectionData.hittestResult=c.HitTestResult.REGULAR;for(let s=0;s<e.length;s++){const n=e[s],a=this._source.bars().valueAt(n);if(null===a)continue;const l=p(a),c=i.indexToCoordinate(n),h=o.priceToCoordinate(l,_);this._selectionData.points.push(new r.Point(c,h)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(h/t))}
}else this._selectionIndexer.clear();else this._items=[]}}},595398:(e,t,i)=>{"use strict";i.d(t,{calculateColor:()=>T,SeriesValuesProvider:()=>x});var s=i(650151),r=i(150335),n=i(724377),o=i(509806),a=i(601227),l=i(484727),c=i(602564),h=i(561626),d=i(153026),u=i(358076),p=i(58594),_=i(609781),m=i(254303),g=i(170238),f=i(161999),v=i(315264),S=i(58216);const y=a.CheckMobile.any(),b=y&&!1,w=new p.PercentageFormatter,P=new _.VolumeFormatter(2),C=`${S.notAvailable} (${S.notAvailable}%)`;function T(e,t){const i=(0,n.parseRgb)(t),s=(0,n.parseRgb)(e);return(0,n.distanceRgb)(i,s)<70?(0,n.rgbToHexString)((0,n.invertRgb)(i)):t}class x{constructor(e,t){this._series=e,this._model=t,this._emptyValues=[{title:o.t(null,void 0,i(539280)),visible:!1,value:"",index:0,id:""},{title:o.t(null,void 0,i(330777)),visible:!1,value:"",index:1,id:""},{title:o.t(null,void 0,i(608136)),visible:!1,value:"",index:2,id:""},{title:o.t(null,void 0,i(931691)),visible:!1,value:"",index:3,id:""},{title:"",visible:!1,value:"",index:4,id:""},{title:"",visible:!1,value:"",index:5,id:""},{title:o.t(null,void 0,i(349329)),visible:!1,value:"",index:6,id:""},{title:o.t(null,{context:"study"},i(32819)),visible:!1,value:"",index:7,id:""}]}getItems(){return this._emptyValues}getValues(e){var t;const i=this._showLastPriceAndChangeOnly(),n=this._emptyValues.map((e=>({...e,visible:!i})));n[0].value=S.notAvailable,n[1].value=S.notAvailable,n[2].value=S.notAvailable,n[3].value=S.notAvailable,n[6].value=C,n[7].value=S.notAvailable,n[5].visible=!1;const o=n[4];if(o.value=S.notAvailable,o.visible=!1,this._model.timeScale().isEmpty()||0===this._series.bars().size()||this._series.priceScale().isEmpty())return n;(0,r.isNumber)(e)||(e=(0,s.ensureNotNull)(this._series.data().last()).index);const a=this._series.nearestIndex(e,d.PlotRowSearchMode.NearestLeft);if(void 0===a)return n;const l=this._series.data().valueAt(a),u=this._model.backgroundTopColor().value();if(null===l)return n;const p=l[1],_=l[2],g=l[3],v=l[4],{values:y}=this._changesData(v,a,i),x=(0,f.getPriceValueFormatterForSource)(this._series);if((0,f.shouldBeFormattedAsPercent)(this._series)||(0,f.shouldBeFormattedAsIndexedTo100)(this._series))n[6].value="";else if(void 0!==y){const e=this._series.formatter();n[6].value=(0,h.forceLTRStr)(`${e.format(y.change,!0)} (${w.format(y.percentChange,!0)})`)}if(i)n[5].value=null==v?S.notAvailable:x(v),n[5].visible=!0,n[6].visible=!0;else{n[0].value=null==p?S.notAvailable:x(p),n[1].value=null==_?S.notAvailable:x(_),n[2].value=null==g?S.notAvailable:x(g),n[3].value=null==v?S.notAvailable:x(v),n[4].value=x(this._series.barFunction()(l));const e=l[5];(0,r.isNumber)(e)?n[7].value=P.format(e):n[7].visible=!1}let I=null;if(i&&!b)I=void 0===y||y.change>=0?m.SeriesBarColorer.upColor(this._series.properties()):m.SeriesBarColorer.downColor(this._series.properties());else{const e=this._series.barColorer().barStyle(a,!1);I=T(u,null!==(t=e.barBorderColor)&&void 0!==t?t:e.barColor)}I=(0,c.resetTransparency)(T(u,I));for(const e of n)e.color=I;return n}_showLastPriceAndChangeOnly(){
return l.enabled("show_last_price_and_change_only_in_series_legend")||y&&(null===this._model.crossHairSource().pane||(0,v.isLineToolName)(u.tool.value())||null!==this._model.lineBeingEdited())}_changesData(e,t,i){var s;if(i&&!b){const e=this._series.quotes();if(null!==e)return{values:{change:null!==e.change?e.change:0,percentChange:null!==e.change_percent?e.change_percent:0}}}else{const i=this._series.data().search(t-1,d.PlotRowSearchMode.NearestLeft),r=null!==(s=null==i?void 0:i.value[4])&&void 0!==s?s:null;if(null!==r&&null!=e)return{values:{change:e-r,percentChange:(0,g.barPercentChange)(r,e)}}}return{}}}},548193:(e,t,i)=>{"use strict";i.d(t,{sessionsPreferencesDefault:()=>r});var s=i(676507);const r={graphics:{backgrounds:{outOfSession:{color:s.colorsPalette["color-tv-blue-500"],transparency:92,visible:!1},preMarket:{color:"#FF9800",transparency:92,visible:!1},postMarket:{color:s.colorsPalette["color-tv-blue-500"],transparency:92,visible:!1}},vertlines:{sessBreaks:{color:"#4985e7",style:2,visible:!1,width:1}}}}},606978:(e,t,i)=>{"use strict";i.d(t,{StatusProviderBase:()=>s});class s{constructor(e){this._colorProperty=e}size(){return"13px"}bold(){return!1}color(){return this._colorProperty.value()}}},160047:(e,t,i)=>{"use strict";i.d(t,{StatusView:()=>s});class s{constructor(e){this._text="",this._color="",this._size="13px",this._bold=!1,this._statusProvider=e}text(){return this._text}getSplitTitle(){return[this._text]}color(){return this._statusProvider.color()}bold(){return this._bold}size(){return this._size}}},974991:(e,t,i)=>{"use strict";var s;i.d(t,{StoriesTimeLineItemType:()=>s}),function(e){e[e.Image=0]="Image",e[e.Emoji=1]="Emoji"}(s||(s={}))},801093:(e,t,i)=>{"use strict";i.d(t,{seriesPrice:()=>n,positionVisualDirection:()=>a,positionToCoordinate:()=>l,noDataBasePosition:()=>c,seriesBasePosition:()=>h,getNoDataPosition:()=>d,getSeriesPosition:()=>u});var s=i(650151),r=i(153026);function n(e,t,i){const s=e.barFunction();switch(e.style()){case 3:case 10:case 2:return s(t.value);default:return t.value[-1===i?3:2]}}function o(e){return e>=0?1:-1}function a(e,t){return-1===o(e)!==t?-1:1}function l(e,t,i,s){const r=Math.min(t,Math.max(0,1===s?i:t-i));return i-s*Math.abs(r*e/100)}function c(e,t,i){const s=e.index();return null===s?null:{index:s,price:t.coordinateToPrice(t.height()/2,i)}}function h(e,t){const i=e.data().bars(),s=i.first(),a=i.last();if(null===s||null===a)return null;let l;const c=t.index();if(null===c){if(void 0===t.time)return null;const e=t.time(),n=s.value[0],o=a.value[0];if(e<n-86400||e>o)return null;l=i.searchByTime(e,r.PlotRowSearchMode.NearestRight,4)}else l=i.search(c);return null===l?null:{index:l.index,price:n(e,l,o(t.position()))}}function d(e,t,i){const s=c(e,t,i);if(null===s)return null;const r=a(e.position(),t.isInverted());return{index:s.index,price:s.price,poleStartY:t.height(),visualDirection:1,positionPointDirection:r,startsOnSeriesData:!1}}function u(e,t,i=!0){const r=h(e,t),n=e.priceScale(),o=(0,s.ensureNotNull)(e.firstValue());if(null===r)return d(t,n,o);let l=0
;const c=e.properties().childs(),u=e.model().timeScale(),p=n.priceToCoordinate(r.price,o);if(i)switch(e.style()){case 3:l=c.areaStyle.childs().linewidth.value()/2;break;case 2:l=c.lineStyle.childs().linewidth.value()/2;break;case 10:const e=Math.abs(100-c.baselineStyle.childs().baseLevelPercentage.value());l=n.height()*e/100>p?c.baselineStyle.childs().topLineWidth.value()/2:c.baselineStyle.childs().bottomLineWidth.value()/2;break;case 1:case 9:case 8:case 12:case 4:case 7:l=3;break;case 0:l=c.barStyle.childs().thinBars.value()?3:Math.max(3,.25*u.barSpacing());break;case 11:l=c.rangeStyle.childs().thinBars.value()?3:Math.max(3,.25*u.barSpacing());break;case 5:l=Math.max(4,.25*u.barSpacing());break;case 6:l=Math.max(5,.25*u.barSpacing())}const _=a(t.position(),n.isInverted()),m=p-_*l;return{index:r.index,price:r.price,poleStartY:m,visualDirection:_,positionPointDirection:_,startsOnSeriesData:!0}}},560052:(e,t,i)=>{"use strict";i.d(t,{materializeBackground:()=>o,dematerializeBackground:()=>a,isBackgroundInBarsRange:()=>l});var s=i(650151),r=i(724912),n=i(900827);function o(e,t){if(e.start>=t.length||e.stop>=t.length)return null;const i=t[e.start],n=t[e.stop];return n===r.INVALID_TIME_POINT_INDEX?null:((0,s.assert)(i===r.INVALID_TIME_POINT_INDEX||i<=n,"start should not exceed stop"),{start:i===r.INVALID_TIME_POINT_INDEX?null:i,stop:n})}function a(e,t,i){return{id:t,start:(0,n.ensureTimePointIndexIndex)(i.indexOf(null!==e.start?e.start:r.INVALID_TIME_POINT_INDEX)),stop:(0,n.ensureTimePointIndexIndex)(i.indexOf(e.stop))}}function l(e,t){if(null===e.start)return t.firstBar()<=e.stop;const i=Math.min(e.start,e.stop),s=Math.max(e.start,e.stop);return t.contains(i)||t.contains(s)||i<t.firstBar()&&s>t.lastBar()}},135834:(e,t,i)=>{"use strict";i.d(t,{LiveStudyGraphics:()=>o.LiveStudyGraphics,createGraphicsPaneViews:()=>p,createGraphicsPriceAxisViews:()=>m,emptyStudyGraphics:()=>n.emptyStudyGraphics,isStudyGraphicsEmpty:()=>r.isStudyGraphicsEmpty,loadStudyGraphics:()=>n.loadStudyGraphics,saveStudyGraphics:()=>n.saveStudyGraphics});var s=i(817808),r=i(782017),n=i(740498),o=i(71023),a=i(672428),l=i(602564);class c extends a.PriceAxisView{constructor(e,t){super(),this._source=e,this._data=t}_updateRendererData(e,t,i){var s,r;e.visible=!1;const n=this._source.priceScale(),o=this._source.properties().childs(),a=o.visible.value();if(!n||n.isEmpty()||!a)return;const c=null===(r=null===(s=o.graphics.childs()[this._data.lineType])||void 0===s?void 0:s.childs()[this._data.styleId])||void 0===r?void 0:r.childs();if(!(void 0!==c&&c.visible&&c.visible.value()&&c.showPrice&&c.showPrice.value()&&this._isLabelVisibleAccordinglyToProperties()))return;const h=this._source.firstValue();if(null===h)return;const d=this._data.line.level,u=(0,l.resetTransparency)(c.color.value());i.background=u,i.textColor=this.generateTextColor(u),i.coordinate=n.priceToCoordinate(d,h),e.text=n.formatPrice(d,h,!0),e.visible=!0}_isLabelVisibleAccordinglyToProperties(){
return!!this._source.model().properties().childs().scalesProperties.childs().showStudyLastValue.value()&&this._source.properties().childs().showLabelsOnPriceScale.value()}}const h=(0,s.getLogger)("Chart.StudyGraphics"),d=new Set(["dwgtablecells"]);async function u(e,t,s,r){switch(e){case"hhists":return new((await i.e(507).then(i.bind(i,179710))).HHistPaneView)(t,s,r);case"horizlines":return new((await i.e(507).then(i.bind(i,606029))).HorizLinePaneView)(t,s,r);case"vertlines":return new((await i.e(507).then(i.bind(i,81674))).VertLinePaneView)(t,s,r);case"polygons":return new((await i.e(507).then(i.bind(i,678124))).PolygonPaneView)(t,s,r);case"backgrounds":return new((await i.e(507).then(i.bind(i,625565))).BackgroundPaneView)(t,s,r)}return null}async function p(e,t,i){const s=[],r=Object.keys(e.graphicsInfo());r.sort(((e,t)=>_(e)-_(t)));for(const n of r){const r=await u(n,e,t,i);null!==r?s.push(r):d.has(n)||h.logWarn(`${n} is not supported by this build of graphics subsystem, skipping`)}return s}function _(e){var t;return null!==(t=r.primitivesZOrders.get(e))&&void 0!==t?t:0}function m(e){const t=Object.keys(e.graphicsInfo()),i=[];for(const s of t)switch(s){case"hlines":e.graphics().hlines().forEach(((t,r)=>{t.forEach((t=>{void 0!==t.level&&i.push(new c(e,{line:{level:t.level},styleId:r,lineType:s}))}))}));break;case"horizlines":e.graphics().horizlines().forEach(((t,r)=>{t.forEach((t=>{void 0!==t.level&&i.push(new c(e,{line:{level:t.level},styleId:r,lineType:s}))}))}))}return i}},507216:(e,t,i)=>{"use strict";i.d(t,{HHistDirection:()=>s,HHistLocation:()=>r,HHistVolumeMode:()=>n,materializeHHist:()=>c,dematerializeHHist:()=>h,isHHistInBarsRange:()=>d});var s,r,n,o=i(650151),a=i(724912),l=i(900827);function c(e,t){if(e.firstBarTime>=t.length||e.lastBarTime>=t.length)return null;const i=t[e.firstBarTime],s=t[e.lastBarTime];return i===a.INVALID_TIME_POINT_INDEX||s===a.INVALID_TIME_POINT_INDEX?null:((0,o.assert)(i<=s,"firstBarTime should not exceed lastBarTime"),(0,o.assert)(e.priceLow<=e.priceHigh,"priceLow should not exceed priceHigh"),{firstBarTime:i,lastBarTime:s,rate:e.rate,priceHigh:e.priceHigh,priceLow:e.priceLow})}function h(e,t,i){const s=(0,l.ensureTimePointIndexIndex)(i.indexOf(e.firstBarTime)),r=(0,l.ensureTimePointIndexIndex)(i.indexOf(e.lastBarTime));return{id:t,...e,firstBarTime:s,lastBarTime:r}}function d(e,t){const i=Math.min(e.firstBarTime,e.lastBarTime),s=Math.max(e.firstBarTime,e.lastBarTime);return t.contains(i)||t.contains(s)||i<t.firstBar()&&s>t.lastBar()}!function(e){e.LeftToRight="left_to_right",e.RightToLeft="right_to_left"}(s||(s={})),function(e){e.Relative="relative",e.Absolute="absolute"}(r||(r={})),function(e){e.UpDown="Up/Down",e.Total="Total",e.Delta="Delta"}(n||(n={}))},75082:(e,t,i)=>{"use strict";i.d(t,{materializeHorizLine:()=>o,dematerializeHorizLine:()=>a,isHorizLineInBarsRange:()=>l});var s=i(650151),r=i(724912),n=i(900827);function o(e,t){if(e.startIndex>=t.length||e.endIndex>=t.length)return null;const i=t[e.startIndex],n=t[e.endIndex]
;return i===r.INVALID_TIME_POINT_INDEX||n===r.INVALID_TIME_POINT_INDEX?null:((0,s.assert)(i<=n,"startIndex should not exceed endIndex"),{startIndex:i,endIndex:n,level:e.level,extendLeft:e.extendLeft,extendRight:e.extendRight})}function a(e,t,i){const s=(0,n.ensureTimePointIndexIndex)(i.indexOf(e.startIndex)),r=(0,n.ensureTimePointIndexIndex)(i.indexOf(e.endIndex));return{id:t,...e,startIndex:s,endIndex:r}}function l(e,t){const i=Math.min(e.startIndex,e.endIndex),s=Math.max(e.startIndex,e.endIndex);if(t.contains(i)||t.contains(s)||i<t.firstBar()&&s>t.lastBar())return!0;const r=e.startIndex<e.endIndex?e.extendLeft:e.extendRight,n=e.startIndex<e.endIndex?e.extendRight:e.extendLeft;return s<t.firstBar()&&n||i>t.lastBar()&&r}},71023:(e,t,i)=>{"use strict";i.d(t,{LiveStudyGraphics:()=>d});var s=i(650151),r=i(507216),n=i(75082),o=i(688203),a=i(769920),l=i(560052),c=i(782017),h=i(740498);class d{constructor(){this._indexes=[],this._horizlines=new Map,this._vertlines=new Map,this._lines=new Map,this._hlines=new Map,this._textmarks=new Map,this._shapemarks=new Map,this._backgrounds=new Map,this._polygons=new Map,this._trendchannels=new Map,this._hhists=new Map,this._dwglabels=new Map,this._dwgboxes=new Map,this._dwglines=new Map,this._dwgtables=new Map,this._dwgtablecells=new Map,this._dwglinefills=new Map,this._hhistsByTimePointIndex=new Map}horizlines(){return this._horizlines}vertlines(){return this._vertlines}lines(){return this._lines}hlines(){return this._hlines}textmarks(){return this._textmarks}shapemarks(){return this._shapemarks}backgrounds(){return this._backgrounds}polygons(){return this._polygons}trendchannels(){return this._trendchannels}hhists(){return this._hhists}dwglabels(){return this._dwglabels}dwglines(){return this._dwglines}dwgboxes(){return this._dwgboxes}dwgtables(){return this._dwgtables}dwgtablecells(){return this._dwgtablecells}dwglinefills(){return this._dwglinefills}hhistsByTimePointIndex(){return this._hhistsByTimePointIndex}clear(){this._indexes=[],this._clearPrimitives()}extract(){const e=e=>e.extract(),t={indexes:this._indexes,horizlines:p(this._horizlines,e),vertlines:p(this._vertlines,e),lines:p(this._lines,e),hlines:p(this._hlines,e),textmarks:p(this._textmarks,e),shapemarks:p(this._shapemarks,e),backgrounds:p(this._backgrounds,e),polygons:p(this._polygons,e),trendchannels:p(this._trendchannels,e),hhists:p(this._hhists,e),dwglabels:p(this._dwglabels,e),dwglines:p(this._dwglines,e),dwgboxes:p(this._dwgboxes,e),dwgtables:p(this._dwgtables,e),dwgtablecells:p(this._dwgtablecells,e),dwglinefills:p(this._dwglinefills,e)};return this._hhistsByTimePointIndex=new Map,new h.StaticStudyGraphics("data",t)}replaceIndexesTo(e){this._indexes=e;const t=e=>e.replaceIndexesTo(this._indexes);this._horizlines.forEach(t),this._vertlines.forEach(t),this._lines.forEach(t),this._hlines.forEach(t),this._textmarks.forEach(t),this._shapemarks.forEach(t),this._backgrounds.forEach(t),this._polygons.forEach(t),this._trendchannels.forEach(t),this._hhists.forEach(t),this._dwglabels.forEach(t),this._dwgboxes.forEach(t),
this._dwglines.forEach(t),this._dwgtables.forEach(t),this._dwgtablecells.forEach(t),this._dwglinefills.forEach(t),this._hhistsByTimePointIndex=(0,c.splitHHistsByTimePointIndex)(this._hhists)}processCommands(e,t){void 0!==e.erase&&this._processEraseCommands(e.erase),void 0!==e.create&&this._processCreateCommands(e.create,t)}_processCreateCommands(e,t){for(const i in e){if(!e.hasOwnProperty(i))continue;const c=i;switch((0,s.assert)(c in t,`There is a '${c}' in study response, but it doesn't present in graphics info!`),c){case"hhists":_(this._hhists,e[c],t[c],this._indexes,r.materializeHHist);break;case"horizlines":_(this._horizlines,e[c],t[c],this._indexes,n.materializeHorizLine);break;case"vertlines":_(this._vertlines,e[c],t[c],this._indexes,o.materializeVertLine);break;case"polygons":_(this._polygons,e[c],t[c],this._indexes,a.materializePolygon);break;case"backgrounds":_(this._backgrounds,e[c],t[c],this._indexes,l.materializeBackground)}}this._hhistsByTimePointIndex=(0,c.splitHHistsByTimePointIndex)(this._hhists)}_processEraseCommands(e){for(const t of e)if("all"===t.action)this._clearPrimitives();else{const e=e=>e.deleteById(t.id);switch(t.type){case"horizlines":this._horizlines.forEach(e);break;case"vertlines":this._vertlines.forEach(e);break;case"lines":this._lines.forEach(e);break;case"hlines":this._hlines.forEach(e);break;case"textmarks":this._textmarks.forEach(e);break;case"shapemarks":this._shapemarks.forEach(e);break;case"backgrounds":this._backgrounds.forEach(e);break;case"polygons":this._polygons.forEach(e);break;case"trendchannels":this._trendchannels.forEach(e);break;case"hhists":this._hhists.forEach(e);break;case"dwglabels":this._dwglabels.forEach(e);break;case"dwglines":this._dwglines.forEach(e);break;case"dwgboxes":this._dwgboxes.forEach(e);break;case"dwgtables":this._dwgtables.forEach(e);break;case"dwgtablecells":this._dwgtablecells.forEach(e);break;case"dwglinefills":this._dwglinefills.forEach(e)}}this._hhistsByTimePointIndex=(0,c.splitHHistsByTimePointIndex)(this._hhists)}_clearPrimitives(){this._horizlines.clear(),this._vertlines.clear(),this._lines.clear(),this._hlines.clear(),this._textmarks.clear(),this._shapemarks.clear(),this._backgrounds.clear(),this._polygons.clear(),this._trendchannels.clear(),this._hhists.clear(),this._dwglabels.clear(),this._dwgboxes.clear(),this._dwglines.clear(),this._dwgtables.clear(),this._dwgtablecells.clear(),this._dwglinefills.clear(),this._hhistsByTimePointIndex=new Map}}class u{constructor(e,t){this._primitivesDataById=new Map,this._primitiveById=new Map,this._materializePrimitive=e,this._indexes=t}forEach(e,t){this._primitiveById.forEach((i=>{e.call(t,i,i,this)}))}has(e){let t=!1;return this._primitiveById.forEach((i=>{t=t||i===e})),t}get size(){return this._primitiveById.size}[Symbol.iterator](){return this._primitiveById.values()}entries(){throw new Error("Not implemented")}keys(){throw new Error("Not implemented")}values(){throw new Error("Not implemented")}hasId(e){return this._primitiveById.has(e)}addData(e){this._primitivesDataById.set(e.id,e),
this._tryMaterialize(e)}deleteById(e){this._primitiveById.delete(e),this._primitivesDataById.delete(e)}clear(){this._primitivesDataById.clear(),this._primitiveById.clear()}replaceIndexesTo(e){this._indexes=e,this._primitiveById.clear(),this._primitivesDataById.forEach(this._tryMaterialize,this)}extract(){const e=new Set(this._primitivesDataById.values());return this._primitivesDataById=new Map,this._primitiveById.clear(),e}_tryMaterialize(e){const t=this._materializePrimitive(e,this._indexes);null!==t&&((0,s.assert)(!this._primitiveById.has(e.id),"primitive with specified id should not exist"),this._primitiveById.set(e.id,t))}}function p(e,t){const i=new Map;return e.forEach(((e,s)=>i.set(s,t(e)))),i}function _(e,t,i,r,n){if(void 0!==t)for(const o of t){const t=o.styleId;void 0!==i&&(0,s.assert)(t in i,"Every style used by graphics primitive should be declared in study metainfo");let a=e.get(t);void 0===a&&(a=new u(n,r),e.set(t,a)),o.data.forEach(a.addData.bind(a))}}},769920:(e,t,i)=>{"use strict";i.d(t,{materializePolygon:()=>n,dematerializePolygon:()=>o,isPolygonInBarsRange:()=>a});var s=i(724912),r=i(900827);function n(e,t){for(const i of e.points){if(i.index>=t.length)return null;if(t[i.index]===s.INVALID_TIME_POINT_INDEX)return null}return{points:e.points.map((e=>({index:t[e.index],offset:e.offset,level:e.level})))}}function o(e,t,i){return{id:t,points:e.points.map((e=>({...e,index:(0,r.ensureTimePointIndexIndex)(i.indexOf(e.index))})))}}function a(e,t){var i;if(e.points.some((e=>{var i;return t.contains(e.index+(null!==(i=e.offset)&&void 0!==i?i:0))})))return!0;let s=!1,r=!1;const n=t.firstBar();for(const t of e.points)t.index+(null!==(i=t.offset)&&void 0!==i?i:0)<n?s=!0:r=!0;return s&&r}},740498:(e,t,i)=>{"use strict";i.d(t,{StaticStudyGraphics:()=>h,emptyStudyGraphics:()=>_,loadStudyGraphics:()=>m,saveStudyGraphics:()=>g});var s=i(724912),r=i(75082),n=i(688203),o=i(507216),a=i(769920),l=i(560052),c=i(782017);class h{constructor(e,t){if(this._indexes=[],this._horizlines=new Map,this._vertlines=new Map,this._lines=new Map,this._hlines=new Map,this._textmarks=new Map,this._shapemarks=new Map,this._backgrounds=new Map,this._polygons=new Map,this._trendchannels=new Map,this._hhists=new Map,this._dwglabels=new Map,this._dwglines=new Map,this._dwgboxes=new Map,this._dwgtables=new Map,this._dwgtablecells=new Map,this._dwglinefills=new Map,"data"===e){const e=t;this._indexes=e.indexes,this._vertlines=d(e.vertlines,this._indexes,n.materializeVertLine),this._horizlines=d(e.horizlines,this._indexes,r.materializeHorizLine),this._polygons=d(e.polygons,this._indexes,a.materializePolygon),this._hhists=d(e.hhists,this._indexes,o.materializeHHist),this._backgrounds=d(e.backgrounds,this._indexes,l.materializeBackground)}else if("state"===e){const e=t;this._indexes=e.indexes||[],this._vertlines=u(e.vertlines,this._indexes,n.materializeVertLine),this._horizlines=u(e.horizlines,this._indexes,r.materializeHorizLine),this._polygons=u(e.polygons,this._indexes,a.materializePolygon),
this._hhists=u(e.hhists,this._indexes,o.materializeHHist),this._backgrounds=u(e.backgrounds,this._indexes,l.materializeBackground)}this._hhistsByTimePointIndex=(0,c.splitHHistsByTimePointIndex)(this._hhists)}horizlines(){return this._horizlines}vertlines(){return this._vertlines}lines(){return this._lines}hlines(){return this._hlines}textmarks(){return this._textmarks}shapemarks(){return this._shapemarks}backgrounds(){return this._backgrounds}polygons(){return this._polygons}trendchannels(){return this._trendchannels}hhists(){return this._hhists}dwglabels(){return this._dwglabels}dwglines(){return this._dwglines}dwgboxes(){return this._dwgboxes}dwgtables(){return this._dwgtables}dwgtablecells(){return this._dwgtablecells}dwglinefills(){return this._dwglinefills}hhistsByTimePointIndex(){return this._hhistsByTimePointIndex}}function d(e,t,i){const s=new Map;return e.forEach(((e,r)=>{const n=s.get(r)||new Set;e.forEach((e=>{const s=i(e,t);null!==s&&n.add(s)})),s.set(r,n)})),s}function u(e,t,i){const s=new Map;if(void 0===e)return s;for(const r of e){const e=r.styleId,n=s.get(e)||new Set;r.data.forEach((e=>{const s=i(e,t);null!==s&&n.add(s)})),s.set(e,n)}return s}function p(e,t,i,s,r,n){const o=[];return e.forEach(((e,a)=>{e.forEach((e=>{(null===r||s(e,r))&&function(e,t,i){let s=null;for(const i of e)i.styleId===t&&(s=i);null===s&&(s={styleId:t,data:[]},e.push(s)),s.data.push(i)}(o,a,n(e,t(e),i))}))})),o.length>0?o:void 0}function _(){return new h}function m(e){return new h("state",e)}function g(e,t){const i=function(e){const t=new Set;e.horizlines().forEach(((e,i)=>{e.forEach((e=>{t.add(e.startIndex),t.add(e.endIndex)}))})),e.vertlines().forEach(((e,i)=>{e.forEach((e=>{t.add(e.index)}))})),e.lines().forEach(((e,i)=>{e.forEach((e=>{t.add(e.startIndex),t.add(e.endIndex)}))})),e.textmarks().forEach(((e,i)=>{e.forEach((e=>{t.add(e.time)}))})),e.shapemarks().forEach(((e,i)=>{e.forEach((e=>{t.add(e.time)}))})),e.backgrounds().forEach(((e,i)=>{e.forEach((e=>{t.add(null!==e.start?e.start:s.INVALID_TIME_POINT_INDEX),t.add(e.stop)}))})),e.polygons().forEach(((e,i)=>{e.forEach((e=>{e.points.forEach((e=>{t.add(e.index)}))}))})),e.trendchannels().forEach(((e,i)=>{e.forEach((e=>{t.add(e.startIndex),t.add(e.endIndex)}))})),e.hhists().forEach(((e,i)=>{e.forEach((e=>{t.add(e.firstBarTime),t.add(e.lastBarTime)}))})),e.dwglabels().forEach(((e,i)=>{e.forEach((e=>{t.add(e.x)}))})),e.dwglines().forEach(((e,i)=>{e.forEach((e=>{var i,r;t.add(null!==(i=e.x1)&&void 0!==i?i:s.INVALID_TIME_POINT_INDEX),t.add(null!==(r=e.x2)&&void 0!==r?r:s.INVALID_TIME_POINT_INDEX)}))})),e.dwgboxes().forEach(((e,i)=>{e.forEach((e=>{var i,r;t.add(null!==(i=e.left)&&void 0!==i?i:s.INVALID_TIME_POINT_INDEX),t.add(null!==(r=e.right)&&void 0!==r?r:s.INVALID_TIME_POINT_INDEX)}))}));const i=Array.from(t);return i.sort(((e,t)=>e-t)),i}(e),c={indexes:i};let h=0;const d=()=>++h;return c.vertlines=p(e.vertlines(),d,i,n.isVertLineInBarsRange,t,n.dematerializeVertLine),c.horizlines=p(e.horizlines(),d,i,r.isHorizLineInBarsRange,t,r.dematerializeHorizLine),
c.polygons=p(e.polygons(),d,i,a.isPolygonInBarsRange,t,a.dematerializePolygon),c.hhists=p(e.hhists(),d,i,o.isHHistInBarsRange,t,o.dematerializeHHist),c.backgrounds=p(e.backgrounds(),d,i,l.isBackgroundInBarsRange,t,l.dematerializeBackground),c}},795161:(e,t,i)=>{"use strict";var s,r,n,o;i.d(t,{MarkLocation:()=>s,HAlign:()=>r,LineStyle:()=>o}),function(e){e.AboveBar="AboveBar",e.BelowBar="BelowBar",e.Top="Top",e.Bottom="Bottom",e.Right="Right",e.Left="Left",e.Absolute="Absolute",e.AbsoluteUp="AbsoluteUp",e.AbsoluteDown="AbsoluteDown"}(s||(s={})),function(e){e.Left="left",e.Center="center",e.Right="right"}(r||(r={})),function(e){e.Top="top",e.Middle="middle",e.Bottom="bottom"}(n||(n={})),function(e){e[e.Solid=0]="Solid",e[e.Dotted=1]="Dotted",e[e.Dashed=2]="Dashed"}(o||(o={}))},782017:(e,t,i)=>{"use strict";i.d(t,{primitivesZOrders:()=>r,isStudyGraphicsEmpty:()=>n,splitHHistsByTimePointIndex:()=>o});const s=["horizlines","vertlines","lines","hlines","textmarks","shapemarks","backgrounds","polygons","trendchannels","hhists","dwglabels","dwglines","dwgboxes","dwgtables","dwgtablecells","dwglinefills"],r=new Map([["polygons",-4],["trendchannels",-3],["textmarks",-2],["shapemarks",-2],["backgrounds",-1],["hlines",1],["horizlines",1],["hhists",1],["dwglinefills",2],["vertlines",3],["lines",3],["dwglines",3],["dwgboxes",4],["dwglabels",5],["dwgtables",6],["dwgtablecells",6]]);function n(e){return!s.some((t=>e[t]().size>0))}function o(e){const t=new Map;return e.forEach(((e,i)=>{e.forEach((e=>{const s={...e,styleId:i},r=e.firstBarTime;let n=t.get(r);void 0===n&&(n=new Set,t.set(r,n)),n.add(s)}))})),t}},688203:(e,t,i)=>{"use strict";i.d(t,{materializeVertLine:()=>n,dematerializeVertLine:()=>o,isVertLineInBarsRange:()=>a});var s=i(724912),r=i(900827);function n(e,t){if(e.index>=t.length)return null;const i=t[e.index];return i===s.INVALID_TIME_POINT_INDEX?null:{startPrice:e.startPrice,endPrice:e.endPrice,index:i,extendTop:e.extendTop,extendBottom:e.extendBottom}}function o(e,t,i){const s=(0,r.ensureTimePointIndexIndex)(i.indexOf(e.index));return{id:t,...e,index:s}}function a(e,t){return t.contains(e.index)}},341032:(e,t,i)=>{"use strict";i.d(t,{HHistBasedValuesProvider:()=>_});var s=i(150335),r=i(650151),n=i(601227),o=i(153026),a=i(358076),l=i(609781),c=i(507216),h=i(315264),d=i(58216);function u(e,t="",i=""){return{id:t,index:e,title:i,value:"",visible:!1}}const p=n.CheckMobile.any();class _{constructor(e,t){this._emptyValues=[],this._study=e,this._model=t,void 0!==this._study.metaInfo().graphics.hhists&&this._emptyValues.push(u(0),u(1),u(2))}getItems(){return this._emptyValues}getValues(e){var t,i;const n=this._emptyValues.map((e=>({...e})));n.forEach((e=>{e.visible=this._study.isVisible(),e.value=d.notAvailable}));const a=this._study.properties().childs().inputs.childs().volume.value();switch(a){case c.HHistVolumeMode.UpDown:n[0].title="Up",n[1].title="Down",n[2].title="Total";break;case c.HHistVolumeMode.Total:n[0].title="Total",n[1].visible=!1,n[2].visible=!1;break;case c.HHistVolumeMode.Delta:n[0].title="Delta",
n[1].title="Max(Up, Down)",n[2].title="Total"}const h=this._study.priceScale(),u=this._model.timeScale();if(null===h||h.isEmpty()||u.isEmpty()||this._hideValues())return n;if(null===e||!isFinite(e)){const t=this._study.data().last();if(null===t)return n;e=t.index}const p=this._model.crossHairSource(),_=p.price;if(!isFinite(p.y)&&(e=function(e,t){var i;const s=null===(i=e.visibleBarsStrictRange())||void 0===i?void 0:i.lastBar();if(!s)return null;const r=t.data().search(s,o.PlotRowSearchMode.NearestLeft);return r?r.index:null}(this._model.timeScale(),this._model.mainSeries()),null===e))return n;const m=function(e,t,i,s){if(0===e.size)return null;if(!i){const e=(0,r.ensureNotNull)(s.data().valueAt(t));i=s.barFunction()(e)}const n=function(e,t){let i=null;return e.forEach(((e,s)=>{s<=t&&(null===i||s>i)&&(i=s)})),i}(e,t);if(null===n)return null;const o=e.get(n);if(!o||0===o.size)return null;return function(e,t){let i=null;return e.forEach((e=>{e.priceLow<=t&&t<e.priceHigh&&(i=e)})),i}(o,i)}(this._study.graphics().hhistsByTimePointIndex(),e,_,this._model.mainSeries());if(null===m)return n.forEach((e=>{e.value="0"})),n;const g=this._study.metaInfo().graphics.hhists;if(void 0===g)return n;if(void 0===g[m.styleId])return n;const f=null===(i=null===(t=this._study.properties().childs().graphics.childs().hhists)||void 0===t?void 0:t.childs()[m.styleId])||void 0===i?void 0:i.childs(),v=new l.VolumeFormatter,S=e=>(0,s.isNumber)(e)?v.format(e):"";if(a!==c.HHistVolumeMode.Delta){if(m.rate.forEach(((e,t)=>{n[t].value=S(e),n[t].color=(0,r.ensureDefined)(f).colors[t].value()})),a===c.HHistVolumeMode.UpDown){const e=m.rate[0]+m.rate[1];n[2].value=S(e),n[2].color=(0,r.ensureDefined)(f).valuesColor.value()}}else{const e=m.rate[0]>m.rate[1]?0:1,t=(0,r.ensureDefined)(f).colors[e].value(),i=m.rate[0]+m.rate[1];[2*m.rate[e]-i,m.rate[e],i].forEach(((e,i)=>{n[i].value=S(e),n[i].color=t}))}return n}_hideValues(){return p&&(null===this._model.crossHairSource().pane||(0,h.isLineToolName)(a.tool.value())||null!==this._model.lineBeingEdited())}}},864095:(e,t,i)=>{"use strict";var s;i.d(t,{StudyStatusType:()=>s}),function(e){e[e.Undefined=0]="Undefined",e[e.Loading=1]="Loading",e[e.Completed=2]="Completed",e[e.Error=3]="Error"}(s||(s={}))},538246:(e,t,i)=>{"use strict";var s;i.d(t,{InsertionErrorCode:()=>s}),function(e){e.StudyCannotBeChild="cannot_be_child",e.StubWasRemoved="stub_was_removed",e.CannotGetMetainfo="cannot_get_metainfo",e.Cancelled="cancelled",e.Unknown="unknown"}(s||(s={}))},32673:(e,t,i)=>{"use strict";i.d(t,{makeNextSymbolId:()=>r,makeNextStudyId:()=>o});let s=0;function r(){return s++,"ss_"+s}let n=0;function o(){return n++,"st"+n}},656788:(e,t,i)=>{"use strict";i.d(t,{migrateMetaInfoAndPropState:()=>p});var s=i(650151),r=i(898005),n=i(486028);const o=["Moving Average@tv-basicstudies","Moving Average Exponential@tv-basicstudies"];class a{targetMetaInfoVersion(){return 53}migrateMetaInfo(e){const t=e;e._metainfoVersion=53,o.includes(t.id)}migratePropState(e){var t,i,s
;o.includes(e.id)&&(e.inputs.length=null!==(t=e.inputs.length)&&void 0!==t?t:e.inputs.in_0,e.inputs.source=null!==(i=e.inputs.source)&&void 0!==i?i:e.inputs.in_1,e.inputs.offset=null!==(s=e.inputs.offset)&&void 0!==s?s:e.inputs.in_2,delete e.inputs.in_0,delete e.inputs.in_1,delete e.inputs.in_2,e.plots[1]={id:"smoothedMA",type:"line"},e.styles.smoothedMA={display:0,linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#0496ff",histogramBase:0,joinPoints:!1,title:"Smoothed MA"})}}const l=["Volume@tv-basicstudies"];class c{targetMetaInfoVersion(){return 53}migrateMetaInfo(e){const t=e;e._metainfoVersion=53,l.includes(t.id)}migratePropState(e){var t;l.includes(e.id)&&(e.inputs.maLength=null!==(t=e.inputs.length)&&void 0!==t?t:e.inputs.maLength,delete e.inputs.length,delete e.inputs.offset,delete e.inputs.source,e.plots[1]={id:"smoothedMA",type:"line"},e.styles.smoothedMA={display:0,linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#0496ff",histogramBase:0,joinPoints:!1,title:"Smoothed MA"})}}const h=["Relative Strength Index@tv-basicstudies","Commodity Channel Index@tv-basicstudies","On Balance Volume@tv-basicstudies"];class d{targetMetaInfoVersion(){return 53}migrateMetaInfo(e){const t=e;e._metainfoVersion=53,h.includes(t.id)}migratePropState(e){h.includes(e.id)&&(e.plots[1]={id:"smoothedMA",type:"line"},e.styles.smoothedMA={display:0,linestyle:0,linewidth:1,plottype:0,trackPrice:!1,transparency:0,color:"#0496ff",histogramBase:0,joinPoints:!1,title:"Smoothed MA"})}}const u=[new class{targetMetaInfoVersion(){return 47}migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=47,!t.defaults||void 0===t.defaults.precision)return void(i.format={type:"inherit"});const s=t.defaults&&t.defaults.precision,r=(0,n.isNumber)(s)?s:parseInt(s);0===r?i.format={type:"volume"}:isFinite(r)?i.format={type:"price",precision:r}:i.format={type:"inherit"},delete t.defaults.precision}migratePropState(e){}},new class{targetMetaInfoVersion(){return 50}migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=50,void 0===t.defaults||void 0===t.defaults.ohlcPlots||void 0===t.ohlcPlots)return;const r=t.ohlcPlots,n=t.defaults.ohlcPlots,o=(0,s.ensureDefined)((0,s.ensureDefined)(i.defaults).ohlcPlots);for(const e of Object.keys(n)){const t=n[e];if("ohlc_candles"===t.plottype){let i=!1;const s=r[e];void 0!==s&&(i=!!s.drawBorder,delete s.drawBorder),o[e]={borderColor:"#000000",drawBorder:i,...t}}}}migratePropState(e){}},new class{targetMetaInfoVersion(){return 53}migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=53,void 0!==t.defaults){if(void 0!==t.defaults.ohlcPlots&&void 0!==t.ohlcPlots){const e=Object.keys(t.ohlcPlots),r=t.defaults.ohlcPlots,n=(0,s.ensureDefined)((0,s.ensureDefined)(i.defaults).ohlcPlots);for(const t of e){const e=r[t];if(void 0===e||void 0===e.visible)continue;const i=e.visible?15:0;delete e.visible,n[t]={display:i,...e}}}if(void 0!==t.defaults.styles&&void 0!==t.plots){const e=t.plots.map((e=>e.id)),r=t.defaults.styles,n=(0,s.ensureDefined)((0,s.ensureDefined)(i.defaults).styles)
;for(const t of e){const e=r[t];if(void 0===e||void 0===e.visible)continue;const i=e.visible?15:0;delete e.visible,n[t]={display:i,...e}}}}}migratePropState(e){if(e.ohlcPlots)for(const t of Object.keys(e.ohlcPlots)){const i=(0,s.ensureDefined)(e.ohlcPlots[t]);void 0!==i.visible&&(i.display=i.visible?15:0,delete i.visible)}if(e.styles)for(const t of Object.keys(e.styles)){const i=(0,s.ensureDefined)(e.styles[t]);void 0!==i.visible&&(i.display=i.visible?15:0,delete i.visible)}}}];function p(e,t){const i=r.StudyMetaInfo.versionOf(e),n=e;void 0===n._serverMetaInfoVersion&&(n._serverMetaInfoVersion=i);const o=["PennantCP@tv-basicstudies","WedgeCP@tv-basicstudies"].includes(e.id);u.forEach((r=>{(i<0||i>=r.targetMetaInfoVersion())&&!o||(r.migrateMetaInfo(e),void 0!==t&&r.migratePropState(t),(0,s.assert)(e._metainfoVersion===r.targetMetaInfoVersion()))}))}u.push(new a),u.push(new c),u.push(new d),u.sort((function(e,t){return e.targetMetaInfoVersion()-t.targetMetaInfoVersion()}))},554511:(e,t,i)=>{"use strict";i.d(t,{isNonSeriesStudy:()=>n,NonSeriesStudy:()=>o});var s=i(650151),r=i(793159);function n(e){return e instanceof o}class o extends r.Study{clearData(){this._customData=null,this._indexes=null}restoreData(e,t,i){super.restoreData(e),this._customData=t,this._indexes=i}state(e){const t=super.state(e);return e&&(t.nonSeriesData=this._customData,t.indexes=this._indexes),t}customData(){return this._customData}_setPaneViews(e){this._paneViews=e,this.model().lightUpdate()}_onDataUpdated(e,t,i){null!==t&&(t.indexes_replace?((0,s.assert)("nochange"!==i),this._indexes=i):(this._customData=t.data,"nochange"!==i&&(this._indexes=i))),super._onDataUpdated(e,t,i)}}},744833:(e,t,i)=>{"use strict";i.d(t,{OverlayDataWindowView:()=>d});var s=i(150335),r=i(43657),n=i(601227),o=i(315264),a=i(358076),l=i(484727),c=i(402440);const h=n.CheckMobile.any();class d extends r.DataWindowView{constructor(e,t){super(),this._invalidated=!0,this._study=e,this._model=t,this._valueProvider=this._createValuesProvider(e,t),this._items=this._valueProvider.getItems().map((e=>new r.DataWindowItem(e.id,e.title,""))),this.update()}items(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items}update(){this._invalidated=!0}study(){return this._study}_updateImpl(){var e,t;this._header=this._study.title();let i;this._showLastPriceAndChangeOnly()?i=this._study.data().lastIndex():(i=this._model.crossHairSource().appliedIndex(),l.enabled("use_last_visible_bar_value_in_legend")&&!(0,s.isNumber)(i)&&(i=null!==(t=null===(e=this._model.timeScale().visibleBarsStrictRange())||void 0===e?void 0:e.lastBar())&&void 0!==t?t:NaN));const r=this._valueProvider.getValues(i);for(let e=0;e<r.length;++e){const t=r[e],i=this._items[e];i.setValue(t.value),i.setVisible(t.visible),i.setColor(t.color)}}_showLastPriceAndChangeOnly(){return h&&(null===this._model.crossHairSource().pane||(0,o.isLineToolName)(a.tool.value())||null!==this._model.lineBeingEdited())}_createValuesProvider(e,t){return new c.StudyLegendValuesProvider(e,t)}}},470441:(e,t,i)=>{"use strict"
;i.d(t,{OverlayLegendValuesProvider:()=>P});var s=i(632054),r=i(150335),n=i(509806),o=i(601227),a=i(602564),l=i(561626),c=i(58594),h=i(595398),d=i(153026),u=i(358076),p=i(170238),_=i(254303),m=i(161999),g=i(315264),f=i(58216);const v=o.CheckMobile.any(),S=v&&!1,y=new c.PercentageFormatter,b=f.notAvailable,w=`${b} (${b}%)`;class P extends class{constructor(e,t){this._study=e,this._model=t,this._emptyValues=[{title:n.t(null,void 0,i(539280)),visible:!1,value:"",index:0,id:""},{title:n.t(null,void 0,i(330777)),visible:!1,value:"",index:1,id:""},{title:n.t(null,void 0,i(608136)),visible:!1,value:"",index:2,id:""},{title:n.t(null,void 0,i(931691)),visible:!1,value:"",index:3,id:""},{title:"",visible:!1,value:"",index:4,id:""},{title:"",visible:!1,value:"",index:5,id:""},{title:n.t(null,void 0,i(349329)),visible:!1,value:"",index:6,id:""}]}getItems(){return this._emptyValues}getValues(e){var t;const i=this._emptyValues.map((e=>({...e})));if(this._model.timeScale().isEmpty())return i;if(0===this._study.data().size())return i;const s=this._showLastPriceAndChangeOnly();if((0,r.isNumber)(e)||(s?e=this._study.data().lastIndex():(e=this._model.crossHairSource().appliedIndex(),(0,r.isNumber)(e)||(e=this._study.data().lastIndex()))),null===e||!(0,r.isNumber)(e))return i;const n=this._study.data().search(e,d.PlotRowSearchMode.NearestLeft,1),o=this._model.backgroundTopColor().value();if(null===n)return i;const c=n.index,u=n.value,p=u[1],g=u[2],f=u[3],v=u[4];i[0].value=b,i[1].value=b,i[2].value=b,i[3].value=b,i[6].value=w;for(const e of i)e.visible=!s;const P=i[4];P.visible=!1;const{values:C}=this._changesData(v,p,c,s),T=(0,m.getPriceValueFormatterForSource)(this._study);if((0,m.shouldBeFormattedAsPercent)(this._study)||(0,m.shouldBeFormattedAsIndexedTo100)(this._study))i[6].value="";else if(void 0!==C){const e=this._study.formatter();i[6].value=(0,l.forceLTRStr)(`${e.format(C.change,!0)} (${y.format(C.percentChange,!0)})`)}s?(i[5].value=null==v?b:T(v),i[5].visible=!0,i[6].visible=!0):(i[0].value=null==p?b:T(p),i[1].value=null==g?b:T(g),i[2].value=null==f?b:T(f),i[3].value=null==v?b:T(v),P.value=T(this._study.barFunction()(u)),i[5].visible=!1);let x=null;if(s&&!S)x=void 0===C||C.change>=0?_.SeriesBarColorer.upColor(this._study.properties()):_.SeriesBarColorer.downColor(this._study.properties());else{const e=this._study.barColorer().barStyle(c,!1),i=null!==(t=e.barBorderColor)&&void 0!==t?t:e.barColor;x=(0,h.calculateColor)(o,i)}x=(0,a.resetTransparency)((0,h.calculateColor)(o,x));for(const e of i)e.color=x;return i}_showLastPriceAndChangeOnly(){return v&&(null===this._model.crossHairSource().pane||(0,g.isLineToolName)(u.tool.value())||null!==this._model.lineBeingEdited())}_changesData(e,t,i,s){var r;if(s&&!S){const e=this._study.quotes();if(null!==e)return{values:{change:null!==e.change?e.change:0,percentChange:null!==e.change_percent?e.change_percent:0},priceDirection:{basedOnCurrentBar:null!==e.change&&e.change>=0?0:1,basedOnPrevClose:null!==e.change&&e.change>=0?0:1}}}else{
const s=this._study.data().search(i-1,d.PlotRowSearchMode.NearestLeft,1),n=null!==(r=null==s?void 0:s.value[4])&&void 0!==r?r:null;if(null!==n&&null!=e&&null!=t)return{values:{change:e-n,percentChange:(0,p.barPercentChange)(n,e)},priceDirection:{basedOnCurrentBar:e>=t?0:1,basedOnPrevClose:e>=n?0:1}}}return null==e||null==t?{}:{priceDirection:{basedOnCurrentBar:e>=t?0:1,basedOnPrevClose:e>=t?0:1}}}}{constructor(e,t){super(e,t);const i=t.properties().childs().paneProperties.childs().legendProperties.childs();this._showBarChange=i.showBarChange,this._showSeriesOHLC=i.showSeriesOHLC,this._seriesStyle=e.properties().childs().style}getValues(e){const t=super.getValues(e);if(!this._showLastPriceAndChangeOnly()){const e=this._seriesStyle.value(),i=(0,s.isPriceSourceStyle)(e),r=12===e,n=this._showSeriesOHLC.value(),o=n&&!i,a=n&&i;t[0].visible=o&&!r,t[1].visible=o,t[2].visible=o,t[3].visible=o&&!r,t[6].visible=this._showBarChange.value()&&!r,t[4].visible=a}return t}}},878317:(e,t,i)=>{"use strict";i.d(t,{OverlayStatusProvider:()=>r});var s=i(736360);class r extends s.StudyStatusProvider{getSplitTitle(){return this._source.titleInParts(!0,void 0,!1,!1)}text(){return this._source.isActualInterval()?this._source.isFailed()?`${this._source.title(!0,void 0,!1,!1)}: ${this.sourceStatusText()}`:`${this._source.title(!0,void 0,!1,!1)} ${this.sourceStatusText()}`:this._source.title(!0,void 0,!1,!1)}}},870706:(e,t,i)=>{"use strict";i.d(t,{PivotPointsStandardLastPricesView:()=>o});var s=i(153026);const r=["p","s1","r1","s2","r2","s3","r3","s4","r4","s5","r5"],n={P:"P",S1:"S1/R1",S2:"S2/R2",S3:"S3/R3",S4:"S4/R4",S5:"S5/R5",R1:"S1/R1",R2:"S2/R2",R3:"S3/R3",R4:"S4/R4",R5:"S5/R5"};class o{constructor(e){this._visiblePivots=new Set,this._invidated=!0,this._prices=[],this._source=e}visiblePivots(){return this._visiblePivots}update(){this._invidated=!0}prices(){return this._invidated&&(this._updateImpl(),this._invidated=!1),this._prices}_updateImpl(){this._visiblePivots.clear();const e=this._source.model(),t=this._source.priceScale();if(null===t)return;if(e.timeScale().isEmpty()||t.isEmpty())return;const i=e.timeScale().visibleBarsStrictRange();if(null===i)return;if(!this._source.customData()||!this._source.customData().pivots)return;const o=e.mainSeries().bars().search(i.lastBar(),s.PlotRowSearchMode.NearestLeft);if(null===o)return;const a=o.index,l=this._source.customData().pivots,c=this._source.indexes(),h=this._source.properties().childs(),d=this._source.firstValue();for(let e=0;e<l.length;e++){if(!l[e])continue;const i=c[l[e].startIndex],s=c[l[e].endIndex],o=h.inputs.childs().showHistoricalPivots.value();if(i<=a&&(s>=a||o)){this._visiblePivots.add(l[e]),this._prices=[];for(let i=0;i<r.length;i++){const s=r[i],o=l[e][s];if(void 0===o||null===d)continue;const a=t.priceToCoordinate(o,d),c=s.toUpperCase(),u=n[c],p=h.levelsStyle.childs().colors.childs()[u].value();this._prices.push({formatted:t.formatPrice(o,d),price:o,coordinate:a,color:p})}}}}}},866097:(e,t,i)=>{"use strict";i.d(t,{PaneRendererStandardPivotLabel:()=>r});var s=i(777277)
;class r{constructor(e,t,i){this._drawRects=[],this._cacheProvider=e,this._point=t,this._label=i}draw(e,t){const i=this._cacheProvider(t);e.save(),e.setTransform(1,0,0,1,0,0);const s=t.pixelRatio;this._drawRects=[];const r=t=>{const r=i.labelRectByIndex(t),n={left:Math.round(this._point.x-r.width+o),top:Math.round(this._point.y-r.height/2),width:r.width,height:r.height};return e.drawImage(i.canvas(),Math.round(r.left*s),Math.round(r.top*s),r.width*s,r.height*s,Math.round(n.left*s),Math.round(n.top*s),n.width*s,n.height*s),this._drawRects.push(n),r.width},n=this._label.split("/");let o=0;for(let e=0;e<n.length;e++){const t=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5"].indexOf(n[e]);e>0&&(o+=r(t+11)/2),o+=r(t)/2}e.restore()}hitTest(e){for(const t of this._drawRects)if(e.x>=t.left&&e.x<=t.left+t.width&&e.y>=t.top&&e.y<=t.top+t.height)return new s.HitTestResult(s.HitTestResult.REGULAR);return null}}},795617:(e,t,i)=>{"use strict";i.d(t,{StandardPivotPointsImageCache:()=>o});var s=i(327714),r=i(289763),n=i(650151);class o{constructor(e,t,i,r){this._priceAxisFontSize=11,this._prices=[],this._labelWidth=0,this._paneRenderParams=e,this._recreateCanvasAndContext((0,s.size)({width:0,height:0})),this.reset({font:t,fontSize:i,backColors:r})}destroy(){delete this._canvas,delete this._cache}canvas(){return this._canvas}reset(e){this._renderParams=e,this._prices=[],this._cache.font=e.fontSize+"px "+e.font,this._labelWidth=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5","/"].reduce(((e,t)=>{const i=this._cache.measureText(t).width;return Math.max(i,e)}),0)}rowHeight(){return this._priceAxisFontSize+4}labelRectByIndex(e){return{left:0,top:Math.round(this._topByIndex(e)),width:Math.round(this._labelWidth+4),height:Math.round(this._renderParams.fontSize+8)}}setPrices(e){let t=!1;const i=(e,t)=>{const i=void 0===e,s=void 0===t;return(!i&&!s||i===s)&&(0,n.ensureDefined)(e).formatted===(0,n.ensureDefined)(t).formatted};if(e.length!==this._prices.length)t=!0;else for(let s=0;s<this._prices.length;s++)if(!i(this._prices[s],e[s])){t=!0;break}if(t){const t=this._labelWidth+6,i=this._renderParams.fontSize,n=Math.max(e.length,22)*(i+8);this._recreateCanvasAndContext((0,s.size)({width:t,height:n})),this._prices=e,this._cache.save(),(0,r.drawScaled)(this._cache,this._paneRenderParams.pixelRatio,(()=>{this._cache.translate(.5,.5),this._cache.font=this._renderParams.fontSize+"px "+this._renderParams.font,this._cache.textBaseline="middle";for(let e=0;e<this._prices.length;e++){if(!this._prices[e])continue;const t=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5"][e];this._cache.fillStyle=this._renderParams.backColors[e],this._cache.fillText(t,0,this._centerByIndex(e)),this._cache.fillText("/",0,this._centerByIndex(e+11))}})),this._cache.restore(),this._prices=e}}_recreateCanvasAndContext(e){this._canvas=document.createElement("canvas"),this._canvas.width=e.width*this._paneRenderParams.pixelRatio,this._canvas.height=e.height*this._paneRenderParams.pixelRatio,this._cache=(0,n.ensureNotNull)(this._canvas.getContext("2d"))}
_centerByIndex(e){return Math.round((e+.5)*(this._renderParams.fontSize+8))}_topByIndex(e){return Math.round(e*(this._renderParams.fontSize+8))}}},135070:(e,t,i)=>{"use strict";i.d(t,{StandardPivotPointsPriceAxisView:()=>o});var s=i(672428),r=i(602564);const n=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5"];class o extends s.PriceAxisView{constructor(e,t){super(),this._source=e,this._data=t;const i=t.name;this._completeName="P"===i.toUpperCase()?"P":`S${i[1]}/R${i[1]}`}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const s=this._source.properties().childs();if(!s.visible.value())return;const o=this._completeName,a=s.levelsStyle.childs().visibility.childs();if(!a[o]||!a[o].value())return;const l=this._source.model().timeScale(),c=this._source.priceScale();if(l.isEmpty()||null===l.visibleBarsStrictRange()||null!==c&&c.isEmpty())return;const h=this._source.customData();if(!h||!h.pivots)return;const d=this._source.pricesView().prices()[n.indexOf(this._data.name.toUpperCase())];if(!d)return;i.background=(0,r.resetTransparency)(d.color),i.textColor=this.generateTextColor(i.background),i.coordinate=d.coordinate,i.floatCoordinate=d.floatCoordinate;const u=this._source.model().properties().childs().scalesProperties.childs();u.showStudyLastValue.value()&&(e.text=d.formatted,e.visible=!0),u.showStudyPlotLabels.value()&&(t.text=this._source.priceLabelText(this._data.name),t.visible=!0)}}},118309:(e,t,i)=>{"use strict";var s=i(786432).PriceRange,r=i(86441).Point,n=i(533927).StudyStatusView,o=i(492326).StudyDataWindowView,a=i(554511).NonSeriesStudy,l=i(135070).StandardPivotPointsPriceAxisView,c=i(70362).PanePriceAxisView,h=i(777277).HitTestResult,d=i(385824).CompositeRenderer,u=i(856996).areEqualPaneRenderParams,p=i(795617).StandardPivotPointsImageCache,_=i(870706).PivotPointsStandardLastPricesView,m=i(866097).PaneRendererStandardPivotLabel,g=i(68976).HorizontalLineRenderer,f=i(574570);const{LINESTYLE_SOLID:v}=i(284269);class S{constructor(e,t){this._model=e,this._source=t,this._pivots=[],this._textCache={}}setCache(e){this._cache=e}priceAxisViews(e,t){return this._priceAxisViews}mergeLabel(e,t,i){var s=""+t;void 0===e[s]?(e[s]={},e[s].text=i,e[s].ids=[this.complete(i)]):(e[s].text+="/"+i,e[s].ids.push(this.complete(i)))}complete(e){return"P"===e?e:"S"+e[1]+"/R"+e[1]}update(){this._invalidated=!0}_updateImpl(){if(this._source.pricesView().prices(),this._pivots=[],this._source.customData()&&this._source.customData().pivots&&this._source.properties().visible.value()){var e=this._source.customData().pivots,t=this._source._indexes,i=this._model.timeScale(),s=this._source.priceScale();if(s&&!s.isEmpty()&&!i.isEmpty()&&e){var r=i.visibleBarsStrictRange(),n=r.firstBar(),o=r.lastBar();if(this._source.ownerSource())for(var a=this._source.ownerSource().firstValue(),l=0;l<e.length;l++)if(e[l]){var c=t[e[l].startIndex],h=t[e[l].endIndex];if(!(h<n||c>o)){var d={},u=this._source.properties().levelsStyle.visibility;u.P.value()&&this.mergeLabel(d,e[l].p,"P"),u["S1/R1"].value()&&(this.mergeLabel(d,e[l].s1,"S1"),
this.mergeLabel(d,e[l].r1,"R1")),u["S2/R2"].value()&&(this.mergeLabel(d,e[l].s2,"S2"),this.mergeLabel(d,e[l].r2,"R2")),u["S3/R3"].value()&&(this.mergeLabel(d,e[l].s3,"S3"),this.mergeLabel(d,e[l].r3,"R3")),u["S4/R4"].value()&&(this.mergeLabel(d,e[l].s4,"S4"),this.mergeLabel(d,e[l].r4,"R4")),u["S5/R5"].value()&&(this.mergeLabel(d,e[l].s5,"S5"),this.mergeLabel(d,e[l].r5,"R5"));var p=i.indexToCoordinate(c),_=i.indexToCoordinate(h);for(var m in d){var g=parseFloat(m),f=s.priceToCoordinate(g,a);this._pivots.push({x1:p,x2:_,y:f,label:d[m].text,labelIds:d[m].ids,src:e[l]})}}}}}}renderer(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);for(var e=new d,t=this._source.properties().levelsStyle.colors,i=this._source.properties().levelsStyle.widths,s=this._source.visiblePivots(),n=0;n<this._pivots.length;n++){var o=this._pivots[n];if(s.has(o.src)){var a={width:this._model.timeScale().width(),height:this._source.priceScale().height(),color:t[o.labelIds[0]].value(),linewidth:i[o.labelIds[0]].value(),linestyle:v,y:o.y,left:o.x1,right:o.x2},l=new g;if(l.setData(a),l.setHitTest(new h(h.REGULAR)),e.append(l),this._source.properties().levelsStyle.showLabels.value()){var c=function(e){return this._source.getCache(e)}.bind(this);e.append(new m(c,new r(o.x1,o.y),o.label))}}}return e}}t.study_PivotPointsStandard=class extends a{constructor(e,t,i,s){super(e,t,i,s);for(var r=["P","S1/R1","S2/R2","S3/R3","S4/R4","S5/R5"],n=this.properties().levelsStyle.visibility,o=0;o<r.length;o++)n[r[o]].listeners().subscribe(this,this.processHibernate);this._cacheDrawParams=null,this._cache=null}indexes(){return this._indexes}getCache(e){return this.createCacheIfRequred(e),this._cache}createCacheIfRequred(e){if(null===this._cache||null==this._cacheDrawParams||!u(e,this._cacheDrawParams)){this._cache&&this._cache.destroy();var t=this._getActualCacheParams();this._cache=new p(e,t.font,t.fontSize,t.backColors),this._cache.setPrices(this._pricesView.prices()),this._cacheDrawParams=e,this._cacheInvalidated=!1,this._cache.reset(t),this._cache.setPrices(this._pricesView.prices())}}lastValueData(e,t,i){var s=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5"].indexOf(e.toUpperCase()),r=this._pricesView.prices()[s];return null!=r?r:{noData:!0}}priceLabelText(e){return this._metaInfo.shortDescription+":"+e.toUpperCase()}pricesView(){return this._pricesView}_getActualCacheParams(){var e={};return e.font=f.CHART_FONT_FAMILY,e.fontSize=this.properties().fontsize.value(),
e.backColors=[this.properties().levelsStyle.colors.P.value(),this.properties().levelsStyle.colors["S1/R1"].value(),this.properties().levelsStyle.colors["S1/R1"].value(),this.properties().levelsStyle.colors["S2/R2"].value(),this.properties().levelsStyle.colors["S2/R2"].value(),this.properties().levelsStyle.colors["S3/R3"].value(),this.properties().levelsStyle.colors["S3/R3"].value(),this.properties().levelsStyle.colors["S4/R4"].value(),this.properties().levelsStyle.colors["S4/R4"].value(),this.properties().levelsStyle.colors["S5/R5"].value(),this.properties().levelsStyle.colors["S5/R5"].value()],e}updateAllViews(){super.updateAllViews(),this._pricesView.update()}_createViews(){this._cache&&(this._cache.destroy(),this._cache=null),this._priceAxisViews=[];var e=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5"];this._paneViews.length=0,this._labelPaneViews=[];var t=new S(this._model,this);t.setCache(this._cache),this._paneViews.push(t),this._mainPaneView=t;for(var i=0;i<e.length;i++){var s=new l(this,{name:e[i],cache:this._cache});this._priceAxisViews.push(s),this._labelPaneViews.push(new c(s,this,this._model))}this._dataWindowView||(this._dataWindowView=new o(this,this._model)),this._statusView||(this._statusView=new n(this,this._model.properties().scalesProperties.textColor)),this._legendView=null,this._pricesView=new _(this)}visiblePivots(){return this._pricesView.visiblePivots()}_postProcessGraphics(){}isVisible(){if(!this.properties().visible.value()||!this.isActualInterval())return!1;for(var e=["P","S1/R1","S2/R2","S3/R3","S4/R4","S5/R5"],t=this.properties().levelsStyle.visibility,i=0;i<e.length;i++)if(t[e[i]].value())return!0;return!1}stop(){super.stop(),this._cache&&(this._cache.destroy(),this._cache=null)}priceRange(e,t){if(!this.customData()||!this.customData().pivots||!this._indexes)return null;if(!this.priceScale())return null;for(var i=this.customData().pivots,r=this._indexes,n=null,o=0;o<i.length;o++)if(i[o]){var a=r[i[o].startIndex];if(!(r[i[o].endIndex]<e||a>t)){var l=[],c=this._properties.levelsStyle.visibility;c.P.value()&&l.push(i[o].p),c["S1/R1"].value()&&l.push(i[o].s1,i[o].r1),c["S2/R2"].value()&&l.push(i[o].s2,i[o].r2),c["S3/R3"].value()&&l.push(i[o].s3,i[o].r3),c["S4/R4"].value()&&l.push(i[o].s4,i[o].r4),c["S5/R5"].value()&&l.push(i[o].s5,i[o].r5);for(var h=0;h<l.length;h++)l[h]&&(null===n?n=new s(l[h],l[h]):n.apply(l[h],l[h]))}}return this.priceScale().isLog()&&n?new s(this.priceScale().priceToLogical(n.minValue()),this.priceScale().priceToLogical(n.maxValue())):n}}},729261:(e,t,i)=>{"use strict";function s(e){e.lineWidth=void 0,e.lineStyle=void 0;for(let t=0;t<e.colors.length;t++)e.colors[t]=void 0;return e}function r(){return{colors:[void 0,void 0,void 0,void 0,void 0,void 0,void 0],lineWidth:void 0,lineStyle:void 0}}i.d(t,{clearStyle:()=>s,createEmptyStyle:()=>r})},933465:(e,t,i)=>{"use strict";i.d(t,{PaneRendererColumns:()=>r});var s=i(777277);class r{constructor(e){this._data=null,this._precalculatedCache=[],this.setData(e)}setData(e){this._data=e,this._precalculatedCache=[]}draw(e,t){
var i,s,r,n;if(null===this._data||0===this._data.items.length)return;const o=t.pixelRatio;this._precalculatedCache.length||this._fillPrecalculatedCache(o);const a=Math.max(1,Math.floor(o)),l=Math.round(this._data.histogramBase*o)-Math.floor(a/2),c=l+a,h=this._data.lineColor,d=null!==(s=null===(i=this._data.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==s?s:0,u=(null!==(n=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==n?n:this._data.items.length)-1;for(let t=d;t<=u;t++){const i=this._data.items[t],s=this._precalculatedCache[t-d],r=Math.round(i.y*o),n=i.style?i.style.color:h;let u,p;e.fillStyle=n,r<=l?(u=r,p=c):(u=l,p=r-Math.floor(a/2)+a),e.fillRect(s.left,u,s.right-s.left+1,p-u)}}hitTest(e){var t,i,r,n;if(null===this._data)return null;const o=.5*this._data.barSpacing,a=e.x-o,l=e.x+o,c=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,h=(null!==(n=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==n?n:this._data.items.length)-1;for(let t=c;t<=h;t++){const i=this._data.items[t],r=i.x;if(r>=a&&r<=l){const t=i.y;if(e.y>=Math.min(t,this._data.histogramBase)&&e.y<=Math.max(t,this._data.histogramBase))return new s.HitTestResult(s.HitTestResult.REGULAR)}}return null}_fillPrecalculatedCache(e){var t,i,s,r;if(null===this._data||0===this._data.items.length)return void(this._precalculatedCache=[]);const n=Math.ceil(this._data.barSpacing*e)<=1?0:Math.max(1,Math.floor(e)),o=Math.round(this._data.barSpacing*e)-n,a=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,l=(null!==(r=null===(s=this._data.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==r?r:this._data.items.length)-1,c=l-a+1;if(c<=0)return void(this._precalculatedCache=[]);this._precalculatedCache=new Array(c);for(let t=a;t<=l;t++){const i=this._data.items[t],s=Math.round(i.x*e);let r,n;if(o%2){const e=(o-1)/2;r=s-e,n=s+e}else{const e=o/2;r=s-e,n=s+e-1}this._precalculatedCache[t-a]={left:r,right:n,roundedCenter:s,center:i.x*e,time:i.timePointIndex}}for(let e=a+1;e<=l;e++){const t=this._precalculatedCache[e-a],i=this._precalculatedCache[e-a-1];t.time===i.time+1&&(t.left-i.right!==n+1&&(i.roundedCenter>i.center?i.right=t.left-n-1:t.left=i.right+n+1))}let h=Math.ceil(this._data.barSpacing*e);for(let e=a+1;e<=l;e++){const t=this._precalculatedCache[e-a];t.right<t.left&&(t.right=t.left);const i=t.right-t.left+1;h=Math.min(i,h)}if(n>0&&h<4)for(let e=a+1;e<=l;e++){const t=this._precalculatedCache[e-a];t.right-t.left+1>h&&(t.roundedCenter>t.center?t.right-=1:t.left+=1)}}}},40371:(e,t,i)=>{"use strict";i.d(t,{StudyPlotPaneView:()=>V});var s=i(650151),r=i(86441),n=i(724377),o=i(484727),a=i(218954),l=i(486028),c=i(602564),h=i(872580),d=i(810251),u=i(777277),p=i(329776),_=i(385824),m=i(507967),g=i(270349),f=i(773423),v=i(815553),S=i(729261),y=i(918922),b=i(601227);class w{constructor(e){this._data=e}draw(e,t){var i,s,r,n
;const o=this._data,a=t.pixelRatio,c=Math.max(1,Math.floor(a))%2?.5:0,h=o.vertOffset||0,d=o.lineColor||o.color,u=o.lineWidth||o.height/2;let p="",_=!1;const m=null!==(s=null===(i=o.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==s?s:0,g=null!==(n=null===(r=o.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==n?n:o.items.length;for(let t=m;t<g;t++){const i=o.items[t],s=i.x,r=i.y+h;if((0,l.isNaN)(s)||(0,l.isNaN)(r))continue;let n,m;null!=i.style?(n=i.style.color,m=i.style.width):(n=d,m=u),(n!==p||b.isSafari)&&(p=n,_&&e.fill(),e.beginPath(),e.fillStyle=n);const g=Math.round(s*a)+c,f=Math.round(r*a)+c,v=Math.round(m*a)+c;e.moveTo(g+v,f),e.arc(g,f,v,0,2*Math.PI,!1),_=!0}_&&e.fill()}hitTest(e){var t,i,s,n;const o=this._data,a=o.lineWidth||o.height/2,l=o.vertOffset||0,c=(0,y.interactionTolerance)().series+a,h=null!==(i=null===(t=o.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,d=null!==(n=null===(s=o.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==n?n:o.items.length;for(let t=h;t<d;t++){const i=o.items[t];if(new r.Point(i.x,i.y+l).subtract(e).length()+a<=c)return new u.HitTestResult(u.HitTestResult.REGULAR)}return null}}var P=i(933465),C=i(204652);class T{constructor(e){this._data=e}draw(e,t){var i,s,r,n,o,a,c,h;const d=t.pixelRatio;let u="",p=!1;const _=null!==(s=null===(i=this._data.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==s?s:0,m=(null!==(n=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==n?n:this._data.items.length)-1;for(let t=_;t<=m;t++){const i=this._data.items[t];if((0,l.isNaN)(i.x)||(0,l.isNaN)(i.y))continue;const s=null!==(a=null===(o=i.style)||void 0===o?void 0:o.color)&&void 0!==a?a:this._data.lineColor,r=Math.max(1,Math.floor((null!==(h=null===(c=i.style)||void 0===c?void 0:c.width)&&void 0!==h?h:this._data.lineWidth)*d));(s!==u||b.isSafari)&&(u=s,p&&e.fill(),e.beginPath(),e.fillStyle=s);let n=3*r;n%2!=r%2&&(n+=1);const _=Math.round(Math.round(i.x*d)-n/2),m=Math.round(Math.round(i.y*d)-n/2),g=_+Math.floor(n/2-r/2),f=m+Math.floor(n/2-r/2);e.rect(_,f,n,r),e.rect(g,m,r,n),p=!0}p&&e.fill()}hitTest(e){const t=(0,y.interactionTolerance)().series+this._data.lineWidth/2;let i,s,n,o;for(let a=1;a<this._data.items.length;++a){i=this._data.items[a-1],s=this._data.items[a],n=i.x,o=s.x;if((0,C.distanceToSegment)(new r.Point(n,i.y),new r.Point(o,s.y),new r.Point(e.x,e.y)).distance<=t)return new u.HitTestResult(u.HitTestResult.REGULAR)}return null}}class x{constructor(e){this._data=e}draw(e,t){var i,s,r,n;if(0===this._data.items.length)return;const o=t.pixelRatio;e.fillStyle=this._data.lineColor;const a=Math.max(1,Math.floor(this._data.lineWidth*o)),l=a/2,c=Math.max(1,Math.floor(o)),h=Math.round(this._data.histogramBase*o)-Math.floor(c/2),d=h+c,u=null!==(s=null===(i=this._data.visibleItemsRange)||void 0===i?void 0:i.startItemIndex)&&void 0!==s?s:0,p=(null!==(n=null===(r=this._data.visibleItemsRange)||void 0===r?void 0:r.endItemIndex)&&void 0!==n?n:this._data.items.length)-1
;for(let t=u;t<=p;t++){const i=this._data.items[t];let s=a,r=l;i.style?(e.fillStyle=i.style.color,s=Math.max(1,Math.floor(i.style.width*o)),r=s/2):e.fillStyle=this._data.lineColor;const n=s%2?.5:0,u=Math.round(i.x*o)+n,p=Math.round(i.y*o);let _,m;p<=h?(_=p,m=d):(_=h,m=p-Math.floor(c/2)+c),e.fillRect(Math.floor(u-r),_,s,m-_)}}hitTest(e){const t=(0,y.interactionTolerance)().series+this._data.lineWidth/2,i=new Map;for(const n of this._data.items){const o=n.x,a=n.y;let l=t;n.style&&(i.has(n.style.width)?l=(0,s.ensureDefined)(i.get(n.style.width)):i.set(this._data.lineWidth,l));if((0,C.distanceToSegment)(new r.Point(o,a),new r.Point(o,this._data.histogramBase),new r.Point(e.x,e.y)).distance<=l)return new u.HitTestResult(u.HitTestResult.REGULAR)}return null}}var I=i(444649),M=i(691826),L=i(624595),A=i(153026);const k=e=>{const t=(0,n.rgbToHsl)((0,n.parseRgb)(e)),i=t[0]+.05;return t[0]=i-Math.floor(i),(0,n.rgbToHexString)((0,n.hslToRgb)(t))},E=(0,d.memoize)(k);function D(e,t){if(null===e)return t;const i=e.firstIndex,s=t.firstIndex,r=e.clearData||t.clearData;return{firstIndex:r||void 0===i||void 0===s?void 0:Math.min(i,s),clearData:r}}const B=new Set([I.LineStudyPlotStyle.Line,I.LineStudyPlotStyle.Area,I.LineStudyPlotStyle.Circles,I.LineStudyPlotStyle.Cross,I.LineStudyPlotStyle.StepLine,I.LineStudyPlotStyle.StepLineWithDiamonds]);class V{constructor(e,t,i,s,r=!1){this._histogramBase=null,this._items=[],this._lastConfirmedSeriesBarCoordinate=NaN,this._selectionData=null,this._lineColor="",this._lineWidth=1,this._color1="",this._color2="",this._dataInvalidated=null,this._viewportInvalidated=!1,this._renderer=new _.CompositeRenderer,this._isMarkersEnabled=o.enabled("source_selection_markers"),this._study=e,this._series=t,this._model=i,this._plotName=s,this._plotIndex=e.metaInfo().plots.findIndex((e=>e.id===s)),this._colorProvider=(0,M.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._selectionIndexer=new f.SelectionIndexes(i.timeScale()),this._extendStepLineToBarsEndings=r,this._useFirstUnplottableRow=!1}items(){return this._items}update(e){if("global-change"===e.type)return this._dataInvalidated=D(this._dataInvalidated,{}),void(this._viewportInvalidated=!0);if("data-source-change"!==e.type)this._viewportInvalidated=!0;else{if(e.sourceId===this._study.id()){const t=D(this._dataInvalidated,{firstIndex:e.firstUpdatedTimePointIndex,clearData:e.clearData});this._dataInvalidated=t}}}renderer(){return this._dataInvalidated?this._updateImplFull(this._viewportInvalidated)&&(this._dataInvalidated=null):this._viewportInvalidated&&this._updateImplLight(),this._viewportInvalidated=!1,this._renderer}_getTranspValue(){const e=this._study.properties(),t=e.styles[this._plotName];let i=0;const s=this._study.metaInfo();return"Volume@tv-basicstudies"===s.id&&s.version<=46&&"transparency"in e?(i=e.transparency.value(),i=(0,l.isNumber)(i)?i:0,i):(t.transparency&&(i=t.transparency.value(),i=(0,l.isNumber)(i)?i:0),i)}_updateImplFull(e){var t,i,n,o;if(this._renderer.clear(),
(null===(t=this._dataInvalidated)||void 0===t?void 0:t.clearData)&&(this._items=[]),!this._study.isPlotVisibleAt(this._plotName,1))return!1;if(!this._study.priceScale())return!1;const l=this._study.firstValue();if(null===l)return!1;const h=this._study.priceScale();if(null===h)return!1;this._histogramBase=null;const d=this._study.properties().styles[this._plotName],u=d.plottype.value(),p=this._useFirstUnplottableRow&&(u===I.LineStudyPlotStyle.StepLine||u===I.LineStudyPlotStyle.StepLineWithDiamonds),_=this._study.data().plottableRange(p),m=_.size();if(0===m)return!1;const g=this._study.offset(this._plotName);let f=null===(i=this._dataInvalidated)||void 0===i?void 0:i.firstIndex;const v=B.has(u);if(m!==this._items.length){const e=void 0!==f?f+g:void 0;if(void 0===e||0===this._items.length||e<(0,s.ensureDefined)(this._items[0].timePointIndex))this._items=[],_.each(((e,t)=>{const i=t[this._plotIndex+1];if(v&&null==i)return!1;const s=new r.Point(NaN,NaN);return s.origPrices=new r.Point(NaN,NaN),s.timePointIndex=e+g,this._items.push(s),!1})),f=this._items.length?(0,s.ensureDefined)(this._items[0].timePointIndex)-g:void 0;else{const e=this._items[this._items.length-1].timePointIndex,t=(0,s.ensureDefined)(e)-g,i=(0,s.ensureNotNull)(_.lastIndex())+1,n=_.rangeIterator(t+1,i);for(;n.hasNext();){const e=n.next(),t=e.value[this._plotIndex+1],i=null==t;if(v&&i)continue;const s=new r.Point(NaN,NaN);s.origPrices=new r.Point(NaN,NaN),s.timePointIndex=e.index+g,this._items.push(s)}}}let y=NaN,b=NaN;const w=new Map,P=(e,t)=>{let i=w.get(e);void 0===i&&(i=new Map,w.set(e,i));let s=i.get(t);if(void 0===s){const r=!this._plotName||"vol"!==this._plotName;s=(0,c.generateColor)(e,t,r),i.set(t,s)}return s},C=(0,S.createEmptyStyle)(),T=(0,a.clamp)(this._getTranspValue(),0,100),x=this._model.timeScale().visibleBarsStrictRange();if(null===x)return!1;const{startBar:M,endBar:A}=this._calculateStartEnd(x);if(null===M||null===A||0===this._items.length)return!1;const k=null!=f?f:(0,s.ensureNotNull)(_.firstIndex()),E=_.rangeIterator(k,(0,s.ensureNotNull)(_.lastIndex())+1),D=(0,L.lowerbound)(this._items,k+g,((e,t)=>e.timePointIndex<t));let V=D;for(;E.hasNext();){const e=E.next();let t=e.index;const i=e.value;t+=g,t=Math.floor(t);let a=i[this._plotIndex+1];const l=null==a;if(a=l?NaN:a,v&&l){b=a;continue}const h=new r.Point(t,(0,s.ensure)(a));h.timePointIndex=t,h.valIsNotSameAsPrev=a!==b||t-1!==y;if(this._colorProvider.isColorDefined()&&(h.style={color:P(d.color.value(),100),width:d.linewidth.value(),style:d.linestyle.value()},null!=a)){const e=this._colorProvider.getPlotPointStyle(i,C),t=e.colors[0];void 0!==t&&(h.style.color=(0,c.isHexColor)(t)?P(t,T):t),h.style.width=null!==(n=e.lineWidth)&&void 0!==n?n:h.style.width,h.style.style=null!==(o=e.lineStyle)&&void 0!==o?o:h.style.style}if(!v&&!isNaN(y)&&y!==t-1&&V>0){const e=this._items[V-1].timePointIndex,i=new r.Point(t-1,NaN);i.origPrices=new r.Point(t-1,NaN),i.timePointIndex=e,V<this._items.length?this._items[V]=i:this._items.push(i),V++}y=t,b=a;{const e=h;e.origPrices=new r.Point(h.x,h.y),
V<this._items.length?this._items[V]=e:this._items.push(e),V++}}if(this._items.length){const t=this._model.mainSeries().data().bars().lastIndex();null!==t&&(this._lastConfirmedSeriesBarCoordinate=this._model.timeScale().indexToCoordinate(t));const i=Math.max(0,(0,L.lowerbound)(this._items,M,((e,t)=>e.timePointIndex<t))),s=Math.min(this._items.length,(0,L.upperbound)(this._items,A,((e,t)=>e<t.timePointIndex))),r=e?i:Math.max(i,D),n=s;for(let e=r;e<n;e++){const t=this._items[e];t.x=t.origPrices.x,t.y=t.origPrices.y}h.pointsArrayToCoordinates(this._items,l,{startItemIndex:r,endItemIndex:n}),this._model.timeScale().timedValuesToCoordinates(this._items,{startItemIndex:r,endItemIndex:n},!0),d.histogramBase&&(this._histogramBase=h.priceToCoordinate(d.histogramBase.value(),l)),this._createSelection(l),this._createRenderer(i,s)}return!0}_updateImplLight(){const e=this._study.firstValue();if(null===e)return this._selectionData=null,void this._createRenderer(0,-1);const t=this._study.priceScale();if(null===t)return this._selectionData=null,void this._createRenderer(0,-1);const i=this._model.timeScale().visibleBarsStrictRange();if(null===i)return this._selectionData=null,void this._createRenderer(0,-1);const{startBar:s,endBar:r}=this._calculateStartEnd(i);if(null===s||null===r||0===this._items.length)return this._selectionData=null,void this._createRenderer(0,-1);const n=Math.max(0,(0,L.lowerbound)(this._items,s,((e,t)=>e.timePointIndex<t))),o=Math.min(this._items.length,(0,L.upperbound)(this._items,r,((e,t)=>e<t.timePointIndex)));for(let e=n;e<o;e++){const t=this._items[e];t.x=t.origPrices.x,t.y=t.origPrices.y}t.pointsArrayToCoordinates(this._items,e,{startItemIndex:n,endItemIndex:o}),this._model.timeScale().timedValuesToCoordinates(this._items,{startItemIndex:n,endItemIndex:o},!0);const a=this._study.properties().styles[this._plotName];a.histogramBase&&(this._histogramBase=t.priceToCoordinate(a.histogramBase.value(),e)),this._createSelection(e);const l=this._model.mainSeries().data().bars().lastIndex();null!==l&&(this._lastConfirmedSeriesBarCoordinate=this._model.timeScale().indexToCoordinate(l)),this._createRenderer(n,o)}_calculateStartEnd(e){const t=this._study.offset(this._plotName);let i=e.firstBar()-Math.abs(t)-1,s=e.lastBar()+Math.abs(t)+1;const r=this._study.data(),n=r.search(i,A.PlotRowSearchMode.NearestLeft,this._plotIndex+1),o=r.search(s,A.PlotRowSearchMode.NearestRight,this._plotIndex+1);null!==n&&(i=n.index),null!==o&&(s=o.index);const a=this._study.getMinFirstBarIndexForPlot(this._plotName)+t;return a>s+1?{startBar:null,endBar:null}:(i=Math.max(a,i),{startBar:i,endBar:s})}_createRenderer(e,t){var i;this._renderer.clear();const r=this._study.properties().styles[this._plotName],n=(0,a.clamp)(this._getTranspValue(),0,100);this._lineColor=(0,c.generateColor)(r.color.value(),n),this._lineWidth=r.linewidth.value();let o=r.color.value();const d=this._colorProvider.getDefaultPlotPointStyle();d&&(o=d.colors[0],this._lineWidth=null!==(i=d.lineWidth)&&void 0!==i?i:this._lineWidth,this._lineColor=o?(0,
c.generateColor)(o,n):this._lineColor),this._color2=(0,c.generateColor)(o,n);const u=this._study.metaInfo().isRGB?k(o):E(o);this._color1=(0,c.generateColor)(u,n);const _={};_.barSpacing=this._model.timeScale().barSpacing(),_.items=this._items,_.histogramBase=this._histogramBase?this._histogramBase:(0,s.ensureNotNull)(this._study.priceScale()).height(),_.lineIndex=0,_.lineStyle=r.linestyle.value(),_.lineColor=this._lineColor,_.lineWidth=this._lineWidth,_.lineWidth=(0,l.isNumber)(_.lineWidth)?_.lineWidth:1,_.color1=this._color1,_.color2=this._color2,_.bottom=_.histogramBase,_.visibleItemsRange={startItemIndex:e,endItemIndex:t},_.lastConfirmedSeriesBarCoordinate=this._lastConfirmedSeriesBarCoordinate,_.simpleMode=this._colorProvider.singleColor();const f=this._renderer,S=!!r.joinPoints&&r.joinPoints.value();switch(r.plottype.value()){case I.LineStudyPlotStyle.Line:case I.LineStudyPlotStyle.LineWithBreaks:f.append(new m.PaneRendererLine(_));break;case I.LineStudyPlotStyle.Area:case I.LineStudyPlotStyle.AreaWithBreaks:f.append(new p.PaneRendererArea(_));break;case I.LineStudyPlotStyle.Histogram:f.append(new x(_));break;case I.LineStudyPlotStyle.Columns:f.append(new P.PaneRendererColumns(_));break;case I.LineStudyPlotStyle.Cross:if(f.append(new T(_)),S){const e=(0,h.deepCopy)(_);e.lineWidth=1,e.forceLineWidth=!0,f.append(new m.PaneRendererLine(e))}break;case I.LineStudyPlotStyle.Circles:if(f.append(new w(_)),S){const e=(0,h.deepCopy)(_);e.lineWidth=1,e.ignorePaletteLineWidth=!0,f.append(new m.PaneRendererLine(e))}break;case I.LineStudyPlotStyle.StepLine:case I.LineStudyPlotStyle.StepLineWithBreaks:case I.LineStudyPlotStyle.StepLineWithDiamonds:{_.decoration=r.plottype.value()===I.LineStudyPlotStyle.StepLineWithDiamonds?g.StepLineDecoration.Diamonds:g.StepLineDecoration.None,_.extendToBarsEndings=this._extendStepLineToBarsEndings;const e=new g.PaneRendererStepLine(void 0,!1);e.setData(_),f.append(e);break}default:f.append(new m.PaneRendererLine(_))}this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&this._selectionData&&f.append(new v.SelectionRenderer(this._selectionData))}_createSelection(e){const t=this._study.priceScale();if(null!==t)if(this._model.selection().isSelected(this._study)){const i=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,hittestResult:u.HitTestResult.REGULAR,barSpacing:this._model.timeScale().barSpacing()};const n=(0,s.ensureNotNull)(this._model.paneForSource(this._study)).height(),o=this._study.offset(this._plotName);for(let s=0;s<i.length;s++){let a=i[s];const l=this._study.data().valueAt(a);if(a+=o,null===l)continue;const c=l[this._plotIndex+1];if(null==c)continue;const h=this._model.timeScale().indexToCoordinate(Math.floor(a)),d=t.priceToCoordinate(c,e);this._selectionData.points.push(new r.Point(h,d)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(d/n))}}else this._selectionIndexer.clear()}}},691826:(e,t,i)=>{"use strict";i.d(t,{createStudyPlotColorProvider:()=>p});var s=i(444649),r=i(650151),n=i(729261)
;const o=new Map([[0,"color"],[2,"textColor"],[3,"borderColor"],[4,"wickColor"],[5,"colorup"],[6,"colordown"]]);class a{constructor(e){this._plotStyle=e}getPlotPointStyle(e,t){const i=t?(0,n.clearStyle)(t):(0,n.createEmptyStyle)();return o.forEach(((e,t)=>{this._plotStyle[e]&&(i.colors[t]=this._plotStyle[e].value())})),i.lineWidth=this._plotStyle.linewidth?this._plotStyle.linewidth.value():void 0,i.lineStyle=this._plotStyle.linestyle?this._plotStyle.linestyle.value():void 0,i}isColorDefined(){return!0}singleColor(){return!0}getDefaultPlotPointStyle(){return null}}const l=[0,1,2,3,4,5,6];class c{constructor(e,t,i,s){this._palettesColors=new Map,this._defaultPlotColors=new Map,this._indexes=s;const n=t.styles[i];if(n)for(const[e,t]of o)this._defaultPlotColors.set(e,n[t]);const a=(0,r.ensureDefined)(e.palettes),l=e.plots;s.forEach(((e,i)=>{const s=l[e];if(s&&"palette"in s){const e=a[s.palette],r=t.palettes[s.palette];if(e&&r){const{valToIndex:t}=e,{colors:s}=r,n={...s};t&&Object.keys(t).forEach((e=>{const i=t[e];void 0!==i&&(n[e]=s[i])})),this._palettesColors.set(i,n)}}}))}getPlotPointStyle(e,t){const i=t?(0,n.clearStyle)(t):(0,n.createEmptyStyle)();return l.forEach((t=>{var s,n;if(this._palettesColors.has(t)){const n=e[(0,r.ensureDefined)(this._indexes.get(t))+1];if("number"==typeof n){const e=null===(s=this._palettesColors.get(t))||void 0===s?void 0:s[n];0===t&&e&&(i.lineWidth=e.width.value(),i.lineStyle=e.style.value()),i.colors[t]=null==e?void 0:e.color.value()}else i.colors[t]="transparent"}else i.colors[t]=null===(n=this._defaultPlotColors.get(t))||void 0===n?void 0:n.value()})),i}getDefaultPlotPointStyle(){var e;const t=null===(e=this._palettesColors.get(0))||void 0===e?void 0:e[0];if(void 0!==t){return{colors:[t.color.value(),void 0,void 0,void 0,void 0,void 0,void 0],lineStyle:void 0,lineWidth:t.width.value()}}return null}isColorDefined(){return!!this._palettesColors.size}singleColor(){return!1}}var h=i(602564);class d{constructor(e){this._indexes=e}getPlotPointStyle(e,t){const i=t?(0,n.clearStyle)(t):(0,n.createEmptyStyle)();return this._indexes.forEach(((t,s)=>{const r=e[t+1];if(null!=r){const e=(0,h.rgbaFromInteger)(r);i.colors[s]=e}else i.colors[s]="transparent"})),i}isColorDefined(){return!0}singleColor(){return!1}getDefaultPlotPointStyle(){return null}}const u=new Map([[0,function(e,t){const i=(0,s.isColorerPlot)(t)||(0,s.isOhlcColorerPlot)(t);return"target"in t&&t.target===e&&i}],[2,function(e,t){const i=(0,s.isTextColorerPlot)(t);return"target"in t&&t.target===e&&i}],[1,function(e,t){return(0,s.isBgColorerPlot)(t)&&t.id===e}],[3,function(e,t){const i=(0,s.isCandleBorderColorerPlot)(t);return"target"in t&&t.target===e&&i}],[4,function(e,t){const i=(0,s.isCandleWickColorerPlot)(t);return"target"in t&&t.target===e&&i}],[5,function(e,t){const i=(0,s.isUpColorerPlot)(t);return"target"in t&&t.target===e&&i}],[6,function(e,t){const i=(0,s.isDownColorerPlot)(t);return"target"in t&&t.target===e&&i}]]);function p(e,t,i){const{colorers:s}=function(e,t){const i=e.plots,s=i.findIndex((e=>e.id===t)),r=new Map
;return i.forEach(((e,i)=>{u.forEach(((s,n)=>{s(t,e)&&r.set(n,i)}))})),{plotIndex:-1===s?null:s,colorers:r}}(e,i);if(s.size)return e.isRGB?new d(s):new c(e,t,i,s);{const e=t.ohlcPlots;if(e&&e[i])return new a(e[i]);const s=t.styles[i];return new a(s)}}},444649:(e,t,i)=>{"use strict";var s,r,n;function o(e){return"line"===e.type}function a(e){return"shapes"===e.type}function l(e){return"chars"===e.type}function c(e){return"arrows"===e.type}function h(e){return"data"===e.type}function d(e){return"dataoffset"===e.type}function u(e){return"ohlc_open"===e.type}function p(e){return"ohlc_high"===e.type}function _(e){return"ohlc_low"===e.type}function m(e){return"ohlc_close"===e.type}function g(e){return u(e)||p(e)||_(e)||m(e)}function f(e){return"colorer"===e.type&&"palette"in e}function v(e){return"colorer"===e.type&&!("palette"in e)}function S(e){return"colorer"===e.type}function y(e){return"bar_colorer"===e.type}function b(e){return"bg_colorer"===e.type}function w(e){return"text_colorer"===e.type}function P(e){return"ohlc_colorer"===e.type}function C(e){return"wick_colorer"===e.type}function T(e){return"border_colorer"===e.type}function x(e){return"up_colorer"===e.type}function I(e){return"down_colorer"===e.type}function M(e){return"alertcondition"===e.type}function L(e){return o(e)||a(e)||l(e)||c(e)}function A(e){return"Plot"!==e}function k(e){return"ohlc_bars"===e.plottype}function E(e){return"ohlc_candles"===e.plottype}function D(e){return S(e)||y(e)||b(e)||h(e)||d(e)||P(e)||M(e)||x(e)||I(e)||T(e)||C(e)||w(e)}function B(e){return S(e)||w(e)||y(e)||h(e)||d(e)||P(e)||C(e)||T(e)||x(e)||I(e)||M(e)}i.r(t),i.d(t,{LineStudyPlotStyle:()=>s,STUDYPLOTDISPLAYTARGET:()=>r,isLinePlot:()=>o,isShapesPlot:()=>a,isCharsPlot:()=>l,isArrowsPlot:()=>c,isDataPlot:()=>h,isDataOffsetPlot:()=>d,isOhlcOpenPlot:()=>u,isOhlcHighPlot:()=>p,isOhlcLowPlot:()=>_,isOhlcClosePlot:()=>m,isOhlcPlot:()=>g,isPaletteColorerPlot:()=>f,isRgbaColorerPlot:()=>v,isColorerPlot:()=>S,isBarColorerPlot:()=>y,isBgColorerPlot:()=>b,isTextColorerPlot:()=>w,isOhlcColorerPlot:()=>P,isCandleWickColorerPlot:()=>C,isCandleBorderColorerPlot:()=>T,isUpColorerPlot:()=>x,isDownColorerPlot:()=>I,isAlertConditionPlot:()=>M,isPlotSupportDisplay:()=>L,isPlotTitleDefined:()=>A,isOhlcPlotStyleBars:()=>k,isOhlcPlotStyleCandles:()=>E,PlotSymbolSize:()=>n,isPlotWithTechnicalValues:()=>D,isNonVisualPlot:()=>B}),function(e){e[e.Line=0]="Line",e[e.Histogram=1]="Histogram",e[e.Cross=3]="Cross",e[e.Area=4]="Area",e[e.Columns=5]="Columns",e[e.Circles=6]="Circles",e[e.LineWithBreaks=7]="LineWithBreaks",e[e.AreaWithBreaks=8]="AreaWithBreaks",e[e.StepLine=9]="StepLine",e[e.StepLineWithDiamonds=10]="StepLineWithDiamonds",e[e.StepLineWithBreaks=11]="StepLineWithBreaks"}(s||(s={})),function(e){e[e.None=0]="None",e[e.Pane=1]="Pane",e[e.DataWindow=2]="DataWindow",e[e.PriceScale=4]="PriceScale",e[e.StatusLine=8]="StatusLine",e[e.All=15]="All"}(r||(r={})),function(e){e.Auto="auto",e.Tiny="tiny",e.Small="small",e.Normal="normal",e.Large="large",e.Huge="huge"}(n||(n={}))},663890:(e,t,i)=>{"use strict"
;i.r(t),i.d(t,{createStudy:()=>F,isESDStudy:()=>N,isFundamentalStudy:()=>R,isRollDatesStudy:()=>O,isStudy:()=>D,isStudyStrategy:()=>B,isStudyStub:()=>V,studyColorRotationMode:()=>W,useSameColorRotationComparator:()=>H});var s=i(484727),r=i(898005),n=i(793159),o=i(118309),a=i(675786),l=i(57730),c=i(577260),h=i(665851),d=i(650151),u=i(509806);const p=s.enabled("hide_main_series_symbol_from_indicator_legend");class _ extends n.Study{constructor(e,t,i,s){super(e,t,i,s),(0,d.ensureDefined)(this.properties().childs().styles.childs().vol_ma).childs().display.subscribe(this,(()=>this.invalidateTitleCache()))}base(){return 1}destroy(){(0,d.ensureDefined)(this.properties().childs().styles.childs().vol_ma).childs().display.listeners().unsubscribeAll(this),super.destroy()}showOnTopOnHovering(){return!1}_titleInputs(){const e={symbolsForDisplay:!0,skipHiddenInputs:!0,fakeInputsForDisplay:!0,asObject:!1,skipOptionalEmptySymbolInputs:p};return 0!==(0,d.ensureDefined)(this.properties().childs().styles.childs().vol_ma).childs().display.value()?this.inputs(e):this.inputs({...e,skippedInputs:["length"]})}_titleInParts(e,t,i,s){const r=super._titleInParts(e,t,i,s),n=this._getVolumeUnit();return n&&(r[0]+=` · ${n}`),r}_getVolumeUnit(){const e=this.symbolSource().symbolInfo();if(e){switch(e.volume_type){case"base":return e.base_currency;case"quote":return e.original_currency_code||e.currency_code;case"tick":return u.t(null,void 0,i(130973))}}}}var m=i(210596),g=i.n(m),f=i(976704),v=i.n(f),S=i(632054),y=i(565601);class b extends n.Study{constructor(e,t,i,s){super(e,function(e){return e.hasChild("currencyId")||e.addChild("currencyId",new(v())(null)),e.hasChild("unitId")||e.addChild("unitId",new(v())(null)),e.addExclusion("currencyId"),e.addExclusion("unitId"),e}(t),i,s),this._isActingAsSymbolSource=new(g())(!1),this._symbolHibernated=new(g())(!1),this._symbolResolvingActive=new(g())(!1),this._realignToolsLastParams=null,this._onIsActingAsSymbolSourceChanged=()=>{this._realignLineToolsIfParamsChanged()},this._recalculateIsActingAsSymbolSource(),this._isActingAsSymbolSource.subscribe(this._onIsActingAsSymbolSourceChanged);const r=this.properties().childs().inputs.childs().symbol;this._previousSymbolInputValue=r.value()}destroy(){this._isActingAsSymbolSource.unsubscribe(this._onIsActingAsSymbolSourceChanged),super.destroy()}isActingAsSymbolSource(){return this._isActingAsSymbolSource.readonly()}properties(){return this._properties}symbol(){return this._isActingAsSymbolSource.value()?this.properties().childs().inputs.childs().symbol.value():this.symbolSource().symbol()}interval(){return this.model().mainSeries().interval()}style(){return this._firstSourceOrSeries().symbolSource().style()}currency(){return this._isActingAsSymbolSource.value()?this.properties().childs().currencyId.value()||null:this.symbolSource().currency()}unit(){return this._isActingAsSymbolSource.value()?this.properties().childs().unitId.value()||null:this.symbolSource().unit()}setSymbolParams(e){this._setSymbolParamsInternal(e)}setSymbol(e){this.setSymbolParams({symbol:e})}
symbolInfo(){if(!this._isActingAsSymbolSource.value())return super.symbolSource().symbolInfo();if(void 0===this._resolvedSymbols)return null;const e=this.symbol(),t=this._getSymbolForResolve(e);return this._resolvedSymbols[t]||null}symbolSource(){return this._isActingAsSymbolSource.value()?this:super.symbolSource()}symbolResolved(){return this.symbolsResolved()}symbolResolvingActive(){return this._symbolResolvingActive}symbolHibernated(){return this._symbolHibernated}isVisible(){const e=super.isVisible();return this._symbolHibernated.setValue(!e),e}symbolSameAsCurrent(e){return(0,y.symbolSameAsCurrent)(e,this.symbolInfo())}setCurrency(e){this.setSymbolParams({currency:e})}isConvertedToOtherCurrency(){return(0,S.isConvertedToOtherCurrency)(this.symbolInfo())}setUnit(e){this.setSymbolParams({unit:e})}isConvertedToOtherUnit(){return(0,S.isConvertedToOtherUnit)(this.symbolInfo(),this._model.unitConversionEnabled())}setInterval(e){}setStyle(e){}symbolTitle(e,t){return this.title(!0,{},!1,e)}measureUnitId(){return(0,S.measureUnitId)(this.symbolInfo())}bars(){return super.data()}dataUpdated(){return this._dataUpdated}_onPropertiesChanged(){this._recalculateIsActingAsSymbolSource(),super._onPropertiesChanged(),this._realignLineToolsIfParamsChanged()}_tryChangeInputs(){var e;const t=this._resolvedSymbolsByInput[this.symbol()]||null;(0,y.symbolSameAsCurrent)(this._previousSymbolInputValue,t)||this._setSymbolParamsInternal({currency:null,unit:null}),super._tryChangeInputs(),this._formatter=null,null===(e=this.priceScale())||void 0===e||e.updateFormatter(),this._previousSymbolInputValue=this.properties().childs().inputs.childs().symbol.value()}_getSymbolObject(e){const t={symbol:e},i=this.currency();null!==i&&(t["currency-id"]=i);const s=this.unit();return this._model.unitConversionEnabled()&&null!==s&&(t["unit-id"]=s),t}_getSymbolForApi(e){return(0,S.symbolForApi)(this._resolvedSymbolsByInput[e]||null,e)}_onSymbolResolved(e,t,i){super._onSymbolResolved(e,t,i),this._recreatePriceFormattingDependencies();const s=t===this.symbol()?(0,S.extractSymbolNameFromSymbolInfo)(i,this.symbol()):null;null!==s&&(this._previousSymbolInputValue=s);const r=(0,S.symbolCurrency)(i),n=(0,S.symbolUnit)(i,this._model.unitConversionEnabled());this._setSymbolParamsInternal({symbol:null!=s?s:void 0,currency:r,unit:n},i),this._symbolResolvingActive.setValue(!1)}_onSymbolResolvingStart(){super._onSymbolResolvingStart(),this._symbolResolvingActive.setValue(!0)}_onSymbolError(){super._onSymbolError(),this._symbolResolvingActive.setValue(!1)}_onCurrencyMayChange(){this.isActingAsSymbolSource()?super._onCurrencyMayChange():this._onCurrencyChanged()}_recalculateIsActingAsSymbolSource(){var e,t;const i=null!==(t=""!==(null===(e=this._currencySourceSymbolInputProperty)||void 0===e?void 0:e.value()))&&void 0!==t&&t;this._isActingAsSymbolSource.setValue(i)}_setSymbolParamsInternal(e,t){const{symbol:i,currency:s,unit:r}=e,n=this.properties().childs(),o=n.inputs.childs().symbol.value(),a=n.currencyId.value(),l=n.unitId.value()
;if(void 0!==i&&i!==o&&n.inputs.childs().symbol.setValueSilently(i),void 0!==s&&s!==a&&n.currencyId.setValueSilently(s),void 0!==r&&r!==l&&n.unitId.setValueSilently(r),t)this._resolvedSymbolsByInput[this.symbol()]=t,this._resolvedSymbols[this._getSymbolForResolve(this.symbol())]=t,this._realignToolsLastParams=null;else{const e=this.symbolInfo();null!==e&&(n.currencyId.setValueSilently((0,S.symbolCurrency)(e)),n.unitId.setValueSilently((0,S.symbolUnit)(e,this._model.unitConversionEnabled())))}n.inputs.childs().symbol.value()!==o&&n.inputs.childs().symbol.listeners().fire(n.inputs.childs().symbol),n.currencyId.value()!==a&&n.currencyId.listeners().fire(n.currencyId),n.unitId.value()!==l&&n.unitId.listeners().fire(n.unitId),this._realignLineToolsIfParamsChanged()}_realignLineToolsIfParamsChanged(){const e=this.symbol(),t=this.interval(),i=this.currency(),s=this.unit();null!==this._realignToolsLastParams&&this._realignToolsLastParams.symbol===e&&this._realignToolsLastParams.interval===t&&this._realignToolsLastParams.currency===i&&this._realignToolsLastParams.unit===s||(this._model.realignLineTools(this),this._realignToolsLastParams={symbol:e,interval:t,currency:i,unit:s})}}var w=i(786432);var P=i(672428),C=i(602564);class T extends P.PriceAxisView{constructor(e,t){super(),this._source=e,this._styleId=t}_updateRendererData(e,t,i){var s;e.visible=!1;const r=this._source.priceScale(),n=this._source.properties().childs();if(!r||r.isEmpty()||!n.visible.value())return;const o=null===(s=this._source.properties().childs().graphics.childs().horizlines)||void 0===s?void 0:s.childs()[this._styleId].childs();if(!(o&&o.visible&&o.visible.value()&&this._isLabelVisibleAccordinglyToProperties()))return;const a=this._source.model().timeScale().logicalRange(),l=this._source.firstValue();if(null===l||null===a)return;const c={price:NaN,time:-1/0},h=this._source.graphics().horizlines().get(this._styleId);if(void 0===h)return;for(const e of h){if(void 0===e.level)continue;const t=a.contains(e.startIndex,!0);t===a.contains(e.endIndex,!0)&&0!==t||c.time<e.endIndex&&(c.time=e.endIndex,c.price=e.level)}if(isNaN(c.price))return;const d=(0,C.resetTransparency)(o.color.value());i.background=d,i.textColor=this.generateTextColor(d),i.coordinate=r.priceToCoordinate(c.price,l),e.text=r.formatPrice(c.price,l,!0),e.visible=!0}_isLabelVisibleAccordinglyToProperties(){return!!this._source.model().properties().childs().scalesProperties.childs().showStudyLastValue.value()&&this._source.properties().childs().showLabelsOnPriceScale.value()}}var x=i(40371);class I extends n.Study{async _createGraphicsPaneViews(){var e;const t=this.metaInfo().graphics,s=this.model(),r=[],n=this._needExtendToBarsEnding();if(t.hhists){const{HHistPaneView:t}=await i.e(507).then(i.bind(i,179710)),o=null===(e=this.properties().childs().graphics.childs().polygons)||void 0===e?void 0:e.childs();r.push(new t(this,s,void 0,null==o?void 0:o.histBoxBg,n))}if(t.horizlines){const{HorizLinePaneView:e}=await i.e(507).then(i.bind(i,606029));r.push(new e(this,s,void 0,n))}return r}
_createGraphicsPriceAxisViews(){var e;return Object.keys(null!==(e=this.metaInfo().graphics.horizlines)&&void 0!==e?e:{}).map((e=>new T(this,e)))}_createStudyPlotPaneView(e){return new x.StudyPlotPaneView(this,this._series,this._model,e,this._needExtendToBarsEnding())}_apiInputs(){return{...super._apiInputs(),mapRightBoundaryToBarStartTime:!!this._needExtendToBarsEnding()||void 0}}_needExtendToBarsEnding(){var e;return void 0!==(null===(e=this.metaInfo().defaults.inputs)||void 0===e?void 0:e.mapRightBoundaryToBarStartTime)}}class M extends I{priceRange(e,t){let i=!1;this.graphics().hhists().forEach(((e,t)=>{var s;i=i||(0,d.ensureDefined)(null===(s=this.properties().childs().graphics.childs().hhists)||void 0===s?void 0:s.childs()[t]).value()}));const s=function(e,t,i,s){let r=null;return e.forEach(((e,s)=>{e.forEach((e=>{e.firstBarTime<=i&&e.lastBarTime>=t&&(null===r?r={low:{l:e.priceLow,h:e.priceHigh},high:{h:e.priceHigh}}:(e.priceLow<r.low.l&&(r.low.l=e.priceLow,r.low.h=e.priceHigh),r.high.h=Math.max(r.high.h,e.priceHigh)))}))})),null===r?null:s?new w.PriceRange(r.low.l-.8*(r.low.h-r.low.l),r.high.h):new w.PriceRange(r.low.l,r.high.h)}(this.graphics().hhists(),e,t,i);if(null===s)return null;const r=(0,d.ensureNotNull)(this.priceScale());return r.isLog()?new w.PriceRange(r.priceToLogical(s.minValue()),r.priceToLogical(s.maxValue())):s}}const L="study_Internal$STD;Fund_";function A(e){const t="study_"+(e.classId||e.shortId);return t.startsWith(L)?L:t}function k(e,t="shift",i){return{studyConstructor:e,colorRotationMode:t,colorRotationComparator:i}}const E={study_PivotPointsStandard:k(o.study_PivotPointsStandard),study_Overlay:k(a.study_Overlay,"loop"),study_Compare:k(l.StudyCompare,"loop"),study_Volume:k(_),study_VbPVisible:k(class extends M{alertCreationAvailable(){return new(g())(!1).readonly()}_needExtendToBarsEnding(){return!1}}),study_ScriptWithDataOffset:k(c.study_ScriptWithDataOffset)};s.enabled("moving_average_study_changable_currency_unit")&&(E["study_Moving Average"]=k(b));for(const e in E)E.hasOwnProperty(e)&&(TradingView[e]=E[e].studyConstructor);function D(e){return e instanceof n.Study}function B(e){return!1}function V(e){return e instanceof h.StudyStub}function R(e){return e instanceof Fundamental}function N(e){return!1}function O(e){return!1}function F(e,t,i,s,r){const o=A(s),a=new(o in E?E[o].studyConstructor:n.Study)(e,t,i,s);return void 0!==r&&a.setId(r),a}function W(e){const t=A(e);return t in E?E[t].colorRotationMode:void 0===e.pine||r.StudyMetaInfo.isStandardPine(e.id)?1!==e.plots.length?"shift":"loop":null}function z(e,t){return e.id===t.id&&(s=t,((i=e).pine?i.pine.version:void 0)===(s.pine?s.pine.version:void 0));var i,s}function H(e){const t=A(e);if(t in E){const e=E[t].colorRotationComparator;if(void 0!==e)return e}return z}},678448:(e,t,i)=>{"use strict";i.d(t,{StudyBaseWindowView:()=>r});var s=i(43657);class r extends s.DataWindowView{constructor(e,t){super(),this._invalidated=!0,this._study=e,this._model=t,this._valueProvider=this._createValuesProvider(e,t),
this._items=this._valueProvider.getItems().map((e=>new s.DataWindowItem(e.id,e.title,""))),this.update()}update(){this._invalidated=!0}items(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items}study(){return this._study}_updateImpl(){this._header=this._study.title(!0),this._title=this._study.title();const e=this._valueProvider.getValues(this._currentIndex());for(let t=0;t<e.length;++t){const i=e[t],s=this._items[t];s.setValue(i.value),s.setVisible(i.visible),s.setColor(i.color),s.setTitle(i.title)}}_currentIndex(){const e=this._model.crossHairSource().lockedIndex;if(void 0!==e)return e;const t=this._model.crossHairSource().appliedIndex();return isNaN(t)?null:t}}},380760:(e,t,i)=>{"use strict";i.d(t,{StudyColorRotatorFactory:()=>h});var s=i(676507),r=i(724377),n=i(602564),o=i(663890);const a=["color-sky-blue-400","color-banana-yellow-700","color-deep-blue-500","color-grapes-purple-a700","color-iguana-green-500","color-minty-green-a700","color-ripe-red-a200","color-berry-pink-200","color-tv-blue-a100","color-tan-orange-a200","color-sky-blue-a400","color-deep-blue-a100","color-grapes-purple-400","color-iguana-green-a700","color-minty-green-200","color-ripe-red-200","color-berry-pink-a200","color-ripe-red-500","color-grapes-purple-500","color-deep-blue-400","color-tv-blue-a200","color-sky-blue-500","color-iguana-green-400","color-minty-green-400","color-banana-yellow-600","color-tan-orange-500","color-berry-pink-400","color-ripe-red-300","color-grapes-purple-300","color-deep-blue-300","color-tv-blue-300","color-sky-blue-300","color-iguana-green-300","color-minty-green-300","color-banana-yellow-400","color-tan-orange-300","color-berry-pink-300","color-tan-orange-a700"];class l{constructor(e){this._offset=0,this._offset=e}getColor(e){if(0===this._offset)return e;const t=a[(this._offset-1)%a.length],i=s.colorsPalette[t],o=(0,n.isHexColor)(e)?1:(0,r.parseRgba)(e)[3];return(0,n.generateColor)(i,(0,n.alphaToTransparency)(o))}}class c{constructor(e,t){this._offset=e,this._modelStartOffset=t}getColor(e){if((0,n.isHexColor)(e)){const t=(0,r.parseRgb)(e);return(0,r.rgbToHexString)((0,r.shiftRgb)(t,this._offset,this._modelStartOffset))}{const t=(0,r.parseRgba)(e);return(0,r.rgbaToString)((0,r.shiftRgba)(t,this._offset,this._modelStartOffset))}}}class h{constructor(e){this._chartModel=e}getColorRotator(e){const t=(0,o.studyColorRotationMode)(e);if(null===t)return null;const i=this._calcDefaultColorsOffset(e);switch(t){case"loop":return new l(i);case"shift":{const e=this._chartModel.getStudyShiftColorStartOffset();return new c(i,e)}}}_calcDefaultColorsOffset(e){let t=0;const i=(0,o.useSameColorRotationComparator)(e);return this._chartModel.dataSources().filter(o.isStudy).forEach((s=>{i(e,s.metaInfo())&&t++})),t}}},152244:(e,t,i)=>{"use strict";i.d(t,{StudyDataSource:()=>_});var s=i(650151),r=i(922157),n=i.n(r),o=i(445588),a=i(900827),l=i(32673),c=i(732537),h=i(71023),d=i(864095);const u=(0,i(817808).getLogger)("Chart.StudyDataSource");var p;!function(e){e[e.Idle=0]="Idle",
e[e.AwaitingConnection=1]="AwaitingConnection",e[e.AwaitingParent=2]="AwaitingParent",e[e.AwaitingFirstDataUpdate=3]="AwaitingFirstDataUpdate",e[e.Active=4]="Active"}(p||(p={}));class _{constructor(e,t,i,s){this._inputs=null,this._status=p.Idle,this._studyId=null,this._turnaroundCounter=1,this._studyStatus={type:d.StudyStatusType.Undefined},this._studyStatusChanged=new(n()),this._graphics=new h.LiveStudyGraphics,this._dataCleared=new(n()),this._dataUpdated=new(n()),this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=e,this._metaInfo=s,this._seriesSource=t,this._turnaroundPrefix=i,this._plots=new o.PlotList((0,c.studyPlotFunctionMap)(s),c.studyEmptyPlotValuePredicate),this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged),this._dataUpdated.destroy(),this._dataCleared.destroy(),this._studyStatusChanged.destroy()}metaInfo(){return this._metaInfo}inputs(){return this._inputs}setInputs(e){this._inputs=e,null!==this._studyId&&(this._turnaroundCounter++,this._onStudyStatusChangedTo({type:d.StudyStatusType.Undefined}),this._gateway.modifyStudy(this._studyId,this._turnaround(),e,this._onMessage.bind(this)),this._status===p.Active&&this._changeStatusTo(p.AwaitingFirstDataUpdate))}isStarted(){return this._status!==p.Idle}isActive(){return this._status===p.Active}start(){this.isStarted()?u.logNormal("start: data source is already started, nothing to do"):((0,s.assert)(null!==this._inputs,"Inputs should be defined when starting a study data source"),this._gateway.isConnected().value()?this._createStudy():this._changeStatusTo(p.AwaitingConnection))}stop(){this.isStarted()?(null!==this._studyId&&(this._gateway.removeStudy(this._studyId),this._studyId=null,this._onStudyStatusChangedTo({type:d.StudyStatusType.Undefined})),this._changeStatusTo(p.Idle)):u.logNormal("stop: data source is already stopped, nothing to do")}studyId(){return this._studyId}studyStatus(){return this._studyStatus}studyStatusChanged(){return this._studyStatusChanged}plots(){return this._plots}graphics(){return this._graphics}clearData(){this._plots.clear(),this._graphics.clear(),this._dataCleared.fire()}stopAndStealData(){(0,s.assert)(this._status===p.Active,"Couldn't steal data from non-active data source"),this.stop();const e=this._plots,t=this._graphics.extract();return this._plots=new o.PlotList((0,c.studyPlotFunctionMap)(this._metaInfo),c.studyEmptyPlotValuePredicate),{plots:e,graphics:t}}dataCleared(){return this._dataCleared}dataUpdated(){return this._dataUpdated}moveData(e){this._ongoingDataUpdate=this._ongoingDataUpdate.then((()=>{this._plots.move(e)}))}pendingUpdatesReady(){return this._ongoingDataUpdate}_changeStatusTo(e){(0,s.assert)(this._status!==e,"Source and destination status should be distinct"),u.logNormal(`Status changed from ${p[this._status]} to ${p[e]}`),this._status=e}_createStudy(){const e=this._seriesSource.instanceId()
;null!==e?this._createStudyUsingParentId(e):(this._changeStatusTo(p.AwaitingParent),this._seriesSource.dataEvents().completed().subscribe(this,this._onSeriesCompleted,!0))}_createStudyUsingParentId(e){(0,s.assert)(this._status!==p.Active,'Status should not be "Active" when creating a study'),(0,s.assert)(this._studyStatus.type===d.StudyStatusType.Undefined,'Study status should be "Undefined" when creating a study'),(0,s.assert)(null===this._studyId,"Study id should be empty when creating a study"),this._studyId=(0,l.makeNextStudyId)(),this._gateway.createStudy(this._studyId,this._turnaround(),e,this._metaInfo.fullId+("tv-basicstudies"===this._metaInfo.packageId?"":"!"),(0,s.ensureNotNull)(this._inputs),this._onMessage.bind(this)),this._changeStatusTo(p.AwaitingFirstDataUpdate)}_onGatewayIsConnectedChanged(e){e?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===p.AwaitingConnection&&this._createStudy()}_onGatewayDisconnected(){this._status!==p.Idle&&this._status!==p.AwaitingConnection&&(this._studyId=null,this._changeStatusTo(p.AwaitingConnection),this._studyStatus.type!==d.StudyStatusType.Undefined&&this._onStudyStatusChangedTo({type:d.StudyStatusType.Undefined})),this._turnaroundCounter=1}_onSeriesCompleted(){this._status===p.AwaitingParent&&this._createStudyUsingParentId((0,s.ensure)(this._seriesSource.instanceId()))}_onStudyStatusChangedTo(e){const t=this._studyStatus;this._studyStatus=e,u.logNormal(`Study status type changed from ${d.StudyStatusType[t.type]} to ${d.StudyStatusType[e.type]}`),this._studyStatusChanged.fire(t,e)}_onMessage(e){if("data_update"===e.method){const{customId:t,turnaround:i,plots:r,nonseries:n}=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onDataUpdate(r,(0,s.ensureDefined)(n))}else if("study_loading"===e.method){const[t,i,s]=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onStudyLoading(s)}else if("study_completed"===e.method){const[t,i,s]=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onStudyCompleted(s)}else if("study_error"===e.method){const[t,i,s,r,n]=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onStudyError(s,r,n)}else"clear_data"===e.method&&this._checkTurnaround(e.params.turnaround)&&this.clearData()}_onDataUpdate(e,t){const i=(0,a.unpackNonSeriesData)(t.d);return this._ongoingDataUpdate=this._ongoingDataUpdate.then((()=>i),(()=>i)).then(this._onDataUnpacked.bind(this,e,t.indexes)),this._ongoingDataUpdate}_onDataUnpacked(e,t,i){this._status!==p.Idle&&(this._status===p.AwaitingFirstDataUpdate&&(this._changeStatusTo(p.Active),this.clearData()),this._mergePlots(e),null!==i&&(i.indexes_replace?((0,s.assert)("nochange"!==t),this._graphics.replaceIndexesTo(t)):("nochange"!==t&&this._graphics.replaceIndexesTo(t),void 0!==i.graphicsCmds&&this._graphics.processCommands(i.graphicsCmds,this._metaInfo.graphics))),this._dataUpdated.fire(e,i,t))}_onStudyLoading(e){this._onStudyStatusChangedTo({type:d.StudyStatusType.Loading,startTime:Date.now()})}_onStudyError(e,t,i){this.clearData()
;const s="string"==typeof e?{error:e.split(":",2)[0]}:e;this._onStudyStatusChangedTo({type:d.StudyStatusType.Error,errorDescription:s})}_onStudyCompleted(e){this._onStudyStatusChangedTo({type:d.StudyStatusType.Completed})}_mergePlots(e){this._plots.merge(e)}_turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}_checkTurnaround(e){const t=this._turnaround();return e===t||e===this._seriesSource.turnaround()||e===`${this._seriesSource.turnaround()}_${t}`}}},492326:(e,t,i)=>{"use strict";i.d(t,{StudyDataWindowView:()=>a});var s=i(678448),r=i(768950),n=i(341032);class o{constructor(e,t){this._study=e,this._model=t,this._hhistBasedStudy=void 0!==e.metaInfo().graphics.hhists,this._valuesProvider=this._createValuesProvider(e,t)}getItems(){return this._valuesProvider.getItems()}getValues(e){const t=this._valuesProvider.getValues(e),i=e=>!!this._hhistBasedStudy||this._study.isPlotVisibleAt(e,2);for(const e of t)e.visible=e.visible&&i(e.id);return t}_createValuesProvider(e,t){return this._hhistBasedStudy?new n.HHistBasedValuesProvider(e,t):new r.StudyValuesProvider(e,t)}}class a extends s.StudyBaseWindowView{_createValuesProvider(e,t){return new o(e,t)}}},732537:(e,t,i)=>{"use strict";function s(e){const t=new Map;return e.plots.forEach(((e,i)=>{t.set(e.id,(e=>e[i+1]))})),t}function r(e,t){return null==e[t]}i.d(t,{studyPlotFunctionMap:()=>s,studyEmptyPlotValuePredicate:()=>r})},101709:(e,t,i)=>{"use strict";function s(e,t){return`${e}@${t}`}function r(e){return e.replace(/(@[^-]+-[^-]+).*$/,"$1")}i.d(t,{studyIdString:()=>s,extractStudyId:()=>r})},939291:(e,t,i)=>{"use strict";i.d(t,{isExtendedInput:()=>n,isExtendedInputSource:()=>o,getInputValue:()=>a,isStudyInputOptionsInfo:()=>l,areStudyInputsEqual:()=>c,RangeDependentStudyInputNames:()=>s,isTimeOrPriceNotHiddenInput:()=>h,editableStudyInputs:()=>d});var s,r=i(598279);function n(e){return(0,r.default)(e)}function o(e){return"source"===e.t}function a(e){return n(e)?e.v:e}function l(e){return["text","integer","float","price","session","resolution"].includes(e.type)&&e.hasOwnProperty("options")}function c(e,t,i){for(const s of e)if(t[s.id]!==i[s.id])return!1;return!0}function h(e){return("time"===e.type||"price"===e.type)&&!0!==e.isHidden}function d(e){return[]}!function(e){e.FirstBar="first_visible_bar_time",e.LastBar="last_visible_bar_time",e.Realtime="subscribeRealtime"}(s||(s={}))},24565:(e,t,i)=>{"use strict";i.d(t,{StudyInserter:()=>o});var s=i(898005),r=i(538246);const n=(0,i(817808).getLogger)("Chart.Studies.StudyInserter");class o{constructor(e,t,i){this._parentSources=[],this._propsState=void 0,this._preferredPriceScale=void 0,this._allowChangeCurrency=!1,this._allowChangeUnit=!1,this._paneSize=void 0,this._forceOverlay=!1,this._studyMetaInfoRepository=t,this._inserterImpl=i,this._studyDescriptor=e}setParentSources(e){this._parentSources=e}setPaneSize(e){this._paneSize=e}setPreferredPriceScale(e){this._preferredPriceScale=e}setAllowChangeCurrency(e){this._allowChangeCurrency=e}setAllowChangeUnit(e){this._allowChangeUnit=e}setForceOverlay(e){
this._forceOverlay=e}setPropertiesState(e){this._propsState=e}setTargetPriceScaleMode(e){this._targetPriceScaleMode=e}async insert(e,t){var i;const s=void 0!==(o=this._inserterImpl).createStub&&void 0!==o.removeStub?this._inserterImpl.createStub():null;var o;let a,l=!0;try{a=await this._studyMetaInfoRepository.findById(this._studyDescriptor)}catch(e){return n.logWarn(`Cannot get study ${JSON.stringify(this._studyDescriptor)}`),Promise.reject(r.InsertionErrorCode.CannotGetMetainfo)}finally{null!==s&&(l=this._inserterImpl.removeStub(s))}if(!l)return Promise.reject(r.InsertionErrorCode.StubWasRemoved);if(void 0!==t&&t.cancelled)return Promise.reject(r.InsertionErrorCode.Cancelled);if(!this._canApplyStudyToParent(a))return Promise.reject(r.InsertionErrorCode.StudyCannotBeChild);const c={...a.defaults.inputs};let h={};if(void 0!==e){const t=await e(c,a.inputs,a);h=t.inputs,this._parentSources=null!==(i=t.parentSources)&&void 0!==i?i:[]}if(void 0!==t&&t.cancelled)return Promise.reject(r.InsertionErrorCode.Cancelled);const d=this._insertStudy(a,h);return null===d?Promise.reject(r.InsertionErrorCode.Unknown):d}_insertStudy(e,t){return this._inserterImpl.createStudy(e,t,null,this._propsState,this._forceOverlay,this._parentSources,this._preferredPriceScale,this._allowChangeCurrency,this._allowChangeUnit,this._paneSize,this._targetPriceScaleMode)}_canApplyStudyToParent(e){return 0===this._parentSources.length||s.StudyMetaInfo.canBeChild(e)}}},402440:(e,t,i)=>{"use strict";i.d(t,{StudyLegendValuesProvider:()=>n});var s=i(768950),r=i(341032);class n{constructor(e,t){this._study=e,this._model=t,this._showStudyValues=t.properties().childs().paneProperties.childs().legendProperties.childs().showStudyValues,this._hhistBasedStudy=void 0!==e.metaInfo().graphics.hhists,this._valuesProvider=this._createValuesProvider(e,t)}getItems(){return this._valuesProvider.getItems()}getValues(e){const t=this._valuesProvider.getValues(e),i=this._study.properties(),s=this._showStudyValues.value()&&i.childs().showLegendValues.value(),r=e=>!!this._hhistBasedStudy||this._study.isPlotVisibleAt(e,8);for(const e of t)e.visible=e.visible&&s&&r(e.id);return t}_createValuesProvider(e,t){return this._hhistBasedStudy?new r.HHistBasedValuesProvider(e,t):new s.StudyValuesProvider(e,t)}}},125508:(e,t,i)=>{"use strict";i.d(t,{StudyStatusProviderBase:()=>a});var s=i(606978),r=i(981820);const n={NONE:"Default"},o=!1;class a extends s.StatusProviderBase{constructor(e,t){super(t),this._source=e}getSplitTitle(){return this._source.titleInParts(!0,n,void 0,o)}text(){return this._source.isActualInterval()?this._source.isFailed()?`${this._source.title(!0,n,void 0,o)}: ${this.sourceStatusText()}`:`${this._source.title(!0,n,void 0,o)} ${this.sourceStatusText()}`:this._source.title(!0,n,void 0,o)}sourceStatusText(){return(0,r.convertStudyStatusToString)(this._source.status(),!0)}errorStatus(){if(!this._source.isActualInterval()||this._source.isSymbolInvalid())return null;const e=this._source.status();return e.type===r.StudyStatusType.Error?{error:this.sourceStatusText(),
solutionId:(0,r.studyStatusSolutionId)(e),title:(0,r.studyStatusTitle)(e),studyFeature:(0,r.studyStatusFeature)(e)}:null}}},736360:(e,t,i)=>{"use strict";i.d(t,{StudyStatusProvider:()=>n});var s=i(509806),r=(i(981820),i(125508));s.t(null,void 0,i(947542));class n extends r.StudyStatusProviderBase{constructor(e,t){super(e,t),this._study=e}color(){return this._study.isFailed()||this._study.metaInfo&&this._study.metaInfo().isTVScriptStub?"#ff0000":super.color()}sourceStatusText(){this._study.status();return super.sourceStatusText()}}},533927:(e,t,i)=>{"use strict";i.d(t,{StudyStatusView:()=>r});var s=i(160047);class r extends s.StatusView{constructor(e){super(e.statusProvider())}color(){return this._statusProvider.color()}getSplitTitle(){return this._statusProvider.getSplitTitle()}update(){this._text=this._statusProvider.text()}}},981820:(e,t,i)=>{"use strict";i.d(t,{StudyStatusType:()=>c,convertStudyStatusToString:()=>h,studyStatusFeature:()=>p,studyStatusSolutionId:()=>d,studyStatusTitle:()=>u});var s=i(509806);const r=new Map([["You cannot see this pivot timeframe on this resolution",s.t(null,void 0,i(717126))],["The data vendor doesn't provide volume data for this symbol.",s.t(null,void 0,i(529198))],['Histogram is too large, please increase "Row Size" input.',s.t(null,void 0,i(369085))],["Histogram is too large, please reduce 'Row Size' input.",s.t(null,void 0,i(808122))],["This script is invite-only. To request access, please contact its author.",s.t(null,void 0,i(874986))],["Volume Profile indicator available only on our upgraded plans.",s.t(null,void 0,i(961022))]]),n=s.t(null,void 0,i(916971)),o=new Map,a=new Map,l=s.t(null,void 0,i(930295));var c;function h(e,t){if(e.type===c.Loading)return t?l:"loading...";if(e.type===c.Error){const s=e.errorDescription,n=t?(i=s.error,r.get(i)||i):s.error;if(s.ctx){const e={};return Object.entries(s.ctx).forEach((([t,i])=>{e[t]=i.toString()})),n.format(e)}return n}var i;return""}function d(e){if(e.type===c.Error)return e.errorDescription.solution_id?e.errorDescription.solution_id:function(e){for(const t of Array.from(o.keys()))if(e.includes(t))return o.get(t)}(e.errorDescription.error)}function u(e){if(e.type===c.Error)return-1!==e.errorDescription.error.toLowerCase().indexOf("the data vendor doesn't provide volume data for this symbol.")?n:void 0}function p(e){const{errorDescription:{error:t}}=e;for(const[e,i]of a)if(t.startsWith(e))return i}!function(e){e[e.Undefined=0]="Undefined",e[e.Loading=1]="Loading",e[e.Completed=2]="Completed",e[e.Error=3]="Error"}(c||(c={}))},665851:(e,t,i)=>{"use strict";i.d(t,{StudyStub:()=>m});var s=i(533927),r=i(539301),n=i(821737),o=i(922157),a=i.n(o),l=i(976704),c=i.n(l),h=i(125508);class d extends h.StudyStatusProviderBase{text(){return this._source.isActualInterval()?`${this._source.title()} ${this.sourceStatusText()}`:this._source.title()}}var u=i(981820);class p{getItems(){return[]}getValues(e){return[]}}const _=new(a());class m extends r.PriceDataSource{constructor(e,t,i){super(e),this._priceStep=.01,this._status={
type:u.StudyStatusType.Undefined},this._statusChanged=new(a()),this._formatter=new n.PriceFormatter(100),this._origState=t,this._title=i;this._properties=new(c())({visible:!0}),this._statusView=new s.StudyStatusView(this)}barColorer(){return null}properties(){return this._properties}statusView(){return this._statusView}legendView(){return null}state(e){return this._origState}setStatus(e){this._status=e,this._statusChanged.fire()}formatter(){return this._formatter}name(){return this._title}title(){return this._title}titleInParts(){return[this._title]}isFailed(){return this._status.type===u.StudyStatusType.Error}isLoading(){return this._status.type===u.StudyStatusType.Loading}setFailed(e){this.setStatus({type:u.StudyStatusType.Error,errorDescription:{error:e}}),this._model.updateSource(this)}isSymbolInvalid(){return!1}isActualInterval(){return!0}onIsActualIntervalChange(){return _}start(){}status(){return this._status}onStatusChanged(){return this._statusChanged}firstValue(){return null}currency(){return null}sessionId(){return this._model.mainSeries().sessionId()}sessionIdChanged(){return this._model.mainSeries().sessionIdChanged()}unit(){return null}symbolSource(){return this._model.mainSeries()}barsProvider(){return this._model.mainSeries()}valuesProvider(){return new p}statusProvider(e){return new d(this,this._model.properties().childs().scalesProperties.childs().textColor)}}},768950:(e,t,i)=>{"use strict";i.d(t,{StudyValuesProvider:()=>f});var s=i(150335),r=i(601227),n=i(602564),o=i(484727),a=i(153026),l=i(315264),c=i(358076),h=i(444649),d=i(691826),u=i(161999),p=i(650151),_=i(58216);const m=r.CheckMobile.any(),g=o.enabled("hide_last_na_study_output");class f{constructor(e,t){this._emptyValues=[],this._colorProviders=new Map,this._study=e,this._model=t,this._studyMetaInfo=this._study.metaInfo(),this._studyProperties=this._study.properties().childs(),this._isFundamental=!1;const i=this._studyMetaInfo.plots;i&&i.forEach(((e,t)=>{if((0,h.isPlotWithTechnicalValues)(e))return;const i=e.id;this._emptyValues.push(function(e,t="",i=""){return{id:t,index:e,title:i,value:"",visible:!1}}(t,i,this._study.guiPlotName(i)));const s=(0,h.isOhlcPlot)(e)?e.target:i;this._colorProviders.set(s,(0,d.createStudyPlotColorProvider)(this._studyMetaInfo,this._study.properties(),s))}))}getItems(){return this._emptyValues}getPlotColor(e,t){var i;const r=t[e+1];if(!(0,s.isNumber)(r))return"";const n=r>0;let o;const a=this._studyMetaInfo.plots[e];let l=a.id;const c=this._studyProperties;if((0,h.isOhlcPlot)(a))l=a.target||l,o=(0,p.ensureDefined)(c.ohlcPlots.childs()[l].childs().color).value();else if((0,h.isArrowsPlot)(a)){const e=(0,p.ensureDefined)(c.styles.childs()[l]);o=n?e.childs().colorup.value():e.childs().colordown.value()}else o=(0,p.ensureDefined)(null===(i=c.styles.childs()[l])||void 0===i?void 0:i.child("color")).value();let d=o;const u=this._colorProviders.get(l),_=u&&u.getPlotPointStyle(t);return _&&((0,h.isArrowsPlot)(a)?(n&&void 0!==_.colors[5]&&(d=_.colors[5]),
n||void 0===_.colors[6]||(d=_.colors[6])):void 0!==_.colors[0]&&(d=_.colors[0])),"transparent"===d&&(d=o),d}getValues(e){var t,i;const r=this._emptyValues.map((e=>({...e})));let o=null;const l=this._study.data().lastIndex(),c=this._studyProperties;if(null!==l)for(const e of r){if(0===(null===(t=c.styles.childs()[e.id])||void 0===t?void 0:t.childs().display.value()))continue;const i=this._study.nearestIndex(l,a.PlotRowSearchMode.NearestLeft,e.index+1);if(void 0===i)continue;const s=i+this._study.offset(e.id);o=null!==o?Math.max(s,o):s}(null===e||null!==o&&e>o)&&(e=o);const d=this._hideValues(),m=this._study.isVisible()&&!d?_.notAvailable:"";for(const e of r)e.value=m;if(d)return r;g&&r.length&&(r[r.length-1].value="");const f=this._study.priceScale();if(!this._study.isVisible()||null===e||null===f||f.isEmpty()||this._model.timeScale().isEmpty())return r;const v=(0,u.getPriceValueFormatterForSource)(this._study),S={};for(const t of r){const r=t.id,o=(0,p.ensureDefined)(c.styles.childs()[r]),d=o.childs().display.value();if(t.visible=0!==d,!t.visible)continue;const u=o.hasChild("plottype")?null===(i=o.child("plottype"))||void 0===i?void 0:i.value():null,_=this._isFundamental&&(u===h.LineStudyPlotStyle.StepLine||u===h.LineStudyPlotStyle.StepLineWithDiamonds),m=t.index,g=e-this._study.offset(r),f=_||null!==l&&g>l?a.PlotRowSearchMode.NearestLeft:a.PlotRowSearchMode.Exact,y=this._study.nearestIndex(g,f);if(void 0===y)continue;let b=S[r];if(void 0===b&&(b=this._study.getMinFirstBarIndexForPlot(r),Number.isFinite(b)&&(S[r]=b)),b>y)continue;const w=this._study.data().last(),P=this._study.data().valueAt(y)||(null!==w?w.value:null);if(null===P)continue;const C=P[m+1];(0,s.isNumber)(C)&&(t.value=v(C),t.color=(0,n.resetTransparency)(this.getPlotColor(m,P)))}return r}_hideValues(){return m&&(null===this._model.crossHairSource().pane||(0,l.isLineToolName)(c.tool.value())||null!==this._model.lineBeingEdited())}}},278787:(e,t,i)=>{"use strict";i.d(t,{StudyBase:()=>Gt,prepareStudyProperties:()=>Wt,prepareStudyPropertiesForLoadChart:()=>Ut});var s=i(316230),r=i(822914),n=i(650151),o=i(509806),a=i(817808),l=i(601227),c=i(922157),h=i.n(c),d=i(900827),u=i(539301),p=i(786432),_=i(445588),m=i(898005),g=i(135834),f=i(153026),v=i(795161),S=i(678448),y=i(402440),b=i(444649);class w extends S.StudyBaseWindowView{constructor(e,t){super(e,t),this._showStudyValues=t.properties().childs().paneProperties.childs().legendProperties.childs().showStudyValues,this._showStudyValues.subscribe(this,this.update);const i=this._study.properties();i.childs().showLegendValues.subscribe(this,this.update);const s=this._study.metaInfo().plots,r=new Set;s.forEach((e=>{var t;if((0,b.isOhlcPlot)(e)){const t=e.target;if(r.has(t))return;r.add(t),i.childs().ohlcPlots.childs()[t].childs().display.subscribe(this,this.update)}else(0,b.isPlotSupportDisplay)(e)&&(null===(t=i.childs().styles.childs()[e.id])||void 0===t||t.childs().display.subscribe(this,this.update))}))}areValuesVisible(){return this._showStudyValues.value()}additional(){return null}destroy(){
this._showStudyValues.unsubscribeAll(this);const e=this._study.properties();e.childs().showLegendValues.unsubscribeAll(this);const t=this._study.metaInfo().plots,i=new Set;t.forEach((t=>{var s;if((0,b.isOhlcPlot)(t)){const s=t.target;if(i.has(s))return;i.add(s),e.childs().ohlcPlots.childs()[s].childs().display.unsubscribe(this,this.update)}else(0,b.isPlotSupportDisplay)(t)&&(null===(s=e.childs().styles.childs()[t.id])||void 0===s||s.childs().display.unsubscribe(this,this.update))}))}_createValuesProvider(e,t){return new y.StudyLegendValuesProvider(e,t)}}var P=i(358076),C=i(533927),T=i(881881),x=i(32673),I=i(994528),M=i(736360),L=i(976704),A=i.n(L),k=i(486028),E=i(66568),D=i(939291),B=i(484727),V=i(86441),R=i(602564),N=i(385824);class O{constructor(e){this._data=e}draw(e,t){}drawBackground(e,t){e.save();const i=this._data,s=t.pixelRatio;let r=null;const n=Math.round(this._data.w*s);for(let t=0;t<i.items.length;++t){const o=i.items[t];if(null==o.color){r=null;continue}e.fillStyle=o.color;const a=Math.round(o.x*s);let l=a;if(t>0){i.items[t-1].index===o.index-1&&null!==r&&(l=r+1)}const c=a+n,h=c-l+1;e.fillRect(l,Math.round(i.y*s),h,Math.round(i.h*s)),r=c}e.restore()}hitTest(e){return null}}var F=i(691826);class W{constructor(e,t,i,s){this._items=[],this._invalidated=!0,this._isMarkersEnabled=B.enabled("source_selection_markers"),this._study=e,this._series=t,this._model=i,this._plotName=s;const r=this._study.metaInfo().plots;for(let e=0;e<r.length;e++){const t=r[e];t.id===this._plotName&&(this._plotIndex=e,(0,n.assert)((0,b.isBgColorerPlot)(t),"Plot '"+this._plotName+"' is not a background colorer!"))}this._colorProvider=(0,F.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s)}items(){return this._items}update(){this._invalidated=!0}renderer(){if(1!=(1&(0,n.ensureDefined)(this._study.properties().childs().styles.childs()[this._plotName]).childs().display.value()))return null;if(!this._scalesReady())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={items:this._items,y:0,h:(0,n.ensureNotNull)(this._study.priceScale()).height(),w:this._model.timeScale().barSpacing()},t=new N.CompositeRenderer;return t.append(new O(e)),t}_scalesReady(){const e=this._model.timeScale(),t=this._study.priceScale();return e&&!e.isEmpty()&&null!==t&&!t.isEmpty()}_getTranspValue(){const e=(0,n.ensureDefined)(this._study.properties().childs().styles.childs()[this._plotName]).childs();let t=0;return e.transparency&&(t=e.transparency.value(),t=(0,k.isNumber)(t)?t:40),t}_updateImpl(){this._items=[],(0,n.assert)(this._scalesReady(),"Scales must be ready!");const e=this._model.timeScale().visibleBarsStrictRange();if(null===e)return;const t=this._getTranspValue();let i=(0,n.ensureDefined)(this._series.nearestIndex(e.firstBar(),f.PlotRowSearchMode.NearestRight)),s=(0,n.ensureDefined)(this._series.nearestIndex(e.lastBar(),f.PlotRowSearchMode.NearestLeft));const r=this._study.offset(this._plotName);r>0?(i-=r,s+=r):(i+=r,s-=r);const o=this._study.getMinFirstBarIndexForPlot(this._plotName);if(o>s)return;i=Math.max(o,i)
;const a=this._study.data().rangeIterator(i,s);for(;a.hasNext();){const e=a.next();let i=e.index;const s=e.value;i+=r;const o=new V.Point(Math.floor(i)-.5,NaN);let l=(0,k.isNumber)(t)?t:50;l=Math.min(l,100),l=Math.max(l,0);const c=this._colorProvider.getPlotPointStyle(s);void 0!==c.colors[1]&&(o.color=(0,R.generateColor)((0,n.ensureDefined)(c.colors[1]),l)),o.index=i,this._items.push(o)}this._model.timeScale().timedValuesToCoordinates(this._items)}}var z,H,U=i(592834),j=i(815553),G=i(872754),q=i(218954),$=i(777277),Y=i(773423),K=i(510656),Z=i(729261),X=i(934026),J=i(188035),Q=i(779292),ee=i(327714),te=i(289763);!function(e){e.Left="left",e.Right="right",e.Center="center"}(z||(z={})),function(e){e.Top="top",e.Bottom="bottom",e.Middle="middle"}(H||(H={}));const ie=(0,te.createDisconnectedCanvas)(document,(0,ee.size)({width:0,height:0}),1);class se{constructor(e,t,i,s,r,o="center",a=0){this._lines=e.split(/[^\S\r\n]*(?:\r\n|\r|\n)/),this._font=function(e,t,i,s){return(0,Q.makeFont)(s,i,`${e?"bold ":""}${t?"italic ":""}`)}(t,i,s,r),this._fontSize=r,this._verticalPadding=~~(r/6),this._textAlign=o,this._lineSpacing=a;const l=(0,n.ensureNotNull)(ie.getContext("2d"));l.font=this._font,l.textBaseline="top";let c=0;for(let e=0;e<this._lines.length;++e){const t=this._lines[e],i=l.measureText(t).width;c=Math.max(c,i)}this.textImageWidth=c+1,this.textImageHeight=this._lines.length*r+(this._lines.length-1)*this._lineSpacing+this._verticalPadding}paintTo(e,t,i){e.save();const s=t.pixelRatio,r=i.location;e.translate(Math.round(function(e,t,i){let s=e;switch(t){case"left":break;case"right":s-=i;break;case"center":s-=i/2}return Math.round(s)}(r.x,r.horzAlign,this.textImageWidth)*s),Math.round(function(e,t,i){let s=e;switch(t){case"top":break;case"bottom":s-=i;break;case"middle":s-=i/2}return Math.round(s)}(r.y,r.vertAlign,this.textImageHeight)*s));const n=i.style;let o;switch(e.textBaseline="top",e.font=this._font,e.lineJoin="round",e.fillStyle=n.fillStyle,n.strokeStyle&&(e.strokeStyle=n.strokeStyle),n.lineWidth&&(e.lineWidth=n.lineWidth),this._textAlign){case"left":o=0,e.textAlign="left";break;case"right":o=this.textImageWidth-1,e.textAlign="right";break;default:o=this.textImageWidth/2,e.textAlign="center"}let a=this._verticalPadding;(0,te.drawScaled)(e,s,(()=>{for(const t of this._lines)n.strokeStyle&&e.strokeText(t,o,a),e.fillText(t,o,a),a+=this._fontSize,a+=this._lineSpacing})),e.restore()}}class re extends J.AbstractMapContainer{constructor(e){super(),this._maxSize=e,this._keysQueue=[]}get(e){const{fontSize:t,text:i,align:s,font:r,lineSpacing:n=0}=e;if(!i||!t||!s)return null;const o=(0,Q.makeFont)(t,r),a=(0,J.getDefault3)(this._map,n,s,o,new Map);let l=a.get(i);return void 0!==l||(this._size>=this._maxSize?this._deleteFirstKey():++this._size,this._keysQueue.push([o,s,n,i]),l=new se(i,e.bold,e.italic,r,t,s,n),a.set(i,l)),l}_deleteFirstKey(){const e=this._keysQueue.shift(),[t,i,s,r]=e,o=(0,n.ensureDefined)(this._map.get(s)),a=(0,n.ensureDefined)(o.get(i)),l=(0,n.ensureDefined)(a.get(t));l.delete(r),0===l.size&&a.delete(t),
0===a.size&&o.delete(i),0===o.size&&this._map.delete(s)}}var ne=i(574570);class oe{constructor(e,t={skipRenderingOptimizations:!1}){this._items=[],this._barSpacing=0,this._vertOffset=0,this._textCache=t.textCache||new re(5e3),this._drawOperation=t.skipRenderingOptimizations?this._drawWithoutOptimizations.bind(this):this._drawWithOptimizations.bind(this),null!==e&&this.setData(e)}draw(e,t){this._preDrawInit(),this._drawOperation(e,t)}hitTest(e){const t=$.HitTestResult.REGULAR;let i=null;for(const s of this._items){if(!s)continue;const r=this._calcBoundingBox(s);if(r&&(0,X.pointInBox)(e,r)){const e={tooltip:this._getTooltip(s,r)};i=new $.HitTestResult(t,e)}}return i}setData(e){this._height=void 0!==e.height?e.height:e.width,this._width=void 0!==e.width?e.width:e.height,this._color=e.color,this._borderColor=e.borderColor,this._vertOffset=e.vertOffset||0,e.text&&(this._text=e.text,this._fontSize=e.fontSize,this._lineSpacing=e.lineSpacing,this._textColor=e.textColor,this._textAlign=e.textAlign||"center"),void 0!==e.items&&void 0!==e.barSpacing&&this.setItems(e.items,e.barSpacing)}setItems(e,t){this._setBaseData(e,t)}_calcBoundingBox(e){const t=e.vertOffset,i=this._getTextCache(e);if(!i)return;const s=i.textImageWidth,r=i.textImageHeight,n=s/2,o=e.y+t+e.textVertOffset,a=t>0?0:-r,l=t>0?r:0,c=new V.Point(e.x-n,o+a),h=new V.Point(e.x+n,o+l);return(0,V.box)(c,h)}_unionBox(e,t){const i=Math.min(e.min.x,t.min.x),s=Math.max(e.max.x,t.max.x),r=Math.min(e.min.y,t.min.y),n=Math.max(e.max.y,t.max.y),o=new V.Point(i,r),a=new V.Point(s,n);return(0,V.box)(o,a)}_getTooltip(e,t){if(e.tooltip)return{content:{type:"text",data:e.tooltip},tooltipDelay:200,extendMargin:!0,rect:{x:t.min.x,y:t.min.y,w:Math.abs(t.max.x-t.min.x),h:Math.abs(t.max.y-t.min.y)}}}_setBaseData(e,t){this._items.length=0,this._barSpacing=t;for(const t of e){const e=void 0===t.width?(0,n.ensureDefined)(this._width):t.width,i=void 0===t.height?(0,n.ensureDefined)(this._height):t.height,s=void 0===t.vertOffset?this._vertOffset:t.vertOffset,r=s>0?i:-i;this._items.push({width:e,height:i,vertOffset:s,textVertOffset:r,shapeWidth:0,shapeHeight:0,stepX:0,stepY:0,...t})}}_drawItemText(e,t,i){const s=this._getTextCache(i);if(null===s)return;const r=i.x,n=i.vertOffset,o=i.y+n+i.textVertOffset;let a;a=i.style&&void 0!==i.style.textColor?i.style.textColor:this._textColor;const l={style:{fillStyle:a},location:{x:r,y:o,horzAlign:z.Center,vertAlign:n>0?H.Top:H.Bottom}};s.paintTo(e,t,l)}_drawWithOptimizations(e,t){let i,s,r=null,n=!1;for(const o of this._items)o.style&&void 0!==o.style.color?(i=o.style.color||"rgba(0, 0, 0, 0)",s=o.style.borderColor||"rgba(0, 0, 0, 0)"):(i=this._color,s=this._borderColor),(r!==i||l.isSafari)&&(r=i,n&&this._endPath(e),this._startPath(e,t,i,s)),this._drawItemShape(e,t,o),n=!0;n&&this._endPath(e);for(const i of this._items)this._drawItemText(e,t,i)}_drawWithoutOptimizations(e,t){let i,s;for(const r of this._items){const o=(0,n.ensureDefined)(r.style);i=o.color||"rgba(0, 0, 0, 0)",s=o.borderColor||"rgba(0, 0, 0, 0)",this._startPath(e,t,i,s),
this._drawItemShape(e,t,r),this._endPath(e),this._drawItemText(e,t,r)}}_drawItemShape(e,t,i){(0,te.drawScaled)(e,t.pixelRatio,(()=>this._drawItemShapeUsingCSSPixels(e,i)))}_drawItemShapeUsingCSSPixels(e,t){}_preDrawInit(){}_startPath(e,t,i,s){}_endPath(e){}_getTextCache(e){var t,i;const s=e.text||this._text,r=e.fontSize||this._fontSize,n=null!==(t=e.lineSpacing)&&void 0!==t?t:this._lineSpacing,o=e.textAlign||this._textAlign,a=null!==(i=e.font)&&void 0!==i?i:ne.CHART_FONT_FAMILY;return this._textCache.get({text:s,bold:!1,italic:!1,font:a,fontSize:r,lineSpacing:n,align:o})}}class ae extends oe{_startPath(e,t,i,s){e.beginPath(),e.lineWidth=this._lineWidth(t),e.lineCap="butt",e.strokeStyle=i}_endPath(e){e.stroke()}_lineWidth(e){return Math.max(1,Math.floor(2*e.pixelRatio))}}class le extends oe{_startPath(e,t,i,s){e.beginPath(),e.lineWidth=this._lineWidth(t),e.lineCap="butt",e.fillStyle=i,e.strokeStyle=s}_endPath(e){e.fill(),e.stroke()}_lineWidth(e){return Math.max(1,Math.floor(e.pixelRatio))}}class ce extends le{constructor(){super(...arguments),this._sign=0,this._thinArrow=!1,this._thinArrowLineWidth=0,this._headHeight=0,this._arrowWidth=0}setItems(e,t){this._setBaseData(e,t)}_drawItemShape(e,t,i){const s=t.pixelRatio,r=this._lineWidth(t)%2?.5:0,n=this._sign,o=this._arrowWidth,a=this._headHeight,l=Math.abs(i.height),c=Math.round(i.x*s)+r,h=i.vertOffset,d=Math.round((i.y+h+n*l/2)*s)+r,u=(0,q.ceiledEven)(o*s),p=u/2,_=Math.round(l*s),m=Math.round(a*s);e.translate(c,d),this._thinArrow?(e.moveTo(0,0),e.lineTo(-p,-p*n),e.moveTo(0,0),e.lineTo(p,-p*n),e.moveTo(0,0),e.lineTo(0,-_*n),e.moveTo(-p,-_*n),e.lineTo(p,-_*n)):(e.moveTo(0,0),_<m?(e.lineTo(u,-_*n),e.lineTo(-u,-_*n)):(e.lineTo(u,-m*n),e.lineTo(p,-m*n),e.lineTo(p,-_*n),e.lineTo(-p,-_*n),e.lineTo(-p,-m*n),e.lineTo(-u,-m*n)),e.lineTo(0,0)),e.translate(-c,-d)}_preDrawInit(){const e=this._calculateWidth();this._arrowWidth=e,this._sign=this._isUp()?-1:1,this._thinArrow=e<4,this._thinArrowLineWidth=Math.max(e/2,1),this._headHeight=Math.round(e)}_startPath(e,t,i,s){e.beginPath(),e.fillStyle=i,e.strokeStyle=s,e.lineWidth=this._lineWidth(t)}_lineWidth(e){return this._thinArrow?this._thinArrowLineWidth:super._lineWidth(e)}_calcBoundingBox(e){const t=e.vertOffset,i=this._sign,s=this._arrowWidth,r=this._headHeight,n=Math.abs(e.height),o=e.x-s,a=o+2*s,l=e.y+t+i*Math.round(n/2),c=l+(-n-r)*i,h=new V.Point(o,l),d=new V.Point(a,c);let u=(0,V.box)(h,d);const p=super._calcBoundingBox(e);return p&&(u=this._unionBox(u,p)),u}_calculateWidth(){return Math.round(this._barSpacing/4)}}const he=2*Math.PI;class de extends le{setItems(e,t){this._setBaseData(e,t);for(const e of this._items){const t=e.height;e.stepX=Math.round(t/2*.65)+.5,e.stepY=e.stepX;const i=e.stepX/2,s=this._getTextCache(e);if(null===s){e.shapeWidth=2*e.stepX,e.shapeHeight=2.5*e.stepY,e.vertOffset=this._calcVertOffset(e);continue}const r=s.textImageWidth,n=s.textImageHeight;e.shapeWidth=r+2*e.stepX,e.shapeHeight=n+2*i+e.stepY,e.vertOffset=this._calcVertOffset(e),e.textHorizOffset=this._getHorizontalTextOffset(e),
e.textVertOffset=this._getVerticalTextOffset(e)}}_calcVertOffset(e){return e.vertOffset}_drawCorner(e,t,i,s,r){const n=Math.max(1,Math.floor(2*r));e.lineTo(t-n*s.prevPointSignX,i-n*s.prevPointSignY),e.arcTo(t,i,t+n*s.nextPointSignX,i+n*s.nextPointSignY,n)}_getArrowSize(e){return e.stepX}_getHorizontalTextOffset(e){return 0}_getVerticalTextOffset(e){return 0}_hasText(e){return Boolean(e.text)||Boolean(this._text)}_drawItemText(e,t,i){var s;const r=this._getTextCache(i);if(null===r)return;const o=i.textHorizOffset||0,a=i.x+o,l=i.vertOffset,c=i.y+l+i.textVertOffset,h=(null===(s=i.style)||void 0===s?void 0:s.textColor)||this._textColor,d={style:{fillStyle:(0,n.ensureDefined)(h)},location:{x:a,y:c,horzAlign:z.Center,vertAlign:H.Middle}};r.paintTo(e,t,d)}}class ue{constructor(e,t,i,s){this.prevPointSignX=e,this.prevPointSignY=t,this.nextPointSignX=i,this.nextPointSignY=s}}var pe;!function(e){e.rightUp=new ue(1,0,0,1),e.rightDown=new ue(0,1,-1,0),e.leftDown=new ue(-1,0,0,-1),e.leftUp=new ue(0,-1,1,0)}(pe||(pe={}));class _e extends le{_calcBoundingBox(e){const t=e.width,i=e.height,s=t/2,r=Math.round(i/3),n=e.x,o=e.vertOffset-2*r,a=e.y+o,l=n-s,c=n+s,h=a,d=a+i,u=new V.Point(l,h),p=new V.Point(c,d);let _=(0,V.box)(u,p);const m=super._calcBoundingBox(e);return m&&(_=this._unionBox(_,m)),_}}const me=new Map;me.set("PaneRendererArrowUp",class extends ce{_isUp(){return!0}}),me.set("PaneRendererArrowDown",class extends ce{_isUp(){return!1}}),me.set("PaneRendererCircleShape",class extends le{_drawItemShapeUsingCSSPixels(e,t){const i=Math.max(t.width,t.height)/2,s=t.x,r=t.vertOffset,n=t.y+r;e.moveTo(s+i,n),e.arc(s,n,i,0,he,!1)}_calcBoundingBox(e){const t=Math.max(e.width,e.height)/2,i=e.x,s=e.vertOffset,r=e.y+s,n=i-t,o=i+t,a=r-t,l=r+t,c=new V.Point(n,a),h=new V.Point(o,l);let d=(0,V.box)(c,h);const u=super._calcBoundingBox(e);return u&&(d=this._unionBox(d,u)),d}}),me.set("PaneRendererCrossShape",class extends ae{_drawItemShape(e,t,i){const s=i.width,r=i.height,n=i.x-s/2,o=i.vertOffset,a=i.y-r/2+o,l=t.pixelRatio,c=this._lineWidth(t),h=c%2?.5:0,d=Math.round(n*l);let u=Math.round((n+s)*l);(u-d)%2!=c%2&&(u+=1);const p=Math.floor((d+u)/2)+h,_=Math.round(a*l);let m=Math.round((a+r)*l);(m-_)%2!=c%2&&(m+=1);const g=Math.floor((_+m)/2)+h;e.moveTo(p,_),e.lineTo(p,m),e.moveTo(d,g),e.lineTo(u,g)}_calcBoundingBox(e){const t=e.width,i=e.height,s=e.x-t/2,r=e.vertOffset,n=e.y-i/2+r,o=s,a=s+t,l=n,c=n+i,h=new V.Point(o,l),d=new V.Point(a,c);let u=(0,V.box)(h,d);const p=super._calcBoundingBox(e);return p&&(u=this._unionBox(u,p)),u}}),me.set("PaneRendererDiamond",class extends le{_drawItemShapeUsingCSSPixels(e,t){const i=Math.round(t.height/2),s=t.x,r=t.vertOffset,n=t.y+r;e.moveTo(s,n-i),e.lineTo(s+i,n),e.lineTo(s,n+i),e.lineTo(s-i,n),e.lineTo(s,n-i)}_calcBoundingBox(e){const t=Math.round(e.height/2),i=e.x,s=e.vertOffset,r=e.y+s,n=i-t,o=i+t,a=r-t,l=r+t,c=new V.Point(n,a),h=new V.Point(o,l);let d=(0,V.box)(c,h);const u=super._calcBoundingBox(e);return u&&(d=this._unionBox(d,u)),d}}),me.set("PaneRendererFlagShape",class extends le{
_drawItemShapeUsingCSSPixels(e,t){const i=t.width,s=t.height,r=s/2,n=(i-3)/3,o=t.x-i/2,a=t.vertOffset,l=t.y-r+a;e.moveTo(o,l),e.lineTo(o+3,l),e.bezierCurveTo(o+n,l-n,o+2*n,l+n,o+i,l),e.lineTo(o+i,l+r),e.bezierCurveTo(o+i-n,l+r+n,o+i-2*n,l+r-n,o+3,l+r),e.lineTo(o+3,l+s),e.lineTo(o,l+s),e.lineTo(o,l)}_calcBoundingBox(e){const t=e.width,i=e.height,s=i/2,r=e.x-t/2,n=e.vertOffset,o=e.y-s+n,a=r,l=r+t,c=o,h=o+i,d=new V.Point(a,c),u=new V.Point(l,h);let p=(0,V.box)(d,u);const _=super._calcBoundingBox(e);return _&&(p=this._unionBox(p,_)),p}}),me.set("PaneRendererLabelUp",class extends de{_calcBoundingBox(e){const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,s=e.y+e.vertOffset,r=e.y+e.shapeHeight+e.vertOffset,n=new V.Point(t,s),o=new V.Point(i,r);return(0,V.box)(n,o)}_drawItemShape(e,t,i){const s=t.pixelRatio,r=this._lineWidth(t)%2?.5:0,n=Math.max(1,Math.floor(s))%2?.5:0,o=this._getArrowSize(i);let a=Math.round(o*s);(n+a)%1!=r%1&&(a+=.5);let l=Math.round(i.shapeWidth/2*s);(n+l)%1!=r%1&&(l+=.5);const c=Math.round(i.x*s)+n,h=Math.round((i.y+i.vertOffset)*s)+r,d=c-a,u=Math.round((i.y+i.vertOffset+o)*s)+r,p=c+a,_=c+l,m=Math.round((i.y+i.vertOffset+i.shapeHeight)*s)+r,g=c-l;e.moveTo(d,u),e.lineTo(c,h),e.lineTo(p,u),i.shapeWidth<=2*o?(e.lineTo(_,u),this._drawCorner(e,_,m,pe.rightDown,s),this._drawCorner(e,g,m,pe.leftDown,s),e.lineTo(g,u)):(this._drawCorner(e,_,u,pe.rightUp,s),this._drawCorner(e,_,m,pe.rightDown,s),this._drawCorner(e,g,m,pe.leftDown,s),this._drawCorner(e,g,u,pe.leftUp,s)),e.lineTo(d,u)}_getVerticalTextOffset(e){return e.shapeHeight/2+this._getArrowSize(e)/2}_calcVertOffset(e){return Math.sign(e.vertOffset)>=0?e.vertOffset:e.vertOffset-e.shapeHeight}}),me.set("PaneRendererLabelDown",class extends de{_calcBoundingBox(e){const t=e.x-e.shapeWidth/2,i=e.x+e.shapeWidth/2,s=e.y-e.shapeHeight+e.vertOffset,r=e.y+e.vertOffset,n=new V.Point(t,s),o=new V.Point(i,r);return(0,V.box)(n,o)}_drawItemShape(e,t,i){const s=t.pixelRatio,r=this._lineWidth(t)%2?.5:0,n=Math.max(1,Math.floor(s))%2?.5:0,o=this._getArrowSize(i);let a=Math.round(o*s);(n+a)%1!=r%1&&(a+=.5);let l=Math.round(i.shapeWidth/2*s);(n+l)%1!=r%1&&(l+=.5);const c=Math.round(i.x*s)+n,h=Math.round((i.y+i.vertOffset)*s)+r,d=c+a,u=Math.round((i.y+i.vertOffset-o)*s)+r,p=c-a,_=c+l,m=Math.round((i.y+i.vertOffset-i.shapeHeight)*s)+r,g=c-l;e.moveTo(d,u),e.lineTo(c,h),e.lineTo(p,u),i.shapeWidth<=2*o?(e.lineTo(g,u),this._drawCorner(e,g,m,pe.leftUp,s),this._drawCorner(e,_,m,pe.rightUp,s),e.lineTo(_,u)):(this._drawCorner(e,g,u,pe.leftDown,s),this._drawCorner(e,g,m,pe.leftUp,s),this._drawCorner(e,_,m,pe.rightUp,s),this._drawCorner(e,_,u,pe.rightDown,s)),e.lineTo(d,u)}_getVerticalTextOffset(e){return-e.shapeHeight/2-this._getArrowSize(e)/2}_calcVertOffset(e){return Math.sign(e.vertOffset)<=0?e.vertOffset:e.vertOffset+e.shapeHeight}}),me.set("PaneRendererSquare",class extends le{_drawItemShape(e,t,i){const s=t.pixelRatio,r=Math.max(1,Math.floor(s))%2?.5:0,n=this._lineWidth(t)%2?.5:0;let o=Math.round(i.height/2*s);(r+o)%1!=n%1&&(o+=.5)
;const a=Math.round(i.x*s)+r,l=Math.round((i.y+i.vertOffset)*s)+r,c=a-o,h=l-o,d=a+o,u=l+o;e.rect(c,h,d-c,u-h)}_calcBoundingBox(e){const t=e.height,i=Math.round(t/2),s=e.x-i,r=e.vertOffset,n=e.y+r-i,o=s,a=s+t,l=n,c=n+t,h=new V.Point(o,l),d=new V.Point(a,c);let u=(0,V.box)(h,d);const p=super._calcBoundingBox(e);return p&&(u=this._unionBox(u,p)),u}}),me.set("PaneRendererTriangleApexUp",class extends _e{_drawItemShape(e,t,i){const s=i.width,r=i.height,n=Math.round(r/3),o=i.vertOffset-2*n,a=t.pixelRatio,l=this._lineWidth(t)%2?.5:0,c=Math.max(1,Math.floor(a)),h=c%2?.5:0;let d=Math.round(s*a);d%2!=c%2&&(d+=1);const u=Math.round(i.x*a)+h,p=Math.round((i.y+o)*a),_=u+d/2,m=Math.round((i.y+o+r)*a)+l,g=u-d/2;e.moveTo(u,p),e.lineTo(_,m),e.lineTo(g,m),e.lineTo(u,p)}}),me.set("PaneRendererTriangleApexDown",class extends _e{_drawItemShape(e,t,i){const s=i.width,r=i.height,n=Math.round(r/3),o=i.vertOffset-n,a=t.pixelRatio,l=this._lineWidth(t)%2?.5:0,c=Math.max(1,Math.floor(a)),h=c%2?.5:0;let d=Math.round(s*a);d%2!=c%2&&(d+=1);const u=Math.round(i.x*a)+h,p=Math.round((i.y+o)*a)+l,_=u+d/2,m=Math.round((i.y+o+r)*a),g=u-d/2;e.moveTo(g,p),e.lineTo(_,p),e.lineTo(u,m),e.lineTo(g,p)}}),me.set("PaneRendererXCross",class extends ae{_drawItemShapeUsingCSSPixels(e,t){const i=t.width,s=t.height,r=t.x-i/2,n=t.vertOffset,o=t.y-s/2+n;e.moveTo(r,o),e.lineTo(r+i,o+s),e.moveTo(r,o+s),e.lineTo(r+i,o)}_calcBoundingBox(e){const t=e.width,i=e.height,s=e.x-t/2,r=e.vertOffset,n=e.y-i/2+r,o=s,a=s+t,l=n,c=n+i,h=new V.Point(o,l),d=new V.Point(a,c);let u=(0,V.box)(h,d);const p=super._calcBoundingBox(e);return p&&(u=this._unionBox(u,p)),u}});class ge{constructor(e,t,i,s){this._items=[],this._invalidated=!1,this._renderer=null,this._isMarkersEnabled=B.enabled("source_selection_markers"),this._selectionData=null,this._plotIndex=null,this._topCoord=0,this._bottomCoord=0,this._study=e,this._series=t,this._model=i,this._plotName=s;const r=e.metaInfo().plots;for(let e=0;e<r.length;e++)if(r[e].id===this._plotName){this._plotIndex=e;break}this._colorProvider=(0,F.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._selectionIndexer=new Y.SelectionIndexes(i.timeScale())}items(){return this._items}update(){this._invalidated=!0}renderer(){if(!this._isPlotVisible()||!this._scalesReady())return null;if(this._invalidated){const e=this._study.properties().childs().styles.childs()[this._plotName];this._updateRenderer(e),this._invalidated=!1}return this._renderer}_isPlotVisible(){return this._study.isPlotVisibleAt(this._plotName,1)}_scalesReady(){const e=this._model.timeScale(),t=this._study.priceScale();return e&&null!==t&&!e.isEmpty()&&!t.isEmpty()}_updateImpl(){if(this._items=[],!this._scalesReady())return;const e=this._model.timeScale(),t=this._study.priceScale(),i=e.visibleBarsStrictRange();if(null===i||null===t)return;let s=this._series.nearestIndex(i.firstBar(),f.PlotRowSearchMode.NearestRight),r=this._series.nearestIndex(i.lastBar(),f.PlotRowSearchMode.NearestLeft);if(void 0===s||void 0===r)return;const o=this._study.offset(this._plotName);o>0?(s-=o,
r+=o):(s+=o,r-=o);const a=this._study.getMinFirstBarIndexForPlot(this._plotName);if(a>r)return;s=Math.max(a,s);const l=this._study.data(),c=this._study.firstValue();if(null===c)return;const h=l.rangeIterator(s,r),d=this._getTranspValue();let u=[];const p=this._model.selection().isSelected(this._study);p?(u=this._selectionIndexer.indexes(),this._selectionData={points:[],hittestResult:$.HitTestResult.REGULAR,vertOffset:0,bgColors:[],barSpacing:e.barSpacing(),visible:!0}):(this._selectionIndexer.clear(),this._selectionData=null);const _=this._series.properties().childs().style.value(),m=2===_?"lineStyle":3===_?"areaStyle":null;let g,v;m?(g=this._series.properties().childs()[m].childs().priceSource.value(),v=g):(g="high",v="low");const S=t.isInverted(),y=t.coordinateToPrice(t.height()*t.topMargin(),c),b=t.coordinateToPrice(t.height()*(1-t.bottomMargin()),c);this._topCoord=S?b:y,this._bottomCoord=S?y:b;const w=(0,n.ensureNotNull)(this._model.paneForSource(this._study)).height(),P=this._study.properties().childs().styles.childs()[this._plotName].childs(),C=P.color.value(),T=P.textColor?P.textColor.value():void 0,x=C,I=C,M=void 0===T?void 0:T,L=(0,n.ensureNotNull)(this._plotIndex),A=(0,Z.createEmptyStyle)();for(;h.hasNext();){const e=h.next(),t=e.index,i=e.value,s=Math.floor(t+o),r=i[L+1];if(null==r)continue;const n=this._createItem(s,r,g,v);if(null!==n){if(this._colorProvider.isColorDefined()){n.style={color:x,borderColor:I,textColor:M};const e=this._colorProvider.getPlotPointStyle(i,A);this._fillItemWithPointStyle(n,e,d)}p&&-1!==u.indexOf(t)&&null!==this._selectionData&&(this._selectionData.points.push(n),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(n.y/w))),this._items.push(n)}}this._convertItemsToCoordinates()}_fillItemWithPointStyle(e,t,i){const s=(0,n.ensureDefined)(e.style);if(void 0!==t.colors[0]){s.color=(0,R.generateColor)((0,n.ensureDefined)(t.colors[0]),i);const e=i>9?i-10:0;s.borderColor=(0,R.generateColor)(s.color,e)}void 0!==t.colors[2]&&(s.textColor=(0,R.generateColor)((0,n.ensureDefined)(t.colors[2]),i))}_updateRenderer(e){this._updateImpl();const t=this._model.timeScale(),i={},s=this._getTranspValue(),r=t.barSpacing(),n=this._calculateShapeHeight(r),o=this._study.properties().childs().styles.childs()[this._plotName].childs(),a=o.location.value(),l=this._calculateVerticalOffset(a,n+n/2);i.barSpacing=r,i.items=this._items,i.color=(0,R.generateColor)(o.color.value(),s),i.height=n,i.vertOffset=l;const c=o.plottype.value(),h=G.plotShapesData[c],d=new N.CompositeRenderer;h&&d.append(this._createRenderer(h.paneRendererClass,i)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=l,d.append(new j.SelectionRenderer(this._selectionData))),this._renderer=d}_createRenderer(e,t){const i=me.get(e);return new((0,n.ensureDefined)(i))(t)}_getSeriesVal(e,t){const i=(0,K.barFunction)(e),s=this._series.data().valueAt(t);return null===s?null:i(s)}_getTranspValue(){let e=0;const t=this._study.properties().childs()
;t.transparency&&(e=t.transparency.value(),e=(0,k.isNumber)(e)?e:50);const i=t.styles.childs()[this._plotName].childs();return i.transparency&&(e=i.transparency.value(),e=(0,k.isNumber)(e)?e:50),(0,q.clamp)(e,0,100)}_createItem(e,t,i,s){const r=this._study.properties().childs().styles.childs()[this._plotName].childs().location.value();if((null===t||0===t)&&r!==v.MarkLocation.Absolute)return null;let o;switch(r){case v.MarkLocation.AboveBar:const a=this._getSeriesVal(i,e);if(null===a)return null;o=a;break;case v.MarkLocation.BelowBar:const l=this._getSeriesVal(s,e);if(null===l)return null;o=l;break;case v.MarkLocation.Top:o=this._topCoord;break;case v.MarkLocation.Bottom:o=this._bottomCoord;break;case v.MarkLocation.Absolute:o=(0,n.ensureNotNull)(t);break;default:throw new Error("Bad value: "+r)}return new V.Point(e,o)}_convertItemsToCoordinates(){const e=this._model.timeScale(),t=this._study.priceScale();e.timedValuesToCoordinates(this._items);const i=(0,n.ensureNotNull)(this._study.firstValue());(0,n.ensureNotNull)(t).pointsArrayToCoordinates(this._items,i)}_calculateVerticalOffset(e,t){let i=0;switch(e){case v.MarkLocation.AboveBar:case v.MarkLocation.Bottom:i=-t;break;case v.MarkLocation.BelowBar:case v.MarkLocation.Top:i=t}return(0,n.ensureNotNull)(this._study.priceScale()).isInverted()&&(i*=-1),i}_calculateShapeHeight(e,t){let i=e;switch(t){case b.PlotSymbolSize.Tiny:i=.3*e;break;case b.PlotSymbolSize.Small:i=.6*e;break;case b.PlotSymbolSize.Normal:i=e;break;case b.PlotSymbolSize.Large:i=1.5*e;break;case b.PlotSymbolSize.Huge:i=2*e}return i}}class fe extends ge{_updateRenderer(e){const t=e.childs();this._updateImpl();const i=this._model.timeScale(),s={},r=this._getTranspValue(),n=i.barSpacing();let o;if(t.size){const e=t.size.value();o=this._calculateShapeHeight(25,e)}else o=Math.round(n/2);o=Math.max(o,1);const a=t.location.value(),l=(0,R.generateColor)(t.color.value(),r),c=r>19?r-10:0,h=this._calculateVerticalOffset(a,Math.round(1.5*o));s.barSpacing=n,s.items=this.items(),s.color=l,s.borderColor=(0,R.generateColor)(t.color.value(),c),s.height=o,s.vertOffset=h;const d=t.plottype.value(),u=G.plotShapesData[d],p=new N.CompositeRenderer,_=t.text?t.text.value():void 0;if(void 0!==_&&""!==_.trim()){let e=_.trim().replace(/\\n/gm,"\n");e=(0,U.cleanButAmpersand)(e,!0),s.text=e,s.fontSize=12;const i=t.textColor?t.textColor.value():void 0;s.textColor=i?(0,R.generateColor)(i,r):l}p.append(super._createRenderer(u.paneRendererClass,s)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=h,p.append(new j.SelectionRenderer(this._selectionData))),this._renderer=p}}var ve=i(687795),Se=i.n(ve),ye=i(918922);class be extends oe{constructor(e,t){super(null,t),this._fontSizeEnsured=0,this._ch="",this._fontFamily=ne.CHART_FONT_FAMILY,this._charCache=null,null!==e&&this.setData(e)}setData(e){super.setData(e),this._fontSizeEnsured=(0,n.ensureDefined)(this._height);const t=e.char.slice(0,40);this._ch=Se()(t)[0]||" ",
this._fontFamily=e.fontFamily||ne.CHART_FONT_FAMILY}hitTest(e){const t=(0,ye.interactionTolerance)().series+this._fontSizeEnsured/2;for(const i of this._items){if(new V.Point(i.x,i.y+i.vertOffset).subtract(e).length()<=t)return new $.HitTestResult($.HitTestResult.REGULAR)}return null}_drawItemShape(e,t,i){const s=i.x,r=i.vertOffset>0?1:-1,n=i.y+i.vertOffset-r*Math.round(this._fontSizeEnsured/2);let o;o=i.style&&void 0!==i.style.color?i.style.color:this._color;const a=this._textImageCache(),l=t.pixelRatio;if(this._fontSizeEnsured<=4/l){e.save();const t=Math.max(1,Math.floor(l));let r=Math.max(1,Math.floor(a.textImageWidth*l));r%2!=t%2&&(r+=r>1?-1:1);const c=Math.round(n*l)+(i.vertOffset>=0?0:-r);return e.fillStyle=o,e.fillRect(Math.round(s*l)+(l%2?.5:0)-r/2,c,r,r),void e.restore()}const c={style:{fillStyle:o},location:{x:s,y:n,horzAlign:z.Center,vertAlign:i.vertOffset>0?H.Top:H.Bottom}};a.paintTo(e,t,c)}_startPath(e,t,i,s){}_endPath(e){}_textImageCache(){return null!==this._charCache&&this._charCache.fontFamily===this._fontFamily&&this._charCache.fontSize===this._fontSizeEnsured||(this._charCache={fontSize:this._fontSizeEnsured,fontFamily:this._fontFamily,cache:new se(this._ch,!1,!1,this._fontFamily,this._fontSizeEnsured,"center",0)}),this._charCache.cache}}class we extends ge{constructor(){super(...arguments),this._compositeRenderer=new N.CompositeRenderer,this._charRenderer=new be(null)}renderer(){return this._isPlotVisible()&&this._scalesReady()?(this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._compositeRenderer):null}_updateImpl(){if(this._compositeRenderer.clear(),super._updateImpl(),0===this._items.length)return;const e=this._getTranspValue(),t=this._model.timeScale().barSpacing();let i;const s=this._study.properties().childs().styles.childs()[this._plotName].childs();if(s.size){const e=s.size.value();i=this._calculateShapeHeight(50,e)}else i=Math.round(t);const r=s.location.value(),n=(0,R.generateColor)(s.color.value(),e),o=this._calculateVerticalOffset(r,i),a={items:this.items(),barSpacing:t,char:s.char.value(),height:i,vertOffset:o,color:n},l=s.text?s.text.value():void 0;if(void 0!==l&&""!==l.trim()){let t=l.trim().replace(/\\n/gm,"\n");t=(0,U.cleanButAmpersand)(t,!0),a.text=t,a.fontSize=12;const i=s.textColor?s.textColor.value():void 0;a.textColor=i?(0,R.generateColor)(i,e):n}this._charRenderer.setData(a),this._compositeRenderer.append(this._charRenderer),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&null!==this._selectionData&&(this._selectionData.vertOffset=o,this._compositeRenderer.append(new j.SelectionRenderer(this._selectionData)))}}var Pe=i(724377);class Ce extends V.Point{constructor(e,t,i,s){super(e,t),this.height=i,this.isUp=s,this.style={}}}function Te(e){return Math.round(e/4)}function xe(e){return Math.round(e/2)}class Ie{constructor(e){this._data=e}draw(e,t){var i;const s=t.pixelRatio,r=this._data,n=xe(r.barSpacing),o=Te(r.barSpacing),a=n<4,l=Math.max(n/2,1),c=(0,q.ceiledEven)(n*s),h=c/2,d=Math.round(n*s);e.lineCap="butt",
e.lineWidth=Math.max(1,Math.floor(s));const u=e.lineWidth%2?.5:0;for(const t of r.items){const n=t.isUp?-1:1,p=Math.round(Math.abs(t.height)*s),_=Math.round(t.x*s)+u,m=Math.round((t.y-n*o)*s)+u;e.beginPath(),e.translate(_,m);const g=null!==(i=t.style&&t.style.color)&&void 0!==i?i:t.isUp?r.colorup:r.colordown;a?(e.moveTo(0,0),e.lineTo(-h,-h*n),e.moveTo(0,0),e.lineTo(h,-h*n),e.moveTo(0,0),e.lineTo(0,-p*n),e.moveTo(-h,-p*n),e.lineTo(h,-p*n),e.lineWidth=l,e.strokeStyle=g,e.stroke()):(e.moveTo(0,0),p<d?(e.lineTo(c,-p*n),e.lineTo(-c,-p*n)):(e.lineTo(c,-d*n),e.lineTo(h,-d*n),e.lineTo(h,-p*n),e.lineTo(-h,-p*n),e.lineTo(-h,-d*n),e.lineTo(-c,-d*n)),e.lineTo(0,0),e.strokeStyle=t.isUp?r.colorBorderUp:r.colorBorderDown,e.stroke(),e.fillStyle=g,e.fill()),e.translate(-_,-m)}}hitTest(e){const t=this._data,i=xe(t.barSpacing),s=Math.round(i/2),r=Math.round(i),n=Te(t.barSpacing);for(const i of t.items){if(!i)continue;if(!Number.isFinite(i.x)||!Number.isFinite(i.y))continue;const t=Math.abs(i.height),o=i.isUp?-1:1,a=t+r,l=i.y-o*n,c=l-o*a,h=i.x-s,d=i.x+s;if(h<e.x&&e.x<d&&(i.isUp?l<e.y&&e.y<c:c<e.y&&e.y<l))return new $.HitTestResult($.HitTestResult.REGULAR)}return null}}class Me extends j.SelectionRenderer{_drawMarker(e,t,i,s,r){const o=(0,n.ensureNotNull)(this._data),a=t.isUp?1:-1;const l=i+a*Te(o.barSpacing)+a*xe(o.barSpacing);let c=Math.round(3.5*r*2);c%2!=s%2&&(c+=1);const h=s%2/2,d=Math.round(t.x*r)+h,u=Math.round((t.y+l)*r)+h;e.beginPath(),e.arc(d,u,c/2,0,2*Math.PI,!0),e.closePath(),e.fill(),e.stroke()}}class Le extends ge{constructor(){super(...arguments),this._maxAbsValue=0}renderer(){if(!this._isPlotVisible()||!this._scalesReady())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e=this._study.properties().childs().styles.childs()[this._plotName].childs(),t={},i=(0,q.clamp)(this._getTranspValue(),0,100),s=this._model.timeScale().barSpacing();t.items=this._items,t.barSpacing=s,t.colorup=(0,R.generateColor)(e.colorup.value(),i),t.colordown=(0,R.generateColor)(e.colordown.value(),i);const r=(0,Pe.parseRgba)(t.colorup),n=r?100*(1-r[3]):0,o=(0,Pe.parseRgba)(t.colordown),a=o?100*(1-o[3]):0;t.colorBorderUp=(0,R.generateColor)("#000000",n),t.colorBorderDown=(0,R.generateColor)("#000000",a),t.minHeight=e.minHeight.value(),t.maxHeight=e.maxHeight.value();const l=new N.CompositeRenderer;if(l.append(new Ie(t)),this._model.selection().isSelected(this._study)&&null!==this._selectionData){const e=this._selectionData;e.barSpacing=s,l.append(new Me(e))}return l}_fillItemWithPointStyle(e,t,i){const s=(0,n.ensureDefined)(e.style);e.isUp?void 0!==t.colors[5]?s.color=(0,R.generateColor)((0,n.ensureDefined)(t.colors[5]),i):s.color=(0,R.generateColor)(this._study.properties().childs().styles.childs()[this._plotName].childs().colorup.value(),i):void 0!==t.colors[6]?s.color=(0,R.generateColor)((0,n.ensureDefined)(t.colors[6]),i):s.color=(0,R.generateColor)(this._study.properties().childs().styles.childs()[this._plotName].childs().colordown.value(),i)}_createItem(e,t,i,s){if(0===t)return null
;Math.abs(t)>this._maxAbsValue&&(this._maxAbsValue=Math.abs(t));const r=t>0;let n;if(r){const t=this._getSeriesVal(s,e);if(null===t)return null;n=t}else{const t=this._getSeriesVal(i,e);if(null===t)return null;n=t}return new Ce(e,n,t,r)}_convertItemsToCoordinates(){const e=this._model.timeScale(),t=(0,n.ensureNotNull)(this._study.priceScale());e.timedValuesToCoordinates(this._items),t.pointsArrayToCoordinates(this._items,(0,n.ensureNotNull)(this._study.firstValue()));const i=this._study.properties().childs().styles.childs();let s=Math.abs(i[this._plotName].childs().minHeight.value()),r=Math.abs(i[this._plotName].childs().maxHeight.value());if(s>r){const e=s;s=r,r=e}const o=(r-s)/this._maxAbsValue,a=this._items;for(let e=0;e<a.length;e++){const t=a[e],i=Math.abs(t.height);t.height=i*o+s}}}var Ae=i(611593);class ke{constructor(e,t,i,s){this._bars=[],this._invalidated=!1,this._isMarkersEnabled=B.enabled("source_selection_markers"),this._selectionData=null,this._ohlcPlotIndexes=new Map,this._study=e,this._series=t,this._model=i,this._plotName=s,this._isMarkersEnabled=B.enabled("source_selection_markers"),this._colorProvider=(0,F.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._selectionIndexer=new Y.SelectionIndexes(i.timeScale());const r=this._study.metaInfo().plots;for(let e=0;e<r.length;e++){const t=r[e];"target"in t&&(t.target===this._plotName&&((0,b.isOhlcOpenPlot)(t)&&this._ohlcPlotIndexes.set(1,e),(0,b.isOhlcHighPlot)(t)&&this._ohlcPlotIndexes.set(2,e),(0,b.isOhlcLowPlot)(t)&&this._ohlcPlotIndexes.set(3,e),(0,b.isOhlcClosePlot)(t)&&this._ohlcPlotIndexes.set(4,e)))}}update(){this._invalidated=!0}items(){return this._bars}_updateImpl(){this._bars.length=0;const e=this._study.priceScale();if(this._model.timeScale().isEmpty()||null===e||e.isEmpty())return;const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return;let i=this._series.nearestIndex(t.firstBar(),f.PlotRowSearchMode.NearestRight);const s=this._series.nearestIndex(t.lastBar(),f.PlotRowSearchMode.NearestLeft);if(void 0===i||void 0===s)return;const r=this._study.getMinFirstBarIndexForPlot(this._plotName);if(r>s)return;i=Math.max(r,i);const o=this._study.data(),a=this._study.firstValue();if(null===a)return;const l=o.rangeIterator(i,s),c=(0,n.ensureDefined)(this._study.properties().childs().ohlcPlots).childs()[this._plotName].childs(),h=new Map,d=(e,t)=>{const i=e+"@"+t;if(!h.has(i)){const s=(0,R.generateColor)(e,t);return h.set(i,s),s}return h.get(i)},u=(0,Z.createEmptyStyle)();for(;l.hasNext();){const e=l.next();let t=e.index;const i=e.value;t=Math.floor(t);let s=!0;const r=new Map;for(let e=1;e<=4;++e){const t=this._ohlcPlotIndexes.get(e);if(void 0===t){s=!1;break}const n=i[t+1];if(null==n){s=!1;break}r.set(e,n)}if(!s)continue;const o=(0,n.ensureDefined)(r.get(1)),a=(0,n.ensureDefined)(r.get(4)),h=(0,n.ensureDefined)(r.get(2)),p=(0,n.ensureDefined)(r.get(3)),_=Math.max(o,h,p,a),m=Math.min(o,h,p,a);let g=(0,n.ensureDefined)(d(c.color.value(),0));const f=this._colorProvider.getPlotPointStyle(i,u);void 0!==f.colors[0]&&(g=(0,
n.ensureDefined)(f.colors[0]));const v={time:Math.round(t),open:o,high:_,low:m,close:a,color:g,wickColor:f.colors[4],borderColor:f.colors[3],hollow:null};this._bars.push(v)}if(e.barPricesToCoordinates(this._bars,a),this._model.timeScale().barIndexesToCoordinates(this._bars),this._model.selection().isSelected(this._study)){const t=this._selectionIndexer.indexes();this._selectionData={points:[],hittestResult:$.HitTestResult.REGULAR,bgColors:[],visible:!0,barSpacing:this._model.timeScale().barSpacing()};const i=(0,n.ensureNotNull)(this._model.paneForSource(this._study)).height(),s=(0,n.ensureDefined)(this._ohlcPlotIndexes.get(4));for(let r=0;r<t.length;r++){const n=t[r],o=this._study.data().valueAt(n);if(null===o)continue;const l=o[s+1];if(null==l)continue;const c=this._model.timeScale().indexToCoordinate(Math.floor(n)),h=e.priceToCoordinate(l,a);this._selectionData.points.push(new V.Point(c,h)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(h/i))}}else this._selectionIndexer.clear()}_isOHLCPlotVisible(){return this._study.isPlotVisibleAt(this._plotName,1)}}class Ee extends ke{renderer(){if(!this._isOHLCPlotVisible())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={bars:this._bars,barSpacing:this._model.timeScale().barSpacing(),dontDrawOpen:this._series.properties().childs().barStyle.childs().dontDrawOpen.value(),thinBars:this._series.properties().childs().barStyle.childs().thinBars.value()},t=new N.CompositeRenderer;return t.append(new Ae.PaneRendererBars(e)),this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&this._selectionData&&t.append(new j.SelectionRenderer(this._selectionData)),t}}var De=i(71133);class Be extends ke{renderer(){if(!this._isOHLCPlotVisible())return null;this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e=(0,n.ensureDefined)(this._study.properties().childs().ohlcPlots).childs()[this._plotName].childs(),t=this._model.timeScale().barSpacing(),i={bars:this._bars,barSpacing:t,wickVisible:e.drawWick.value(),bodyVisible:!0,borderVisible:e.drawBorder.value(),barWidth:(0,ye.optimalBarWidth)(t),borderColor:e.borderColor.value(),wickColor:e.wickColor.value()},s=new N.CompositeRenderer;return s.append(new De.PaneRendererCandles(i)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&s.append(new j.SelectionRenderer(this._selectionData)),s}}var Ve=i(70362),Re=i(40371),Ne=i(953854),Oe=i(284269);class Fe extends Ne.HorizontalLinePaneView{constructor(e,t){super(),this._lineRendererData.linestyle=Oe.LINESTYLE_DOTTED,this._study=e,this._plotName=t}_updateImpl(){this._lineRendererData.visible=!1;const e=this._study.properties().childs().styles.childs()[this._plotName].childs();if(!e.trackPrice.value()||!this._study.isPlotVisibleAt(this._plotName,1))return;const t=this._study.lastValueData(this._plotName,!0);t.noData||(this._lineRendererData.visible=!0,this._lineRendererData.y=t.coordinate,this._lineRendererData.color=t.color,
this._lineRendererData.linewidth=e.linewidth.value())}}class We{constructor(){this._items=[],this._actualLength=0,this._invalidations=0}push(e){this._items.length===this._actualLength?this._items.push(e):this._items[this._actualLength]!==e&&(this._items[this._actualLength]=e),this._actualLength+=1}newItem(){const e=this._items.length>this._actualLength?this._items[this._actualLength]:null;return null!==e&&Boolean(e.invalidateCache)&&e.invalidateCache(),e}invalidateCache(){this._invalidations+=1,3e3===this._invalidations&&(this._items.splice(this._actualLength),this._invalidations=0),this._actualLength=0}at(e){return this._items[e]}data(){return this._items}length(){return this._actualLength}}class ze extends We{constructor(e){super(),this.color=e}}class He{constructor(){this._map=new Map,this._usedKeys=new Set,this._invalidations=0}invalidateCache(){this._invalidations+=1,50===this._invalidations&&(this._deleteUnused(),this._invalidations=0),this._usedKeys.clear(),this._map.forEach(((e,t)=>e.invalidateCache()))}get(e){const t=this._map.get(e);return void 0!==t&&this._usedKeys.add(e),t}set(e,t){this._usedKeys.add(e),this._map.set(e,t)}forEach(e){this._map.forEach(((t,i)=>{this._usedKeys.has(i)&&e(t,i)}))}delete(e){const t=this._map.get(e);void 0!==t&&t.invalidateCache(),this._usedKeys.delete(e)}_deleteUnused(){const e=[];this._map.forEach(((t,i)=>{this._usedKeys.has(i)||e.push(i)}));for(const t of e)this._map.delete(t)}}class Ue extends We{constructor(){super(),this.points1=new We,this.points2=new We,this.push(this.points1),this.push(this.points2)}addPoints1Point(e,t){let i=this.points1.newItem();null!==i?(i.x=e,i.y=t):i={x:e,y:t},this.points1.push(i)}addPoints2Point(e,t){let i=this.points2.newItem();null!==i?(i.x=e,i.y=t):i={x:e,y:t},this.points2.push(i)}invalidateCache(){this.points1.invalidateCache(),this.points2.invalidateCache()}}class je{constructor(){this._data=null}setData(e){this._data=e}hitTest(e,t){return null}draw(e,t){if(null===this._data)return;const i=t.pixelRatio,s=.25*this._data.barSpacing;this._data.colorAreas.forEach((t=>{var r,n;e.beginPath();for(let r=0;r<t.length();r++){const n=t.at(r);if(0===n.points1.length()||0===n.points2.length())continue;const o=n.points1.at(0).x,a=n.points1.at(0).y;if(e.moveTo(Math.round(o*i),a*i),1!==n.points1.length()&&1!==n.points2.length()){for(let t=1;t<n.points1.length();t++)e.lineTo(Math.round(n.points1.at(t).x*i),n.points1.at(t).y*i);for(let t=n.points2.length()-1;t>=0;t--)e.lineTo(Math.round(n.points2.at(t).x*i),n.points2.at(t).y*i)}else{const t=n.points2.at(0).x,r=n.points2.at(0).y;e.lineTo(Math.round((o+s)*i),a*i),e.lineTo(Math.round((t+s)*i),r*i),e.lineTo(Math.round((t-s)*i),r*i),e.lineTo(Math.round((o-s)*i),a*i)}}if(e.closePath(),0===t.color.type)e.fillStyle=t.color.color;else{const s=e.createLinearGradient(0,t.color.value1*i,0,t.color.value2*i);s.addColorStop(0,null!==(r=t.color.color1)&&void 0!==r?r:"transparent"),s.addColorStop(1,null!==(n=t.color.color2)&&void 0!==n?n:"transparent"),e.fillStyle=s}e.fill()}))}}function Ge(e){
return 0===e.type?`${e.color}`:`${e.color1}:${e.color2}:${e.value1}:${e.value2}`}class qe extends We{constructor(){super(...arguments),this._startIndex=0}setStartIndex(e){this._startIndex=e}isValidIndex(e){return e>=this._startIndex}at(e){const t=e-this._startIndex;for(;t>=this._actualLength;)this._items.length<=t?this._items.push(this._newObject()):this._clearObject(this._items[this._actualLength]),this._actualLength+=1;return this._items[t]}}class $e extends qe{_newObject(){return{plot1Value:void 0,plot2Value:void 0,colorValue:void 0}}_clearObject(e){e.plot1Value=void 0,e.plot2Value=void 0,e.colorValue=void 0}}class Ye extends qe{_newObject(){return{type:void 0,colorIndexOrRgba:void 0,colorIndexOrRgba1:void 0,colorIndexOrRgba2:void 0,value1:void 0,value2:void 0}}_clearObject(e){const t=e;t.type=void 0,t.colorIndexOrRgba=void 0,t.colorIndexOrRgba1=void 0,t.colorIndexOrRgba2=void 0,t.value1=void 0,t.value2=void 0}}class Ke{constructor(e,t,i=!1){this._isHlineFill=!1,this._bandAKey=null,this._bandBKey=null,this._colorPlotIndex=null,this._colors=new We,this._areaRenderer=new je,this._invalidated=!0,this._plIndex1=null,this._plIndex2=null,this._level1=0,this._level2=0,this._studyValuesCache=new $e,this._colorValuesCache=new Ye,this._points1=new We,this._points2=new We,this._timePoints=new We,this._colorAreas=new He,this._source=e,this._model=t,this._fillGaps=i}update(){this._invalidated=!0}renderer(e,t){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._areaRenderer}_correctVisibleRange(e,t){var i,s,r,n;const o=this._source.data().plottableRange(),a=e.firstBar()+Math.min(0,t)-1,l=e.lastBar()-t+1,c=this._plotIndex1(),h=this._plotIndex2(),d=o.search(a,f.PlotRowSearchMode.NearestLeft,c),u=o.search(a,f.PlotRowSearchMode.NearestLeft,h),p=o.search(l,f.PlotRowSearchMode.NearestRight,c),_=o.search(l,f.PlotRowSearchMode.NearestRight,h),m=Math.min(null!==(i=null==d?void 0:d.index)&&void 0!==i?i:1/0,e.firstBar()-1),g=Math.min(null!==(s=null==u?void 0:u.index)&&void 0!==s?s:1/0,e.firstBar()-1),v=Math.max(null!==(r=null==p?void 0:p.index)&&void 0!==r?r:-1/0,e.lastBar()+1),S=Math.max(null!==(n=null==_?void 0:_.index)&&void 0!==n?n:-1/0,e.lastBar()+1);let y=1/0;if(null!==this._colorPlotIndex&&(null!==d||null!==u)){const e=o.search(Math.min(m,g)-1,f.PlotRowSearchMode.NearestLeft);null!==e&&(y=e.index)}return[Math.min(m,g,y),Math.max(v,S)]}_plotNames(){return this._source.metaInfo().plots.map((e=>e.id))}_plotIndex1(){return null===this._plIndex1&&(this._plIndex1=this._plotNames().indexOf(this._plotAId())+1),this._plIndex1}_plotIndex2(){return null===this._plIndex2&&(this._plIndex2=this._plotNames().indexOf(this._plotBId())+1),this._plIndex2}_updateImpl(){var e,t;if(this._areaRenderer.setData(null),!this._visible())return;const i=this._source.priceScale(),s=this._model,r=s.timeScale();if(!i||i.isEmpty()||r.isEmpty())return;if(s.mainSeries().bars().isEmpty())return;const o=this._source.firstValue();if(null===o)return;if(this._isHlineFill){const e=this._source.properties().bands[(0,
n.ensureNotNull)(this._bandAKey)],t=this._source.properties().bands[(0,n.ensureNotNull)(this._bandBKey)];this._level1=i.priceToCoordinate(e.value.value(),o),this._level2=i.priceToCoordinate(t.value.value(),o)}const a=r.visibleBarsStrictRange();if(null===a)return;const l=new Map,c=e=>{let t=l.get(e);return void 0===t&&(t=i.priceToCoordinate(e,o),l.set(e,t)),t},h=(0,q.clamp)(this._transparency(),0,100),d=new Map,u=e=>{let t=d.get(e);return void 0===t&&(t=(0,R.generateColor)(e,h),d.set(e,t)),t};this._timePoints.invalidateCache(),this._points1.invalidateCache(),this._points2.invalidateCache(),this._colors.invalidateCache(),this._colorAreas.invalidateCache();const p=this._source.offset(this._plotAId()),_=this._source.offset(this._plotBId()),m=Math.min(p,_),g=Math.max(p,_),[f,v]=this._correctVisibleRange(a,g),S=null!==this._colorPlotIndex?this._colors:null,y=this._plotIndex1(),b=this._plotIndex2(),w=this._source.data().plottableRange();if(w.isEmpty())return;let P,C;const T=(0,n.ensureNotNull)(w.firstIndex()),x=(0,n.ensureNotNull)(w.lastIndex()),I=T-Math.max(0,-m),M=x+Math.max(0,g),L=Math.max(f,I),A=Math.min(v,M),k=this._studyValuesCache,E=this._colorValuesCache;k.invalidateCache(),E.invalidateCache();const D=L-g,B=w.rangeIterator(D,A-m);let V;for(k.setStartIndex(D),E.setStartIndex(D);B.hasNext();){const e=B.next(),t=e.index,i=e.value,s=i[y],r=i[b],o=t+p,a=t+_;if(o===a&&k.isValidIndex(o)){const e=k.at(o);e.plot1Value=s,e.plot2Value=r}else{if(k.isValidIndex(o)){k.at(o).plot1Value=s}if(k.isValidIndex(a)){k.at(a).plot2Value=r}}if(null!==S&&void 0!==V){const e=V+m;if(k.isValidIndex(e)){const t=k.at(e),s=(0,n.ensureNotNull)(this._colorPlotIndex);if(0===s.type){const r=E.at(e);t.colorValue=r,r.type=0,r.colorIndexOrRgba=i[s.colorIndexOrRgba+1]}else{const r=E.at(e);t.colorValue=r,r.colorIndexOrRgba1=void 0===s.colorIndexOrRgba1?void 0:i[s.colorIndexOrRgba1+1],r.colorIndexOrRgba2=void 0===s.colorIndexOrRgba2?void 0:i[s.colorIndexOrRgba2+1],r.value1=void 0===s.valueIndex1?void 0:i[s.valueIndex1+1],r.value2=void 0===s.valueIndex2?void 0:i[s.valueIndex2+1]}}}V=t}const N=this._timePoints,O=this._points1,F=this._points2;let W=null;const z=D+k.length();for(let i=D;i<z;i++){if(!this._fillGaps&&(null===P||null===C)){const e=i-1;N.push(e),O.push(NaN),F.push(NaN),null==S||S.push(null)}const s=k.at(i);if(null!==this._colorPlotIndex){const e=s.colorValue;void 0===e||0===e.type&&null==e.colorIndexOrRgba||1===e.type&&(void 0!==this._colorPlotIndex.valueIndex1&&null==e.value1||void 0!==this._colorPlotIndex.valueIndex2&&null==e.value2)?W=null:(W=this._getColorByPlotValue(e),null!==W&&(1===W.type?(W.value1=c(W.value1),W.value2=c(W.value2),W.color1=W.color1&&u(W.color1),W.color2=W.color2&&u(W.color2)):W.color=u(W.color)))}if(this._isHlineFill){N.push(i),null!==S&&S.push(W);continue}const r=null!==(e=s.plot1Value)&&void 0!==e?e:null,n=null!==(t=s.plot2Value)&&void 0!==t?t:null;(null!==r||null!==n||Number.isFinite(P)||Number.isFinite(C))&&(P=r,C=n,O.push(r),F.push(n),N.push(i),null!==S&&S.push(W))}i.pricesArrayToCoordinates(O.data(),o,O.length()),
i.pricesArrayToCoordinates(F.data(),o,F.length()),r.indexesToCoordinates(N.data(),N.length());const H={barSpacing:this._model.timeScale().barSpacing(),colorAreas:this._getFilledAreas(N,O,F,S,c,u)};this._areaRenderer.setData(H)}_getFilledAreas(e,t,i,s,r,n){var o,a;const l=this._isHlineFill;if(!l&&(0===t.length()||0===i.length()))return new He;const c=this._colorAreas;let h=null,d=null;const u={type:0,color:""},p=this._commonColor();1===p.type?(p.value1=r(p.value1),p.value2=r(p.value2),p.color1=p.color1&&n(p.color1),p.color2=p.color2&&n(p.color2)):p.color=n(p.color);const _=e.length();for(let r=0;r<_;r++){const n=l?this._level1:t.at(r),f=l?this._level2:i.at(r),v=e.at(r),S=(0,ye.coordinateIsValid)(n),y=(0,ye.coordinateIsValid)(f);if(this._fillGaps?S||y:S&&y){const e=s?s.at(r)||u:p;if(g=e,!(null===(m=d)||null===g?m===g:0===m.type&&0===g.type?m.color===g.color:1===m.type&&1===g.type&&m.color1===g.color1&&m.color2===g.color2&&m.value1===g.value1&&m.value2===g.value2)||null===h){if(null!==h&&(S&&h.addPoints1Point(v,n),y&&h.addPoints2Point(v,f)),r===_-1)continue;d=e;const t=Ge(e),i=null!==(o=c.get(t))&&void 0!==o?o:new ze(e);h=null!==(a=i.newItem())&&void 0!==a?a:new Ue,i.push(h),c.set(t,i)}S&&h.addPoints1Point(v,n),y&&h.addPoints2Point(v,f)}else this._fillGaps||(d=null,h=null)}var m,g;return c.delete(Ge(u)),c}}class Ze extends Ke{constructor(e,t){super(e,t)}_plotAId(){return this._source.properties().area[0].name.value()}_plotBId(){return this._source.properties().area[1].name.value()}_commonColor(){return{type:0,color:this._source.properties().areaBackground.backgroundColor.value()}}_transparency(){const e=this._source.properties().areaBackground.transparency.value();return(0,q.clamp)(e,0,100)}_visible(){return this._source.properties().areaBackground.fillBackground.value()}_getColorByPlotValue(e){return this._commonColor()}}const Xe={type:0,color:"transparent"};class Je extends Ke{constructor(e,t,i,s){var r,o,a;super(e,t,!!i.fillgaps),this._palettesInfo={},this._gradientPropsStateCache=null;const l=this._source.metaInfo();this._isRGB=Boolean(l.isRGB),this._isHlineFill="hline_hline"===i.type,(0,n.assert)(this._isHlineFill||"plot_plot"===i.type,"Wrong filledArea type: "+i.type),this._isHlineFill&&this._initBandIndexes(i.objAId,i.objBId),this._fillMetaInfo=i,this._fillStyleProps=s,this._gradientFillType=s.hasChild("fillType")&&"gradient"===(null===(r=s.childs().fillType)||void 0===r?void 0:r.value()),this._gradientStaticState={color1:i.topColor,color2:i.bottomColor,value1:i.topValue,value2:i.bottomValue},this._hasAllGradientRequiredProps=this._gradientFillType&&(void 0!==this._gradientStaticState.color1||s.hasChild("topColor")||void 0!==this._gradientStaticState.color2||s.hasChild("bottomColor"))&&(void 0!==this._gradientStaticState.value1||s.hasChild("topValue"))&&(void 0!==this._gradientStaticState.value2||s.hasChild("bottomValue"));const c=()=>{var e;return this._colorPlotIndex=null!==(e=this._colorPlotIndex)&&void 0!==e?e:{type:1}};for(let t=0;t<l.plots.length;++t){const s=l.plots[t];if(((0,b.isColorerPlot)(s)||(0,
b.isDataPlot)(s))&&s.target===i.id){if((0,b.isColorerPlot)(s)){let i;void 0!==s.targetField?"topColor"===s.targetField?(c().colorIndexOrRgba1=t,i="color1"):"bottomColor"===s.targetField&&(c().colorIndexOrRgba2=t,i="color2"):this._colorPlotIndex={type:0,colorIndexOrRgba:t},(0,b.isPaletteColorerPlot)(s)&&(this._palettesInfo[null!=i?i:"color"]={map:(0,n.ensureDefined)(null===(o=(0,n.ensureDefined)(l.palettes)[s.palette])||void 0===o?void 0:o.valToIndex),values:e.properties().palettes[s.palette].colors})}else(0,b.isDataPlot)(s)&&("topValue"===s.targetField?c().valueIndex1=t:"bottomValue"===s.targetField&&(c().valueIndex2=t));if(0===(null===(a=this._colorPlotIndex)||void 0===a?void 0:a.type))break}}}update(){super.update(),this._gradientPropsStateCache=null}_getColorByPlotValue(e){var t,i,s;if(0===e.type){let i;if(this._isRGB){if(null==e.colorIndexOrRgba)return null;i=(0,R.rgbaFromInteger)(e.colorIndexOrRgba)}else{const s=(0,n.ensureDefined)(this._palettesInfo.color),r=(0,n.ensureDefined)(s.map[(0,n.ensure)(e.colorIndexOrRgba)]);i=null===(t=s.values[r])||void 0===t?void 0:t.childs().color.value()}return{type:0,color:i}}const r=this._gradientColorPropsState();let o,a;if(this._isRGB)null!=e.colorIndexOrRgba1&&(o=(0,R.rgbaFromInteger)(e.colorIndexOrRgba1)),null!=e.colorIndexOrRgba2&&(a=(0,R.rgbaFromInteger)(e.colorIndexOrRgba2));else{if(null!=e.colorIndexOrRgba1){const t=(0,n.ensureDefined)(this._palettesInfo.color1);o=t.values[(0,n.ensureDefined)(t.map[e.colorIndexOrRgba1])].childs().color.value()}if(null!=e.colorIndexOrRgba2){const t=(0,n.ensureDefined)(this._palettesInfo.color2);a=t.values[(0,n.ensureDefined)(t.map[e.colorIndexOrRgba2])].childs().color.value()}}const l=null!==(i=e.value1)&&void 0!==i?i:r.value1,c=null!==(s=e.value2)&&void 0!==s?s:r.value2;return o=null!=o?o:r.color1,a=null!=a?a:r.color2,void 0===l||void 0===c||void 0===o&&void 0===a?null:{type:1,color1:o,color2:a,value1:l,value2:c}}_plotAId(){return this._fillMetaInfo.objAId}_plotBId(){return this._fillMetaInfo.objBId}_commonColor(){const e=this._fillStyleProps.childs();if(this._gradientFillType){if(!this._hasAllGradientRequiredProps)return Xe;const e=this._gradientColorPropsState();return{type:1,color1:e.color1,color2:e.color2,value1:e.value1,value2:e.value2}}return{type:0,color:e.color.value()}}_transparency(){return this._fillStyleProps.childs().transparency.value()}_correctVisibleRange(e,t){const[i,s]=super._correctVisibleRange(e,t),r=this._source.getMinFirstBarIndexForPlot(this._fillMetaInfo.id);return[Math.max(r,i),s]}_visible(){return this._fillStyleProps.childs().visible.value()}_initBandIndexes(e,t){this._bandAKey=null,this._bandBKey=null;const i=this._source.metaInfo().bands;if(void 0!==i)for(let s=0;s<i.length;++s){const r=i[s];null!==this._bandAKey||r.id!==e?null===this._bandBKey&&r.id===t&&(this._bandBKey=s):this._bandAKey=s}}_gradientColorPropsState(){var e,t,i,s;if(null===this._gradientPropsStateCache){const r=this._fillStyleProps.state();this._gradientPropsStateCache={
color1:null!==(e=this._gradientStaticState.color1)&&void 0!==e?e:r.topColor,color2:null!==(t=this._gradientStaticState.color2)&&void 0!==t?t:r.bottomColor,value1:null!==(i=this._gradientStaticState.value1)&&void 0!==i?i:r.topValue,value2:null!==(s=this._gradientStaticState.value2)&&void 0!==s?s:r.bottomValue}}return this._gradientPropsStateCache}}var Qe=i(492326),et=i(68976);class tt{constructor(e,t){this._invalidated=!0,this._lineRenderer=new et.HorizontalLineRenderer,this._source=t,this._points=[new V.Point(-1,-1)],this._invalidated=!0,this._properties=e}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={y:this._points[0].y,color:this._properties.childs().color.value(),linewidth:this._properties.childs().linewidth.value(),linestyle:this._properties.childs().linestyle.value()};return this._lineRenderer.setData(e),this._lineRenderer}_updateImpl(){const e=this._source.priceScale();if(!e||e.isEmpty())return void(this._points[0]=new V.Point(-1,-1));const t=this._properties.childs().value.value(),i=this._source.firstValue(),s=(0,k.isNumber)(t)&&null!==i?e.priceToCoordinate(t,i):NaN;this._points[0]=new V.Point(-1,s)}}var it=i(716384);class st extends it.MediaCoordinatesPaneRenderer{constructor(){super(),this._data=null,this._data=null}setData(e=null){this._data=e}hitTest(){return null}_drawImpl(e){var t,i;if(null===this._data||0===this._data.points.length)return;const s=e.context,r=e.mediaSize.width;if(this._data.gradient){const e=s.createLinearGradient(0,this._data.coordinate1,0,this._data.coordinate2);e.addColorStop(0,null!==(t=this._data.backColor1)&&void 0!==t?t:"transparent"),e.addColorStop(1,null!==(i=this._data.backColor2)&&void 0!==i?i:"transparent"),s.fillStyle=e}else s.fillStyle=this._data.backcolor;const n=Math.min(this._data.points[0],this._data.points[1]),o=Math.max(this._data.points[0],this._data.points[1]);s.fillRect(0,n,r,o-n)}}class rt{constructor(e){this._bandBgRenderer=new st,this._invalidated=!0,this._source=e}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._bandBgRenderer}_updateImpl(){this._bandBgRenderer.setData(null);const e=this._source.properties().childs(),t=e.bands;if(t.childCount()<2)return;const i=e.bandsBackground;if(!(null==i?void 0:i.childs().fillBackground.value()))return;const s=t[0].childs(),r=t[1].childs(),o=this._source.priceScale(),a=this._source.firstValue();if(!o||o.isEmpty()||null===a)return;const l=[o.priceToCoordinate(s.value.value(),a),o.priceToCoordinate(r.value.value(),a)],c=(0,n.ensureDefined)(e.bandsBackground).childs(),h=(0,q.clamp)(c.transparency.value(),0,100);this._bandBgRenderer.setData({gradient:!1,points:l,backcolor:(0,R.generateColor)(c.backgroundColor.value(),h)})}}class nt{constructor(e,t,i){var s;this._bandBgRenderer=new st,this._bandAKey=null,this._bandBKey=null,this._invalidated=!0,this._source=e,(0,n.assert)("hline_hline"===t.type,"Wrong filledArea type: "+t.type),this._initBandIndexes(t.objAId,t.objBId),this._fillStyleProps=i,
this._bandBgRenderer=new st,this._gradientFillType=i.hasChild("fillType")&&"gradient"===(null===(s=i.childs().fillType)||void 0===s?void 0:s.value()),this._gradientStaticState={color1:t.topColor,color2:t.bottomColor,value1:t.topValue,value2:t.bottomValue}}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._bandBgRenderer}_updateImpl(){var e,t,i,s,r,o,a,l;if(this._bandBgRenderer.setData(null),!this._fillStyleProps.childs().visible.value())return;if(null===this._bandAKey||null===this._bandBKey)return;const c=(0,n.ensureDefined)(this._source.properties().childs().bands),h=c.childs()[this._bandAKey].childs(),d=c.childs()[this._bandBKey].childs(),u=this._source.priceScale(),p=this._source.firstValue();if(!u||u.isEmpty()||null===p)return;const _=[u.priceToCoordinate(h.value.value(),p),u.priceToCoordinate(d.value.value(),p)],m=(0,q.clamp)(this._fillStyleProps.childs().transparency.value(),0,100);let g;const f=this._fillStyleProps.childs();if(this._gradientFillType){const n=this._gradientStaticState,c=f,h=null!==(e=n.value1)&&void 0!==e?e:null===(t=c.topValue)||void 0===t?void 0:t.value(),d=null!==(i=n.value2)&&void 0!==i?i:null===(s=c.bottomValue)||void 0===s?void 0:s.value();if(void 0===h||void 0===d)return;const v=null!==(r=n.color1)&&void 0!==r?r:null===(o=c.topColor)||void 0===o?void 0:o.value(),S=null!==(a=n.color2)&&void 0!==a?a:null===(l=c.bottomColor)||void 0===l?void 0:l.value();if(void 0===v&&void 0===S)return;g={gradient:!0,points:_,backColor1:v&&(0,R.generateColor)(v,m),backColor2:S&&(0,R.generateColor)(S,m),coordinate1:u.priceToCoordinate(h,p),coordinate2:u.priceToCoordinate(d,p)}}else g={gradient:!1,points:_,backcolor:(0,R.generateColor)(f.color.value(),m)};this._bandBgRenderer.setData(g)}_initBandIndexes(e,t){this._bandAKey=null,this._bandBKey=null;(0,n.ensureDefined)(this._source.metaInfo().bands).forEach(((i,s)=>{null===this._bandAKey&&i.id===e&&(this._bandAKey=s),null===this._bandBKey&&i.id===t&&(this._bandBKey=s)}))}}var ot=i(981820),at=i(224778),lt=i(706486),ct=i(744687),ht=i(210596),dt=i.n(ht),ut=i(632054),pt=i(588535),_t=i(672428);class mt extends _t.PriceAxisView{constructor(e,t){super(),this._model=e.model(),this._source=e,this._data=t}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const s=this._source.model(),r=this._source.priceScale();if(null===r)return;if(!s.isPriceScaleVisible(r))return;const o=this._source.lastValueData(this._data.plotIndex,!1);if(o.noData)return;const a=s.timeScale().visibleBarsStrictRange(),l=s.mainSeries().bars().lastIndex();if(null!==a&&null!==l){if(l<=a.lastBar()){i.background=(0,R.resetTransparency)(o.color);let s=o.color;"transparent"===s&&(s=this._model.properties().childs().scalesProperties.childs().backgroundColor.value()),i.textColor=this.generateTextColor(s),i.borderColor=void 0,e.borderVisible=!1,t.borderVisible=!1}else{const r=s.backgroundColorAtYPercentFromTop(o.coordinate/(0,n.ensureNotNull)(s.paneForSource(this._source)).height());i.background=r,i.textColor=(0,R.resetTransparency)(o.color),
i.borderColor=(0,R.resetTransparency)(i.textColor),e.borderVisible=!0,t.borderVisible=!0}i.coordinate=o.coordinate,i.floatCoordinate=o.floatCoordinate,this._showAxisLabel()&&(e.text=o.text,e.visible=!0),this._updatePaneRendererData(t)}}_showPaneLabel(){return!!this._model.properties().childs().scalesProperties.childs().showStudyPlotLabels.value()&&this._source.properties().childs().showLabelsOnPriceScale.value()&&this._source.isPlotVisibleAt(this._data.plotIndex,4)}_showAxisLabel(){return!!this._model.properties().childs().scalesProperties.childs().showStudyLastValue.value()&&this._source.properties().childs().showLabelsOnPriceScale.value()&&this._source.isPlotVisibleAt(this._data.plotIndex,4)}_updatePaneRendererData(e){e.text="",this._showPaneLabel()&&(e.text=this._source.priceLabelText(this._data.plotIndex),e.visible=!0)}}var gt=i(929654),ft=i(254303),vt=i(559410),St=i(658363),yt=i(785359),bt=i(508547),wt=i(920936),Pt=i(198459),Ct=i(768950),Tt=i(821737),xt=i(609781),It=i(58594),Mt=i(563068);const Lt=(0,a.getLogger)("Chart.Study"),At=o.t(null,void 0,i(814177));const kt={symbolsForDisplay:!1,symbolsForChartApi:!0,skipHiddenInputs:!1,skipFakeInputs:!1,skipBooleanInputs:B.enabled("dont_show_boolean_study_arguments"),asObject:!0,skippedGroups:[],skippedInputs:[],noExchanges:!1,noResolution:!1,keepOptionalSymbolsEmpty:!1,skipColorInputs:!1,skipTimeInputs:!1,skipOptionalEmptySymbolInputs:!1,skipTextareaInputs:!0,priceInputsForDisplay:!1},Et=B.enabled("study_symbol_ticker_description"),Dt=B.enabled("hide_main_series_symbol_from_indicator_legend");function Bt(e,t){const i=e.plots[t];if(!i||!(0,b.isOhlcPlot)(i))return!1;const s=i.target,r=e.defaults.styles&&e.defaults.styles[s],n=e.defaults.ohlcPlots&&e.defaults.ohlcPlots[s],o=e.ohlcPlots&&e.ohlcPlots[s];return r&&(0,b.isOhlcPlotStyleBars)(r)||n&&(0,b.isOhlcPlotStyleBars)(n)||!!o&&(0,b.isOhlcPlotStyleBars)(o)}function Vt(e,t){const i=e.plots[t];if(!i||!(0,b.isOhlcPlot)(i))return!1;const s=i.target,r=e.defaults.styles&&e.defaults.styles[s],n=e.defaults.ohlcPlots&&e.defaults.ohlcPlots[s],o=e.ohlcPlots&&e.ohlcPlots[s];return r&&(0,b.isOhlcPlotStyleCandles)(r)||n&&(0,b.isOhlcPlotStyleCandles)(n)||!!o&&(0,b.isOhlcPlotStyleCandles)(o)}function Rt(e,t){(0,n.assert)(void 0!==e,"zOrder must be defined"),(0,n.assert)(!t.has(e),"zOrder must be unique")}function Nt(e,t){return e.plots.some((e=>((0,b.isColorerPlot)(e)||(0,b.isDataPlot)(e))&&e.target===t))}function Ot(e,t){var i;if(t.plots)for(let s=0;s<t.plots.length;s++){const r=t.plots[s],o=r.id;if((0,b.isColorerPlot)(r))continue;const a={display:15,color:"#0496FF",linestyle:Oe.LINESTYLE_SOLID,linewidth:2,plottype:b.LineStudyPlotStyle.Line,histogramBase:0,transparency:50,trackPrice:!1,joinPoints:!1};(0,b.isBarColorerPlot)(r)&&(a.transparency=0),a.plottype=r.type,a.title=o,e.styles&&o in e.styles&&(0,k.merge)(a,null!==(i=e.styles[o])&&void 0!==i?i:{}),(0,n.ensureDefined)(e.styles)[o]=a}}function Ft(e,t,i,s){var r,o
;if(m.StudyMetaInfo.versionOf(e)<1)throw new Error("This function cannot work with metainfo of the old format version. Required format version >= 1");let a=(0,k.clone)((0,St.defaults)("study"));Ot(a,e);const l=m.StudyMetaInfo.getStudyPropertyRootName(e);let c=(0,k.clone)((0,St.defaults)(l,s));c.intervalsVisibilities=(0,k.clone)(yt.intervalsVisibilitiesDefaults),"Overlay"!==e.shortId&&"Compare"!==e.shortId||(c.currencyId=null,c.unitId=null),e.isTVScript&&e.TVScriptSourceCode!==c.TVScriptSourceCode&&(c=(0,k.clone)((0,St.factoryDefaults)(l))),(0,k.merge)(a,c),t&&((0,n.assert)(!(t instanceof A()),"propsState should not be an instance of Property"),(0,k.merge)(a,t));const h=(0,k.clone)(e),d={};Pt.StudyVersioning.mergeInputsObjPart(d,null!==(r=h.defaults.inputs)&&void 0!==r?r:{}),Pt.StudyVersioning.mergeInputsObjPart(d,a.inputs),a.inputs=d,delete h.inputs,delete h.defaults.inputs;const u={};if((0,k.merge)(u,h.defaults),(0,k.merge)(u,(0,St.factoryDefaults)(l)),(0,k.merge)(u,a),(0,k.merge)(u,h),delete u.defaults,a=u,null!==i){const t=i.model().studiesColorRotatorFactory().getColorRotator(e);null!==t&&("Overlay@tv-basicstudies"===e.id?a.lineStyle.color=t.getColor(a.lineStyle.color):(0,k.merge)(a,function(e,t){for(const i of Object.keys(e.styles)){const s=e.styles[i];if(s&&"color"in s){const e=s.color;s.color=t.getColor(e)}}return e}(a,t)))}return t&&(0,k.merge)(a.styles,null!==(o=t.styles)&&void 0!==o?o:{}),a}function Wt(e,t,i,s,r){return function(e,t,i,s,r,n){const o=Ft(e,t,i,s);return m.StudyMetaInfo.getSourceInputIds(e).forEach(((e,t)=>{const i=o.inputs[e];t<n.length?o.inputs[e]=`${n[t].id()}$0`:(0,k.isString)(i)&&i.includes("$")&&(o.inputs[e]="close")})),zt(e,r,o)}(e,t,i,s,m.StudyMetaInfo.getStudyPropertyRootName(e),r)}function zt(e,t,i){const s=new bt.DefaultProperty(t,i,!0);s.removeProperty("intervalsVisibilities"),s.addChild("intervalsVisibilities",new wt.IntervalsVisibilitiesProperty(i&&i.intervalsVisibilities)),s.addExclusion("visible"),s.addExclusion("precision"),s.addExclusion("minTick"),s.addExclusion("intervalsVisibilities");for(let t=0;t<e.inputs.length;++t){const i=e.inputs[t];i.isHidden&&(s.addExclusion("inputs."+t.toString()),s.addExclusion("inputs."+i.id))}return"PivotPointsStandard@tv-basicstudies"!==e.id&&"PivotPointsHighLow@tv-basicstudies"!==e.id||!s.hasChild("font")||s.removeProperty("font"),s}function Ht(e,t,i,s,r,n){const o=function(e,t,i,s,r){var n;e.version&&i.version&&e.version!==i.version&&Lt.logWarn("Serialized metaInfo version "+e.version+" is not equal to the saved state version "+i.version);let o=(0,k.clone)((0,St.defaults)("study"));o.intervalsVisibilities=(0,k.clone)(yt.intervalsVisibilitiesDefaults),(0,k.merge)(o,(0,St.factoryDefaults)(m.StudyMetaInfo.getStudyPropertyRootName(e))),Ot(o,e),(0,k.merge)(o,i),o=s.updateStudyState(o,e,t),void 0!==r&&t&&(o=r(i,o,e,t));const a=(0,k.clone)(t||e);if(a&&m.StudyMetaInfo.versionOf(a)>=1){const e={};Pt.StudyVersioning.mergeInputsObjPart(e,null!==(n=a.defaults.inputs)&&void 0!==n?n:{}),Pt.StudyVersioning.mergeInputsObjPart(e,o.inputs),o.inputs=e,
delete a.inputs,a.defaults&&delete a.defaults.inputs;const t={};(0,k.merge)(t,a.defaults),(0,k.merge)(t,(0,St.factoryDefaults)(m.StudyMetaInfo.getStudyPropertyRootName(a))),(0,k.merge)(t,o),delete a.defaults,(0,k.merge)(t,a),o=t}return o}(e,t,i,s,n);return zt(t||e,r,o)}function Ut(e,t,i,s,r){return Ht(e,t,i,s,m.StudyMetaInfo.getStudyPropertyRootName(e),r)}function jt(e,t,i){let s=0,r=0;return e.inputs.filter((e=>"source"===e.type)).forEach((e=>{(0,D.getInputValue)(i[e.id]).includes("$")&&s++,(0,D.getInputValue)(t[e.id]).includes("$")&&r++})),Math.sign(r)-Math.sign(s)}class Gt extends u.PriceDataSource{constructor(e,t,i,s){var r,o,a;super(e),this._onStart=new(h()),this._onHibernationStateChange=new(h()),this._symbolsResolved=new(h()),this._statusChanged=new(h()),this._restarting=!1,this._paneViews=[],this._legendView=null,this._priceAxisViews=[],this._inputsAnchorsPaneView=null,this._inputsLinesPaneView=null,this._inputsTimeAxisPaneViews=[],this._inputsPriceAxisPaneViews=[],this._resolvedSymbols={},this._resolvedSymbolsByInput={},this._sources=[],this._status={type:ot.StudyStatusType.Undefined},this._wasCompletedBefore=!1,this._studyId=null,this._isSubscribedToSessionId=!1,this._titleStrCache={},this._titleInPartsCache={},this._children=[],this._numericFormatter=new E.NumericFormatter,this._priceAxisViewsBase=[],this._priceLinesAxisViews=[],this._graphicsPriceAxisViews=[],this._labelPaneViews=[],this._ownFirstValue=null,this._plotOffsets={},this._formatter=null,this._ongoingDataUpdate=Promise.resolve(),this._studyModified=!1,this._isDestroyed=!1,this._graphics=new g.LiveStudyGraphics,this._dataUpdated=new(h()),this._tagsChanged=new(h()),this._studyName="",this._turnaround="st0",this._currencySourceSymbolInputProperty=null,this._pendingResolveSymbols=new Map,this._onIsActualIntervalChange=new(h()),this._childStudyByRebind=new(h()),this._lastNonEmptyPlotRowCache={},this._startMovingPoint=null,this._processHibernateBound=this.processHibernate.bind(this,1),this._maxOffset=new(dt())(0),this._currencySourceSymbolInfo=null,this._turnaroundCounter=0,this._deferredPinePatchProps=!1,this._chartApi=e.chartApi(),this._properties=t,this._metaInfo=s,this._series=this._model.mainSeries(),this._series.onIntervalChanged().subscribe(this,this._calcIsActualInterval),this._showStudyArgumentsProperty=e.properties().childs().paneProperties.childs().legendProperties.childs().showStudyArguments,e.collapsed().subscribe(this._processHibernateBound),this._sources=i,m.StudyMetaInfo.setChildStudyMetaInfoPropertiesSourceId(s,null===(r=this._sources[0])||void 0===r?void 0:r.id(),t),i.forEach((e=>{e.setChild(this)})),[this._series,...i].forEach((e=>{e.currencyChanged().subscribe(this,this._onSourceCurrencyChanged),e.unitChanged().subscribe(this,this._onSourceUnitChanged),e.priceRangeReadyChanged().subscribe(this,this._onSourcePriceRangeReadyChanged),e.formatterChanged().subscribe(this,this._onSourceFormatterChanged),e.priceStepChanged().subscribe(this,this._onSourcePriceStepChanged)})),
Et&&this._model.mainSeries().properties().childs().statusViewStyle.childs().symbolTextSource.listeners().subscribe(this,(()=>{this.invalidateTitleCache(!0)}));const l=this._properties.childs();for(const e of m.StudyMetaInfo.getSourceInputIds(s))null===(o=l.inputs.childs()[e])||void 0===o||o.subscribe(this,this._onSourceInputChanged);this._properties.subscribe(this,this._onPropertiesChanged),l.visible.subscribe(this,this._visibleChanged),l.visible.subscribe(this,(()=>this.processHibernate())),l.intervalsVisibilities.subscribe(this,this._calcIsActualInterval),l.inputs.listeners().subscribe(this,this._updateMaxOffsetValue),void 0!==l.offsets&&l.offsets.listeners().subscribe(this,this._updateMaxOffsetValue),void 0!==l.offset&&l.offset.listeners().subscribe(this,this._updateMaxOffsetValue),this._initializeCurrencySource(),P.hideAllIndicators().subscribe(this,this._visibleChanged);for(let e=0;e<this._metaInfo.plots.length;e++){const t=this._metaInfo.plots[e].id,i=this._properties.childs().styles.childs()[t];null==i||i.childs().display.subscribe(this,(()=>this.processHibernate()))}for(const e of Object.keys(this._metaInfo.graphics))for(const t of Object.keys(this._metaInfo.graphics[e])){const i=null===(a=l.graphics.childs()[e])||void 0===a?void 0:a.childs()[t];i&&i.childs().visible&&(0,n.ensureDefined)(i.childs().visible).subscribe(this,(()=>this.processHibernate()))}this._isActualInterval=(0,at.isActualInterval)(this._series.intervalObj(),this._properties.childs().intervalsVisibilities),this._initializeStudyInputsPaneViews(),this._handler=e=>this.onData(e),this._handler.isTVScriptStrategy=this._metaInfo.isTVScriptStrategy,this._valuesProvider=new Ct.StudyValuesProvider(this,e)}destroy(){var e;this.parentSources().forEach((e=>{e.currencyChanged().unsubscribeAll(this),e.unitChanged().unsubscribeAll(this),e.priceRangeReadyChanged().unsubscribeAll(this),e.formatterChanged().unsubscribeAll(this),e.priceStepChanged().unsubscribeAll(this)})),this._series.properties().childs().statusViewStyle.childs().symbolTextSource.unsubscribeAll(this),this._series.onIntervalChanged().unsubscribeAll(this),this.formatterChanged().unsubscribe(this,this.invalidateTitleCache),P.hideAllIndicators().unsubscribe(this,this._visibleChanged),this._model.collapsed().unsubscribe(this._processHibernateBound),null!==this._currencySourceSymbolInputProperty&&this._currencySourceSymbolInputProperty.unsubscribeAll(this),null===(e=this._legendView)||void 0===e||e.destroy()}properties(){return this._properties}isDraggable(){return!this._metaInfo.linkedToSeries}lastValueData(e,t,i){const s={noData:!0},r=this.priceScale();if(this._model.timeScale().isEmpty()||null===r||r.isEmpty()||this.data().isEmpty())return s;const n=this._model.timeScale().visibleBarsStrictRange(),o=this.firstValue(!0);if(null===n||null===o)return s;if(!this._properties.childs().visible.value())return s;const a=this._properties.childs().styles,l=this._properties.childs().ohlcPlots;let c,h;if(a&&a.childs()[e]&&(c=a.childs()[e]),l&&l.childs()[e]&&(c=l.childs()[e]),
!c||0===c.childs().display.value())return s;const d=this.metaInfo().plots;for(h=0;h<d.length;h++){const t=d[h];if(t.id===e||(0,b.isOhlcClosePlot)(t)&&t.target===e)break}const u=h+1,p=this.offset(e),_=this.nearestIndex(n.lastBar()-p,f.PlotRowSearchMode.NearestLeft,u);if(void 0===_)return s;const m=this._lastNonEmptyPlotRow(u),g=null!==m&&n.contains(m.index),v=null!==m?m.value:null,S=t||g?v:this.data().valueAt(_);if(!S||!(0,k.isNumber)(S[u]))return s;const y=S[u],w=this._valuesProvider.getPlotColor(h,S),P=r.priceToCoordinate(y,o),C={...r.getFormattedValues(y,o),noData:!1,color:w,floatCoordinate:P,coordinate:P};return i&&(C.price=y),C}isFailed(){return this._status.type===ot.StudyStatusType.Error}isLoading(){return this._status.type===ot.StudyStatusType.Loading}isSymbolInvalid(){return this._status.type===ot.StudyStatusType.Error&&this._status.errorDescription.error===At}state(e,t){var i,s;const r=(0,n.ensureNotNull)((0,l.className)(this.constructor)),o=this.metaInfo();let a;o instanceof m.StudyMetaInfo?a=(0,k.clone)(o.state()):(a=(0,k.clone)(this.metaInfo()),a.id=m.StudyMetaInfo.parseIdString(a.id+(a.version?"-"+a.version:"")).fullId);const c={type:r,id:this.id(),state:this.properties().state(),zorder:this.zorder(),ownFirstValue:this.isVisible()?null:this._ownFirstValue,metaInfo:a},h=this._sources.map((e=>e.id()));if(h.length&&(c.parentSources=h),e){let e=this.data();const t=this._model.timeScale(),i=this._seriesDataRangeToSave(e);null!==i&&(e=e.range(i.firstBar(),i.lastBar())),c.data=e.state(),c.data.symbols=this._resolvedSymbols,c.data.graphics=(0,g.saveStudyGraphics)(this.graphics(),t.visibleBarsStrictRange()),c.data.plotOffsets=this._plotOffsets}this.ownerSource()&&(c.ownerSource=null===(i=this.ownerSource())||void 0===i?void 0:i.id());for(let e=0;e<o.inputs.length;e++)if("bar_time"===o.inputs[e].type){const t=o.inputs[e].id,i=c.state.inputs[t];if(i<0){const e=this._rightOffsetToUnixTime(-i);c.state.inputs[t]=e&&e>=0?e:0}}if(null===(s=c.state)||void 0===s?void 0:s.inputs){const e=c.metaInfo.inputs.find((e=>"ILScript"===e.name));e&&delete c.state.inputs[e.id]}return c}restoreData(e){var t,i;this._invalidateLastNonEmptyPlotRowCache(),this.data().restoreState(e),this._resolvedSymbols=null!==(t=e.symbols)&&void 0!==t?t:{},this._graphics=e.graphics?(0,g.loadStudyGraphics)(e.graphics):(0,g.emptyStudyGraphics)(),this._postProcessGraphics(),this._plotOffsets=null!==(i=e.plotOffsets)&&void 0!==i?i:{},this._setStatus({type:ot.StudyStatusType.Completed},!0)}hasStateForAlert(){return!1}stateForAlert(){throw new Error("Not implemented")}idForAlert(){return super.idForAlert()}alertCreationAvailable(){return new(dt())(!1).readonly()}hasBarColorer(){return(0,n.ensureNotNull)(this._metaInfo).plots.some(b.isBarColorerPlot)}barColorer(){const e=this._metaInfo.plots;let t=null;for(let i=0;i<e.length;++i)if((0,b.isBarColorerPlot)(e[i])){const e=new ft.StudyBarColorer(this,i);null===t?t=e:t.pushBackBarColorer(e)}return t}restart(e){this._restarting=!0,this.clearData(),(e||B.enabled("stop_study_on_restart"))&&this.stop(),
setTimeout(this.start.bind(this),0)}stop(e,t){if(!0===e&&this._children)for(const e of this._children)e.stop(!0);this._stopStudyOnServer(),this.clearData(),this._unsubscribeToSessionId(),this.recalculate()}disconnect(){this._studyId=null,this._model.isSnapshot()||(this._resolvedSymbols={},this._resolvedSymbolsByInput={})}sourceId(){return this._studyId}parentSources(){return this._sources}symbolSource(){return this._firstSourceOrSeries().symbolSource()}barsProvider(){return this._firstSourceOrSeries().barsProvider()}ownerSource(){return this.isChildStudy()?this._sources[0]:super.ownerSource()}isChildStudy(){return this._sources.length>0}hasChildren(){return this._children.length>0}isStarted(){return Boolean(this._studyId)}isRestarting(){return this._restarting}isActualInterval(){return this._isActualInterval}onIsActualIntervalChange(){return this._onIsActualIntervalChange}isVisible(){var e,t,i;const s=this._properties.childs();if(this._model.collapsed().value()||!s.visible.value()||!this.isActualInterval())return!1;const r=this.metaInfo();if(r.plots.length>0)for(let e=0;e<r.plots.length;e++){const t=r.plots[e].id,i=s.styles.childs()[t];if(void 0===i)continue;if(0!==i.childs().display.value())return!0}if(r.bands)for(let e=0;e<r.bands.length;e++)if(s.bands.childs()[e].childs().visible.value())return!0;for(const n of Object.keys(r.graphics))for(const o of Object.keys(r.graphics[n])){const r=null===(e=s.graphics.childs()[n])||void 0===e?void 0:e.childs()[o];if(void 0!==r&&(null===(i=null===(t=r.child("visible"))||void 0===t?void 0:t.value())||void 0===i||i))return!0}if(r.filledAreas)for(let e=0;e<r.filledAreas.length;e++)if(s.filledAreasStyle.childs()[r.filledAreas[e].id].childs().visible.value())return!0;return!1}start(e,t,i){const s=this._model.mainSeries();if(!s.isStarted())return void s.dataEvents().completed().subscribe(this,(()=>this.start(e,t)),!0);this._sources.forEach((e=>{e.isHibernated()&&e.start()}));const r=!(this.isHibernationAllowed()&&!this.isVisible())||!0===t;this._chartApi&&this._chartApi.isConnected().value()&&r&&this._allSymbolsAreResolved().then((()=>this._startAfterSymbolsResolved(e,t))).catch((e=>{Lt.logError("ERROR: "+this._debugId()+" start failed, "+e),this._restarting=!1}))}inputs(e){const t=(0,k.merge)((0,k.clone)(kt),e||{});t.skipOptionalEmptySymbolInputs&&(t.keepOptionalSymbolsEmpty=!0);const i=(0,r.default)(this._buildInputs(t));return t.patchSosInputs&&m.StudyMetaInfo.patchSoSInputs(i,(e=>{var t,i;return null!==(i=null===(t=this._sources.find((t=>t.id()===e)))||void 0===t?void 0:t.sourceId())&&void 0!==i?i:null})),i}metaInfo(){return this._metaInfo}status(){return this._status}name(e){return e?this.metaInfo().shortDescription||this._properties.childs().shortDescription&&this._properties.childs().shortDescription.value()||"Study":this.metaInfo().description||this._properties.childs().description&&this._properties.childs().description.value()||"Study"}title(e,t,i,s){i=void 0===i?!this._showStudyArgumentsProperty.value():i;const r=JSON.stringify([e,t,i,s])
;if(this._titleStrCache[r])return this._titleStrCache[r];if(this._titleInPartsCache[r])return this._joinTitlesParts(this._titleInPartsCache[r]);const n=this._title(e,t,i,s);return this._titleStrCache[r]=n,n}titleInParts(e,t,i,s){i=void 0===i?!this._showStudyArgumentsProperty.value():i;const r=JSON.stringify([e,t,i,s]);if(this._titleInPartsCache[r])return this._titleInPartsCache[r];const n=this._titleInParts(e,t,i,s);return this._titleInPartsCache[r]=n,n}invalidateTitleCache(e){if(this._titleStrCache={},this._titleInPartsCache={},!0===e&&this._children)for(let t=0;t<this._children.length;++t)this._children[t].invalidateTitleCache(e)}graphicsInfo(){return this._metaInfo.graphics}setOwnFirstValue(e){this._ownFirstValue=e}firstValue(e){if(!this.isChildStudy()&&"Compare@tv-basicstudies"===this._metaInfo.id||!this._metaInfo.is_price_study){const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return null;const i=this.properties().childs();if(!i.visible.value()||!this.isActualInterval()||null!==this._startMovingPoint)return this._ownFirstValue;const s=t.firstBar(),r=t.lastBar();let o=null;const a=this._metaInfo.plots||[];if(null===o){const t=new Set,l=this._metaInfo.filledAreas||[];for(let e=0;e<l.length;e++){const s=l[e];i.filledAreasStyle.childs()[s.id].childs().visible.value()&&(t.add(s.objAId),t.add(s.objBId))}const c=this.data().rangeIterator(s,r);for(;c.hasNext();){const s=c.next().value;for(let r=0;r<a.length;++r){if((0,b.isColorerPlot)(a[r]))continue;const l=s[r+1];if(null==l)continue;const c=a[r].id;if((0!==(0,n.ensureDefined)(i.styles.childs()[c]).childs().display.value()||t.has(c))&&!(e&&Math.abs(l)<1e-10)){o=l;break}}if(null!==o)break}}return this._ownFirstValue=o,null!==o?o:this._bandsFirstValue(e)}if(this.isChildStudy()){const e=this._getNonPriceParent();if(e&&this.priceScale()===e.priceScale())return null!==e._ownFirstValue?e._ownFirstValue:e.firstValue()}return this._series.firstValue()}priceRange(e,t){let i=null;const s=this._metaInfo,r=this._fillPrecalculatedAutoscaleInfo(e,t);let o=this.data().minMaxOnRangeCached(e,t,r.fields);if(o=(0,_.mergeMinMax)(r.baseValueMinMax,o),r.useMainSeriesRange){const i=[{name:"low",offset:0},{name:"high",offset:0}],s=this.series().data().bars().minMaxOnRangeCached(e,t,i);o=(0,_.mergeMinMax)(o,s)}if(null!==o&&(i=new p.PriceRange(o.min,o.max)),s.bands)for(let e=0;e<s.bands.length;e++){const t=(0,n.ensureDefined)(this._properties.childs().bands.childs()[e]).childs();if(t.visible.value()){const e=t.value.value();if(!(0,k.isNumber)(e))continue;i?i.apply(e,e):i=new p.PriceRange(e,e)}}return this._postProcessPriceRange(i)}autoScaleInfo(e,t){const i={topPixelMargin:0,bottomPixelMargin:0};return{range:this.priceRange(e,t),topPixelMargin:i.topPixelMargin,bottomPixelMargin:i.bottomPixelMargin}}formatter(){return this._formatter?this._formatter:this._firstSourceOrSeries().formatter(!1)}updateAllViews(e){var t,i,s,r,n;this._paneViews.forEach((t=>t.update(e))),this._labelPaneViews.forEach((t=>t.update(e))),null===(t=this._dataWindowView)||void 0===t||t.update(),
null===(i=this._legendView)||void 0===i||i.update(),null===(s=this._statusView)||void 0===s||s.update(),this._priceAxisViews.forEach((t=>t.update(e))),this._priceLinesAxisViews.forEach((t=>t.update(e))),null===(r=this._inputsLinesPaneView)||void 0===r||r.update(e),null===(n=this._inputsAnchorsPaneView)||void 0===n||n.update(e),this._inputsTimeAxisPaneViews.forEach((t=>t.update(e))),this._inputsPriceAxisPaneViews.forEach((t=>t.update(e)))}getStudyName(){return this._studyName}childStudyByRebind(){return this._childStudyByRebind}isPine(){return void 0!==this._metaInfo.pine}isStandardPine(){return this.isPine()&&m.StudyMetaInfo.isStandardPine(this._metaInfo.id)}isLinkedToSeries(){return!0===this._metaInfo.linkedToSeries}defaultPlotIdForAlert(){return this._metaInfo.plots.length?this._metaInfo.plots[0].id:null}resolvedSymbolInfoBySymbol(e){return this._resolvedSymbols&&e&&this._resolvedSymbols[this._getSymbolForResolve(e)]||null}currency(){if(null!==this._currencySourceSymbolInfo)return(0,ut.symbolCurrency)(this._currencySourceSymbolInfo);const e=this.metaInfo();return Boolean(e)&&e.is_price_study?this._firstSourceOrSeries().currency():null}currencySourceSymbolInfo(){var e,t,i;return null!==(e=this._currencySourceSymbolInfo)&&void 0!==e?e:null!==(i=null===(t=this.symbolSource())||void 0===t?void 0:t.symbolInfo())&&void 0!==i?i:null}unit(){const e=this.metaInfo();return Boolean(e)&&e.is_price_study?this._firstSourceOrSeries().unit():null}dataWindowView(){return this._dataWindowView}statusView(){return this._statusView}legendView(){return this._legendView}inputsForAlertState(){return this.inputs()}sessionId(){return this._firstSourceOrSeries().sessionId()}sessionIdChanged(){return this._firstSourceOrSeries().sessionIdChanged()}getSymbolString(e){return""===e?"":(0,T.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject(e))}onStatusChanged(){return this._statusChanged}symbolsResolved(){return this._symbolsResolved}onHibernationStateChange(){return this._onHibernationStateChange}valuesProvider(){return new y.StudyLegendValuesProvider(this,this.model())}statusProvider(e){return new M.StudyStatusProvider(this,this._model.properties().childs().scalesProperties.childs().textColor)}correctScaleMargins(e){if("Volume"===this.metaInfo().shortId){const t=this.model().paneForSource(this);return null!==t&&t.isOverlay(this)&&t.containsMainSeries()?{top:.75,bottom:0}:{top:e.top,bottom:0}}return e}canBeHiddenByGlobalFlag(){return!0}isSourceHidden(){return!this.isVisible()||this.canBeHiddenByGlobalFlag()&&P.hideAllIndicators().value()}paneViews(e){if(this.isSourceHidden()||!e.hasPriceDataSource(this))return null;const t=[];return!this._startMovingPoint&&this._wasCompletedBefore&&t.push(...this._paneViews),this._inputsLinesPaneView&&(this._startMovingPoint||this._model.selection().isSelected(this))&&t.push(this._inputsLinesPaneView),this._inputsAnchorsPaneView&&t.push(this._inputsAnchorsPaneView),t}labelPaneViews(){return this.isSourceHidden()?null:this._labelPaneViews}timeAxisViews(){
return this._model.selection().isSelected(this)?this._inputsTimeAxisPaneViews:null}priceAxisViews(e,t){const i=this._properties.childs().oldShowLastValue;if(i&&!i.value())return null;let s=this._priceAxisViews.slice();return this._model.selection().isSelected(this)&&(s=s.concat(this._inputsPriceAxisPaneViews)),e.findTargetPriceAxisViews(this,t,s,this._priceLinesAxisViews)}movable(){return null!==this._inputsAnchorsPaneView}startMoving(e,t,i,s){this._startMovingPoint=e,this.stop()}move(e,t,i,s){if(void 0!==e.logical&&null!==this._startMovingPoint){if(Array.isArray(t)){const i=t;this._updateInputValue(e.logical,i[0]),this._updateInputValue(e.logical,i[1])}else this._updateInputValue(e.logical,t);this.updateAllViews((0,ct.sourceChangeEvent)(this.id()))}}endMoving(e,t){return this._startMovingPoint=null,this.start(),{indexesChanged:!1,pricesChanged:!1}}clearData(){var e;this._invalidateLastNonEmptyPlotRowCache(),this.data().clear(),this._graphics instanceof g.LiveStudyGraphics&&(null===(e=this._graphics)||void 0===e||e.clear()),this._plotOffsets={},this.hasBarColorer()&&this._model.mainSeries().invalidateBarStylesCache(),this.updateAllViews((0,ct.sourceChangeEvent)({sourceId:this.id(),clearData:!0}))}convertYCoordinateToPriceForMoving(e,t){const i=this.priceScale();if(!t||!i||i.isEmpty())return null;const s=t.firstValue();return null===s?null:i.coordinateToPrice(e,s)}processHibernate(e){const t=this.isVisible();if(!this.isStarted()&&t&&(this._sources.forEach((e=>{e.processHibernate()})),this.start(void 0,void 0,e),this._onHibernationStateChange.fire(!1)),this.isHibernationAllowed()&&this.isStarted()&&!t){for(const e of this._children)e.processHibernate();this.stop(void 0,e),this._onHibernationStateChange.fire(!0)}}isHibernationAllowed(){return!this.metaInfo().historyCalculationMayChange&&(!this.hasChildren()||!!this._model.collapsed().value()&&this._children.every((e=>e.isHibernationAllowed())))}isPlotVisibleAt(e,t){let i;const s=this.metaInfo().plots.find((t=>t.id===e));if(i=void 0!==s?(0,b.isOhlcPlot)(s)?this._properties.childs().ohlcPlots.childs()[s.target]:this._properties.childs().styles.childs()[e]:this._properties.childs().ohlcPlots.childs()[e],void 0===i)throw new Error(`Study does not contain ${e} plot`);const r=i.childs().display.value();return null!==r&&(r&t)===t}recalculate(){const e=this._model.paneForSource(this);this._model.recalculatePane(e,(0,ct.sourceChangeEvent)(this.id())),this._model.updateSource(this)}maxOffset(){return this._maxOffset}onStart(){return this._onStart}isHibernated(){return!this.isVisible()&&!this.isStarted()}turnaround(e){if(!e)return this._turnaround;const t=this._series.seriesSource().turnaround(),i=buildTreeForStudy(this);return buildTurnaround(t,i)}canHaveChildren(){var e;return this._canHaveChildren=null!==(e=this._canHaveChildren)&&void 0!==e?e:m.StudyMetaInfo.canHaveChildren(this._metaInfo),this._canHaveChildren}setChild(e){-1===this._children.indexOf(e)&&this._children.push(e)}unsetChild(e){const t=this._children.indexOf(e);~t&&this._children.splice(t,1)}getAllChildren(){
const e=this._children.slice();for(let t=0;t<e.length;++t){const i=e[t].getAllChildren();for(let t=0;t<i.length;++t)~e.indexOf(i[t])||e.push(i[t])}return e}parentSourceForInput(e){var t;if(e.includes("$")){const i=e.split("$")[0];return null!==(t=this._sources.find((e=>e.id()===i)))&&void 0!==t?t:null}return this._series}priceStep(){return this._priceStep||this._firstSourceOrSeries().priceStep(!1)}_incrementTurnaround(){this._turnaround="st"+ ++this._turnaroundCounter}_checkTurnaround(e){return e===this._turnaround||e===this._model.mainSeries().seriesSource().turnaround()||e===this.turnaround(!0)}_createStudyOnServer(){if(this._isDestroyed)return;const e=this._getStudyIdWithLatestVersion();this._studyId=(0,x.makeNextStudyId)(),this._incrementTurnaround(),this._studyName=e;const t=(0,k.clone)((0,n.ensureDefined)(this._inputs));m.StudyMetaInfo.patchSoSInputs(t,(e=>{var t,i;return null!==(i=null===(t=this._sources.find((t=>t.id()===e)))||void 0===t?void 0:t.sourceId())&&void 0!==i?i:null})),this._chartApi.createStudy(this._studyId,this._turnaround,this.isChildStudy()?(0,n.ensureNotNull)(this._sources[0].sourceId()):(0,n.ensureNotNull)(this._series.seriesSource().instanceId()),this._studyName,t,this._handler,this.isChildStudy())}_stopStudyOnServer(){this._chartApi&&this._chartApi.isConnected().value()&&this.isStarted()&&(this._chartApi.removeStudy((0,n.ensureNotNull)(this._studyId),this.isChildStudy()),this._setStatus({type:ot.StudyStatusType.Undefined})),this._studyId=null}_modifyStudyOnServer(e,t){const i=(0,k.clone)((0,n.ensureDefined)(e));m.StudyMetaInfo.patchSoSInputs(i,(e=>{var t,i;return null!==(i=null===(t=this._sources.find((t=>t.id()===e)))||void 0===t?void 0:t.sourceId())&&void 0!==i?i:null})),this._chartApi.modifyStudy((0,n.ensureNotNull)(this._studyId),this._turnaround,i,this._handler,t)}_transformData(e){}_updateMaxOffsetValue(){let e=-1/0;for(const t of this._metaInfo.plots)e=Math.max(this.offset(t.id),e);this._maxOffset.setValue(e)}_rightOffsetToUnixTime(e){if(this._series.bars().size()>=e){const t=(0,n.ensureNotNull)(this._series.bars().lastIndex())-e;return(0,n.ensureNotNull)(this._series.bars().valueAt(t))[0]}return null}_invalidateLastNonEmptyPlotRowCache(){this._lastNonEmptyPlotRowCache={}}_collectDepsForAlert(){throw new Error("Not implemented")}_allInputsAreValid(){for(const e of this._metaInfo.inputs)if("bar_time"===e.type){const t=e.id;if(null==this._properties.childs().inputs.childs()[t].value())return!1}return!0}_startAfterSymbolsResolved(e,t){if(this.isStarted()&&!this._restarting)return;if(!this._sources.some((e=>!(e.isStarted()&&!e.isRestarting())&&(e.onStart().subscribe(this,this._startAfterSymbolsResolved,!0),!0)))&&(this._restarting=!1,this._allInputsAreValid()&&(this._inputs=this._apiInputs(),this._createStudyOnServer(),this._subscribeToSessionId(),this._onStart.fire(),!0===e&&this._children)))for(const e of this._children)e.start(!0,t)}_changeInputsImpl(e,t){var s;const r=this._calcSources();let a=!0;const l=jt(this._metaInfo,e,t)
;if(r.length!==this._sources.length||r[0]!==this._sources[0])a=this._rebindToSourceOrRestorePreviousValue(null!==(s=r[0])&&void 0!==s?s:this._series,e,t),a&&(this._inputs=e);else{if(this.isStarted()&&this._chartApi.isConnected().value()&&l>0&&!this._chartApi.canCreateStudy(!0)){const s=window.user.pro_plan;createGoProDialog({feature:"studyOnStudy",actions:s&&[ProPlans.ProPremium,ProPlans.ProPremiumTrial].includes(s)?[{text:o.t(null,void 0,i(875139)),action:PredefinedAction.Close}]:void 0});for(const i of this._metaInfo.inputs){if("source"!==i.type)continue;const s=e[i.id].v,r=t[i.id].v;if(s!==r){(0,n.ensureDefined)(this._properties.childs().inputs.child(i.id)).setValue(r)}}return}this._inputs=e;let s=!1;const a=Object.values(D.RangeDependentStudyInputNames);for(const i of Object.keys(e))if(JSON.stringify(e[i])!==JSON.stringify(t[i])&&!a.includes(i)){s=!0;break}this._incrementTurnaround(),s&&this.disablePriceRangeReady(),this._updateParentSources(r,l),this._modifyStudyOnServer(e,l)}this.invalidateTitleCache(),a&&(this._studyModified=a)}createPriceAxisView(e){return new mt(this,{plotIndex:e})}createPriceLineAxisView(e){return new gt.StudyPriceLineAxisView(this,e)}_createStudyPlotPaneView(e){return new Re.StudyPlotPaneView(this,this._series,this._model,e)}_createViews(){var e,t,i,s;this._priceAxisViewsBase=[],this._priceLinesAxisViews=[],this._paneViews=[],this._labelPaneViews=[];const r=new Set,o=this.metaInfo(),a=Boolean(o.usePlotsZOrder),l=new Map,c=this._properties.childs();if(c.filledAreas&&o.filledAreas)for(let e=0;e<o.filledAreas.length;++e){const t=o.filledAreas[e],i=(0,n.ensureDefined)(c.filledAreasStyle.childs()[t.id]),s=Nt(o,t.id);let r;if("plot_plot"===t.type||s?r=new Je(this,this.model(),t,i):"hline_hline"===t.type?r=new nt(this,t,i):Lt.logWarn("Unsupported filledArea type: "+t.type),void 0!==r){const e=a?(0,n.ensureDefined)(t.zorder):l.size;Rt(e,l),l.set(e,{paneViews:[r]})}}{let s=-1e5;for(let c=0;c<o.plots.length;c++){const h=o.plots[c];let d,u,p,_,m;if((0,b.isNonVisualPlot)(h))continue;let g=h.id,f=o.styles;const v=(0,b.isBgColorerPlot)(h);if(v)d=new W(this,this._series,this._model,g);else if((0,b.isShapesPlot)(h))d=new fe(this,this._series,this._model,g);else if((0,b.isCharsPlot)(h))d=new we(this,this._series,this._model,g);else if((0,b.isArrowsPlot)(h))d=new Le(this,this._series,this._model,g);else if((0,b.isOhlcPlot)(h)){const e=h.target;if(r.has(e))continue;if(r.add(e),Bt(o,c))d=new Ee(this,this._series,this._model,e);else{if(!Vt(o,c)){Lt.logError(`plot ${h.id} looks to be invalid`);continue}d=new Be(this,this._series,this._model,e)}_=this.createPriceAxisView(e),p=new Ve.PanePriceAxisView(_,this,this._model),g=e,f=o.ohlcPlots}else(0,b.isDataPlot)(h)||(_=this.createPriceAxisView(g),m=this.createPriceLineAxisView(g),d=this._createStudyPlotPaneView(g),(null===(t=null===(e=this._properties.childs().styles.childs()[g])||void 0===e?void 0:e.child("trackPrice"))||void 0===t?void 0:t.value())&&(u=new Fe(this,g)),p=new Ve.PanePriceAxisView(_,this,this._model));const S=a?v?s++:(0,
n.ensureDefined)(null===(i=null==f?void 0:f[g])||void 0===i?void 0:i.zorder):l.size;Rt(S,l);const y={paneViews:void 0!==d?[d]:[],labelView:p,priceAxisView:_,priceLineAxisView:m};void 0!==u&&y.paneViews.push(u),l.set(S,y)}}(null!==(s=this._metaInfo.bands)&&void 0!==s?s:[]).forEach(((e,t)=>{const i=c.bands.childs()[t];if(i&&i.childs().visible.value()){const t=new tt(i,this),s=a?(0,n.ensureDefined)(e.zorder):l.size;Rt(s,l),l.set(s,{paneViews:[t]})}})),c.bandsBackground&&((0,n.assert)(!a,"'usePlotsZOrder' flag does not supported"),l.set(l.size,{paneViews:[new rt(this)]}));const h=this._paneViews;this._createGraphicsPaneViews().then((e=>{for(let t=0;t<e.length;t++)h.push(e[t]);this._model.lightUpdate()})),c.areaBackground&&((0,n.assert)(!a,"'usePlotsZOrder' flag does not supported"),l.set(l.size,{paneViews:[new Ze(this,this.model())]}));const d=Array.from(l.keys()).sort(((e,t)=>e-t));for(let e=0;e<d.length;e++){const t=(0,n.ensureDefined)(l.get(d[e]));this._paneViews.push(...t.paneViews),t.labelView&&this._labelPaneViews.push(t.labelView),t.priceAxisView&&this._priceAxisViewsBase.push(t.priceAxisView),t.priceLineAxisView&&this._priceLinesAxisViews.push(t.priceLineAxisView)}this._dataWindowView||(this._dataWindowView=new Qe.StudyDataWindowView(this,this._model)),this._legendView||(this._legendView=new w(this,this._model)),this._statusView||(this._statusView=new C.StudyStatusView(this)),this._concatPriceAxisViews()}_concatPriceAxisViews(){this._priceAxisViews=[...this._priceAxisViewsBase,...this._graphicsPriceAxisViews]}onData(e){switch(e.method){case"study_loading":this._onStudyLoading();break;case"study_error":this._onStudyError(e.params[2]);break;case"study_completed":if(!this._checkTurnaround(e.params[1]))return;this._onStudyCompleted(e.params[e.params.length-1]);break;case"data_update":if(e.params.customId!==this.sourceId()||!this._checkTurnaround(e.params.turnaround))return;(0,n.assert)(!!e.params.nonseries,"data.params.nonseries is missing"),this._onDataUpdate(e.params.plots,(0,n.ensureDefined)(e.params.nonseries),e.params.lastBar);break;case"clear_data":this._checkTurnaround(e.params.turnaround)&&this.clearData()}}_onStudyLoading(){var e;this._setStatus({type:ot.StudyStatusType.Loading,startTime:Date.now()}),null===(e=this._statusView)||void 0===e||e.update(),this._model.updateSource(this)}_getTelemetryObjectName(){return"study"}_handleStudyError(e){var t;this.clearData(),this._setStatus(e),null===(t=this._statusView)||void 0===t||t.update(),this._model.updateSource(this)}_onStudyError(e){const t="string"==typeof e?{error:this._getStudyErrorText(e)}:e;this._handleStudyError({type:ot.StudyStatusType.Error,errorDescription:t}),this._enablePriceRangeReady()}_onStudyCompleted(e){var t;this._studyModified&&(this.clearData(),this._studyModified=!1),this._setStatus({type:ot.StudyStatusType.Completed}),null===(t=this._statusView)||void 0===t||t.update();const i=this._model.paneForSource(this);this._model.recalculatePane(i,(0,ct.sourceChangeEvent)(this.id())),this._updateSources();const s=lt.InvalidationMask.full()
;null!==this._model.appliedTimeFrame().value()&&s.lockVisibleTimeRangeOnResize(),this._model.invalidate(s)}_onDataUpdated(e,t,i,s){if(this.hasBarColorer()&&e.length>0){const t=(0,n.ensureNotNull)(this.barColorer()).firstColoredBar(e[0].index);this._model.mainSeries().invalidateBarStylesCache(t)}null!==t&&this._postProcessGraphics();const r=this._model.paneForSource(this);this._model.recalculatePane(r,(0,ct.sourceChangeEvent)({sourceId:this.id(),firstUpdatedTimePointIndex:null!=s?s:void 0})),this._updateSources()}_updateSources(){this._model.updateSource(this),this.hasBarColorer()&&this._model.updateSource(this._model.mainSeries())}_titleInputs(e,t){return this.inputs(this._titleInputsOptions(e,t))}_titleInputsOptions(e,t){return{symbolsForDisplay:!0,skipHiddenInputs:!0,skipFakeInputs:!1,fakeInputsForDisplay:!0,asObject:!1,skippedGroups:[],noExchanges:e,noResolution:t,skipColorInputs:!0,skipTimeInputs:!0,priceInputsForDisplay:!0,skipOptionalEmptySymbolInputs:Dt}}_postProcessGraphics(){this._graphicsPriceAxisViews=this._createGraphicsPriceAxisViews(),this._concatPriceAxisViews()}async _createGraphicsPaneViews(){return(0,g.createGraphicsPaneViews)(this,this.model())}_createGraphicsPriceAxisViews(){return(0,g.createGraphicsPriceAxisViews)(this)}_subscribeToSessionId(){!this._isSubscribedToSessionId&&this.hasSymbolInputs()&&(this.sessionIdChanged().subscribe(this,this._onSessionIdChanged),this._isSubscribedToSessionId=!0)}_unsubscribeToSessionId(){this._isSubscribedToSessionId&&(this.sessionIdChanged().unsubscribe(this,this._onSessionIdChanged),this._isSubscribedToSessionId=!1)}_onSessionIdChanged(){this.restart(!0)}_title(e,t,i,s){const r=this._titleInParts(e,t,i,s);return this._joinTitlesParts(r)}_formatterByProperties(){const e=this.metaInfo().format,t=this._priceScaleByProperties();if(null!==t)switch(e.type){case"inherit":case"price":return new Tt.PriceFormatter(t);case"volume":return new xt.VolumeFormatter(Math.log10(t));case"percent":return new It.PercentageFormatter(t)}return null}_formatterByMetaInfo(){var e,t;const i=this.metaInfo().format;if("inherit"===i.type)return null;const s=this.series().symbolInfo(),r=(0,k.isNumber)(i.precision)?Math.pow(10,i.precision):void 0;{const s=null!==(t=null===(e=null===Mt.customFormatters||void 0===Mt.customFormatters?void 0:Mt.customFormatters.studyFormatterFactory)||void 0===e?void 0:e.call(Mt.customFormatters,i,this.symbolSource().symbolInfo()))&&void 0!==t?t:null;if(null!==s)return s}switch(i.type){case"price":return new Tt.PriceFormatter(r);case"volume":{let e=i.precision;return void 0===e&&(e=s&&(0,k.isNumber)(s.volume_precision)?s.volume_precision:0),new xt.VolumeFormatter(e)}case"percent":return new It.PercentageFormatter(r);default:return Lt.logWarn(`Unsupported format type: ${i.type}`),null}}_postProcessPriceRange(e){if(e&&e.minValue()===e.maxValue()&&!this.metaInfo().is_price_study){const t=.005*e.minValue();e=new p.PriceRange(e.minValue()-t,e.maxValue()+t)}const t=this.priceScale()
;return t&&t.isLog()&&e?new p.PriceRange(t.priceToLogical(e.minValue()),t.priceToLogical(e.maxValue())):e}_joinTitlesParts(e){const t=e[1]?e[1].join(", "):"";return e[0]+(t.length>0?" ("+t+")":"")}_titleInParts(e,t,s,r){var a;const l=this.name(e);t=t||{};const c=[o.t(l,{context:"study"},i(168716))];let h=[];if(!s){const i=this._getMTFResolutionInputTitle();null!==i&&i.length>0&&c.push(i);const s=this.metaInfo(),o=this._titleInputs(r,!0)||[];if(o.length>0){const i={};if(this.isChildStudy())for(let t=0;t<s.inputs.length;++t){const o=s.inputs[t];if(!m.StudyMetaInfo.isSourceInput(o))continue;const l=o.id,c=(0,n.ensureDefined)(this._properties.childs().inputs.child(l)).value();if(c.indexOf("$")>=0){const t=this.parentSourceForInput(c);if(t instanceof Gt){const s=t.metaInfo(),n=t.title(e,{},!0,r);if(1===s.plots.length)i[c]=n;else{const e=c.split("$")[1],t=null===(a=s.plots[parseInt(e)])||void 0===a?void 0:a.id,r=s.styles&&s.styles[t],o=r&&r.title||t;i[c]=n+": "+o}}}}h=o.map((e=>{let s=(0,k.isNumber)(e)?this._numericFormatter.format(e):i&&i[e.toString()]||e.toString();return t&&t[s.toString()]&&(s=t[s.toString()]),s}))}}return[c.join(" · "),h]}_getMTFResolutionInputTitle(){const e=this.metaInfo();for(let t=0;t<e.inputs.length;t++){const i=e.inputs[t];if("resolution"===i.type&&i.isMTFResolution)return(0,n.ensureDefined)(this._properties.childs().inputs.child(i.id)).value()}return null}_seriesDataRangeToSave(e){return this._model.timeScale().visibleExtendedDataRange(e,0)}_hasAvailableAlertPlots(){return!1}_hasAlertablePlots(){return!1}_hasAlertConditions(){return!1}_hasAlertFunction(){return!1}_onDataUpdate(e,t,i){this._studyModified&&(this.clearData(),this._studyModified=!1);const s=(0,d.unpackNonSeriesData)(t.d);return this._ongoingDataUpdate=this._ongoingDataUpdate.then((()=>s),(()=>s)).then(this._onDataUnpacked.bind(this,e,t.indexes,i)),this._ongoingDataUpdate}_mergeData(e){return this._invalidateLastNonEmptyPlotRowCache(),this.data().merge(e)}_getSymbolForResolve(e){return this.getSymbolString(this._getSymbolForApi(e))}_allSymbolsAreResolved(){const e=this.metaInfo(),t=[];let i=!1;for(let s=0;s<e.inputs.length;s++)if("symbol"===e.inputs[s].type){const r=e.inputs[s].id,o=(0,n.ensureDefined)(this._properties.childs().inputs.child(r)).value(),a=this._getSymbolForResolve(o);if(""!==a)if(this._resolvedSymbols[a])i=!0;else{const e=this._resolveSymbol(a,o);t.push(e)}}if(0===t.length){const e=Promise.resolve();return i?e.then((()=>this._symbolsResolved.fire())):e}return Promise.all(t).catch((e=>(this._setStatus({type:ot.StudyStatusType.Error,errorDescription:{error:At}}),this.stop(!0),this._model.updateSource(this),Promise.reject("Invalid symbol, "+e)))).then((()=>{null!==this._studyId&&this.stop(!0),this.start(!0),this._symbolsResolved.fire(),this._recheckLineToolsActuality()}))}_getSymbolForApi(e){return e}_resolveSymbol(e,t){if(""===e)return Promise.resolve();let i=this._pendingResolveSymbols.get(e);return void 0!==i||(i=new Promise(((i,s)=>{this._onSymbolResolvingStart(),this._chartApi.resolveSymbol((0,
x.makeNextSymbolId)(),e,(r=>{switch(this._pendingResolveSymbols.delete(e),r.method){case"symbol_resolved":this._setStatus({type:ot.StudyStatusType.Undefined}),this._resolvedSymbols[e]=r.params[1],this._resolvedSymbolsByInput[t]=r.params[1],this._onSymbolResolved(e,t,r.params[1]),this.invalidateTitleCache(!0),i();break;case"symbol_error":if(this._setStatus({type:ot.StudyStatusType.Error,errorDescription:{error:r.params[1]}}),this._onSymbolError(),r.params[1]===I.permissionDenied&&r.params[2]){if(r.params[2]!==I.SymbolErrorPermissionDeniedReason.Symbol)return void this._resolveSymbol(r.params[2],t).then(i);if(r.params[3])return void this._resolveSymbol(r.params[3],t).then(i)}0,s()}}))})),this._pendingResolveSymbols.set(e,i)),i}_recheckLineToolsActuality(){const e=this._model.paneForSource(this);null!==e&&e.sourcesByGroup().lineSourcesForAllSymbols().forEach((e=>{e.ownerSource()===this&&e.calcIsActualSymbol()}))}_getSymbolObject(e){const t={symbol:e},i=this.currency();return null!==this._currencySourceSymbolInputProperty&&null!==this._currencySourceSymbolInfo&&this._getSymbolForApi(this._currencySourceSymbolInputProperty.value())===e&&(t["currency-id"]=i),t.session=this.sessionId(),t}_onSymbolResolved(e,t,i){this._onCurrencyMayChange()}_onSymbolResolvingStart(){}_onSymbolError(){}_setStatus(e,t){var i;this._status=e,e.type===ot.StudyStatusType.Completed?this._wasCompletedBefore=!0:e.type!==ot.StudyStatusType.Error&&e.type!==ot.StudyStatusType.Undefined||(this._wasCompletedBefore=!1),t||(null===(i=this._statusView)||void 0===i||i.update(),this._model.updateSource(this),this._statusChanged.fire(e))}_onPropertiesChanged(){this._restarting||(this._inputs?this._tryChangeInputs():this._chartApi&&this._chartApi.isConnected().value()&&this.restart()),this._recreatePaneViews(),(0,vt.emit)("study_properties_changed",this._id)}_bandsFirstValue(e){const t=this._metaInfo;if(!t.bands)return null;for(let i=0;i<t.bands.length;i++){const t=(0,n.ensureDefined)(this._properties.childs().bands).childs()[i];if(t.childs().visible.value()){const i=t.childs().value.value();if(e&&0===i)continue;return i}}return null}_prepareInputs(e){(0,n.assert)(!!e,"options not set");const t=this.metaInfo(),i={},s=e.allowedInputTypes?new Set(e.allowedInputTypes):null;for(let r=0;r<t.inputs.length;r++){const n=t.inputs[r];if(null!==s&&!s.has(n.type))continue;if(n.isFake&&e.skipFakeInputs)continue;if(n.isMTFResolution&&e.noResolution)continue;if(e.skipHiddenInputs){let t=!1;switch(n.type){case"bool":t=e.skipBooleanInputs;break;case"color":t=e.skipColorInputs;break;case"time":t=e.skipTimeInputs;break;case"text_area":t=e.skipTextareaInputs;break;default:t=Boolean(n.isHidden)}if(t)continue}if(void 0!==n.groupId&&-1!==e.skippedGroups.indexOf(n.groupId))continue;if(-1!==e.skippedInputs.indexOf(n.id))continue;const o=this._prepareInput(n,e);"symbol"===n.type&&e.skipOptionalEmptySymbolInputs&&""===o||(i[n.id]=(0,k.clone)(o))}return i}_getAllOwnerSources(){const e=[];let t=this.ownerSource();for(;null!==t;)e.push(t),t=t.ownerSource();return e}
_getStudyIdWithLatestVersion(){return m.StudyMetaInfo.getStudyIdWithLatestVersion(this.metaInfo())}_lastNonEmptyPlotRow(e){var t;if(!(0,k.isInteger)(e))return Lt.logDebug("_lastNonEmptyPlotRow: incorrect plotIndex"),null;let i=null!==(t=this._lastNonEmptyPlotRowCache[e])&&void 0!==t?t:null;if(null!==i)return i;return i=this.data().findLast(((t,i)=>void 0!==i[e]),1e3),null===i?null:(this._lastNonEmptyPlotRowCache[e]=i,i)}_onCurrencyChanged(){"alwaysOff"!==(0,pt.currencyUnitVisibilityProperty)().value()&&this._model.fullUpdate(),this.isStarted()&&this._tryChangeInputs(),this._currencyChanged.fire()}_apiInputs(){return this.inputs({keepOptionalSymbolsEmpty:!0})}_tryChangeInputs(){var e;const t=this.isStarted()&&this._chartApi.isConnected().value();if(t&&this._allInputsAreValid())this._allSymbolsAreResolved().then((()=>{const e=this._apiInputs(),t=JSON.stringify(e)!==JSON.stringify(this._inputs);this._isStopped()?t&&this.disablePriceRangeReady():t&&this._changeInputsImpl(e,(0,n.ensureDefined)((0,k.clone)(this._inputs)))})).catch((e=>{Lt.logError("ERROR: "+this._debugId()+" _tryChangeInputs: cannot modify study, "+e)}));else{t&&this.stop(!0);const i=this._apiInputs(),s=(0,n.ensureDefined)((0,k.clone)(this._inputs));if(JSON.stringify(i)!==JSON.stringify(this._inputs)){const t=this._calcSources();if(t.length!==this._sources.length||t[0]!==this._sources[0])this._rebindToSourceOrRestorePreviousValue(null!==(e=t[0])&&void 0!==e?e:this._series,i,s);else{const e=jt(this._metaInfo,i,s);this._updateParentSources(t,e)}this._inputs=i}}this._tagsChanged.fire()}_debugId(){const e=[];return this._studyId&&e.push(this._studyId),e.push(this._metaInfo.fullId),e.push(this._metaInfo.description),JSON.stringify({study:e})}_onCurrencyMayChange(){if(null!==this._currencySourceSymbolInputProperty){const e=this.currency();this._updateCurrencySourceSymbolInfo(),e!==this.currency()&&this._onCurrencyChanged()}}_fillPrecalculatedAutoscaleInfo(e,t){const i=this._metaInfo,s=this.properties().childs(),r=new Set,n=this._metaInfo.filledAreas||[];for(let e=0;e<n.length;e++){const t=n[e];s.filledAreasStyle.childs()[t.id].childs().visible.value()&&(r.add(t.objAId),r.add(t.objBId))}return i.plots.filter((e=>!(0,b.isPlotWithTechnicalValues)(e))).filter((e=>r.has(e.id)||this.isPlotVisibleAt(e.id,1))).reduce(((i,s)=>this._applyPlotToPrecalculatedAutoscaleInfo(e,t,i,s)),{fields:[],useMainSeriesRange:!1,baseValueMinMax:null})}_firstSourceOrSeries(){var e;return null!==(e=this._sources[0])&&void 0!==e?e:this._series}_updateParentSources(e,t){if(this._sources.forEach((e=>e.unsetChild(this))),e.forEach((e=>e.setChild(this))),this._sources=e,0!==t&&this._sources.length<=1){const e=this._firstSourceOrSeries(),t=this.m_priceScale,i=(0,n.ensureNotNull)(e.priceScale());if(t!==i){const t=this._model.paneForSource(this),s=(0,n.ensureNotNull)(this._model.paneForSource(e));t===s&&s.move(this,i,!0)}}}_calcSources(){const e=this._properties.childs().inputs.state();return m.StudyMetaInfo.getSourceIdsByInputs(this._metaInfo.inputs,e).map((e=>{
if("high"===e||"open"===e||"low"===e||"close"===e||"hl2"===e||"ohl3"===e||"ohlc4"===e)return null;{const t=this._model.allStudies().find((t=>t.canHaveChildren()&&t.id()===e));return null!=t?t:null}})).filter(k.notNull)}_isStopped(){return!this.isStarted()}_onDataUnpacked(e,t,i,s){if(this._isDestroyed)return;"nochange"!==t&&this._processPlotOffsets(s),this._transformData(e);const r=this._mergeData(e);null!==s&&(s.indexes_replace?((0,n.assert)("nochange"!==t),this._graphics.replaceIndexesTo(t)):("nochange"!==t&&this._graphics.replaceIndexesTo(t),void 0!==s.graphicsCmds&&this._graphics.processCommands(s.graphicsCmds,this._metaInfo.graphics))),this._onDataUpdated(e,s,t,r&&r.index),this.priceRangeReady()||this._enablePriceRangeReady(),this._dataUpdated.fire(i,!1,r)}_processPlotOffsets(e){if(e&&e.indexes_replace)return;const t=this._plotOffsets;this._plotOffsets=e&&e.offsets||{},(0,s.default)(t,this._plotOffsets)||this.updateAllViews((0,ct.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),this._updateMaxOffsetValue()}_applyPlotToPrecalculatedAutoscaleInfo(e,t,i,s){var r;const o=s.id,a=this._properties.childs().styles.childs()[o],l=(0,b.isShapesPlot)(s)||(0,b.isCharsPlot)(s);i.useMainSeriesRange=i.useMainSeriesRange||(0,b.isArrowsPlot)(s);let c=(0,b.isLinePlot)(s)||(0,b.isOhlcPlot)(s);if(l){const e=(0,n.ensureDefined)(a).childs().location.value(),t=[v.MarkLocation.Absolute,v.MarkLocation.Top,v.MarkLocation.Bottom].indexOf(e)<0;i.useMainSeriesRange=i.useMainSeriesRange||l&&t,c=c||e===v.MarkLocation.Absolute}if(!c)return i;const h={name:o,offset:this.offset(o)},d=a,u=d.childs().plottype.value();if(!this._properties.childs().skipHistogramBaseOnAutoScale&&[b.LineStudyPlotStyle.Histogram,b.LineStudyPlotStyle.Columns,b.LineStudyPlotStyle.Area].indexOf(u)>=0){const s=null===(r=d.childs().histogramBase)||void 0===r?void 0:r.value(),n=this.data().minMaxOnRangeCached(e,t,[h]);return(0,k.isNumber)(s)&&null!==n&&(i.baseValueMinMax=(0,_.mergeMinMax)(i.baseValueMinMax,{min:s,max:s}),i.baseValueMinMax=(0,_.mergeMinMax)(i.baseValueMinMax,n)),i}return i.fields.push(h),i}_onSourceInputChanged(){if(!this.isStarted()){const e=this._calcSources();e[0]!==this._sources[0]&&this._rebindToSource(e[0],this._apiInputs())}}_rebindToSourceOrRestorePreviousValue(e,t,i){let s=!0;if(!this._rebindToSource(e,t)){const e=this._properties.childs().inputs.state(),r=m.StudyMetaInfo.getSourceIdsByInputs(this._metaInfo.inputs,e)[0];for(const e of Object.keys(i)){const o=(0,D.getInputValue)(i[e]),a=(0,D.getInputValue)(t[e]);if(i.hasOwnProperty(e)&&o!==a&&r&&(0,k.isString)(a)&&0===a.indexOf(r)){const t=(0,n.ensureDefined)(this._properties.childs().inputs.child(e)),r=(0,D.getInputValue)(i[e]);t.setValue(r),s=!1;break}}}return s}_rebindToSource(e,t){const i=this.isStarted()&&this._chartApi.isConnected().value(),s=this._firstSourceOrSeries();let r;const o=(0,k.clone)((0,n.ensureDefined)(t)),a=e instanceof Gt?[e,...this._sources]:this._sources;if(m.StudyMetaInfo.patchSoSInputs(o,(e=>{var t,i
;return null!==(i=null===(t=a.find((t=>t.id()===e)))||void 0===t?void 0:t.sourceId())&&void 0!==i?i:null})),!this.isChildStudy())return Lt.logError("Unable to rebind study to source of this type"),!1;{let t;this._sources[0].unsetChild(this);let s=null;if(e===this._model.mainSeries())this._sources=[],this._ownerSource=null,t=this._series.seriesSource().instanceId(),s=2;else{if(!(e instanceof Gt))return Lt.logError("Unable to rebind study to source of this type"),!1;this._ownerSource=e,this._sources=[e],t=e.sourceId(),e.setChild(this),null===t&&(r=e)}i&&null!==t&&(this._incrementTurnaround(),this.disablePriceRangeReady(),this._chartApi.rebindStudy((0,n.ensureNotNull)(this._studyId),this._turnaround,t,this._studyName,o,this._handler,s))}r&&(this.isStarted()&&this.stop(),r.start(!0)),s instanceof Gt&&s.processHibernate();const l=this.m_priceScale,c=(0,n.ensureNotNull)(e.priceScale());if(l!==c){const t=this._model.paneForSource(this),i=(0,n.ensureNotNull)(this._model.paneForSource(e));t===i&&i.move(this,c,!0)}const h=this._firstSourceOrSeries();return s.formatterChanged().unsubscribe(this,this._onSourceFormatterChanged),h.formatterChanged().subscribe(this,this._onSourceFormatterChanged),s.priceStepChanged().unsubscribe(this,this._onSourcePriceStepChanged),h.priceStepChanged().subscribe(this,this._onSourcePriceStepChanged),s.currencyChanged().unsubscribeAll(this),h.currencyChanged().subscribe(this,this._onSourceCurrencyChanged),s.unitChanged().unsubscribeAll(this),h.unitChanged().subscribe(this,this._onSourceUnitChanged),s.priceRangeReadyChanged().unsubscribeAll(this),h.priceRangeReadyChanged().subscribe(this,this._onSourcePriceRangeReadyChanged),this._recreatePriceFormattingDependencies(),!0}_buildInputs(e){(0,n.assert)(!!e,"options not set");let t={};try{t=this._prepareInputs(e)}catch(e){Lt.logWarn("Failed to prepare study inputs: "+e)}if(e.asObject){const e={};return Object.keys(t).forEach((i=>{null!=t[i]&&(e[i]=t[i])})),e}{const e=[];return Object.keys(t).forEach((i=>{null!=t[i]&&e.push(t[i])})),e}}_prepareInput(e,t){const i=this._prepareInputValue(e,t);return!e.isFake||t.fakeInputsForDisplay||t.onlyAtomValues?i:{v:i,f:!0,t:e.type}}_plotsForAlert(){return[]}_dependenciesForAlerts(){throw new Error("Not implemented")}_calcIsActualInterval(){const e=this._isActualInterval;this._isActualInterval=(0,at.isActualInterval)(this._series.intervalObj(),this._properties.childs().intervalsVisibilities),e!==this._isActualInterval&&(this._onIsActualIntervalChange.fire(),this._visibleChanged(),this.processHibernate())}_visibleChanged(){this._series.invalidateBarColorerCache()}_getNonPriceParent(){const e=this._sources;for(const t of e)if(t instanceof Gt){const e=t.metaInfo();return e.is_price_study&&"Compare@tv-basicstudies"!==e.id?t._getNonPriceParent():t}return null}_updateInputValue(e,t){const i=this._properties.childs().inputs.childs();if(i[t.id])if("price"===t.type)i[t.id].setValue(e.price);else if("time"===t.type){const s=this._model.timeScale().indexToTimePoint(e.index);null!==s&&i[t.id].setValue(1e3*s)}}
_initializeStudyInputsPaneViews(){}_updateCurrencySourceSymbolInfo(){var e;null!==this._currencySourceSymbolInputProperty&&(this._currencySourceSymbolInfo=null!==(e=this._resolvedSymbolsByInput[this._currencySourceSymbolInputProperty.value()])&&void 0!==e?e:null)}_initializeCurrencySource(){var e,t;const i=this.metaInfo(),s="symbolInputSymbolSource"===(null===(e=i.symbolSource)||void 0===e?void 0:e.type)&&(null===(t=i.symbolSource)||void 0===t?void 0:t.inputId),r=i.inputs.find((e=>e.id===s)),n="symbol"===(null==r?void 0:r.type);if("string"==typeof s&&n&&i.is_price_study){const e=this._properties.childs().inputs.childs()[s];void 0!==e&&(e.subscribe(this,this._onCurrencyMayChange),this._currencySourceSymbolInputProperty=e)}}_recreatePaneViews(){this.hasBarColorer()&&this._model.mainSeries().invalidateBarStylesCache(),this._createViews(),this.recalculate(),this.updateAllViews((0,ct.sourceChangeEvent)(this.id()))}_pinePatchPropsAllowed(){return(this.isStarted()||this._metaInfo.inputs.some((e=>"symbol"===e.type)))&&!this._restarting}_pinePatchProps(){throw new Error("Not implemented")}_areStudyInputsModified(e){if(0===Object.keys(e).length)return!1;if(void 0===this._oldStudyInputs)return!0;const t=Object.keys(this._oldStudyInputs);(0,n.assert)(t.length===Object.keys(e).length,"keys quantity should be equal");for(const i of t)if((0,n.assert)(e.hasOwnProperty(i),`key '${i}' should exist in study inputs`),(0,n.ensureDefined)(this._oldStudyInputs)[i]!==e[i])return!0;return!1}_getStudyErrorText(e){return e.split(":",2)[0]}}},57730:(e,t,i)=>{"use strict";i.d(t,{StudyCompare:()=>F});var s=i(650151),r=i(588535),n=i(793159),o=i(632054),a=i(976704),l=i.n(a),c=i(484727),h=i(341537),d=i(672428),u=i(273900),p=i(602564);const _=c.enabled("force_exchange_as_title");class m extends d.PriceAxisView{constructor(e,t){super(),this._studyCompare=e,this._data=t}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const r=this._studyCompare.priceScale(),n=this._studyCompare.lastValueData(this._data.plotIndex,!1);if(n.noData||null===r||r.isEmpty())return;const o=this._studyCompare.model(),a=o.timeScale().visibleBarsStrictRange(),l=o.mainSeries().bars().lastIndex();if(null===a||null===l)return;if(l<=a.lastBar())i.background=(0,p.resetTransparency)(n.color),i.textColor=this.generateTextColor(i.background),i.borderColor=void 0,e.borderVisible=!1,t.borderVisible=!1;else{const r=o.backgroundColorAtYPercentFromTop(n.coordinate/(0,s.ensureNotNull)(o.paneForSource(this._studyCompare)).height());i.background=r,i.textColor=(0,p.resetTransparency)(n.color),i.borderColor=i.textColor,e.borderVisible=!0,t.borderVisible=!0}i.coordinate=n.coordinate,i.floatCoordinate=n.floatCoordinate;const c=o.properties().childs().scalesProperties.childs();c.showSeriesLastValue.value()&&(e.text=(0,u.getCurrentModePriceText)(r,n),c.seriesLastValueMode.value()!==h.PriceAxisLastValueMode.LastPriceAndPercentageValue?e.secondLine="":e.secondLine=(0,u.getOppositeModePriceText)(r,n),e.visible=!0),t.text="",c.showSymbolLabels.value()&&(t.text=this._paneText(),
t.visible=t.text.length>0)}_paneText(){let e="";const t=this._studyCompare.symbolInfo();return _?e=(0,o.displayedSymbolExchange)(t):this._studyCompare.model().properties().childs().scalesProperties.childs().showSymbolLabels.value()&&(e=(0,o.displayedSymbolName)(t)),e}}i(509806);var g=i(492326),f=i(315264),v=i(358076),S=i(601227),y=i(486028),b=i(768950);class w extends b.StudyValuesProvider{constructor(e,t){super(e,t),this._emptyValues[0].title=e.guiPlotName("")}_hideValues(){return!1}}const P=S.CheckMobile.any();class C extends g.StudyDataWindowView{constructor(e,t){super(e,t),this._studyCompare=e}_hideValues(){return!1}_createValuesProvider(e,t){return new w(e,t)}_currentIndex(){const e=this._model.crossHairSource().lockedIndex;let t;return P&&(null===this._model.crossHairSource().pane&&void 0===e||(0,f.isLineToolName)(v.tool.value())||null!==this._model.lineBeingEdited())?t=this._study.data().lastIndex():(t=this._model.crossHairSource().appliedIndex(),(0,y.isNumber)(t)||(t=this._study.data().lastIndex())),t}}class T extends C{constructor(e,t){super(e,t),this._additional=null,this._showSeriesOHLC=t.properties().childs().paneProperties.childs().legendProperties.childs().showSeriesOHLC,this._showSeriesOHLC.subscribe(this,this.update)}areValuesVisible(){return this._showSeriesOHLC.value()}destroy(){this._showSeriesOHLC.unsubscribeAll(this)}additional(){return this._additional}_updateImpl(){super._updateImpl()}}var x=i(533927),I=i(563068),M=i(736360);class L extends M.StudyStatusProvider{getSplitTitle(){return this._source.titleInParts(!0,void 0,!1,!1)}text(){return this._source.isActualInterval()?this._source.isFailed()?`${this._source.title(!0,void 0,!1,!1)}: ${this.sourceStatusText()}`:`${this._source.title(!0,void 0,!1,!1)} ${this.sourceStatusText()}`:this._source.title(!0,void 0,!1,!1)}}var A=i(565601),k=i(210596),E=i.n(k);const D=c.enabled("study_overlay_compare_legend_option"),B=c.enabled("force_exchange_as_title"),V=c.enabled("uppercase_instrument_names"),R=!c.enabled("hide_study_compare_legend_item"),N=c.enabled("hide_unresolved_symbols_in_legend"),O=c.enabled("symbol_info_price_source");class F extends n.Study{constructor(e,t,i,s){super(e,function(e){return e.hasChild("currencyId")||e.addChild("currencyId",new(l())(null)),e.hasChild("unitId")||e.addChild("unitId",new(l())(null)),e.addExclusion("currencyId"),e.addExclusion("unitId"),e}(t),i,s),this._isActingAsSymbolSource=new(E())(!0),this._realignToolsLastParams=null,this.properties().childs().minTick.subscribe(null,(()=>this._recreatePriceFormattingDependencies())),this.properties().childs().minTick.subscribe(null,(()=>this._model.fullUpdate())),this.properties().childs().currencyId.subscribe(this,this._onCurrencyChanged),this.properties().childs().unitId.subscribe(this,this._onUnitChanged),this.properties().merge({skipHistogramBaseOnAutoScale:!0}),this._symbolResolvingActive=new(E())(!1),this._symbolHibernated=new(E())(!1),e.mainSeries().onIntervalChanged().subscribe(this,(()=>e.realignLineTools(this)))}destroy(){
this._model.mainSeries().onIntervalChanged().unsubscribeAll(this),super.destroy()}properties(){return this._properties}isActingAsSymbolSource(){return this._isActingAsSymbolSource.readonly()}createPriceAxisView(e){return new m(this,{plotIndex:"compare"})}setSymbolParams(e){this._setSymbolCurrencyUnitInternal(e)}symbol(){return this.properties().childs().inputs.childs().symbol.value()}setSymbol(e){this.setSymbolParams({symbol:e})}symbolInfo(){if(!this._resolvedSymbols)return null;const e=this.properties().childs().inputs.childs().symbol.value();if(!e)return null;let t;return t=this._resolvedSymbols[this._getSymbolForResolve(e)]||null,t}symbolResolved(){return this.symbolsResolved()}symbolResolvingActive(){return this._symbolResolvingActive}symbolHibernated(){return this._symbolHibernated}isVisible(){const e=super.isVisible();return this._symbolHibernated.setValue(!e),e}symbolSameAsCurrent(e){return(0,A.symbolSameAsCurrent)(e,this.symbolInfo())}currency(){return this.properties().childs().currencyId.value()||null}setCurrency(e){this.setSymbolParams({currency:e})}isConvertedToOtherCurrency(){return(0,o.isConvertedToOtherCurrency)(this.symbolInfo())}unit(){return this.properties().childs().unitId.value()||null}setUnit(e){this.setSymbolParams({unit:e})}isConvertedToOtherUnit(){return(0,o.isConvertedToOtherUnit)(this.symbolInfo(),this._model.unitConversionEnabled())}style(){return 2}setStyle(e){}interval(){return this._model.mainSeries().interval()}setInterval(e){}symbolSource(){return this}state(e,t){const i=super.state(e,t);return this._model.unitConversionEnabled()||delete i.state.unitId,e&&((0,s.ensureDefined)(i.data).symbols={___snapshot:this.symbolInfo()||void 0}),i}symbolTitle(e,t){return this.title(!0,{},!1,e)}titleInParts(e,t,i,s){var r;const n=this._titleInParts(e,t,i,s),o=[n[0],...null!==(r=n[1])&&void 0!==r?r:[]].join(", ");return[V?o.toUpperCase():o]}tags(){const e=this.symbol();return e?[e]:[]}statusView(){return R?super.statusView():null}guiPlotName(e){return this.properties().childs().inputs.childs().symbol.value()}canOverrideMinTick(){return!0}canBeHiddenByGlobalFlag(){return!1}valuesProvider(){return new w(this,this.model())}statusProvider(e){return new L(this,this._model.properties().childs().scalesProperties.childs().textColor)}measureUnitId(){return(0,o.measureUnitId)(this.symbolInfo())}_createViews(){this._legendView||(this._legendView=new T(this,this._model)),this._dataWindowView||(this._dataWindowView=new C(this,this._model)),this._statusView||(this._statusView=new x.StudyStatusView(this)),super._createViews()}_showLastValueOnPriceScale(){return this._model.properties().childs().scalesProperties.childs().showSeriesLastValue.value()}_onUnitChanged(){"alwaysOff"!==(0,r.currencyUnitVisibilityProperty)().value()&&this._model.fullUpdate(),this._model.unitConversionEnabled()&&this.isStarted()&&this._tryChangeInputs(),this._unitChanged.fire()}_getSymbolObject(e){const t=super._getSymbolObject(e),i=this.currency();null!==i&&(t["currency-id"]=i);const s=this.unit()
;return this._model.unitConversionEnabled()&&null!==s&&(t["unit-id"]=s),t}_getSymbolForApi(e){return(0,o.symbolForApi)(this._resolvedSymbolsByInput[e]||null,e)}_onSymbolResolvingStart(){super._onSymbolResolvingStart(),this._symbolResolvingActive.setValue(!0)}_onSymbolError(){super._onSymbolError(),this._symbolResolvingActive.setValue(!1)}_onSymbolResolved(e,t,i){super._onSymbolResolved(e,t,i),this._recreatePriceFormattingDependencies();const s=t===this.symbol()?(0,o.extractSymbolNameFromSymbolInfo)(i,this.symbol()):null,r=(0,o.symbolCurrency)(i),n=(0,o.symbolUnit)(i,this._model.unitConversionEnabled());this._setSymbolCurrencyUnitInternal({symbol:null!=s?s:void 0,currency:r,unit:n},i),this._symbolResolvingActive.setValue(!1)}_changeInputsImpl(e,t){super._changeInputsImpl(e,t),this._realignLineToolsIfParamsChanged()}_createStudyOnServer(){super._createStudyOnServer(),this._realignLineToolsIfParamsChanged()}_tryCreateFormatter(){var e,t;const i=null!==(t=null===(e=null===I.customFormatters||void 0===I.customFormatters?void 0:I.customFormatters.priceFormatterFactory)||void 0===e?void 0:e.call(I.customFormatters,this.symbolInfo(),this.properties().childs().minTick.value()))&&void 0!==t?t:null;return null!==i?i:(0,o.createSeriesFormatter)(this.symbolInfo(),this.properties().childs().minTick.value())}_titleInParts(e,t,i,s){const r=this.symbolInfo();return[this._getSymbolTitlePart(r),[this._getExchangeTitlePart(r,s),this._getPriceSourceTitlePart(r)].filter((e=>null!==e))]}_getSymbolTitlePart(e){var t;if(null===e)return N?"":this.properties().childs().inputs.childs().symbol.value();const i=(0,o.getStudySymbolExchange)(e);if(B&&void 0!==i)return i;if(D)switch(this._model.mainSeries().symbolTextSourceProxyProperty().value()){case"description":return e.description;case"ticker-and-description":return`${e.name}, ${e.description}`;case"long-description":return null!==(t=e.long_description)&&void 0!==t?t:e.description}return e.name}_getExchangeTitlePart(e,t){var i;return null===e||t?null:null!==(i=(0,o.getStudySymbolExchange)(e))&&void 0!==i?i:null}_getPriceSourceTitlePart(e){var t;return O&&!1!==this._model.properties().childs().paneProperties.childs().legendProperties.childs().showPriceSource.value()&&void 0!==(null==e?void 0:e.price_source_id)&&null!==(t=this._model.availablePriceSources().name(e.price_source_id))&&void 0!==t?t:null}_setSymbolCurrencyUnitInternal(e,t){const{symbol:i,currency:s,unit:r}=e,n=this.properties().childs(),a=n.inputs.childs().symbol.value(),l=n.currencyId.value(),c=n.unitId.value();if(void 0!==i&&i!==a&&n.inputs.childs().symbol.setValueSilently(i),void 0!==s&&s!==l&&n.currencyId.setValueSilently(s),void 0!==r&&r!==c&&n.unitId.setValueSilently(r),t)this._resolvedSymbolsByInput[this.symbol()]=t,this._resolvedSymbols[this._getSymbolForResolve(this.symbol())]=t,this._realignToolsLastParams=null;else{const e=this.symbolInfo();null!==e&&(n.currencyId.setValueSilently((0,o.symbolCurrency)(e)),n.unitId.setValueSilently((0,o.symbolUnit)(e,this._model.unitConversionEnabled())))}
n.inputs.childs().symbol.value()!==a&&n.inputs.childs().symbol.listeners().fire(n.inputs.childs().symbol),n.currencyId.value()!==l&&n.currencyId.listeners().fire(n.currencyId),n.unitId.value()!==c&&n.unitId.listeners().fire(n.unitId),this._realignLineToolsIfParamsChanged()}_realignLineToolsIfParamsChanged(){const e=this.symbol(),t=this.interval(),i=this.currency(),s=this.unit();null!==this._realignToolsLastParams&&this._realignToolsLastParams.symbol===e&&this._realignToolsLastParams.interval===t&&this._realignToolsLastParams.currency===i&&this._realignToolsLastParams.unit===s||(this._model.realignLineTools(this),this._realignToolsLastParams={symbol:e,interval:t,currency:i,unit:s})}}},29405:(e,t,i)=>{"use strict";i.d(t,{StudyOverlayBase:()=>ce});var s=i(650151),r=i(601227),n=i(817808),o=i(793159),a=i(307007),l=i(588535),c=i(510656),h=i(632054),d=i(976704),u=i.n(d),p=i(881881),_=i(484727),m=i(729357),g=i(565601),f=i(243387),v=i(382213),S=i(445588),y=i(153026),b=i(486028),w=i(786432),P=i(210596),C=i.n(P),T=i(563068),x=i(744687),I=i(533927),M=i(404356),L=i(672428),A=i(341537),k=i(273900),E=i(602564);const D=_.enabled("force_exchange_as_title");class B extends L.PriceAxisView{constructor(e){super(),this._source=e}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const r=this._source.lastValueData("close",!1);if(r.noData)return;const n=this._source.model(),o=this._source.priceScale();if(null===o)return;if(!n.isPriceScaleVisible(o))return;const a=n.timeScale().visibleBarsStrictRange(),l=n.mainSeries().bars().lastIndex();if(null===a||null===l)return;if(l<=a.lastBar())i.background=(0,E.resetTransparency)(r.color),i.textColor=this.generateTextColor(r.color),e.borderVisible=!1,t.borderVisible=!1;else{const o=n.backgroundColorAtYPercentFromTop(r.coordinate/(0,s.ensureNotNull)(n.paneForSource(this._source)).height());i.background=o,i.textColor=(0,E.resetTransparency)(r.color),i.borderColor=i.textColor,e.borderVisible=!0,t.borderVisible=!0}i.coordinate=r.coordinate,i.floatCoordinate=r.floatCoordinate;const c=this._source.model().properties().childs().scalesProperties.childs();c.showSeriesLastValue.value()&&(e.text=(0,k.getCurrentModePriceText)(o,r),c.seriesLastValueMode.value()!==A.PriceAxisLastValueMode.LastPriceAndPercentageValue?e.secondLine="":e.secondLine=(0,k.getOppositeModePriceText)(o,r),e.visible=!0),t.text="",c.showSymbolLabels.value()&&(t.text=this._paneText(),t.visible=t.text.length>0)}_paneText(){let e="";const t=this._source.symbolInfo();return D?e=(0,h.displayedSymbolExchange)(t):this._source.model().properties().childs().scalesProperties.childs().showSymbolLabels.value()&&(e=(0,h.displayedSymbolName)(t)),e}}var V=i(929654);class R extends V.PriceLineAxisView{constructor(e){super(),this._study=e}_value(){return this._study.lastValueData("",!0)}_priceLineColor(e){return e}_lineWidth(){return 1}_isVisible(){const e=this._study.model().properties().childs().scalesProperties.childs().showSeriesLastValue.value();return this._study.properties().childs().showPriceLine.value()&&e}}var N=i(284269),O=i(68976);class F{
constructor(e){this._lineRenderer=new O.HorizontalLineRenderer,this._visible=!1,this._source=e}update(){if(this._visible=!1,!this._source.properties().childs().showPriceLine.value())return;const e=this._source.lastValueData("",!0);e.noData||(this._visible=!0,this._lineRenderer.setData({y:e.coordinate,color:e.color,linewidth:1,linestyle:N.LINESTYLE_DOTTED,visible:this._visible}))}renderer(){return this._visible?this._lineRenderer:null}}var W=i(744833),z=(i(509806),i(470441)),H=i(896778);class U extends W.OverlayDataWindowView{constructor(e,t){super(e,t),this._additional=null,this._studyOverlay=e,this._backgroundColorSpawn=t.backgroundTopColor().spawn(),this._backgroundColorSpawn.subscribe(this.update.bind(this));const i=t.properties().childs().paneProperties.childs().legendProperties.childs();this._visibilityProperty=(0,H.combineProperty)(((e,t)=>e||t),i.showBarChange,i.showSeriesOHLC),this._visibilityProperty.subscribe(this,this.update)}areValuesVisible(){return this._visibilityProperty.value()}additional(){return this._additional}destroy(){this._backgroundColorSpawn.destroy(),this._visibilityProperty.destroy()}_updateImpl(){super._updateImpl()}_createValuesProvider(e,t){return new z.OverlayLegendValuesProvider(e,t)}}var j=i(70362),G=i(575960),q=i(170554),$=i(363425),Y=i(155957),K=i(279822),Z=i(659020),X=i(386434),J=i(740517),Q=i(254303);const ee=r.CheckMobile.any()&&!0,te=_.enabled("uppercase_instrument_names"),ie=_.enabled("study_overlay_compare_legend_option"),se=_.enabled("secondary_series_extend_time_scale"),re=_.enabled("hide_unresolved_symbols_in_legend"),ne=!_.enabled("hide_study_overlay_legend_item"),oe=_.enabled("symbol_info_price_source"),ae=(0,n.getLogger)("Chart.StudyOverlay");function le(e,t){return null==e[t]}class ce extends o.Study{constructor(e,t,i,s){super(e,function(e){return e.hasChild("currencyId")||e.addChild("currencyId",new(u())(null)),e.hasChild("unitId")||e.addChild("unitId",new(u())(null)),e.addExclusion("currencyId"),e.addExclusion("unitId"),e}(t),i,s),this._quotesProvider=new m.QuotesProvider,this._seriesSource=null,this._symbolResolvingActive=new(C())(!1),this._symbolHibernated=new(C())(!1),this._styleToRecover=null,this._isActingAsSymbolSource=new(C())(!0),this._realignToolsLastParams=null,this._precomputedBarStyles=new WeakMap,this.m_data=new S.PlotList((0,c.seriesPlotFunctionMap)(),le),ee&&this._quotesProvider.quotesUpdate().subscribe(this,this._onQuotesUpdate);const r=this.properties().childs();r.currencyId.subscribe(this,this._onCurrencyChanged),r.unitId.subscribe(this,this._onUnitChanged),r.allowExtendTimeScale.subscribe(this,this._onAllowExtendTimeScaleChanged),this._onAllowExtendTimeScaleChanged(),r.style.subscribe(this,this._onChartStyleChanged),r.lineStyle.childs().priceSource.subscribe(this,this._updateBarFunction),r.areaStyle.childs().priceSource.subscribe(this,this._updateBarFunction),r.baselineStyle.childs().priceSource.subscribe(this,this._updateBarFunction),r.columnStyle.childs().priceSource.subscribe(this,this._updateBarFunction),this._updateBarFunction(),
this._formatter=null,e.mainSeries().onIntervalChanged().subscribe(this,(()=>e.realignLineTools(this)))}destroy(){this._model.mainSeries().onIntervalChanged().unsubscribeAll(this),super.destroy()}isActingAsSymbolSource(){return this._isActingAsSymbolSource.readonly()}precomputedBarStyle(e){return this._precomputedBarStyles.get(e)}setPrecomputedBarStyle(e,t){this._precomputedBarStyles.set(e,t)}properties(){return this._properties}barColorer(){return new Q.SeriesBarColorer(this)}setSymbolParams(e){this._setSymbolParamsInternal(e)}symbol(){return this.properties().childs().inputs.childs().symbol.value()}setSymbol(e){this.setSymbolParams({symbol:e})}symbolInfo(){if(!this._resolvedSymbols)return null;const e=this._properties.childs().inputs.childs().symbol.value();if(!e)return null;let t;return t=this._resolvedSymbols[this._getSymbolForResolve(e)]||null,t}supportsPressedChunks(){return!1}pressedChunks(e,t){throw new Error("Pressed chunks are not supported")}data(){return null===this._seriesSource?super.data():this._seriesSource.data().bars()}symbolResolved(){return this.symbolsResolved()}symbolResolvingActive(){return this._symbolResolvingActive}symbolHibernated(){return this._symbolHibernated}isVisible(){const e=super.isVisible();return this._symbolHibernated.setValue(!e),e}symbolSameAsCurrent(e){return(0,g.symbolSameAsCurrent)(e,this.symbolInfo())}priceSource(){const e=this.properties().childs();switch(e.style.value()){case 2:return e.lineStyle.childs().priceSource.value();case 3:return e.areaStyle.childs().priceSource.value();case 10:return e.baselineStyle.childs().priceSource.value();case 13:return e.columnStyle.childs().priceSource.value()}return null}barFunction(){return this._barFunction}quotes(){return this._quotesProvider.quotes()}currency(){return this.properties().childs().currencyId.value()||null}setCurrency(e){this.setSymbolParams({currency:e})}isConvertedToOtherCurrency(){return(0,h.isConvertedToOtherCurrency)(this.symbolInfo())}unit(){return this.properties().childs().unitId.value()||null}setUnit(e){this.setSymbolParams({unit:e})}isConvertedToOtherUnit(){return(0,h.isConvertedToOtherUnit)(this.symbolInfo(),this._model.unitConversionEnabled())}style(){return this.properties().childs().style.value()}setStyle(e){this.setSymbolParams({style:e})}interval(){return this._model.mainSeries().interval()}setInterval(e){}symbolSource(){return this}barsProvider(){return this}state(e,t){const i=super.state(e,t);return this._model.unitConversionEnabled()||delete i.state.unitId,e&&((0,s.ensureDefined)(i.data).symbols={___snapshot:this.symbolInfo()||void 0}),i}symbolTitle(e,t){return this.title(!0,{},!1,e)}title(e,t,i,s){var r;const n=this._titleInParts(e,t,i,s),o=[n[0],...null!==(r=n[1])&&void 0!==r?r:[]].join(", ");return te?o.toUpperCase():o}titleInParts(e,t,i,s){return[this.title(e,t,i,s)]}isStarted(){return null===this._seriesSource?super.isStarted():this._seriesSource.isStarted()}sourceId(){return null===this._seriesSource?super.sourceId():(0,s.ensureNotNull)(this._seriesSource.instanceId())}moveData(e){
null===this._seriesSource?super.moveData(e):this._seriesSource.moveData(e)}firstValue(){const e=this._model.timeScale().visibleBarsStrictRange();if(null===e)return null;const t=e.firstBar();if(0===this.data().size())return this._ownFirstValue;const i=this.data().search(t,y.PlotRowSearchMode.NearestRight,1);return this._ownFirstValue=null!==i?this._barFunction(i.value,0):null,this._ownFirstValue}lastValueData(e,t,i){const s={noData:!0},r=this.priceScale();if(this._model.timeScale().isEmpty()||null===r||r.isEmpty()||this.data().isEmpty())return s;const n=this._model.timeScale().visibleBarsStrictRange();if(null===n)return s;const o=this.properties().childs();if(!o.visible.value())return s;const a=this.nearestIndex(n.lastBar(),y.PlotRowSearchMode.NearestLeft,1);if(void 0===a)return s;const l=this.firstValue();if(null===l)return s;const c=this._lastNonEmptyPlotRow(4),h=null!==c&&n.contains(c.index),d=null!==c?c.value:null,u=t||h?d:this.data().valueAt(a);if(null===u)return s;const p=this._barFunction(u,2);if(!(0,b.isNumber)(p))return s;const _=r.priceToCoordinate(p,l);let m;switch(o.style.value()){case 0:m=u[1]<=u[4]?o.barStyle.childs().upColor.value():o.barStyle.childs().downColor.value();break;case 1:case 9:m=u[1]<=u[4]?o.candleStyle.childs().upColor.value():o.candleStyle.childs().downColor.value();break;case 13:m=u[1]<=u[4]?o.columnStyle.childs().upColor.value():o.columnStyle.childs().downColor.value();break;case 2:m=o.lineStyle.childs().color.value();break;case 3:m=o.areaStyle.childs().color1.value();break;case 10:{const e=o.baselineStyle.childs();m=_<Math.round(r.height()*(Math.abs(100-e.baseLevelPercentage.value())/100))?e.topLineColor.value():e.bottomLineColor.value();break}case 12:m=o.hiloStyle.childs().color.value();break;default:throw new Error("Not supported overlay style")}const g={...r.getFormattedValues(p,l,!0),noData:!1,floatCoordinate:_,coordinate:_,color:m};return i&&(g.price=p),g}priceRange(e,t){if(!(0,b.isInteger)(e))return ae.logDebug("priceRange: incorrect startBar"),null;if(!(0,b.isInteger)(t))return ae.logDebug("priceRange: incorrect endBar"),null;if(0===this.data().size())return null;const i=this.priceSource();let s;s=null!==i?this.data().minMaxOnRangeCached(e,t,[{name:i,offset:0}]):this.data().minMaxOnRangeCached(e,t,[{name:"low",offset:0},{name:"high",offset:0}]);const r=null!==s?new w.PriceRange(s.min,s.max):null;return this._postProcessPriceRange(r)}bars(){return this.data()}open(e){return(0,s.ensureNotNull)(this.bars().valueAt(e))[1]}high(e){return(0,s.ensureNotNull)(this.bars().valueAt(e))[2]}low(e){return(0,s.ensureNotNull)(this.bars().valueAt(e))[3]}close(e){return(0,s.ensureNotNull)(this.bars().valueAt(e))[4]}hl2(e){return(this.high(e)+this.low(e))/2}hlc3(e){return(this.high(e)+this.low(e)+this.close(e))/3}ohlc4(e){return(this.open(e)+this.high(e)+this.low(e)+this.close(e))/4}canBeHiddenByGlobalFlag(){return!1}start(e,t){var i;this._formatter=null,super.start(e,t),null===(i=this.priceScale())||void 0===i||i.updateFormatter(),ee&&this._setQuotesSymbol(this.symbol())}stop(e){super.stop(e),
this._quotesProvider.setQuotesSessionSymbol(null)}formatter(){return this._formatter||this._recreateFormatter(),(0,s.ensureNotNull)(this._formatter)}statusView(){return ne?super.statusView():null}moveItem(e,t,i){if(10===this.style()&&0===t){const t=(0,s.ensureNotNull)(this.priceScale()),i=this.properties().childs().baselineStyle,r=t.height(),n=100-e.y/r*100,o=n<0?0:Math.round(10*n)/10;i.childs().baseLevelPercentage.setValue(Math.max(Math.min(o,100),0))}}measureUnitId(){return(0,h.measureUnitId)(this.symbolInfo())}dataUpdated(){return this._dataUpdated}_onPropertiesChanged(){super._onPropertiesChanged(),this._precomputedBarStyles=new WeakMap}_tryChangeInputs(){var e;super._tryChangeInputs(),this._formatter=null,null===(e=this.priceScale())||void 0===e||e.updateFormatter()}_tryCreateFormatter(){var e,t;const i=null!==(t=null===(e=null===T.customFormatters||void 0===T.customFormatters?void 0:T.customFormatters.priceFormatterFactory)||void 0===e?void 0:e.call(T.customFormatters,this.symbolInfo(),this.properties().childs().minTick.value()))&&void 0!==t?t:null;return null!==i?i:(0,h.createSeriesFormatter)(this.symbolInfo(),this.properties().childs().minTick.value())}_onUnitChanged(){"alwaysOff"!==(0,l.currencyUnitVisibilityProperty)().value()&&this._model.fullUpdate(),this._model.unitConversionEnabled()&&this.isStarted()&&this._tryChangeInputs(),this._unitChanged.fire()}_getSymbolObject(e){const t=super._getSymbolObject(e),i=this.currency();null!==i&&(t["currency-id"]=i);const s=this.unit();return this._model.unitConversionEnabled()&&null!==s&&(t["unit-id"]=s),t}_getSymbolForApi(e){return(0,h.symbolForApi)(this._resolvedSymbolsByInput[e]||null,e)}_onSymbolResolvingStart(){super._onSymbolResolvingStart(),this._symbolResolvingActive.setValue(!0)}_onSymbolError(){super._onSymbolError(),this._symbolResolvingActive.setValue(!1)}_onSymbolResolved(e,t,i){super._onSymbolResolved(e,t,i),this._recreatePriceFormattingDependencies();const s=t===this.symbol()?(0,h.extractSymbolNameFromSymbolInfo)(i,this.symbol()):null,r=(0,h.symbolCurrency)(i),n=(0,h.symbolUnit)(i,this._model.unitConversionEnabled());if(this._setSymbolParamsInternal({symbol:null!=s?s:void 0,currency:r,unit:n},i),ee){const e=this._getSymbolForApi(this.symbol());this._setQuotesSymbol(e)}this._checkStyle(),this._symbolResolvingActive.setValue(!1)}_changeInputsImpl(e,t){super._changeInputsImpl(e,t),this._realignLineToolsIfParamsChanged()}_setQuotesSymbol(e){const t=this.symbolInfo(),i=(0,h.extractSymbolNameFromSymbolInfo)(t,e);this._quotesProvider.setQuotesSessionSymbol(i)}_createViews(){this._priceAxisViews=[];const e=new B(this);this._priceAxisViewsBase=[e];const t=new R(this);this._priceLinesAxisViews=[t],this._paneViews=[],this._labelPaneViews=[];let i=null,r=null;switch(this.properties().childs().style.value()){case 0:r=new G.SeriesBarsPaneView(this,this._model);break;case 1:r=new q.SeriesCandlesPaneView(this,this._model);break;case 9:r=new Z.SeriesHollowCandlesPaneView(this,this._model);break;case 13:r=new X.SeriesColumnsPaneView(this,this._model);break;case 2:
r=new $.SeriesLinePaneView(this,this._model);break;case 3:r=new Y.SeriesAreaPaneView(this,this._model);break;case 10:{r=new K.SeriesBaselinePaneView(this,this._model);const e=this.properties().childs().baselineStyle.childs();i=new M.SeriesWaterlinePaneView({paneHeight:()=>(0,s.ensureNotNull)(this.priceScale()).height(),color:()=>e.baselineColor.value(),baseLevelPercentage:()=>e.baseLevelPercentage.value()});break}case 12:r=new J.SeriesHiLoPaneView(this,this._model)}r&&this._paneViews.push(r),null!==i&&this._paneViews.push(i),this._paneViews.push(new F(this)),this._dataWindowView||(this._dataWindowView=new W.OverlayDataWindowView(this,this._model)),this._legendView||(this._legendView=new U(this,this._model)),this._statusView||(this._statusView=new I.StudyStatusView(this)),this._priceAxisViews=[...this._priceAxisViewsBase],this._labelPaneViews.push(new j.PanePriceAxisView(e,this,this._model))}_createStudyOnServer(){null===this._seriesSource?super._createStudyOnServer():this._modifyStudyOnServer((0,s.ensureDefined)(this._inputs)),this._realignLineToolsIfParamsChanged()}_modifyStudyOnServer(e){null===this._seriesSource?super._modifyStudyOnServer(e,0):(this._seriesSource.modifySeries((0,p.decodeExtendedSymbol)(e.symbol),(0,v.getServerInterval)(this._series.properties().childs().interval.value())),this._seriesSource.isStarted()||this._seriesSource.start())}_stopStudyOnServer(){null===this._seriesSource?super._stopStudyOnServer():this._seriesSource.stop()}_titleInParts(e,t,i,s){const r=this.symbolInfo();return[this._getSymbolTitlePart(r),[this._getExchangeTitlePart(r,s),this._getPriceSourceTitlePart(r)].filter((e=>null!==e))]}_getSymbolTitlePart(e){var t;if(null===e)return re?"":this.properties().childs().inputs.childs().symbol.value();if(ie)switch(this._model.mainSeries().symbolTextSourceProxyProperty().value()){case"description":return e.description;case"ticker-and-description":return`${e.name}, ${e.description}`;case"long-description":return null!==(t=e.long_description)&&void 0!==t?t:e.description}return e.name}_getExchangeTitlePart(e,t){var i;return null===e||t?null:null!==(i=(0,h.getStudySymbolExchange)(e))&&void 0!==i?i:null}_getPriceSourceTitlePart(e){var t;return oe&&!1!==this._model.properties().childs().paneProperties.childs().legendProperties.childs().showPriceSource.value()&&void 0!==(null==e?void 0:e.price_source_id)&&null!==(t=this._model.availablePriceSources().name(e.price_source_id))&&void 0!==t?t:null}_onAllowExtendTimeScaleChanged(){const e=this.isStarted();if(e&&this.stop(!0),se&&this.properties().childs().allowExtendTimeScale.value()){this._seriesSource=new f.SeriesDataSource(this._model.chartApi(),"st_o_");const e=this._seriesSource.dataEvents();e.seriesError().subscribe(this,(e=>{this._onStudyError(this._convertSeriesErrorToStudy(e))})),e.loading().subscribe(this,this._onStudyLoading),e.completed().subscribe(this,(e=>{this._onStudyCompleted(e.time)})),e.dataUpdated().subscribe(this,(()=>{this._studyModified=!1;const e=this._model.paneForSource(this);this._model.recalculatePane(e,(0,
x.sourceChangeEvent)(this.id())),this._updateSources(),this.priceRangeReady()||this._enablePriceRangeReady()}))}else{if(null!==this._seriesSource){const e=this._seriesSource.dataEvents();e.seriesError().unsubscribeAll(this),e.loading().unsubscribeAll(this),e.completed().unsubscribeAll(this),e.dataUpdated().unsubscribeAll(this),this._seriesSource.destroy()}this._seriesSource=null}e&&this.start(!0)}_convertSeriesErrorToStudy(e){return{error:e.error,ctx:e.ctx,solution_id:e.solution_id}}_setSymbolParamsInternal(e,t){const{symbol:i,currency:s,unit:r,style:n}=e,o=this.properties().childs(),a=o.inputs.childs().symbol.value(),l=o.currencyId.value(),c=o.unitId.value(),d=o.style.value();if(void 0!==i&&i!==a&&o.inputs.childs().symbol.setValueSilently(i),void 0!==s&&s!==l&&o.currencyId.setValueSilently(s),void 0!==r&&r!==c&&o.unitId.setValueSilently(r),void 0!==n&&o.style.setValueSilently(n),t)this._resolvedSymbolsByInput[this.symbol()]=t,this._resolvedSymbols[this._getSymbolForResolve(this.symbol())]=t,this._realignToolsLastParams=null;else{const e=this.symbolInfo();null!==e&&(o.currencyId.setValueSilently((0,h.symbolCurrency)(e)),o.unitId.setValueSilently((0,h.symbolUnit)(e,this._model.unitConversionEnabled())))}o.inputs.childs().symbol.value()!==a&&o.inputs.childs().symbol.listeners().fire(o.inputs.childs().symbol),o.currencyId.value()!==l&&o.currencyId.listeners().fire(o.currencyId),o.unitId.value()!==c&&o.unitId.listeners().fire(o.unitId),o.style.value()!==d&&o.style.listeners().fire(o.style),this._checkStyle(),this._realignLineToolsIfParamsChanged()}_updateBarFunction(){this._barFunction=(0,a.barFunctionByStyle)(this.style(),this.priceSource())}_onChartStyleChanged(){var e;this._updateBarFunction(),(null===(e=this._styleToRecover)||void 0===e?void 0:e.originalStyle)!==this.style()&&(this._styleToRecover=null)}_checkStyle(){const e=this.style();(0,h.isCloseBasedSymbol)(this.symbolInfo())?(0,h.isSingleValueBasedStyle)(e)||(this.setStyle(2),this._styleToRecover={correctedStyle:this.style(),originalStyle:e}):null!==this._styleToRecover&&(this.setStyle(this._styleToRecover.originalStyle),this._styleToRecover=null)}_realignLineToolsIfParamsChanged(){const e=this.symbol(),t=this.interval(),i=this.currency(),s=this.unit();null!==this._realignToolsLastParams&&this._realignToolsLastParams.symbol===e&&this._realignToolsLastParams.interval===t&&this._realignToolsLastParams.currency===i&&this._realignToolsLastParams.unit===s||(this._model.realignLineTools(this),this._realignToolsLastParams={symbol:e,interval:t,currency:i,unit:s})}}},103526:(e,t,i)=>{"use strict";i.d(t,{applyOverridesToStudy:()=>c,applyOverridesToStudyDefaults:()=>h});var s=i(650151),r=i(444649);const n=(0,i(817808).getLogger)("Chart.Model.StudyPropertiesOverrider");var o,a;function l(e,t,i,s){const r=i.split(".");if(0===r.length||0===r[0].length)return;const l=function(e){const t=e.split(":");return{name:t[0],type:2===t.length?t[1]:null}
}(r[0]),c=l.name,h=l.type,d=null!==h,u=!d||"band"===h,p=!d||"area"===h,_=!d||"input"===h,m=!d||"plot"===h?a.getPlotIdByTitle(e,c):null,g=u?a.getBandIndexByName(e,c):null,f=p?a.getFilledAreaIdByTitle(e,c):null,v=_?a.getInputByName(e,c):null,S=t.hasOwnProperty(c);if((null!==m?1:0)+(null!==g?1:0)+(null!==f?1:0)+(null!==v?1:0)+(S?1:0)>1)return void n.logWarn(`Study '${e.description}' has ambiguous identifier '${c}'`);const y=r[1];if(null!==m){if(1===r.length)return void n.logWarn(`Path of sub-property of '${c}' plot for study '${e.description}' must be not empty`);const i=r.slice(1);o.applyPlotProperty(e,t,m,i,s)}else if(null!==v)o.applyInputValue(t,v,s);else if(null!==g){if(void 0===y)return void n.logWarn(`Property name of '${c}' band for study '${e.description}' must be set`);o.applyBandProperty(t,g,y,s)}else if(null!==f){if(void 0===y)return void n.logWarn(`Property name of '${c}' area for study '${e.description}' must be set`);o.applyFilledAreaProperty(t,f,y,s)}else S?o.setRootProperty(t,r,s):n.logWarn(`Study '${e.description}' has no plot or input '${c}'`)}function c(e,t){const i=e.properties(),s=i.state();for(const i in t)t.hasOwnProperty(i)&&l(e.metaInfo(),s,i,t[i]);i.mergeAndFire(s)}function h(e,t,i){for(const s in e){if(!e.hasOwnProperty(s))continue;const r=s.indexOf(".");if(-1===r)continue;const o=s.substring(0,r),c=a.getMetaInfoByDescription(t,o);if(null===c){n.logWarn(`There is no such study ${o}`);continue}const h=i(c);null!==h?l(c,h,s.substring(r+1),e[s]):n.logWarn(`Cannot apply overrides for study ${o}`)}}!function(e){const t={line:r.LineStudyPlotStyle.Line,histogram:r.LineStudyPlotStyle.Histogram,cross:r.LineStudyPlotStyle.Cross,area:r.LineStudyPlotStyle.Area,columns:r.LineStudyPlotStyle.Columns,circles:r.LineStudyPlotStyle.Circles,line_with_breaks:r.LineStudyPlotStyle.LineWithBreaks,area_with_breaks:r.LineStudyPlotStyle.AreaWithBreaks,step_line:r.LineStudyPlotStyle.StepLine,step_line_with_breaks:r.LineStudyPlotStyle.StepLineWithBreaks};e.applyPlotProperty=function(e,i,o,a,l){if(void 0===i.styles)return void n.logWarn("Study does not have styles");const c=a[0];if("color"===c){const t=function(e,t,i){if(void 0===e.plots)return null;for(const s of e.plots){if(!(0,r.isPaletteColorerPlot)(s)||void 0===t.palettes)continue;const e=t.palettes[s.palette];if(s.target===i&&void 0!==e)return e}return null}(e,i,o);return void function(e,t,i,r,o){var a;void 0!==e.styles?null===t&&!isNaN(r)&&r>0?n.logWarn(`Study plot does not have color #${r}`):((0===r||isNaN(r))&&((0,s.ensureDefined)(e.styles[i]).color=String(o),r=0),null!==t&&((0,s.ensureDefined)(null===(a=t.colors)||void 0===a?void 0:a[r]).color=String(o))):n.logWarn("Study does not have styles")}(i,t,o,a.length>1?parseInt(a[1]):NaN,l)}const h=i.styles[o];if(void 0!==h&&h.hasOwnProperty(c)){if("plottype"===c){const e=t[String(l)];if(void 0===e)return void n.logWarn(`Unsupported plot type for plot: ${l}`);l=e}h[c]=l}else n.logWarn(`Study plot does not have property '${c}'`)},e.applyBandProperty=function(e,i,s,r){
if(void 0===e.bands)return void n.logWarn("Study does not have bands");const o=e.bands[i];if(void 0!==o&&o.hasOwnProperty(s)){if("plottype"===s){const e=t[String(r)];if(void 0===e)return void n.logWarn(`Unsupported plot type for band: ${r}`);r=e}o[s]=r}else n.logWarn(`Study band does not have property '${s}'`)},e.applyFilledAreaProperty=function(e,t,i,s){if(void 0===e.filledAreasStyle)return void n.logWarn("Study does not have areas");const r=e.filledAreasStyle[t];void 0!==r&&r.hasOwnProperty(i)?r[i]=s:n.logWarn(`Study area does not have property '${i}'`)},e.applyInputValue=function(e,t,i){void 0!==e.inputs&&e.inputs.hasOwnProperty(t)?e.inputs[t]=i:n.logWarn(`Study does not have input '${t}'`)},e.setRootProperty=function(e,t,i){if(0===t.length)return;let s=e;for(const e of t.slice(0,-1)){if(null==s||!s.hasOwnProperty(e))break;s=s[e]}const r=t[t.length-1];null!=s&&s.hasOwnProperty(r)?s[r]=i:n.logWarn(`Study does not have property ${t.join(".")}`)}}(o||(o={})),function(e){e.getInputByName=function(e,t){if(void 0===e.inputs)return null;t=t.toLowerCase();for(const i of e.inputs)if(i.name.toLowerCase()===t)return i.id;return null},e.getPlotIdByTitle=function(e,t){if(void 0===e.styles)return null;t=t.toLowerCase();for(const i in e.styles){const s=e.styles[i];if((void 0!==s&&void 0!==s.title?s.title:i).toLowerCase()===t)return i}return null},e.getFilledAreaIdByTitle=function(e,t){if(void 0===e.filledAreas)return null;t=t.toLowerCase();for(const i of e.filledAreas)if(i.title.toLowerCase()===t)return i.id;return null},e.getBandIndexByName=function(e,t){if(void 0===e.bands)return null;t=t.toLowerCase();for(let i=0;i<e.bands.length;++i)if(e.bands[i].name.toLowerCase()===t)return i;return null},e.getMetaInfoByDescription=function(e,t){t=t.toLowerCase();for(const i of e)if(i.description.toLowerCase()===t||i.shortDescription.toLowerCase()===t)return i;return null}}(a||(a={}))},793159:(e,t,i)=>{"use strict";var s=i(922157),r=i(632054).symbolTitle,n=i(254303).StudyBarColorer,o=i(445588).PlotList,a=i(559410),l=i(444649),c=i(732537).studyPlotFunctionMap,h=i(732537).studyEmptyPlotValuePredicate,d=i(484727),u=i(278787).StudyBase,p=i(602564).colorToInteger,_=i(817808).getLogger("Chart.Study"),m=d.enabled("datasource_copypaste"),g=d.enabled("study_symbol_ticker_description"),f=d.enabled("hide_unresolved_symbols_in_legend");function v(e,t){return e&&e[t]&&e[t].hasOwnProperty("showLast")?e[t].showLast.value():null}class S extends u{constructor(e,t,i,r){super(e,t,i,r),this._resolvedSymbols={},this._chartApi=e._chartApi,this._plotFields=[];var n=this.metaInfo().plots;if(n)for(var a=0,u=n.length;a<u;a++){var p=n[a].id;this._plotFields.push(p)}this._invalidateLastNonEmptyPlotRowCache(),this.m_data=new o(c(this._metaInfo),h),this._plotOffsetsMetaInfoOverride={},this._createViews(),this._recreatePriceFormattingDependencies(),this._properties.precision.listeners().subscribe(this,this._precisionChanged),this._showStudyArgumentsProperty.listeners().subscribe(this,this.invalidateTitleCache),
this._properties.description.listeners().subscribe(this,this.invalidateTitleCache),this._properties.inputs.listeners().subscribe(this,this.invalidateTitleCache),this._properties.shortDescription&&this._properties.shortDescription.listeners().subscribe(this,this.invalidateTitleCache),d.enabled("update_study_formatter_on_symbol_resolve")&&e.mainSeries().dataEvents().symbolResolved().subscribe(this,this._recreatePriceFormattingDependencies),e.mainSeries().dataEvents().symbolResolved().subscribe(this,this.invalidateTitleCache);var _=this,m={};this._simplePlotsCount=r.plots.filter((function(e,t){if(l.isLinePlot(e))return!0;if(l.isOhlcPlot(e)){var i=_.metaInfo().plots[t].target;return!m[i]&&(m[i]=i,!0)}return!1})).length,this.hasBarColorer()&&this._properties.visible.listeners().subscribe(e.mainSeries(),e.mainSeries().invalidateBarStylesCache),this._formatterChanged=new s,this._priceStepChanged=new s,this._aboutToBeDestroyed=new s,this._definitionsViewModel=null,this._updateMaxOffsetValue()}series(){return this._series}model(){return this._model}onTagsChanged(){return this._tagsChanged}isSavedInStudyTemplates(){for(var e=0;e<this._metaInfo.inputs.length;e++)if("bar_time"===this._metaInfo.inputs[e].type)return!1;return!0}_prepareInputValue(e,t){var i=e.id;if(t.valuesAsIsFromProperties)return this._properties.inputs[i].value();if("symbol"===e.type){var s=t&&t.symbolsForDisplay,n=this._properties.inputs[i].value(),o=s?n:this._getSymbolForApi(n),a=this._resolvedSymbols&&this._resolvedSymbols[this._getSymbolForResolve(o)];if(""===o&&e.optional){if(t&&t.keepOptionalSymbolsEmpty)return o;o=this._model.mainSeries().symbol(),a=this._model.mainSeries().symbolInfo()}if(s)if(a)if(g){switch(this._model.mainSeries().symbolTextSourceProxyProperty().value()){case"description":o=a.description;break;case"ticker-and-description":o=`${a.name}, ${a.description}`;break;case"ticker":o=a.name}}else o=r(a,t.noExchanges);else f&&(o="");else a&&(o=a.ticker||a.full_name),!this.isPine()&&t&&t.symbolsForChartApi&&(o=this.getSymbolString(o));return o}if("bar_time"===e.type){var l=this._properties.inputs[i].value();if(l<0){var c=this._rightOffsetToUnixTime(-l);l=c&&c>=0?c:l}return l}if(this._metaInfo.isTVScript||this._metaInfo.pine){if("text"===i)return this._metaInfo.defaults.inputs.text;if("pineId"===i)return this._metaInfo.scriptIdPart;if("pineVersion"===i)return this._metaInfo.pine?this._metaInfo.pine.version:"-1";if("color"===e.type&&this._metaInfo.isRGB){var h=this._properties.inputs[i].value();return p(h)}if("price"===e.type){var d=this._properties.inputs[i].value();return t.priceInputsForDisplay?this.formatter().format(d):d}return this._properties.inputs[i].value()}return this._properties.inputs[i].value()}priceLabelText(e){var t,i=this._metaInfo.styles,s=this._metaInfo.ohlcPlots;i&&i[e]&&(t=i[e]),s&&s[e]&&(t=s[e]);var r=t.title
;return 1!==this._simplePlotsCount||l.isPlotTitleDefined(r)?this._metaInfo.is_price_study&&r!==this._metaInfo.shortDescription?""===r?this._metaInfo.shortDescription:this._metaInfo.shortDescription+":"+r:r:this._metaInfo.shortDescription}data(){return this.m_data}graphics(){return this._graphics}moveData(e){this._ongoingDataUpdate=this._ongoingDataUpdate.then(function(){this._invalidateLastNonEmptyPlotRowCache(),this.data().move(e)}.bind(this))}replaceData(e,t,i){this._invalidateLastNonEmptyPlotRowCache(),this.data().remove(e+1),this.data().addTail(i,t)}static offset(e,t){var i=0;return e._plotOffsets&&void 0!==e._plotOffsets[t]&&(i+=e._plotOffsets[t]),e.properties().offsets&&void 0!==e.properties().offsets[t]&&(i+=e.properties().offsets[t].val.value()),e.properties().offset&&(i+=e.properties().offset.val.value()),i}offset(e){return S.offset(this,e)}_showLastValueOnPriceScale(){return this._model.properties().scalesProperties.showStudyLastValue.value()}barColorer(){const e=this._metaInfo.plots;let t=null;for(let i=0;i<e.length;++i)if(l.isBarColorerPlot(e[i])){const e=new n(this,i);null==t?t=e:t.pushBackBarColorer(e)}if(null==t)throw new Error("Cannot create BarColorer: study doesn't have a bar_colorer plot!");return t}base(){return 0}_priceScaleByProperties(){if("default"===this.properties().precision.value())return null;var e=parseInt(this.properties().precision.value());return isFinite(e)?Math.pow(10,e):null}_priceScaleByMetaInfo(){var e=this.metaInfo().format,t=isNumber(e.precision)?Math.pow(10,e.precision):void 0;if("price"===e.type||"percent"===e.type)return t||100;if("volume"===e.type){if(void 0===e.precision){var i=this.series().symbolInfo();if(null!==i&&isNumber(i.volume_precision))return Math.pow(10,i.volume_precision)}return 1}return"inherit"===e.type||_.logWarn("Unsupported format type: "+e.type),null}_onSourceFormatterChanged(){null===this._formatter&&(null!==this.priceScale()&&this.priceScale().updateFormatter(),this._formatterChanged.fire())}_onSourcePriceStepChanged(){null===this._priceStep&&this._priceStepChanged.fire()}_precisionChanged(){this._recreatePriceFormattingDependencies()}_recreatePriceFormattingDependencies(){this._recreateFormatter(),this._recreatePriceStep()}_recreateFormatter(){this._formatter=this._tryCreateFormatter(),this._formatterChanged.fire(),null!==this.priceScale()&&this.priceScale().updateFormatter(),this._model.fullUpdate()}_recreatePriceStep(){var e=null,t=this._tryToGetPriceScale();null!==t&&(e=1/t),this._priceStep!==e&&(this._priceStep=e,this._priceStepChanged.fire())}_tryToGetPriceScale(){var e=this._priceScaleByProperties();return null===e&&(e=this._priceScaleByMetaInfo()),e}_tryCreateFormatter(){var e=this._formatterByProperties();return null===e&&(e=this._formatterByMetaInfo()),e}setOwnerSource(e){super.setOwnerSource(e),this._recreatePriceFormattingDependencies()}nearestIndex(e,t,i){if(TradingView.isInteger(e)){var s=this.data().search(e,t,i);return null!==s?s.index:void 0}_.logDebug("nearestIndex: incorrect logicalPoint")}tags(){
return!this._metaInfo||!this._metaInfo.description||this._metaInfo.isTVScriptStub||this._metaInfo.is_hidden_study||this._metaInfo.isTVScript&&"tv-scripting"===this._metaInfo.productId?[]:[this._metaInfo.description]}onExtendedHoursChanged(){this.restart(!0)}hasSymbolInputs(){for(var e=this._metaInfo.inputs.length;e--;)if("symbol"===this._metaInfo.inputs[e].type)return!0;return!1}canOverrideMinTick(){return!1}_subscribeExtendedHours(){!this._isSubscribedToExtendedHours&&this.hasSymbolInputs()&&(this._series.onExtendedHoursChanged().subscribe(this,this.onExtendedHoursChanged),this._isSubscribedToExtendedHours=!0)}removeByRemoveAllStudies(){return!0}getPlotFields(){return this._plotFields}getMinFirstBarIndexForPlot(e){var t=v(this._properties.styles,e)||v(this._properties.ohlcPlots,e)||v(this._properties.filledAreasStyle,e);if(null===t)return-1/0;var i=this.data().lastIndex();return null===i?-1/0:i-t+1}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}getPropertyDefinitionsViewModel(){if(null===this._definitionsViewModel){var e=this;return e._getPropertyDefinitionsViewModelClass().then((function(t){return null===t||e._isDestroyed?null:(null===e._definitionsViewModel&&(e._definitionsViewModel=new t(e._model.undoModel(),e)),e._definitionsViewModel)}))}return Promise.resolve(this._definitionsViewModel)}_getTelemetryAdditionalData(){var e="";return this._metaInfo.pine&&this._metaInfo.pine.version&&this._metaInfo.shortId.indexOf("USER")>=0&&(e="_v"+this._metaInfo.pine.version),{symbol:this.series().actualSymbol(),resolution:this.series().interval(),study:this._metaInfo.shortId+e}}_sendTelemetryReport(e,t,i){void 0===i&&(i=this._getTelemetryAdditionalData());var s=Object.assign(t,{additional:i});undefined.sendChartReport(e,s)}_sendTelemetryCounter(e,t){this._sendTelemetryReport(e,{count:1},t)}onAboutToBeDestroyed(){return this._aboutToBeDestroyed}destroy(){this._aboutToBeDestroyed.fire(),this._isDestroyed=!0,null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),this._properties.precision.listeners().unsubscribe(this,this._precisionChanged),this._showStudyArgumentsProperty.listeners().unsubscribe(this,this.invalidateTitleCache),this._properties.description.listeners().unsubscribe(this,this.invalidateTitleCache),this._properties.shortDescription&&this._properties.shortDescription.listeners().unsubscribe(this,this.invalidateTitleCache),this._model.mainSeries().dataEvents().symbolResolved().unsubscribeAll(this),this.hasBarColorer()&&this._properties.visible.listeners().unsubscribe(this._model.mainSeries(),this._model.mainSeries().invalidateBarStylesCache),this._model.mainSeries().dataEvents().symbolResolved().unsubscribe(this,this._recreatePriceFormattingDependencies),void 0!==this._properties.offsets&&this._properties.offsets.listeners().unsubscribe(this,this._updateMaxOffsetValue),void 0!==this._properties.offset&&this._properties.offset.listeners().unsubscribe(this,this._updateMaxOffsetValue),super.destroy()}desiredPriceScalePosition(){
return this.metaInfo().isTVScriptStub?"overlay":this.metaInfo().linkedToSeries?"as-series":void 0===this.metaInfo().priceScale?null:["right","left","overlay"][this.metaInfo().priceScale]}guiPlotName(e){var t=this.properties().styles;return t&&t[e]&&t[e].title?t[e].title.value():this.title()}formatterChanged(){return this._formatterChanged}copiable(){return m&&!this.isChildStudy()}setPriceScale(e){super.setPriceScale(e),a.emit("study_event",this.id(),"price_scale_changed")}}TradingView.Study=S,t.Study=S},872754:(e,t,i)=>{"use strict";i.d(t,{plotShapesData:()=>r});var s=i(509806);const r={shape_arrow_down:{guiName:s.t(null,void 0,i(348732)),id:"shape_arrow_down",paneRendererClass:"PaneRendererArrowDown",pineName:"shape.arrowdown",icon:"arrow_down"},shape_arrow_up:{guiName:s.t(null,void 0,i(610650)),id:"shape_arrow_up",paneRendererClass:"PaneRendererArrowUp",pineName:"shape.arrowup",icon:"arrow_up"},shape_circle:{guiName:s.t(null,void 0,i(490068)),id:"shape_circle",paneRendererClass:"PaneRendererCircleShape",pineName:"shape.circle",icon:"circle"},shape_cross:{guiName:s.t(null,void 0,i(429908)),id:"shape_cross",paneRendererClass:"PaneRendererCrossShape",pineName:"shape.cross",icon:"cross"},shape_diamond:{guiName:s.t(null,void 0,i(773720)),id:"shape_diamond",paneRendererClass:"PaneRendererDiamond",pineName:"shape.diamond",icon:"diamond"},shape_flag:{guiName:s.t(null,void 0,i(121524)),id:"shape_flag",paneRendererClass:"PaneRendererFlagShape",pineName:"shape.flag",icon:"flag"},shape_label_down:{guiName:s.t(null,void 0,i(318528)),id:"shape_label_down",paneRendererClass:"PaneRendererLabelDown",pineName:"shape.labeldown",icon:"label_down"},shape_label_up:{guiName:s.t(null,void 0,i(513046)),id:"shape_label_up",paneRendererClass:"PaneRendererLabelUp",pineName:"shape.labelup",icon:"label_up"},shape_square:{guiName:s.t(null,void 0,i(944904)),id:"shape_square",paneRendererClass:"PaneRendererSquare",pineName:"shape.square",icon:"square"},shape_triangle_down:{guiName:s.t(null,void 0,i(483356)),id:"shape_triangle_down",paneRendererClass:"PaneRendererTriangleApexDown",pineName:"shape.triangledown",icon:"triangle_down"},shape_triangle_up:{guiName:s.t(null,void 0,i(928340)),id:"shape_triangle_up",paneRendererClass:"PaneRendererTriangleApexUp",pineName:"shape.triangleup",icon:"triangle_up"},shape_xcross:{guiName:s.t(null,void 0,i(707050)),id:"shape_xcross",paneRendererClass:"PaneRendererXCross",pineName:"shape.xcross",icon:"x_cross"}}},162390:(e,t,i)=>{"use strict";var s=i(550967).Version,r=i(817808).getLogger("Chart.StudyMigration");function n(e){this._studyId=e,this._maxToVers=s.ZERO,this._maxFromVers=s.ZERO,this._migrs=[]}n.prototype.addMigration=function(e,t,i){var r=s.parse(e),n=s.parse(t);r.isGreater(this._maxFromVers)&&(this._maxFromVers=r),n.isGreater(this._maxToVers)&&(this._maxToVers=n),this._migrs.push({fromVers:r,toVers:n,rules:i})},n.prototype.updateInputs=function(e,t,i){if(!i)return i;for(var s=TradingView.clone(i),n=e;n.isLess(t);){var o=this._findMigration(n);if(null==o)break
;if(r.logNormal("Migrating study inputs from "+o.fromVers+" to "+o.toVers+" version, studyId: "+this._studyId+", migration: "+JSON.stringify(o)+", inputs: "+JSON.stringify(i)),s=this._applyMigration(s,o),!n.isLess(o.toVers))throw new Error("Problems in study migration process... Possible infinite cycle has been detected and stopped.");n=o.toVers}return n>e&&r.logNormal("Study inputs migration is done, studyId: "+this._studyId+", inputs: "+JSON.stringify(s)),s},n.prototype._findMigration=function(e){for(var t=-1,i=this._maxFromVers,s=0;s<this._migrs.length;s++){var r=this._migrs[s];r.fromVers.isLess(e)||r.fromVers.isLessOrEqual(i)&&(i=r.fromVers,t=s)}return t<0?null:this._migrs[t]},n.prototype._applyMigration=function(e,t){for(var i=e,s=0;s<t.rules.length;s++){var r=t.rules[s];i=this._getApplyRuleFun(r.type)(i,r)}return i},n.prototype._getApplyRuleFun=function(e){if("inputRemoved"===e)return n._applyInputRemovedRule;if("inputChangedType"===e)return n._applyInputChangedTypeRule;if("inputChangedMinMax"===e)return n._applyInputChangedMinMaxRule;if("inputChangedOptions"===e)return n._applyInputChangedOptionsRule;throw new Error("Unknown migration rule type: "+e)},n._applyInputRemovedRule=function(e,t){if(!(t.inputId in e))return e;if("removeVal"!==t.action)throw new Error("Unexpected rule.action="+t.action+" in rule.type="+t.type);var i=e[t.inputId];return delete e[t.inputId],r.logNormal("Input "+t.inputId+"="+i+" removed"),e},n._applyInputChangedTypeRule=function(e,t){var i=e[t.inputId];if("resetToDefVal"===t.action)return e[t.inputId]=t.defVal,r.logNormal("Input "+t.inputId+"="+i+" reset to default value "+t.defVal),e;if("convertVal"===t.action){if(null==i)return e;if("float"===t.inputTypeFrom&&"integer"===t.inputType)return e[t.inputId]=Math.round(e[t.inputId]),r.logNormal("Input "+t.inputId+"="+i+" converted to value "+e[t.inputId]),e;if("integer"===t.inputTypeFrom&&"float"===t.inputType)return e;if("text"===t.inputTypeFrom&&"source"===t.inputType)return n._isValidSource(i,t.options)||(e[t.inputId]=t.defVal),e;throw new Error("Cannot convertVal from "+t.inputTypeFrom+" to "+t.inputType)}throw new Error("Unknown action "+t.action+" for rule with type "+t.type)},n._isValidSource=function(e,t){return e.indexOf("$")>=0||t.indexOf(e)>=0},n._applyInputChangedMinMaxRule=function(e,t){if("adjustValIfNeeded"!==t.action)throw new Error("Unknown action "+t.action+" for rule with type "+t.type);var i=e[t.inputId];return i<t.minVal?e[t.inputId]=t.minVal:i>t.maxVal&&(e[t.inputId]=t.maxVal),r.logNormal("Input "+t.inputId+"="+i+" adjusted to value "+e[t.inputId]),e},n._applyInputChangedOptionsRule=function(e,t){if(!(["text"].indexOf(t.inputType)>=0&&"resetToDefValIfNeeded"===t.action))throw new Error("Unexpected rule.inputType="+t.inputType+" in rule.action="+t.action);var i=e[t.inputId];return t.options.indexOf(i)<0&&(e[t.inputId]=t.defVal,r.logNormal("Input "+t.inputId+"="+i+" reset to default value "+t.defVal)),e},e.exports=n},675786:(e,t,i)=>{"use strict"
;var s=i(470441).OverlayLegendValuesProvider,r=i(878317).OverlayStatusProvider,n=i(29405).StudyOverlayBase;t.study_Overlay=class extends n{constructor(e,t,i,s){super(e,t,i,s),this._paneView=null;var r=this;this.properties().minTick.listeners().subscribe(null,(function(){r._recreatePriceFormattingDependencies(),r.updateAllViews(),r._model.fullUpdate()}))}_showLastValueOnPriceScale(){return this._model.properties().scalesProperties.showSeriesLastValue.value()}_onQuotesUpdate(e,t){!this._legendView||void 0===t.values.change&&void 0===t.values.change_percent||(this._legendView.update(),this._model.updateSource(this))}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._quotesProvider.destroy(),super.destroy()}tags(){var e=[],t=this.symbolInfo();return t?e.push(t.name):this._properties.inputs.symbol.value()&&e.push(this._properties.inputs.symbol.value()),e}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(3623),i.e(6682),i.e(7214),i.e(7358),i.e(34),i.e(607)]).then(i.bind(i,107007))).StudyOverlayDefinitionsViewModel}defaultPlotIdForAlert(){return""}valuesProvider(){return new s(this,this.model())}statusProvider(e){return new r(this,this.model())}}},577260:(e,t,i)=>{"use strict";var s=i(650151).assert,r=i(486028).clone,n=i(793159).Study,o=i(445588).PlotList,a=i(732537).studyPlotFunctionMap,l=i(732537).studyEmptyPlotValuePredicate;class c{constructor(e,t,i){this._strategyPlotIndex=e,this._targetPlotIndex=t,this._startIndex=i}rebuildData(e){var t=this._targetPlotIndex+1,i=this._strategyPlotIndex+1,s=null,r=null;e.range(this._startIndex||e.firstIndex(),e.lastIndex()).each((function(n,o){var a=o[t],l=o[i]?Math.round(o[i]):null;if(o[t]=null,o[i]=null,!l||l>0)return!1;var c=n+l,h={pointIndex:c,value:a};if(r){if(r.pointIndex!==h.pointIndex){c>=0&&(e.valueAt(c)[t]=a);var d=!1;s&&(d=s.value<=r.value&&r.value<=a||s.value>=r.value&&r.value>=a),d?r.pointIndex>=0&&(e.valueAt(r.pointIndex)[t]=null):s=r,r=h}}else r=h;return!1}))}}t.study_ScriptWithDataOffset=class extends n{constructor(e,t,i,s){super(e,t,i,s),this._underlyingData=new o(a(s),l)}clearData(){super.clearData(),this._underlyingData.clear()}_mergeData(e){this._invalidateLastNonEmptyPlotRowCache();var t=this._underlyingData.firstIndex();this._underlyingData.merge(e),t!==this._underlyingData.firstIndex()&&(this.m_data=new o(a(this._metaInfo),l));var i=this.m_data.lastIndex();this._underlyingData.range(i,this._underlyingData.lastIndex()).each(function(e,t){return this.m_data.add(e,r(t)),!1}.bind(this)),this._plotsForStrategyProcessing().forEach((function(e){new c(e.strategyIndex,e.targetIndex,i).rebuildData(this.m_data)}),this)}_plotsForStrategyProcessing(){var e=[];return this._metaInfo.plots.forEach((function(t,i){if("dataoffset"===t.type){var r=this._metaInfo.plots.findIndex((function(e){return e.id===t.target}));s(r>=0,"target plot not found for strategy plot "+t.id);var n={strategyIndex:i,targetIndex:r};e.push(n)}}),this),e}}},198459:(e,t,i)=>{"use strict";i.d(t,{StudyVersioning:()=>p});var s=i(162390),r=i.n(s);const n=(0,
i(817808).getLogger)("Chart.Study.Versioning");var o=i(650151).assert,a=i(550967).Version,l=i(147668),c=i(898005).StudyMetaInfo,h=i(29257).extractPineId,d=i(656788).migrateMetaInfoAndPropState;const u=1e12;class p extends class{constructor(e,t){if(this._migrations={},!e)throw new Error("No studies metainfo");if(this._studiesMetainfo=e,!t)throw new Error("No studies migrations");this._studiesMigrations=t;for(let e=0;e<this._studiesMigrations.length;e++){const t=this._studiesMigrations[e],i=t.versFrom,s=t.versTo;for(let e=0;e<t.studyMigrations.length;e++){const o=t.studyMigrations[e],a=o.studyId;if(0===o.rules.length){n.logError("Study Migration should have at least one convertion rule");continue}const l=a in this._migrations?this._migrations[a]:new(r())(a);l.addMigration(i,s,o.rules),this._migrations[a]=l}}this._clientMigrations=[(e,t)=>{if(0===this._studiesMetainfo.length||!e.isTVScript||e.version>=22)return t;const i={};let s=0,r=0,n=t[r];for(;void 0!==n;){const e=t[n.id];n.isFake&&(n.id="in_"+s++),i[r]=n,i[n.id]=e,r++,n=t[r]}return i}]}}{updateMetaInfo(e){if(!e)return e;o(!e.isTVScript,"This method should update only built-in java indicators metaInfo. For Pine indicators use updateMetaInfoAsync");for(var t=null,i=this._studiesMetainfo,s=0;s<i.length;s++)if(i[s].id===e.id){t=i[s];break}return TradingView.clone(t)}updateMetaInfoAsync(e){if(!e)return{sync:!1,result:Promise.reject("No old metaInfo was given")};new c(e),c.versionOf(e);for(var t=null,i=this._studiesMetainfo,s=0;s<i.length;s++)if(i[s].id===e.id){t=i[s];break}return{sync:!0,result:t?TradingView.clone(t):null}}lastVersionOfStudy(e){return this._studiesMetainfo.find((function(t){return t.id===e})).version}updateStudyInputs(e,t,i,s,r){var o=TradingView.clone(s);if(e in this._migrations){var l,c=a.parse(t);if("last"===i){var h=this.lastVersionOfStudy(e);l=a.parse(h)}else l=a.parse(i);o=this._migrations[e].updateInputs(c,l,o)}if(null==r)return o;for(var d in r)d in o||(o[d]=r[d]);for(var d in o)if(!(d in r)){var u=o[d];n.logWarn("Extra input detected, studyId="+e+", versionFrom="+t+", inputId="+d+", inputValue="+u+", removing it and continue..."),delete o[d]}return o}updateStudyState(e,t,i){if(null==e||null==t||null==i)return e;if(e=TradingView.clone(e),!(t.isTVScript||!!t.pine)&&t.version!==i.version){var s=i&&i.defaults.inputs,r=this.updateStudyInputs(t.id,t.version,i.version,e.inputs,s);e.inputs=r}for(var o=0;o<this._clientMigrations.length;++o){r=this._clientMigrations[o].call(this,t,e.inputs);Object.keys(r).length===Object.keys(e.inputs).length?e.inputs=r:n.logWarn("StudyVersioning._clientMigrations application returned bad result. Skipping it...")}var a=c.versionOf(t);if(t.isTVScript&&t.TVScriptSourceCode&&a>=12&&a<=26){var l={};for(o=0;o<t.plots.length;++o){var h=t.plots[o],d=i.plots[o];l[h.id]=d.id}var u=Object.keys(e.styles);for(o=0;o<u.length;++o){var p=u[o],_=e.styles[p];delete e.styles[p];var m=l[p];e.styles[m]=_}var g=Object.keys(e.plots);for(o=0;o<g.length;++o){var f=g[o];p=e.plots[f].id;e.plots[f].id=l[p]}}return e}patchPointsBasedStudyState(e){
return p._fixInputsMaxValue(e.state,e.metaInfo),e}patchPointsBasedStudyData(e,t){if(!l.isProd())return t;if(!e||!t)return t;var i=TradingView.clone(t);return"VbPFixed@tv-volumebyprice"===e.id&&e.version&&e.version<=4&&p._patchOldVolumeProfiles(0,i),i}patchStudyData(e,t,i,s){if(!l.isProd())return{data:t,nsData:i,indexes:s};var r=TradingView.clone(t),n=TradingView.clone(i),o=TradingView.clone(s);"VbPVisible@tv-volumebyprice"===e.id&&e.version&&e.version<=4&&p._patchOldVolumeProfiles(0,r.graphics),"VbPSessions@tv-volumebyprice"===e.id&&e.version&&e.version<=4&&p._patchOldVolumeProfiles(0,r.graphics);var a=c.versionOf(e);if(e.isTVScript&&e.TVScriptSourceCode&&a>=12&&a<=26){var h=r.columns;r.columns=[];for(var d=0;d<h.length;++d){var u="plot_"+d;r.columns.push(u)}}return{data:r,nsData:n,indexes:o}}static _patchOldVolumeProfiles(e,t){var i=t.hhists[e].data,s=[];for(var r in i)s=s.concat(i[r]);t.hhists[0].data=s}static _fixInputsOrder(e,t){for(var i=c.getOrderedInputIds(t),s=p.splitInputs(e.inputs),r=s.arr,n=s.obj,o=TradingView.merge({},n),a=0;a<i.length;++a){var l=i[a],h=p.findInputKeyById(r,l);if(null!==h){var d=r[h];o[a]=d}}e.inputs=o}static _verifyInputsMaxValue(e){if(e.inputs)for(var t=0;t<e.inputs.length;t++){var i=e.inputs[t];"integer"===i.type&&(i.max&&i.max>1e12&&n.logWarn("Bad integer input max value in metaInfo id="+e.id+" title="+e.description))}}static _fixInputsMaxValue(e,t){if(!TradingView.isAbsent(t)){var i=u;if(t.inputs)for(var s=0;s<t.inputs.length;s++){"integer"===(a=t.inputs[s]).type&&(a.max&&a.max>i&&(a.max=i))}if(e&&e.inputs){var r=p.splitInputs(e.inputs),n=r.arr;for(var o in n){var a;"integer"===(a=n[o]).type&&(a.max&&a.max>i&&(a.max=i))}e.inputs=TradingView.merge(r.obj,r.arr)}}}patchPropsStateAndMetaInfo(e,t,i){"Script$BOOKER"!==t.productId||t.alerts||delete e.alerts,p._fixInputsOrder(e,t),p._fixInputsMaxValue(e,t);var s=p.splitInputs(e.inputs);e.inputs=s.obj;var r=c.versionOf(t);r<c.METAINFO_FORMAT_VERSION_SOS_V2&&t.isChildStudy&&(e.isChildStudy=t.isChildStudy);if(t.isTVScript&&t.version<60&&("Script$TV_EARNINGS@tv-scripting"!==t.id&&"Script$TV_DIVIDENDS@tv-scripting"!==t.id&&"Script$TV_SPLITS@tv-scripting"!==t.id||delete t.TVScriptSourceCode),"Volume"!==t.id&&"Volume@tv-basicstudies"!==t.id||0!==t.inputs.length||(t.inputs=[{id:"length",type:"integer",defval:20,min:1,max:1e3}],t.plots.push({id:"vol_ma",type:"line"})),"Volume@tv-basicstudies"===t.id&&t.version&&t.version<=46&&void 0===e.styles.vol.transparency&&(e.styles.vol.transparency=e.transparency||87),"PivotPointsStandard@tv-basicstudies"===t.id&&(0===t.inputs.length?(e.inputs={kind:"Traditional",showHistoricalPivots:!0},t.inputs=[{defval:"Traditional",id:"kind",type:"text",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"]},{id:"showHistoricalPivots",type:"bool",defval:!0}]):1===t.inputs.length&&(e.inputs={kind:"Traditional"},t.inputs=[{defval:"Traditional",id:"kind",type:"text",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"]},{id:"showHistoricalPivots",type:"bool",defval:!0}]),
void 0===e._hardCodedDefaultsVersion)){e._hardCodedDefaultsVersion=1;var n=e.color;delete e.color,e.levelsStyle={colors:{P:n,"S1/R1":n,"S2/R2":n,"S3/R3":n,"S4/R4":n,"S5/R5":n}}}"CMF"===t.shortId&&2===t.inputs.length&&(e.inputs={length:e.inputs["length fast"]},t.inputs=t.inputs.splice(0,1),t.inputs[0].id="length"),t.defaults&&void 0===t.defaults.precision&&r<c.VERSION_NEW_STUDY_PRECISION_FORMAT&&(-1!==["Volume@tv-basicstudies","VbPVisible@tv-volumebyprice","VbPSessions@tv-volumebyprice"].indexOf(t.id)?t.defaults.precision=0:t.defaults.precision=4);if(t.version<60)for(var o=["TV_DIVIDENDS","TV_SPLITS","TV_EARNINGS"],a="Script".length,l=0;l<o.length;l++)t.id.startsWith("Script$"+o[l]+"@tv-scripting")&&(t.fullId="ESD"+t.fullId.substring(a),t.id="ESD"+t.id.substring(a),t.name="ESD"+t.name.substring(a),t.shortId="ESD"+t.shortId.substring(a),t.productId="ESD"+t.productId.substring(a));var u={"ESD$TV_EARNINGS@tv-scripting":{fullId:"Earnings@tv-basicstudies-129!",id:"Earnings@tv-basicstudies",name:"Earnings@tv-basicstudies",shortId:"Earnings",productId:"tv-basicstudies"},"ESD$TV_SPLITS@tv-scripting":{fullId:"Splits@tv-basicstudies-129!",id:"Splits@tv-basicstudies",name:"Splits@tv-basicstudies",shortId:"Splits",productId:"tv-basicstudies"},"ESD$TV_DIVIDENDS@tv-scripting":{fullId:"Dividends@tv-basicstudies-129!",id:"Dividends@tv-basicstudies",name:"Dividends@tv-basicstudies",shortId:"Dividends",productId:"tv-basicstudies"}};if(t.id in u&&Object.assign(t,u[t.id]),r<c.VERSION_PINE_PROTECT_TV_4164){var _={"StrategyScript$STD;Consecutive%1Ups/Downs%1Strategy":{pineId:"STD;Consecutive%1Ups%1Downs%1Strategy",className:"StrategyScript"},Script$EDGR_NET_INCOME_FROM_CONTINUING_OPERATIONS_APPLICABLE_TO_COMMON_V2:{pineId:"Script$EDGR_NET_INCOME_FROM_CONTINUING_OPS_APPLICABLE_TO_COMMON_V2",className:"Script"}};if(t.shortId in _){var m=_[t.shortId].className+"$"+_[t.shortId].pineId,g={scriptIdPart:_[t.shortId].pineId,fullId:t.fullId.replace(t.shortId,m),id:t.id.replace(t.shortId,m),name:t.name.replace(t.shortId,m),shortId:m};TradingView.merge(t,g),TradingView.merge(e,g)}var f=h(t.fullId),v=f&&f.match(/^(USER)(_\d+)(;)(.*)$/);if(v){var S=v[0],y=v[1]+v[3]+v[2]+v[4];g={scriptIdPart:y,fullId:t.fullId.replace(S,y),id:t.id.replace(S,y),name:t.name.replace(S,y),shortId:t.shortId.replace(S,y)};TradingView.merge(t,g),TradingView.merge(e,g)}}if("MA"===t.id){var b=new c({id:"MAExp",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgExp",type:"line"}],palettes:{}}),w=new c({id:"MASimple",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgSimple",type:"line"}],palettes:{}}),P=new c({id:"MAVolumeWeighted",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500
},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgVolumeWeighted",type:"line"}],palettes:{}}),C=new c({id:"MAWeighted",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgWeighted",type:"line"}],palettes:{}});switch(e.inputs.type){case"exp":t=b;break;case"simple":t=w;break;case"weighted":t=C;break;case"volume weighted":t=P}e.styles[t.plots[0].id]=e.styles.MovAvg,delete e.styles.MovAvg,delete e.inputs.type}return i.oldShowStudyLastValueProperty&&(e.oldShowLastValue=e.showLastValue),delete e.showLastValue,delete e.showStudyArguments,d(t,e),{propsState:e,metaInfo:t}}static mergeInputs(e,t){p.mergeInputsArrPart(e,t),p.mergeInputsObjPart(e,t)}static mergeInputsArrPart(e,t){var i=p.splitInputs(t);for(var s in i.arr){var r=p.findInputKeyById(e,i.arr[s].id);r?TradingView.merge(e[r],i.arr[s]):p.appendInputInfoToArr(e,i.arr[s])}}static mergeInputsObjPart(e,t){var i=p.splitInputs(t);TradingView.merge(e,i.obj)}static appendInputInfoToArr(e,t){var i=-1;for(var s in e){var r=parseInt(s,10);isNumber(r)&&(r>i&&(i=r))}e[i+1]=t}static splitInputs(e){var t={},i={};for(var s in e)isNumber(parseInt(s,10))?t[s]=e[s]:i[s]=e[s];return{arr:t,obj:i}}static findInputKeyById(e,t){var i=null;for(var s in e)if(isNumber(parseInt(s,10))&&e[s].id===t){i=s;break}return i}static getInputKeyById(e,t){var i=p.findInputKeyById(e,t);if(!i)throw new Error("Cannot find input with id: "+t);return i}}},694568:(e,t,i)=>{"use strict";i.d(t,{translateSessionDescription:()=>n,translateSessionShortDescription:()=>a});var s=i(509806);const r=new Map([["Premarket",s.t(null,{context:"sessions"},i(156935))],["Postmarket",s.t(null,{context:"sessions"},i(798801))],["Regular Trading Hours",s.t(null,{context:"sessions"},i(824380))],["Extended Trading Hours",s.t(null,{context:"sessions"},i(897442))],["Electronic Trading Hours",s.t(null,{context:"sessions"},i(475610))]]);function n(e){var t;return null!==(t=r.get(e))&&void 0!==t?t:e}const o=new Map([["Premarket",s.t(null,{context:"sessions"},i(556137))],["Postmarket",s.t(null,{context:"sessions"},i(332929))],["Regular Trading Hours",s.t(null,{context:"sessions"},i(663798))],["Extended Trading Hours",s.t(null,{context:"sessions"},i(333021))],["Electronic Trading Hours",s.t(null,{context:"sessions"},i(333021))]]);function a(e){var t;return null!==(t=o.get(e))&&void 0!==t?t:e}},565601:(e,t,i)=>{"use strict";i.d(t,{areEqualSymbols:()=>o,symbolSameAsCurrent:()=>l,unitsAreSame:()=>c,currenciesAreSame:()=>h});var s=i(484727),r=i(632054);const n=s.enabled("uppercase_instrument_names");function o(e,t){return void 0===e?void 0===t:void 0!==t&&(n?e.toUpperCase()===t.toUpperCase():e===t)}function a(e,t){return e.some((e=>o(t,e)))}function l(e,t){if(null===t)return!1;if(t){if(o(t.full_name,e)||o(t.pro_name,e))return!0;if(o(t.ticker,e))return!0;if(t.aliases&&a(t.aliases,e))return!0
;if(t.alternatives&&a(t.alternatives,e))return!0;if(0===e.indexOf("FRA:")&&o(t.pro_name,e.replace("FRA:","FWB:")))return!0}return!1}function c(e,t,i){return null===e&&!(0,r.isConvertedToOtherUnit)(t,i)||e===(0,r.symbolUnit)(t,i)}function h(e,t){return null===e&&!(0,r.isConvertedToOtherCurrency)(t)||e===(0,r.symbolCurrency)(t)}},256776:(e,t,i)=>{"use strict";i.d(t,{TextWidthCache:()=>s});class s{constructor(e=150){this._actualSize=0,this._usageTick=1,this._oldestTick=1,this._tick2Labels=new Map,this._cache=new Map,this._maxSize=e}reset(){this._actualSize=0,this._cache.clear(),this._usageTick=1,this._oldestTick=1,this._tick2Labels.clear()}measureText(e,t){return this.getMetrics(e,t).width}yMidCorrection(e,t){const i=this.getMetrics(e,t);return"actualBoundingBoxAscent"in i&&"actualBoundingBoxDescent"in i?(i.actualBoundingBoxAscent-i.actualBoundingBoxDescent)/2:0}getMetrics(e,t){const i=this._cache.get(t);if(void 0!==i)return i.metrics;if(this._actualSize===this._maxSize){const e=this._tick2Labels.get(this._oldestTick);this._tick2Labels.delete(this._oldestTick),this._cache.delete(e),this._oldestTick++,this._actualSize--}e.save(),e.textBaseline="middle";const s=e.measureText(t);return e.restore(),0===s.width&&t.length||(this._cache.set(t,{metrics:s,tick:this._usageTick}),this._tick2Labels.set(this._usageTick,t),this._actualSize++,this._usageTick++),s}}},576213:(e,t,i)=>{"use strict";var s=i(922157);function r(){this._marksByIndex=new Map,this._marksBySpan=[],this.changed=new s,this.minIndex=void 0,this.maxIndex=void 0}r.prototype.reset=function(){this._resetImpl(),this.changed.fire()},r.prototype._resetImpl=function(){this._marksByIndex=new Map,this._marksBySpan=[],this.minIndex=void 0,this.maxIndex=void 0,this._cache=void 0},r.prototype.merge=function(e){if(0!==e.length){var t=e[0].index,i=e[e.length-1].index;t<=this.minIndex&&i>=this.maxIndex&&this._resetImpl();for(var s=this._marksBySpan,r=new Set,n=0;n<e.length;n++){var o=(c=e[n]).index,a=c.span,l=this._marksByIndex.get(c.index);if(l){if(l.index===c.index&&l.span===c.span){l.time=c.time;continue}this._removeTickmark(l)}}for(n=0;n<e.length;n++){var c;o=(c=e[n]).index,a=c.span;if(!this._marksByIndex.has(c.index)){this._marksByIndex.set(o,c);var h=s[a];void 0===h&&(h=[],s[a]=h);var d=0===h.length||h[h.length-1].index<c.index;s[a].push(c),d||r.add(a)}}this.minIndex=void 0===this.minIndex?t:Math.min(this.minIndex,t),this.maxIndex=void 0===this.maxIndex?i:Math.max(this.maxIndex,i);for(a=s.length;a--;)s[a]&&(s[a].length||delete s[a],r.has(a)&&s[a].sort(this._sortByIndexAsc));this._cache=void 0,this.changed.fire()}},r.prototype._removeTickmark=function(e){var t=e.index;if(this._marksByIndex.get(t)===e){this._marksByIndex.delete(t),t<=this.minIndex&&this.minIndex++,t>=this.maxIndex&&this.maxIndex--,this.maxIndex<this.minIndex&&(this.minIndex=void 0,this.maxIndex=void 0);var i=this._marksBySpan[e.span],s=i.indexOf(e);-1!==s&&i.splice(s,1)}},r.prototype._sortByIndexAsc=function(e,t){return e.index-t.index},r.prototype.removeTail=function(e){var t=new Map
;this.maxIndex=this.minIndex,this._marksByIndex.forEach(function(i,s){i.time<e&&(t.set(s,i),this.maxIndex=Math.max(this.maxIndex,s))}.bind(this)),this._marksByIndex=t},r.prototype.addTail=function(e){for(var t=0;t<e.length;t++)e[t].index=this.maxIndex+t+1;this.merge(e)},r.prototype.indexToTime=function(e){var t=this._marksByIndex.get(e);return t?new Date(1e3*t.time):null},r.prototype.density=function(){var e=this.maxIndex-this.minIndex;if(0!==e)return 1e3*(this._marksByIndex.get(this.maxIndex).time-this._marksByIndex.get(this.minIndex).time)/e},r.prototype.estimateLeft=function(e){var t=this.density();if(t)return(1e3*this._marksByIndex.get(this.minIndex).time-e)/t},r.prototype.nearestIndex=function(e){for(var t=this.minIndex,i=this.maxIndex;i-t>2;){if(1e3*this._marksByIndex.get(t).time===e)return t;if(1e3*this._marksByIndex.get(i).time===e)return i;var s=Math.round((t+i)/2);1e3*this._marksByIndex.get(s).time>e?i=s:t=s}return t},r.prototype.build=function(e,t){var i=Math.ceil(t/e);if(this._maxbar===i&&this._cache)return this._cache;this._maxbar=i;for(var s=[],r=this._marksBySpan.length;r--;)if(this._marksBySpan[r]){var n=s;s=[];for(var o=n.length,a=0,l=this._marksBySpan[r],c=l.length,h=1/0,d=-1/0,u=0;u<c;u++){for(var p=l[u],_=p.index;a<o;){var m=n[a],g=m.index;if(!(g<_)){h=g;break}a++,s.push(m),d=g,h=1/0}h-_>=i&&_-d>=i&&(s.push(p),d=_)}for(;a<o;a++)s.push(n[a])}return this._cache=s,this._cache},r.prototype.state=function(e){for(var t=[],i=this._marksBySpan.length;i--;)this._marksBySpan[i]&&(t=t.concat(this._marksBySpan[i]));if(null!==e){const i=e.firstBar(),s=e.lastBar();t=t.filter((e=>e.index>=i&&e.index<=s))}return{marks:t=t.map((function(e){return[e.span,e.time,e.index]})),version:2}},r.prototype.restoreState=function(e){if(this._marksByIndex=new Map,this._marksBySpan=[],this.maxIndex=void 0,this.minIndex=void 0,e&&e.marks&&e.marks.length)if(2===e.version){var t=e.marks.map((function(e){return{span:e[0],time:e[1],index:e[2]}}));this.merge(t)}else this.merge(e.marks)},e.exports.Tickmarks=r},51545:(e,t,i)=>{"use strict";i.d(t,{TimeAxisView:()=>o});var s=i(602564),r=i(289763);class n{constructor(){this._data=null}setData(e){this._data=e}draw(e,t,i){if(null===this._data||!this._data.visible||0===this._data.text.length)return;const s=this._data;e.font=t.font;const n=Math.round(t.widthCache.measureText(e,s.text));if(n<=0)return;e.save();const o=t.paddingHorizontal,a=n+2*o,l=a/2;let c=s.coordinate,h=Math.floor(c-l)+.5;if(s.alwaysInViewPort){const e=s.width;h<0?(c+=Math.abs(0-h),h=Math.floor(c-l)+.5):h+a>e&&(c-=Math.abs(e-(h+a)),h=Math.floor(c-l)+.5)}const d=h+a,u=Math.ceil(0+t.borderSize+t.offsetSize+t.paddingTop+t.fontSize+t.paddingBottom);e.fillStyle=s.background;const p=Math.round(h*i),_=Math.round(0*i),m=Math.round(d*i),g=Math.round(u*i),f=Math.round(2*i);e.beginPath(),e.moveTo(p,_),e.lineTo(p,g-f),e.arcTo(p,g,p+f,g,f),e.lineTo(m-f,g),e.arcTo(m,g,m,g-f,f),e.lineTo(m,_),e.fill();const v=0+t.borderSize+t.offsetSize+t.paddingTop+t.fontSize/2;e.textAlign="left",e.textBaseline="middle",e.fillStyle=s.color
;const S=t.widthCache.yMidCorrection(e,"Apr0");e.translate((h+o)*i,(v+S)*i),(0,r.drawScaled)(e,i,(()=>e.fillText(s.text,0,0))),e.restore()}}class o{constructor(e){this._renderer=new n,this._rendererData={background:"",color:"",coordinate:0,text:"",visible:!1,width:0,alwaysInViewPort:!0},this._invalidated=!0,this._model=e,this._renderer.setData(this._rendererData)}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}coordinate(){return this._rendererData.coordinate}_getAlwaysInViewPort(){return!0}_getText(e){const t=this._model.timeScale().indexToUserTime(e);return null!==t?this._model.dateTimeFormatter().format(t):""}_updateImpl(){const e=this._rendererData;if(e.visible=!1,this._model.timeScale().isEmpty()||!this._isVisible())return;const t=this._getIndex();null!==t&&(e.visible=!0,e.width=this._model.timeScale().width(),e.background=this._getBgColor(),e.color=(0,s.colorFromBackground)(e.background),e.coordinate=this._model.timeScale().indexToCoordinate(t),e.alwaysInViewPort=this._getAlwaysInViewPort(),e.text=this._getText(t),this._invalidated=!1)}}},724912:(e,t,i)=>{"use strict";i.d(t,{INVALID_TIME_POINT_INDEX:()=>s,UNPLOTTABLE_TIME_POINT_INDEX:()=>r});const s=-2e6,r=-1e6},997753:(e,t,i)=>{"use strict";i.d(t,{timeHoursFormatProperty:()=>a,restoreTimeHoursFormatSettingsValue:()=>l});var s=i(870122),r=i(149926);const n="time_hours_format";function o(){return s.getValue(n,"24-hours")}const a=(0,r.createPrimitiveProperty)(o());function l(){a.setValue("24-hours"),s.remove(n)}s.onSync.subscribe(null,(()=>a.setValue(o()))),a.subscribe(null,(()=>s.setValue(n,a.value())))},451144:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MINUTE_SPAN:()=>s,HOUR_SPAN:()=>r,DAY_SPAN:()=>n,WEEK_SPAN:()=>o,MONTH_SPAN:()=>a,YEAR_SPAN:()=>l,DEFAULT_BAR_SPACING:()=>c});const s=20,r=30,n=40,o=50,a=60,l=70,c=6},217203:(e,t,i)=>{"use strict";i.d(t,{getHourMinuteFormat:()=>r,getHourMinuteSecondFormat:()=>n,getTimeFormatForInterval:()=>o});var s=i(951327);function r(e){return"12-hours"===e?s.twelveHourMinuteFormat:s.hourMinuteFormat}function n(e){return"12-hours"===e?s.twelveHourMinuteSecondFormat:s.hourMinuteSecondFormat}function o(e,t){return e.isSeconds()||e.isTicks()?n(t):r(t)}},873402:(e,t,i)=>{"use strict";i.d(t,{trackDrawingCreated:()=>r,trackDrawingPasted:()=>n,trackDrawingCloned:()=>o,trackChartStyleChanged:()=>a});i(650151),i(667342);function s(e,t){0}function r(e){s()}function n(e){s()}function o(e){s()}function a(e){0}},54031:(e,t,i)=>{"use strict";i.d(t,{translatedIntervalString:()=>r});var s=i(382213);function r(e){const t=(0,s.getTranslatedResolutionModel)(e,!0);return null===t?e:t.multiplier+(t.mayOmitShortKind?"":t.shortKind)}},706028:(e,t,i)=>{"use strict";i.d(t,{ApplyLineToolTemplateUndoCommand:()=>r});var s=i(144070);class r extends s.UndoCommand{constructor(e,t,i){super(i),this._source=e,this._newState=t,this._oldState=e.properties().state()}redo(){this._source.applyTemplate(this._newState)}undo(){this._source.applyTemplate(this._oldState)}}},959709:(e,t,i)=>{
"use strict";i.d(t,{ExcludeLineToolsFromGroupUndoCommand:()=>l});var s=i(650151),r=(i(603605),i(509806)),n=i(440097),o=i(144070);const a=new n.TranslatedString("exclude line tools from group {group}",r.t(null,void 0,i(363391)));class l extends o.UndoCommand{constructor(e,t,i){super(a.format({group:t.name()})),this._model=e,this._groupId=t.id,this._groupName=t.name(),this._lineToolsIds=i.map((e=>e.id()))}redo(){const e=(0,s.ensureNotNull)(this._model.lineToolsGroupModel().groupForId(this._groupId)),t=this._lineToolsIds.map((e=>this._model.dataSourceForId(e)));e.excludeLineTools(t),0===e.lineTools().length&&this._model.lineToolsGroupModel().removeGroup(e)}undo(){const e=this._lineToolsIds.map((e=>this._model.dataSourceForId(e))),t=this._model.lineToolsGroupModel().groupForId(this._groupId);null!==t?t.addLineTools(e):this._model.lineToolsGroupModel().createGroup(e,this._groupName,this._groupId)}}},214474:(e,t,i)=>{"use strict";i.d(t,{MergeUpUndoCommand:()=>o,MergeDownUndoCommand:()=>a,MergeToTargetPane:()=>l});var s=i(650151),r=i(893044);class n extends r.MoveSourceUndoCommand{constructor(e,t,i,s){super(e,t,i),this._restorePane=!1,this._keepZOrder=null!=s&&s}redo(){const e=this._chartModel.panes().length,t=this._chartModel.panes()[this._targetPaneIndex()],i=(0,s.ensureNotNull)(this._chartModel.dataSourceForId(this._sourceId)),r=(0,s.ensureNotNull)(this._chartModel.paneForSource(i)),n=this._chartModel.children(i,!0);r.bulkActionMacro((()=>{n.forEach((e=>this._chartModel.detachSource(e))),this._restorePane=this._chartModel.detachSource(i)}));const o="overlay"===this._initialPriceScalePosition?this._initialPriceScalePosition:void 0,a=t.findSuitableScale(i,void 0,o),l=0===a.dataSources().length;if(t.bulkActionMacro((()=>{t.addDataSource(i,a,this._keepZOrder),n.forEach((e=>t.addDataSource(e,a,this._keepZOrder)))})),i===this._chartModel.mainSeries()){const e=t.priceScalePosition(a);t.movePriceScale(a,e,0)}if(l){(0,s.ensureNotNull)(i.priceScale()).restoreState(this._newPriceScaleState(t.isOverlay(i)))}this._chartModel.fullUpdate(),e!==this._chartModel.panes().length&&this._chartModel.setShouldBeSavedEvenIfHidden(!0)}undo(){let e;e=this._restorePane?this._chartModel.createPane(this._initialPaneIndex):this._chartModel.panes()[this._initialPaneIndex];const t=(0,s.ensureNotNull)(this._chartModel.dataSourceForId(this._sourceId)),i=(0,s.ensureNotNull)(this._chartModel.paneForSource(t)),r=this._chartModel.children(t,!0);i.bulkActionMacro((()=>{r.forEach((e=>this._chartModel.detachSource(e))),this._chartModel.detachSource(t)}));let n=e.getPriceScaleById(this._initialPriceScaleId);null===n&&(n=e.createPriceScaleAtPosition(this._initialPriceScalePosition,this._initialPriceScaleIndex)),e.bulkActionMacro((()=>{e.addDataSource(t,n,!0),r.forEach((t=>e.addDataSource(t,n,!1)))})),(0,s.ensureNotNull)(t.priceScale()).restoreState(this._originalPriceScaleState()),this._chartModel.fullUpdate()}}class o extends n{constructor(e,t,i){super(e,t,i)}_targetPaneIndex(){return this._initialPaneIndex-1}}class a extends n{constructor(e,t,i){super(e,t,i)}
_targetPaneIndex(){return this._initialPaneIndex+1}}class l extends n{constructor(e,t,i,s,r){super(e,t,s,r),this._targetPane=i}_targetPaneIndex(){return this._targetPane}}},893044:(e,t,i)=>{"use strict";i.d(t,{MoveSourceUndoCommand:()=>n});var s=i(650151),r=i(144070);class n extends r.UndoCommand{constructor(e,t,i){super(i),this._chartModel=e,this._sourceId=t.id();const r=(0,s.ensureNotNull)(t.priceScale());this._initialPriceScaleId=r.id(),this._initialPriceScaleState=(0,s.ensureNotNull)(t.priceScale()).state();const n=(0,s.ensureNotNull)(e.paneForSource(t));this._initialPriceScalePosition=n.priceScalePosition(r),this._initialPriceScaleIndex=n.priceScaleIndex(r,this._initialPriceScalePosition),this._initialPaneIndex=e.panes().indexOf(n)}_newPriceScaleState(e){const t={...this._initialPriceScaleState};return delete t.m_isLockScale,delete t.id,delete t.m_topMargin,delete t.m_bottomMargin,t}_originalPriceScaleState(){return this._initialPriceScaleState}}},705145:(e,t,i)=>{"use strict";i.d(t,{MoveToNewPriceScaleUndoCommand:()=>o,MoveToExistingPriceScaleUndoCommand:()=>a});var s=i(650151),r=i(893044);class n extends r.MoveSourceUndoCommand{constructor(e,t,i,s){super(e,t,s),this._sourcePaneRemoved=!1,this._targetPaneIndex=e.panes().indexOf(i)}redo(){const e=this._chartModel.panes()[this._initialPaneIndex],t=this._chartModel.panes()[this._targetPaneIndex],i=e!==t,r=this._targetPriceScale(t),n=(0,s.ensureNotNull)(this._chartModel.dataSourceForId(this._sourceId)),o=this._chartModel.children(n,!0);for(const e of o)i?(this._chartModel.detachSource(e),t.addDataSource(e,r,!1)):t.move(e,r);i?(this._sourcePaneRemoved=this._chartModel.detachSource(n),t.addDataSource(n,r,!1)):t.move(n,r);const a=t.priceScalePosition(r);t.movePriceScale(r,a,this._targetPriceScaleIndex(n)),this._chartModel.fullUpdate()}undo(){this._sourcePaneRemoved&&this._chartModel.createPane(this._initialPaneIndex);const e=this._chartModel.panes()[this._initialPaneIndex],t=e!==this._chartModel.panes()[this._targetPaneIndex],i=(0,s.ensureNotNull)(this._chartModel.dataSourceForId(this._sourceId));let r=e.getPriceScaleById(this._initialPriceScaleId);null===r&&(r=e.createPriceScaleAtPosition(this._initialPriceScalePosition,this._initialPriceScaleIndex));const n=this._chartModel.children(i,!0);for(const i of n)t?(this._chartModel.detachSource(i),e.addDataSource(i,r,!1)):e.move(i,r);t?(this._chartModel.detachSource(i),e.addDataSource(i,r,!1)):e.move(i,r),(0,s.ensureNotNull)(i.priceScale()).restoreState(this._originalPriceScaleState()),this._chartModel.fullUpdate()}}class o extends n{constructor(e,t,i,s,r){super(e,t,i,r),this._targetPriceScalePosition=s}_targetPriceScale(e){const t=e.createPriceScaleAtPosition(this._targetPriceScalePosition);return t.restoreState(this._newPriceScaleState("overlay"===this._targetPriceScalePosition)),t}_targetPriceScaleIndex(e){return e===this._chartModel.mainSeries()?0:void 0}}class a extends n{constructor(e,t,i,s,r){super(e,t,i,r),this._targetPriceScaleId=s.id()}_targetPriceScale(e){return(0,
s.ensureNotNull)(e.getPriceScaleById(this._targetPriceScaleId))}_targetPriceScaleIndex(e){}}},340116:(e,t,i)=>{"use strict";i.d(t,{PriceScaleChangeUndoCommand:()=>h});var s=i(650151),r=i(509806),n=i(440097),o=i(817808),a=i(144070);const l=(0,o.getLogger)("Chart.ChartUndoModel"),c=new n.TranslatedString("scale price",r.t(null,void 0,i(347222)));class h extends a.UndoCommand{constructor(e,t,i,s,r){super(c,!1),this._newPriceScaleState=null,this._model=e,this._paneIndex=e.panes().indexOf(t),this._priceScaleId=i.id(),this._state=s,this._timestamp=r?performance.now():null}undo(){if(null!==this._newPriceScaleState)return void l.logDebug("PriceScaleChangeUndoCommand.undo: Command is already undone");const[e,t]=this._paneAndScale();this._newPriceScaleState=t.state(),this._model.restorePriceScaleState(e,t,this._state)}redo(){if(null===this._newPriceScaleState)return void l.logDebug("PriceScaleChangeUndoCommand.redo: Command is not undone");const[e,t]=this._paneAndScale();this._model.restorePriceScaleState(e,t,this._newPriceScaleState),this._newPriceScaleState=null}canMerge(e){return e instanceof h&&null!==this._timestamp&&null!==e._timestamp&&null===this._newPriceScaleState&&e._model===this._model&&e._paneIndex===this._paneIndex&&e._priceScaleId===this._priceScaleId&&Math.abs(e._timestamp-this._timestamp)<1e3}merge(e){this._timestamp=e._timestamp}_paneAndScale(){const e=this._model.panes()[this._paneIndex],t=(0,s.ensureNotNull)(e.getPriceScaleById(this._priceScaleId));return[e,t]}}},319139:(e,t,i)=>{"use strict";i.d(t,{RemoveSourcesCommand:()=>m});var s=i(650151),r=i(509806),n=i(440097),o=i(144070),a=i(232468),l=i(817808),c=i(495736),h=i(663890),d=i(959709);class u extends o.UndoCommand{constructor({title:e,chartModel:t,lineDataSourceIds:i}){super(e),this._excludeLineToolsFromGroupUndoCommands=[],this._undoState=[],this._chartModel=t,this._lineDataSourceIds=i}redo(){const e=this._lineDataSourceIds.map((e=>(0,s.ensureNotNull)(this._chartModel.dataSourceForId(e))));this._groupLineToolsByGroups(e).forEach(((e,t)=>{const i=new d.ExcludeLineToolsFromGroupUndoCommand(this._chartModel,t,e);i.redo(),this._excludeLineToolsFromGroupUndoCommands.push(i)})),e.forEach((e=>{this._undoState.push({state:e.state(!1),paneIndex:this._chartModel.panes().indexOf((0,s.ensureNotNull)(this._chartModel.paneForSource(e))),sharingMode:e.sharingMode().value()}),this._chartModel.removeSource(e)}))}undo(){var e;for(let t=this._undoState.shift();t;t=this._undoState.shift())null===(e=this._chartModel.restoreSource(!1,t.paneIndex,null,t.state,null))||void 0===e||e.share(t.sharingMode);this._excludeLineToolsFromGroupUndoCommands.forEach((e=>e.undo()))}_groupLineToolsByGroups(e){const t=this._chartModel.lineToolsGroupModel();return e.reduce(((e,i)=>{const s=t.groupForLineTool(i);if(null!==s){const t=e.get(s)||[];t.push(i),e.set(s,t)}return e}),new Map)}}const p=(0,l.getLogger)("Chart.RemoveSourcesCommand"),_=new n.TranslatedString("remove line data sources",r.t(null,void 0,i(66414)));class m extends o.UndoCommand{constructor(e,t,i){super(i),
this._removeLineDataSourcesUndoCommand=null,this._initialPriceScaleMode=null;const[r,n]=(0,c.closeSourcesSet)(e,t).reduce(((e,t)=>((0,a.isLineTool)(t)?e[1].push(t.id()):e[0].push(t.id()),e)),[[],[]]);this._chartModel=e,this._sourceIds=r,this._lineDataSourceIds=n,this._sourceStates=[],this._paneIndexes=[],this._priceScalePositionIds=[],this._paneStates=[],this._restorePanes=[];const o=t[0];1===t.length&&(0,h.isStudy)(o)&&(this._initialPriceScaleMode=(0,s.ensureNotNull)(o.priceScale()).mode())}removedIds(){return[...this._sourceIds,...this._lineDataSourceIds]}redo(){this._chartModel.panes().length;const e=this._sourceIds.map((e=>(0,s.ensureNotNull)(this._chartModel.dataSourceForId(e))));this._sourceStates=e.map((e=>(0,s.ensureNotNull)(e.state(!1))));const t=e.map((e=>(0,s.ensureNotNull)(this._chartModel.paneForSource(e))));this._paneIndexes=t.map((e=>this._chartModel.panes().indexOf(e))),this._lineDataSourceIds.length>0&&(this._removeLineDataSourcesUndoCommand=new u({title:_,chartModel:this._chartModel,lineDataSourceIds:this._lineDataSourceIds}),this._removeLineDataSourcesUndoCommand.redo()),this._priceScalePositionIds=e.map(((e,i)=>{const s=e.priceScale();if(null===s)return null;const r=t[i].priceScalePosition(s);return{id:s.id(),position:r,priceScaleIndex:t[i].priceScaleIndex(s,r)}}));const i=new Set;e.forEach(((e,t)=>{i.add(this._paneIndexes[t])})),this._paneStates=e.map(((e,s)=>{const r=this._paneIndexes[s];return i.has(r)?t[s].state(!1,!0):null})),this._restorePanes=e.map((e=>this._chartModel.removeSource(e)))}undo(){const e=[];for(let t=this._sourceStates.length-1;t>=0;t--){const i=this._chartModel.restoreSource(this._restorePanes[t],this._paneIndexes[t],this._paneStates[t],this._sourceStates[t],this._priceScalePositionIds[t]);i&&e.push(i)}e.some(((t,i)=>t.id()!==this._sourceIds[e.length-i-1]))&&p.logError("Source was restored improperly - source ids does not match"),null!==this._initialPriceScaleMode&&(0,s.ensureNotNull)(e[0].priceScale()).setMode(this._initialPriceScaleMode),this._removeLineDataSourcesUndoCommand&&this._removeLineDataSourcesUndoCommand.undo()}}},210914:(e,t,i)=>{"use strict";i.d(t,{RestoreDefaultsPreferencesUndoCommand:()=>m});var s=i(650151),r=i(509806),n=i(440097),o=i(144070),a=i(392987),l=i(599015),c=i(997753),h=i(857192),d=i(588535),u=i(140641),p=i(831809);const _=new n.TranslatedString("apply all chart properties",r.t(null,void 0,i(64034)));class m extends o.UndoCommand{constructor(e){super(_),this._trading=null,this._oldShowSellBuyButtons=null,this._oldNoConfirmEnabled=null,this._oldShowOnlyRejectionNotifications=null,this._oldShowPricesWithZeroVolume=null,this._oldShowPricesWithSpread=null,this._oldOrderExecutedSoundEnabled=null,this._prevWatermarkPreferences=null,this._model=e,this._trading=(0,u.tradingService)(),null!==this._trading&&(this._oldShowSellBuyButtons=this._trading.showSellBuyButtons.value(),this._oldNoConfirmEnabled=this._trading.noConfirmEnabled.value(),this._oldShowOnlyRejectionNotifications=this._trading.showOnlyRejectionNotifications.value(),
this._oldShowPricesWithZeroVolume=this._trading.showPricesWith().zeroVolume.value(),this._oldShowPricesWithSpread=this._trading.showPricesWith().spread.value(),this._oldOrderExecutedSoundEnabled=this._trading.orderExecutedSoundParams.enabled.value()),this._defaultsPreferences=(0,a.defaultsPreferencesByWhiteList)(this._model,this._model.mainSeries()),this._oldPreferences=e.preferences(),this._prevDateFormat=l.dateFormatProperty.value(),this._prevTimeHoursFormat=c.timeHoursFormatProperty.value(),this._prevAddPlusButton=p.addPlusButtonProperty.value(),this._prevShowOpenMarkerStatus=h.showMarketOpenStatusProperty.value(),this._prevCurrencyUnitVisibility=(0,d.currencyUnitVisibilityProperty)().value();const t=this._model.watermarkSource();null!==t&&(this._prevWatermarkPreferences=t.properties().state())}redo(){null!==this._trading&&(this._trading.showSellBuyButtons.setValue(!0),this._trading.noConfirmEnabled.setValue(!1),this._trading.showOnlyRejectionNotifications.setValue(!1),this._trading.showPricesWith().zeroVolume.setValue(!0),this._trading.showPricesWith().spread.setValue(!0),this._trading.orderExecutedSoundParams.enabled.setValue(!1)),this._model.applyPreferences(this._defaultsPreferences),this._model.updateScales(),(0,l.restoreDateFormatSettingsValue)(),(0,c.restoreTimeHoursFormatSettingsValue)(),(0,p.restoreAddPlusButtonSettingsValue)(),(0,h.restoreShowMarketOpenStatusProperty)(),(0,d.restoreCurrencyUnitVisibilitySettingsValue)();const e=this._model.watermarkSource();null!==e&&e.restorePropertiesDefaults()}undo(){null!==this._trading&&(this._trading.showSellBuyButtons.setValue((0,s.ensureNotNull)(this._oldShowSellBuyButtons)),this._trading.noConfirmEnabled.setValue((0,s.ensureNotNull)(this._oldNoConfirmEnabled)),this._trading.showOnlyRejectionNotifications.setValue((0,s.ensureNotNull)(this._oldShowOnlyRejectionNotifications)),this._trading.showPricesWith().zeroVolume.setValue((0,s.ensureNotNull)(this._oldShowPricesWithZeroVolume)),this._trading.showPricesWith().spread.setValue((0,s.ensureNotNull)(this._oldShowPricesWithSpread)),this._trading.orderExecutedSoundParams.enabled.setValue((0,s.ensureNotNull)(this._oldOrderExecutedSoundEnabled))),this._model.applyPreferences(this._oldPreferences),this._model.updateScales(),l.dateFormatProperty.setValue(this._prevDateFormat),c.timeHoursFormatProperty.setValue(this._prevTimeHoursFormat),h.showMarketOpenStatusProperty.setValue(this._prevShowOpenMarkerStatus),p.addPlusButtonProperty.setValue(this._prevAddPlusButton),(0,d.currencyUnitVisibilityProperty)().setValue(this._prevCurrencyUnitVisibility);const e=this._model.watermarkSource();null!==e&&null!==this._prevWatermarkPreferences&&e.properties().mergeAndFire(this._prevWatermarkPreferences)}}},431491:(e,t,i)=>{"use strict";i.d(t,{SetPriceScaleCurrencyUndoCommand:()=>o});var s=i(650151),r=i(144070),n=i(632054);class o extends r.UndoCommand{constructor(e,t,i,r){super(r),this._newSourcesCurrencies=new Map,this._oldSourcesCurrencies=new Map,this._showFade=!1,this._chartWidget=i;const o=i.model().mainSeries()
;for(const i of e.seriesLikeSources()){if(!i.isVisible()||!i.isActingAsSymbolSource().value())continue;const e=t||(0,n.symbolOriginalCurrency)((0,s.ensureNotNull)(i.symbolInfo()));this._newSourcesCurrencies.set(i.id(),e),this._oldSourcesCurrencies.set(i.id(),i.currency()),this._showFade=this._showFade||i===o&&i.currency()!==e}}redo(){this._applyCurrencies(this._newSourcesCurrencies)}undo(){this._applyCurrencies(this._oldSourcesCurrencies)}_applyCurrencies(e){const t=this._chartWidget.model().model();e.forEach(((e,i)=>{(0,s.ensureNotNull)(t.dataSourceForId(i)).setCurrency(e)})),this._chartWidget.model().selectionMacro((e=>{e.clearSelection()})),this._showFade&&this._chartWidget.screen.show(!0)}}},974350:(e,t,i)=>{"use strict";i.d(t,{SetPriceScaleModeCommand:()=>o});var s=i(508547),r=i(144070),n=i(744687);class o extends r.UndoCommand{constructor(e,t,i,s){super(i),this._newMode=e,this._priceScaleId=t.id(),this._model=s,this._oldMode=t.mode()}redo(){this._applyMode(this._newMode)}undo(){this._applyMode(this._oldMode)}_applyMode(e){const t=this._findPriceScaleById();null!==t&&((0,s.saveDefaultProperties)(!0),t.setMode(e),(0,s.saveDefaultProperties)(!1),this._model&&(this._model.recalculateAllPanes((0,n.viewportChangeEvent)()),this._model.lightUpdate()))}_findPriceScaleById(){const e=this._model.panes();for(let t=0;t<e.length;t++){const i=e[t].getPriceScaleById(this._priceScaleId);if(null!==i)return i}return null}}},264368:(e,t,i)=>{"use strict";i.d(t,{SetPriceScaleSelectionStrategyCommand:()=>a});var s=i(650151),r=i(144070),n=i(618851);class o{constructor(e){this._leftScales=e.leftPriceScales().map((e=>e.id())),this._rightScales=e.rightPriceScales().map((e=>e.id()))}restorePane(e){this._leftScales.reverse().map((t=>(0,s.ensureNotNull)(e.getPriceScaleById(t)))).forEach((t=>e.movePriceScale(t,"left"))),this._rightScales.reverse().map((t=>(0,s.ensureNotNull)(e.getPriceScaleById(t)))).forEach((t=>e.movePriceScale(t,"right")))}}class a extends r.UndoCommand{constructor(e,t,i){super(i),this._chartModel=e,this._targetStrategy=(0,n.createPriceScaleSelectionStrategy)(t),this._initialState=e.panes().map((e=>new o(e)))}redo(){this._chartModel.panes().forEach((e=>e.setPriceScaleSelectionStrategy(this._targetStrategy))),this._chartModel.fullUpdate()}undo(){const e=this._chartModel.panes();for(let t=0;t<e.length;t++)this._initialState[t].restorePane(e[t]);this._chartModel.fullUpdate()}}},437334:(e,t,i)=>{"use strict";i.d(t,{SetPriceScaleUnitUndoCommand:()=>o});var s=i(650151),r=i(144070),n=i(632054);class o extends r.UndoCommand{constructor(e,t,i,r){super(r),this._newSourcesUnits=new Map,this._oldSourcesUnits=new Map,this._showFade=!1,this._chartWidget=i;const o=i.model().mainSeries();for(const i of e.seriesLikeSources()){if(!i.isVisible()||!i.isActingAsSymbolSource().value())continue;const e=t||(0,n.symbolOriginalUnit)((0,s.ensureNotNull)(i.symbolInfo()),this._chartWidget.model().model().unitConversionEnabled());this._newSourcesUnits.set(i.id(),e),this._oldSourcesUnits.set(i.id(),i.unit()),
this._showFade=this._showFade||i===o&&i.unit()!==e}}redo(){this._applyUnits(this._newSourcesUnits)}undo(){this._applyUnits(this._oldSourcesUnits)}_applyUnits(e){const t=this._chartWidget.model().model();e.forEach(((e,i)=>{(0,s.ensureNotNull)(t.dataSourceForId(i)).setUnit(e)})),this._chartWidget.model().selectionMacro((e=>{e.clearSelection()})),this._showFade&&this._chartWidget.screen.show(!0)}}},172687:(e,t,i)=>{"use strict";i.d(t,{SetScaleRatioPropertiesCommand:()=>o});var s=i(144070),r=i(508547),n=i(744687);class o extends s.UndoCommand{constructor(e,t,i,s){super(i),this._property=e,this._newValue=t,this._model=s,this._priceScale=this._model.mainSeries().priceScale(),this._oldValue=this._property.value(),this._oldMode=this._priceScale.mode()}redo(){this._oldValue=this._property.value(),this._oldMode=this._priceScale.mode(),(0,r.saveDefaultProperties)(!0),this._priceScale.setMode({autoScale:!1,percentage:!1,log:!1}),this._property.setValue(this._newValue),(0,r.saveDefaultProperties)(!1),this._model.recalculateAllPanes((0,n.viewportChangeEvent)()),this._model.lightUpdate()}undo(){(0,r.saveDefaultProperties)(!0),this._property.setValue(this._oldValue),this._priceScale.setMode(this._oldMode),(0,r.saveDefaultProperties)(!1),this._model.recalculateAllPanes((0,n.viewportChangeEvent)()),this._model.lightUpdate()}}},495736:(e,t,i)=>{"use strict";function s(e,t){let i=[];const r=e.children(t,!1);for(let t=0;t<r.length;t++)i=i.concat(s(e,r[t]));return i.push(t),i}function r(e,t){const i=new Set,r=t=>{e.children(t,!1).forEach((e=>{i.has(e)||(i.add(e),r(e))}))};return t.forEach(r),t.filter((e=>!i.has(e))).map((t=>s(e,t))).reduce(((e,t)=>e.concat(t)),[])}i.d(t,{closeSourcesSet:()=>r})},748454:(e,t,i)=>{"use strict";i.d(t,{SwapChartsUndoCommand:()=>a});var s=i(509806),r=i(440097),n=i(144070);const o=new r.TranslatedString("swap charts in the Layout",s.t(null,void 0,i(665818)));class a extends n.UndoCommand{constructor(e,t,i){super(o),this._swapper=e,this._from=t,this._to=i}redo(){this._swapper(this._from,this._to)}undo(){this._swapper(this._from,this._to)}}},779602:(e,t,i)=>{"use strict";i.d(t,{TimeScaleChangeUndoCommand:()=>o});var s=i(817808),r=i(144070);const n=(0,s.getLogger)("Chart.ChartUndoModel");class o extends r.UndoCommand{constructor(e,t,i){super(i,!1),this._newRightOffsetAndBarSpacing=null,this.setCustomFlag("doesnt_affect_save",!0),this._model=e,this._rightOffsetAndBarSpacing=t}undo(){if(null!==this._newRightOffsetAndBarSpacing)return void n.logDebug("TimeScaleChangeUndoCommand.undo: Command is already undone");const e=this._model.timeScale();this._newRightOffsetAndBarSpacing={barSpacing:e.barSpacing(),rightOffset:e.rightOffset()},e.setBarSpacing(this._rightOffsetAndBarSpacing.barSpacing),e.setRightOffset(this._rightOffsetAndBarSpacing.rightOffset),this._model.lightUpdate()}redo(){if(null===this._newRightOffsetAndBarSpacing)return void n.logDebug("TimeScaleChangeUndoCommand.redo: Command is not undone");const e=this._model.timeScale();e.setBarSpacing(this._newRightOffsetAndBarSpacing.barSpacing),
e.setRightOffset(this._newRightOffsetAndBarSpacing.rightOffset),this._model.lightUpdate(),this._newRightOffsetAndBarSpacing=null}}},144070:(e,t,i)=>{"use strict";i.d(t,{UndoCommand:()=>r});var s=i(440097);class r{constructor(e,t=!0){this._customFlags={},this._text=e||new s.TranslatedString("",""),this._executeOnPush=t}text(){return this._text}executeOnPush(){return this._executeOnPush}customFlag(e){return this._customFlags[e]}setCustomFlag(e,t){this._customFlags[e]=t}canMerge(e){return!1}merge(e){throw new Error("Should be re-implemented in child classes")}}},363030:(e,t,i)=>{"use strict";i.d(t,{createUndoHistory:()=>u});var s=i(650151),r=i(849268),n=i(820958),o=i(144070);class a extends o.UndoCommand{constructor(e,t,i){super(i),this._wv=e,this._newValue=t,this._oldValue=e.value()}redo(){this._wv.setValue(this._newValue)}undo(){this._wv.setValue(this._oldValue)}}var l=i(817808),c=i(922157),h=i.n(c);const d=(0,l.getLogger)("Common.UndoHistory");function u(){const e=[],t=new r.UndoStack,i=new r.UndoStack,o=new(h());function l(s){if(e.length>0)e[e.length-1].addCommand(s);else{i.clear();const e=t.head(),r=e&&e.text().originalText();e&&e.canMerge(s)?e.merge(s):t.push(s);const n=s.text().originalText();""!==n&&n!==r&&d.logNormal("DO: "+n)}s.executeOnPush()&&s.redo(),e.length||o.fire(c())}function c(){const e=t.head(),s=i.head(),r=void 0===e?void 0:e.text(),n=void 0===s?void 0:s.text();return{enableUndo:!t.isEmpty(),undoText:void 0!==r?r.translatedText():r,enableRedo:!i.isEmpty(),redoText:void 0!==n?n.translatedText():n,originalUndoText:void 0!==r?r.originalText():void 0,originalRedoText:void 0!==n?n.originalText():void 0}}return{beginUndoMacro:function(t){const i=new n.UndoMacroCommand(t);return e.push(i),i},clearStack:function(){t.clear(),i.clear(),o.fire(c())},createUndoCheckpoint:function(){return{lastActualCommand:t.isEmpty()?null:t.head()}},endUndoMacro:function(){const t=(0,s.ensureDefined)(e.pop());t.isEmpty()||l(t)},pushUndoCommand:l,redo:function(){if(i.isEmpty())return!1;const e=i.pop();return!!e&&(e.redo(),t.push(e),d.logNormal("REDO: "+e.text().originalText()),o.fire(c()),!0)},redoStack:function(){return i},setWatchedValue:function(e,t,i,s){if(e.value()!==t){const r=new a(e,t,i);r.setCustomFlag("doesnt_affect_save",!!s),l(r),r.redo()}},undo:function(){if(t.isEmpty())return!1;const e=t.pop();return!!e&&(e.undo(),i.push(e),d.logNormal("UNDO: "+e.text().originalText()),o.fire(c()),!0)},undoStack:function(){return t},undoToCheckpoint:function(e){for(;!t.isEmpty()&&e.lastActualCommand!==t.head();)t.pop().undo();i.clear(),o.fire(c())},state:c,onChange:function(){return o}}}},820958:(e,t,i)=>{"use strict";i.d(t,{UndoMacroCommand:()=>r});var s=i(144070);class r extends s.UndoCommand{constructor(e){super(e,!1),this._subcommands=[]}addCommand(e){this._subcommands.push(e)}isEmpty(){return 0===this._subcommands.length}redo(){for(let e=0;e<this._subcommands.length;e++)this._subcommands[e].redo()}undo(){for(let e=this._subcommands.length-1;e>=0;e--)this._subcommands[e].undo()}commands(){return this._subcommands}}},
849268:(e,t,i)=>{"use strict";i.d(t,{UndoStack:()=>a});var s=i(144070),r=i(922157),n=i.n(r);const o=(0,i(817808).getLogger)("Common.UndoStack");class a{constructor(){this._commands=[],this._onChange=new(n())}onChange(){return this._onChange}isEmpty(){return 0===this._commands.length}clear(){this.isEmpty()||(this._commands.length=0,this._onChange.fire())}push(e){if(!(e instanceof s.UndoCommand))throw new TypeError("argument must be an instance of UndoCommand");this._commands.push(e),this._onChange.fire(e)}pop(){if(this.isEmpty())return void o.logDebug("pop: undo stack is empty");const e=this._commands.pop();return this._onChange.fire(e),e}head(){if(!this.isEmpty())return this._commands[this._commands.length-1]}}},677698:(e,t,i)=>{"use strict";i.d(t,{UnmergeDownUndoCommand:()=>o,UnmergeUpUndoCommand:()=>a,UnmergeToNewBottomPane:()=>l});var s=i(650151),r=i(893044);class n extends r.MoveSourceUndoCommand{constructor(e,t,i){super(e,t,i)}redo(){const e=(0,s.ensureNotNull)(this._chartModel.dataSourceForId(this._sourceId)),t=(0,s.ensureNotNull)(this._chartModel.paneForSource(e)),i=this._chartModel.children(e,!0);t.bulkActionMacro((()=>{i.forEach((e=>this._chartModel.detachSource(e))),this._chartModel.detachSource(e)}));const r=this._chartModel.createPane(this.targetPaneIndex()),n=r.findSuitableScale(e);r.bulkActionMacro((()=>{r.addDataSource(e,n,!1),i.forEach((e=>r.addDataSource(e,n,!1)))})),(0,s.ensureNotNull)(e.priceScale()).restoreState(this._newPriceScaleState(r.isOverlay(e))),this._chartModel.fullUpdate(),this._chartModel.setShouldBeSavedEvenIfHidden(!0)}undo(){const e=(0,s.ensureNotNull)(this._chartModel.dataSourceForId(this._sourceId)),t=(0,s.ensureNotNull)(this._chartModel.paneForSource(e)),i=this._chartModel.children(e,!0);t.bulkActionMacro((()=>{i.forEach((e=>this._chartModel.detachSource(e)));const t=this._chartModel.detachSource(e);(0,s.assert)(t,"Undo of detaching must remove pane")}));const r=this._chartModel.panes()[this._initialPaneIndex];let n=r.getPriceScaleById(this._initialPriceScaleId);null===n&&(n=r.createPriceScaleAtPosition(this._initialPriceScalePosition,this._initialPriceScaleIndex)),r.bulkActionMacro((()=>{r.addDataSource(e,n,!0),i.forEach((e=>r.addDataSource(e,n,!1)))})),(0,s.ensureNotNull)(e.priceScale()).restoreState(this._originalPriceScaleState()),this._chartModel.fullUpdate()}}class o extends n{constructor(e,t,i){super(e,t,i)}targetPaneIndex(){return this._initialPaneIndex+1}}class a extends n{constructor(e,t,i){super(e,t,i)}targetPaneIndex(){return this._initialPaneIndex}}class l extends n{constructor(e,t,i){super(e,t,i)}targetPaneIndex(){return this._chartModel.panes().length}}},478265:(e,t,i)=>{"use strict";i.d(t,{unitConvertibleGroups:()=>n,sourceNewUnitOnPinningToPriceScale:()=>o});var s=i(296055),r=i(632054);function n(e,t,i){const s=(0,r.symbolUnitConvertibleGroupsIfExist)(e,!0);if(null!==s)return s;const n=i.unitGroupById(t);return null===n?[]:[n]}function o(e,t,i,r){let o=null;if(i.unitConversionEnabled()&&(0,s.isSymbolSource)(e)){
const s=i.availableUnits(),a=t.unit(s),l=e.unit(),c=null===l?[]:n(e.symbolInfo(),l,s);null!==a&&null!==a.selectedUnit&&!a.allUnitsAreOriginal&&a.selectedUnit!==l&&(r&&null===l||null!==l&&s.convertible(l,c))&&(o=a.selectedUnit)}return o}},734137:(e,t,i)=>{"use strict";i.d(t,{createVisibilityController:()=>l});var s=i(509806),r=i(972535),n=i(149926),o=i(870122);function a(e){return"alwaysOn"===e||"alwaysOff"===e?e:"visibleOnMouseOver"}function l(e,t){let l,c;function h(){if(!l){l=(0,n.createPrimitiveProperty)();let i=o.getValue(e);void 0===i&&void 0!==t&&(i=o.getValue(t)),l.setValue(a(i)),l.subscribe(l,(t=>{o.setValue(e,a(t.value()))}))}return l}return{property:h,availableValues:function(){return[{id:"visibleOnMouseOver",value:"visibleOnMouseOver",title:s.t(null,void 0,i(689960))},{id:"alwaysOn",value:"alwaysOn",title:s.t(null,void 0,i(471997))},{id:"alwaysOff",value:"alwaysOff",title:s.t(null,void 0,i(109408))}]},actualBehavior:function(){if(!c){c=(0,n.createPrimitiveProperty)();const e=h(),t=()=>{let t=e.value();"alwaysOn"!==t&&"alwaysOff"!==t&&(t=r.mobiletouch?"alwaysOn":"visibleOnMouseOver"),c&&c.setValue(t)};e.subscribe(c,t),t()}return c}}}},839228:(e,t,i)=>{"use strict";i.r(t),i.d(t,{watermarkProperty:()=>h,restoreWatermarkPropertyDefaults:()=>d});var s=i(870122),r=i(976704),n=i.n(r);const o="symbolWatermark",a={visibility:!1,color:"rgba(80, 83, 94, 0.25)"};function l(){const e=s.getJSON(o);return Object.assign({},a,e)}let c=null;function h(){return null===c&&(c=new(n())(l()),s.onSync.subscribe(null,(()=>{null!==c&&c.mergeAndFire(l())})),c.listeners().subscribe(null,(()=>{null!==c&&s.setJSON(o,c.state())}))),c}function d(){null!==c&&c.mergeAndFire(a)}},512666:(e,t,i)=>{"use strict";var s=i(54031).translatedIntervalString,r=i(9136).getTranslatedSymbolDescription,n=i(574570).CHART_FONT_FAMILY,o=i(839228),a=o.watermarkProperty,l=o.restoreWatermarkPropertyDefaults,c=i(289763).drawScaled,h=i(658363).applyDefaultsOverrides,d=i(658363).applyPropertiesOverrides;const u="symbolWatermark";t.Watermark=function(e,t){var i={},o=a();function p(e,t){var s=e.font;return i.hasOwnProperty(s)||(i[s]={}),i[s].hasOwnProperty(t)||(i[s][t]=e.measureText(t).width),i[s][t]}h(o,void 0,!1,u),o.listeners().subscribe(this,(function(){e.updateSource(this)})),this.destroy=function(){o.listeners().unsubscribeAll(this)},this.properties=function(){return o},this.restorePropertiesDefaults=function(){l()},this.applyOverrides=function(e){d(o,void 0,!1,e,u)};var _={renderer:function(e,i){return{draw:function(a,l){c(a,l.pixelRatio,(function(){var l=t.symbolInfo();a.fillStyle=o.color.value();var c,h=l.name;/QUANDL/.test(l.exchange)&&((c=h.split(/\//)).length&&(h=c[c.length-1]));for(var d={description:l.description,short_description:l.short_description,pro_name:l.pro_name,short_name:l.name,local_description:l.local_description,language:l.language},u=[{text:h?h+", "+s(t.interval()):"",font:"96px "+n,lineHeight:117,vertOffset:0},{text:r(d)||"",font:"48px "+n,lineHeight:58,vertOffset:5}],_=0,m=0;m<u.length;m++){if((v=u[m]).text){a.font=v.font
;var g=p(a,v.text);v.zoom=g>i?i/g:1,_+=v.lineHeight*v.zoom}}var f=Math.max((e-_)/2,0);for(m=0;m<u.length;m++){var v;(v=u[m]).text&&(a.save(),a.translate(i/2,f),a.textBaseline="top",a.textAlign="center",a.font=v.font,a.scale(v.zoom,v.zoom),a.fillText(v.text,0,v.vertOffset),a.restore(),f+=v.lineHeight*v.zoom)}}))}}},update:function(){}};this.paneViews=function(){return t.symbolInfo()&&o.visibility.value()?[_]:[]}}},793698:(e,t,i)=>{"use strict";i.d(t,{reorderDataSourcesStateZOrder:()=>S,newLineToolZOrder:()=>w,newStudyZOrder:()=>P,moveAfterSource:()=>k,moveBeforeSource:()=>E});var s=i(232468),r=i(663890),n=i(793713),o=i(879987),a=i(624595);function l(e){return(0,s.isLineTool)(e)&&!e.isSpeciallyZOrderedSource()}function c(e){return(0,r.isStudy)(e)&&!e.isSpeciallyZOrderedSource()}function h(e,t){return e.zorder-t.zorder}function d(e,t){(0,o.isMainSeriesState)(e)?e.zorder=0:e.zorder=t}function u(e,t){e.setZorder(t)}function p(e){return e.zorder()}function _(e){return Math.round(1e3*e)/1e3}function m(e,t){const i=Math.max(e,t),s=Math.min(e,t);return Math.max(0,Math.ceil(i)-Math.floor(s)-1)}function g(e,t,i){let s=0;const r=function(e,t){const i=1e3;return Math.abs(t*i-e*i)/i}(t,e);var n;return r>i?(e=Math.trunc(e),s=Math.floor(r/(i+1))):(n=r/(i+1),s=Math.floor(1e3*n)/1e3),{startZOrder:e,zOrderStep:s}}function f(e,t,i,s){let r=e.length,n=t;for(let t=e.length-1;t>=-1;t--)if(-1===t||s(e[t])){const s=t;let o=T(n);if(r-1===s)s>=0&&i(e[s],o);else{const t=m(r,s);let a=0;for(;0===a;){const e=g(n,o,t);n=e.startZOrder,a=e.zOrderStep,0===a&&(o-=1e4,0===o&&(o-=1e4))}let l=r-1;for(;l>s;){const t=_(n-a);i(e[l],t),n=t,l--}s>=0&&i(e[s],o)}n=o,r=s}}function v(e,t,i,s){let r=-1,n=t;for(let t=0;t<=e.length;t++)if(t===e.length||s(e[t])){const s=t;let o=C(n);if(r+1===s)s<=e.length-1&&i(e[s],o);else{const t=m(r,s);let a=0;for(;0===a;){const e=g(n,o,t);n=e.startZOrder,a=e.zOrderStep,0===a&&(o+=1e4,0===o&&(o+=1e4))}let l=r+1;for(;l<=s-1;){const t=_(n+a);i(e[l],t),n=t,l++}s<=e.length-1&&i(e[s],o)}n=o,r=s}}function S(e){!function(e,t,i,s,r,n){let o=null;const a=[];for(const r of e)t(r)?(a.push(r),o=r):(i(r)||s(r))&&a.push(r);a.sort(n),null!==o&&r(o,0);const l=null===o?-1:a.indexOf(o);-1!==l?(f(a.slice(0,l),0,r,i),v(a.slice(l+1),0,r,i)):v(a,0,r,i)}(e,o.isMainSeriesState,o.isStudyState,o.isLineToolState,d,h)}function y(e,t){const i=Math.floor(e/1e4);let s=t.get(i);return void 0===s&&(s=[],t.set(i,s)),s}function b(e,t,i,s,r,n){let o=-1/0,a=1/0,l=-1/0,c=0;const h=new Map;for(let s=0;s<e.length;++s){const n=e[s],d=r(n);t(n)?(o=Math.max(o,d),y(d,h).push(n)):i(n)&&(d<0&&(a=Math.min(a,d),l=Math.max(l,d)),c=Math.max(c,d))}if(n){const e=Math.max(c,o),t=g(e,C(e),1);return _(t.startZOrder+t.zOrderStep)}if(o===-1/0){const e=a===1/0?0:a,t=g(T(e),e,1);return _(t.startZOrder+t.zOrderStep)}const d=g(o,C(o),1);if(0!==d.zOrderStep)return _(d.startZOrder+d.zOrderStep);const u=y(o,h).sort(((e,t)=>r(e)-r(t)));let p=T(r(u[0]));const m=C(p),f=g(p,m,u.length+1).zOrderStep;return 0!==f?(u.forEach((e=>{const t=_(p+f);s(e,t),p=t})),_(p+f)):_(m+5e3)}function w(e,t){
return b(e,l,c,u,p,t)}function P(e){let t=-1e4;for(const i of e)c(i)&&(t=Math.min(t,i.zorder()-1e4));return 0===t?-1e4:t}function C(e){const t=1e4*Math.ceil(e/1e4);return t===e?t+1e4:t}function T(e){const t=1e4*Math.floor(e/1e4);return t===e?t-1e4:t}function x(e,t,i,s,r,n,o){const l=t.length,{newItems:c,movedItemsStartIndex:h}=i>0?(0,a.moveAfter)(e,t,i-1):(0,a.moveBefore)(e,t,0);let d=!1;for(let t=h;t<h+l;t++)if(c[t]!==e[t]){d=!0;break}if(!d)return;if(s(t[0]))return void(i<e.length&&o(e[i])<0?v(c.slice(h+1),0,n,r):f(c.slice(0,h),0,n,r));t.some((e=>r(e)))?function(e,t,i,s,r,n){let o,a,l=-1,c=-1;0===i?(c=I(e,i+t,s),a=n(e[c])):i+t===e.length?(l=M(e,i-1,s),o=n(e[l])):(l=M(e,i-1,s),o=n(e[l]),c=I(e,i+t,s),a=n(e[c]));if((void 0===o||o<0)&&void 0!==a&&a<=0)f(e.slice(0,c),a,r,s);else if((void 0===a||a>0)&&void 0!==o&&o>=0)v(e.slice(l+1),o,r,s);else{i+t<e.length-i?f(e.slice(0,i+t),0,r,s):v(e.slice(i),0,r,s)}}(c,l,h,r,n,o):function(e,t,i,s,r,n,o){let a,l;0===i?l=o(e[i+t]):i+t===e.length?a=o(e[i-1]):(a=o(e[i-1]),l=o(e[i+t]));let c=0,h=0,d=0,u=0,p=0;if((void 0===a||a<0)&&void 0!==l&&l<=0){c=l;const e=g(c,void 0!==a?a:T(l),t);c=e.startZOrder,p=e.zOrderStep,d=i+t-1,u=d-t,h=-1}else if((void 0===l||l>0)&&void 0!==a&&a>=0){c=a;const e=g(c,void 0!==l?l:C(a),t);c=e.startZOrder,p=e.zOrderStep,d=i,u=d+t,h=1}if(0!==p)for(;d!==u;){const t=_(c+h*p);n(e[d],t),c=t,d+=h}else{const t=e.findIndex((e=>r(e)));-1!==t?(f(e.slice(0,t),0,n,s),v(e.slice(t+1),0,n,s)):v(e,0,n,s)}}(c,l,h,r,s,n,o)}function I(e,t,i){for(;t<e.length&&i(e[t]);)t++;return Math.min(t,e.length-1)}function M(e,t,i){for(;t>=0&&i(e[t]);)t--;return Math.max(0,t)}function L(e,t,i,s,r,n,o){const a=e.indexOf(i)+1;x(e,t,a,s,r,n,o)}function A(e,t,i,s,r,n,o){const a=e.indexOf(i);x(e,t,a,s,r,n,o)}function k(e,t,i){L(e,t,i,n.isSeries,c,u,p)}function E(e,t,i){A(e,t,i,n.isSeries,c,u,p)}},386456:(e,t,i)=>{"use strict";i.d(t,{setSymbolSearchCompleteOverrideFunction:()=>r,getSymbolSearchCompleteOverrideFunction:()=>n});let s=(e,t)=>{var i;return Promise.resolve({symbol:e,name:null!==(i=null==t?void 0:t.symbol)&&void 0!==i?i:e})};function r(e){s=e}function n(){return s}},294084:(e,t,i)=>{"use strict";i.d(t,{StudyMetaInfoBase:()=>d});var s=i(827147),r=i(650151),n=i(939291);const o=new Set(["CorrelationCoefficient@tv-basicstudies","Correlation - Log@tv-basicstudies-1"]),a=new Set([]),l=new Set(["line"]),c=new Map([["AnchoredVWAP@tv-basicstudies","linetoolanchoredvwap"],["RegressionTrend@tv-basicstudies","linetoolregressiontrend"]]),h=/^([^\$]+)\$\d+$/;class d{static getSourceIdsByInputs(e,t){if(!Array.isArray(e)||!t)return[];const i=[];for(const r of e)if(d.isSourceInput(r)&&(0,s.default)(t[r.id])){const e=t[r.id];e.includes("$")&&i.push(e.split("$")[0])}return i}static isSourceInput(e){return Boolean(e.id&&(("source"===e.id||"src"===e.id)&&("text"===e.type||"source"===e.type)||"source"===e.type))}static getSourceInputIds(e){const t=[];for(const i of e.inputs)d.isSourceInput(i)&&t.push(i.id);return t}static setChildStudyMetaInfoPropertiesSourceId(e,t,i){for(const s of e.inputs){
if(!d.isSourceInput(s))continue;const e=i.childs().inputs&&i.childs().inputs.childs()[s.id];if(e){const i=e.value(),s=h.exec(i);if(2===(null==s?void 0:s.length)){if("{pid}"===s[1]){const s=i.replace(/^[^\$]+/,t);e.setValue(s)}}}}}static patchSoSInputs(e,t){const i=e=>{const i=h.exec(e);if(2===(null==i?void 0:i.length)){const s=i[1],n=`${(0,r.ensureNotNull)(t(s))}`;return e.replace(/^[^\$]+/,n)}return e};for(const t in e)if(/in_[\d+]/.test(t)||"source"===t){const r=e[t];(0,s.default)(r)?e[t]=i(r):(0,n.isExtendedInput)(r)&&(0,n.isExtendedInputSource)(r)&&(r.v=i(r.v))}}static canBeChild(e){if((0,s.default)(e))return!0;if(!e)return!1;if(e.extra&&!d.isAllowedSourceInputsCount(e.extra.sourceInputsCount)||!0===e.canNotBeChild||!1===e.canBeChild||o.has(e.id))return!1;let t=0;for(const i of e.inputs)d.isSourceInput(i)&&(t+=1);return d.isAllowedSourceInputsCount(t)}static isAllowedSourceInputsCount(e){return 1===e}static canHaveChildren(e){if(e){if(e.isTVScriptStrategy||e.TVScriptSourceCode&&isStrategy(e.TVScriptSourceCode))return!1;if(e.id&&!a.has(e.id)&&Array.isArray(e.plots))for(const t of e.plots)if(l.has(t.type))return!0}return!1}static getChildSourceInputTitles(e,t,i){var s;const r={};if(t.plots&&t.plots.length&&e.options&&e.options.length)for(const n of e.options){const e=n?+n.split("$")[1]:NaN,o=isFinite(e)&&t.plots[e];o&&l.has(o.type)&&(r[n]=t.styles&&t.styles[o.id]&&(null===(s=t.styles[o.id])||void 0===s?void 0:s.title)||o.id,i&&(r[n]=i+": "+r[n]))}return r}static canPlotBeSourceOfChildStudy(e){return l.has(e)}static getStudyPropertyRootName(e){const t=c.get(e.id);if(void 0!==t)return t;let i="study_"+e.id;return e.pine&&e.pine.version&&(i+="_"+e.pine.version.replace(".","_")),i}static getStudyPropertyRootNameById(e){const t=c.get(e);return void 0!==t?t:"study_"+e}}},898005:(e,t,i)=>{"use strict";i.d(t,{StudyMetaInfo:()=>a});var s=i(817808).getLogger("Chart.Study.MetaInfo"),r=i(103526).applyOverridesToStudyDefaults,n=i(294084).StudyMetaInfoBase,o={};class a extends n{constructor(e){super(),TradingView.merge(this,{palettes:{},inputs:[],plots:[],graphics:{},defaults:{}}),TradingView.merge(this,e);var t=e.fullId||e.id;TradingView.merge(this,a.parseIdString(t))}static versionOf(e){var t="_metainfoVersion"in e&&isNumber(e._metainfoVersion)?e._metainfoVersion:0;return t<0&&s.logError("Metainfo format version cannot be negative: "+t),t}static parseIdString(e){var t={};if(-1===e.indexOf("@"))t.shortId=e,t.packageId="tv-basicstudies",t.id=e+"@"+t.packageId,t.version=1;else{var i=e.split("@");t.shortId=i[0];var s=i[1].split("-");if(3===s.length)t.packageId=s.slice(0,2).join("-"),t.id=t.shortId+"@"+t.packageId,t.version=s[2];else if(1===s.length&&"decisionbar"===s[0])t.packageId="les-"+s[0],t.id=t.shortId+"@"+t.packageId,t.version=1;else{if(1!==s.length)throw new Error("unexpected study id:"+e);t.packageId="tv-"+s[0],t.id=t.shortId+"@"+t.packageId,t.version=1}}if(t.fullId=t.id+"-"+t.version,"tv-scripting"===t.packageId){var r=t.shortId;if(0===r.indexOf("Script$")||0===r.indexOf("StrategyScript$")){var n=r.indexOf("_")
;t.productId=n>=0?r.substring(0,n):t.packageId}else t.productId=t.packageId}else t.productId=t.packageId;return t}static getPackageName(e){return(/^[^@]+@([^-]+-[^-]+)/.exec(e||"")||[0,"tv-basicstudies"])[1]}static cutDollarHash(e){var t=e.indexOf("$"),i=e.indexOf("@");return-1===t?e:e.substring(0,t)+(i>=0?e.substring(i):"")}static hasUserIdSuffix(e){return/^USER;[\d\w]+;\d+$/.test(e)}static hasPubSuffix(e){return/^PUB;.+$/.test(e)}static hasStdSuffix(e){return/^STD;.+$/.test(e)}static isStandardPine(e){return/^(Strategy)?Script\$STD;.*@tv-scripting$/.test(e)}static getStudyIdWithLatestVersion(e){const t=a.cutDollarHash(e.id),i=t.indexOf("CP@tv-basicstudies")>=0;let s=t;return t.indexOf("@tv-scripting")>=0?s+="-101!":s+=i?"-"+e.version+"!":"-"+e.version,s}defaultInputs(){for(var e=[],t=0;t<this.inputs.length;t++)e.push(this.inputs[t].defval);return e}state(e){var t={};for(var i in this)this.hasOwnProperty(i)&&(t[i]=this[i],!0!==e&&"id"===i&&(t[i]+="-"+this.version));return t}symbolInputId(){var e=this.inputs.filter((function(e){return"symbol"===e.type}));return e.length>0?e[0].id:null}createDefaults(){if(this.defaults){var e=TradingView.clone(this.defaults);e.precision="default";var t=a.getStudyPropertyRootName(this);defaults.create(t,e)}}removeDefaults(){defaults.remove(a.getStudyPropertyRootName(this))}static findStudyMetaInfoByDescription(e,t){if(e){for(var i=0;i<e.length;++i)if(e[i].description.toLowerCase()===t.toLowerCase())return e[i];throw new Error("unexpected study id:"+t)}throw new Error("There is no studies metainfo")}static isParentSourceId(e){return"string"==typeof e&&/^[^\$]+\$\d+$/.test(e)}static overrideDefaults(e){0!==e.length&&r(o,e,(function(e){return TradingView.defaultProperties[a.getStudyPropertyRootName(e)]||null}))}static mergeDefaultsOverrides(e){TradingView.merge(o,e)}static isScriptStrategy(e){return!1}static getOrderedInputIds(e){for(var t=[],i=e.inputs,s=0;s<i.length;++s){var r=i[s];t.push(r.id)}return t}}a.VERSION_STUDY_ARG_SOURCE=41,a.METAINFO_FORMAT_VERSION_SOS_V2=42,a.VERSION_PINE_PROTECT_TV_4164=43,a.CURRENT_METAINFO_FORMAT_VERSION=52,a.VERSION_NEW_STUDY_PRECISION_FORMAT=46,a.FilledArea={},a.FilledArea.TYPE_PLOTS="plot_plot",a.FilledArea.TYPE_HLINES="hline_hline",TradingView.StudyMetaInfo=a},433617:(e,t,i)=>{"use strict";window.TradingView=window.TradingView||{},window.requireAll=function(e){return e.keys().map(e)},i(972535).setClasses(),i(748158),i(34301).install(),i(601227),i(486028),i(603605),i(131595),i(592834),i(385450),i(870122)},77067:(e,t,i)=>{"use strict";i(123062);var s=i(650151).assert;i(433617),i(658363),i(80037);const r=i(484727);JSON.parse(urlParams.disabledFeatures).forEach((function(e){r.setEnabled(e,!1)})),JSON.parse(urlParams.enabledFeatures).forEach((function(e){r.setEnabled(e,!0)})),function(){window.__settingsOverrides=window.parent[window.urlParams.uid].settingsOverrides||{};var e=window.parent[window.urlParams.uid].settingsAdapter;null!=e?(TVSettings.setSettingsAdapter(e),TVSettings.sync()):r.enabled("use_localstorage_for_settings")&&TVSettings.sync()}()
;var n=i(574570).setChartFontFamily;window.urlParams.customFontFamily&&n(window.urlParams.customFontFamily);var o=i(231392).RestrictedToolsetBootloader,a=i(692932).HeaderToolbarBootloader,l=i(331621).DrawingToolbarBootloader,c=i(584052).isDrawingToolbarVisible;(0,i(972535).setClasses)();var h=i(9316),d=i(702054).setTheme,u=i(331980),p=i(520159),_=i(411589),m=i(284214).migrateShortcut,g=i(160486).ChartSaver,f=i(413752).SaveChartService,v=i(922236).LoadChartService,S=i(769914).StudyTemplates,y=i(580458).FavoriteStudyTemplateService,b=i(688401).linking,w=i(559410),P=i(821737).formatterOptions,C=i(563068).customFormatters,T=i(256387).StudyMarket,x=i(717866).TVXWindowEvents,I=i(114122).createDeferredPromise,M=i(606615).deepExtend,L=i(220863).randomHash,A=i(235171).convertPropertyToWatchedValue,k=i(29161).property,E=i(633177).property,D=i(599015).dateFormatProperty,B=i(997753).timeHoursFormatProperty,V=i(303160).CustomTimezones,R=i(588535).currencyUnitVisibilityProperty,N=i(343370).default,O=i(638273).Interval,F=i(912036).Root,W=i(207847).ChartPage,z=i(588163).destroyQuoteSessions,H=i(820402).TIMEFRAMETYPE,U=new W(new F(window).allocate()),j=U.allocate({areaName:"center"}),G=window.parent[urlParams.uid].brokerFactory,q=Boolean(G||window.urlParams&&window.urlParams.restConfig),$=i(705681).CHART_WIDGET_COLLECTION_SERVICE,Y=i(33290),K=i(939654).BottomWidgetbarBootloader,Z=i(845139).TerminalConfigSetBootloder,X=i(758044).FooterWidgetBootloader,J=i(333183).TradingBootloader,Q=i(404556).WidgetbarBootloader,ee=i(129917).migrateConfigFlags,te=i(385833).registerSettingsSymbolListBackend,ie=i(822962).NewsApi,se=i(639542).WidgetbarApi,re=q?new J({resizerBridge:U.allocate({areaName:"tradingpanel"})}).load():null,ne=i(501644).overrides;window.parent[urlParams.uid].newsProvider&&(ne.getNews=window.parent[urlParams.uid].newsProvider);var oe=i(900298),ae=oe.addRealtimeToBroker,le=oe.addDomeToBroker,ce=oe.addConnectionStatusToBroker,he=i(486028).isObject;i(904122);var de=i(529139),ue=i(236229).createFavoriteDrawingToolbar,pe=i(130843).setupChartEventHint,_e=i(188718).setupChartScreenshotHint,me=i(343169),ge=i(898005).StudyMetaInfo,fe=i(739385);i(951008),i(397431);var ve=i(673026).setSearchRequestDelay,Se=i(667342),ye=i(603610),be=i(896483).addBrandingSource,we=i(720788).setAdditionalSymbolInfoFields,Pe=i(386456).setSymbolSearchCompleteOverrideFunction,Ce=i(369472).DropdownApi,Te=i(282926).ContextMenuManager,xe=i(850190).setDefaultWatchlistSymbols,Ie=i(850190).defaultWatchlistSymbols;const Me=new AbortController;var Le=window.parent[urlParams.uid].getCustomIndicators,Ae=I(),ke=I(),Ee=r.enabled("left_toolbar");if(void 0!==window.parent[urlParams.uid].contextMenu){var De=window.parent[urlParams.uid].contextMenu;void 0!==De.items_processor&&Te.setCustomItemsProcessor(De.items_processor),void 0!==De.renderer_factory&&Te.setCustomRendererFactory(De.renderer_factory)}if(Promise.all([Ae.promise,ke.promise]).then((function(){window.ChartApiInstance.start()})),"function"==typeof Le){var Be=Le(ye);Be&&Be.then?Be.then((function(e){
if(!Array.isArray(e))return console.warn("custom_indicators_getter should be a function that returns a Promise object which result is an array of custom indicators"),void Ae.resolve();JSServer.studyLibrary.push.apply(JSServer.studyLibrary,e),Ae.resolve(),console.log("{0} custom indicators loaded.".format(e.length))})).catch((function(e){console.warn("Error loading custom indicators "+e),Ae.resolve()})):(console.warn("custom_indicators_getter should be a function that returns a Promise object"),Ae.resolve())}else Ae.resolve();window.widgetReady=function(e){w.subscribe("onChartReady",e)};var Ve=urlParams.theme&&urlParams.theme.toLowerCase();function Re(e){window.__defaultsOverrides=window.__defaultsOverrides||{},M(window.__defaultsOverrides,e),void 0!==TradingView.defaultProperties&&void 0!==TradingView.defaultProperties.chartproperties&&(window.applyDefaultsOverrides(TradingView.defaultProperties.chartproperties),window.applyDefaultOverridesToLinetools())}!function(e){h.themes[e]&&d(e)}(Ve),window.applyStudiesOverrides=function(e){e&&(window.chartWidgetCollection?window.chartWidgetCollection.applyStudiesOverrides(e):ge.mergeDefaultsOverrides(e))},window.applyOverrides=function(e){Re(e),window.chartWidgetCollection&&window.chartWidgetCollection.applyOverrides(e)},window.doWhenApiIsReady=function(e){window.tradingViewApi?e():ke.promise.then(e)},window.applyTradingCustomization=function(e){for(var t in e.order)TradingView.defaultProperties.linetoolorder[t]=e.order[t];for(var t in e.position)TradingView.defaultProperties.linetoolposition[t]=e.position[t]},window.changeTheme=function(e,t){var i=h.themes[e.toLowerCase()];return i?window.tradingViewApi.themes().setStdTheme(i.name,!0,t&&t.disableUndo):Promise.resolve()},window.getTheme=function(){return window.tradingViewApi.themes().getCurrentThemeName()},window.is_authenticated=!1;var Ne=he(window.parent[urlParams.uid].brokerConfig)?window.parent[urlParams.uid].brokerConfig.customUI:{},Oe=JSON.parse(window.urlParams.brokerConfig);i(509806).t(null,void 0,i(965911)),i(509806).t(null,void 0,i(968111)),i(509806).t(null,void 0,i(105607));var Fe=null,We=I(),ze=null,He=function(){if(r.setEnabled("charting_library_debug_mode","true"===urlParams.debug),r.enabled("remove_library_container_border")){var e=document.querySelector("#library-container");null!==e&&(e.style.border="0px",e.style.padding="1px")}r.enabled("no_min_chart_width")&&(window.document.body.style.minWidth="0px"),null!=urlParams.studiesOverrides&&ge.mergeDefaultsOverrides(JSON.parse(urlParams.studiesOverrides)),s(void 0===TradingView.defaultProperties,"Default properties are inited before applying overrides"),Re(JSON.parse(urlParams.overrides)),urlParams.numeric_formatting=urlParams.numeric_formatting&&JSON.parse(urlParams.numeric_formatting),urlParams.numeric_formatting&&"string"==typeof urlParams.numeric_formatting.decimal_sign&&(P.decimalSign=urlParams.numeric_formatting.decimal_sign[0]),window.ChartApiInstance=new me(window.parent[urlParams.uid].datafeed),
window.parent[urlParams.uid].customFormatters&&(window.parent[urlParams.uid].customFormatters.timeFormatter&&(C.timeFormatter=window.parent[urlParams.uid].customFormatters.timeFormatter),window.parent[urlParams.uid].customFormatters.dateFormatter&&(C.dateFormatter=window.parent[urlParams.uid].customFormatters.dateFormatter),window.parent[urlParams.uid].customFormatters.tickMarkFormatter&&(C.tickMarkFormatter=window.parent[urlParams.uid].customFormatters.tickMarkFormatter),window.parent[urlParams.uid].customFormatters.priceFormatterFactory&&(C.priceFormatterFactory=window.parent[urlParams.uid].customFormatters.priceFormatterFactory),window.parent[urlParams.uid].customFormatters.studyFormatterFactory&&(C.studyFormatterFactory=window.parent[urlParams.uid].customFormatters.studyFormatterFactory)),window.parent[urlParams.uid].customTimezones&&V.instance().addTimezones(window.parent[urlParams.uid].customTimezones),window.ChartApiInstance.setStudiesAccessController(window.ChartApiInstance.createStudiesAccessController(urlParams.studiesAccess));var t,n=urlParams.chartContent?JSON.parse(urlParams.chartContent).json:void 0,d=urlParams.chartContentExtendedData?JSON.parse(urlParams.chartContentExtendedData):n?n.extendedData:void 0,p=urlParams.interval||"D",_=function(e){var t=/(\d+)(\w+)/;return e.map((function(e){var s=t.exec(e.text),r=s[2].toLowerCase(),n=parseInt(s[1]),o="y"===r?12*n+"M":n+r,a=O.parse(e.resolution);return{text:e.title||n+i(509806).t(r,{context:"dates",count:n},i(900673)),description:e.description||"",value:{value:o.toUpperCase(),type:H.PeriodBack},targetResolution:a.value(),requiresIntraday:a.isIntraday()}}))}(JSON.parse(urlParams.timeFrames)),m={resizerBridge:j,padding:r.enabled("border_around_the_chart")?2:0,content:n,widgetOptions:{addToWatchlistEnabled:!0,hideIdeas:!0,addVolume:window.ChartApiInstance.studiesAccessController.isToolEnabled("Volume"),muteSessionErrors:!0,timezone:urlParams.timezone,defSymbol:urlParams.symbol,defInterval:p,compareSymbols:urlParams.compareSymbols&&JSON.parse(urlParams.compareSymbols),defTimeframe:(t=window.parent[urlParams.uid].timeframe,t?"string"==typeof t?t:{...t,type:"time-range"}:t),paneContextMenuEnabled:r.enabled("pane_context_menu"),paneContextMenu:{mainSeriesTrade:q},priceScaleContextMenuEnabled:r.enabled("scales_context_menu"),currencyConversionEnabled:r.enabled("pricescale_currency"),unitConversionEnabled:r.enabled("pricescale_unit"),legendWidgetEnabled:r.enabled("legend_widget"),legendWidget:{contextMenu:{settings:r.enabled("show_chart_property_page"),showOpenMarketStatus:r.enabled("display_market_status")}},sourceStatusesWidget:{errorSolution:!1},marketStatusWidgetEnabled:r.enabled("display_market_status"),chartWarningWidget:{subscriptionFullInfo:!1},timeScaleWidget:{contextMenuEnabled:r.enabled("scales_context_menu"),timezoneMenuEnabled:r.enabled("timezone_menu"),priceAxisLabelsOptions:{showLabels:r.enabled("main_series_scale_menu")}},timeScale:{preserveBarSpacing:!1,lockVisibleTimeRangeOnResize:r.enabled("lock_visible_time_range_on_resize"),
rightBarStaysOnScroll:r.enabled("right_bar_stays_on_scroll"),minBarSpacing:urlParams.time_scale&&JSON.parse(urlParams.time_scale).min_bar_spacing},goToDateEnabled:r.enabled("go_to_date"),crossHair:{menuEnabled:r.enabled("chart_crosshair_menu")},handleScale:{mouseWheel:r.enabled("mouse_wheel_scale"),pinch:r.enabled("pinch_scale"),axisPressedMouseMove:{time:r.enabled("axis_pressed_mouse_move_scale"),price:r.enabled("axis_pressed_mouse_move_scale")}},handleScroll:{mouseWheel:r.enabled("mouse_wheel_scroll"),pressedMouseMove:r.enabled("pressed_mouse_move_scroll"),horzTouchDrag:r.enabled("horz_touch_drag_scroll"),vertTouchDrag:r.enabled("vert_touch_drag_scroll")},shiftVisibleRangeOnNewBar:r.enabled("shift_visible_range_on_new_bar"),croppedTickMarks:r.enabled("cropped_tick_marks"),countdownEnabled:r.enabled("countdown"),indicatorsDialogShortcutEnabled:r.enabled("insert_indicator_dialog_shortcut")},seriesControlBarEnabled:r.enabled("timeframes_toolbar"),seriesControlBar:{timeFramesWidgetEnabled:!0,timeFramesWidget:{goToDateEnabled:r.enabled("go_to_date"),availableTimeFrames:function(e,t){return e?t!==Se.STATUS_DELAYED&&t!==Se.STATUS_DELAYED_STREAMING&&t!==Se.STATUS_EOD&&t!==Se.STATUS_READY?[]:_.filter((function(t){return!(t.requiresIntraday&&!e.has_intraday)&&!(e.supported_resolutions&&!e.supported_resolutions.includes(t.targetResolution))})):[]}},timeWidgetEnabled:!0,timeWidget:{timezoneMenuEnabled:r.enabled("timezone_menu")},adjustForDividendsButtonEnabled:!1,sessionIdButtonEnabled:r.enabled("pre_post_market_sessions"),backAdjustmentButtonEnabled:!1,settlementAsCloseButtonEnabled:!1,percentageScaleButtonEnabled:!0,logScaleButtonEnabled:!0,autoScaleButtonEnabled:!0,fullscreenButtonEnabled:!0,mobileChangeLayoutEnabled:!1},globalEvents:!0,snapshotUrl:urlParams.snapshotUrl,mobileForceChartMaximizeEnabled:!1,saveChartEnabled:r.enabled("save_shortcut")};Ee&&(ue(),m.widgetOptions.isDrawingToolbarVisible=c),d&&(m.metaInfo={id:d.uid,name:d.name,description:d.description,uid:d.uid,username:"",tags:""}),window.parent[urlParams.uid].additionalSymbolInfoFields&&we(window.parent[urlParams.uid].additionalSymbolInfoFields),window.parent[urlParams.uid].symbolSearchComplete&&Pe(window.parent[urlParams.uid].symbolSearchComplete);var M=window.chartWidgetCollection=new de(m);let L=!1;M.onAboutToBeDestroyed.subscribe(null,(()=>{L=!0}),!0),be(M),null!==re&&re.then((e=>{e.setChartWidgetCollection(M)})),window.studyMarket=new T(M),void 0!==Y&&Y.registerService($,M),M.activeChartWidget.subscribe((function(e){w.emit("activeChartChanged",M.getAll().indexOf(e))})),window.saver=new g(M);var A=new f(M,window.saver),k=new v(M);window.chartWidget=M.activeChartWidget.value(),window.pro=new TradingView.Pro;var E=function(e){if(!r.enabled("header_widget"))return null;var t=U.allocate({areaName:"top"}),s=new(0,i(525668).ChartChangesWatcher)(e.chartWidgetCollection,window.saver,w),n=JSON.parse(urlParams.favorites);n.intervals=n.intervals.map((function(e){var t=""+e;return t.match(/1[DWMYdwmy]/)&&(t=t.slice(1)),t}));var l,c=null
;r.enabled("study_templates")&&(c=new y(x,TVSettings),ze=new S({chartWidgetCollection:e.chartWidgetCollection,favoriteStudyTemplatesService:c}));var h=urlParams.header_widget_buttons_mode;"fullsize"===h&&(l=["full"]);"compact"===h&&(l=["small"]);return new a(new o,{chartSaver:window.saver,chartApiInstance:ChartApiInstance,chartWidgetCollection:e.chartWidgetCollection,defaultFavoriteStyles:n.chartTypes,defaultFavoriteIntervals:n.intervals,hideStudyTemplates:!0,resizerBridge:t,studyMarket:window.studyMarket,studyTemplates:ze,favoriteStudyTemplatesService:c,allowedModes:l,saveChartService:e.saveChartService,loadChartService:e.loadChartService,chartChangesWatcher:s,onClick:Qe,snapshotUrl:e.snapshotUrl})}({chartWidgetCollection:M,saveChartService:A,loadChartService:k,snapshotUrl:urlParams.snapshotUrl});null!==E?E.load().then((function(e){Fe=e.getComponent(),We.resolve()})):(We.promise.catch((function(){})),We.reject("header widget is not loaded"));var D=function(e){if(Ee){var t=urlParams.toolbarbg&&/^[0-9a-f]+$/i.test(urlParams.toolbarbg)?String(urlParams.toolbarbg):void 0;if(t){var i=document.createElement("style");i.textContent="body,.chart-controls-bar,#footer-chart-panel{background-color:#"+t+" !important}",document.head.appendChild(i)}return new l({bgColor:t,chartWidgetCollection:e,drawingsAccess:urlParams.drawingsAccess?JSON.parse(urlParams.drawingsAccess):void 0,resizerBridge:U.allocate({areaName:"left"}),onClick:Qe})}return null}(M),B=function(e){var t=null;r.enabled("open_account_manager")&&(t="paper_trading");if(r.enabled("trading_account_manager"))return new K({resizerBridge:tt(),chartWidgetCollection:e,widgets:["paper_trading"],defaultActiveWidget:t,mode:"normal",configBootloader:new Z});return null}(M),R=function(e){if(e.supportBottomWidget)return new X({chartWidgetCollection:e.chartWidgetCollection,resizerBridge:tt(),bottomWidgetbarBootloader:e.bottomWidgetbarBootloader});return null}({chartWidgetCollection:M,bottomWidgetbarBootloader:B,supportBottomWidget:r.enabled("trading_account_manager")});window.tradingViewApi=new fe({chartWidgetCollection:M,chartApiInstance:window.ChartApiInstance,saveChartService:A,loadChartService:k});let F=null,W=null,z=null,J=null,ne=null,oe=null;{const e=i(743717),t=Promise.all([e.initSymbolListService(),Promise.all([i.e(1323),i.e(4482),i.e(7898),i.e(1026)]).then(i.bind(i,605011))]).then((e=>{var t=e[0],i=e[1];return t.runner.run(i.activeSymbolListNavigator),t}));F=function(e,t){var s=JSON.parse(urlParams.widgetbar);if(xe(s.watchlist_settings.default_symbols),te(Ie()),r.enabled("right_toolbar")&&(s.watchlist||s.details||s.news||s.datawindow||r.enabled("dom_widget")||r.enabled("order_panel")||r.enabled("show_object_tree")||r.enabled("bugreport_button"))){const r=i(425666).configuration,n=U.allocate({areaName:"right"});return new Q({settingsPrefix:"widgetbar",resizerBridge:n,affectsLayout:()=>U.affectsLayout("right"),showCloseButton:!0,chartWidgetCollection:e,customization:s,readonly:s.watchlist_settings&&s.watchlist_settings.readonly,configuration:()=>r({
chartApiInstance:window.ChartApiInstance,tradingViewApi:window.tradingViewApi}),tradingPromise:t})}return null}(M,re),W=I(),z=I(),J=I(),window.tradingViewApi.setNewsApiPromise(W.promise),window.tradingViewApi.setWatchlistApiPromise(z.promise),window.tradingViewApi.setWidgetbarApiPromise(J.promise),ne=e=>{window.widgetbar=e;const s=e.getWidgets("watchlist"),r=s&&s[0],n=e.getWidgets("news"),o=n&&n[0];J.resolve(new se(e)),r?Promise.all([t,Promise.all([i.e(223),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(346),i.e(8825),i.e(5761),i.e(4884),i.e(105),i.e(1140),i.e(8009),i.e(3795),i.e(8819),i.e(8484),i.e(2196),i.e(8529),i.e(537),i.e(1755),i.e(3704),i.e(1464),i.e(962),i.e(9255),i.e(37),i.e(1323),i.e(1990),i.e(8210),i.e(5416),i.e(4482),i.e(7392),i.e(7898),i.e(1196)]).then(i.bind(i,25091))]).then((([e,t])=>{z.resolve(new t.WatchListApi(e.store))})):z.reject("Unable to resolve the watchlist API: no watchlist widget loaded"),o?o.widgetStarted().subscribe(null,(e=>{W.resolve(new ie(e.widgetObject))}),!0):W.reject("Unable to resolve the news API: no news widget loaded")},oe=e=>{W.reject(e),z.reject(e),J.reject(e)}}if(b.bindToChartWidgetCollection(M),TradingView.isNaN(urlParams.studyCountLimit)||(TradingView.STUDY_COUNT_LIMIT=Math.max(2,+urlParams.studyCountLimit)),!TradingView.isNaN(urlParams.ssreqdelay)){var he=Math.max(0,+urlParams.ssreqdelay);ve(he)}window.ChartApiInstance.connect(),Promise.all([i.e(269),i.e(7624),i.e(8230),i.e(9333),i.e(4819),i.e(6092),i.e(8825),i.e(5761),i.e(8619),i.e(105),i.e(1140),i.e(8009),i.e(4412),i.e(8819),i.e(3562),i.e(5639),i.e(6879),i.e(1528),i.e(7263),i.e(962),i.e(1323),i.e(4104),i.e(412),i.e(1890),i.e(6181),i.e(8772),i.e(2306)]).then(i.t.bind(i,611389,23)).then((({default:e})=>{L||(window.lineToolPropertiesToolbar=new e(M))})),null!==re&&Promise.all([re,Promise.all([i.e(6907),i.e(8230),i.e(9602),i.e(1901),i.e(1428),i.e(1685),i.e(2301),i.e(5993),i.e(9421),i.e(962),i.e(9255),i.e(7664),i.e(945),i.e(766),i.e(3884),i.e(852),i.e(5142)]).then(i.bind(i,649990))]).then((([e,t])=>{!function(e,t,s,n){var o=r.enabled("trading_account_manager");if(G)s.configFlags&&ee(s.configFlags),t.addBroker({id:"Broker",title:"Trading",description:"",icon:"",configFlags:s.configFlags||{},customNotificationFields:s.customNotificationFields||[],durations:s.durations||[],customUI:n},(function(e){var t=G(e);return void 0===t.connectionStatus&&ce(t),void 0===t.subscribeRealtime&&ae(t,e),void 0===t.subscribeDOME&&le(t,e,window.ChartApiInstance),Promise.resolve(t)})),e.selectBroker("Broker");else if(window.urlParams.restConfig){var a="Trading",l=urlParams.clientId;t.addBroker({id:l,title:a,description:"",icon:""},(function(e){var t=JSON.parse(window.urlParams.restConfig);return Promise.all([Promise.all([i.e(6721),i.e(3541)]).then(i.bind(i,426670)),Promise.all([i.e(6721),i.e(3541)]).then(i.bind(i,458283))]).then((([{Broker:i},{defaultConfigFlags:s}])=>new i(e,t.url,{id:l,title:a,configFlags:s},t.access_token,!1)))})),e.selectBroker(l)}if(!o){var c=document.querySelector("#bottom-area");null!==c&&c.classList.add("js-hidden")
}}(e,t,Oe,Ne)}));var ye=document.querySelector(".tv-content");function Ce(){D&&D.load(Me.signal),B&&B.load(Me.signal).then((function(e){TradingView.bottomWidgetBar=e})),R&&R.load(Me.signal).then((function(e){window.footerWidget=e.getComponent()})),F&&F.load(Me.signal).then(ne).catch(oe)}null!==ye&&ye.addEventListener("contextmenu",(function(e){null!==e.target&&"input"!==e.target.tagName.toLowerCase()&&"textarea"!==e.target.tagName.toLowerCase()&&e.preventDefault()})),ke.resolve(),M.undoHistory.undoStack().onChange().subscribe(null,N((function(e){e&&!e.customFlag("doesnt_affect_save")&&w.emit("onAutoSaveNeeded")}),1e3*(urlParams.autoSaveDelay||5),{leading:!1,trailing:!0})),window.chartWidget.withModel(null,(function(){if(ChartApiInstance.on("realtime_tick",(function(e){w.emit("onTick",e)})),q){var e=JSON.parse(urlParams.tradingCustomization);window.applyTradingCustomization(e)}if(!h.savedThemeName()&&Ve){var t=h.getStdTheme(Ve);t&&t.content&&void 0===n&&M.applyTheme({theme:t.content,onlyActiveChart:!1,restoreNonThemeDefaults:!1,themeName:Ve,standardTheme:!0,syncState:!0,noUndo:!0}).then((()=>window.applyOverrides(window.__defaultsOverrides)))}r.enabled("charting_library_debug_mode")&&w.subscribeToAll((function(){var e=Array.prototype.slice.call(arguments);console.log('Event "{0}", arguments: {1}'.format(e[0],JSON.stringify(e.slice(1))))})),pe&&(pe(M),pe=null),_e&&(_e(M,{seriesControlBarEnabled:r.enabled("timeframes_toolbar")}),_e=null)})),u.isAnyChartWidgetInitialized(M)?Ce():u.waitAnyChartWidgetInitialized(M,Ce),w.subscribe("chart_load_requested",(function(e){window.tradingViewApi.loadChart({json:JSON.parse(e.content),extendedData:e})}))};window.addEventListener("unload",(function(){Me.abort(),window.widgetbar&&(window.widgetbar.destroy(),window.widgetbar=null),window.chartWidgetCollection&&(window.chartWidgetCollection.destroy(),window.chartWidgetCollection=null),window.ChartApiInstance&&window.ChartApiInstance.disconnect(),z(),window.ChartApiInstance&&(window.ChartApiInstance.destroy(),window.ChartApiInstance=null),null!==re&&re.then((e=>{e.selectBroker(null)}))})),r.enabled("saveload_storage_customization")&&(window.parent[urlParams.uid].saveLoadAdapter?p.setCustomAdapter(window.parent[urlParams.uid].saveLoadAdapter):void 0!==urlParams.chartsStorageUrl&&urlParams.chartsStorageUrl&&void 0!==urlParams.clientId&&urlParams.clientId?p.initialize(urlParams.clientId,urlParams.userId,urlParams.chartsStorageUrl,urlParams.chartsStorageVer||"1.0"):(r.setEnabled("saveload_storage_customization",!1),r.setEnabled("header_saveload",!1)));var Ue=I();function je(){Ue.resolve()}window.parent[urlParams.uid].loadLastChart&&r.enabled("saveload_storage_customization")?p.getCharts().then((function(e){if(0!==e.length){var t=e.sort((function(e,t){return t.modified_iso-e.modified_iso}))[0];p.getChartContent(t).then((function(e){var t=JSON.parse(e.content);t.extendedData=e,urlParams.chartContent=JSON.stringify({json:t}),je()})).catch(je)}else je()})).catch(je):je();var Ge,qe,$e=I()
;Promise.all([$e.promise,Ue.promise,window.loadedCustomCss]).then((function(){var e,t,i,s,n,o,a=document.querySelector(".loading-indicator");if(a&&(a.style.display="none"),setTimeout(He,0),r.enabled("14851")&&Math.random()<=.02){e=window,t=document,i="script",s="ga",e.GoogleAnalyticsObject=s,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,n=t.createElement(i),o=t.getElementsByTagName(i)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(n,o);var l=document.URL.match(new RegExp("(:?.*://)([^/]+)/.*"))[2];ga("create","UA-112910038-1","auto"),ga("set","anonymizeIp",!0),ga("set",{hostname:l,page:l,referrer:l}),ga("send","pageview")}})),Ge=!0,window.parent[urlParams.uid].datafeed.onReady((function(e){Ge&&console.warn("`onReady` should return result asynchronously. Use `setTimeout` with 0 interval to execute the callback function."),window.configurationData=e,$e.resolve()})),Ge=!1,window.getFunctionFromArguments=function(e){return window.parent[urlParams.uid][e]},window.createShortcutAction=(qe=_.createGroup({desc:"API"}),function(e,t){qe.add({hotkey:m(e),handler:t})}),window.initializationFinished=function(){window.chartWidgetCollection.undoHistory.clearStack()},window.headerReady=function(){return We.promise},window.createButton=function(e){if(null===Fe)throw new Error("Cannot create button: header widget is not ready or is not loaded - use `headerReady` to wait until header is ready");return(e=e||{}).align=e.align||"left",e.useTradingViewStyle=e.useTradingViewStyle||!1,Fe.addButton(L(),e)},window.createDropdown=function(e){if(void 0===e)throw new Error("Cannot create dropdown without any parameters. Please refer to the documentation");void 0===e.align&&(e.align="left");const t=L();return Fe?(Fe.addDropdown(t,e),Promise.resolve(new Ce(Fe,t))):We.promise.then((()=>(Fe.addDropdown(t,e),new Ce(Fe,t))))},window.getAllFeatures=function(){const e=r.getAllFeatures();return Object.keys(e).forEach((function(t){isNaN(parseFloat(t))||delete e[t]})),e};var Ye=null;window.getNavigationButtonsVisibility=function(){return null===Ye&&(Ye=A(k())),Ye};var Ke=null;window.getPaneButtonsVisibility=function(){return null===Ke&&(Ke=A(E())),Ke};var Ze=null;window.getDateFormat=function(){return null===Ze&&(Ze=A(D)),Ze};var Xe=null;window.getTimeHoursFormat=function(){return null===Xe&&(Xe=A(B)),Xe};var Je=null;function Qe(e){var t=TradingView.bottomWidgetBar;t&&t.turnOffMaximize()}window.getCurrencyAndUnitVisibility=function(){return null===Je&&(Je=A(R())),Je};var et=null;function tt(){return et||(et=U.allocate({areaName:"bottom"})),et}},592834:(e,t,i)=>{e=i.nmd(e),TradingView.cleanButAmpersand=function(e,t){var i=t?["&amp;"]:["&"];return TradingView.clean(e,t,i)},TradingView.strip_tags=function(e){return e&&e.replace?e.replace(/(<([^>]+)>)/gi,""):e},TradingView.encodeSpread=function(e){return encodeURIComponent(e)},TradingView.clean=function(e,t,i){var s=[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#039;"],["'","&#39;"]],r=e;if(!e||!e.replace)return r
;for(var n=0;n<s.length;n++){var o=s[n][0],a=s[n][1];i&&i.indexOf&&-1!==i.indexOf(t?a:o)||(r=t?r.replace(new RegExp(a,"g"),o):r.replace(new RegExp(o,"g"),a))}return r},e&&e.exports&&(e.exports={clean:TradingView.clean,cleanButAmpersand:TradingView.cleanButAmpersand,stripTags:TradingView.strip_tags})},385450:(e,t,i)=>{"use strict";i.r(t);var s=i(717866),r=i(32133),n=i(744471);function o(e,t="x"){let i=!1;return"x"!==t&&"both"!==t||(i=i||e.offsetWidth<e.scrollWidth),"y"!==t&&"both"!==t||(i=i||e.offsetHeight<e.scrollHeight),i}function a(e,t="x"){for(const i of Array.from(e.children))if(i instanceof HTMLElement&&(o(i,t)||a(i,t)))return!0;return!1}(0,i(646777).whenDocumentReady)((()=>{document.addEventListener("mouseenter",(e=>{const t=e.target;if(t instanceof HTMLElement&&t.matches(".apply-overflow-tooltip")){let e="x";if(t.matches(".apply-overflow-tooltip--direction_both")?e="both":t.matches(".apply-overflow-tooltip--direction_y")&&(e="y"),t.matches(".apply-overflow-tooltip--check-children-recursively")){if(!a(t,e))return}else if(t.matches(".apply-overflow-tooltip--check-children")){let i=!1;const s=t.children;for(let t=0;t<s.length;t++){const r=s[t];if(r instanceof HTMLElement&&o(r,e)){i=!0;break}}if(!i)return}else if(!o(t,e))return;let i="";i=t.matches&&t.matches(".apply-overflow-tooltip--allow-text")?t.textContent||"":Array.from(t.childNodes).reduce(((e,t)=>(t.nodeType===Node.TEXT_NODE&&e.push(t.textContent||""),e)),[]).join("").trim(),(0,n.showOnElement)(t,{text:i});const s=()=>{(0,n.hide)(),["mouseleave","mousedown"].forEach((e=>t.removeEventListener(e,s)))};["mouseleave","mousedown"].forEach((e=>t.addEventListener(e,s)))}}),!0)}));var l=i(922157),c=i.n(l),h=i(131595),d=i(606615);let u;function p(e){window.iframeAuthWidget&&!1===window.user.profile_data_filled&&(window.iframeAuthWidget.preventClose=!0);const t=window.user.available_offers||{};window.TVSettings&&window.TVSettings.sync(window.user.settings),window.is_authenticated?(e||(initOfferLoginStateChangeButton(),onGoPro()&&window.location.reload()),!1===window.user.profile_data_filled&&((0,r.trackEvent)("Conversion","First login"),delete window.user.profile_data_filled)):(Object.keys(t).forEach((e=>{const i=e;t[i].available_for_anons||delete t[i]})),window.user={username:"Guest",following:"0",followers:"0",ignore_list:[],available_offers:t},h.TVLocalStorage.removeItem("trial_availiable"))}u=window.loginStateChange?window.loginStateChange:window.loginStateChange=new(c()),u.subscribe(null,p),s.TVXWindowEvents.on("loginStateChange",(e=>{const t=JSON.parse(e);window.user=t.user,window.is_authenticated=!!t.is_authenticated,u.fire()})),s.TVXWindowEvents.on("signOut",(()=>{!function(){if(window.initData.lfs){const e=document.getElementsByClassName("js-admin-warning")[0];document.body.removeChild(e)}let e=!0;[/^\/chart\//,/^\/share-your-love\//].forEach((t=>{t.test(window.location.pathname)&&(e=!1)})),e&&window.location.reload()}()})),(()=>{const e="user-obj-changed",t={};window.crossTabSyncUserAttr=t=>{const i={};t instanceof Array?t.forEach((e=>{i[e]=window.user[e]
})):i[t]=window.user[t],s.TVXWindowEvents.emit(e,JSON.stringify(i))},s.TVXWindowEvents.on(e,(e=>{const i=JSON.parse(e);let s;for(s in i)if(i.hasOwnProperty(s)){window.user[s]=i[s];(t[s]||[]).forEach((e=>{e.fire(i[s])}))}}))})(),window.TradingView.changeLoginState=e=>{window.is_authenticated=!!e,s.TVXWindowEvents.emit("loginStateChange",JSON.stringify({is_authenticated:window.is_authenticated,user:window.user})),u.fire()},window.loginUser=function(e,t){window.TVDialogs&&window.TVDialogs.signModal&&window.TVDialogs.signModal.close(),window.user=(0,d.deepExtend)({},e),window.TradingView.changeLoginState(!0),"function"==typeof t&&window.TVDialogs&&window.TVDialogs.signModal?window.TVDialogs.signModal.on("signinSuccess",(()=>{t()})):"function"==typeof t&&t()},window.loginRequiredDelegate=new(c()),window.runOrSignIn=(e,t)=>{t||(t={}),e()},window.onLoginStateChange=p,window.TradingView.setTrialAvailiable=e=>{h.TVLocalStorage.setItem("trial_availiable",e?"1":"0")},window.TradingView.notificationsChanged=new(c())},602564:(e,t,i)=>{"use strict";i.r(t),i.d(t,{generateColor:()=>r,applyAlpha:()=>n,alphaToTransparency:()=>o,transparencyToAlpha:()=>a,applyTransparency:()=>l,resetTransparency:()=>c,getLuminance:()=>h,isHexColor:()=>d,colorFromBackground:()=>u,gradientColorAtPercent:()=>p,isColorDark:()=>_,rgbaFromInteger:()=>m,rgbaToInteger:()=>g,colorToInteger:()=>f});var s=i(724377);function r(e,t,i){if(t=t||0,!d(e))return i?(0,s.rgbaToString)((0,s.rgba)((0,s.parseRgb)(e),(0,s.normalizeAlphaComponent)(a(t)))):e;const[r,n,o]=(0,s.parseRgb)(e),l=(0,s.normalizeAlphaComponent)(a(t));return(0,s.rgbaToString)([r,n,o,l])}function n(e,t){return r(e,o(t))}function o(e){return 100*(1-e)}function a(e){if(e<0||e>100)throw new Error("invalid transparency");return 1-e/100}function l(e,t){if("transparent"===e)return e;const i=(0,s.parseRgba)(e),r=i[3];return(0,s.rgbaToString)((0,s.rgba)(i[0],i[1],i[2],a(t)*r))}function c(e){return"transparent"===e||d(e)?e:(0,s.rgbaToString)((0,s.rgba)((0,s.parseRgb)(e),(0,s.normalizeAlphaComponent)(1)))}function h(e){const t=(0,s.parseRgb)(e).map((e=>(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)));return Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function d(e){return 0===e.indexOf("#")}function u(e){return"black"===(0,s.rgbToBlackWhiteString)((0,s.parseRgb)(e),150)?"#ffffff":"#000000"}function p(e,t,i){const[r,n,o,a]=(0,s.parseRgba)(e),[l,c,h,d]=(0,s.parseRgba)(t),u=(0,s.rgba)(Math.round(r+i*(l-r)),Math.round(n+i*(c-n)),Math.round(o+i*(h-o)),a+i*(d-a));return(0,s.rgbaToString)(u)}function _(e){return h(c(e))<.5}function m(e){const t=(e=Math.round(e))%256;e-=t;const i=(e/=256)%256;e-=i;const s=(e/=256)%256;e-=s;return`rgba(${t},${i},${s},${(e/=256)/255})`}function g(e){const t=Math.round(255*e[3]);return e[0]+256*e[1]+65536*e[2]+16777216*t}function f(e){const t=(0,s.tryParseRgba)(e);return null===t?0:g(t)}},131227:(e,t,i)=>{"use strict";i.d(t,{doAnimate:()=>n});const s={from:0,duration:250,easing:i(635991).easingFunc.easeOutCubic};class r{constructor(e){this._doing=!0,this._completed=!1,
this._options={...s,...e};const t=performance.now();window.requestAnimationFrame((e=>{this._animation(t,this._options.from,e)}))}stop(){this._doing=!1}completed(){return this._completed}_animation(e,t,i){if(!this._doing)return void this._finishAnimation();const s=(i=!i||i<1e12?performance.now():i)-e,r=s>=this._options.duration||t===this._options.to,n=(o=this._options.from,a=this._options.to,l=this._options.easing(s/this._options.duration),o*(1-l)+a*l);var o,a,l;const c=r?this._options.to:n,h=c-t;this._options.onStep(h,c),r?this._finishAnimation():window.requestAnimationFrame((t=>{this._animation(e,c,t)}))}_finishAnimation(){this._options.onComplete&&this._options.onComplete(),this._completed=!0}}function n(e){return new r(e)}},745132:(e,t,i)=>{"use strict";i.d(t,{fetch:()=>s});(0,i(817808).getLogger)("Fetch");function s(e,t,i={}){return window.fetch(e,t)}},817808:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LOGLEVEL:()=>n,getLogLevel:()=>g,isHighRateEnabled:()=>f,setLogLevel:()=>v,getRawLogHistory:()=>S,serializeLogHistoryEntry:()=>y,getLogHistory:()=>b,getLogger:()=>P,loggingOn:()=>T,loggingOff:()=>x});const s="undefined"!=typeof window?window:{};let r=!1;try{localStorage.getItem(""),r=!0}catch(e){}var n;!function(e){e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO",e[e.NORMAL=4]="NORMAL",e[e.DEBUG=5]="DEBUG"}(n||(n={}));let o=0;const a="tv.logger.loglevel",l="tv.logger.logHighRate",c=[];let h=null,d=null,u=null,p=NaN,_=n.WARNING,m=!1;function g(){return _}function f(){return m}function v(e){e=Math.max(n.ERROR,Math.min(n.DEBUG,e)),_=e,I()}function S(e,t){let i=c.reduce(((e,t)=>e.concat(t)),[]);return i.sort(((e,t)=>e.id-t.id)),void 0!==t&&(i=i.filter((e=>e.subSystemId===t))),"number"==typeof e&&(i=i.slice(-e)),i}function y(e){return new Date(e.timestamp).toISOString()+":"+e.subSystemId+":"+e.message.replace(/"/g,"'")}function b(e,t){return function(e,t){let i,s=0,r=0;for(i=e.length-1;i>=1&&(s+=8*(1+encodeURIComponent(e[i]).length),!(i-1>0&&(r=8*(1+encodeURIComponent(e[i-1]).length),s+r>t)));i--);return e.slice(i)}(S(e,t).map(y),75497472)}function w(e,t,i,s){if(t===d&&s.id===u)return;const r=new Date;if(e<=n.NORMAL&&function(e,t,i,s,r){"function"==typeof structuredClone&&(t=structuredClone(t));const n={id:o,message:t,subSystemId:s,timestamp:Number(e)};o+=1,i.push(n),void 0!==r&&i.length>r&&i.splice(0,1)}(r,t,i,s.id,s.maxCount),e<=_&&(!s.highRate||f())&&(!h||s.id.match(h))){const i=r.toISOString()+":"+s.id+":"+t;switch(e){case n.DEBUG:console.debug(i);break;case n.INFO:case n.NORMAL:s.color?console.log("%c"+i,"color: "+s.color):console.log(i);break;case n.WARNING:console.warn(i);break;case n.ERROR:console.error(i)}d=t,u=s.id,p&&clearTimeout(p),p=setTimeout((()=>{d=null,u=null,p=NaN}),1e3)}}function P(e,t={}){const i=[];c.push(i);const s=Object.assign(t,{id:e});function r(e){return t=>w(e,String(t),i,s)}return{logDebug:r(n.DEBUG),logError:r(n.ERROR),logInfo:r(n.INFO),logNormal:r(n.NORMAL),logWarn:r(n.WARNING)}}const C=P("logger"),T=s.lon=(e,t)=>{v(n.DEBUG),C.logNormal("Debug logging enabled"),m=Boolean(e),
h=t||null,I()},x=s.loff=()=>{v(n.INFO),C.logInfo("Debug logging disabled")};function I(){try{r&&(localStorage.setItem(l,String(m)),localStorage.setItem(a,String(_)))}catch(e){C.logWarn(`Cannot save logger state (level: ${_}, high-rate: ${m}) to localStorage: ${e.message}`)}}!function(){m=!!r&&"true"===localStorage.getItem(l);let e=parseInt(r&&localStorage.getItem(a)||"");Number.isNaN(e)&&(e=n.WARNING),v(e),C.logNormal(`Init with settings - level: ${_}, high-rate: ${m}`)}(),s.performance&&s.performance.now?C.logNormal(`Sync logger and perf times, now is ${s.performance.now()}`):C.logWarn("Perf time is not available")},779292:(e,t,i)=>{"use strict";function s(e,t,i,s){return`${s?s+" ":""}${i?i+" ":""}${e}px ${t}`}i.d(t,{makeFont:()=>s,parseFont:()=>n});const r=/(bold )?(italic )?(\d+)(px|pt) (.*)$/;function n(e){const t=r.exec(e);return null===t?null:{family:t[5],size:parseInt(t[3])*("pt"===t[4]?.75:1),bold:Boolean(t[1]),italic:Boolean(t[2])}}},496772:(e,t,i)=>{"use strict";i.d(t,{visitObject:()=>n});var s=i(486028);function r(e,t,i){return(0,s.isArray)(e)?function(e,t,i){return e.map((e=>{const s=r(e,t,i),n=t(s);return void 0!==n?n:s}))}(e,t,i):(0,s.isObject)(e)&&((0,s.isHashObject)(e)||i&&i.visitInstances)?function(e,t,i){const s={};return Object.keys(e).forEach((n=>{const o=r(e[n],t,i),a=t(o);s[n]=void 0!==a?a:o})),s}(e,t,i):e}function n(e,t,i){const s=r(e,t,i),n=t(s);return void 0!==n?n:s}},475551:(e,t,i)=>{"use strict";function s(e){return e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}i.d(t,{regExpEscape:()=>s})},561626:(e,t,i)=>{"use strict";i.r(t),i.d(t,{isRtl:()=>r,stripLTRMarks:()=>a,startWithLTR:()=>l,forceLTRStr:()=>c,forceLTRStrSsr:()=>h,forceRTLStr:()=>d,getLTRScrollLeft:()=>u,getLTRScrollLeftOffset:()=>p,detectAutoDirection:()=>g});var s=i(64531);const r=()=>"rtl"===window.document.dir,n="‬",o=new RegExp("‎|‪|‫|‬","g");function a(e){return""!==e&&r()&&null!=e?e.replace(o,""):e}function l(e){return""!==e&&r()&&null!=e?"‎"+e:e}function c(e){return""!==e&&r()&&null!=e?"‪"+e+n:e}function h(e){return"‪"+e+n}function d(e){return""!==e&&r()&&null!=e?"‫"+e+n:e}function u(e){return(0,s.getNormalizedScrollLeft)(e,"rtl")}function p(e,t){const i=(0,s.detectScrollType)();if("indeterminate"===i)return 0;switch(i){case"negative":t=e.clientWidth-e.scrollWidth+t;break;case"reverse":t=e.scrollWidth-e.clientWidth-t}return t}const _=/[^\u0000-\u0040\u005B-\u0060\u007B-\u00BF\u00D7\u00F7\u02B9-\u02FF\u2000-\u200E\u2010-\u2029\u202C\u202F-\u2BFF]/,m=/[\u0590-\u07FF\u200F\u202B\u202E\uFB1D-\uFDFD\uFE70-\uFEFC]/;function g(e){const t=_.exec(e);return t?m.test(t[0])?"rtl":"ltr":""}},635991:(e,t,i)=>{"use strict";i.d(t,{CubicBezier:()=>s.CubicBezier,dur:()=>s.dur,easingFunc:()=>s.easingFunc});var s=i(549423)},510986:(e,t,i)=>{"use strict";function s(e,t,i="promise rejected by time-out"){return new Promise(((s,r)=>{const n=setTimeout((()=>r(i)),t);e.then((e=>{clearTimeout(n),s(e)})),e.catch((e=>{clearTimeout(n),r(e)}))}))}i.d(t,{makeTimeLimited:()=>s})},679311:(e,t,i)=>{"use strict";function s(){
return Promise.all([i.e(8230),i.e(346),i.e(9602),i.e(1901),i.e(5100),i.e(962),i.e(766),i.e(2077)]).then(i.bind(i,664856))}i.d(t,{loadChangeIntervalDialog:()=>s})},538774:(e,t,i)=>{"use strict";i.d(t,{showChangeIntervalDialogAsync:()=>n});var s=i(679311);let r=null;function n(e){const t=r=(0,s.loadChangeIntervalDialog)().then((i=>{t===r&&i.showChangeIntervalDialog(e)}));return t}},280813:(e,t,i)=>{"use strict";function s(e){return Promise.all([i.e(7624),i.e(8230),i.e(9333),i.e(346),i.e(9602),i.e(1901),i.e(1428),i.e(8619),i.e(1685),i.e(3287),i.e(7177),i.e(2405),i.e(9415),i.e(8955),i.e(9437),i.e(3046),i.e(5674),i.e(962),i.e(9255),i.e(766),i.e(7638),i.e(6256),i.e(4586),i.e(1859)]).then(i.bind(i,948178)).then((t=>t.showGoToDateDialog(e)))}i.d(t,{showGoToDateDialog:()=>s})},324745:(e,t,i)=>{"use strict";i.d(t,{showTooManyStudiesNotice:()=>n});var s=i(509806),r=i(153055);function n(e){"number"!=typeof e&&(e=TradingView.STUDY_COUNT_LIMIT),(0,r.showWarning)({title:s.t(null,void 0,i(533603)),text:s.t(null,void 0,i(470213)).format({number:e})})}},256387:(e,t,i)=>{"use strict";i.d(t,{StudyMarket:()=>n});var s=i(210596),r=i.n(s);class n{constructor(e,t){this._visibility=new(r())(!1),this._dialogPromise=null,this._dialog=null,this._chartWidgetCollection=e,this._options=t}visible(){return this._visibility.readonly()}show(e,t,i){var s;const r=void 0;null===this._dialog&&this._requestDialog(null!=e?e:[],r,t,i),null===(s=this._dialog)||void 0===s||s.open(null!=e?e:[],r,t,i)}hide(){var e;null===(e=this._dialog)||void 0===e||e.hide()}resetAllPages(){var e;null===(e=this._dialog)||void 0===e||e.resetAllStudies()}_requestDialog(e,t,s,r){if(null===this._dialogPromise){let n;n=Promise.all([i.e(8230),i.e(9602),i.e(1901),i.e(1428),i.e(8619),i.e(1685),i.e(8271),i.e(4412),i.e(6304),i.e(9262),i.e(962),i.e(766),i.e(412),i.e(6456)]).then(i.bind(i,82808)).then((e=>new e.IndicatorsLibraryContainer(this._chartWidgetCollection,this._options))),this._dialogPromise=n.then((i=>{this._dialog=i,this._dialog.visible().subscribe((e=>{this._visibility.setValue(e)})),this._dialog.open(e,t,s,r)}))}return this._dialogPromise}}},720788:(e,t,i)=>{"use strict";i.d(t,{setAdditionalSymbolInfoFields:()=>r,getAdditionalSymbolInfoFields:()=>n});let s=[];function r(e){s=e}function n(){return s}},979322:(e,t,i)=>{"use strict";function s(e,t){Promise.all([i.e(8230),i.e(9602),i.e(1901),i.e(4091),i.e(2219),i.e(962),i.e(766),i.e(9374)]).then(i.bind(i,509187)).then((i=>{i.showSymbolInfoDialog(null!=e?e:null,t)}))}i.d(t,{showSymbolInfoDialog:()=>s})},748903:(e,t,i)=>{"use strict";i.d(t,{ChartSaverBase:()=>a});var s=i(316230),r=i(525668),n=i(922157),o=i.n(n);new WeakMap;new TextEncoder;class a{constructor(e){this._prevChartState=null,this._chartSavedDelegate=new(o()),this._chartWidgetCollection=e}saveChartLineTools(e,t,i,s){return Promise.reject("Line tools storage is not supported")}_getCommonSavingInfo(e){const t=this._chartWidgetCollection,i=this._chartWidgetCollection.chartsSymbols(),s=i[t.activeChartWidget.value().id()],r={...(n=s,{...n,
legs:JSON.stringify(null!==(o=n.legs)&&void 0!==o?o:[])})};var n,o;const a=t.metaInfo;return a.id.value()&&(r.id=a.id.value()),r.name=a.name.value()||"",r.description=a.description.value()||"",r.charts_symbols=function(e){const t={};for(const i of Object.keys(e))t[i]={symbol:e[i].symbol};return JSON.stringify(t)}(i),r.is_realtime=r.is_realtime=e?"0":"1",r}async _saveLineToolsToStorage(){return Promise.resolve()}async _saveChart(e,t,i,n){var o;const a=this._chartWidgetCollection.metaInfo;let l=null!==(o=n.changes)&&void 0!==o?o:r.changedAll,c=!0;if(2&l)try{await this._saveLineToolsToStorage()}catch(e){l|=1,c=!1}if(1&l){const r=e(c);if((0,s.default)(this._prevChartState,r)&&null!==a.id.value())return this._chartSavedDelegate.fire(!0),void t(a,r);0;const o=(e,i)=>(c||this._chartWidgetCollection.getAll().forEach((e=>{var t;return null===(t=e.lineToolsSynchronizer())||void 0===t?void 0:t.markAsValidatedBecuaseOfSavingToContent(!0)})),t(e,i));return this._saveChartImpl(r,a,o,i,n,e)}this._chartSavedDelegate.fire(!0),t(a,null)}}},160486:(e,t,i)=>{"use strict";var s=i(922157),r=i(650151).assert,n=i(646846).backend,o=i(748903).ChartSaverBase;i(509806).t(null,void 0,i(308162)),i(509806).t(null,void 0,i(717994)),i(509806).t(null,void 0,i(487375));function a(e,t){e.content=JSON.stringify(t)}t.ChartSaver=class extends o{constructor(e){super(e),this._chartAboutToBeSavedDelegate=new s,this._chartSavedDelegate=new s,this._chartSizeLimitExceededDelegate=new s}chartSizeLimitExceeded(){return this._chartSizeLimitExceededDelegate}chartAboutToBeSaved(){return this._chartAboutToBeSavedDelegate}chartSaved(){return this._chartSavedDelegate}saveToJSON(){var e=this._getCommonSavingInfo(!1);return a(e,this._getChartWidgetCollectionState(!1,!0)),e}_getChartWidgetCollectionState(e,t,i,s,r){return e||(t=!0,s=!1),t?this._chartWidgetCollection.state(!!e,i,s,r):this._chartWidgetCollection.activeChartWidget.value().state(!!e,i,s,r)}publishChart(e){}publishScript(e,t,i){}onPublish(e,t){}_saveChartImpl(e,t,i,s,r,o){var a=i,l=s;if(a=function(s){t.id.value()||(t.id.setValue(s),t.uid.setValue(s)),"function"==typeof i&&i(t,e)},!e.name)return console.warn("Saving chart with empty name is not allowed"),void s();n.saveChart(e.name,e.short_name,e.resolution,e,t).then(a.bind(this)).catch(l.bind(this))}saveChartSilently(e,t,i){i=i||{};var s=function(e){var t=e&&!1,s=this._getChartWidgetCollectionState(!1,void 0,void 0,void 0,t),r=this._getCommonSavingInfo(!1,t);return a(r,s),i.chartName&&(r.name=i.chartName),r.name&&0!==r.name.length||!i.defaultChartName||(r.name=i.defaultChartName),i.autoSave&&(r.autoSave=!0),r}.bind(this);this._isSaveInProcess=!0,this._chartAboutToBeSavedDelegate.fire(),this._saveChart(s,function(t,i){r(!this._chartWidgetCollection.readOnly(),"Trying to save layout in read-only mode"),i&&this._chartWidgetCollection.metaInfo.name.setValue(i.name),this._prevChartState=i,this._chartSavedDelegate.fire(!0),this._isSaveInProcess=!1,e&&e({uid:t.uid.value(),data:i}),this._prevChartState&&delete this._prevChartState.savingToken}.bind(this),function(){
this._chartSavedDelegate.fire(!1),this._isSaveInProcess=!1,t&&t.apply(null,arguments)}.bind(this),i)}isSaveInProcess(){return this._isSaveInProcess}}},9136:(e,t,i)=>{"use strict";i.d(t,{getTranslatedSymbolDescription:()=>s});i(509806);function s(e){return e.description||""}},21218:(e,t,i)=>{"use strict";function s(e){return e+"…"}i.d(t,{appendEllipsis:()=>s})},159537:(e,t,i)=>{"use strict";function s(e){let t=null;return(i,...s)=>(null==t||t.abort(),t=new AbortController,null==i||i.addEventListener("error",(()=>null==t?void 0:t.abort()),{once:!0}),e(t.signal,...s))}function r(e){if(!l(e))throw e}function n(e){if(l(e))throw e}function o(e){return(null==e?void 0:e.aborted)?Promise.reject(a()):new Promise(((t,i)=>{null==e||e.addEventListener("abort",(()=>i(a())),{once:!0})}))}function a(){return new DOMException("Aborted","AbortError")}function l(e){return e instanceof Error&&"AbortError"===e.name}function c(e,t){return Promise.race([o(e),t])}async function h(e,t){let i;try{await c(e,new Promise((e=>{i=setTimeout(e,t)})))}finally{clearTimeout(i)}}i.d(t,{respectLatest:()=>s,skipAbortError:()=>r,rethrowAbortError:()=>n,createAbortError:()=>a,isAbortError:()=>l,respectAbort:()=>c,delay:()=>h})},872580:(e,t,i)=>{"use strict";function s(e){let t;if("object"!=typeof e||null==e||"number"==typeof e.nodeType)t=e;else if(e instanceof Date)t=new Date(e.valueOf());else if(Array.isArray(e)){t=[];let i=0;const r=e.length;for(;i<r;i++)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=s(e[i]))}else{t={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=s(e[i]))}return t}i.d(t,{deepCopy:()=>s})},606615:(e,t,i)=>{"use strict";function s(e,...t){return e&&"object"==typeof e?(0===t.length||t.forEach((t=>{null!=t&&"object"==typeof t&&Object.keys(t).forEach((i=>{const n=e[i],o=t[i];if(o===e)return;const a=Array.isArray(o);if(o&&(r(o)||a)){let t;t=a?n&&Array.isArray(n)?n:[]:n&&r(n)?n:{},e[i]=s(t,o)}else void 0!==o&&(e[i]=o)}))})),e):e}function r(e){if(!e||"[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);if(!t)return!0;const i=Object.hasOwnProperty.toString,s=t.hasOwnProperty("constructor")&&t.constructor;return"function"==typeof s&&i.call(s)===i.call(Object)}i.d(t,{deepExtend:()=>s})},114122:(e,t,i)=>{"use strict";function s(){let e,t;return{promise:new Promise(((i,s)=>{e=i,t=s})),reject:t,resolve:e}}i.d(t,{createDeferredPromise:()=>s})},448064:(e,t,i)=>{"use strict";function s(e){if(void 0===e)return"";if(e instanceof Error){let t=e.message;return e.stack&&(t+=" "+e.stack),t}return"string"==typeof e?e.toString():JSON.stringify(e)}i.d(t,{errorToString:()=>s})},208142:(e,t,i)=>{"use strict";i.d(t,{getTwemojiUrl:()=>r});var s=i(818438);function r(e,t){let i="";return s.default.parse(e,(e=>(i=s.default.base+("svg"===t?`svg/${e}.svg`:`72x72/${e}.png`),!1))),i}s.default.base="https://cdnjs.cloudflare.com/ajax/libs/twemoji/13.0.1/"},220863:(e,t,i)=>{"use strict";i.r(t),i.d(t,{guid:()=>r,randomHash:()=>n,randomHashN:()=>o})
;const s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function n(){return o(12)}function o(e){let t="";for(let i=0;i<e;++i){const e=Math.floor(Math.random()*s.length);t+=s[e]}return t}},810251:(e,t,i)=>{"use strict";function s(e,t){const i=new Map;return function(...s){const r=""+(t?t.apply(null,s):s[0]);if(!i.has(r)){const t=e.apply(this,s);return i.set(r,t),t}return i.get(r)}}i.d(t,{memoize:()=>s})},488563:(e,t,i)=>{"use strict";i.d(t,{parseHtml:()=>r,parseHtmlElement:()=>n});const s=new WeakMap;function r(e,t){let i,r;return i=null==t?document.documentElement:9===t.nodeType?t.documentElement:t,s&&(r=s.get(i)),r||(r=i.ownerDocument.createRange(),r.selectNodeContents(i),s&&s.set(i,r)),r.createContextualFragment(e)}function n(e,t){const i=r(e,t),s=i.firstElementChild;return null!==s&&i.removeChild(s),s}},260845:(e,t,i)=>{"use strict";function s(e){e.preventDefault()}i.d(t,{preventDefault:()=>s,preventDefaultForContextMenu:()=>n});const r=["input:not([type])",'input[type="text"]','input[type="email"]','input[type="password"]','input[type="search"]','input[type="number"]','input[type="url"]',"textarea","a[href]",'*[contenteditable="true"]',"[data-allow-context-menu]"];function n(e){const t=e.target;t&&!t.closest(r.join(", "))&&e.preventDefault()}},652945:(e,t,i)=>{"use strict";i.d(t,{htmlEscape:()=>n,removeTags:()=>o,removeSpaces:()=>a,capitalizeFirstLetterInWord:()=>l});const s=/[<"'&>]/g,r=e=>`&#${e.charCodeAt(0)};`;function n(e){return e.replace(s,r)}function o(e=""){return e.replace(/(<([^>]+)>)/gi,"")}function a(e=""){return e.replace(/\s+/g,"")}function l(e=""){return e.replace(/\b\w/g,(e=>e.toUpperCase()))}},909196:(e,t,i)=>{"use strict";function s(e){return e.reduce((function(e,t,i){return~e.indexOf(t)||e.push(t),e}),[])}i.r(t),i.d(t,{uniq:()=>s})},646777:(e,t,i)=>{"use strict";function s(e,t=!1){"loading"!==document.readyState?t?setTimeout((()=>e()),1):e():document.addEventListener("DOMContentLoaded",(()=>e()))}i.d(t,{whenDocumentReady:()=>s});new Promise((e=>{s(e)}))},845437:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd"><path stroke="currentColor" d="M13 22.5H5.5a2 2 0 0 1-2-2v-14a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2V14"/><path stroke="currentColor" stroke-linecap="square" d="M18.5 15.5v8m-4-4h8"/><path fill="currentColor" d="M7 8h11v1H7zm0 4h11v1H7zm0 4h5v1H7z"/></g></svg>'},201457:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd" stroke="currentColor"><path d="M13.111 18.5H10.5a1 1 0 0 1-1-1v-11a1 1 0 0 1 1-1h11a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1h-8.389z"/><path d="M18.5 20v1.5a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1v-11a1 1 0 0 1 1-1H8"/></g></svg>'},855824:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7 5" width="7" height="5" fill="none"><path stroke="currentColor" stroke-width="1.2" d="M1 1.5l2.5 2 2.5-2"/></svg>'},437924:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd" transform="translate(4 5)"><circle stroke="currentColor" cx="9.5" cy="9.5" r="9"/><path stroke="currentColor" d="M7 14.5h2.5v-5H7"/><path stroke="currentColor" stroke-linecap="square" d="M9.5 14.5h2"/><path fill="currentColor" d="M9.5 7a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/></g></svg>'},902872:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd" stroke="currentColor" transform="translate(6 3)"><rect width="15" height="12" rx="2" x=".5" y="8.5"/><path stroke-linecap="round" stroke-width="2" d="M8 15v2"/><path d="M11.5 4a3.5 3.5 0 0 0-7 0v4.5"/></g></svg>'},832164:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" width="15" height="15" fill="none"><path d="M3.00004 7.50008C3.00004 6.25729 3.50318 5.13298 4.31807 4.31809L3.61097 3.61098C2.6162 4.60574 2.00004 5.98143 2.00004 7.50008H3.00004ZM4.31807 4.31809C5.13296 3.50321 6.25727 3.00008 7.50004 3.00008V2.00008C5.98141 2.00008 4.60572 2.61623 3.61097 3.61098L4.31807 4.31809ZM4.31808 3.61098L2.55033 1.84323L1.84322 2.55033L3.61097 4.31809L4.31808 3.61098ZM7.50004 3.00008C8.74283 3.00008 9.86715 3.50321 10.682 4.31811L11.3891 3.611C10.3944 2.61624 9.01869 2.00008 7.50004 2.00008V3.00008ZM10.682 4.31811C11.4969 5.13299 12 6.2573 12 7.50008H13C13 5.98144 12.3839 4.60576 11.3891 3.611L10.682 4.31811ZM11.3891 4.31811L13.1569 2.55033L12.4498 1.84322L10.682 3.611L11.3891 4.31811ZM12 7.50008C12 8.74285 11.4969 9.86716 10.682 10.682L11.3891 11.3892C12.3839 10.3944 13 9.01872 13 7.50008H12ZM10.682 10.682C9.86715 11.4969 8.74283 12.0001 7.50004 12.0001V13.0001C9.01869 13.0001 10.3944 12.3839 11.3891 11.3892L10.682 10.682ZM10.682 11.3892L12.4498 13.1569L13.1569 12.4498L11.3891 10.682L10.682 11.3892ZM7.50004 12.0001C6.25727 12.0001 5.13296 11.497 4.31807 10.6821L3.61097 11.3892C4.60572 12.3839 5.98141 13.0001 7.50004 13.0001V12.0001ZM4.31807 10.6821C3.50318 9.86718 3.00004 8.74286 3.00004 7.50008H2.00004C2.00004 9.01873 2.6162 10.3944 3.61097 11.3892L4.31807 10.6821ZM2.55033 13.1569L4.31808 11.3892L3.61097 10.6821L1.84322 12.4498L2.55033 13.1569ZM8.00004 2.50007L8 -8.77353e-06L7 8.77353e-06L7.00004 2.50009L8.00004 2.50007ZM12.5001 8.00008L15 8L15 7L12.5 7.00008L12.5001 8.00008ZM2.50006 7.00008L1.564e-05 7L-1.564e-05 8L2.50003 8.00008L2.50006 7.00008ZM7.00004 12.5001L7 15L8 15L8.00004 12.5001L7.00004 12.5001Z"/></svg>'},139267:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd" stroke="currentColor"><path d="M6.5 15A8.5 8.5 0 1 0 15 6.5H8.5"/><path d="M12 10L8.5 6.5 12 3"/></g></svg>'},416911:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd" stroke="currentColor" transform="translate(3 6)"><path d="M.964 8C3 4 6.679.5 11 .5 15.32.5 19 4 21.036 8 19 12 15.32 15.5 11 15.5 6.679 15.5 3 12 .964 8z"/><circle cx="11" cy="8" r="3.5"/></g></svg>'},706862:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd" stroke="currentColor"><path stroke-linecap="square" d="M11.5 21.5v-7m3 7v-5m3 5v-3m-9 3v-5"/><path d="M5.5 22v-3"/><path stroke-linecap="square" d="M5.5 13.5l4.297-4.297a2.406 2.406 0 0 1 3.406 0l2.594 2.594c.94.94 2.463.943 3.406 0L23.5 7.5M22.5 12.5v6m-3-3h6"/></g></svg>'},854190:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="square" d="M6.145 11.968L14 5.5l7.855 6.468a.3.3 0 0 1-.191.532H6.336a.3.3 0 0 1-.19-.532zm0 4.064L14 22.5l7.855-6.468a.3.3 0 0 0-.191-.532H6.336a.3.3 0 0 0-.19.532z"/></svg>'},225191:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd" transform="translate(4 5)"><path fill="currentColor" d="M3 1h1v13.5H3z"/><circle stroke="currentColor" cx="3.5" cy="16.5" r="2"/><path fill="currentColor" d="M5.5 16H18v1H5.5z"/><path stroke="currentColor" d="M0 4L3.5.5 7 4m8 9l3.5 3.5L15 20"/></g></svg>'},951983:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd" stroke="currentColor" transform="translate(4 4)"><path d="M.5 10.992c0 .287.226.508.505.508H2.65c.19.93.55 1.82 1.09 2.63L2.577 15.3a.5.5 0 0 0-.007.71l1.42 1.42a.5.5 0 0 0 .71-.007l1.17-1.163c.81.54 1.71.9 2.63 1.09v1.645c0 .284.227.505.508.505h1.984c.28 0 .508-.221.508-.505V17.35a7.46 7.46 0 0 0 2.63-1.09l1.17 1.163a.5.5 0 0 0 .71.007l1.42-1.42a.5.5 0 0 0-.007-.71l-1.163-1.17c.54-.81.9-1.7 1.09-2.63h1.645a.502.502 0 0 0 .505-.508V9.008a.503.503 0 0 0-.505-.508H17.35c-.19-.93-.55-1.82-1.09-2.63l1.163-1.17a.5.5 0 0 0 .007-.71l-1.42-1.42a.5.5 0 0 0-.71.007L14.13 3.74a7.46 7.46 0 0 0-2.63-1.09V1.005A.504.504 0 0 0 10.992.5H9.008a.504.504 0 0 0-.508.505V2.65c-.92.19-1.82.55-2.63 1.09L4.7 2.577a.5.5 0 0 0-.71-.007L2.57 3.99a.5.5 0 0 0 .007.71L3.74 5.87c-.54.81-.9 1.7-1.09 2.63H1.005a.503.503 0 0 0-.505.508v1.984z"/><circle cx="10" cy="10" r="2.5"/></g></svg>'},593379:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><g fill="currentColor" fill-rule="nonzero"><path d="M4 15h8.5v-1h-8.5zM16.5 15h8.5v-1h-8.5z"/><path d="M14.5 16c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"/></g></svg>'},535149:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" fill-rule="evenodd" d="M11.5 6a.5.5 0 0 0-.5.5V8h6V6.5a.5.5 0 0 0-.5-.5h-5zM18 8V6.5c0-.83-.67-1.5-1.5-1.5h-5c-.83 0-1.5.67-1.5 1.5V8H5.5a.5.5 0 0 0 0 1H7v12.5A2.5 2.5 0 0 0 9.5 24h9a2.5 2.5 0 0 0 2.5-2.5V9h1.5a.5.5 0 0 0 0-1H18zm2 1H8v12.5c0 .83.67 1.5 1.5 1.5h9c.83 0 1.5-.67 1.5-1.5V9zm-8.5 3c.28 0 .5.22.5.5v7a.5.5 0 0 1-1 0v-7c0-.28.22-.5.5-.5zm5.5.5a.5.5 0 0 0-1 0v7a.5.5 0 0 0 1 0v-7z"/></svg>'},484959:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><path fill="currentColor" d="M18.15 7.02A9.05 9.05 0 0014 6c-3.45 0-6.08 2-7.8 3.92a18.18 18.18 0 00-2.64 3.84v.02h-.01L4 14l-.45-.21-.1.21.1.21L4 14l-.45.21.01.03a5.85 5.85 0 00.16.32c.11.2.28.51.5.87a18.18 18.18 0 002.4 3.12l.71-.71A17.18 17.18 0 014.56 14a10.05 10.05 0 01.52-.91c.41-.69 1.04-1.6 1.85-2.5C8.58 8.75 10.95 7 14 7a8 8 0 013.4.77l.75-.75zm-3.11 3.12a4 4 0 00-4.9 4.9l.86-.87V14a3 3 0 013.17-3l.87-.86zm1.96 3.7l.86-.88a4 4 0 01-4.9 4.9l.87-.86A3 3 0 0017 13.83zm-6.4 6.4A8 8 0 0014 21c3.05 0 5.42-1.76 7.07-3.58A17.18 17.18 0 0023.44 14a9.47 9.47 0 00-.52-.91 17.18 17.18 0 00-2.25-2.93l.7-.7a18.18 18.18 0 013.06 4.3l.02.02L24 14l.45.21-.01.03a7.03 7.03 0 01-.16.32c-.11.2-.28.51-.5.87-.44.72-1.1 1.69-1.97 2.65C20.08 20.01 17.45 22 14 22c-1.55 0-2.94-.4-4.15-1.02l.75-.75zM24 14l.45-.21.1.21-.1.21L24 14zM22.2 6.5L6.5 22.2l-.7-.7L21.5 5.8l.7.7z"/></svg>'},397874:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd" stroke="currentColor" transform="translate(6 4)"><rect width="15" height="12" rx="2" x=".5" y="7.5"/><path stroke-linecap="round" stroke-width="2" d="M8 14v2"/><path d="M11.5 7.5V4a3.5 3.5 0 0 0-7 0v3.5"/></g></svg>'},677067:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M13.39 3.84a1 1 0 0 1 1.22 0l8.19 6.37a1 1 0 0 1 0 1.58l-8.19 6.37a1 1 0 0 1-1.22 0L5.2 11.79a1 1 0 0 1 0-1.58l8.19-6.37zm.61.8L5.81 11 14 17.37 22.19 11 14 4.63zM5.3 13.6l8.7 6.76 8.7-6.76.6.78-8.69 6.77a1 1 0 0 1-1.22 0l-8.7-6.77.62-.78zm8.09 10.55l-8.7-6.77.62-.78L14 23.37l8.7-6.76.6.78-8.69 6.77a1 1 0 0 1-1.22 0z"/></svg>'},776351:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 28" width="36" height="28"><path fill="currentColor" d="M14 22H7V11H0V4h14v18zM28 22h-8l7.5-18h8L28 22z"/><circle fill="currentColor" cx="20" cy="8" r="4"/></svg>'},291753:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 11" width="22" height="11"><path fill="#2962FF" d="M5 0H0v4h5v7h4V0H5zm7 4a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm5 7h-5l4.5-11h4.99L17 11z"/></svg>'},110123:e=>{"use strict"
;e.exports=JSON.parse('{"4":["v",["h",0,2],["h",1,3]],"6":["v",["h",0,2,4],["h",1,3,5]],"8":["v",["h",0,2,4,6],["h",1,3,5,7]],"2h":["h",0,1],"2v":["v",0,1],"2-1":["v",["h",0,2],1],"3s":["h",0,["v",1,2]],"3h":["h",0,1,2],"3v":["v",0,1,2],"1-2":["v",0,["h",1,2]],"3r":["h",["v",0,1],2],"4h":["h",0,1,2,3],"4v":["v",0,1,2,3],"4s":["h",0,["v",1,2,3]],"5h":["h",0,1,2,3,4],"6h":["h",0,1,2,3,4,5],"7h":["h",0,1,2,3,4,5,6],"8h":["h",0,1,2,3,4,5,6,7],"1-3":["v",0,["h",1,2,3]],"2-2":["v",["h",0,1],["v",2,3]],"2-3":["v",["h",0,1],["h",2,3,4]],"1-4":["v",0,["h",1,2,3,4]],"5s":["h",0,["v",1,2,3,4]],"6c":["v",["h",0,1],["h",2,3],["h",4,5]],"8c":["v",["h",0,1],["h",2,3],["h",4,5],["h",6,7]],"s":0}')}},e=>{e.O(0,[2228,6713,8121],(()=>{return t=77067,e(e.s=t);var t}));e.O()}]);