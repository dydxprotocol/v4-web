<!doctype html>
<html>
  <head>
    <title>TradingView Wallet Test</title>
    <meta charset="utf-8" />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      #tv_chart {
        width: 100%;
        height: 100%;
      }
    </style>
    <script src="/tradingview/charting_library.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>
      eruda.init();
    </script>
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src * 'unsafe-eval' 'unsafe-inline' blob:; object-src *;"
    />
  </head>
  <body>
    <div id="tv_chart"></div>
    <script>
      console.log('TV present?', typeof TradingView);
      const policy = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
      console.log('ðŸ”’ CSP meta tag:', policy?.content);

      new TradingView.widget({
        debug: true,
        container: 'tv_chart',
        library_path: '/tradingview/',
        autosize: true,
        symbol: 'BTCUSD',
        interval: '1',
        datafeed: {
          onReady: (cb) => {
            console.log('[DATAFEED] onReady');
            cb({ supported_resolutions: ['1', '5', '15', '1D'] });
          },
          resolveSymbol: (symbolName, onResolve) => {
            console.log('[DATAFEED] resolveSymbol');
            onResolve({
              name: symbolName,
              ticker: symbolName,
              session: '24x7',
              timezone: 'Etc/UTC',
              minmov: 1,
              pricescale: 100,
              has_intraday: true,
              supported_resolutions: ['1', '5', '15', '1D'],
              type: 'crypto',
            });
          },
          getBars: (symbolInfo, resolution, from, to, onHistory) => {
            console.log('[DATAFEED] getBars');
            onHistory([], { noData: true });
          },
        },
      });
    </script>
  </body>
</html>
